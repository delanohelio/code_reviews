{"pr_number": 7747, "pr_title": "IGNITE-12925 Fixes flaky tests for continuous query metrics.", "pr_author": "ololo3000", "pr_createdAt": "2020-04-27T18:30:14Z", "pr_url": "https://github.com/apache/ignite/pull/7747", "merge_commit": "50776f58a14486f5e2e8d2052515b4557a99453a", "timeline": [{"oid": "5b4710c6211956f1eec16a2d6685f92503974283", "url": "https://github.com/apache/ignite/commit/5b4710c6211956f1eec16a2d6685f92503974283", "message": "IGNITE-12925 Fixes SystemViewSelfTest#testContinuousQuery flaky test.", "committedDate": "2020-04-27T18:28:28Z", "type": "commit"}, {"oid": "35e2bb50a4fa930730df45d542f3c2ef28b9267a", "url": "https://github.com/apache/ignite/commit/35e2bb50a4fa930730df45d542f3c2ef28b9267a", "message": "IGNITE-12925 Fixes minor issues.", "committedDate": "2020-04-27T18:53:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA3NDUyNQ==", "url": "https://github.com/apache/ignite/pull/7747#discussion_r416074525", "body": "I suggesting fix all similar tests:\r\n```\r\nSystemViewSelfTest#testContinuousQuery\r\nJmxExporterSpiTest#testContinuousQuery\r\nSqlViewExporterSpiTest#testContinuousQuery\r\n```", "bodyText": "I suggesting fix all similar tests:\nSystemViewSelfTest#testContinuousQuery\nJmxExporterSpiTest#testContinuousQuery\nSqlViewExporterSpiTest#testContinuousQuery", "bodyHTML": "<p dir=\"auto\">I suggesting fix all similar tests:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"SystemViewSelfTest#testContinuousQuery\nJmxExporterSpiTest#testContinuousQuery\nSqlViewExporterSpiTest#testContinuousQuery\n\"><pre><code>SystemViewSelfTest#testContinuousQuery\nJmxExporterSpiTest#testContinuousQuery\nSqlViewExporterSpiTest#testContinuousQuery\n</code></pre></div>", "author": "NSAmelchev", "createdAt": "2020-04-27T19:05:16Z", "path": "modules/core/src/test/java/org/apache/ignite/internal/metric/SystemViewSelfTest.java", "diffHunk": "@@ -526,7 +526,7 @@ public void testContinuousQuery() throws Exception {\n             }\n \n             assertEquals(0, origQrys.size());\n-            assertEquals(0, remoteQrys.size());\n+            assertTrue(waitForCondition(() -> remoteQrys.size() == 0, getTestTimeout()));", "originalCommit": "35e2bb50a4fa930730df45d542f3c2ef28b9267a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "98e3189717c1945bcc2ca1268c1adf5bee14dbeb", "url": "https://github.com/apache/ignite/commit/98e3189717c1945bcc2ca1268c1adf5bee14dbeb", "message": "IGNITE-12925 Fixes minor issues.", "committedDate": "2020-04-27T19:30:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIwNzA1OQ==", "url": "https://github.com/apache/ignite/pull/7747#discussion_r417207059", "body": "Should we use the same `waitForCondition` as well?", "bodyText": "Should we use the same waitForCondition as well?", "bodyHTML": "<p dir=\"auto\">Should we use the same <code>waitForCondition</code> as well?</p>", "author": "Mmuzaf", "createdAt": "2020-04-29T10:12:59Z", "path": "modules/indexing/src/test/java/org/apache/ignite/internal/processors/cache/metric/SqlViewExporterSpiTest.java", "diffHunk": "@@ -560,7 +560,8 @@ public void testContinuousQuery() throws Exception {\n         }\n \n         assertTrue(execute(ignite0, \"SELECT * FROM SYS.CONTINUOUS_QUERIES\").isEmpty());", "originalCommit": "98e3189717c1945bcc2ca1268c1adf5bee14dbeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIxOTI0Ng==", "url": "https://github.com/apache/ignite/pull/7747#discussion_r417219246", "bodyText": "For local node QueryCursor#close gives guarantees that CQ will be unregistered before method returns. See GridContinuousProcessor#stopRoutine::1094", "author": "ololo3000", "createdAt": "2020-04-29T10:36:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIwNzA1OQ=="}], "type": "inlineReview", "revised_code": null}]}