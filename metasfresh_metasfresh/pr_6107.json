{"pr_number": 6107, "pr_title": "Gh6106 accounting fixes", "pr_author": "teosarca", "pr_createdAt": "2020-01-30T20:35:33Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6107", "timeline": [{"oid": "4962042a178cbc06c0f49e1a08d2fc73b435c079", "url": "https://github.com/metasfresh/metasfresh/commit/4962042a178cbc06c0f49e1a08d2fc73b435c079", "message": "Create 5550750_cli_dont_use_currency_balancing.sql\n\nhttps://github.com/metasfresh/metasfresh/issues/6106", "committedDate": "2020-01-30T20:21:48Z", "type": "commit"}, {"oid": "1499089b5cfaaa2b30b56778be595c1933c34b56", "url": "https://github.com/metasfresh/metasfresh/commit/1499089b5cfaaa2b30b56778be595c1933c34b56", "message": "Doc_MatchInv: avoid balancing source currency when not needed\n\nhttps://github.com/metasfresh/metasfresh/issues/6106", "committedDate": "2020-01-30T20:22:56Z", "type": "commit"}, {"oid": "a0ff8498420d805f6d919591c270c04b473d7915", "url": "https://github.com/metasfresh/metasfresh/commit/a0ff8498420d805f6d919591c270c04b473d7915", "message": "Fact.checkAccounts: improve error reporting\n\nhttps://github.com/metasfresh/metasfresh/issues/6106", "committedDate": "2020-01-30T20:26:39Z", "type": "commit"}, {"oid": "991c5ea670aff8822dbeb64d3572fd767a5caf25", "url": "https://github.com/metasfresh/metasfresh/commit/991c5ea670aff8822dbeb64d3572fd767a5caf25", "message": "fix costing issues\n\nhttps://github.com/metasfresh/metasfresh/issues/6106", "committedDate": "2020-01-30T20:28:11Z", "type": "commit"}, {"oid": "ba95d6ccb11cc7bb0f7eabe21c40bef199530638", "url": "https://github.com/metasfresh/metasfresh/commit/ba95d6ccb11cc7bb0f7eabe21c40bef199530638", "message": "document\n\nhttps://github.com/metasfresh/metasfresh/issues/6106", "committedDate": "2020-01-30T20:33:08Z", "type": "commit"}, {"oid": "f404cc0aae8acbe53c21dc7d99009930fdb6ec62", "url": "https://github.com/metasfresh/metasfresh/commit/f404cc0aae8acbe53c21dc7d99009930fdb6ec62", "message": "introduce `async_disable` system property\n\nhttps://github.com/metasfresh/metasfresh/issues/6106", "committedDate": "2020-01-30T20:47:36Z", "type": "commit"}, {"oid": "cbaa599484847d21d5bbd15a095921233017ad67", "url": "https://github.com/metasfresh/metasfresh/commit/cbaa599484847d21d5bbd15a095921233017ad67", "message": "improve error message\n\nhttps://github.com/metasfresh/metasfresh/issues/6106", "committedDate": "2020-01-31T08:30:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxMTEyNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6107#discussion_r373411124", "body": "wdyt about \r\n```suggestion\r\n\t\tfinal boolean lessThanTwoCurrecies = CollectionUtils.extractDistinctElements(m_lines, FactLine::getCurrencyId) < 2\r\n\t\treturn lessThanTwoCurrecies;\r\n```", "bodyText": "wdyt about\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tCurrencyId currencyId = null;\n          \n          \n            \n            \t\tfor (final FactLine line : m_lines)\n          \n          \n            \n            \t\t{\n          \n          \n            \n            \t\t\tif (currencyId == null)\n          \n          \n            \n            \t\t\t{\n          \n          \n            \n            \t\t\t\tcurrencyId = line.getCurrencyId();\n          \n          \n            \n            \t\t\t}\n          \n          \n            \n            \t\t\telse if (!CurrencyId.equals(currencyId, line.getCurrencyId()))\n          \n          \n            \n            \t\t\t{\n          \n          \n            \n            \t\t\t\treturn false;\n          \n          \n            \n            \t\t\t}\n          \n          \n            \n            \t\t}\n          \n          \n            \n            \n          \n          \n            \n            \t\treturn true;\n          \n          \n            \n            \t\tfinal boolean lessThanTwoCurrecies = CollectionUtils.extractDistinctElements(m_lines, FactLine::getCurrencyId) < 2\n          \n          \n            \n            \t\treturn lessThanTwoCurrecies;", "bodyHTML": "<p dir=\"auto\">wdyt about</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t<span class=\"pl-smi\">CurrencyId</span> currencyId <span class=\"pl-k\">=</span> <span class=\"pl-c1\">null</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t<span class=\"pl-k\">for</span> (<span class=\"pl-k\">final</span> <span class=\"pl-smi\">FactLine</span> line <span class=\"pl-k\">:</span> m_lines)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t{</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t<span class=\"pl-k\">if</span> (currencyId <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t{</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t\tcurrencyId <span class=\"pl-k\">=</span> line<span class=\"pl-k\">.</span>getCurrencyId();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t}</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t<span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-k\">!</span><span class=\"pl-smi\">CurrencyId</span><span class=\"pl-k\">.</span>equals(currencyId, line<span class=\"pl-k\">.</span>getCurrencyId()))</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t{</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t\t<span class=\"pl-k\">return</span> <span class=\"pl-c1\">false</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t}</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t}</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t<span class=\"pl-k\">return</span> <span class=\"pl-c1\">true</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t<span class=\"pl-k\">final</span> <span class=\"pl-k\">boolean</span> lessThanTwoCurrecies <span class=\"pl-k\">=</span> <span class=\"pl-smi\">CollectionUtils</span><span class=\"pl-k\">.</span>extractDistinctElements(m_lines, <span class=\"pl-smi\">FactLine</span><span class=\"pl-k\">::</span>getCurrencyId) <span class=\"pl-k\">&lt;</span> <span class=\"pl-c1\">2</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t<span class=\"pl-k\">return</span> lessThanTwoCurrecies;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "metas-ts", "createdAt": "2020-01-31T10:27:42Z", "path": "de.metas.acct.base/src/main/java-legacy/org/compiere/acct/Fact.java", "diffHunk": "@@ -260,6 +261,24 @@ public PostingType getPostingType()\n \t\treturn postingType;\n \t}\n \n+\tpublic boolean isSingleCurrency()\n+\t{\n+\t\tCurrencyId currencyId = null;\n+\t\tfor (final FactLine line : m_lines)\n+\t\t{\n+\t\t\tif (currencyId == null)\n+\t\t\t{\n+\t\t\t\tcurrencyId = line.getCurrencyId();\n+\t\t\t}\n+\t\t\telse if (!CurrencyId.equals(currencyId, line.getCurrencyId()))\n+\t\t\t{\n+\t\t\t\treturn false;\n+\t\t\t}\n+\t\t}\n+\n+\t\treturn true;", "originalCommit": "cbaa599484847d21d5bbd15a095921233017ad67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxNDc4MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6107#discussion_r373414781", "body": "\ud83c\udf89 ", "bodyText": "\ud83c\udf89", "bodyHTML": "<p dir=\"auto\"><g-emoji class=\"g-emoji\" alias=\"tada\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f389.png\">\ud83c\udf89</g-emoji></p>", "author": "metas-ts", "createdAt": "2020-01-31T10:36:21Z", "path": "de.metas.business/src/main/java/de/metas/quantity/QuantityUOMConverter.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package de.metas.quantity;\n+\n+import de.metas.product.ProductId;\n+import de.metas.uom.UomId;\n+\n+/*\n+ * #%L\n+ * de.metas.business\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ * \n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ * \n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+@FunctionalInterface\n+public interface QuantityUOMConverter", "originalCommit": "cbaa599484847d21d5bbd15a095921233017ad67", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "07bcfd12e58ed1926a65b70f00dfb218b0e7add9", "url": "https://github.com/metasfresh/metasfresh/commit/07bcfd12e58ed1926a65b70f00dfb218b0e7add9", "message": "minor improvement\n\nhttps://github.com/metasfresh/metasfresh/issues/6106", "committedDate": "2020-01-31T10:43:34Z", "type": "commit"}]}