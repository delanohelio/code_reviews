{"pr_number": 5939, "pr_title": "Ignore DebugLogExporter if ZEEEB_DEBUG is false", "pr_author": "npepinpe", "pr_createdAt": "2020-11-28T10:46:22Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5939", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzOTE5OA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532439198", "body": "```suggestion\r\n  public void shouldNotRegisterDebugLogExporter() {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void shouldDisableDebugLogExporter() {\n          \n          \n            \n              public void shouldNotRegisterDebugLogExporter() {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">shouldDisableDebugLogExporter</span>() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">shouldNotRegisterDebugLogExporter</span>() {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pihme", "createdAt": "2020-11-30T09:04:41Z", "path": "broker/src/test/java/io/zeebe/broker/system/configuration/BrokerCfgTest.java", "diffHunk": "@@ -240,16 +240,20 @@ public void shouldEnableDebugLogExporter() {\n     environment.put(ENV_DEBUG_EXPORTER, \"true\");\n \n     // then\n-    assertDefaultDebugLogExporter(false);\n+    assertDefaultDebugLogExporter();\n   }\n \n   @Test\n-  public void shouldEnableDebugLogExporterWithPrettyOption() {\n+  public void shouldDisableDebugLogExporter() {", "originalCommit": "378f56e49f4f02c18b25cd11aaa55a02233c1bdb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MDczMA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532440730", "body": "Is it deliberate that the literal is used here? (as opposed to using `DebugLogExporter.defaultConfig();`", "bodyText": "Is it deliberate that the literal is used here? (as opposed to using DebugLogExporter.defaultConfig();", "bodyHTML": "<p dir=\"auto\">Is it deliberate that the literal is used here? (as opposed to using <code>DebugLogExporter.defaultConfig();</code></p>", "author": "pihme", "createdAt": "2020-11-30T09:07:23Z", "path": "broker/src/test/java/io/zeebe/broker/test/EmbeddedBrokerConfigurator.java", "diffHunk": "@@ -20,7 +20,7 @@\n public final class EmbeddedBrokerConfigurator {\n \n   public static final Consumer<BrokerCfg> DEBUG_EXPORTER =\n-      cfg -> cfg.getExporters().put(\"DebugLogExporter\", DebugLogExporter.defaultConfig(false));\n+      cfg -> cfg.getExporters().put(\"DebugLogExporter\", DebugLogExporter.defaultConfig());", "originalCommit": "378f56e49f4f02c18b25cd11aaa55a02233c1bdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU3MjA5NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532572095", "bodyText": "I don't understand - do you mean the exporter ID? This is using DebugLogExporter.defaultConfig().", "author": "npepinpe", "createdAt": "2020-11-30T12:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MDczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU3MzA5Ng==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532573096", "bodyText": "I mean the key in the map", "author": "pihme", "createdAt": "2020-11-30T12:50:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MDczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU3Mzc2OA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532573768", "bodyText": "Ah, no I just refactored the usage - I can't really speak for the original intent, and I was unaware we had a DebugLogExporter.defaultExporterId(), but I can use it \ud83d\udc4d", "author": "npepinpe", "createdAt": "2020-11-30T12:51:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MDczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MjA3Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532442077", "body": "Is there a test case that verifies the debug exporter is not enabled if the environment variable doesn't exist?", "bodyText": "Is there a test case that verifies the debug exporter is not enabled if the environment variable doesn't exist?", "bodyHTML": "<p dir=\"auto\">Is there a test case that verifies the debug exporter is not enabled if the environment variable doesn't exist?</p>", "author": "pihme", "createdAt": "2020-11-30T09:09:45Z", "path": "broker/src/test/java/io/zeebe/broker/system/configuration/BrokerCfgTest.java", "diffHunk": "@@ -240,16 +240,20 @@ public void shouldEnableDebugLogExporter() {\n     environment.put(ENV_DEBUG_EXPORTER, \"true\");\n \n     // then\n-    assertDefaultDebugLogExporter(false);\n+    assertDefaultDebugLogExporter();\n   }\n \n   @Test\n-  public void shouldEnableDebugLogExporterWithPrettyOption() {\n+  public void shouldDisableDebugLogExporter() {", "originalCommit": "378f56e49f4f02c18b25cd11aaa55a02233c1bdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU3MTY0Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532571647", "bodyText": "No, and honestly I was on the fence about the worth of this test - on one hand, the normal state is to not have the exporter. On the other hand, previous versions would include it regardless of the value, so I did want a \"regression\" test to ensure the behaviour was changed.\nHowever, now that I think about it, we could simply have a test which checks there are no exporters by default (we have several other default tests, but none for exporters).", "author": "npepinpe", "createdAt": "2020-11-30T12:47:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MjA3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjU4MDY5Mw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532580693", "bodyText": "Added the test and a follow up issue: #5944", "author": "npepinpe", "createdAt": "2020-11-30T13:03:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0MjA3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYyNjc1MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532626751", "body": "```suggestion\r\n  private void assertDebugLogExporterRegistered() {\r\n```\r\n\r\nThe name is confusing. In line 262 ` public void shouldHaveNoExportersByDefault() {` we test for having no exporter by default.\r\n\r\nHere, with the name `Default` in it we would be testing that there is an exporter registered. But the only place we call it from is not a vanilla default configuration. ", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private void assertDefaultDebugLogExporter() {\n          \n          \n            \n              private void assertDebugLogExporterRegistered() {\n          \n      \n    \n    \n  \n\nThe name is confusing. In line 262  public void shouldHaveNoExportersByDefault() { we test for having no exporter by default.\nHere, with the name Default in it we would be testing that there is an exporter registered. But the only place we call it from is not a vanilla default configuration.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">private</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">assertDefaultDebugLogExporter</span>() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">private</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">assertDebugLogExporterRegistered</span>() {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">The name is confusing. In line 262 <code> public void shouldHaveNoExportersByDefault() {</code> we test for having no exporter by default.</p>\n<p dir=\"auto\">Here, with the name <code>Default</code> in it we would be testing that there is an exporter registered. But the only place we call it from is not a vanilla default configuration.</p>", "author": "pihme", "createdAt": "2020-11-30T14:14:49Z", "path": "broker/src/test/java/io/zeebe/broker/system/configuration/BrokerCfgTest.java", "diffHunk": "@@ -836,13 +847,13 @@ private void assertEmbeddedGatewayEnabled(final String configFileName, final boo\n     assertThat(gatewayCfg.isEnable()).isEqualTo(enabled);\n   }\n \n-  private void assertDefaultDebugLogExporter(final boolean prettyPrint) {\n-    assertDebugLogExporter(\"default\", prettyPrint);\n-    assertDebugLogExporter(\"empty\", prettyPrint);\n+  private void assertDefaultDebugLogExporter() {", "originalCommit": "b8db10bf46c8d15a207efd42c45cf9ddfa1328b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjczNTA5NA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5939#discussion_r532735094", "body": "This could be renamed:\r\n```suggestion\r\n  private void assertWithConfiguration(\r\n```", "bodyText": "This could be renamed:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private void assertWithDefaultConfiguration(\n          \n          \n            \n              private void assertWithConfiguration(", "bodyHTML": "<p dir=\"auto\">This could be renamed:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">private</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">assertWithDefaultConfiguration</span>(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">private</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">assertWithConfiguration</span>(</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pihme", "createdAt": "2020-11-30T16:38:22Z", "path": "broker/src/test/java/io/zeebe/broker/system/configuration/BrokerCfgTest.java", "diffHunk": "@@ -892,4 +892,15 @@ private void assertSystemClusterConfiguration(\n     assertThat(cfgCluster.getClusterSize()).isEqualTo(clusterSize);\n     assertThat(cfgCluster.getInitialContactPoints()).isEqualTo(initialContactPoints);\n   }\n+\n+  private void assertWithDefaultConfigurations(final Consumer<BrokerCfg> assertions) {\n+    Stream.of(\"default\", \"empty\")\n+        .forEach(configFileName -> assertWithDefaultConfiguration(assertions, configFileName));\n+  }\n+\n+  private void assertWithDefaultConfiguration(", "originalCommit": "a5b44cf930b9ad543b776d044a97b93891bd5067", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a8c53c9b484a45e704c9fb6a2981d861648da8e0", "url": "https://github.com/camunda-cloud/zeebe/commit/a8c53c9b484a45e704c9fb6a2981d861648da8e0", "message": "chore(broker): ignore debug log exporter if false", "committedDate": "2020-11-30T16:42:19Z", "type": "forcePushed"}, {"oid": "5421d5be487fa5d78b6992fe29036b890c5be6e8", "url": "https://github.com/camunda-cloud/zeebe/commit/5421d5be487fa5d78b6992fe29036b890c5be6e8", "message": "chore(broker): ignore debug log exporter if false", "committedDate": "2020-11-30T16:51:11Z", "type": "commit"}, {"oid": "5421d5be487fa5d78b6992fe29036b890c5be6e8", "url": "https://github.com/camunda-cloud/zeebe/commit/5421d5be487fa5d78b6992fe29036b890c5be6e8", "message": "chore(broker): ignore debug log exporter if false", "committedDate": "2020-11-30T16:51:11Z", "type": "forcePushed"}]}