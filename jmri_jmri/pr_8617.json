{"pr_number": 8617, "pr_title": "fix: prevent CME while running tasks when stopping", "pr_author": "rhwood", "pr_createdAt": "2020-05-31T22:36:14Z", "pr_url": "https://github.com/JMRI/JMRI/pull/8617", "timeline": [{"oid": "2525eff404e8d3a948789f71b0f8c5a882ae3d34", "url": "https://github.com/JMRI/JMRI/commit/2525eff404e8d3a948789f71b0f8c5a882ae3d34", "message": "fix: prevent CME while running tasks when stopping\n\nFixes #8616", "committedDate": "2020-05-31T22:35:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk5NTg3NQ==", "url": "https://github.com/JMRI/JMRI/pull/8617#discussion_r432995875", "body": "There is a lot going on on these lines and I find it difficult to read. A suggestion is to change it to:\r\n\r\n```\r\nCollection<? extends Task> c = new HashSet<>(runnables).stream()\r\n        .map(task -> RP.post(task, 0, Thread.currentThread().getPriority()))\r\n        .collect(Collectors.toSet());\r\nif (!runnables.isEmpty() && !new ProxyTask(c).waitFinished(timeout)) {\r\n```", "bodyText": "There is a lot going on on these lines and I find it difficult to read. A suggestion is to change it to:\nCollection<? extends Task> c = new HashSet<>(runnables).stream()\n        .map(task -> RP.post(task, 0, Thread.currentThread().getPriority()))\n        .collect(Collectors.toSet());\nif (!runnables.isEmpty() && !new ProxyTask(c).waitFinished(timeout)) {", "bodyHTML": "<p dir=\"auto\">There is a lot going on on these lines and I find it difficult to read. A suggestion is to change it to:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Collection&lt;? extends Task&gt; c = new HashSet&lt;&gt;(runnables).stream()\n        .map(task -&gt; RP.post(task, 0, Thread.currentThread().getPriority()))\n        .collect(Collectors.toSet());\nif (!runnables.isEmpty() &amp;&amp; !new ProxyTask(c).waitFinished(timeout)) {\"><pre><code>Collection&lt;? extends Task&gt; c = new HashSet&lt;&gt;(runnables).stream()\n        .map(task -&gt; RP.post(task, 0, Thread.currentThread().getPriority()))\n        .collect(Collectors.toSet());\nif (!runnables.isEmpty() &amp;&amp; !new ProxyTask(c).waitFinished(timeout)) {\n</code></pre></div>", "author": "danielb987", "createdAt": "2020-05-31T23:35:38Z", "path": "java/src/jmri/managers/DefaultShutDownManager.java", "diffHunk": "@@ -247,7 +247,7 @@ protected boolean shutdown(int status, boolean exit) {\n             log.debug(\"windows completed closing {} milliseconds after starting shutdown\", new Date().getTime() - start.getTime());\n             // wait for parallel tasks to complete\n             try {\n-                if (!runnables.isEmpty() && !new ProxyTask(runnables.stream()\n+                if (!runnables.isEmpty() && !new ProxyTask(new HashSet<>(runnables).stream()\n                         .map(task -> RP.post(task, 0, Thread.currentThread().getPriority()))\n                         .collect(Collectors.toSet()))\n                                 .waitFinished(timeout)) {", "originalCommit": "2525eff404e8d3a948789f71b0f8c5a882ae3d34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}