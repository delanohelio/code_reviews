{"pr_number": 13907, "pr_title": "[FLINK-19942][Connectors / JDBC]Support sink parallelism configuration to JDBC connector", "pr_author": "zhuxiaoshang", "pr_createdAt": "2020-11-03T12:37:07Z", "pr_url": "https://github.com/apache/flink/pull/13907", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2OTQ3MQ==", "url": "https://github.com/apache/flink/pull/13907#discussion_r535869471", "body": "does the equals and hash function need to be modify? @zhuxiaoshang ", "bodyText": "does the equals and hash function need to be modify? @zhuxiaoshang", "bodyHTML": "<p dir=\"auto\">does the equals and hash function need to be modify? <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/zhuxiaoshang/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zhuxiaoshang\">@zhuxiaoshang</a></p>", "author": "zhisheng17", "createdAt": "2020-12-04T06:37:10Z", "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/JdbcExecutionOptions.java", "diffHunk": "@@ -55,6 +61,10 @@ public int getMaxRetries() {\n \t\treturn maxRetries;\n \t}\n \n+\tpublic Integer getParallelism() {\n+\t\treturn parallelism;\n+\t}\n+\n \t@Override\n \tpublic boolean equals(Object o) {\n \t\tif (this == o) {", "originalCommit": "49181d26aa6a07bc289544ad0d55929fd2c89377", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzMzM5Nw==", "url": "https://github.com/apache/flink/pull/13907#discussion_r539033397", "bodyText": "Yes you are right @zhisheng17 ,I ignored.", "author": "zhuxiaoshang", "createdAt": "2020-12-09T06:03:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg2OTQ3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzNzAxMw==", "url": "https://github.com/apache/flink/pull/13907#discussion_r539037013", "body": "Will return false when parallelism > 128?", "bodyText": "Will return false when parallelism > 128?", "bodyHTML": "<p dir=\"auto\">Will return false when parallelism &gt; 128?</p>", "author": "V1ncentzzZ", "createdAt": "2020-12-09T06:13:37Z", "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/JdbcExecutionOptions.java", "diffHunk": "@@ -66,12 +76,13 @@ public boolean equals(Object o) {\n \t\tJdbcExecutionOptions that = (JdbcExecutionOptions) o;\n \t\treturn batchIntervalMs == that.batchIntervalMs &&\n \t\t\tbatchSize == that.batchSize &&\n-\t\t\tmaxRetries == that.maxRetries;\n+\t\t\tmaxRetries == that.maxRetries &&\n+\t\t\tparallelism == that.parallelism;", "originalCommit": "f4f1cf14d4d413c4c87881516215c7ffffd5be64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzOTkzNg==", "url": "https://github.com/apache/flink/pull/13907#discussion_r539039936", "bodyText": "Maybe the framework will check whether the parallelism > max parallelism limit.\nMoreover where do you get the 128?IIRC,128 is the limit of max keyGroup.", "author": "zhuxiaoshang", "createdAt": "2020-12-09T06:21:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzNzAxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA0MjY5OA==", "url": "https://github.com/apache/flink/pull/13907#discussion_r539042698", "bodyText": "My suggestion is that use equals() instead of == beacause of the == will return false when parallelism's value more than 128.", "author": "V1ncentzzZ", "createdAt": "2020-12-09T06:28:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzNzAxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA0MzM0MQ==", "url": "https://github.com/apache/flink/pull/13907#discussion_r539043341", "bodyText": "ok,I have changed it.", "author": "zhuxiaoshang", "createdAt": "2020-12-09T06:29:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzNzAxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzODc4Ng==", "url": "https://github.com/apache/flink/pull/13907#discussion_r539038786", "body": "@zhuxiaoshang maybe, idea will recommend to use `equals()` instead of `==`", "bodyText": "@zhuxiaoshang maybe, idea will recommend to use equals() instead of ==", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/zhuxiaoshang/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zhuxiaoshang\">@zhuxiaoshang</a> maybe, idea will recommend to use <code>equals()</code> instead of <code>==</code></p>", "author": "zhisheng17", "createdAt": "2020-12-09T06:18:25Z", "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/JdbcExecutionOptions.java", "diffHunk": "@@ -66,12 +76,13 @@ public boolean equals(Object o) {\n \t\tJdbcExecutionOptions that = (JdbcExecutionOptions) o;\n \t\treturn batchIntervalMs == that.batchIntervalMs &&\n \t\t\tbatchSize == that.batchSize &&\n-\t\t\tmaxRetries == that.maxRetries;\n+\t\t\tmaxRetries == that.maxRetries &&\n+\t\t\tparallelism == that.parallelism;", "originalCommit": "f4f1cf14d4d413c4c87881516215c7ffffd5be64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA4ODQ2Mg==", "url": "https://github.com/apache/flink/pull/13907#discussion_r539088462", "body": "It's seem this method is useless now? If no one uses it, please delete it. Otherwise, we can just treat this method as\r\n`of(outputFormat, null)`", "bodyText": "It's seem this method is useless now? If no one uses it, please delete it. Otherwise, we can just treat this method as\nof(outputFormat, null)", "bodyHTML": "<p dir=\"auto\">It's seem this method is useless now? If no one uses it, please delete it. Otherwise, we can just treat this method as<br>\n<code>of(outputFormat, null)</code></p>", "author": "fsk119", "createdAt": "2020-12-09T08:06:09Z", "path": "flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/sink/OutputFormatProvider.java", "diffHunk": "@@ -36,6 +38,23 @@ static OutputFormatProvider of(OutputFormat<RowData> outputFormat) {\n \t\treturn () -> outputFormat;", "originalCommit": "a20a54634b452b7a9fbc28e3a292196376602b3f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5ba8c4410ef2616561f46462d1000056949e8c6b", "url": "https://github.com/apache/flink/commit/5ba8c4410ef2616561f46462d1000056949e8c6b", "message": "[FLINK-19942][Connectors / JDBC]Support sink parallelism configuration to JDBC connector", "committedDate": "2020-12-09T09:19:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1NDEzNg==", "url": "https://github.com/apache/flink/pull/13907#discussion_r540754136", "body": "This is a public API. Please add a new method instead of changing the existing one, otherwise, it's not API compatible. ", "bodyText": "This is a public API. Please add a new method instead of changing the existing one, otherwise, it's not API compatible.", "bodyHTML": "<p dir=\"auto\">This is a public API. Please add a new method instead of changing the existing one, otherwise, it's not API compatible.</p>", "author": "wuchong", "createdAt": "2020-12-11T07:53:48Z", "path": "flink-table/flink-table-common/src/main/java/org/apache/flink/table/connector/sink/OutputFormatProvider.java", "diffHunk": "@@ -23,17 +23,29 @@\n import org.apache.flink.table.connector.ParallelismProvider;\n import org.apache.flink.table.data.RowData;\n \n+import java.util.Optional;\n+\n /**\n  * Provider of an {@link OutputFormat} instance as a runtime implementation for {@link DynamicTableSink}.\n  */\n @PublicEvolving\n public interface OutputFormatProvider extends DynamicTableSink.SinkRuntimeProvider, ParallelismProvider {\n \n \t/**\n-\t * Helper method for creating a static provider.\n+\t * Helper method for creating a static provider with a provided sink parallelism.\n \t */\n-\tstatic OutputFormatProvider of(OutputFormat<RowData> outputFormat) {\n-\t\treturn () -> outputFormat;\n+\tstatic OutputFormatProvider of(OutputFormat<RowData> outputFormat, Integer sinkParallelism) {", "originalCommit": "5ba8c4410ef2616561f46462d1000056949e8c6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc4ODg1Nw==", "url": "https://github.com/apache/flink/pull/13907#discussion_r540788857", "bodyText": "According to  @fsk119 's suggestion,I removed the old method because it is never used.\nIf not i can get it back.", "author": "zhuxiaoshang", "createdAt": "2020-12-11T08:57:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1NDEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgwNDMyNA==", "url": "https://github.com/apache/flink/pull/13907#discussion_r540804324", "bodyText": "This is a public API. We don't know whether it is used by external projects.", "author": "wuchong", "createdAt": "2020-12-11T09:22:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1NDEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDgxMTQ0OA==", "url": "https://github.com/apache/flink/pull/13907#discussion_r540811448", "bodyText": "ok\uff0cgot it", "author": "zhuxiaoshang", "createdAt": "2020-12-11T09:33:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1NDEzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1OTE0Nw==", "url": "https://github.com/apache/flink/pull/13907#discussion_r540759147", "body": "I'm not sure about adding this to `JdbcExecutionOptions`, because `JdbcExecutionOptions` is an public API for `JdbcSink`. For `JdbcSink#sink`, this may looks weird because the configured parallelism doesn't work as the returned object is `SinkFunction`.\r\n\r\nAnother option is adding the parallelism to `JdbcDmlOption` or `JdbcOption`, they are both internal class. ", "bodyText": "I'm not sure about adding this to JdbcExecutionOptions, because JdbcExecutionOptions is an public API for JdbcSink. For JdbcSink#sink, this may looks weird because the configured parallelism doesn't work as the returned object is SinkFunction.\nAnother option is adding the parallelism to JdbcDmlOption or JdbcOption, they are both internal class.", "bodyHTML": "<p dir=\"auto\">I'm not sure about adding this to <code>JdbcExecutionOptions</code>, because <code>JdbcExecutionOptions</code> is an public API for <code>JdbcSink</code>. For <code>JdbcSink#sink</code>, this may looks weird because the configured parallelism doesn't work as the returned object is <code>SinkFunction</code>.</p>\n<p dir=\"auto\">Another option is adding the parallelism to <code>JdbcDmlOption</code> or <code>JdbcOption</code>, they are both internal class.</p>", "author": "wuchong", "createdAt": "2020-12-11T08:04:16Z", "path": "flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/JdbcExecutionOptions.java", "diffHunk": "@@ -35,12 +35,18 @@\n \tprivate final long batchIntervalMs;\n \tprivate final int batchSize;\n \tprivate final int maxRetries;\n+\tprivate final Integer parallelism;\n \n-\tprivate JdbcExecutionOptions(long batchIntervalMs, int batchSize, int maxRetries) {\n+\tprivate JdbcExecutionOptions(\n+\t\t\tlong batchIntervalMs,\n+\t\t\tint batchSize,\n+\t\t\tint maxRetries,\n+\t\t\tInteger parallelism) {", "originalCommit": "5ba8c4410ef2616561f46462d1000056949e8c6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9341091a00aaf73556b7e6c5f9bc319a9512dd5a", "url": "https://github.com/apache/flink/commit/9341091a00aaf73556b7e6c5f9bc319a9512dd5a", "message": "[FLINK-19942][jdbc] Support sink parallelism configuration for JDBC connector\n\nThis closes #13907", "committedDate": "2020-12-21T03:06:24Z", "type": "commit"}, {"oid": "9341091a00aaf73556b7e6c5f9bc319a9512dd5a", "url": "https://github.com/apache/flink/commit/9341091a00aaf73556b7e6c5f9bc319a9512dd5a", "message": "[FLINK-19942][jdbc] Support sink parallelism configuration for JDBC connector\n\nThis closes #13907", "committedDate": "2020-12-21T03:06:24Z", "type": "forcePushed"}]}