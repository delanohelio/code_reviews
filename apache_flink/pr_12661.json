{"pr_number": 12661, "pr_title": "[FLINK-18299][json] Add option in json format to parse timestamp in different format standard", "pr_author": "fsk119", "pr_createdAt": "2020-06-15T15:03:38Z", "pr_url": "https://github.com/apache/flink/pull/12661", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc3NzI4Ng==", "url": "https://github.com/apache/flink/pull/12661#discussion_r440777286", "body": "You can make the timestampFormat as optional to avoid invoke it for every TestSpec. ", "bodyText": "You can make the timestampFormat as optional to avoid invoke it for every TestSpec.", "bodyHTML": "<p dir=\"auto\">You can make the timestampFormat as optional to avoid invoke it for every TestSpec.</p>", "author": "wuchong", "createdAt": "2020-06-16T11:24:10Z", "path": "flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/JsonRowDataSerDeSchemaTest.java", "diffHunk": "@@ -383,73 +407,117 @@ private void testParseErrors(TestSpec spec) throws Exception {\n \t\tTestSpec\n \t\t\t.json(\"{\\\"id\\\": \\\"trueA\\\"}\")\n \t\t\t.rowType(ROW(FIELD(\"id\", BOOLEAN())))\n+\t\t\t.timestampFormat(\"ISO-8601\")", "originalCommit": "9994520727018f9f9583ce9b91d221c69346f0d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzMjk2Mg==", "url": "https://github.com/apache/flink/pull/12661#discussion_r440832962", "bodyText": "Thanks Jark's help. I have already fixed this.", "author": "fsk119", "createdAt": "2020-06-16T13:05:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc3NzI4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc5Mjg3Mg==", "url": "https://github.com/apache/flink/pull/12661#discussion_r440792872", "body": "TimestampFormat.ISO_8601", "bodyText": "TimestampFormat.ISO_8601", "bodyHTML": "<p dir=\"auto\">TimestampFormat.ISO_8601</p>", "author": "wuchong", "createdAt": "2020-06-16T11:55:35Z", "path": "flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/JsonRowDataSerDeSchemaTest.java", "diffHunk": "@@ -168,7 +168,7 @@ public void testSerDe() throws Exception {\n \t\tassertEquals(expected, actual);\n \n \t\t// test serialization\n-\t\tJsonRowDataSerializationSchema serializationSchema = new JsonRowDataSerializationSchema(schema);\n+\t\tJsonRowDataSerializationSchema serializationSchema = new JsonRowDataSerializationSchema(schema,  JsonOptions.getTimestampFormatOption(\"ISO-8601\"));", "originalCommit": "9994520727018f9f9583ce9b91d221c69346f0d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc5MzMxNw==", "url": "https://github.com/apache/flink/pull/12661#discussion_r440793317", "body": "```suggestion\r\n\t\tthrown.expect(containsCause(new ValidationException(\"Unsupported value 'test' for timestamp-format.standard. Supported values are [SQL, ISO-8601].\")));\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tthrown.expect(containsCause(new ValidationException(\"Unsupported value test for timestamp-format.standard. Supported values are [SQL, ISO-8601].\")));\n          \n          \n            \n            \t\tthrown.expect(containsCause(new ValidationException(\"Unsupported value 'test' for timestamp-format.standard. Supported values are [SQL, ISO-8601].\")));", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\tthrown<span class=\"pl-k\">.</span>expect(containsCause(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">ValidationException</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unsupported value test for timestamp-format.standard. Supported values are [SQL, ISO-8601].<span class=\"pl-pds\">\"</span></span>)));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\tthrown<span class=\"pl-k\">.</span>expect(containsCause(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">ValidationException</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unsupported value <span class=\"x x-first x-last\">'</span>test<span class=\"x x-first x-last\">'</span> for timestamp-format.standard. Supported values are [SQL, ISO-8601].<span class=\"pl-pds\">\"</span></span>)));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "wuchong", "createdAt": "2020-06-16T11:56:21Z", "path": "flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/JsonFormatFactoryTest.java", "diffHunk": "@@ -91,6 +91,16 @@ public void testInvalidOptionForIgnoreParseErrors() {\n \t\ttestSchemaDeserializationSchema(tableOptions);\n \t}\n \n+\t@Test\n+\tpublic void testInvalidOptionForTimestampFormat() {\n+\t\tfinal Map<String, String> tableOptions = getModifyOptions(\n+\t\t\toptions -> options.put(\"json.timestamp-format.standard\", \"test\"));\n+\n+\t\tthrown.expect(ValidationException.class);\n+\t\tthrown.expect(containsCause(new ValidationException(\"Unsupported value test for timestamp-format.standard. Supported values are [SQL, ISO-8601].\")));", "originalCommit": "9994520727018f9f9583ce9b91d221c69346f0d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzMzQwNg==", "url": "https://github.com/apache/flink/pull/12661#discussion_r440833406", "bodyText": "I have already replaced this.", "author": "fsk119", "createdAt": "2020-06-16T13:05:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc5MzMxNw=="}], "type": "inlineReview"}, {"oid": "af50f547204f12002cc8ab146058b8c00aa454ab", "url": "https://github.com/apache/flink/commit/af50f547204f12002cc8ab146058b8c00aa454ab", "message": "delete wrong annotation.", "committedDate": "2020-06-17T01:53:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MDc4OQ==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441250789", "body": "Put this exception in the `default` branch of swith. ", "bodyText": "Put this exception in the default branch of swith.", "bodyHTML": "<p dir=\"auto\">Put this exception in the <code>default</code> branch of swith.</p>", "author": "wuchong", "createdAt": "2020-06-17T02:51:28Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonOptions.java", "diffHunk": "@@ -38,4 +44,40 @@\n \t\t\t.defaultValue(false)\n \t\t\t.withDescription(\"Optional flag to skip fields and rows with parse errors instead of failing;\\n\"\n \t\t\t\t\t+ \"fields are set to null in case of errors, false by default\");\n+\n+\tpublic static final ConfigOption<String> TIMESTAMP_FORMAT = ConfigOptions\n+\t\t\t.key(\"timestamp-format.standard\")\n+\t\t\t.stringType()\n+\t\t\t.defaultValue(\"SQL\")\n+\t\t\t.withDescription(\"Optional flag to specify timestamp format, SQL by default.\" +\n+\t\t\t\t\" Option ISO-8601 will parse input timestamp in \\\"yyyy-MM-ddTHH:mm:ss.s{precision}\\\" format and output timestamp in the same format.\" +\n+\t\t\t\t\" Option SQL will parse input timestamp in \\\"yyyy-MM-dd HH:mm:ss.s{precision}\\\" format and output timestamp in the same format.\");\n+\n+\t// --------------------------------------------------------------------------------------------\n+\t// Option enumerations\n+\t// --------------------------------------------------------------------------------------------\n+\n+\tpublic static final String SQL = \"SQL\";\n+\tpublic static final String ISO_8601 = \"ISO-8601\";\n+\n+\tpublic static final Set<String> TIMESTAMP_FORMAT_ENUM = new HashSet<>(Arrays.asList(\n+\t\tSQL,\n+\t\tISO_8601\n+\t));\n+\n+\t// --------------------------------------------------------------------------------------------\n+\t// Utilities\n+\t// --------------------------------------------------------------------------------------------\n+\n+\tpublic static TimestampFormat getTimestampFormat(ReadableConfig config){\n+\t\tString timestampFormat = config.get(TIMESTAMP_FORMAT);\n+\t\tswitch (timestampFormat){\n+\t\t\tcase SQL:\n+\t\t\t\treturn TimestampFormat.SQL;\n+\t\t\tcase ISO_8601:\n+\t\t\t\treturn TimestampFormat.ISO_8601;\n+\t\t}\n+\t\tthrow new TableException(", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTMxNTkwOA==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441315908", "bodyText": "OK. I have fixed it.", "author": "fsk119", "createdAt": "2020-06-17T06:45:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MDc4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MTYyNg==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441251626", "body": "Keep the original indent. ", "bodyText": "Keep the original indent.", "bodyHTML": "<p dir=\"auto\">Keep the original indent.</p>", "author": "wuchong", "createdAt": "2020-06-17T02:54:58Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/canal/CanalJsonDeserializationSchema.java", "diffHunk": "@@ -68,9 +69,10 @@\n \tprivate final int fieldCount;\n \n \tpublic CanalJsonDeserializationSchema(\n-\t\t\tRowType rowType,\n-\t\t\tTypeInformation<RowData> resultTypeInfo,\n-\t\t\tboolean ignoreParseErrors) {\n+\t\tRowType rowType,\n+\t\tTypeInformation<RowData> resultTypeInfo,\n+\t\tboolean ignoreParseErrors,\n+\t\tTimestampFormat timestampFormatOption) {", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MTg0Ng==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441251846", "body": "Add this into `optionalOptions()`.", "bodyText": "Add this into optionalOptions().", "bodyHTML": "<p dir=\"auto\">Add this into <code>optionalOptions()</code>.</p>", "author": "wuchong", "createdAt": "2020-06-17T02:55:49Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/debezium/DebeziumJsonFormatFactory.java", "diffHunk": "@@ -57,12 +59,9 @@\n \t\t\t\"This option indicates the Debezium JSON data include the schema in the message or not. \" +\n \t\t\t\"Default is false.\");\n \n-\tpublic static final ConfigOption<Boolean> IGNORE_PARSE_ERRORS = ConfigOptions\n-\t\t.key(\"ignore-parse-errors\")\n-\t\t.booleanType()\n-\t\t.defaultValue(false)\n-\t\t.withDescription(\"Optional flag to skip fields and rows with parse errors instead of failing, \" +\n-\t\t\t\"fields are set to null in case of errors. Default is false.\");\n+\tpublic static final ConfigOption<Boolean> IGNORE_PARSE_ERRORS = JsonOptions.IGNORE_PARSE_ERRORS;\n+\n+\tpublic static final ConfigOption<String> TIMESTAMP_FORMAT = JsonOptions.TIMESTAMP_FORMAT;", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MTg2NQ==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441251865", "body": "Add this into `optionalOptions()`.", "bodyText": "Add this into optionalOptions().", "bodyHTML": "<p dir=\"auto\">Add this into <code>optionalOptions()</code>.</p>", "author": "wuchong", "createdAt": "2020-06-17T02:55:54Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/canal/CanalJsonFormatFactory.java", "diffHunk": "@@ -48,12 +49,9 @@\n \n \tpublic static final String IDENTIFIER = \"canal-json\";\n \n-\tpublic static final ConfigOption<Boolean> IGNORE_PARSE_ERRORS = ConfigOptions\n-\t\t.key(\"ignore-parse-errors\")\n-\t\t.booleanType()\n-\t\t.defaultValue(false)\n-\t\t.withDescription(\"Optional flag to skip fields and rows with parse errors instead of failing, \" +\n-\t\t\t\"fields are set to null in case of errors. Default is false.\");\n+\tpublic static final ConfigOption<Boolean> IGNORE_PARSE_ERRORS = JsonOptions.IGNORE_PARSE_ERRORS;\n+\n+\tpublic static final ConfigOption<String> TIMESTAMP_FORMAT = JsonOptions.TIMESTAMP_FORMAT;", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MTk5Mg==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441251992", "body": "Keep the original indent.\r\n\r\n", "bodyText": "Keep the original indent.", "bodyHTML": "<p dir=\"auto\">Keep the original indent.</p>", "author": "wuchong", "createdAt": "2020-06-17T02:56:22Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/debezium/DebeziumJsonDeserializationSchema.java", "diffHunk": "@@ -75,10 +76,11 @@\n \tprivate final boolean ignoreParseErrors;\n \n \tpublic DebeziumJsonDeserializationSchema(\n-\t\t\tRowType rowType,\n-\t\t\tTypeInformation<RowData> resultTypeInfo,\n-\t\t\tboolean schemaInclude,\n-\t\t\tboolean ignoreParseErrors) {\n+\t\tRowType rowType,\n+\t\tTypeInformation<RowData> resultTypeInfo,\n+\t\tboolean schemaInclude,\n+\t\tboolean ignoreParseErrors,\n+\t\tTimestampFormat timestampFormatOption) {", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MjMxNQ==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441252315", "body": "Add `TIMESTAMP_FORMAT` into `optionalOptions`.", "bodyText": "Add TIMESTAMP_FORMAT into optionalOptions.", "bodyHTML": "<p dir=\"auto\">Add <code>TIMESTAMP_FORMAT</code> into <code>optionalOptions</code>.</p>", "author": "wuchong", "createdAt": "2020-06-17T02:57:32Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonFileSystemFormatFactory.java", "diffHunk": "@@ -79,13 +79,15 @@ public String factoryIdentifier() {\n \t\tvalidateFormatOptions(options);\n \t\tboolean failOnMissingField = options.get(FAIL_ON_MISSING_FIELD);\n \t\tboolean ignoreParseErrors = options.get(IGNORE_PARSE_ERRORS);\n+\t\tTimestampFormat timestampOption = JsonOptions.getTimestampFormat(options);", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MzA0Mg==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441253042", "body": "```suggestion\r\n\t/** Timestamp format specification which is used to parse timestamp. */\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t/** Options for timestamp format. */\n          \n          \n            \n            \t/** Timestamp format specification which is used to parse timestamp. */", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t<span class=\"pl-c\"><span class=\"pl-c\">/*</span>* <span class=\"x x-first x-last\">Options for timestamp format</span>. <span class=\"pl-c\">*/</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t<span class=\"pl-c\"><span class=\"pl-c\">/*</span>* <span class=\"x x-first x-last\">Timestamp format specification which is used to parse timestamp</span>. <span class=\"pl-c\">*/</span></span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "wuchong", "createdAt": "2020-06-17T03:00:26Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowDataDeserializationSchema.java", "diffHunk": "@@ -93,11 +94,15 @@\n \t/** Object mapper for parsing the JSON. */\n \tprivate final ObjectMapper objectMapper = new ObjectMapper();\n \n+\t/** Options for timestamp format. */", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MzIyNQ==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441253225", "body": "```suggestion\r\n\t/** Timestamp format specification which is used to generate timestamp. */\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t/** Option for timestamp format. */\n          \n          \n            \n            \t/** Timestamp format specification which is used to generate timestamp. */", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t<span class=\"pl-c\"><span class=\"pl-c\">/*</span>* <span class=\"x x-first x-last\">Option for timestamp format</span>. <span class=\"pl-c\">*/</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t<span class=\"pl-c\"><span class=\"pl-c\">/*</span>* <span class=\"x x-first x-last\">Timestamp format specification which is used to generate timestamp</span>. <span class=\"pl-c\">*/</span></span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "wuchong", "createdAt": "2020-06-17T03:01:04Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowDataSerializationSchema.java", "diffHunk": "@@ -72,8 +74,12 @@\n \t/** Reusable object node. */\n \tprivate transient ObjectNode node;\n \n-\tpublic JsonRowDataSerializationSchema(RowType rowType) {\n+\t/** Option for timestamp format. */", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MzQ3NA==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441253474", "body": "Add this into `equals` and `hashcode`.", "bodyText": "Add this into equals and hashcode.", "bodyHTML": "<p dir=\"auto\">Add this into <code>equals</code> and <code>hashcode</code>.</p>", "author": "wuchong", "createdAt": "2020-06-17T03:02:16Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowDataDeserializationSchema.java", "diffHunk": "@@ -93,11 +94,15 @@\n \t/** Object mapper for parsing the JSON. */\n \tprivate final ObjectMapper objectMapper = new ObjectMapper();\n \n+\t/** Options for timestamp format. */\n+\tprivate final TimestampFormat timestampFormat;", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1MzUwNQ==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441253505", "body": "Add this into `equals` and `hashcode`.", "bodyText": "Add this into equals and hashcode.", "bodyHTML": "<p dir=\"auto\">Add this into <code>equals</code> and <code>hashcode</code>.</p>", "author": "wuchong", "createdAt": "2020-06-17T03:02:24Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowDataSerializationSchema.java", "diffHunk": "@@ -72,8 +74,12 @@\n \t/** Reusable object node. */\n \tprivate transient ObjectNode node;\n \n-\tpublic JsonRowDataSerializationSchema(RowType rowType) {\n+\t/** Option for timestamp format. */\n+\tprivate final TimestampFormat timestampFormat;", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1NDAyNA==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441254024", "body": "Add the timestamp format option into `getAllOptions`.\r\n\r\n```java\r\noptions.put(\"canal-json.timestamp-format.standard\", \"ISO-8081\");\r\n```", "bodyText": "Add the timestamp format option into getAllOptions.\noptions.put(\"canal-json.timestamp-format.standard\", \"ISO-8081\");", "bodyHTML": "<p dir=\"auto\">Add the timestamp format option into <code>getAllOptions</code>.</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"options.put(&quot;canal-json.timestamp-format.standard&quot;, &quot;ISO-8081&quot;);\n\"><pre>options<span class=\"pl-k\">.</span>put(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>canal-json.timestamp-format.standard<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ISO-8081<span class=\"pl-pds\">\"</span></span>);</pre></div>", "author": "wuchong", "createdAt": "2020-06-17T03:04:38Z", "path": "flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/canal/CanalJsonFormatFactoryTest.java", "diffHunk": "@@ -65,7 +66,8 @@ public void testSeDeSchema() {\n \t\tfinal CanalJsonDeserializationSchema expectedDeser = new CanalJsonDeserializationSchema(\n \t\t\tROW_TYPE,\n \t\t\tnew RowDataTypeInfo(ROW_TYPE),\n-\t\t\ttrue);\n+\t\t\ttrue,\n+\t\t\tTimestampFormat.ISO_8601);", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1NDEyMA==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441254120", "body": "Add the timestamp format option into `getAllOptions`.\r\n\r\n```java\r\noptions.put(\"debezium-json.timestamp-format.standard\", \"ISO-8081\");\r\n```", "bodyText": "Add the timestamp format option into getAllOptions.\noptions.put(\"debezium-json.timestamp-format.standard\", \"ISO-8081\");", "bodyHTML": "<p dir=\"auto\">Add the timestamp format option into <code>getAllOptions</code>.</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"options.put(&quot;debezium-json.timestamp-format.standard&quot;, &quot;ISO-8081&quot;);\n\"><pre>options<span class=\"pl-k\">.</span>put(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>debezium-json.timestamp-format.standard<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ISO-8081<span class=\"pl-pds\">\"</span></span>);</pre></div>", "author": "wuchong", "createdAt": "2020-06-17T03:04:58Z", "path": "flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/debezium/DebeziumJsonFormatFactoryTest.java", "diffHunk": "@@ -66,7 +67,8 @@ public void testSeDeSchema() {\n \t\t\tROW_TYPE,\n \t\t\tnew RowDataTypeInfo(ROW_TYPE),\n \t\t\ttrue,\n-\t\t\ttrue);\n+\t\t\ttrue,\n+\t\t\tTimestampFormat.ISO_8601);", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI1NDYwNQ==", "url": "https://github.com/apache/flink/pull/12661#discussion_r441254605", "body": "Add an additional test for lowercase `iso-8081`.", "bodyText": "Add an additional test for lowercase iso-8081.", "bodyHTML": "<p dir=\"auto\">Add an additional test for lowercase <code>iso-8081</code>.</p>", "author": "wuchong", "createdAt": "2020-06-17T03:07:06Z", "path": "flink-formats/flink-json/src/test/java/org/apache/flink/formats/json/JsonFormatFactoryTest.java", "diffHunk": "@@ -91,6 +91,16 @@ public void testInvalidOptionForIgnoreParseErrors() {\n \t\ttestSchemaDeserializationSchema(tableOptions);\n \t}\n \n+\t@Test\n+\tpublic void testInvalidOptionForTimestampFormat() {", "originalCommit": "24897cd0337aeb7292ad7754a5633ab0b09699e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1bcd586302c348e37128936ed2f3e70e755a8531", "url": "https://github.com/apache/flink/commit/1bcd586302c348e37128936ed2f3e70e755a8531", "message": "partial commit", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "151911755ebde2deb31fa691fe27a6d3d5254bcc", "url": "https://github.com/apache/flink/commit/151911755ebde2deb31fa691fe27a6d3d5254bcc", "message": "add `timestamp-format` keyword for json format and add test for new feature.", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "25f6cddb1e673ac581aba3dc11f7d22c658b6ed8", "url": "https://github.com/apache/flink/commit/25f6cddb1e673ac581aba3dc11f7d22c658b6ed8", "message": "add docs and tests.", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "8b76c95e928fefbed375cab5d068374aa97bf2d5", "url": "https://github.com/apache/flink/commit/8b76c95e928fefbed375cab5d068374aa97bf2d5", "message": "rename option name", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "a922887be3db1c756c9680ba51596ded871b8474", "url": "https://github.com/apache/flink/commit/a922887be3db1c756c9680ba51596ded871b8474", "message": "fix bugs", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "88183ac4674542abd15bba64acbf8db532ba3fef", "url": "https://github.com/apache/flink/commit/88183ac4674542abd15bba64acbf8db532ba3fef", "message": "fix elasticsearch test.", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "ed923b1bd70ef11f8d546b6848ba1d4bdfd15b5e", "url": "https://github.com/apache/flink/commit/ed923b1bd70ef11f8d546b6848ba1d4bdfd15b5e", "message": "fix Jark's comment.", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "c5753a529897019d7a5c8ade7fb42c4c4dd48098", "url": "https://github.com/apache/flink/commit/c5753a529897019d7a5c8ade7fb42c4c4dd48098", "message": "fix Jark's comment.", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "dacf0bbe706b3f4b533dba786aa619990280e330", "url": "https://github.com/apache/flink/commit/dacf0bbe706b3f4b533dba786aa619990280e330", "message": "delete wrong annotation.", "committedDate": "2020-06-17T03:28:01Z", "type": "commit"}, {"oid": "f7e54387903999620d752d2019f0f59cb84f6cae", "url": "https://github.com/apache/flink/commit/f7e54387903999620d752d2019f0f59cb84f6cae", "message": "fix bug.", "committedDate": "2020-06-17T03:28:02Z", "type": "commit"}, {"oid": "049b128dd1ba69c6e62ed10059bdd6d2b1cd332c", "url": "https://github.com/apache/flink/commit/049b128dd1ba69c6e62ed10059bdd6d2b1cd332c", "message": "fix Jark's comment.", "committedDate": "2020-06-17T04:18:46Z", "type": "commit"}, {"oid": "7a125b99385dce7471006b4a899e098cb67bf2f9", "url": "https://github.com/apache/flink/commit/7a125b99385dce7471006b4a899e098cb67bf2f9", "message": "add docs and fix SQLClientKafkaITCase", "committedDate": "2020-06-17T06:44:04Z", "type": "commit"}, {"oid": "7a125b99385dce7471006b4a899e098cb67bf2f9", "url": "https://github.com/apache/flink/commit/7a125b99385dce7471006b4a899e098cb67bf2f9", "message": "add docs and fix SQLClientKafkaITCase", "committedDate": "2020-06-17T06:44:04Z", "type": "forcePushed"}, {"oid": "93fe0e9d61a7ef909ca7b613e69d2f5592346ae0", "url": "https://github.com/apache/flink/commit/93fe0e9d61a7ef909ca7b613e69d2f5592346ae0", "message": "add TIMESTAMP_FORMAT into optionalOptions", "committedDate": "2020-06-17T07:05:47Z", "type": "commit"}, {"oid": "6ac891bbb217acf32c455b4d7140c35fb5a2e1e6", "url": "https://github.com/apache/flink/commit/6ac891bbb217acf32c455b4d7140c35fb5a2e1e6", "message": "fix docs", "committedDate": "2020-06-17T07:54:10Z", "type": "commit"}]}