{"pr_number": 13601, "pr_title": "Adding query plan diagnostics context in feed response", "pr_author": "simplynaveen20", "pr_createdAt": "2020-07-29T18:41:53Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13601", "timeline": [{"oid": "f5a992241b4b4ed004550e96679dfbb224fd57ab", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f5a992241b4b4ed004550e96679dfbb224fd57ab", "message": "Adding query plan diagnostics in feed response", "committedDate": "2020-07-29T18:18:54Z", "type": "commit"}, {"oid": "8053ef37f9c8ea7bbacc07a798b8ba1a1bfdb4f2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8053ef37f9c8ea7bbacc07a798b8ba1a1bfdb4f2", "message": "Correcting the start time for query plan diagnotics", "committedDate": "2020-07-29T18:33:04Z", "type": "commit"}, {"oid": "dbd71395351a5dc2a7415478110114bdeea675e2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/dbd71395351a5dc2a7415478110114bdeea675e2", "message": "Merge branch 'latest-master' into users/nakumars/queryPlanInQueryMetrics", "committedDate": "2020-07-29T22:16:48Z", "type": "commit"}, {"oid": "03394fee507c9fa8e3796eee9540d33ef4921944", "url": "https://github.com/Azure/azure-sdk-for-java/commit/03394fee507c9fa8e3796eee9540d33ef4921944", "message": "merging with master", "committedDate": "2020-08-05T15:11:41Z", "type": "commit"}, {"oid": "7472a6ac33d26315dbedee46183891393018eecb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7472a6ac33d26315dbedee46183891393018eecb", "message": "Merge branch 'latest-master' into users/nakumars/queryPlanInQueryMetrics", "committedDate": "2020-08-05T20:04:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2Mjk5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13601#discussion_r466662992", "body": "looks weird to have the tailing space after QueryPlan constant. can we pass the space in the string builder? or define another constant for the \" \" string?", "bodyText": "looks weird to have the tailing space after QueryPlan constant. can we pass the space in the string builder? or define another constant for the \" \" string?", "bodyHTML": "<p dir=\"auto\">looks weird to have the tailing space after QueryPlan constant. can we pass the space in the string builder? or define another constant for the \" \" string?</p>", "author": "moderakh", "createdAt": "2020-08-06T20:19:05Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/FeedResponseDiagnostics.java", "diffHunk": "@@ -4,15 +4,21 @@\n package com.azure.cosmos.implementation;\n \n import com.azure.cosmos.implementation.apachecommons.lang.StringUtils;\n+import com.azure.cosmos.implementation.query.QueryInfo;\n+import com.azure.cosmos.implementation.query.metrics.QueryMetricsTextWriter;\n \n+import java.time.Duration;\n import java.util.Map;\n \n /**\n  * The type Feed response diagnostics.\n  */\n public final class FeedResponseDiagnostics {\n \n+    private final static String EQUALS = \"=\";\n+    private final static String QUERY_PLAN = \"QueryPlan \";", "originalCommit": "7472a6ac33d26315dbedee46183891393018eecb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAxMzgwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13601#discussion_r468013801", "bodyText": "Added another constant. Done", "author": "simplynaveen20", "createdAt": "2020-08-10T16:02:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2Mjk5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2NzA5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13601#discussion_r466667093", "body": "you have a class field with the same name here and this hides the class field.\r\n\r\ncan this be named something like for more clarity in the test? \r\n```suggestion\r\n        CosmosClient testGatewayClient = null;\r\n```", "bodyText": "you have a class field with the same name here and this hides the class field.\ncan this be named something like for more clarity in the test?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    CosmosClient gatewayClient = null;\n          \n          \n            \n                    CosmosClient testGatewayClient = null;", "bodyHTML": "<p dir=\"auto\">you have a class field with the same name here and this hides the class field.</p>\n<p dir=\"auto\">can this be named something like for more clarity in the test?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-smi\">CosmosClient</span> <span class=\"x x-first x-last\">gatewayClient</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">null</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-smi\">CosmosClient</span> <span class=\"x x-first x-last\">testGatewayClient</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">null</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "moderakh", "createdAt": "2020-08-06T20:27:17Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/CosmosDiagnosticsTest.java", "diffHunk": "@@ -76,38 +79,45 @@ public void afterClass() {\n \n     @Test(groups = {\"simple\"})\n     public void gatewayDiagnostics() {\n-        InternalObjectNode internalObjectNode = getInternalObjectNode();\n-        CosmosItemResponse<InternalObjectNode> createResponse = this.container.createItem(internalObjectNode);\n-        String diagnostics = createResponse.getDiagnostics().toString();\n-        assertThat(diagnostics).contains(\"\\\"connectionMode\\\":\\\"GATEWAY\\\"\");\n-        assertThat(diagnostics).doesNotContain((\"\\\"gatewayStatistics\\\":null\"));\n-        assertThat(diagnostics).contains(\"\\\"operationType\\\":\\\"Create\\\"\");\n-        assertThat(diagnostics).contains(\"\\\"metaDataName\\\":\\\"CONTAINER_LOOK_UP\\\"\");\n-        assertThat(diagnostics).contains(\"\\\"serializationType\\\":\\\"PARTITION_KEY_FETCH_SERIALIZATION\\\"\");\n-        assertThat(diagnostics).contains(\"\\\"userAgent\\\":\\\"\" + Utils.getUserAgent() + \"\\\"\");\n-        assertThat(createResponse.getDiagnostics().getDuration()).isNotNull();\n-        validateTransportRequestTimelineGateway(diagnostics);\n-        validateJson(diagnostics);\n+        CosmosClient gatewayClient = null;", "originalCommit": "7472a6ac33d26315dbedee46183891393018eecb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjY2NzMwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13601#discussion_r466667301", "body": "you have a class field with the same name here and this hides the class field.\r\n\r\ncan this be named something like for more clarity in the test? \r\n```suggestion\r\n        CosmosClient testDirectClient = null;\r\n```", "bodyText": "you have a class field with the same name here and this hides the class field.\ncan this be named something like for more clarity in the test?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    CosmosClient directClient = null;\n          \n          \n            \n                    CosmosClient testDirectClient = null;", "bodyHTML": "<p dir=\"auto\">you have a class field with the same name here and this hides the class field.</p>\n<p dir=\"auto\">can this be named something like for more clarity in the test?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-smi\">CosmosClient</span> <span class=\"x x-first x-last\">directClient</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">null</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-smi\">CosmosClient</span> <span class=\"x x-first x-last\">testDirectClient</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">null</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "moderakh", "createdAt": "2020-08-06T20:27:40Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/CosmosDiagnosticsTest.java", "diffHunk": "@@ -145,22 +151,85 @@ public void systemDiagnosticsForSystemStateInformation() {\n \n     @Test(groups = {\"simple\"})\n     public void directDiagnostics() {\n+        CosmosClient directClient = null;", "originalCommit": "7472a6ac33d26315dbedee46183891393018eecb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9428b5dd0b549216bb6b3a749a84039960e52df1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9428b5dd0b549216bb6b3a749a84039960e52df1", "message": "Merge branch 'latest-master' into users/nakumars/queryPlanInQueryMetrics", "committedDate": "2020-08-10T14:15:10Z", "type": "commit"}, {"oid": "a5d936838823225e231432cc5be8c15412f2ec2b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a5d936838823225e231432cc5be8c15412f2ec2b", "message": "resolving comments and merging with master", "committedDate": "2020-08-10T14:53:39Z", "type": "commit"}, {"oid": "07fba2ee5dfc0646c4b0f076eb077f2b23ef6892", "url": "https://github.com/Azure/azure-sdk-for-java/commit/07fba2ee5dfc0646c4b0f076eb077f2b23ef6892", "message": "resolving merge conflict", "committedDate": "2020-08-11T19:14:56Z", "type": "commit"}, {"oid": "779698cd10a9f2b06db2e5d15c0d1c7eb21a8326", "url": "https://github.com/Azure/azure-sdk-for-java/commit/779698cd10a9f2b06db2e5d15c0d1c7eb21a8326", "message": "Fixing build error after merge", "committedDate": "2020-08-11T20:24:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0MzU3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13601#discussion_r468843574", "body": "nice. thank you.", "bodyText": "nice. thank you.", "bodyHTML": "<p dir=\"auto\">nice. thank you.</p>", "author": "moderakh", "createdAt": "2020-08-11T20:25:32Z", "path": "sdk/cosmos/azure-cosmos-encryption/src/main/java/com/azure/cosmos/encryption/EncryptionCosmosAsyncContainer.java", "diffHunk": "@@ -433,7 +433,10 @@ ItemDeserializer getItemDeserializer() {\n                         }\n \n                     ).collectList().map(itemList ->\n-                        ModelBridgeInternal.createFeedResponseWithQueryMetrics(itemList, page.getResponseHeaders(), BridgeInternal.queryMetricsFromFeedResponse(page))\n+                        ModelBridgeInternal.createFeedResponseWithQueryMetrics(itemList,\n+                            page.getResponseHeaders(),\n+                            BridgeInternal.queryMetricsFromFeedResponse(page),\n+                            ModelBridgeInternal.getQueryPlanDiagnosticsContext(page))", "originalCommit": "779698cd10a9f2b06db2e5d15c0d1c7eb21a8326", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8b801644a3df7bc9808b5469a1003435ca4a9160", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8b801644a3df7bc9808b5469a1003435ca4a9160", "message": "Fixing merge conflict", "committedDate": "2020-08-11T21:57:27Z", "type": "commit"}]}