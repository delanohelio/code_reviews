{"pr_number": 3466, "pr_title": "Added Bigtable emulator container support", "pr_author": "saturnism", "pr_createdAt": "2020-11-13T07:12:28Z", "pr_url": "https://github.com/testcontainers/testcontainers-java/pull/3466", "timeline": [{"oid": "047e66f2629b83010d6b61e04ee97571ee8813e3", "url": "https://github.com/testcontainers/testcontainers-java/commit/047e66f2629b83010d6b61e04ee97571ee8813e3", "message": "Added Bigtable emulator container support", "committedDate": "2020-11-13T07:11:37Z", "type": "commit"}, {"oid": "9f1564b217ae77955dd41f68d55032a2f09c4584", "url": "https://github.com/testcontainers/testcontainers-java/commit/9f1564b217ae77955dd41f68d55032a2f09c4584", "message": "changed port to be consistent w/ other emulators", "committedDate": "2020-11-13T07:13:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk2MjE0NA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3466#discussion_r533962144", "body": "given that we have `getHost()` now, do you think we still need this one?", "bodyText": "given that we have getHost() now, do you think we still need this one?", "bodyHTML": "<p dir=\"auto\">given that we have <code>getHost()</code> now, do you think we still need this one?</p>", "author": "bsideup", "createdAt": "2020-12-02T07:57:50Z", "path": "modules/gcloud/src/main/java/org/testcontainers/containers/BigtableEmulatorContainer.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package org.testcontainers.containers;\n+\n+import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n+import org.testcontainers.utility.DockerImageName;\n+\n+/**\n+ * A Bigtable container that relies in google cloud sdk.\n+ *\n+ * Default port is 9000.\n+ *\n+ * @author Edd\u00fa Mel\u00e9ndez\n+ * @author Ray Tsang\n+ */\n+public class BigtableEmulatorContainer extends GenericContainer<BigtableEmulatorContainer> {\n+\n+    private static final DockerImageName DEFAULT_IMAGE_NAME = DockerImageName.parse(\"gcr.io/google.com/cloudsdktool/cloud-sdk\");\n+\n+    private static final String CMD = \"gcloud beta emulators bigtable start --host-port 0.0.0.0:9000\";\n+    private static final int PORT = 9000;\n+\n+    public BigtableEmulatorContainer(final DockerImageName dockerImageName) {\n+        super(dockerImageName);\n+\n+        dockerImageName.assertCompatibleWith(DEFAULT_IMAGE_NAME);\n+\n+        withExposedPorts(PORT);\n+        setWaitStrategy(new LogMessageWaitStrategy()\n+                .withRegEx(\"(?s).*running.*$\"));\n+        withCommand(\"/bin/sh\", \"-c\", CMD);\n+    }\n+\n+    /**\n+     * @return a <code>host:port</code> pair corresponding to the address on which the emulator is\n+     * reachable from the test host machine. Directly usable as a parameter to the\n+     * com.google.cloud.ServiceOptions.Builder#setHost(java.lang.String) method.\n+     */\n+    public String getEmulatorEndpoint() {\n+        return getContainerIpAddress() + \":\" + getMappedPort(PORT);\n+    }\n+\n+    public String getEmulatorHost() {", "originalCommit": "9f1564b217ae77955dd41f68d55032a2f09c4584", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk3OTYxMA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3466#discussion_r533979610", "bodyText": "will remove.", "author": "saturnism", "createdAt": "2020-12-02T08:30:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk2MjE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDYzNzYzOQ==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3466#discussion_r534637639", "bodyText": "removed.", "author": "saturnism", "createdAt": "2020-12-03T03:19:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk2MjE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk2MjIwOA==", "url": "https://github.com/testcontainers/testcontainers-java/pull/3466#discussion_r533962208", "body": "```suggestion\r\n        return getHost() + \":\" + getEmulatorPort();\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return getContainerIpAddress() + \":\" + getMappedPort(PORT);\n          \n          \n            \n                    return getHost() + \":\" + getEmulatorPort();", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">return</span> <span class=\"x x-first x-last\">getContainerIpAddress</span>() <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>:<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> <span class=\"x x-first\">getMappedPort(</span><span class=\"pl-c1 x x-last\">PORT</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">return</span> <span class=\"x x-first x-last\">getHost</span>() <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>:<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> <span class=\"x x-first x-last\">getEmulatorPort(</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bsideup", "createdAt": "2020-12-02T07:57:58Z", "path": "modules/gcloud/src/main/java/org/testcontainers/containers/BigtableEmulatorContainer.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package org.testcontainers.containers;\n+\n+import org.testcontainers.containers.wait.strategy.LogMessageWaitStrategy;\n+import org.testcontainers.utility.DockerImageName;\n+\n+/**\n+ * A Bigtable container that relies in google cloud sdk.\n+ *\n+ * Default port is 9000.\n+ *\n+ * @author Edd\u00fa Mel\u00e9ndez\n+ * @author Ray Tsang\n+ */\n+public class BigtableEmulatorContainer extends GenericContainer<BigtableEmulatorContainer> {\n+\n+    private static final DockerImageName DEFAULT_IMAGE_NAME = DockerImageName.parse(\"gcr.io/google.com/cloudsdktool/cloud-sdk\");\n+\n+    private static final String CMD = \"gcloud beta emulators bigtable start --host-port 0.0.0.0:9000\";\n+    private static final int PORT = 9000;\n+\n+    public BigtableEmulatorContainer(final DockerImageName dockerImageName) {\n+        super(dockerImageName);\n+\n+        dockerImageName.assertCompatibleWith(DEFAULT_IMAGE_NAME);\n+\n+        withExposedPorts(PORT);\n+        setWaitStrategy(new LogMessageWaitStrategy()\n+                .withRegEx(\"(?s).*running.*$\"));\n+        withCommand(\"/bin/sh\", \"-c\", CMD);\n+    }\n+\n+    /**\n+     * @return a <code>host:port</code> pair corresponding to the address on which the emulator is\n+     * reachable from the test host machine. Directly usable as a parameter to the\n+     * com.google.cloud.ServiceOptions.Builder#setHost(java.lang.String) method.\n+     */\n+    public String getEmulatorEndpoint() {\n+        return getContainerIpAddress() + \":\" + getMappedPort(PORT);", "originalCommit": "9f1564b217ae77955dd41f68d55032a2f09c4584", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f667c73b114b962bf5baa7e442a33b4b13301824", "url": "https://github.com/testcontainers/testcontainers-java/commit/f667c73b114b962bf5baa7e442a33b4b13301824", "message": "Update modules/gcloud/src/main/java/org/testcontainers/containers/BigtableEmulatorContainer.java\n\nCo-authored-by: Sergei Egorov <bsideup@gmail.com>", "committedDate": "2020-12-02T08:18:53Z", "type": "commit"}, {"oid": "6345cc669fcc16cb2d9484e554ccc72584e3585b", "url": "https://github.com/testcontainers/testcontainers-java/commit/6345cc669fcc16cb2d9484e554ccc72584e3585b", "message": "Merge remote-tracking branch 'upstream/master' into gcloud-bigtable", "committedDate": "2020-12-02T08:21:07Z", "type": "commit"}, {"oid": "eb8b58a4a78e8570448b78817720eae62ef02ad1", "url": "https://github.com/testcontainers/testcontainers-java/commit/eb8b58a4a78e8570448b78817720eae62ef02ad1", "message": "Removed `getEmulatorHost`", "committedDate": "2020-12-02T08:38:06Z", "type": "commit"}, {"oid": "e34eacd4954848f91f8a4c705f443c867042af77", "url": "https://github.com/testcontainers/testcontainers-java/commit/e34eacd4954848f91f8a4c705f443c867042af77", "message": "Merge branch 'gcloud-bigtable' of github.com:saturnism/testcontainers-java into gcloud-bigtable", "committedDate": "2020-12-03T03:18:19Z", "type": "commit"}]}