{"pr_number": 25242, "pr_title": "Use ListNode for all delimited lists in the parser", "pr_author": "lochana-chathura", "pr_createdAt": "2020-08-12T20:42:17Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25242", "timeline": [{"oid": "72d8e49bb9d68000508b025122d817aa4a259da5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/72d8e49bb9d68000508b025122d817aa4a259da5", "message": "Use NodeList for service listeners", "committedDate": "2020-08-11T10:11:04Z", "type": "commit"}, {"oid": "0f2650f639223fb6ddae28bd7f74ba52bc9cae5f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0f2650f639223fb6ddae28bd7f74ba52bc9cae5f", "message": "Update assertions with service declaration", "committedDate": "2020-08-11T11:55:15Z", "type": "commit"}, {"oid": "4ebf201e1d3787f21da556fd79970126036c2130", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4ebf201e1d3787f21da556fd79970126036c2130", "message": "Use NodeList for function parameters", "committedDate": "2020-08-12T13:35:41Z", "type": "commit"}, {"oid": "2a188f8717bf0140bdf51ebfbe9ce4605ae55d0b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2a188f8717bf0140bdf51ebfbe9ce4605ae55d0b", "message": "Update assertions with function parameters", "committedDate": "2020-08-12T13:49:37Z", "type": "commit"}, {"oid": "b140bc1ba6219bb23dcaa7b0fc1626a6a0df2cfd", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b140bc1ba6219bb23dcaa7b0fc1626a6a0df2cfd", "message": "Use NodeList for import version number", "committedDate": "2020-08-12T19:32:19Z", "type": "commit"}, {"oid": "6d3148c0e87a526a277c2789eff57dbd365824a2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6d3148c0e87a526a277c2789eff57dbd365824a2", "message": "Update assertions with import version number", "committedDate": "2020-08-12T19:39:34Z", "type": "commit"}, {"oid": "400c6aa027a3565e195619781d8ed3ab038d2f83", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/400c6aa027a3565e195619781d8ed3ab038d2f83", "message": "Fix VariableDeclarationNode metadata parsing", "committedDate": "2020-08-12T20:18:28Z", "type": "commit"}, {"oid": "0e89bac6be3681b4ede816e07ab63ce8cb70d5be", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0e89bac6be3681b4ede816e07ab63ce8cb70d5be", "message": "Refactor code", "committedDate": "2020-08-12T20:38:12Z", "type": "commit"}, {"oid": "1aa73265549f45ca8395de84cb6923db33afdfac", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1aa73265549f45ca8395de84cb6923db33afdfac", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fix-delimited-lists", "committedDate": "2020-08-12T21:14:58Z", "type": "commit"}, {"oid": "794ac0d411ea4a2bc2e7768c36a0464d32dac744", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/794ac0d411ea4a2bc2e7768c36a0464d32dac744", "message": "Update FormattingTreeModifier for syntax tree changes", "committedDate": "2020-08-13T06:13:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTcyNzg1Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25242#discussion_r469727853", "body": "Found a bug in TreeModifier.java. https://github.com/ballerina-platform/ballerina-lang/blob/c4f3e100fa1cbd4f003f689ecf90fe560d63689b/compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/TreeModifier.java#L3100-L3101\r\n\r\n* Here we have used `modifyGenericNodeList()` which only iterates through the alternative elements as we are parsing a `SeparatedNodeList` object, not  `NodeList`\r\n\r\n* So when there's no modification that method simply returns the original SeparatedNodeList which is fine. \r\nBut when there's a modification it return SeparatedNodeList which does not contain separators as no processing has been added with `getSeparator()`.\r\n\r\n* Subsequently, when we are formatting and when there's a modification, separators just get vanished. \r\n\r\n@sameerajayasoma @SupunS shall I create an issue for the root cause?", "bodyText": "Found a bug in TreeModifier.java. \n  \n    \n      ballerina-lang/compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/TreeModifier.java\n    \n    \n        Lines 3100 to 3101\n      in\n      c4f3e10\n    \n    \n    \n    \n\n        \n          \n           protected <T extends Node> SeparatedNodeList<T> modifySeparatedNodeList(SeparatedNodeList<T> nodeList) { \n        \n\n        \n          \n               return modifyGenericNodeList(nodeList, SeparatedNodeList::new); \n        \n    \n  \n\n\n\n\nHere we have used modifyGenericNodeList() which only iterates through the alternative elements as we are parsing a SeparatedNodeList object, not  NodeList\n\n\nSo when there's no modification that method simply returns the original SeparatedNodeList which is fine.\nBut when there's a modification it return SeparatedNodeList which does not contain separators as no processing has been added with getSeparator().\n\n\nSubsequently, when we are formatting and when there's a modification, separators just get vanished.\n\n\n@sameerajayasoma @SupunS shall I create an issue for the root cause?", "bodyHTML": "<p dir=\"auto\">Found a bug in TreeModifier.java. <div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/ballerina-platform/ballerina-lang/blob/c4f3e100fa1cbd4f003f689ecf90fe560d63689b/compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/TreeModifier.java#L3100-L3101\">ballerina-lang/compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/syntax/tree/TreeModifier.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 3100 to 3101\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/ballerina-platform/ballerina-lang/commit/c4f3e100fa1cbd4f003f689ecf90fe560d63689b\">c4f3e10</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L3100\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"3100\"></td>\n          <td id=\"LC3100\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">protected</span> <span class=\"pl-k\">&lt;</span><span class=\"pl-smi\">T</span> extends <span class=\"pl-smi\">Node</span><span class=\"pl-k\">&gt;</span> <span class=\"pl-k\">SeparatedNodeList&lt;<span class=\"pl-smi\">T</span>&gt;</span> modifySeparatedNodeList(<span class=\"pl-k\">SeparatedNodeList&lt;<span class=\"pl-smi\">T</span>&gt;</span> nodeList) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3101\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"3101\"></td>\n          <td id=\"LC3101\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> modifyGenericNodeList(nodeList, <span class=\"pl-smi\">SeparatedNodeList</span><span class=\"pl-k\">::</span><span class=\"pl-k\">new</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Here we have used <code>modifyGenericNodeList()</code> which only iterates through the alternative elements as we are parsing a <code>SeparatedNodeList</code> object, not  <code>NodeList</code></p>\n</li>\n<li>\n<p dir=\"auto\">So when there's no modification that method simply returns the original SeparatedNodeList which is fine.<br>\nBut when there's a modification it return SeparatedNodeList which does not contain separators as no processing has been added with <code>getSeparator()</code>.</p>\n</li>\n<li>\n<p dir=\"auto\">Subsequently, when we are formatting and when there's a modification, separators just get vanished.</p>\n</li>\n</ul>\n<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/sameerajayasoma/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/sameerajayasoma\">@sameerajayasoma</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/SupunS/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/SupunS\">@SupunS</a> shall I create an issue for the root cause?</p>", "author": "lochana-chathura", "createdAt": "2020-08-13T06:36:21Z", "path": "misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormattingTreeModifier.java", "diffHunk": "@@ -278,7 +258,7 @@ public FunctionSignatureNode transform(FunctionSignatureNode functionSignatureNo\n         Token openPara = getToken(functionSignatureNode.openParenToken());\n         Token closePara = getToken(functionSignatureNode.closeParenToken());\n \n-        NodeList<ParameterNode> parameters = this.modifyNodeList(functionSignatureNode.parameters());\n+        SeparatedNodeList<ParameterNode> parameters = this.modifySeparatedNodeList(functionSignatureNode.parameters());", "originalCommit": "794ac0d411ea4a2bc2e7768c36a0464d32dac744", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg4NDMyOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25242#discussion_r469884329", "bodyText": "+1. Please create an issue", "author": "SupunS", "createdAt": "2020-08-13T11:30:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTcyNzg1Mw=="}], "type": "inlineReview"}, {"oid": "d136c0fb829ccd82bc5025b53e65122ffeee51df", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d136c0fb829ccd82bc5025b53e65122ffeee51df", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fix-delimited-lists", "committedDate": "2020-08-13T06:53:46Z", "type": "commit"}, {"oid": "1fd03923d6bba4555ce827a1c79d25294bd151ad", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1fd03923d6bba4555ce827a1c79d25294bd151ad", "message": "Update failing assertions and relocate QuotedIdentifierTest", "committedDate": "2020-08-13T07:39:34Z", "type": "commit"}, {"oid": "c8e8c25745ccccc9f98ca9875d689460943da55f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c8e8c25745ccccc9f98ca9875d689460943da55f", "message": "Fix jballerina-unit-test failures due to upstream changes", "committedDate": "2020-08-13T10:26:13Z", "type": "commit"}]}