{"pr_number": 20508, "pr_title": "Move the changes in PR #20241 to 1.1.x", "pr_author": "KavinduZoysa", "pr_createdAt": "2020-01-02T10:03:33Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20508", "timeline": [{"oid": "4dfd0c7714cf09e7d92612e06fa33be534904e46", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4dfd0c7714cf09e7d92612e06fa33be534904e46", "message": "Add generated init function", "committedDate": "2020-01-08T08:01:10Z", "type": "commit"}, {"oid": "4dfd0c7714cf09e7d92612e06fa33be534904e46", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4dfd0c7714cf09e7d92612e06fa33be534904e46", "message": "Add generated init function", "committedDate": "2020-01-08T08:01:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY1MDgzNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20508#discussion_r365650837", "body": "With this change, the initializers are not added to attached functions list. Is that intentional?", "bodyText": "With this change, the initializers are not added to attached functions list. Is that intentional?", "bodyHTML": "<p dir=\"auto\">With this change, the initializers are not added to attached functions list. Is that intentional?</p>", "author": "pubudu91", "createdAt": "2020-01-13T05:28:51Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/BIRPackageSymbolEnter.java", "diffHunk": "@@ -363,10 +363,13 @@ private void defineFunction(DataInputStream dataInStream) throws IOException {\n                 BAttachedFunction attachedFunc =\n                         new BAttachedFunction(names.fromString(funcName), invokableSymbol, funcType);\n                 BStructureTypeSymbol structureTypeSymbol = (BStructureTypeSymbol) attachedType.tsymbol;\n-                structureTypeSymbol.attachedFuncs.add(attachedFunc);\n                 if (Names.USER_DEFINED_INIT_SUFFIX.value.equals(funcName)\n                         || funcName.equals(Names.INIT_FUNCTION_SUFFIX.value)) {\n                     structureTypeSymbol.initializerFunc = attachedFunc;\n+                } else if (funcName.equals(Names.GENERATED_INIT_SUFFIX.value)) {\n+                    ((BObjectTypeSymbol) structureTypeSymbol).generatedInitializerFunc = attachedFunc;\n+                } else {\n+                    structureTypeSymbol.attachedFuncs.add(attachedFunc);", "originalCommit": "4dfd0c7714cf09e7d92612e06fa33be534904e46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY1MjUwNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20508#discussion_r365652505", "bodyText": "Yes, initializers are not added to attached function.", "author": "KavinduZoysa", "createdAt": "2020-01-13T05:43:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY1MDgzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY4NzMwMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20508#discussion_r365687303", "body": "Unused var here. Let's remove this.", "bodyText": "Unused var here. Let's remove this.", "bodyHTML": "<p dir=\"auto\">Unused var here. Let's remove this.</p>", "author": "pubudu91", "createdAt": "2020-01-13T08:39:47Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -348,17 +348,18 @@ private void addAttachedFunctionsToPackageLevel(BLangPackage pkgNode, SymbolEnv\n                     continue;\n                 }\n \n-                if (objectTypeNode.initFunction == null) {\n-                    objectTypeNode.initFunction = createInitFunctionForStructureType(objectTypeNode, env,\n-                                                                                     Names.USER_DEFINED_INIT_SUFFIX);\n-                }\n-\n-                // Add init function to the attached function list\n+                objectTypeNode.generatedInitFunction = createGeneratedInitializerFunction(objectTypeNode, env);\n                 BObjectTypeSymbol objectSymbol = ((BObjectTypeSymbol) objectTypeNode.type.tsymbol);", "originalCommit": "4dfd0c7714cf09e7d92612e06fa33be534904e46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzMwNDY2MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20508#discussion_r367304660", "bodyText": "Removed", "author": "KavinduZoysa", "createdAt": "2020-01-16T09:12:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY4NzMwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY4NzQ4NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20508#discussion_r365687485", "body": "```suggestion\r\n```", "bodyText": "Suggested change", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pubudu91", "createdAt": "2020-01-13T08:40:17Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -367,6 +368,65 @@ private void addAttachedFunctionsToPackageLevel(BLangPackage pkgNode, SymbolEnv\n         }\n     }\n \n+    private BLangFunction createGeneratedInitializerFunction(BLangObjectTypeNode objectTypeNode, SymbolEnv env) {\n+", "originalCommit": "4dfd0c7714cf09e7d92612e06fa33be534904e46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY4NzU5NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20508#discussion_r365687594", "body": "```suggestion\r\n```", "bodyText": "Suggested change", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pubudu91", "createdAt": "2020-01-13T08:40:36Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -367,6 +368,65 @@ private void addAttachedFunctionsToPackageLevel(BLangPackage pkgNode, SymbolEnv\n         }\n     }\n \n+    private BLangFunction createGeneratedInitializerFunction(BLangObjectTypeNode objectTypeNode, SymbolEnv env) {\n+\n+        BLangFunction generatedInitFunc = createInitFunctionForObjectType(objectTypeNode, env);\n+        if (objectTypeNode.initFunction == null) {\n+            return generatedInitFunc;\n+        }\n+\n+        BAttachedFunction initializerFunc = ((BObjectTypeSymbol) objectTypeNode.symbol).initializerFunc;\n+        BAttachedFunction generatedInitializerFunc =\n+                ((BObjectTypeSymbol) objectTypeNode.symbol).generatedInitializerFunc;\n+        addRequiredParamsToGeneratedInitFunction(objectTypeNode.initFunction, generatedInitFunc,\n+                generatedInitializerFunc);\n+        addRestParamsToGeneratedInitFunction(objectTypeNode.initFunction, generatedInitFunc, generatedInitializerFunc);\n+\n+        generatedInitFunc.returnTypeNode = objectTypeNode.initFunction.returnTypeNode;\n+        generatedInitializerFunc.symbol.retType = generatedInitFunc.returnTypeNode.type;\n+\n+        ((BInvokableType) generatedInitFunc.symbol.type).paramTypes = initializerFunc.type.paramTypes;\n+        ((BInvokableType) generatedInitFunc.symbol.type).retType = initializerFunc.type.retType;\n+        ((BInvokableType) generatedInitFunc.symbol.type).restType = initializerFunc.type.restType;\n+\n+        generatedInitializerFunc.type = initializerFunc.type;\n+        generatedInitFunc.desugared = false;\n+        return generatedInitFunc;\n+    }\n+\n+    private void addRequiredParamsToGeneratedInitFunction(BLangFunction initFunction, BLangFunction generatedInitFunc,\n+                                                          BAttachedFunction generatedInitializerFunc) {\n+", "originalCommit": "4dfd0c7714cf09e7d92612e06fa33be534904e46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTY4NzY4NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20508#discussion_r365687685", "body": "```suggestion\r\n```", "bodyText": "Suggested change", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pubudu91", "createdAt": "2020-01-13T08:40:49Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -367,6 +368,65 @@ private void addAttachedFunctionsToPackageLevel(BLangPackage pkgNode, SymbolEnv\n         }\n     }\n \n+    private BLangFunction createGeneratedInitializerFunction(BLangObjectTypeNode objectTypeNode, SymbolEnv env) {\n+\n+        BLangFunction generatedInitFunc = createInitFunctionForObjectType(objectTypeNode, env);\n+        if (objectTypeNode.initFunction == null) {\n+            return generatedInitFunc;\n+        }\n+\n+        BAttachedFunction initializerFunc = ((BObjectTypeSymbol) objectTypeNode.symbol).initializerFunc;\n+        BAttachedFunction generatedInitializerFunc =\n+                ((BObjectTypeSymbol) objectTypeNode.symbol).generatedInitializerFunc;\n+        addRequiredParamsToGeneratedInitFunction(objectTypeNode.initFunction, generatedInitFunc,\n+                generatedInitializerFunc);\n+        addRestParamsToGeneratedInitFunction(objectTypeNode.initFunction, generatedInitFunc, generatedInitializerFunc);\n+\n+        generatedInitFunc.returnTypeNode = objectTypeNode.initFunction.returnTypeNode;\n+        generatedInitializerFunc.symbol.retType = generatedInitFunc.returnTypeNode.type;\n+\n+        ((BInvokableType) generatedInitFunc.symbol.type).paramTypes = initializerFunc.type.paramTypes;\n+        ((BInvokableType) generatedInitFunc.symbol.type).retType = initializerFunc.type.retType;\n+        ((BInvokableType) generatedInitFunc.symbol.type).restType = initializerFunc.type.restType;\n+\n+        generatedInitializerFunc.type = initializerFunc.type;\n+        generatedInitFunc.desugared = false;\n+        return generatedInitFunc;\n+    }\n+\n+    private void addRequiredParamsToGeneratedInitFunction(BLangFunction initFunction, BLangFunction generatedInitFunc,\n+                                                          BAttachedFunction generatedInitializerFunc) {\n+\n+        if (initFunction.requiredParams.isEmpty()) {\n+            return;\n+        }\n+        for (BLangSimpleVariable requiredParameter : initFunction.requiredParams) {\n+            BLangSimpleVariable var =\n+                    ASTBuilderUtil.createVariable(initFunction.pos,\n+                            requiredParameter.name.getValue(), requiredParameter.type, requiredParameter.expr,\n+                            new BVarSymbol(0, names.fromString(requiredParameter.name.getValue()),\n+                                    requiredParameter.symbol.pkgID,\n+                                    requiredParameter.type, requiredParameter.symbol.owner));\n+            generatedInitFunc.requiredParams.add(var);\n+            generatedInitializerFunc.symbol.params.add(var.symbol);\n+        }\n+    }\n+\n+    private void addRestParamsToGeneratedInitFunction(BLangFunction initFunction, BLangFunction generatedInitFunc,\n+                                                      BAttachedFunction generatedInitializerFunc) {\n+", "originalCommit": "4dfd0c7714cf09e7d92612e06fa33be534904e46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "88587a7011ef0906710a5fcd1f8c9304419cd142", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/88587a7011ef0906710a5fcd1f8c9304419cd142", "message": "Change the test cases", "committedDate": "2020-01-16T06:37:36Z", "type": "forcePushed"}, {"oid": "a496e459aa3ec5962d6a6a1208862b3008ffb6e2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a496e459aa3ec5962d6a6a1208862b3008ffb6e2", "message": "Change the test cases", "committedDate": "2020-01-16T07:24:48Z", "type": "commit"}, {"oid": "a496e459aa3ec5962d6a6a1208862b3008ffb6e2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a496e459aa3ec5962d6a6a1208862b3008ffb6e2", "message": "Change the test cases", "committedDate": "2020-01-16T07:24:48Z", "type": "forcePushed"}]}