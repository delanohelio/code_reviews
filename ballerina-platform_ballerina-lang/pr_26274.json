{"pr_number": 26274, "pr_title": "Refactor http filter desugar and Add function to get annotation keys", "pr_author": "chamil321", "pr_createdAt": "2020-10-08T07:21:12Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274", "timeline": [{"oid": "b2d6f3299cb222265c56cc54776ef05771010b47", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b2d6f3299cb222265c56cc54776ef05771010b47", "message": "Remove custom path param annotation and refactor", "committedDate": "2020-10-08T07:15:38Z", "type": "commit"}, {"oid": "0d7129fdc3d4d804fa9d522ed7713c22c0ddc5d5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0d7129fdc3d4d804fa9d522ed7713c22c0ddc5d5", "message": "Add function to get annotation keys", "committedDate": "2020-10-08T07:17:13Z", "type": "commit"}, {"oid": "e69bb3d6524249456a62fdfbecf048da0cacb434", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e69bb3d6524249456a62fdfbecf048da0cacb434", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into v2.0.0-Preview4", "committedDate": "2020-10-12T05:03:05Z", "type": "commit"}, {"oid": "84962484828e7ee6c9f181dd2184995b331967ae", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/84962484828e7ee6c9f181dd2184995b331967ae", "message": "Fix checkstyle failure", "committedDate": "2020-10-12T06:51:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEwOTUwMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274#discussion_r503109501", "body": "Don't we need this anymore?", "bodyText": "Don't we need this anymore?", "bodyHTML": "<p dir=\"auto\">Don't we need this anymore?</p>", "author": "MaryamZi", "createdAt": "2020-10-12T08:03:51Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/ServiceDesugar.java", "diffHunk": "@@ -197,7 +197,8 @@ void engageCustomServiceDesugar(BLangService service, SymbolEnv env) {\n     }\n \n     private void engageCustomResourceDesugar(BLangFunction functionNode, SymbolEnv env) {\n-        httpFiltersDesugar.addHttpFilterStatementsToResource(functionNode, env);\n-        httpFiltersDesugar.addCustomAnnotationToResource(functionNode, env);", "originalCommit": "84962484828e7ee6c9f181dd2184995b331967ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEzNDM4NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274#discussion_r503134385", "bodyText": "Custom Annotation removal is one of the main objectives of the PR", "author": "chamil321", "createdAt": "2020-10-12T08:44:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEwOTUwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExMDE1Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274#discussion_r503110157", "body": "The \"if it is http\" part is no longer relevant, right? Since we do the check before calling this method now?\r\n\r\n```suggestion\r\n     * @param resourceNode The resource to apply filters on\r\n```", "bodyText": "The \"if it is http\" part is no longer relevant, right? Since we do the check before calling this method now?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param resourceNode The resource to apply filter on if it is http\n          \n          \n            \n                 * @param resourceNode The resource to apply filters on", "bodyHTML": "<p dir=\"auto\">The \"if it is http\" part is no longer relevant, right? Since we do the check before calling this method now?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@param</span> resourceNode <span class=\"pl-smi\">The</span> resource to apply <span class=\"x x-first x-last\">filter</span> on<span class=\"x x-first\"> </span><span class=\"pl-k x\">if</span><span class=\"x x-last\"> it is http</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@param</span> resourceNode <span class=\"pl-smi\">The</span> resource to apply <span class=\"x x-first x-last\">filters</span> on</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "MaryamZi", "createdAt": "2020-10-12T08:05:02Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/HttpFiltersDesugar.java", "diffHunk": "@@ -175,7 +146,13 @@ private boolean isHttpResource(BLangFunction resourceNode) {\n                 CALLER_TYPE_NAME.equals(tsymbol.name.value);\n     }\n \n-    private void addFilterStatements(BLangFunction resourceNode, SymbolEnv env) {\n+    /**\n+     * Apply filter statements.\n+     *\n+     * @param resourceNode The resource to apply filter on if it is http", "originalCommit": "84962484828e7ee6c9f181dd2184995b331967ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExMTM0NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274#discussion_r503111345", "body": "Shouldn't the docs for `resourceNode` be updated? Filters are not relevant for this check, right?", "bodyText": "Shouldn't the docs for resourceNode be updated? Filters are not relevant for this check, right?", "bodyHTML": "<p dir=\"auto\">Shouldn't the docs for <code>resourceNode</code> be updated? Filters are not relevant for this check, right?</p>", "author": "MaryamZi", "createdAt": "2020-10-12T08:07:14Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/HttpFiltersDesugar.java", "diffHunk": "@@ -155,18 +132,12 @@ private HttpFiltersDesugar(CompilerContext context) {\n     }\n \n     /**\n-     * Check if the resource is an http resource and apply filter.\n+     * Check if the resource is an http resource.\n      *\n      * @param resourceNode The resource to apply filter on if it is http\n-     * @param env          the symbol environment\n+     * @return true if the resource is an http resource\n      */\n-    void addHttpFilterStatementsToResource(BLangFunction resourceNode, SymbolEnv env) {\n-        if (isHttpResource(resourceNode)) {\n-            addFilterStatements(resourceNode, env);\n-        }\n-    }\n-\n-    private boolean isHttpResource(BLangFunction resourceNode) {\n+    static boolean isHttpResource(BLangFunction resourceNode) {", "originalCommit": "84962484828e7ee6c9f181dd2184995b331967ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExNTM2NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274#discussion_r503115365", "body": "Wondering if we should have a public method in `AnnotatableType` that returns all the annotations, and move this logic to wherever this specific set of keys is needed.\r\n\r\n@Kishanthan, thoughts please?  ", "bodyText": "Wondering if we should have a public method in AnnotatableType that returns all the annotations, and move this logic to wherever this specific set of keys is needed.\n@Kishanthan, thoughts please?", "bodyHTML": "<p dir=\"auto\">Wondering if we should have a public method in <code>AnnotatableType</code> that returns all the annotations, and move this logic to wherever this specific set of keys is needed.</p>\n<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/Kishanthan/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Kishanthan\">@Kishanthan</a>, thoughts please?</p>", "author": "MaryamZi", "createdAt": "2020-10-12T08:14:17Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/types/BFunctionType.java", "diffHunk": "@@ -135,4 +138,14 @@ public String getAnnotationKey() {\n     public boolean isReadOnly() {\n         return true;\n     }\n+\n+    public List<BString> getParamAnnotationKeys() {", "originalCommit": "84962484828e7ee6c9f181dd2184995b331967ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI1NjA2Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274#discussion_r503256062", "bodyText": "At least a method to get all keys would be sufficient (getAnnotationKeys) if you think the function is quite specif.", "author": "chamil321", "createdAt": "2020-10-12T12:18:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExNTM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQwODY2MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274#discussion_r503408660", "bodyText": "Yes, lets add the new method to the AnnotatableType class as it is the common class for all the annotatable types.", "author": "Kishanthan", "createdAt": "2020-10-12T16:32:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExNTM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4MjUxMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26274#discussion_r503482511", "bodyText": "Fixed via 3b23fbf", "author": "chamil321", "createdAt": "2020-10-12T19:08:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzExNTM2NQ=="}], "type": "inlineReview"}, {"oid": "faa2c13a121f5a3d0f086f349fa9140e52a5f1de", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/faa2c13a121f5a3d0f086f349fa9140e52a5f1de", "message": "Refactor code", "committedDate": "2020-10-12T10:10:04Z", "type": "commit"}, {"oid": "3b23fbf942ba32ca2c60b7156fbd394afec5b464", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3b23fbf942ba32ca2c60b7156fbd394afec5b464", "message": "Add function to annotatable type class", "committedDate": "2020-10-12T19:07:19Z", "type": "commit"}]}