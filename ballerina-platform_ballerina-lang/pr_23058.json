{"pr_number": 23058, "pr_title": "Member type infer support and related type checker improvements", "pr_author": "mohanvive", "pr_createdAt": "2020-05-04T06:41:44Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/23058", "timeline": [{"oid": "8e12e83465035b7599658b9f6be8098ee1948312", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8e12e83465035b7599658b9f6be8098ee1948312", "message": "Add improvements to infer table type from record list", "committedDate": "2020-04-30T15:08:03Z", "type": "commit"}, {"oid": "d8afabba3f259590c0b5c1ac05a9c6ea77bb8986", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d8afabba3f259590c0b5c1ac05a9c6ea77bb8986", "message": "Remove redundant test file", "committedDate": "2020-05-02T08:21:32Z", "type": "commit"}, {"oid": "98d24f05533d16d620b72c4fd355c58cb98e46f3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/98d24f05533d16d620b72c4fd355c58cb98e46f3", "message": "Add map constrained table test cases", "committedDate": "2020-05-02T13:13:52Z", "type": "commit"}, {"oid": "10811c777ee3b10bec790b60dd5891fad90a9d4f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/10811c777ee3b10bec790b60dd5891fad90a9d4f", "message": "Add type checker validation for table with map constraint", "committedDate": "2020-05-04T05:38:09Z", "type": "commit"}, {"oid": "c4b848129cfec82bd8fd1d6c3d7b48483b8f854c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c4b848129cfec82bd8fd1d6c3d7b48483b8f854c", "message": "Add negative testcases for member type infer usecase", "committedDate": "2020-05-04T06:28:23Z", "type": "commit"}, {"oid": "393e5cf231671816a878a53f0f4b3b1e26e0faa4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/393e5cf231671816a878a53f0f4b3b1e26e0faa4", "message": "Add minor code refactoring changes", "committedDate": "2020-05-04T06:38:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI3MjI0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23058#discussion_r419272241", "body": "I have these types defined\r\n\r\n```ballerina\r\ntype Person record {\r\n    readonly string name;\r\n    readonly int age;\r\n};\r\n\r\ntype Customer record {\r\n    readonly int id;\r\n    readonly string name;\r\n    string lname;\r\n};\r\n\r\n```\r\nAnd I have this table.\r\n\r\n```ballerina\r\nvar tab = table key(name) [\r\n    { name: \"AAA\", age: 31 },\r\n    { name: \"BBB\", age: 34 },\r\n    { id: 13 , name: \"Foo\", lname: \"QWER\" }\r\n    ];\r\n```\r\n\r\nAccording to the PR table constraint will be one record type with required fields and some optional fields.\r\nBut shouldnt it be `table<Person|Customer>` ?\r\n", "bodyText": "I have these types defined\ntype Person record {\n    readonly string name;\n    readonly int age;\n};\n\ntype Customer record {\n    readonly int id;\n    readonly string name;\n    string lname;\n};\n\nAnd I have this table.\nvar tab = table key(name) [\n    { name: \"AAA\", age: 31 },\n    { name: \"BBB\", age: 34 },\n    { id: 13 , name: \"Foo\", lname: \"QWER\" }\n    ];\nAccording to the PR table constraint will be one record type with required fields and some optional fields.\nBut shouldnt it be table<Person|Customer> ?", "bodyHTML": "<p dir=\"auto\">I have these types defined</p>\n<div class=\"highlight highlight-source-ballerina position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"type Person record {\n    readonly string name;\n    readonly int age;\n};\n\ntype Customer record {\n    readonly int id;\n    readonly string name;\n    string lname;\n};\n\"><pre><span class=\"pl-k\">type</span> <span class=\"pl-en\">Person</span> <span class=\"pl-k\">record</span> {\n    <span class=\"pl-k\">readonly</span> <span class=\"pl-c1\">string</span> name;\n    <span class=\"pl-k\">readonly</span> <span class=\"pl-c1\">int</span> age;\n};\n\n<span class=\"pl-k\">type</span> <span class=\"pl-en\">Customer</span> <span class=\"pl-k\">record</span> {\n    <span class=\"pl-k\">readonly</span> <span class=\"pl-c1\">int</span> id;\n    <span class=\"pl-k\">readonly</span> <span class=\"pl-c1\">string</span> name;\n    <span class=\"pl-c1\">string</span> lname;\n};\n</pre></div>\n<p dir=\"auto\">And I have this table.</p>\n<div class=\"highlight highlight-source-ballerina position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"var tab = table key(name) [\n    { name: &quot;AAA&quot;, age: 31 },\n    { name: &quot;BBB&quot;, age: 34 },\n    { id: 13 , name: &quot;Foo&quot;, lname: &quot;QWER&quot; }\n    ];\"><pre><span class=\"pl-c1\">var</span> tab <span class=\"pl-k\">=</span> <span class=\"pl-k\">table</span> <span class=\"pl-k\">key</span>(<span class=\"pl-v\">name</span>) [\n    { <span class=\"pl-smi\">name</span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>AAA<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">age</span><span class=\"pl-k\">:</span> <span class=\"pl-c1\">31</span> },\n    { <span class=\"pl-smi\">name</span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>BBB<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">age</span><span class=\"pl-k\">:</span> <span class=\"pl-c1\">34</span> },\n    { <span class=\"pl-smi\">id</span><span class=\"pl-k\">:</span> <span class=\"pl-c1\">13</span> , <span class=\"pl-smi\">name</span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Foo<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">lname</span><span class=\"pl-k\">:</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>QWER<span class=\"pl-pds\">\"</span></span> }\n    ];</pre></div>\n<p dir=\"auto\">According to the PR table constraint will be one record type with required fields and some optional fields.<br>\nBut shouldnt it be <code>table&lt;Person|Customer&gt;</code> ?</p>", "author": "gimantha", "createdAt": "2020-05-04T08:08:28Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java", "diffHunk": "@@ -758,8 +774,59 @@ public void visit(BLangTableConstructorExpr tableConstructorExpr) {\n         }\n     }\n \n-    private boolean validateTableType(BTableType tableType, DiagnosticPos pos,\n-                                      List<BLangRecordLiteral> recordLiterals) {\n+    private BType inferTableMemberType(List<BType> memTypes, BLangTableConstructorExpr tableConstructorExpr) {", "originalCommit": "393e5cf231671816a878a53f0f4b3b1e26e0faa4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2541488e22e498f18cc55a9012d35d6e42b51b7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e2541488e22e498f18cc55a9012d35d6e42b51b7", "message": "Enable Anydata testcases with table", "committedDate": "2020-05-04T12:19:24Z", "type": "commit"}]}