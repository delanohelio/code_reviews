{"pr_number": 2225, "pr_title": "Make configureproxy idenpotent when invoked multiple times", "pr_author": "JaroslavTulach", "pr_createdAt": "2020-07-01T03:58:54Z", "pr_url": "https://github.com/apache/netbeans/pull/2225", "merge_commit": "f96a822f957d13ef2735126a7f6b9a80283e3cac", "timeline": [{"oid": "2744059dab68b2081267ce29d0501f13ee29396a", "url": "https://github.com/apache/netbeans/commit/2744059dab68b2081267ce29d0501f13ee29396a", "message": "Make configureproxy idenpotent when invoked multiple times", "committedDate": "2020-06-22T08:04:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEyNzkzOA==", "url": "https://github.com/apache/netbeans/pull/2225#discussion_r448127938", "body": "Isn't `msgs` operated from different threads ? Noticed only now :( ", "bodyText": "Isn't msgs operated from different threads ? Noticed only now :(", "bodyHTML": "<p dir=\"auto\">Isn't <code>msgs</code> operated from different threads ? Noticed only now :(</p>", "author": "sdedic", "createdAt": "2020-07-01T05:45:11Z", "path": "nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java", "diffHunk": "@@ -84,51 +84,21 @@ public void execute() throws BuildException {\n     static URLConnection openConnection(Task task, final URL url, URI[] connectedVia) throws IOException {\n         final URLConnection[] conn = { null };\n         final List<Exception> errs = new CopyOnWriteArrayList<>();\n+        final StringBuilder msgs = new StringBuilder();", "originalCommit": "2744059dab68b2081267ce29d0501f13ee29396a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE4MjY5OQ==", "url": "https://github.com/apache/netbeans/pull/2225#discussion_r448182699", "bodyText": "E.g. it should be StringBuffer, not builder. Right?", "author": "JaroslavTulach", "createdAt": "2020-07-01T07:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEyNzkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE4NzU1NQ==", "url": "https://github.com/apache/netbeans/pull/2225#discussion_r448187555", "bodyText": "Done in 40584ec - if approved, I also merge it to master.\nBtw. the code was ready for being used from multiple threads - see all the msgs.append(\"x' + a + \" y \" + b + \" z\" + c) concatentations that are done in single thread and only then placed into the msgs object. Why did I not used StringBuffer then? I know I wanted...", "author": "JaroslavTulach", "createdAt": "2020-07-01T08:02:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODEyNzkzOA=="}], "type": "inlineReview", "revised_code": {"commit": "40584ecfeb52cfd7f8f5bc619ad97ad968303819", "changed_code": [{"header": "diff --git a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\nindex 4d96452a4a..eb71bb9bab 100644\n--- a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n+++ b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n", "chunk": "@@ -84,7 +82,7 @@ public final class ConfigureProxy extends Task {\n     static URLConnection openConnection(Task task, final URL url, URI[] connectedVia) throws IOException {\n         final URLConnection[] conn = { null };\n         final List<Exception> errs = new CopyOnWriteArrayList<>();\n-        final StringBuilder msgs = new StringBuilder();\n+        final StringBuffer msgs = new StringBuffer();\n         final CountDownLatch connected = new CountDownLatch(1);\n         ExecutorService connectors = Executors.newFixedThreadPool(3);\n         connectors.submit(() -> {\n", "next_change": null}]}, "revised_code_in_main": {"commit": "f96a822f957d13ef2735126a7f6b9a80283e3cac", "changed_code": [{"header": "diff --git a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\nindex 4d96452a4a..eb71bb9bab 100644\n--- a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n+++ b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n", "chunk": "@@ -84,7 +82,7 @@ public final class ConfigureProxy extends Task {\n     static URLConnection openConnection(Task task, final URL url, URI[] connectedVia) throws IOException {\n         final URLConnection[] conn = { null };\n         final List<Exception> errs = new CopyOnWriteArrayList<>();\n-        final StringBuilder msgs = new StringBuilder();\n+        final StringBuffer msgs = new StringBuffer();\n         final CountDownLatch connected = new CountDownLatch(1);\n         ExecutorService connectors = Executors.newFixedThreadPool(3);\n         connectors.submit(() -> {\n", "next_change": {"commit": "2744059dab68b2081267ce29d0501f13ee29396a", "changed_code": [{"header": "diff --git a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\nindex eb71bb9bab..4d96452a4a 100644\n--- a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n+++ b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n", "chunk": "@@ -82,7 +84,7 @@ public final class ConfigureProxy extends Task {\n     static URLConnection openConnection(Task task, final URL url, URI[] connectedVia) throws IOException {\n         final URLConnection[] conn = { null };\n         final List<Exception> errs = new CopyOnWriteArrayList<>();\n-        final StringBuffer msgs = new StringBuffer();\n+        final StringBuilder msgs = new StringBuilder();\n         final CountDownLatch connected = new CountDownLatch(1);\n         ExecutorService connectors = Executors.newFixedThreadPool(3);\n         connectors.submit(() -> {\n", "next_change": {"commit": "40584ecfeb52cfd7f8f5bc619ad97ad968303819", "changed_code": [{"header": "diff --git a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\nindex 4d96452a4a..eb71bb9bab 100644\n--- a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n+++ b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n", "chunk": "@@ -84,7 +82,7 @@ public final class ConfigureProxy extends Task {\n     static URLConnection openConnection(Task task, final URL url, URI[] connectedVia) throws IOException {\n         final URLConnection[] conn = { null };\n         final List<Exception> errs = new CopyOnWriteArrayList<>();\n-        final StringBuilder msgs = new StringBuilder();\n+        final StringBuffer msgs = new StringBuffer();\n         final CountDownLatch connected = new CountDownLatch(1);\n         ExecutorService connectors = Executors.newFixedThreadPool(3);\n         connectors.submit(() -> {\n", "next_change": {"commit": "d591f4d2398c2f4fbff28da1bdbe4b77d4ce9949", "changed_code": [{"header": "diff --git a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\nindex eb71bb9bab..2937a744c2 100644\n--- a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n+++ b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n", "chunk": "@@ -80,6 +80,8 @@ public final class ConfigureProxy extends Task {\n     }\n \n     static URLConnection openConnection(Task task, final URL url, URI[] connectedVia) throws IOException {\n+        long connectTimeoutMs = getProjectPropertyInt(task, \"downloadBinaries.connectTimeoutMs\", 5000);\n+        task.log(\"Connect timeout set to \" + connectTimeoutMs + \" milliseconds prior to connecting to \" + url, Project.MSG_DEBUG);\n         final URLConnection[] conn = { null };\n         final List<Exception> errs = new CopyOnWriteArrayList<>();\n         final StringBuffer msgs = new StringBuffer();\n", "next_change": {"commit": "c0cdeac94451ee1dffe6db980b6fa6e997a964e2", "changed_code": [{"header": "diff --git a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\nindex 2937a744c2..499682e0e1 100644\n--- a/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n+++ b/nbbuild/antsrc/org/netbeans/nbbuild/extlibs/ConfigureProxy.java\n", "chunk": "@@ -80,7 +80,7 @@ public final class ConfigureProxy extends Task {\n     }\n \n     static URLConnection openConnection(Task task, final URL url, URI[] connectedVia) throws IOException {\n-        long connectTimeoutMs = getProjectPropertyInt(task, \"downloadBinaries.connectTimeoutMs\", 5000);\n+        long connectTimeoutMs = getProjectPropertyInt(task, \"downloadBinaries.connectTimeoutMs\", 15000);\n         task.log(\"Connect timeout set to \" + connectTimeoutMs + \" milliseconds prior to connecting to \" + url, Project.MSG_DEBUG);\n         final URLConnection[] conn = { null };\n         final List<Exception> errs = new CopyOnWriteArrayList<>();\n", "next_change": null}]}}]}}]}}]}}]}, "commits_in_main": [{"oid": "f96a822f957d13ef2735126a7f6b9a80283e3cac", "message": "Merge commit", "committedDate": null}, {"oid": "2744059dab68b2081267ce29d0501f13ee29396a", "committedDate": "2020-06-22 10:04:12 +0200", "message": "Make configureproxy idenpotent when invoked multiple times"}, {"oid": "40584ecfeb52cfd7f8f5bc619ad97ad968303819", "committedDate": "2020-07-01 09:57:03 +0200", "message": "Using StringBuffer as msgs are accessed from multiple threads"}, {"oid": "d591f4d2398c2f4fbff28da1bdbe4b77d4ce9949", "committedDate": "2021-03-22 17:24:56 +0100", "message": "DownloadBinaries: Make the connect timeout configurable."}, {"oid": "b38415dfc341e45946df9da5d6412a1f6e606e14", "committedDate": "2021-03-22 17:27:59 +0100", "message": "Do not print empty log messages"}, {"oid": "c0cdeac94451ee1dffe6db980b6fa6e997a964e2", "committedDate": "2021-03-22 21:30:36 +0100", "message": "Increased default connect timeout from 5s to 15s."}]}, {"oid": "40584ecfeb52cfd7f8f5bc619ad97ad968303819", "url": "https://github.com/apache/netbeans/commit/40584ecfeb52cfd7f8f5bc619ad97ad968303819", "message": "Using StringBuffer as msgs are accessed from multiple threads", "committedDate": "2020-07-01T07:57:03Z", "type": "commit"}]}