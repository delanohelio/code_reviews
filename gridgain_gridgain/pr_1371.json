{"pr_number": 1371, "pr_title": "GG-30524 unified interface to open files (from configuration, especially)", "pr_author": "Berkof", "pr_createdAt": "2020-08-14T13:18:00Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1371", "timeline": [{"oid": "b50e093d970f1783e624790b07ada956d8d0ffa8", "url": "https://github.com/gridgain/gridgain/commit/b50e093d970f1783e624790b07ada956d8d0ffa8", "message": "GG-30524 add U.openFileInputStream and use it to find files", "committedDate": "2020-08-14T12:57:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYyMTE3Mw==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r470621173", "body": "Let's use try-finally for streams.", "bodyText": "Let's use try-finally for streams.", "bodyHTML": "<p dir=\"auto\">Let's use try-finally for streams.</p>", "author": "AMashenkov", "createdAt": "2020-08-14T13:24:38Z", "path": "modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java", "diffHunk": "@@ -1056,6 +1058,52 @@ public void testDoInParallelBatch() {\n         }\n     }\n \n+    /**\n+     * Test open file:\n+     * 1. by relative path\n+     * 2. by absolute path\n+     * 3. by classpath path\n+     * 4. by non existing path\n+     *\n+     * @throws Throwable\n+     */\n+    @Test\n+    public void testOpenFileInputStream() throws Throwable{\n+        // 1. by relative path\n+        InputStream relative = U.openFileInputStream(\"org.apache.ignite.util/bigUtf.txt\");\n+\n+        assertNotNull(\"Can't open input stream by relative path org.apache.ignite.util/bigUtf.txt\", relative);\n+\n+        relative.close();\n+\n+        // 2. by absolute path\n+        String absolutePath = U.getIgniteHome() + \"/pom.xml\";\n+        InputStream absolute = U.openFileInputStream(absolutePath);", "originalCommit": "b50e093d970f1783e624790b07ada956d8d0ffa8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTM4NjQ4OA==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r471386488", "bodyText": "Switch to try with resources", "author": "Berkof", "createdAt": "2020-08-17T10:27:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYyMTE3Mw=="}], "type": "inlineReview"}, {"oid": "7f95a232fd33fec7d0eb7166c2376cff2024b141", "url": "https://github.com/gridgain/gridgain/commit/7f95a232fd33fec7d0eb7166c2376cff2024b141", "message": "GG-30524 use try with resources in U tests", "committedDate": "2020-08-17T10:26:25Z", "type": "commit"}, {"oid": "93ee8977a656bf222e3c1906cb19c7b7a50ddbf2", "url": "https://github.com/gridgain/gridgain/commit/93ee8977a656bf222e3c1906cb19c7b7a50ddbf2", "message": "GG-30524 formatting", "committedDate": "2020-08-17T10:30:04Z", "type": "commit"}, {"oid": "6d5e186891dbbdb1237a97fd97232e3a03801142", "url": "https://github.com/gridgain/gridgain/commit/6d5e186891dbbdb1237a97fd97232e3a03801142", "message": "GG-30524 fix checkstyle", "committedDate": "2020-08-20T08:45:34Z", "type": "commit"}, {"oid": "3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "url": "https://github.com/gridgain/gridgain/commit/3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "message": "GG-30524 return public API method and deprecate it", "committedDate": "2020-08-20T09:43:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMTI4Mw==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473931283", "body": "```suggestion\r\n     * @deprecated Use {@link U#openFileInputStream(String)} instead.\r\n     */\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 */\n          \n          \n            \n                 * @deprecated Use {@link U#openFileInputStream(String)} instead.\n          \n          \n            \n                 */", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"479\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*<span class=\"x x-first x-last\">/</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"479\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span><span class=\"x x-first\"> </span><span class=\"pl-k x\">@deprecated</span><span class=\"x\"> </span><span class=\"pl-smi x\">Use</span><span class=\"x\"> {</span><span class=\"pl-k x\">@link</span><span class=\"x\"> </span><span class=\"pl-smi x\">U</span><span class=\"x\">#openFileInputStream(</span><span class=\"pl-smi x\">String</span><span class=\"x x-last\">)} instead.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"480\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*/</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "AMashenkov", "createdAt": "2020-08-20T12:27:11Z", "path": "modules/core/src/main/java/org/apache/ignite/ssl/SslContextFactory.java", "diffHunk": "@@ -476,6 +477,7 @@ private void checkNullParameter(Object param, String name) throws SSLException {\n      * @return Opened input stream.\n      * @throws IOException If stream could not be opened.\n      */", "originalCommit": "3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMzUyMA==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473933520", "bodyText": "we can't offer to use internal class from public API", "author": "Berkof", "createdAt": "2020-08-20T12:31:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMTI4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMTYwMw==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473931603", "body": "```suggestion\r\n     * @throws Throwable If fails.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @throws Throwable\n          \n          \n            \n                 * @throws Throwable If fails.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@throws</span> <span class=\"pl-smi\">Throwable</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@throws</span> <span class=\"pl-smi\">Throwable</span><span class=\"x x-first\"> </span><span class=\"pl-smi x\">If</span><span class=\"x x-last\"> fails.</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "AMashenkov", "createdAt": "2020-08-20T12:27:43Z", "path": "modules/core/src/test/java/org/apache/ignite/internal/util/IgniteUtilsSelfTest.java", "diffHunk": "@@ -1056,6 +1058,41 @@ public void testDoInParallelBatch() {\n         }\n     }\n \n+    /**\n+     * Test open file:\n+     * 1. by relative path\n+     * 2. by absolute path\n+     * 3. by classpath path\n+     * 4. by non existing path\n+     *\n+     * @throws Throwable", "originalCommit": "3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzODQ4MQ==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473938481", "bodyText": "DONE", "author": "Berkof", "createdAt": "2020-08-20T12:40:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMTYwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMjA1NQ==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473932055", "body": "```suggestion\r\n```", "bodyText": "Suggested change", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "AMashenkov", "createdAt": "2020-08-20T12:28:31Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/util/IgniteUtils.java", "diffHunk": "@@ -3593,6 +3593,28 @@ public static void onGridStop() throws InterruptedException {\n         }\n     }\n \n+    /**\n+     * Find file (by path or in resources) and open input stream to it.\n+     *\n+     * @param filePath Path to the file.\n+     * @return Opened input stream.\n+     * @throws IOException If stream could not be opened.\n+     */\n+    public static InputStream openFileInputStream(String filePath) throws IOException {\n+", "originalCommit": "3ddfa781654cf4fc4a4ce2e4b7d5f85c7db17cc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzNzg4Ng==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r473937886", "bodyText": "DONE", "author": "Berkof", "createdAt": "2020-08-20T12:39:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzkzMjA1NQ=="}], "type": "inlineReview"}, {"oid": "3caa5a04447b5b003a3aa27d932c33d2a8f58c98", "url": "https://github.com/gridgain/gridgain/commit/3caa5a04447b5b003a3aa27d932c33d2a8f58c98", "message": "GG-30524 code review fixes", "committedDate": "2020-08-20T12:41:47Z", "type": "commit"}, {"oid": "2e4fbc83282331ea664f60d424523b9249d43c3e", "url": "https://github.com/gridgain/gridgain/commit/2e4fbc83282331ea664f60d424523b9249d43c3e", "message": "Merge branch 'master' into gg-30524", "committedDate": "2020-08-20T12:44:02Z", "type": "commit"}, {"oid": "327c51b2ab8e1f20cc1fa23b230662ce0618f146", "url": "https://github.com/gridgain/gridgain/commit/327c51b2ab8e1f20cc1fa23b230662ce0618f146", "message": "Merge remote-tracking branch 'gridgain-ce/master' into gg-30524", "committedDate": "2020-08-20T13:08:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0NjkwMQ==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r474546901", "body": "And why did you decided to deprecate this? It's looks useful to me in case when you are needed to provide custom place from which you have to load a keystore. ", "bodyText": "And why did you decided to deprecate this? It's looks useful to me in case when you are needed to provide custom place from which you have to load a keystore.", "bodyHTML": "<p dir=\"auto\">And why did you decided to deprecate this? It's looks useful to me in case when you are needed to provide custom place from which you have to load a keystore.</p>", "author": "korlov42", "createdAt": "2020-08-21T08:57:54Z", "path": "modules/core/src/main/java/org/apache/ignite/ssl/SslContextFactory.java", "diffHunk": "@@ -476,6 +477,7 @@ private void checkNullParameter(Object param, String name) throws SSLException {\n      * @return Opened input stream.\n      * @throws IOException If stream could not be opened.\n      */\n+    @Deprecated", "originalCommit": "327c51b2ab8e1f20cc1fa23b230662ce0618f146", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzNTcyMg==", "url": "https://github.com/gridgain/gridgain/pull/1371#discussion_r475335722", "bodyText": "Only because I suppose we should use the same way to load any configuration parts, not only for SslContextFactory. But now we haven't such mehanism.", "author": "Berkof", "createdAt": "2020-08-24T04:28:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU0NjkwMQ=="}], "type": "inlineReview"}]}