{"pr_number": 4353, "pr_title": "[GEOS-9649] NullPointerException for geoJSON output format with Compl\u2026", "pr_author": "taba90", "pr_createdAt": "2020-06-30T08:05:06Z", "pr_url": "https://github.com/geoserver/geoserver/pull/4353", "timeline": [{"oid": "3e5eb8d13846597f60fd282b754de4459c23fa44", "url": "https://github.com/geoserver/geoserver/commit/3e5eb8d13846597f60fd282b754de4459c23fa44", "message": "[GEOS-9649] NullPointerException for geoJSON output format with ComplexFeatures if some feature misses geometry value", "committedDate": "2020-06-30T07:59:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYwNjc1Mw==", "url": "https://github.com/geoserver/geoserver/pull/4353#discussion_r447606753", "body": "I see, the geometry can be optional in the schema and we were always expecting something. That say, as per the [GeoJSON specification](https://tools.ietf.org/html/rfc7946), if the feature is unallocated it should be represented as a JSON NULL value, citing the specification relevant part:\r\n\r\n> A Feature object has a member with the name \"geometry\".  The value\r\n> of the geometry member SHALL be either a Geometry object as\r\n> defined above or, in the case that the Feature is unlocated, a\r\n> JSON null value.\r\n\r\nA JSON null value is represented like [this](https://www.json.org/json-en.html):\r\n\r\n```json\r\n{\r\n   \"key\":null\r\n}\r\n```\r\n\r\nCan you double check @Marco in your test that not onyl the value of the geometry attribute is ``NULL`` but also that the key is indeed present?\r\n", "bodyText": "I see, the geometry can be optional in the schema and we were always expecting something. That say, as per the GeoJSON specification, if the feature is unallocated it should be represented as a JSON NULL value, citing the specification relevant part:\n\nA Feature object has a member with the name \"geometry\".  The value\nof the geometry member SHALL be either a Geometry object as\ndefined above or, in the case that the Feature is unlocated, a\nJSON null value.\n\nA JSON null value is represented like this:\n{\n   \"key\":null\n}\nCan you double check @marco in your test that not onyl the value of the geometry attribute is NULL but also that the key is indeed present?", "bodyHTML": "<p dir=\"auto\">I see, the geometry can be optional in the schema and we were always expecting something. That say, as per the <a href=\"https://tools.ietf.org/html/rfc7946\" rel=\"nofollow\">GeoJSON specification</a>, if the feature is unallocated it should be represented as a JSON NULL value, citing the specification relevant part:</p>\n<blockquote>\n<p dir=\"auto\">A Feature object has a member with the name \"geometry\".  The value<br>\nof the geometry member SHALL be either a Geometry object as<br>\ndefined above or, in the case that the Feature is unlocated, a<br>\nJSON null value.</p>\n</blockquote>\n<p dir=\"auto\">A JSON null value is represented like <a href=\"https://www.json.org/json-en.html\" rel=\"nofollow\">this</a>:</p>\n<div class=\"highlight highlight-source-json position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n   &quot;key&quot;:null\n}\"><pre>{\n   <span class=\"pl-ent\">\"key\"</span>:<span class=\"pl-ii\">null</span>\n}</pre></div>\n<p dir=\"auto\">Can you double check <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/marco/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/marco\">@marco</a> in your test that not onyl the value of the geometry attribute is <code>NULL</code> but also that the key is indeed present?</p>", "author": "nmco", "createdAt": "2020-06-30T11:19:43Z", "path": "src/wfs/src/main/java/org/geoserver/wfs/json/ComplexGeoJsonWriter.java", "diffHunk": "@@ -176,7 +176,7 @@ private Property encodeGeometry(Feature feature) {\n             }\n             // store the attribute name and geometry value of the current feature\n             geometryAttribute = feature.getProperty(geometryType.getName());\n-            geometry = (Geometry) geometryAttribute.getValue();\n+            geometry = geometryAttribute != null ? (Geometry) geometryAttribute.getValue() : null;", "originalCommit": "3e5eb8d13846597f60fd282b754de4459c23fa44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc2Mzk1Ng==", "url": "https://github.com/geoserver/geoserver/pull/4353#discussion_r447763956", "bodyText": "fixed", "author": "taba90", "createdAt": "2020-06-30T15:15:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzYwNjc1Mw=="}], "type": "inlineReview"}, {"oid": "cff4d10e429e0bd8819350a636290ee14c907526", "url": "https://github.com/geoserver/geoserver/commit/cff4d10e429e0bd8819350a636290ee14c907526", "message": "reviewer's suggestion applied", "committedDate": "2020-06-30T14:25:28Z", "type": "commit"}]}