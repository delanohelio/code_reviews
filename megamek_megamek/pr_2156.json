{"pr_number": 2156, "pr_title": "Fixed null pointer exception causing bot to break", "pr_author": "Krashner", "pr_createdAt": "2020-08-17T14:55:10Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2156", "timeline": [{"oid": "6323445ec74cadd22242efdbb922d8c4b76b852b", "url": "https://github.com/MegaMek/megamek/commit/6323445ec74cadd22242efdbb922d8c4b76b852b", "message": "Fixed null pointer exception causing bot to break", "committedDate": "2020-08-17T14:37:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzODcyOA==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471538728", "body": "```suggestion\r\n            MegaMek.getLogger().error(this, \"Null entity reference\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        System.out.println(\"Null entity reference in cacheImgTag()\");\n          \n          \n            \n                        MegaMek.getLogger().error(this, \"Null entity reference\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-smi x x-first\">System</span><span class=\"pl-k x\">.</span><span class=\"x\">out</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">println(</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Null entity reference<span class=\"x x-first x-last\"> in cacheImgTag()</span><span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-smi x x-first\">MegaMek</span><span class=\"pl-k x\">.</span><span class=\"x\">getLogger()</span><span class=\"pl-k x\">.</span><span class=\"x\">error(</span><span class=\"pl-c1 x\">this</span><span class=\"x x-last\">, </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Null entity reference<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Windchild292", "createdAt": "2020-08-17T14:59:34Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");", "originalCommit": "6323445ec74cadd22242efdbb922d8c4b76b852b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzODkyOQ==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471538929", "body": "```suggestion\r\n        } else if (imgCache.containsKey(entity.getId())) {\r\n            //remove images that should be refreshed\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed\n          \n          \n            \n                    } else if (imgCache.containsKey(entity.getId())) {\n          \n          \n            \n                        //remove images that should be refreshed", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }<span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (imgCache<span class=\"pl-k\">.</span>containsKey(entity<span class=\"pl-k\">.</span>getId())) {<span class=\"pl-c\"><span class=\"pl-c x x-first\">//</span><span class=\"x x-last\">remove images that should be refreshed</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }<span class=\"x x-first x-last\"> </span><span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (imgCache<span class=\"pl-k\">.</span>containsKey(entity<span class=\"pl-k\">.</span>getId())) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-c\"><span class=\"pl-c\">//</span>remove images that should be refreshed</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Windchild292", "createdAt": "2020-08-17T14:59:51Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");\n             return;\n         }\n \n         if (imgCache == null) {\n             imgCache = new Hashtable<>();\n-        }else if (imgCache.containsKey(entity.getId())) {\n-            //remove images that should be regenerated\n+        }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed", "originalCommit": "6323445ec74cadd22242efdbb922d8c4b76b852b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzOTU1OQ==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471539559", "body": "```suggestion\r\n        if (getTargetImage(entity) != null) {\r\n            //convert image to base64, add to to <img> tag and store in cache\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(getTargetImage(entity) != null){//convert image to base64, add to to <img> tag and store in cache\n          \n          \n            \n                    if (getTargetImage(entity) != null) {\n          \n          \n            \n                        //convert image to base64, add to to <img> tag and store in cache", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span>(getTargetImage(entity) <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">null</span>)<span class=\"x x-first\">{</span><span class=\"pl-c\"><span class=\"pl-c x\">//</span><span class=\"x x-last\">convert image to base64, add to to &lt;img&gt; tag and store in cache</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">if</span><span class=\"x x-first x-last\"> </span>(getTargetImage(entity) <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">null</span>)<span class=\"x x-first x-last\"> {</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-c\"><span class=\"pl-c\">//</span>convert image to base64, add to to &lt;img&gt; tag and store in cache</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Windchild292", "createdAt": "2020-08-17T15:00:43Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1151,33 +1151,29 @@ private String getCachedImgTag(int id){\n     private void cacheImgTag(Entity entity){\n \n         if(entity == null) {\n-            System.out.println(\"Null entity reference\");\n+            System.out.println(\"Null entity reference in cacheImgTag()\");\n             return;\n         }\n \n         if (imgCache == null) {\n             imgCache = new Hashtable<>();\n-        }else if (imgCache.containsKey(entity.getId())) {\n-            //remove images that should be regenerated\n+        }else if (imgCache.containsKey(entity.getId())) {//remove images that should be refreshed\n             imgCache.remove(entity.getId());\n         }\n \n-        //convert to base64, add to to <img> tag and store in cache\n-        if (!imgCache.containsKey(entity.getId())) {\n-            Image image = ImageUtil.getScaledImage(getTargetImage(entity),  56, 48);\n-            if(image!=null) {\n-                try {\n-                    String base64Text;\n-                    ByteArrayOutputStream baos = new ByteArrayOutputStream();\n-                    ImageIO.write((RenderedImage) image, \"png\", baos);\n-                    baos.flush();\n-                    base64Text = Base64.getEncoder().encodeToString(baos.toByteArray());\n-                    baos.close();\n-                    String img = \"<img src='data:image/png;base64,\" + base64Text + \"'>\";\n-                    imgCache.put(entity.getId(), img);\n-                } catch (final IOException ioe) {\n-                    throw new UncheckedIOException(ioe);\n-                }\n+        if(getTargetImage(entity) != null){//convert image to base64, add to to <img> tag and store in cache", "originalCommit": "6323445ec74cadd22242efdbb922d8c4b76b852b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471541003", "body": "```\r\nif (bv == null) {\r\n    return null;\r\n} else if (e.isDestroyed()) {\r\n    return bv.getTilesetManager().wreckMarkerFor(e, -1);\r\n} else {\r\n    return bv.getTilesetManager().imageFor(e);\r\n}\r\n```", "bodyText": "if (bv == null) {\n    return null;\n} else if (e.isDestroyed()) {\n    return bv.getTilesetManager().wreckMarkerFor(e, -1);\n} else {\n    return bv.getTilesetManager().imageFor(e);\n}", "bodyHTML": "<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"if (bv == null) {\n    return null;\n} else if (e.isDestroyed()) {\n    return bv.getTilesetManager().wreckMarkerFor(e, -1);\n} else {\n    return bv.getTilesetManager().imageFor(e);\n}\n\"><pre><code>if (bv == null) {\n    return null;\n} else if (e.isDestroyed()) {\n    return bv.getTilesetManager().wreckMarkerFor(e, -1);\n} else {\n    return bv.getTilesetManager().imageFor(e);\n}\n</code></pre></div>", "author": "Windchild292", "createdAt": "2020-08-17T15:02:58Z", "path": "megamek/src/megamek/client/Client.java", "diffHunk": "@@ -1186,10 +1182,14 @@ private void cacheImgTag(Entity entity){\n      * Gets the current mech image\n      */\n     private Image getTargetImage(Entity e){\n-        if(e.isDestroyed()) {\n-            return bv.getTilesetManager().wreckMarkerFor(e, -1);\n+        if(bv == null){\n+            return  null;\n         }else {\n-            return bv.getTilesetManager().imageFor(e);\n+            if (e.isDestroyed()) {\n+                return bv.getTilesetManager().wreckMarkerFor(e, -1);\n+            } else {\n+                return bv.getTilesetManager().imageFor(e);\n+            }\n         }", "originalCommit": "6323445ec74cadd22242efdbb922d8c4b76b852b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTI2Mw==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471541263", "bodyText": "Suggested rewrite to improve readability.", "author": "Windchild292", "createdAt": "2020-08-17T15:03:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1MDI5NA==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471550294", "bodyText": "Apparently I'm sloppy when it's early. I appreciate the suggestions.", "author": "Krashner", "createdAt": "2020-08-17T15:16:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MDA1Mw==", "url": "https://github.com/MegaMek/megamek/pull/2156#discussion_r471560053", "bodyText": "It happens to us all, and welcome :)", "author": "Windchild292", "createdAt": "2020-08-17T15:31:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MTAwMw=="}], "type": "inlineReview"}, {"oid": "003a3704d61d4a88f229a76b99c1cd9b0636eff9", "url": "https://github.com/MegaMek/megamek/commit/003a3704d61d4a88f229a76b99c1cd9b0636eff9", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-08-17T15:11:52Z", "type": "commit"}, {"oid": "404482bd4a69bc7978ea6b2172f6961766dbd2da", "url": "https://github.com/MegaMek/megamek/commit/404482bd4a69bc7978ea6b2172f6961766dbd2da", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-08-17T15:12:13Z", "type": "commit"}, {"oid": "c806953e87dfc92726070d9009e96d7bc399b36d", "url": "https://github.com/MegaMek/megamek/commit/c806953e87dfc92726070d9009e96d7bc399b36d", "message": "Update megamek/src/megamek/client/Client.java\r\n\r\nSuggested change\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-08-17T15:12:27Z", "type": "commit"}, {"oid": "55578c152e70d891c312091a55fae76076549952", "url": "https://github.com/MegaMek/megamek/commit/55578c152e70d891c312091a55fae76076549952", "message": "Fixed readability for getTargetImage", "committedDate": "2020-08-17T15:16:13Z", "type": "commit"}]}