{"pr_number": 1809, "pr_title": "fix NPE with support tank infantry weapons", "pr_author": "NickAragua", "pr_createdAt": "2020-03-31T21:58:42Z", "pr_url": "https://github.com/MegaMek/megamek/pull/1809", "timeline": [{"oid": "56071c37eb1fdb8446fa943866ee3cab58cf317c", "url": "https://github.com/MegaMek/megamek/commit/56071c37eb1fdb8446fa943866ee3cab58cf317c", "message": "fix NPE with support tank infantry weapons", "committedDate": "2020-03-31T21:57:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NDA0MQ==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401244041", "body": "Cast to Infantry isn't needed here.", "bodyText": "Cast to Infantry isn't needed here.", "bodyHTML": "<p dir=\"auto\">Cast to Infantry isn't needed here.</p>", "author": "Windchild292", "createdAt": "2020-03-31T22:07:20Z", "path": "megamek/src/megamek/client/bot/princess/InfantryFireControl.java", "diffHunk": "@@ -115,8 +115,10 @@ public double getMaxDamageAtRange(final MovePath shooterPath, final MovePath tar\n \n             // case 1\n             if (weaponType.hasFlag(WeaponType.F_INFANTRY)) {\n+                int infantryCount = shooter.isConventionalInfantry() ?\n+                        ((Infantry) shooter).getInternal(Infantry.LOC_INFANTRY) : 1;", "originalCommit": "56071c37eb1fdb8446fa943866ee3cab58cf317c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5ODM3MA==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401298370", "bodyText": "It's used by the bot to calculate incoming and outgoing damage when evaluating a path being considered by an infantry unit. So it was trying to evaluate a move path for a foot platoon and checking how much damage an \"apocalypse world rover\" would do to the foot platoon. That particular tank has a weapon with an infantry flag, but was not an infantry unit.\nI'm pretty sure this will lead to incorrect behavior for battle armor, so I'm going to take another look at it.", "author": "NickAragua", "createdAt": "2020-04-01T00:58:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NDA0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNDExMg==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401304112", "bodyText": "There, that should do it.", "author": "NickAragua", "createdAt": "2020-04-01T01:21:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI0NDA0MQ=="}], "type": "inlineReview"}, {"oid": "1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "url": "https://github.com/MegaMek/megamek/commit/1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "message": "fix BA damage calculation", "committedDate": "2020-04-01T01:19:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNDU2NQ==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401304565", "body": "```suggestion\r\n        for (final Mounted weapon : shooter.getWeaponList()) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for (final Mounted weapon : shooter.getWeaponList()) {            \n          \n          \n            \n                    for (final Mounted weapon : shooter.getWeaponList()) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">for</span> (<span class=\"pl-k\">final</span> <span class=\"pl-smi\">Mounted</span> weapon <span class=\"pl-k\">:</span> shooter<span class=\"pl-k\">.</span>getWeaponList()) {<span class=\"x x-first x-last\">            </span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">for</span> (<span class=\"pl-k\">final</span> <span class=\"pl-smi\">Mounted</span> weapon <span class=\"pl-k\">:</span> shooter<span class=\"pl-k\">.</span>getWeaponList()) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Windchild292", "createdAt": "2020-04-01T01:23:11Z", "path": "megamek/src/megamek/client/bot/princess/InfantryFireControl.java", "diffHunk": "@@ -91,7 +92,7 @@ public double getMaxDamageAtRange(final MovePath shooterPath, final MovePath tar\n                 && target.hasETypeFlag(Entity.ETYPE_INFANTRY) && ((Infantry) target).isMechanized();\n \n         // cycle through my weapons\n-        for (final Mounted weapon : shooter.getWeaponList()) {\n+        for (final Mounted weapon : shooter.getWeaponList()) {            ", "originalCommit": "1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNDY2MQ==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401304661", "body": "```suggestion\r\n                if (shooter.isConventionalInfantry()) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(shooter.isConventionalInfantry()) {\n          \n          \n            \n                            if (shooter.isConventionalInfantry()) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">if</span>(shooter<span class=\"pl-k\">.</span>isConventionalInfantry()) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">if</span><span class=\"x x-first x-last\"> </span>(shooter<span class=\"pl-k\">.</span>isConventionalInfantry()) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Windchild292", "createdAt": "2020-04-01T01:23:31Z", "path": "megamek/src/megamek/client/bot/princess/InfantryFireControl.java", "diffHunk": "@@ -115,8 +116,16 @@ public double getMaxDamageAtRange(final MovePath shooterPath, final MovePath tar\n \n             // case 1\n             if (weaponType.hasFlag(WeaponType.F_INFANTRY)) {\n+                int infantryCount = 1;\n+                \n+                if(shooter.isConventionalInfantry()) {", "originalCommit": "1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwNDcxOQ==", "url": "https://github.com/MegaMek/megamek/pull/1809#discussion_r401304719", "body": "```suggestion\r\n                } else if (shooter instanceof BattleArmor) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            } else if(shooter instanceof BattleArmor){\n          \n          \n            \n                            } else if (shooter instanceof BattleArmor) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span>(shooter <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">BattleArmor</span>){</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span><span class=\"x x-first x-last\"> </span>(shooter <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">BattleArmor</span>)<span class=\"x x-first x-last\"> </span>{</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Windchild292", "createdAt": "2020-04-01T01:23:44Z", "path": "megamek/src/megamek/client/bot/princess/InfantryFireControl.java", "diffHunk": "@@ -115,8 +116,16 @@ public double getMaxDamageAtRange(final MovePath shooterPath, final MovePath tar\n \n             // case 1\n             if (weaponType.hasFlag(WeaponType.F_INFANTRY)) {\n+                int infantryCount = 1;\n+                \n+                if(shooter.isConventionalInfantry()) {\n+                    infantryCount = shooter.getInternal(Infantry.LOC_INFANTRY);\n+                } else if(shooter instanceof BattleArmor){", "originalCommit": "1c959e17508d0b1cd6cd51f8450c6110c7b760b1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b765fcceb7ab65a5afad15056c7a970c1a585dc", "url": "https://github.com/MegaMek/megamek/commit/6b765fcceb7ab65a5afad15056c7a970c1a585dc", "message": "Update megamek/src/megamek/client/bot/princess/InfantryFireControl.java\n\nCo-Authored-By: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-04-01T01:31:27Z", "type": "commit"}, {"oid": "5b67909442c1e606455ed09b00300a05604846cb", "url": "https://github.com/MegaMek/megamek/commit/5b67909442c1e606455ed09b00300a05604846cb", "message": "Update megamek/src/megamek/client/bot/princess/InfantryFireControl.java\n\nCo-Authored-By: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-04-01T01:31:36Z", "type": "commit"}, {"oid": "abf1eadbbe4668b062a26d4d4f6fda70dc712d99", "url": "https://github.com/MegaMek/megamek/commit/abf1eadbbe4668b062a26d4d4f6fda70dc712d99", "message": "Update megamek/src/megamek/client/bot/princess/InfantryFireControl.java\n\nCo-Authored-By: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-04-01T01:31:41Z", "type": "commit"}]}