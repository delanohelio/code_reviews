{"pr_number": 9708, "pr_title": "KAFKA-9126: KIP-689: StreamJoined changelog configuration", "pr_author": "lct45", "pr_createdAt": "2020-12-07T18:03:11Z", "pr_url": "https://github.com/apache/kafka/pull/9708", "timeline": [{"oid": "ea6d6b0abcc40e105f751328881c2128d8d17ac1", "url": "https://github.com/apache/kafka/commit/ea6d6b0abcc40e105f751328881c2128d8d17ac1", "message": "initial kip implementation", "committedDate": "2020-12-01T16:56:07Z", "type": "commit"}, {"oid": "e0c77fe92e5fd730ded310e730f116bb396a9a25", "url": "https://github.com/apache/kafka/commit/e0c77fe92e5fd730ded310e730f116bb396a9a25", "message": "remove caching option and add testing", "committedDate": "2020-12-04T16:53:42Z", "type": "commit"}, {"oid": "52a815bb29d52cc52fd6e908e0d35912c35ab3b7", "url": "https://github.com/apache/kafka/commit/52a815bb29d52cc52fd6e908e0d35912c35ab3b7", "message": "cleanup", "committedDate": "2020-12-07T17:57:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM3NTMyMQ==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r540375321", "body": "I think you meant this here:\r\n\r\n```suggestion\r\n            new HashMap<>()\r\n```", "bodyText": "I think you meant this here:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        null\n          \n          \n            \n                        new HashMap<>()", "bodyHTML": "<p dir=\"auto\">I think you meant this here:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-c1 x x-first x-last\">null</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k x x-first\">new</span><span class=\"x\"> </span><span class=\"pl-k x\">HashMap&lt;&gt;</span><span class=\"x x-last\">()</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "vvcephei", "createdAt": "2020-12-10T17:50:54Z", "path": "streams/src/main/java/org/apache/kafka/streams/kstream/StreamJoined.java", "diffHunk": "@@ -267,7 +296,49 @@ private StreamJoined(final Serde<K> keySerde,\n             thisStoreSupplier,\n             otherStoreSupplier,\n             name,\n-            storeName\n+            storeName,\n+            loggingEnabled,\n+            topicConfig\n+        );\n+    }\n+\n+    /**\n+     * Configures logging for both state stores. The changelog will be created with the provided configs.\n+     * <p>\n+     * Note: Any unrecognized configs will be ignored\n+     * @param config  configs applied to the changelog topic\n+     * @return            a new {@link StreamJoined} configured with logging enabled\n+     */\n+    public StreamJoined<K, V1, V2> withLoggingEnabled(final Map<String, String> config) {\n+\n+        return new StreamJoined<>(\n+            keySerde,\n+            valueSerde,\n+            otherValueSerde,\n+            thisStoreSupplier,\n+            otherStoreSupplier,\n+            name,\n+            storeName,\n+            true,\n+            config\n+        );\n+    }\n+\n+    /**\n+     * Disable change logging for both state stores.\n+     * @return            a new {@link StreamJoined} configured with logging disabled\n+     */\n+    public StreamJoined<K, V1, V2> withLoggingDisabled() {\n+        return new StreamJoined<>(\n+            keySerde,\n+            valueSerde,\n+            otherValueSerde,\n+            thisStoreSupplier,\n+            otherStoreSupplier,\n+            name,\n+            storeName,\n+            false,\n+            null", "originalCommit": "52a815bb29d52cc52fd6e908e0d35912c35ab3b7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM3NzA0NA==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r540377044", "body": "It seems like these would pass by default. Maybe we should check set some log configs and then check that they got propagated ? ", "bodyText": "It seems like these would pass by default. Maybe we should check set some log configs and then check that they got propagated ?", "bodyHTML": "<p dir=\"auto\">It seems like these would pass by default. Maybe we should check set some log configs and then check that they got propagated ?</p>", "author": "vvcephei", "createdAt": "2020-12-10T17:53:29Z", "path": "streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamKStreamJoinTest.java", "diffHunk": "@@ -152,6 +155,52 @@ private void shouldLogAndMeterOnSkippedRecordsWithNullValue(final String builtIn\n         }\n     }\n \n+    @Test\n+    public void shouldDisableLoggingOnStreamJoined() {\n+\n+        final JoinWindows joinWindows = JoinWindows.of(ofMillis(100)).grace(Duration.ofMillis(50));\n+        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingDisabled();\n+\n+        final StreamsBuilder builder = new StreamsBuilder();\n+        final KStream<String, Integer> left = builder.stream(\"left\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+        final KStream<String, Integer> right = builder.stream(\"right\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+\n+        left.join(\n+            right,\n+            (value1, value2) -> value1 + value2,\n+            joinWindows,\n+            streamJoined);\n+\n+        final Topology topology = builder.build();\n+        final InternalTopologyBuilder internalTopologyBuilder = TopologyWrapper.getInternalTopologyBuilder(topology);\n+\n+        assertThat(internalTopologyBuilder.stateStores().get(\"store-this-join-store\").loggingEnabled(), equalTo(false));\n+        assertThat(internalTopologyBuilder.stateStores().get(\"store-other-join-store\").loggingEnabled(), equalTo(false));\n+    }\n+\n+    @Test\n+    public void shouldEnableLoggingWithCustomConfigOnStreamJoined() {\n+\n+        final JoinWindows joinWindows = JoinWindows.of(ofMillis(100)).grace(Duration.ofMillis(50));\n+        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingEnabled(Collections.emptyMap());\n+\n+        final StreamsBuilder builder = new StreamsBuilder();\n+        final KStream<String, Integer> left = builder.stream(\"left\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+        final KStream<String, Integer> right = builder.stream(\"right\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+\n+        left.join(\n+            right,\n+            (value1, value2) -> value1 + value2,\n+            joinWindows,\n+            streamJoined);\n+\n+        final Topology topology = builder.build();\n+        final InternalTopologyBuilder internalTopologyBuilder = TopologyWrapper.getInternalTopologyBuilder(topology);\n+\n+        assertThat(internalTopologyBuilder.stateStores().get(\"store-this-join-store\").loggingEnabled(), equalTo(true));\n+        assertThat(internalTopologyBuilder.stateStores().get(\"store-other-join-store\").loggingEnabled(), equalTo(true));", "originalCommit": "52a815bb29d52cc52fd6e908e0d35912c35ab3b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQzMTM2OA==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r540431368", "bodyText": "Yeah it does pass by default. I experimented with passing the logs in but I wasn't able to find a good way to confirm that the logs I was passing were getting set somewhere. Do you know where they're exposed for me to check? Materialized doesn't seem to check this either", "author": "lct45", "createdAt": "2020-12-10T19:17:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM3NzA0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3MTM0NA==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r543271344", "bodyText": "Maybe there is an easier way, but I found the following:\nSet the config to:\n        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined\n            .with(Serdes.String(), Serdes.Integer(), Serdes.Integer())\n            .withStoreName(\"store\")\n            .withLoggingEnabled(Collections.singletonMap(\"test\", \"property\"));\n\nand then check it:\n        internalTopologyBuilder.buildSubtopology(0);\n\n        assertThat(internalTopologyBuilder.stateStores().get(\"store-this-join-store\").loggingEnabled(), equalTo(true));\n        assertThat(internalTopologyBuilder.stateStores().get(\"store-other-join-store\").loggingEnabled(), equalTo(true));\n        assertThat(internalTopologyBuilder.topicGroups().get(0).stateChangelogTopics.size(), equalTo(2));\n        for (final InternalTopicConfig config : internalTopologyBuilder.topicGroups().get(0).stateChangelogTopics.values()) {\n            assertThat(\n                config.getProperties(Collections.emptyMap(), 0).get(\"test\"),\n                equalTo(\"property\")\n            );\n        }\n\nWithout\nassertThat(internalTopologyBuilder.topicGroups().get(0).stateChangelogTopics.size(), equalTo(2));\n\nthe test would pass without checking the config if buildSubtopology() is not called because no changelog topics would be registered in the topology. So it basically checks that buildSubtopology() is called.", "author": "cadonna", "createdAt": "2020-12-15T11:40:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDM3NzA0NA=="}], "type": "inlineReview"}, {"oid": "67ebdd51af2a2400d5b088fc5b14da25a7c7dba3", "url": "https://github.com/apache/kafka/commit/67ebdd51af2a2400d5b088fc5b14da25a7c7dba3", "message": "Johns edits", "committedDate": "2020-12-10T19:19:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyMjYxMQ==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r543222611", "body": "I guess both can be declared as `final`, right?", "bodyText": "I guess both can be declared as final, right?", "bodyHTML": "<p dir=\"auto\">I guess both can be declared as <code>final</code>, right?</p>", "author": "cadonna", "createdAt": "2020-12-15T10:25:03Z", "path": "streams/src/main/java/org/apache/kafka/streams/kstream/StreamJoined.java", "diffHunk": "@@ -36,6 +39,8 @@\n     protected final WindowBytesStoreSupplier otherStoreSupplier;\n     protected final String name;\n     protected final String storeName;\n+    protected boolean loggingEnabled;\n+    protected Map<String, String> topicConfig;", "originalCommit": "67ebdd51af2a2400d5b088fc5b14da25a7c7dba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyNjY0Mw==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r543226643", "body": "Suggestion:\r\n```suggestion\r\n        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined\r\n            .with(Serdes.String(), Serdes.Integer(), Serdes.Integer())\r\n            .withStoreName(\"store\")\r\n            .withLoggingDisabled();\r\n```", "bodyText": "Suggestion:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingDisabled();\n          \n          \n            \n                    final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined\n          \n          \n            \n                        .with(Serdes.String(), Serdes.Integer(), Serdes.Integer())\n          \n          \n            \n                        .withStoreName(\"store\")\n          \n          \n            \n                        .withLoggingDisabled();", "bodyHTML": "<p dir=\"auto\">Suggestion:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">final</span> <span class=\"pl-k\">StreamJoined&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Integer</span>, <span class=\"pl-smi\">Integer</span>&gt;</span> streamJoined <span class=\"pl-k\">=</span> <span class=\"pl-smi\">StreamJoined</span><span class=\"pl-k x x-first\">.</span><span class=\"x\">with(</span><span class=\"pl-smi x\">Serdes</span><span class=\"pl-k x\">.</span><span class=\"x\">String(), </span><span class=\"pl-smi x\">Serdes</span><span class=\"pl-k x\">.</span><span class=\"x\">Integer(), </span><span class=\"pl-smi x\">Serdes</span><span class=\"pl-k x\">.</span><span class=\"x\">Integer())</span><span class=\"pl-k x\">.</span><span class=\"x\">withStoreName(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">store</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">)</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">withLoggingDisabled();</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">final</span> <span class=\"pl-k\">StreamJoined&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Integer</span>, <span class=\"pl-smi\">Integer</span>&gt;</span> streamJoined <span class=\"pl-k\">=</span> <span class=\"pl-smi\">StreamJoined</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            .with(<span class=\"pl-smi\">Serdes</span><span class=\"pl-k\">.</span>String(), <span class=\"pl-smi\">Serdes</span><span class=\"pl-k\">.</span>Integer(), <span class=\"pl-smi\">Serdes</span><span class=\"pl-k\">.</span>Integer())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            .withStoreName(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>store<span class=\"pl-pds\">\"</span></span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            .withLoggingDisabled();</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cadonna", "createdAt": "2020-12-15T10:30:43Z", "path": "streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamKStreamJoinTest.java", "diffHunk": "@@ -152,6 +155,52 @@ private void shouldLogAndMeterOnSkippedRecordsWithNullValue(final String builtIn\n         }\n     }\n \n+    @Test\n+    public void shouldDisableLoggingOnStreamJoined() {\n+\n+        final JoinWindows joinWindows = JoinWindows.of(ofMillis(100)).grace(Duration.ofMillis(50));\n+        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingDisabled();", "originalCommit": "67ebdd51af2a2400d5b088fc5b14da25a7c7dba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyNzI4NQ==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r543227285", "body": "```suggestion\r\n        left.join(\r\n            right,\r\n            (value1, value2) -> value1 + value2,\r\n            joinWindows,\r\n            streamJoined\r\n        );\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    left.join(\n          \n          \n            \n                        right,\n          \n          \n            \n                        (value1, value2) -> value1 + value2,\n          \n          \n            \n                        joinWindows,\n          \n          \n            \n                        streamJoined);\n          \n          \n            \n                    left.join(\n          \n          \n            \n                        right,\n          \n          \n            \n                        (value1, value2) -> value1 + value2,\n          \n          \n            \n                        joinWindows,\n          \n          \n            \n                        streamJoined\n          \n          \n            \n                    );", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        left<span class=\"pl-k\">.</span>join(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            right,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            (value1, value2) <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> value1 <span class=\"pl-k\">+</span> value2,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            joinWindows,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            streamJoined);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        left<span class=\"pl-k\">.</span>join(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            right,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            (value1, value2) <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> value1 <span class=\"pl-k\">+</span> value2,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            joinWindows,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            streamJoined</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        );</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cadonna", "createdAt": "2020-12-15T10:31:37Z", "path": "streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamKStreamJoinTest.java", "diffHunk": "@@ -152,6 +155,52 @@ private void shouldLogAndMeterOnSkippedRecordsWithNullValue(final String builtIn\n         }\n     }\n \n+    @Test\n+    public void shouldDisableLoggingOnStreamJoined() {\n+\n+        final JoinWindows joinWindows = JoinWindows.of(ofMillis(100)).grace(Duration.ofMillis(50));\n+        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingDisabled();\n+\n+        final StreamsBuilder builder = new StreamsBuilder();\n+        final KStream<String, Integer> left = builder.stream(\"left\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+        final KStream<String, Integer> right = builder.stream(\"right\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+\n+        left.join(\n+            right,\n+            (value1, value2) -> value1 + value2,\n+            joinWindows,\n+            streamJoined);", "originalCommit": "67ebdd51af2a2400d5b088fc5b14da25a7c7dba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyODU5Ng==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r543228596", "body": "```suggestion\r\n        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined\r\n            .with(Serdes.String(), Serdes.Integer(), Serdes.Integer())\r\n            .withStoreName(\"store\")\r\n            .withLoggingEnabled(Collections.emptyMap());\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingEnabled(Collections.emptyMap());\n          \n          \n            \n                    final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined\n          \n          \n            \n                        .with(Serdes.String(), Serdes.Integer(), Serdes.Integer())\n          \n          \n            \n                        .withStoreName(\"store\")\n          \n          \n            \n                        .withLoggingEnabled(Collections.emptyMap());", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">final</span> <span class=\"pl-k\">StreamJoined&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Integer</span>, <span class=\"pl-smi\">Integer</span>&gt;</span> streamJoined <span class=\"pl-k\">=</span> <span class=\"pl-smi\">StreamJoined</span><span class=\"pl-k x x-first\">.</span><span class=\"x\">with(</span><span class=\"pl-smi x\">Serdes</span><span class=\"pl-k x\">.</span><span class=\"x\">String(), </span><span class=\"pl-smi x\">Serdes</span><span class=\"pl-k x\">.</span><span class=\"x\">Integer(), </span><span class=\"pl-smi x\">Serdes</span><span class=\"pl-k x\">.</span><span class=\"x\">Integer())</span><span class=\"pl-k x\">.</span><span class=\"x\">withStoreName(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">store</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">)</span><span class=\"pl-k x\">.</span><span class=\"x\">withLoggingEnabled(</span><span class=\"pl-smi x\">Collections</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">emptyMap());</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">final</span> <span class=\"pl-k\">StreamJoined&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Integer</span>, <span class=\"pl-smi\">Integer</span>&gt;</span> streamJoined <span class=\"pl-k\">=</span> <span class=\"pl-smi\">StreamJoined</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            .with(<span class=\"pl-smi\">Serdes</span><span class=\"pl-k\">.</span>String(), <span class=\"pl-smi\">Serdes</span><span class=\"pl-k\">.</span>Integer(), <span class=\"pl-smi\">Serdes</span><span class=\"pl-k\">.</span>Integer())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            .withStoreName(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>store<span class=\"pl-pds\">\"</span></span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            .withLoggingEnabled(<span class=\"pl-smi\">Collections</span><span class=\"pl-k\">.</span>emptyMap());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cadonna", "createdAt": "2020-12-15T10:33:33Z", "path": "streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamKStreamJoinTest.java", "diffHunk": "@@ -152,6 +155,52 @@ private void shouldLogAndMeterOnSkippedRecordsWithNullValue(final String builtIn\n         }\n     }\n \n+    @Test\n+    public void shouldDisableLoggingOnStreamJoined() {\n+\n+        final JoinWindows joinWindows = JoinWindows.of(ofMillis(100)).grace(Duration.ofMillis(50));\n+        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingDisabled();\n+\n+        final StreamsBuilder builder = new StreamsBuilder();\n+        final KStream<String, Integer> left = builder.stream(\"left\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+        final KStream<String, Integer> right = builder.stream(\"right\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+\n+        left.join(\n+            right,\n+            (value1, value2) -> value1 + value2,\n+            joinWindows,\n+            streamJoined);\n+\n+        final Topology topology = builder.build();\n+        final InternalTopologyBuilder internalTopologyBuilder = TopologyWrapper.getInternalTopologyBuilder(topology);\n+\n+        assertThat(internalTopologyBuilder.stateStores().get(\"store-this-join-store\").loggingEnabled(), equalTo(false));\n+        assertThat(internalTopologyBuilder.stateStores().get(\"store-other-join-store\").loggingEnabled(), equalTo(false));\n+    }\n+\n+    @Test\n+    public void shouldEnableLoggingWithCustomConfigOnStreamJoined() {\n+\n+        final JoinWindows joinWindows = JoinWindows.of(ofMillis(100)).grace(Duration.ofMillis(50));\n+        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingEnabled(Collections.emptyMap());", "originalCommit": "67ebdd51af2a2400d5b088fc5b14da25a7c7dba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyODc0Nw==", "url": "https://github.com/apache/kafka/pull/9708#discussion_r543228747", "body": "```suggestion\r\n        left.join(\r\n            right,\r\n            (value1, value2) -> value1 + value2,\r\n            joinWindows,\r\n            streamJoined\r\n        );\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    left.join(\n          \n          \n            \n                        right,\n          \n          \n            \n                        (value1, value2) -> value1 + value2,\n          \n          \n            \n                        joinWindows,\n          \n          \n            \n                        streamJoined);\n          \n          \n            \n                    left.join(\n          \n          \n            \n                        right,\n          \n          \n            \n                        (value1, value2) -> value1 + value2,\n          \n          \n            \n                        joinWindows,\n          \n          \n            \n                        streamJoined\n          \n          \n            \n                    );", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        left<span class=\"pl-k\">.</span>join(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            right,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            (value1, value2) <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> value1 <span class=\"pl-k\">+</span> value2,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            joinWindows,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            streamJoined);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        left<span class=\"pl-k\">.</span>join(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            right,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            (value1, value2) <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> value1 <span class=\"pl-k\">+</span> value2,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            joinWindows,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            streamJoined</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        );</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cadonna", "createdAt": "2020-12-15T10:33:46Z", "path": "streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamKStreamJoinTest.java", "diffHunk": "@@ -152,6 +155,52 @@ private void shouldLogAndMeterOnSkippedRecordsWithNullValue(final String builtIn\n         }\n     }\n \n+    @Test\n+    public void shouldDisableLoggingOnStreamJoined() {\n+\n+        final JoinWindows joinWindows = JoinWindows.of(ofMillis(100)).grace(Duration.ofMillis(50));\n+        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingDisabled();\n+\n+        final StreamsBuilder builder = new StreamsBuilder();\n+        final KStream<String, Integer> left = builder.stream(\"left\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+        final KStream<String, Integer> right = builder.stream(\"right\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+\n+        left.join(\n+            right,\n+            (value1, value2) -> value1 + value2,\n+            joinWindows,\n+            streamJoined);\n+\n+        final Topology topology = builder.build();\n+        final InternalTopologyBuilder internalTopologyBuilder = TopologyWrapper.getInternalTopologyBuilder(topology);\n+\n+        assertThat(internalTopologyBuilder.stateStores().get(\"store-this-join-store\").loggingEnabled(), equalTo(false));\n+        assertThat(internalTopologyBuilder.stateStores().get(\"store-other-join-store\").loggingEnabled(), equalTo(false));\n+    }\n+\n+    @Test\n+    public void shouldEnableLoggingWithCustomConfigOnStreamJoined() {\n+\n+        final JoinWindows joinWindows = JoinWindows.of(ofMillis(100)).grace(Duration.ofMillis(50));\n+        final StreamJoined<String, Integer, Integer> streamJoined = StreamJoined.with(Serdes.String(), Serdes.Integer(), Serdes.Integer()).withStoreName(\"store\").withLoggingEnabled(Collections.emptyMap());\n+\n+        final StreamsBuilder builder = new StreamsBuilder();\n+        final KStream<String, Integer> left = builder.stream(\"left\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+        final KStream<String, Integer> right = builder.stream(\"right\", Consumed.with(Serdes.String(), Serdes.Integer()));\n+\n+        left.join(\n+            right,\n+            (value1, value2) -> value1 + value2,\n+            joinWindows,\n+            streamJoined);", "originalCommit": "67ebdd51af2a2400d5b088fc5b14da25a7c7dba3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b43a480aacc197a275e9c8d1a6451cff3c449050", "url": "https://github.com/apache/kafka/commit/b43a480aacc197a275e9c8d1a6451cff3c449050", "message": "Bruno's comments", "committedDate": "2020-12-15T15:42:38Z", "type": "commit"}]}