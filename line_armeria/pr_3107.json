{"pr_number": 3107, "pr_title": "Test failure: com.linecorp.armeria.spring.ArmeriaAutoConfigurationWithoutMeterTest", "pr_author": "heowc", "pr_createdAt": "2020-10-12T13:36:14Z", "pr_url": "https://github.com/line/armeria/pull/3107", "timeline": [{"oid": "6660b0b11bb16a85aed3c7d53b50af5eff07e557", "url": "https://github.com/line/armeria/commit/6660b0b11bb16a85aed3c7d53b50af5eff07e557", "message": "Fix `ArmeriaAutoConfigurationWithoutMeterTest`", "committedDate": "2020-10-12T13:30:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYzMDU0NQ==", "url": "https://github.com/line/armeria/pull/3107#discussion_r503630545", "body": "Sometimes, it takes time to collect metrics by Micrometer and expose them.\r\n\r\nHow about using Awaitility?\r\n```java\r\nawait().untilAsserted(() -> {\r\n\tfinal AggregatedHttpResponse msg = WebClient.of(newUrl(\"h1c\"))\r\n    ...\r\n    assertThat(...)\r\n});\r\n```", "bodyText": "Sometimes, it takes time to collect metrics by Micrometer and expose them.\nHow about using Awaitility?\nawait().untilAsserted(() -> {\n\tfinal AggregatedHttpResponse msg = WebClient.of(newUrl(\"h1c\"))\n    ...\n    assertThat(...)\n});", "bodyHTML": "<p dir=\"auto\">Sometimes, it takes time to collect metrics by Micrometer and expose them.</p>\n<p dir=\"auto\">How about using Awaitility?</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"await().untilAsserted(() -&gt; {\n\tfinal AggregatedHttpResponse msg = WebClient.of(newUrl(&quot;h1c&quot;))\n    ...\n    assertThat(...)\n});\n\"><pre>await()<span class=\"pl-k\">.</span>untilAsserted(() <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> {\n\t<span class=\"pl-k\">final</span> <span class=\"pl-smi\">AggregatedHttpResponse</span> msg <span class=\"pl-k\">=</span> <span class=\"pl-smi\">WebClient</span><span class=\"pl-k\">.</span>of(newUrl(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>h1c<span class=\"pl-pds\">\"</span></span>))\n    <span class=\"pl-c1\">...</span>\n    assertThat(<span class=\"pl-c1\">...</span>)\n});</pre></div>", "author": "ikhoon", "createdAt": "2020-10-13T02:26:26Z", "path": "spring/boot2-autoconfigure/src/test/java/com/linecorp/armeria/spring/ArmeriaAutoConfigurationWithoutMeterTest.java", "diffHunk": "@@ -72,16 +68,10 @@ private String newUrl(String scheme) {\n \n     @Test\n     public void test() {\n-        final AggregatedHttpResponse msg = WebClient.of(newUrl(\"h1c\"))\n-                                                    .get(\"/ok\")\n-                                                    .aggregate().join();\n-        assertThat(msg.status()).isEqualTo(HttpStatus.OK);\n-        assertThat(msg.contentUtf8()).isEqualTo(\"ok\");\n-\n         final String metricReport = WebClient.of(newUrl(\"http\"))\n                                              .get(\"/internal/metrics\")\n                                              .aggregate().join()\n                                              .contentUtf8();\n-        assertThat(metricReport).contains(\"# TYPE armeria_server_response_duration_seconds_max gauge\");\n+        assertThat(metricReport).contains(\"# TYPE armeria_server_connections gauge\");", "originalCommit": "6660b0b11bb16a85aed3c7d53b50af5eff07e557", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1MzcyMg==", "url": "https://github.com/line/armeria/pull/3107#discussion_r503653722", "bodyText": "Fixed \ud83d\ude04", "author": "heowc", "createdAt": "2020-10-13T04:01:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYzMDU0NQ=="}], "type": "inlineReview"}, {"oid": "6c614fef2c207e1c8563d1b50bd9f952f0d0d032", "url": "https://github.com/line/armeria/commit/6c614fef2c207e1c8563d1b50bd9f952f0d0d032", "message": "Address comments by @ikhoon", "committedDate": "2020-10-13T04:00:33Z", "type": "commit"}]}