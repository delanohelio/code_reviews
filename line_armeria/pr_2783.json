{"pr_number": 2783, "pr_title": "Support java.time.Period type for `@Param` annotation", "pr_author": "ghkim3221", "pr_createdAt": "2020-06-06T16:16:17Z", "pr_url": "https://github.com/line/armeria/pull/2783", "timeline": [{"oid": "a384736a0500d4cfad176027a4d8620d1263b3d6", "url": "https://github.com/line/armeria/commit/a384736a0500d4cfad176027a4d8620d1263b3d6", "message": "Add Period to supported element types", "committedDate": "2020-06-06T14:11:30Z", "type": "commit"}, {"oid": "8a49b87dd72871b32bfeb4183916d3bedf5f4a06", "url": "https://github.com/line/armeria/commit/8a49b87dd72871b32bfeb4183916d3bedf5f4a06", "message": "Add Period to annotated value resolver tests", "committedDate": "2020-06-06T14:11:30Z", "type": "commit"}, {"oid": "dc9b08a8f910f17aa9cfd688b868c3781941753f", "url": "https://github.com/line/armeria/commit/dc9b08a8f910f17aa9cfd688b868c3781941753f", "message": "Add Period to annotated DocService tests", "committedDate": "2020-06-06T14:11:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MTU4Mg==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436281582", "body": "Could you update the documentation?\r\nhttps://github.com/line/armeria/blob/2f270812aab77dd436a74b6a8d8223f0f05fc65c/site/src/pages/docs/server-annotated-service.mdx#L177-L186", "bodyText": "Could you update the documentation?\n\n  \n    \n      armeria/site/src/pages/docs/server-annotated-service.mdx\n    \n    \n        Lines 177 to 186\n      in\n      2f27081\n    \n    \n    \n    \n\n        \n          \n           - `boolean` or `Boolean` \n        \n\n        \n          \n           - `byte` or `Byte` \n        \n\n        \n          \n           - `short` or `Short` \n        \n\n        \n          \n           - `integer` or `Integer` \n        \n\n        \n          \n           - `long` or `Long` \n        \n\n        \n          \n           - `float` or `Float` \n        \n\n        \n          \n           - `double` or `Double` \n        \n\n        \n          \n           - `String` \n        \n\n        \n          \n           - `Enum` \n        \n\n        \n          \n           - `UUID`", "bodyHTML": "<p dir=\"auto\">Could you update the documentation?<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/line/armeria/blob/2f270812aab77dd436a74b6a8d8223f0f05fc65c/site/src/pages/docs/server-annotated-service.mdx#L177-L186\">armeria/site/src/pages/docs/server-annotated-service.mdx</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 177 to 186\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/line/armeria/commit/2f270812aab77dd436a74b6a8d8223f0f05fc65c\">2f27081</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L177\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"177\"></td>\n          <td id=\"LC177\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`boolean`</span> or <span class=\"pl-c1\">`Boolean`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L178\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"178\"></td>\n          <td id=\"LC178\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`byte`</span> or <span class=\"pl-c1\">`Byte`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L179\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"179\"></td>\n          <td id=\"LC179\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`short`</span> or <span class=\"pl-c1\">`Short`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L180\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"180\"></td>\n          <td id=\"LC180\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`integer`</span> or <span class=\"pl-c1\">`Integer`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L181\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"181\"></td>\n          <td id=\"LC181\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`long`</span> or <span class=\"pl-c1\">`Long`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L182\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"182\"></td>\n          <td id=\"LC182\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`float`</span> or <span class=\"pl-c1\">`Float`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L183\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"183\"></td>\n          <td id=\"LC183\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`double`</span> or <span class=\"pl-c1\">`Double`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L184\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"184\"></td>\n          <td id=\"LC184\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`String`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L185\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"185\"></td>\n          <td id=\"LC185\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`Enum`</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L186\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"186\"></td>\n          <td id=\"LC186\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">-</span> <span class=\"pl-c1\">`UUID`</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "author": "ikhoon", "createdAt": "2020-06-06T16:29:20Z", "path": "core/src/main/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceTypeUtil.java", "diffHunk": "@@ -50,6 +51,7 @@\n                     .put(Double.class, Double::valueOf)\n                     .put(String.class, Function.identity())\n                     .put(UUID.class, UUID::fromString)\n+                    .put(Period.class, Period::parse)", "originalCommit": "dc9b08a8f910f17aa9cfd688b868c3781941753f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjcxNA==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436282714", "bodyText": "OMG, thanks!", "author": "ghkim3221", "createdAt": "2020-06-06T16:44:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MTU4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436282339", "body": "Do we need to add a `DocService` test?\r\nI think we can test the `Period` converter by registering an annotated service that takes a Period as a `@Param` and calling it by a `WebClient`.\r\n\r\nFor example:\r\nhttps://github.com/line/armeria/blob/52fd3612fd38a7f5c8c2da235b8cc65e15bfd702/core/src/test/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceRequestConverterTest.java#L917-L923", "bodyText": "Do we need to add a DocService test?\nI think we can test the Period converter by registering an annotated service that takes a Period as a @Param and calling it by a WebClient.\nFor example:\n\n  \n    \n      armeria/core/src/test/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceRequestConverterTest.java\n    \n    \n        Lines 917 to 923\n      in\n      52fd361\n    \n    \n    \n    \n\n        \n          \n           @Test \n        \n\n        \n          \n           void testDefaultRequestConverter_uuid() { \n        \n\n        \n          \n               final WebClient client = WebClient.of(server.httpUri()); \n        \n\n        \n          \n               final UUID uuid = UUID.randomUUID(); \n        \n\n        \n          \n               final AggregatedHttpResponse response = client.get(\"/2/default/uuid/\" + uuid).aggregate().join(); \n        \n\n        \n          \n               assertThat(response.contentUtf8()).isEqualTo(uuid.toString()); \n        \n\n        \n          \n           }", "bodyHTML": "<p dir=\"auto\">Do we need to add a <code>DocService</code> test?<br>\nI think we can test the <code>Period</code> converter by registering an annotated service that takes a Period as a <code>@Param</code> and calling it by a <code>WebClient</code>.</p>\n<p dir=\"auto\">For example:<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/line/armeria/blob/52fd3612fd38a7f5c8c2da235b8cc65e15bfd702/core/src/test/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceRequestConverterTest.java#L917-L923\">armeria/core/src/test/java/com/linecorp/armeria/internal/server/annotation/AnnotatedServiceRequestConverterTest.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 917 to 923\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/line/armeria/commit/52fd3612fd38a7f5c8c2da235b8cc65e15bfd702\">52fd361</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L917\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"917\"></td>\n          <td id=\"LC917\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">@Test</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L918\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"918\"></td>\n          <td id=\"LC918\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">void</span> <span class=\"pl-en\">testDefaultRequestConverter_uuid</span>() { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L919\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"919\"></td>\n          <td id=\"LC919\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">final</span> <span class=\"pl-smi\">WebClient</span> client <span class=\"pl-k\">=</span> <span class=\"pl-smi\">WebClient</span><span class=\"pl-k\">.</span>of(server<span class=\"pl-k\">.</span>httpUri()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L920\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"920\"></td>\n          <td id=\"LC920\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">final</span> <span class=\"pl-smi\">UUID</span> uuid <span class=\"pl-k\">=</span> <span class=\"pl-c1\">UUID</span><span class=\"pl-k\">.</span>randomUUID(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L921\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"921\"></td>\n          <td id=\"LC921\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">final</span> <span class=\"pl-smi\">AggregatedHttpResponse</span> response <span class=\"pl-k\">=</span> client<span class=\"pl-k\">.</span>get(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/2/default/uuid/<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> uuid)<span class=\"pl-k\">.</span>aggregate()<span class=\"pl-k\">.</span>join(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L922\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"922\"></td>\n          <td id=\"LC922\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     assertThat(response<span class=\"pl-k\">.</span>contentUtf8())<span class=\"pl-k\">.</span>isEqualTo(uuid<span class=\"pl-k\">.</span>toString()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L923\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"923\"></td>\n          <td id=\"LC923\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "author": "ikhoon", "createdAt": "2020-06-06T16:39:43Z", "path": "core/src/test/java/com/linecorp/armeria/internal/server/annotation/AnnotatedDocServiceTest.java", "diffHunk": "@@ -307,6 +309,19 @@ private static void addJsonMethodInfo(Map<Class<?>, Set<MethodInfo>> methodInfos\n         methods.add(methodInfo2);\n     }\n \n+    private static void addPeriodMethodInfo(Map<Class<?>, Set<MethodInfo>> methodInfos) {", "originalCommit": "dc9b08a8f910f17aa9cfd688b868c3781941753f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4Mzk1NA==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436283954", "bodyText": "I added DocService test because @minwoox's suggestion. (Did I understand wrong?)\nAnd I add test case for converting. Thank you for kind instructions.", "author": "ghkim3221", "createdAt": "2020-06-06T17:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyOTc5OQ==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436429799", "bodyText": "I see. I missed the comment.", "author": "ikhoon", "createdAt": "2020-06-08T02:16:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQzMzQ5NA==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436433494", "bodyText": "What I meant was that we need to check whether the type is rendered well or not on the DocService page.\nI have checked it and it seems OK. Thanks!", "author": "minwoox", "createdAt": "2020-06-08T02:40:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY4MjM4MQ==", "url": "https://github.com/line/armeria/pull/2783#discussion_r436682381", "bodyText": "I see. Thanks!", "author": "ghkim3221", "createdAt": "2020-06-08T13:08:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI4MjMzOQ=="}], "type": "inlineReview"}, {"oid": "9d6d50e45d2bfa3b014f26ecb4c083c493baba52", "url": "https://github.com/line/armeria/commit/9d6d50e45d2bfa3b014f26ecb4c083c493baba52", "message": "Update document", "committedDate": "2020-06-06T16:44:37Z", "type": "commit"}, {"oid": "ff70e8fdae6a9828b5c9121a126549c2c555c3f4", "url": "https://github.com/line/armeria/commit/ff70e8fdae6a9828b5c9121a126549c2c555c3f4", "message": "Add test case for converting Period in annotated service", "committedDate": "2020-06-06T16:58:36Z", "type": "commit"}]}