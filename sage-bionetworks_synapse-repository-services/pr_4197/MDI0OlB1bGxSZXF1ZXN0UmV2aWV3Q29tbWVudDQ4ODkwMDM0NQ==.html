<html>
<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css" />
  <!--diff2html-css-->
  <!--diff2html-js-ui-->
  <link rel="stylesheet" href="https://rawcdn.githack.com/jasonm23/markdown-css-themes/a2b4fd6d5627e4536a789b1feb46d94cd841f164/markdown.css" />
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const targetElement = document.getElementById('diff');
      const diff2htmlUi = new Diff2HtmlUI(targetElement);
      diff2html-fileListToggle
      //diff2html-synchronisedScroll
      //diff2html-highlightCode
    });
  </script>
  <style>
    body {
      width: 90%;
      max-width: unset;
    }
    pre code {
      display: block;
      background: #E8E8E8;
      font-size: small;
      white-space: pre;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      max-width: 100%;
      min-width: 100px;
      max-height: 250px;
      padding: 0;
    }
  </style>
</head>

<body>
<h2>sage-bionetworks/synapse-repository-services - PR 4197</h2>
<p><strong>Title</strong>: added support for &#x27;required&#x27; with test</p>
<h3>Code Review</h3>
<p>Inline Review ID - <a href="https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4197#discussion_r488900345">MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwMDM0NQ==</a></p>
<p>Original Commit - <a href="https://github.com/sage-bionetworks/synapse-repository-services/commit/cb85a0c36f3f782ef015b68e6a7acd2e52946310">cb85a0c36f3f782ef015b68e6a7acd2e52946310</a></p>
<pre><code>services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/schema/JsonSchemaValidationManagerImplTest.java

@@ -141,6 +141,93 @@ public void testValidationWithSourced() throws Exception {
        assertNull(result.getValidationException());
    }

+   /**
+    * Test for PLFM-6316 to add the &#x27;required&#x27; key word.
+    */
+   @Test
+   public void testValidationWithRequiredWithRequired() throws Exception {
+       JsonSchema schema = loadSchemaFromClasspath(&quot;schemas/HasRequired.json&quot;);
+       assertNotNull(schema.getProperties());
+       assertEquals(3, schema.getProperties().size());
+       List&lt;String&gt; requiredValues = schema.getRequired();
+       assertNotNull(requiredValues);
+       assertEquals(Lists.newArrayList(&quot;requireMe&quot;,&quot;requireMeToo&quot;), schema.getRequired());
+       
+       // include all three values for this test
+       JsonSubject subject = setupSubject();
+       subject.toJson().put(&quot;requireMe&quot;, &quot;one&quot;);
+       subject.toJson().put(&quot;requireMeToo&quot;, &quot;two&quot;);
+       subject.toJson().put(&quot;notRequired&quot;, &quot;two&quot;);
+
+       // call under test
+       ValidationResults result = manager.validate(schema, subject);
+
+       assertNotNull(result);
+       assertEquals(objectId, result.getObjectId());
+       assertEquals(objectType, result.getObjectType());
+       assertEquals(objectEtag, result.getObjectEtag());
+       assertTrue(result.getIsValid());
+       assertNotNull(result.getValidatedOn());
+       assertNull(result.getValidationErrorMessage());
+       assertNull(result.getAllValidationMessages());
+       assertNull(result.getValidationException());
+   }
+   
+   @Test
+   public void testValidationWithRequiredWithOutRequired() throws Exception {
+       JsonSchema schema = loadSchemaFromClasspath(&quot;schemas/HasRequired.json&quot;);
+       assertNotNull(schema.getProperties());
+       assertEquals(3, schema.getProperties().size());
+       List&lt;String&gt; requiredValues = schema.getRequired();
+       assertNotNull(requiredValues);
+       assertEquals(Lists.newArrayList(&quot;requireMe&quot;,&quot;requireMeToo&quot;), schema.getRequired());
+       
+       // exclude the optional value
+       JsonSubject subject = setupSubject();
+       subject.toJson().put(&quot;requireMe&quot;, &quot;one&quot;);
+       subject.toJson().put(&quot;requireMeToo&quot;, &quot;two&quot;);
+
+       // call under test
+       ValidationResults result = manager.validate(schema, subject);
+
+       assertNotNull(result);
+       assertEquals(objectId, result.getObjectId());
+       assertEquals(objectType, result.getObjectType());
+       assertEquals(objectEtag, result.getObjectEtag());
+       assertTrue(result.getIsValid());
+       assertNotNull(result.getValidatedOn());
+       assertNull(result.getValidationErrorMessage());
+       assertNull(result.getAllValidationMessages());
+       assertNull(result.getValidationException());
+   }
+   
+   @Test
+   public void testValidationWithRequiredWithMissingRequired() throws Exception {
+       JsonSchema schema = loadSchemaFromClasspath(&quot;schemas/HasRequired.json&quot;);
+       assertNotNull(schema.getProperties());
+       assertEquals(3, schema.getProperties().size());
+       List&lt;String&gt; requiredValues = schema.getRequired();
+       assertNotNull(requiredValues);
+       assertEquals(Lists.newArrayList(&quot;requireMe&quot;,&quot;requireMeToo&quot;), schema.getRequired());
+       
+       // include the optional but exclude one of the required
+       JsonSubject subject = setupSubject();
+       subject.toJson().put(&quot;requireMe&quot;, &quot;one&quot;);
+       subject.toJson().put(&quot;notRequired&quot;, &quot;two&quot;);
+
+       // call under test
+       ValidationResults result = manager.validate(schema, subject);
+
+       assertNotNull(result);
+       assertEquals(objectId, result.getObjectId());
+       assertEquals(objectType, result.getObjectType());
+       assertEquals(objectEtag, result.getObjectEtag());
+       assertFalse(result.getIsValid());
+       assertNotNull(result.getValidatedOn());
+       assertEquals(&quot;required key [requireMeToo] not found&quot;, result.getValidationErrorMessage());
+   }</code></pre>
<blockquote>
<p><strong>marcomarasca</strong>: We might want to add a test where a hierarchy of schemas is setup and the required property overrides the parent?</p>
</blockquote>
<h3>Improved Code</h3>
<p>Not found</p>

<div id="diff">
  <!--diff2html-diff-->
</div>

</body>

</html>
