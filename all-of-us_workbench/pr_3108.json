{"pr_number": 3108, "pr_title": "[RW-4315][risk=no] Distribution metrics and timing functions using Logs-based metrics", "pr_author": "jaycarlton", "pr_createdAt": "2020-02-09T22:31:53Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3108", "merge_commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "timeline": [{"oid": "e9ecba49f88353095f4735bafd400dcce37b181f", "url": "https://github.com/all-of-us/workbench/commit/e9ecba49f88353095f4735bafd400dcce37b181f", "message": "distribution stuff", "committedDate": "2020-01-28T17:45:35Z", "type": "commit"}, {"oid": "c558810c3ba6f04f628bc205fcf2c37e549660de", "url": "https://github.com/all-of-us/workbench/commit/c558810c3ba6f04f628bc205fcf2c37e549660de", "message": "typo & spt", "committedDate": "2020-01-28T18:01:45Z", "type": "commit"}, {"oid": "26266d4f45b4649de6e0e91d530dd1cc63681027", "url": "https://github.com/all-of-us/workbench/commit/26266d4f45b4649de6e0e91d530dd1cc63681027", "message": "start recording all workspaces api methods", "committedDate": "2020-01-28T19:56:52Z", "type": "commit"}, {"oid": "a2007eb7c9dbb74db93dbcd500db4b5cea992522", "url": "https://github.com/all-of-us/workbench/commit/a2007eb7c9dbb74db93dbcd500db4b5cea992522", "message": "refactoring some  more", "committedDate": "2020-01-28T21:58:55Z", "type": "commit"}, {"oid": "1d1e71c0f5d3f117399cb37f7a20bb7181d113b7", "url": "https://github.com/all-of-us/workbench/commit/1d1e71c0f5d3f117399cb37f7a20bb7181d113b7", "message": "some more instrumentation", "committedDate": "2020-01-28T22:29:56Z", "type": "commit"}, {"oid": "b4c0d81d54b0ed97828dfcef0fd713f1530b770b", "url": "https://github.com/all-of-us/workbench/commit/b4c0d81d54b0ed97828dfcef0fd713f1530b770b", "message": "more timings and spotless", "committedDate": "2020-01-28T22:36:31Z", "type": "commit"}, {"oid": "c425152678f3df93c86d3764df5a31ff162fb035", "url": "https://github.com/all-of-us/workbench/commit/c425152678f3df93c86d3764df5a31ff162fb035", "message": "add timings to cohort controller", "committedDate": "2020-01-28T22:44:19Z", "type": "commit"}, {"oid": "d5edf7cee5db10ebb910d4bba9e61d3809e9b09b", "url": "https://github.com/all-of-us/workbench/commit/d5edf7cee5db10ebb910d4bba9e61d3809e9b09b", "message": "debug code", "committedDate": "2020-01-29T03:15:42Z", "type": "commit"}, {"oid": "a309953a3be03555aea41482a9397a35148148f8", "url": "https://github.com/all-of-us/workbench/commit/a309953a3be03555aea41482a9397a35148148f8", "message": "some  renames", "committedDate": "2020-01-29T14:45:28Z", "type": "commit"}, {"oid": "6041d3eba630f1120f0f306271d3c4b08dc29cad", "url": "https://github.com/all-of-us/workbench/commit/6041d3eba630f1120f0f306271d3c4b08dc29cad", "message": "merge & fixup", "committedDate": "2020-01-29T21:59:30Z", "type": "commit"}, {"oid": "1b4cf8b7a9474de5a8e19c4ac46ab10462992231", "url": "https://github.com/all-of-us/workbench/commit/1b4cf8b7a9474de5a8e19c4ac46ab10462992231", "message": "mismerge - sort out later", "committedDate": "2020-02-07T16:11:06Z", "type": "commit"}, {"oid": "d120f33671681fe59759651cdc25f71a871d7727", "url": "https://github.com/all-of-us/workbench/commit/d120f33671681fe59759651cdc25f71a871d7727", "message": "cleanup merge && spotless", "committedDate": "2020-02-07T16:19:39Z", "type": "commit"}, {"oid": "18f50e3e448d311b74211e5a87642c776bbc79a0", "url": "https://github.com/all-of-us/workbench/commit/18f50e3e448d311b74211e5a87642c776bbc79a0", "message": "delete temp merge files", "committedDate": "2020-02-07T16:23:29Z", "type": "commit"}, {"oid": "d05dbedddcfb3afabf5196dd2c84239caa324131", "url": "https://github.com/all-of-us/workbench/commit/d05dbedddcfb3afabf5196dd2c84239caa324131", "message": "more merge fixes", "committedDate": "2020-02-07T16:48:35Z", "type": "commit"}, {"oid": "df41bcc5018d21e49f45381e8944374978fd4ebc", "url": "https://github.com/all-of-us/workbench/commit/df41bcc5018d21e49f45381e8944374978fd4ebc", "message": "progress", "committedDate": "2020-02-07T20:04:01Z", "type": "commit"}, {"oid": "cb3314159d4247a910314678c4c88ff993187186", "url": "https://github.com/all-of-us/workbench/commit/cb3314159d4247a910314678c4c88ff993187186", "message": "some changes", "committedDate": "2020-02-08T00:05:39Z", "type": "commit"}, {"oid": "cbdf296209a9d6b83b2b543e2ca6b97b06df0b6e", "url": "https://github.com/all-of-us/workbench/commit/cbdf296209a9d6b83b2b543e2ca6b97b06df0b6e", "message": "tests", "committedDate": "2020-02-09T14:19:49Z", "type": "commit"}, {"oid": "7a25b93a2a4ae84acd6d10458939321b4dc0da03", "url": "https://github.com/all-of-us/workbench/commit/7a25b93a2a4ae84acd6d10458939321b4dc0da03", "message": "test fixes & merge fixes", "committedDate": "2020-02-09T20:26:48Z", "type": "commit"}, {"oid": "e98130c2079bd68c4734a392a050626b84971634", "url": "https://github.com/all-of-us/workbench/commit/e98130c2079bd68c4734a392a050626b84971634", "message": "more tests", "committedDate": "2020-02-10T14:21:31Z", "type": "commit"}, {"oid": "4f89bdc0ae20b72df9b56c4554f5a543ec008515", "url": "https://github.com/all-of-us/workbench/commit/4f89bdc0ae20b72df9b56c4554f5a543ec008515", "message": "restore status ctrlr", "committedDate": "2020-02-10T14:48:55Z", "type": "commit"}, {"oid": "541f5bad9892ecbbcc968e563d195683fa810f45", "url": "https://github.com/all-of-us/workbench/commit/541f5bad9892ecbbcc968e563d195683fa810f45", "message": "restore cohorts stuff", "committedDate": "2020-02-10T14:53:01Z", "type": "commit"}, {"oid": "027db8bc5acd31adb67da4bd4fb28a191370bcd4", "url": "https://github.com/all-of-us/workbench/commit/027db8bc5acd31adb67da4bd4fb28a191370bcd4", "message": "restore .gitignore", "committedDate": "2020-02-10T14:53:33Z", "type": "commit"}, {"oid": "359f813f5e741d5e3097cee648a32164e412398f", "url": "https://github.com/all-of-us/workbench/commit/359f813f5e741d5e3097cee648a32164e412398f", "message": "log levels", "committedDate": "2020-02-10T20:30:15Z", "type": "commit"}, {"oid": "dac70bc595aaa2cc35172928901e28d673fbb425", "url": "https://github.com/all-of-us/workbench/commit/dac70bc595aaa2cc35172928901e28d673fbb425", "message": "cleanup", "committedDate": "2020-02-11T02:05:22Z", "type": "commit"}, {"oid": "a163259fbbd47ede8f25f0ea80994984ce7b1fa4", "url": "https://github.com/all-of-us/workbench/commit/a163259fbbd47ede8f25f0ea80994984ce7b1fa4", "message": "mock fixes", "committedDate": "2020-02-11T02:43:08Z", "type": "commit"}, {"oid": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "url": "https://github.com/all-of-us/workbench/commit/78171accb6e37a5939b7cb97beafffb9288ba1ee", "message": "pull out implementation  methods to go to service & minimize diff", "committedDate": "2020-02-11T12:33:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwOTI3MQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377609271", "body": "todo: return just the workspaceResponse here and build OK at outer level. same below.", "bodyText": "todo: return just the workspaceResponse here and build OK at outer level. same below.", "bodyHTML": "<p dir=\"auto\">todo: return just the workspaceResponse here and build OK at outer level. same below.</p>", "author": "jaycarlton", "createdAt": "2020-02-11T12:40:11Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -359,27 +386,45 @@ private void setDbWorkspaceFields(\n     dbWorkspace = workspaceService.saveWithLastModified(dbWorkspace);\n     workspaceService.maybeDeleteRecentWorkspace(dbWorkspace.getWorkspaceId());\n     workspaceAuditor.fireDeleteAction(dbWorkspace);\n-    return ResponseEntity.ok(new EmptyResponse());\n   }\n \n   @Override\n   public ResponseEntity<WorkspaceResponse> getWorkspace(\n       String workspaceNamespace, String workspaceId) {\n-    return ResponseEntity.ok(workspaceService.getWorkspace(workspaceNamespace, workspaceId));\n+    final WorkspaceResponse workspaceResponse =\n+        logsBasedMetricService.recordElapsedTime(\n+            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"getWorkspace\"),\n+            DistributionMetric.WORKSPACE_OPERATION_TIME,\n+            () -> workspaceService.getWorkspace(workspaceNamespace, workspaceId));\n+    return ResponseEntity.ok(workspaceResponse);", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NzA0NA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377947044", "bodyText": "Maybe as part of a future refactoring of these to a Service?  not sure it makes sense in this PR - let's keep this one focused.", "author": "jmthibault79", "createdAt": "2020-02-11T22:50:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwOTI3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI3MDQ0NQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378270445", "bodyText": "for consistency with the other lambdas, the  impl functions I pulled out are exactly what would go into the service (returning an API object instead of a ResponseEntity, which is controller business). You can use these methods without doing (with a big lambda), but it made the diff huge.", "author": "jaycarlton", "createdAt": "2020-02-12T14:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwOTI3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..83afa22f3 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -391,23 +385,15 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n   @Override\n   public ResponseEntity<WorkspaceResponse> getWorkspace(\n       String workspaceNamespace, String workspaceId) {\n-    final WorkspaceResponse workspaceResponse =\n-        logsBasedMetricService.recordElapsedTime(\n-            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"getWorkspace\"),\n-            DistributionMetric.WORKSPACE_OPERATION_TIME,\n-            () -> workspaceService.getWorkspace(workspaceNamespace, workspaceId));\n-    return ResponseEntity.ok(workspaceResponse);\n+    return ResponseEntity.ok(\n+        recordOperationTime(\n+            () -> workspaceService.getWorkspace(workspaceNamespace, workspaceId), \"getWorkspace\"));\n   }\n \n   @Override\n   public ResponseEntity<WorkspaceResponseListResponse> getWorkspaces() {\n-    WorkspaceResponseListResponse response = new WorkspaceResponseListResponse();\n-    List<WorkspaceResponse> workspaces =\n-        logsBasedMetricService.recordElapsedTime(\n-            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"getWorkspaces\"),\n-            DistributionMetric.WORKSPACE_OPERATION_TIME,\n-            workspaceService::getWorkspaces);\n-    response.setItems(workspaces);\n+    final WorkspaceResponseListResponse response = new WorkspaceResponseListResponse();\n+    response.setItems(recordOperationTime(workspaceService::getWorkspaces, \"getWorkspaces\"));\n     return ResponseEntity.ok(response);\n   }\n \n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -391,23 +390,15 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n   @Override\n   public ResponseEntity<WorkspaceResponse> getWorkspace(\n       String workspaceNamespace, String workspaceId) {\n-    final WorkspaceResponse workspaceResponse =\n-        logsBasedMetricService.recordElapsedTime(\n-            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"getWorkspace\"),\n-            DistributionMetric.WORKSPACE_OPERATION_TIME,\n-            () -> workspaceService.getWorkspace(workspaceNamespace, workspaceId));\n-    return ResponseEntity.ok(workspaceResponse);\n+    return ResponseEntity.ok(\n+        recordOperationTime(\n+            () -> workspaceService.getWorkspace(workspaceNamespace, workspaceId), \"getWorkspace\"));\n   }\n \n   @Override\n   public ResponseEntity<WorkspaceResponseListResponse> getWorkspaces() {\n-    WorkspaceResponseListResponse response = new WorkspaceResponseListResponse();\n-    List<WorkspaceResponse> workspaces =\n-        logsBasedMetricService.recordElapsedTime(\n-            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"getWorkspaces\"),\n-            DistributionMetric.WORKSPACE_OPERATION_TIME,\n-            workspaceService::getWorkspaces);\n-    response.setItems(workspaces);\n+    final WorkspaceResponseListResponse response = new WorkspaceResponseListResponse();\n+    response.setItems(recordOperationTime(workspaceService::getWorkspaces, \"getWorkspaces\"));\n     return ResponseEntity.ok(response);\n   }\n \n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzNTU1OQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377935559", "body": "Is there a need for both?", "bodyText": "Is there a need for both?", "bodyHTML": "<p dir=\"auto\">Is there a need for both?</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:23:08Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricService.java", "diffHunk": "@@ -28,4 +31,30 @@\n   default void recordEvent(EventMetric eventMetric) {\n     record(MeasurementBundle.builder().addEvent(eventMetric).build());\n   }\n+  /**\n+   * Use a Stopwatch to time the supplied operation, then add a measurement to the supplied\n+   * measurementBundleBuilder and record the associated DistributionMetric.\n+   *\n+   * @param measurementBundleBuilder - Builder for a MeasurementBundle to be recorded. Typically\n+   *     only has tags.\n+   * @param distributionMetric - Metric to be recorded. Always a distribution, as gauge and count\n+   *     don't make sense for timings\n+   * @param operation - Code to be run, e.g. () -> myService.computeThings()\n+   */\n+  void recordElapsedTime(\n+      Builder measurementBundleBuilder, DistributionMetric distributionMetric, Runnable operation);\n+\n+  /**\n+   * Same as above, but returns the result of the operation", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2NzIxNA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378267214", "bodyText": "Yes, AFAICT, the compiler won't allow a Supplier to have its value returned.\nYou could argue it shouldn't be an overload, to make it more obvious which one is used.", "author": "jaycarlton", "createdAt": "2020-02-12T14:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzNTU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMxNjk1Ng==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378316956", "bodyText": "Confirmed by commenting out the Runnable version. You can't have a void-valued argument passed in as a runnable.", "author": "jaycarlton", "createdAt": "2020-02-12T15:17:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzNTU1OQ=="}], "type": "inlineReview", "revised_code": null, "revised_code_in_main": null, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzOTE0Mw==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377939143", "body": "Please add comments describing what this enum is and what its values mean", "bodyText": "Please add comments describing what this enum is and what its values mean", "bodyHTML": "<p dir=\"auto\">Please add comments describing what this enum is and what its values mean</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:31:29Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package org.pmiops.workbench.monitoring.views;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.opencensus.stats.Aggregation;\n+import io.opencensus.stats.Aggregation.Distribution;\n+import io.opencensus.stats.BucketBoundaries;\n+\n+public enum DistributionAggregation {", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMyMTg1Mw==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378321853", "bodyText": "\ud83d\udc4d", "author": "jaycarlton", "createdAt": "2020-02-12T15:25:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzOTE0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\nindex ce5c32fc2..eaa5b804a 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n", "chunk": "@@ -5,19 +5,27 @@ import io.opencensus.stats.Aggregation;\n import io.opencensus.stats.Aggregation.Distribution;\n import io.opencensus.stats.BucketBoundaries;\n \n+/**\n+ * Aggregation values to use with OpenCensus Distribution metrics. The bucket bounadries are inner\n+ * boundaries, so a list of [0.25, 0.50, 0.75] would actually make 5 buckets, with the lowest being\n+ * [0.0, 0.25), [0.25, 0.5), [0.5, 0.75), [0.75, MAX_DOUBLE].\n+ *\n+ * <p>Note: These buckets are provided for use with OpenCenss distribution metrics, which are not\n+ * currenlty in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n+ * Logs-based workaround to be a drop-in replacement as much as possible, I decided to keep them\n+ * around until we have a resolution on the OpenCenss issues.\n+ */\n public enum DistributionAggregation {\n   RANDOM_DOUBLE(\n       UnitOfMeasure.COUNT,\n       Aggregation.Distribution.create(\n-          BucketBoundaries.create(\n-              ImmutableList.of(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0)))),\n+          BucketBoundaries.create(ImmutableList.of(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)))),\n   OPERATION_TIME(\n       UnitOfMeasure.MILLISECOND,\n       Aggregation.Distribution.create(\n           BucketBoundaries.create(\n               ImmutableList.of(\n-                  0.0, 25.0, 50.0, 75.0, 100.0, 200.0, 400.0, 600.0, 800.0, 1000.0, 2000.0, 4000.0,\n-                  6000.0))));\n+                  25.0, 50.0, 75.0, 100.0, 200.0, 400.0, 600.0, 800.0, 1000.0, 2000.0, 4000.0))));\n \n   private final UnitOfMeasure unitOfMeasure;\n   private final Aggregation.Distribution distribution;\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\nindex ce5c32fc2..bef34ea64 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n", "chunk": "@@ -5,19 +5,27 @@ import io.opencensus.stats.Aggregation;\n import io.opencensus.stats.Aggregation.Distribution;\n import io.opencensus.stats.BucketBoundaries;\n \n+/**\n+ * Aggregation values to use with OpenCensus Distribution metrics. The bucket boundaries are inner\n+ * boundaries, so a list of [0.25, 0.50, 0.75] would actually make 5 buckets, with the lowest being\n+ * [0.0, 0.25), [0.25, 0.5), [0.5, 0.75), [0.75, MAX_DOUBLE].\n+ *\n+ * <p>Note: These buckets are provided for use with OpenCensus distribution metrics, which are not\n+ * currently in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n+ * Logs-based workaround to be a drop-in replacement as much as possible, I decided to keep them\n+ * around until we have a resolution on the OpenCensus issues.\n+ */\n public enum DistributionAggregation {\n   RANDOM_DOUBLE(\n       UnitOfMeasure.COUNT,\n       Aggregation.Distribution.create(\n-          BucketBoundaries.create(\n-              ImmutableList.of(0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0)))),\n+          BucketBoundaries.create(ImmutableList.of(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)))),\n   OPERATION_TIME(\n       UnitOfMeasure.MILLISECOND,\n       Aggregation.Distribution.create(\n           BucketBoundaries.create(\n               ImmutableList.of(\n-                  0.0, 25.0, 50.0, 75.0, 100.0, 200.0, 400.0, 600.0, 800.0, 1000.0, 2000.0, 4000.0,\n-                  6000.0))));\n+                  25.0, 50.0, 75.0, 100.0, 200.0, 400.0, 600.0, 800.0, 1000.0, 2000.0, 4000.0))));\n \n   private final UnitOfMeasure unitOfMeasure;\n   private final Aggregation.Distribution distribution;\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkzOTk1Ng==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377939956", "body": "Same comment as DistributionAggregation", "bodyText": "Same comment as DistributionAggregation", "bodyHTML": "<p dir=\"auto\">Same comment as DistributionAggregation</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:33:29Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package org.pmiops.workbench.monitoring.views;\n+\n+import io.opencensus.stats.Aggregation;\n+import io.opencensus.stats.Measure.MeasureDouble;\n+import io.opencensus.stats.Measure.MeasureLong;\n+import java.util.Collections;\n+import java.util.List;\n+import org.pmiops.workbench.monitoring.labels.MetricLabel;\n+\n+public enum DistributionMetric implements Metric {", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\nindex b6253642b..5e8bdc0b0 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n", "chunk": "@@ -7,6 +7,18 @@ import java.util.Collections;\n import java.util.List;\n import org.pmiops.workbench.monitoring.labels.MetricLabel;\n \n+/**\n+ * Define info for MetricDescriptors that are aggregated as Distributions (aka percentiles or\n+ * heatmaps). Basically we capture a histogram for each sampled timeseries data point.\n+ *\n+ * <p>Note: We are using this OpenCensus-centric enum with the LogsBasedMetricService workaround so\n+ * that existing (if not yet working) definitions could be reused. In Stackdriver Logging, these\n+ * metrics are always double-valued and the user doesn't specify an aggregation. Also, we do not\n+ * want to register custom metric views for these metrics yet, so they are omitted in\n+ * MonitoringServiceImpl#registerMetricViews() for now. It gets a bit confusing having a logging and\n+ * custom metric with the same name (even if the suffix is logging/user instead of\n+ * custom.googleapis.com/).\n+ */\n public enum DistributionMetric implements Metric {\n   COHORT_OPERATION_TIME(\n       \"cohort_operation_time\",\n", "next_change": {"commit": "7ca640f668ec2443f55de1d7c3d7ed095a867cea", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\nindex 5e8bdc0b0..db5abf006 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n", "chunk": "@@ -26,6 +26,12 @@ public enum DistributionMetric implements Metric {\n       Collections.singletonList(MetricLabel.OPERATION_NAME),\n       DistributionAggregation.OPERATION_TIME,\n       MeasureLong.class),\n+  GAUGE_COLLECTION_TIME(\n+      \"gauge_collection_time\",\n+      \"Time to get data from all gauges\",\n+      Collections.singletonList(MetricLabel.OPERATION_NAME),\n+      DistributionAggregation.OPERATION_TIME,\n+      MeasureLong.class),\n   UNIFORM_RANDOM_SAMPLE(\n       \"random_sample_2\",\n       \"Random values\",\n", "next_change": null}]}}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\nindex b6253642b..db5abf006 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n", "chunk": "@@ -7,6 +7,18 @@ import java.util.Collections;\n import java.util.List;\n import org.pmiops.workbench.monitoring.labels.MetricLabel;\n \n+/**\n+ * Define info for MetricDescriptors that are aggregated as Distributions (aka percentiles or\n+ * heatmaps). Basically we capture a histogram for each sampled timeseries data point.\n+ *\n+ * <p>Note: We are using this OpenCensus-centric enum with the LogsBasedMetricService workaround so\n+ * that existing (if not yet working) definitions could be reused. In Stackdriver Logging, these\n+ * metrics are always double-valued and the user doesn't specify an aggregation. Also, we do not\n+ * want to register custom metric views for these metrics yet, so they are omitted in\n+ * MonitoringServiceImpl#registerMetricViews() for now. It gets a bit confusing having a logging and\n+ * custom metric with the same name (even if the suffix is logging/user instead of\n+ * custom.googleapis.com/).\n+ */\n public enum DistributionMetric implements Metric {\n   COHORT_OPERATION_TIME(\n       \"cohort_operation_time\",\n", "next_change": {"commit": "332cf0d529813bf3a73afea4516a57d5f8a28f75", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\nindex db5abf006..7cb878a3f 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n", "chunk": "@@ -20,6 +21,12 @@ import org.pmiops.workbench.monitoring.labels.MetricLabel;\n  * custom.googleapis.com/).\n  */\n public enum DistributionMetric implements Metric {\n+  API_METHOD_TIME(\n+      \"api_method_time\",\n+      \"Elapsed time for API handling.\",\n+      ImmutableList.of(MetricLabel.OPERATION_NAME, MetricLabel.METHOD_NAME),\n+      DistributionAggregation.OPERATION_TIME,\n+      MeasureLong.class),\n   COHORT_OPERATION_TIME(\n       \"cohort_operation_time\",\n       \"Time to complete Cohort-related operation.\",\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "332cf0d529813bf3a73afea4516a57d5f8a28f75", "committedDate": "2020-02-20 10:52:17 -0500", "message": "[RW-4463][RISK=NO] Interceptor-based logging (#3136)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0MDI5MQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377940291", "body": "why 2?", "bodyText": "why 2?", "bodyHTML": "<p dir=\"auto\">why 2?</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:34:15Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package org.pmiops.workbench.monitoring.views;\n+\n+import io.opencensus.stats.Aggregation;\n+import io.opencensus.stats.Measure.MeasureDouble;\n+import io.opencensus.stats.Measure.MeasureLong;\n+import java.util.Collections;\n+import java.util.List;\n+import org.pmiops.workbench.monitoring.labels.MetricLabel;\n+\n+public enum DistributionMetric implements Metric {\n+  COHORT_OPERATION_TIME(\n+      \"cohort_operation_time\",\n+      \"Time to complete Cohort-related operation.\",\n+      Collections.singletonList(MetricLabel.OPERATION_NAME),\n+      DistributionAggregation.OPERATION_TIME,\n+      MeasureLong.class),\n+  UNIFORM_RANDOM_SAMPLE(\n+      \"random_sample_2\",", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2NzcxNA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378267714", "bodyText": "We have to \"burn\" old metric names when making structural changes, so my convention is to add a number suffix. Definitely something to. put in the docs.", "author": "jaycarlton", "createdAt": "2020-02-12T14:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0MDI5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "7ca640f668ec2443f55de1d7c3d7ed095a867cea", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\nindex b6253642b..db5abf006 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n", "chunk": "@@ -14,6 +26,12 @@ public enum DistributionMetric implements Metric {\n       Collections.singletonList(MetricLabel.OPERATION_NAME),\n       DistributionAggregation.OPERATION_TIME,\n       MeasureLong.class),\n+  GAUGE_COLLECTION_TIME(\n+      \"gauge_collection_time\",\n+      \"Time to get data from all gauges\",\n+      Collections.singletonList(MetricLabel.OPERATION_NAME),\n+      DistributionAggregation.OPERATION_TIME,\n+      MeasureLong.class),\n   UNIFORM_RANDOM_SAMPLE(\n       \"random_sample_2\",\n       \"Random values\",\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\nindex b6253642b..db5abf006 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionMetric.java\n", "chunk": "@@ -14,6 +26,12 @@ public enum DistributionMetric implements Metric {\n       Collections.singletonList(MetricLabel.OPERATION_NAME),\n       DistributionAggregation.OPERATION_TIME,\n       MeasureLong.class),\n+  GAUGE_COLLECTION_TIME(\n+      \"gauge_collection_time\",\n+      \"Time to get data from all gauges\",\n+      Collections.singletonList(MetricLabel.OPERATION_NAME),\n+      DistributionAggregation.OPERATION_TIME,\n+      MeasureLong.class),\n   UNIFORM_RANDOM_SAMPLE(\n       \"random_sample_2\",\n       \"Random values\",\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "332cf0d529813bf3a73afea4516a57d5f8a28f75", "committedDate": "2020-02-20 10:52:17 -0500", "message": "[RW-4463][RISK=NO] Interceptor-based logging (#3136)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0MzM5NQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377943395", "body": "Do we want callers to have to think about `MeasurementBundle.Builder`?  I'd prefer an interface like one of these:\r\n\r\n```\r\nlogsBasedMetricService.recordElapsedTime(\r\n            \"createWorkspace\",\r\n            DistributionMetric.WORKSPACE_OPERATION_TIME,\r\n            () -> createWorkspaceImpl(workspace));\r\n```\r\nor\r\n```\r\nlogsBasedMetricService.recordElapsedTime(\r\n            MeasurementBundle.operationTag(\"createWorkspace\"),\r\n            DistributionMetric.WORKSPACE_OPERATION_TIME,\r\n            () -> createWorkspaceImpl(workspace));\r\n```", "bodyText": "Do we want callers to have to think about MeasurementBundle.Builder?  I'd prefer an interface like one of these:\nlogsBasedMetricService.recordElapsedTime(\n            \"createWorkspace\",\n            DistributionMetric.WORKSPACE_OPERATION_TIME,\n            () -> createWorkspaceImpl(workspace));\n\nor\nlogsBasedMetricService.recordElapsedTime(\n            MeasurementBundle.operationTag(\"createWorkspace\"),\n            DistributionMetric.WORKSPACE_OPERATION_TIME,\n            () -> createWorkspaceImpl(workspace));", "bodyHTML": "<p dir=\"auto\">Do we want callers to have to think about <code>MeasurementBundle.Builder</code>?  I'd prefer an interface like one of these:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"logsBasedMetricService.recordElapsedTime(\n            &quot;createWorkspace&quot;,\n            DistributionMetric.WORKSPACE_OPERATION_TIME,\n            () -&gt; createWorkspaceImpl(workspace));\n\"><pre><code>logsBasedMetricService.recordElapsedTime(\n            \"createWorkspace\",\n            DistributionMetric.WORKSPACE_OPERATION_TIME,\n            () -&gt; createWorkspaceImpl(workspace));\n</code></pre></div>\n<p dir=\"auto\">or</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"logsBasedMetricService.recordElapsedTime(\n            MeasurementBundle.operationTag(&quot;createWorkspace&quot;),\n            DistributionMetric.WORKSPACE_OPERATION_TIME,\n            () -&gt; createWorkspaceImpl(workspace));\n\"><pre><code>logsBasedMetricService.recordElapsedTime(\n            MeasurementBundle.operationTag(\"createWorkspace\"),\n            DistributionMetric.WORKSPACE_OPERATION_TIME,\n            () -&gt; createWorkspaceImpl(workspace));\n</code></pre></div>", "author": "jmthibault79", "createdAt": "2020-02-11T22:41:27Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -246,6 +253,17 @@ private void maybeFileZendeskReviewRequest(Workspace workspace) {\n \n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n+    final Workspace result =\n+        logsBasedMetricService.recordElapsedTime(\n+            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"createWorkspace\"),", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2ODkyNw==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378268927", "bodyText": "This was done for consistency with all the other metric recording calls. Operation tags aren't a concept the MeasurementBundle knows about. It just knows about labels.\nGoal is to move almost all such calls into. generated code.", "author": "jaycarlton", "createdAt": "2020-02-12T14:03:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0MzM5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..83afa22f3 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -253,12 +254,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n \n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n-    final Workspace result =\n-        logsBasedMetricService.recordElapsedTime(\n-            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"createWorkspace\"),\n-            DistributionMetric.WORKSPACE_OPERATION_TIME,\n-            () -> createWorkspaceImpl(workspace));\n-    return ResponseEntity.ok(result);\n+    return ResponseEntity.ok(\n+        recordOperationTime(() -> createWorkspaceImpl(workspace), \"createWorkspace\"));\n   }\n \n   // TODO(jaycarlton): migrate this and other \"impl\" methods to WorkspaceService &\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -253,12 +256,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n \n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n-    final Workspace result =\n-        logsBasedMetricService.recordElapsedTime(\n-            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"createWorkspace\"),\n-            DistributionMetric.WORKSPACE_OPERATION_TIME,\n-            () -> createWorkspaceImpl(workspace));\n-    return ResponseEntity.ok(result);\n+    return ResponseEntity.ok(\n+        recordOperationTime(() -> createWorkspaceImpl(workspace), \"createWorkspace\"));\n   }\n \n   // TODO(jaycarlton): migrate this and other \"impl\" methods to WorkspaceService &\n", "next_change": {"commit": "2f2597114fbb9a204927a6736e323674ba2b61a2", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 27f7a6aed..53db2ce7d 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -227,33 +204,6 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n         workspaceId.getWorkspaceNamespace(), workspaceId.getWorkspaceName());\n   }\n \n-  private void maybeFileZendeskReviewRequest(Workspace workspace) {\n-    if (!workspace.getResearchPurpose().getReviewRequested()) {\n-      return;\n-    }\n-\n-    final Request zdReq;\n-    try {\n-      zdReq =\n-          zendeskProvider\n-              .get()\n-              .createRequest(\n-                  ZendeskRequests.workspaceToReviewRequest(userProvider.get(), workspace));\n-    } catch (ZendeskException e) {\n-      log.log(\n-          Level.SEVERE,\n-          String.format(\n-              \"Failed to file Zendesk review ticket for workspace %s/%s\",\n-              workspace.getNamespace(), workspace.getId()),\n-          e);\n-      return;\n-    }\n-    log.info(\n-        String.format(\n-            \"filed Zendesk review request ticket with title %s, ID %s\",\n-            zdReq.getSubject(), zdReq.getId()));\n-  }\n-\n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n     return ResponseEntity.ok(\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0MzUzMQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377943531", "body": "Preach!", "bodyText": "Preach!", "bodyHTML": "<p dir=\"auto\">Preach!</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:41:49Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -246,6 +253,17 @@ private void maybeFileZendeskReviewRequest(Workspace workspace) {\n \n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n+    final Workspace result =\n+        logsBasedMetricService.recordElapsedTime(\n+            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"createWorkspace\"),\n+            DistributionMetric.WORKSPACE_OPERATION_TIME,\n+            () -> createWorkspaceImpl(workspace));\n+    return ResponseEntity.ok(result);\n+  }\n+\n+  // TODO(jaycarlton): migrate this and other \"impl\" methods to WorkspaceService &", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxODU5OA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378418598", "bodyText": "Still not really sold on this. This is only useful if this controller plays a role that's different from WorkspaceService, and isn't just passing through every method call. If that's what's happening (e.g. if this change here exemplifies the expected division of labor), then WorkspacesController may as well become WorkspaceService. Unless there are Spring reasons to want to use WorkspaceService over WorkspaceController in other places.", "author": "calbach", "createdAt": "2020-02-12T18:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0MzUzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ2NDk0NA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378464944", "bodyText": "What's the difference between a Controller and a service then? I like controllers to be dumb, and to be the place the request \"takes its shoes off\" and we call a regular old method that works with POJOs, then puts them on again by donning a response entity.\nLet's take this into another channel.", "author": "jaycarlton", "createdAt": "2020-02-12T19:28:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0MzUzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..83afa22f3 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -253,12 +254,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n \n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n-    final Workspace result =\n-        logsBasedMetricService.recordElapsedTime(\n-            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"createWorkspace\"),\n-            DistributionMetric.WORKSPACE_OPERATION_TIME,\n-            () -> createWorkspaceImpl(workspace));\n-    return ResponseEntity.ok(result);\n+    return ResponseEntity.ok(\n+        recordOperationTime(() -> createWorkspaceImpl(workspace), \"createWorkspace\"));\n   }\n \n   // TODO(jaycarlton): migrate this and other \"impl\" methods to WorkspaceService &\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -253,12 +256,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n \n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n-    final Workspace result =\n-        logsBasedMetricService.recordElapsedTime(\n-            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"createWorkspace\"),\n-            DistributionMetric.WORKSPACE_OPERATION_TIME,\n-            () -> createWorkspaceImpl(workspace));\n-    return ResponseEntity.ok(result);\n+    return ResponseEntity.ok(\n+        recordOperationTime(() -> createWorkspaceImpl(workspace), \"createWorkspace\"));\n   }\n \n   // TODO(jaycarlton): migrate this and other \"impl\" methods to WorkspaceService &\n", "next_change": {"commit": "2f2597114fbb9a204927a6736e323674ba2b61a2", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 27f7a6aed..53db2ce7d 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -227,33 +204,6 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n         workspaceId.getWorkspaceNamespace(), workspaceId.getWorkspaceName());\n   }\n \n-  private void maybeFileZendeskReviewRequest(Workspace workspace) {\n-    if (!workspace.getResearchPurpose().getReviewRequested()) {\n-      return;\n-    }\n-\n-    final Request zdReq;\n-    try {\n-      zdReq =\n-          zendeskProvider\n-              .get()\n-              .createRequest(\n-                  ZendeskRequests.workspaceToReviewRequest(userProvider.get(), workspace));\n-    } catch (ZendeskException e) {\n-      log.log(\n-          Level.SEVERE,\n-          String.format(\n-              \"Failed to file Zendesk review ticket for workspace %s/%s\",\n-              workspace.getNamespace(), workspace.getId()),\n-          e);\n-      return;\n-    }\n-    log.info(\n-        String.format(\n-            \"filed Zendesk review request ticket with title %s, ID %s\",\n-            zdReq.getSubject(), zdReq.getId()));\n-  }\n-\n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n     return ResponseEntity.ok(\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NDAwNg==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377944006", "body": "if you're going to reflow this text, keep going :)", "bodyText": "if you're going to reflow this text, keep going :)", "bodyHTML": "<p dir=\"auto\">if you're going to reflow this text, keep going :)</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:43:00Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -266,7 +284,8 @@ private void maybeFileZendeskReviewRequest(Workspace workspace) {\n     Timestamp now = new Timestamp(clock.instant().toEpochMilli());\n     DbWorkspace dbWorkspace = new DbWorkspace();\n     // A little unintuitive but setting this here reflects the current state of the workspace\n-    // while it was in the billing buffer. Setting this value will inform the update billing code to\n+    // while it was in the billing buffer. Setting this value will inform the update billing\n+    // code to", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMzMDQyNA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378330424", "bodyText": "Oh \ud83d\udca1, it moved when I had this whole block inside the lamda.", "author": "jaycarlton", "createdAt": "2020-02-12T15:37:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NDAwNg=="}], "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..83afa22f3 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -285,8 +282,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n     DbWorkspace dbWorkspace = new DbWorkspace();\n     // A little unintuitive but setting this here reflects the current state of the workspace\n     // while it was in the billing buffer. Setting this value will inform the update billing\n-    // code to\n-    // skip an unnecessary GCP API call if the billing account is being kept at the free tier\n+    // code to skip an unnecessary GCP API call if the billing account is being kept at the free\n+    // tier\n     dbWorkspace.setBillingAccountName(\n         workbenchConfigProvider.get().billing.freeTierBillingAccountName());\n     setDbWorkspaceFields(dbWorkspace, user, workspaceId, fcWorkspace, now);\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -285,8 +284,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n     DbWorkspace dbWorkspace = new DbWorkspace();\n     // A little unintuitive but setting this here reflects the current state of the workspace\n     // while it was in the billing buffer. Setting this value will inform the update billing\n-    // code to\n-    // skip an unnecessary GCP API call if the billing account is being kept at the free tier\n+    // code to skip an unnecessary GCP API call if the billing account is being kept at the free\n+    // tier\n     dbWorkspace.setBillingAccountName(\n         workbenchConfigProvider.get().billing.freeTierBillingAccountName());\n     setDbWorkspaceFields(dbWorkspace, user, workspaceId, fcWorkspace, now);\n", "next_change": {"commit": "383edff2a8abba55dd7f6485a9d724314b9b194f", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 27f7a6aed..5df43ec82 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -292,18 +290,17 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n \n     setLiveCdrVersionId(dbWorkspace, workspace.getCdrVersionId());\n \n-    DbWorkspace reqWorkspace = manualWorkspaceMapper.toDbWorkspace(workspace);\n     // TODO: enforce data access level authorization\n-    dbWorkspace.setDataAccessLevel(reqWorkspace.getDataAccessLevel());\n-    dbWorkspace.setName(reqWorkspace.getName());\n+    dbWorkspace.setDataAccessLevelEnum(workspace.getDataAccessLevel());\n+    dbWorkspace.setName(workspace.getName());\n \n     // Ignore incoming fields pertaining to review status; clients can only request a review.\n-    manualWorkspaceMapper.setResearchPurposeDetails(dbWorkspace, workspace.getResearchPurpose());\n-    if (reqWorkspace.getReviewRequested()) {\n+    workspaceMapper.mergeResearchPurposeIntoWorkspace(dbWorkspace, workspace.getResearchPurpose());\n+    if (workspace.getResearchPurpose().getReviewRequested()) {\n       // Use a consistent timestamp.\n       dbWorkspace.setTimeRequested(now);\n     }\n-    dbWorkspace.setReviewRequested(reqWorkspace.getReviewRequested());\n+    dbWorkspace.setReviewRequested(workspace.getResearchPurpose().getReviewRequested());\n \n     dbWorkspace.setBillingMigrationStatusEnum(BillingMigrationStatus.NEW);\n \n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NDE1NA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377944154", "body": "same", "bodyText": "same", "bodyHTML": "<p dir=\"auto\">same</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:43:20Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -295,11 +314,11 @@ private void maybeFileZendeskReviewRequest(Workspace workspace) {\n     } catch (Exception e) {\n       throw new ServerErrorException(\"Could not update the workspace's billing account\", e);\n     }\n-\n     try {\n       dbWorkspace = workspaceService.getDao().save(dbWorkspace);\n     } catch (Exception e) {\n-      // Tell Google to set the billing account back to the free tier if the workspace creation\n+      // Tell Google to set the billing account back to the free tier if the workspace\n+      // creation", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..83afa22f3 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -318,8 +315,7 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n       dbWorkspace = workspaceService.getDao().save(dbWorkspace);\n     } catch (Exception e) {\n       // Tell Google to set the billing account back to the free tier if the workspace\n-      // creation\n-      // fails\n+      // creation fails\n       log.log(\n           Level.SEVERE,\n           \"Could not save new workspace to database. Calling Google Cloud billing to update the failed billing project's billing account back to the free tier.\",\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -311,15 +310,17 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n     try {\n       workspaceService.updateWorkspaceBillingAccount(\n           dbWorkspace, workspace.getBillingAccountName());\n-    } catch (Exception e) {\n-      throw new ServerErrorException(\"Could not update the workspace's billing account\", e);\n+    } catch (ServerErrorException e) {\n+      // Will be addressed with RW-4440\n+      throw new ServerErrorException(\n+          \"This message is going to be swallowed due to a bug in ExceptionAdvice. \",\n+          new ServerErrorException(\"Could not update the workspace's billing account\", e));\n     }\n     try {\n       dbWorkspace = workspaceService.getDao().save(dbWorkspace);\n     } catch (Exception e) {\n       // Tell Google to set the billing account back to the free tier if the workspace\n-      // creation\n-      // fails\n+      // creation fails\n       log.log(\n           Level.SEVERE,\n           \"Could not save new workspace to database. Calling Google Cloud billing to update the failed billing project's billing account back to the free tier.\",\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NDk3Ng==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377944976", "body": "restore", "bodyText": "restore", "bodyHTML": "<p dir=\"auto\">restore</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:45:24Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -408,8 +453,6 @@ private void setDbWorkspaceFields(\n     }\n     ResearchPurpose researchPurpose = request.getWorkspace().getResearchPurpose();\n     if (researchPurpose != null) {\n-      // Note: this utility does not set the \"review requested\" bit or time. This is currently", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE2Nzk2MA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r379167960", "bodyText": "Please restore this comment or explain why it was removed", "author": "jmthibault79", "createdAt": "2020-02-13T23:02:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NDk3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIyNTgzOQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r379225839", "bodyText": "Good catch. I had \"hide unimportant differences\" checked in my diff/merge tool (Beyond Compare), so it didn't flag the comment change.", "author": "jaycarlton", "createdAt": "2020-02-14T02:40:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NDk3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "70adc47133f6171c974ac16bf3ba2e725d76197e", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -453,6 +442,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n     }\n     ResearchPurpose researchPurpose = request.getWorkspace().getResearchPurpose();\n     if (researchPurpose != null) {\n+      // Note: this utility does not set the \"review requested\" bit or time. This is currently\n+      // immutable on a workspace, see RW-4132.\n       manualWorkspaceMapper.setResearchPurposeDetails(dbWorkspace, researchPurpose);\n     }\n \n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -453,6 +442,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n     }\n     ResearchPurpose researchPurpose = request.getWorkspace().getResearchPurpose();\n     if (researchPurpose != null) {\n+      // Note: this utility does not set the \"review requested\" bit or time. This is currently\n+      // immutable on a workspace, see RW-4132.\n       manualWorkspaceMapper.setResearchPurposeDetails(dbWorkspace, researchPurpose);\n     }\n \n", "next_change": {"commit": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 27f7a6aed..5261bc486 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -444,7 +440,7 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n     if (researchPurpose != null) {\n       // Note: this utility does not set the \"review requested\" bit or time. This is currently\n       // immutable on a workspace, see RW-4132.\n-      manualWorkspaceMapper.setResearchPurposeDetails(dbWorkspace, researchPurpose);\n+      workspaceMapper.mergeResearchPurposeIntoWorkspace(dbWorkspace, researchPurpose);\n     }\n \n     if (workspace.getBillingAccountName() != null) {\n", "next_change": {"commit": "2f2597114fbb9a204927a6736e323674ba2b61a2", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 5261bc486..53db2ce7d 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -438,9 +381,12 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n     }\n     ResearchPurpose researchPurpose = request.getWorkspace().getResearchPurpose();\n     if (researchPurpose != null) {\n-      // Note: this utility does not set the \"review requested\" bit or time. This is currently\n-      // immutable on a workspace, see RW-4132.\n       workspaceMapper.mergeResearchPurposeIntoWorkspace(dbWorkspace, researchPurpose);\n+      dbWorkspace.setReviewRequested(researchPurpose.getReviewRequested());\n+      if (researchPurpose.getReviewRequested()) {\n+        Timestamp now = new Timestamp(clock.instant().toEpochMilli());\n+        dbWorkspace.setTimeRequested(now);\n+      }\n     }\n \n     if (workspace.getBillingAccountName() != null) {\n", "next_change": null}]}}]}}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NTA3Mw==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377945073", "body": "flow issue again", "bodyText": "flow issue again", "bodyHTML": "<p dir=\"auto\">flow issue again</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:45:37Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -421,13 +464,13 @@ private void setDbWorkspaceFields(\n         throw new ServerErrorException(\"Could not update the workspace's billing account\", e);\n       }\n     }\n-\n     try {\n       // The version asserted on save is the same as the one we read via\n       // getRequired() above, see RW-215 for details.\n       dbWorkspace = workspaceService.saveWithLastModified(dbWorkspace);\n     } catch (Exception e) {\n-      // Tell Google Cloud to set the billing account back to the original one since our update\n+      // Tell Google Cloud to set the billing account back to the original one since our\n+      // update", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..83afa22f3 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -470,8 +454,7 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n       dbWorkspace = workspaceService.saveWithLastModified(dbWorkspace);\n     } catch (Exception e) {\n       // Tell Google Cloud to set the billing account back to the original one since our\n-      // update\n-      // database call failed\n+      // update database call failed\n       workspaceService.updateWorkspaceBillingAccount(\n           dbWorkspace, originalWorkspace.getBillingAccountName());\n       throw e;\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -460,18 +451,21 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n       try {\n         workspaceService.updateWorkspaceBillingAccount(\n             dbWorkspace, request.getWorkspace().getBillingAccountName());\n-      } catch (Exception e) {\n-        throw new ServerErrorException(\"Could not update the workspace's billing account\", e);\n+      } catch (ServerErrorException e) {\n+        // Will be addressed with RW-4440\n+        throw new ServerErrorException(\n+            \"This message is going to be swallowed due to a bug in ExceptionAdvice.\",\n+            new ServerErrorException(\"Could not update the workspace's billing account\", e));\n       }\n     }\n+\n     try {\n       // The version asserted on save is the same as the one we read via\n       // getRequired() above, see RW-215 for details.\n       dbWorkspace = workspaceService.saveWithLastModified(dbWorkspace);\n     } catch (Exception e) {\n       // Tell Google Cloud to set the billing account back to the original one since our\n-      // update\n-      // database call failed\n+      // update database call failed\n       workspaceService.updateWorkspaceBillingAccount(\n           dbWorkspace, originalWorkspace.getBillingAccountName());\n       throw e;\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NjIwNQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377946205", "body": "since the metric is the same for all of these, can you add a little helper method that takes care of it? Something like `recordElapsedWorkspaceOperation(\"cloneWorkspace\", () -> cloneWorkspaceImpl(...))`", "bodyText": "since the metric is the same for all of these, can you add a little helper method that takes care of it? Something like recordElapsedWorkspaceOperation(\"cloneWorkspace\", () -> cloneWorkspaceImpl(...))", "bodyHTML": "<p dir=\"auto\">since the metric is the same for all of these, can you add a little helper method that takes care of it? Something like <code>recordElapsedWorkspaceOperation(\"cloneWorkspace\", () -&gt; cloneWorkspaceImpl(...))</code></p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:48:18Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -438,13 +481,21 @@ private void setDbWorkspaceFields(\n \n     workspaceAuditor.fireEditAction(\n         originalWorkspace, editedWorkspace, dbWorkspace.getWorkspaceId());\n-    return ResponseEntity.ok(manualWorkspaceMapper.toApiWorkspace(dbWorkspace, fcWorkspace));\n+    return manualWorkspaceMapper.toApiWorkspace(dbWorkspace, fcWorkspace);\n   }\n \n   @Override\n   public ResponseEntity<CloneWorkspaceResponse> cloneWorkspace(\n       String fromWorkspaceNamespace, String fromWorkspaceId, CloneWorkspaceRequest body)\n       throws BadRequestException, TooManyRequestsException {\n+    return logsBasedMetricService.recordElapsedTime(\n+        MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"cloneWorkspace\"),\n+        DistributionMetric.WORKSPACE_OPERATION_TIME,", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2OTI2NQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378269265", "bodyText": "Great idea! Might need two of them though \ud83e\udd14", "author": "jaycarlton", "createdAt": "2020-02-12T14:04:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NjIwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM0MTM5NA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378341394", "bodyText": "An even bigger win here is that when I switch over the services, I only have to change 5 lines (including imports).", "author": "jaycarlton", "createdAt": "2020-02-12T15:53:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NjIwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxNTQ1Mg==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378515452", "bodyText": "This supercedes my \"Do we want WorskapceController to know about MeausurementBundle.Builder\" comment - if we're localizing that knowledge to a single location, that works for me.", "author": "jmthibault79", "createdAt": "2020-02-12T21:13:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NjIwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..83afa22f3 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -488,10 +471,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n   public ResponseEntity<CloneWorkspaceResponse> cloneWorkspace(\n       String fromWorkspaceNamespace, String fromWorkspaceId, CloneWorkspaceRequest body)\n       throws BadRequestException, TooManyRequestsException {\n-    return logsBasedMetricService.recordElapsedTime(\n-        MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"cloneWorkspace\"),\n-        DistributionMetric.WORKSPACE_OPERATION_TIME,\n-        () -> cloneWorkspaceImpl(fromWorkspaceNamespace, fromWorkspaceId, body));\n+    return recordOperationTime(\n+        () -> cloneWorkspaceImpl(fromWorkspaceNamespace, fromWorkspaceId, body), \"cloneWorkspace\");\n   }\n \n   private ResponseEntity<CloneWorkspaceResponse> cloneWorkspaceImpl(\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 7486a6307..27f7a6aed 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -488,10 +482,8 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n   public ResponseEntity<CloneWorkspaceResponse> cloneWorkspace(\n       String fromWorkspaceNamespace, String fromWorkspaceId, CloneWorkspaceRequest body)\n       throws BadRequestException, TooManyRequestsException {\n-    return logsBasedMetricService.recordElapsedTime(\n-        MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"cloneWorkspace\"),\n-        DistributionMetric.WORKSPACE_OPERATION_TIME,\n-        () -> cloneWorkspaceImpl(fromWorkspaceNamespace, fromWorkspaceId, body));\n+    return recordOperationTime(\n+        () -> cloneWorkspaceImpl(fromWorkspaceNamespace, fromWorkspaceId, body), \"cloneWorkspace\");\n   }\n \n   private ResponseEntity<CloneWorkspaceResponse> cloneWorkspaceImpl(\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NzUxNA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377947514", "body": "This change seems unrelated", "bodyText": "This change seems unrelated", "bodyHTML": "<p dir=\"auto\">This change seems unrelated</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:51:21Z", "path": "api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java", "diffHunk": "@@ -236,8 +237,10 @@\n   @Autowired WorkspaceMapper workspaceMapper;\n \n   @Autowired ManualWorkspaceMapper manualWorkspaceMapper;\n+  @Autowired LogsBasedMetricService logsBasedMetricService;\n \n-  @Autowired Provider<Zendesk> mockZendeskProvider;\n+  @MockBean Provider<Zendesk> mockZendeskProvider;", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM2NTE5MQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378365191", "bodyText": "It's. general style fix. The free-standing form is preferred when there's a named member variabler for the. mock. If no name is needed, then putting. it in the list on the ctrlr is better. It's a non-functional cleanup change. If we don't. do those in test files as we go, things will deteriorate quickly.", "author": "jaycarlton", "createdAt": "2020-02-12T16:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NzUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQyNjgzOQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378426839", "bodyText": "This change is the correct local optimization. I'd rather not have to make this distinction though, the reason we had to here is that we're hand-constructing the controllers in setUp, resulting in all the above verbosity. The better goal here would be to autowire them all.\n(not for this PR)", "author": "calbach", "createdAt": "2020-02-12T18:16:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0NzUxNA=="}], "type": "inlineReview", "revised_code": {"commit": "4ba37882a3d9a382afc1a5ac48cf8c49a9599d0f", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex d0601ee0f..b49bcce59 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -239,12 +252,14 @@ public class DataSetControllerTest {\n   @Autowired ManualWorkspaceMapper manualWorkspaceMapper;\n   @Autowired LogsBasedMetricService logsBasedMetricService;\n \n-  @MockBean Provider<Zendesk> mockZendeskProvider;\n+  @Autowired Provider<Zendesk> mockZendeskProvider;\n   @MockBean MonitoringService mockMonitoringService;\n \n   @TestConfiguration\n   @Import({\n     CohortFactoryImpl.class,\n+    ConceptService.class,\n+    ConceptSetService.class,\n     DataSetServiceImpl.class,\n     TestBigQueryCdrSchemaConfig.class,\n     UserServiceImpl.class,\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex d0601ee0f..6f04223b0 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -239,12 +257,15 @@ public class DataSetControllerTest {\n   @Autowired ManualWorkspaceMapper manualWorkspaceMapper;\n   @Autowired LogsBasedMetricService logsBasedMetricService;\n \n-  @MockBean Provider<Zendesk> mockZendeskProvider;\n+  @Autowired Provider<Zendesk> mockZendeskProvider;\n   @MockBean MonitoringService mockMonitoringService;\n \n   @TestConfiguration\n   @Import({\n     CohortFactoryImpl.class,\n+    ConceptService.class,\n+    ConceptSetMapperImpl.class,\n+    ConceptSetService.class,\n     DataSetServiceImpl.class,\n     TestBigQueryCdrSchemaConfig.class,\n     UserServiceImpl.class,\n", "next_change": {"commit": "a25e3b68dae7550bd8c5368f5f095b9d9b823914", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 6f04223b0..a605bb604 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -273,7 +275,9 @@ public class DataSetControllerTest {\n     WorkspaceServiceImpl.class,\n     WorkspaceMapperImpl.class,\n     ManualWorkspaceMapper.class,\n-    LogsBasedMetricServiceFakeImpl.class\n+    LogsBasedMetricServiceFakeImpl.class,\n+    InstitutionServiceImpl.class,\n+    InstitutionMapperImpl.class\n   })\n   @MockBean({\n     BillingProjectBufferService.class,\n", "next_change": {"commit": "a4c7c6e5e434e8da675cb647521991994ad2bb24", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex a605bb604..2e2981fc8 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -277,7 +278,8 @@ public class DataSetControllerTest {\n     ManualWorkspaceMapper.class,\n     LogsBasedMetricServiceFakeImpl.class,\n     InstitutionServiceImpl.class,\n-    InstitutionMapperImpl.class\n+    InstitutionMapperImpl.class,\n+    PublicInstitutionDetailsMapperImpl.class\n   })\n   @MockBean({\n     BillingProjectBufferService.class,\n", "next_change": {"commit": "5cd4085aa2d1de1cc1bf72fa51801c0a45d16c5b", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 2e2981fc8..e50656a10 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -271,15 +271,12 @@ public class DataSetControllerTest {\n     ConceptSetService.class,\n     DataSetServiceImpl.class,\n     TestBigQueryCdrSchemaConfig.class,\n-    UserServiceImpl.class,\n     WorkspacesController.class,\n     WorkspaceServiceImpl.class,\n     WorkspaceMapperImpl.class,\n     ManualWorkspaceMapper.class,\n     LogsBasedMetricServiceFakeImpl.class,\n-    InstitutionServiceImpl.class,\n-    InstitutionMapperImpl.class,\n-    PublicInstitutionDetailsMapperImpl.class\n+    UserServiceTestConfiguration.class,\n   })\n   @MockBean({\n     BillingProjectBufferService.class,\n", "next_change": {"commit": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex e50656a10..2027a8bd3 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -275,6 +276,7 @@ public class DataSetControllerTest {\n     WorkspaceServiceImpl.class,\n     WorkspaceMapperImpl.class,\n     ManualWorkspaceMapper.class,\n+    CommonMappers.class,\n     LogsBasedMetricServiceFakeImpl.class,\n     UserServiceTestConfiguration.class,\n   })\n", "next_change": {"commit": "383edff2a8abba55dd7f6485a9d724314b9b194f", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 2027a8bd3..0b36a8c35 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -275,7 +273,6 @@ public class DataSetControllerTest {\n     WorkspacesController.class,\n     WorkspaceServiceImpl.class,\n     WorkspaceMapperImpl.class,\n-    ManualWorkspaceMapper.class,\n     CommonMappers.class,\n     LogsBasedMetricServiceFakeImpl.class,\n     UserServiceTestConfiguration.class,\n", "next_change": {"commit": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 0b36a8c35..b55f0af82 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -180,106 +172,53 @@ public class DataSetControllerTest {\n \n   private static final Instant NOW = Instant.now();\n   private static final FakeClock CLOCK = new FakeClock(NOW, ZoneId.systemDefault());\n-  private static DbUser currentUser;\n+  private static final BasicFormatterImpl BASIC_FORMATTER = new BasicFormatterImpl();\n+  private static final String PREFIX = \"00000000\";\n+  private static final String FULL_PREFIX = String.format(\"dataset_%s_condition_\", PREFIX);\n \n-  private String cohortCriteria;\n-  private SearchRequest searchRequest;\n-  private TestMockFactory testMockFactory;\n+  private static DbUser currentUser;\n   private Workspace workspace;\n \n-  @Autowired BillingProjectBufferService billingProjectBufferService;\n-\n-  @Autowired BigQueryService bigQueryService;\n-\n-  @Autowired CdrBigQuerySchemaConfigService cdrBigQuerySchemaConfigService;\n-\n-  @Autowired CdrVersionDao cdrVersionDao;\n-\n-  @Autowired CdrVersionService cdrVersionService;\n-\n-  @Autowired CloudStorageService cloudStorageService;\n-\n-  @Autowired Provider<Cloudbilling> cloudBillingProvider;\n-\n-  @Autowired CohortDao cohortDao;\n-\n-  @Autowired CohortFactory cohortFactory;\n-\n-  @Autowired CohortMaterializationService cohortMaterializationService;\n-\n-  @Autowired CohortReviewDao cohortReviewDao;\n-\n-  @Autowired ConceptBigQueryService conceptBigQueryService;\n-\n-  @Autowired ConceptDao conceptDao;\n-\n-  @Autowired ConceptService conceptService;\n-\n-  @Autowired ConceptSetService conceptSetService;\n-\n-  @Autowired ConceptSetDao conceptSetDao;\n-\n-  @Autowired DataDictionaryEntryDao dataDictionaryEntryDao;\n-\n-  @Autowired DataSetDao dataSetDao;\n-\n-  @Mock DataSetMapper dataSetMapper;\n-\n-  @Autowired ConceptSetMapper conceptSetMapper;\n-\n-  @Autowired DataSetService dataSetService;\n-\n-  @Autowired FireCloudService fireCloudService;\n-\n-  @Autowired FreeTierBillingService freeTierBillingService;\n-\n-  @Autowired CohortQueryBuilder cohortQueryBuilder;\n-\n-  @Autowired TestBigQueryCdrSchemaConfig testBigQueryCdrSchemaConfig;\n-\n-  @Autowired UserDao userDao;\n-\n-  @Mock Provider<DbUser> userProvider;\n-\n-  @Autowired Provider<WorkbenchConfig> workbenchConfigProvider;\n-\n-  @Autowired NotebooksService notebooksService;\n-\n-  @Autowired UserRecentResourceService userRecentResourceService;\n-\n-  @Autowired UserService userService;\n-\n-  @Autowired WorkspaceDao workspaceDao;\n-\n-  @Autowired WorkspaceService workspaceService;\n-\n-  @Autowired WorkspaceAuditor workspaceAuditor;\n-\n-  @Autowired WorkspaceMapper workspaceMapper;\n-\n-  @Autowired LogsBasedMetricService logsBasedMetricService;\n-\n-  @Autowired Provider<Zendesk> mockZendeskProvider;\n-  @MockBean MonitoringService mockMonitoringService;\n+  @Autowired private CdrVersionDao cdrVersionDao;\n+  @Autowired private CohortsController cohortsController;\n+  @Autowired private ConceptSetsController conceptSetsController;\n+  @Autowired private DataSetController dataSetController;\n+  @Autowired private UserDao userDao;\n+  @Autowired private WorkspaceDao workspaceDao;\n+  @Autowired private WorkspacesController workspacesController;\n+\n+  @MockBean private CdrBigQuerySchemaConfigService mockCdrBigQuerySchemaConfigService;\n+  @MockBean private BillingProjectBufferService mockBillingProjectBufferService;\n+  @MockBean private BigQueryService mockBigQueryService;\n+  @MockBean private CohortQueryBuilder mockCohortQueryBuilder;\n+  @MockBean private FireCloudService fireCloudService;\n+  @MockBean private NotebooksService mockNotebooksService;\n \n   @TestConfiguration\n   @Import({\n     CohortFactoryImpl.class,\n+    CohortMapperImpl.class,\n+    CohortReviewMapperImpl.class,\n+    CohortReviewServiceImpl.class,\n+    CohortsController.class,\n+    CommonMappers.class,\n     ConceptService.class,\n     ConceptSetMapperImpl.class,\n+    ConceptSetsController.class,\n     ConceptSetService.class,\n+    DataSetController.class,\n     DataSetServiceImpl.class,\n-    TestBigQueryCdrSchemaConfig.class,\n-    WorkspacesController.class,\n-    WorkspaceServiceImpl.class,\n-    WorkspaceMapperImpl.class,\n-    CommonMappers.class,\n+    FirecloudMapperImpl.class,\n     LogsBasedMetricServiceFakeImpl.class,\n+    TestBigQueryCdrSchemaConfig.class,\n+    UserMapperImpl.class,\n     UserServiceTestConfiguration.class,\n+    WorkspaceMapperImpl.class,\n+    WorkspaceResourcesServiceImpl.class,\n+    WorkspacesController.class,\n+    WorkspaceServiceImpl.class\n   })\n   @MockBean({\n-    BillingProjectBufferService.class,\n-    BigQueryService.class,\n     CdrBigQuerySchemaConfigService.class,\n     CdrVersionService.class,\n     CloudStorageService.class,\n", "next_change": {"commit": "ccf010734b40e071bd02a2d6420ea96d96f79f64", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex b55f0af82..f91ca50de 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -222,6 +226,7 @@ public class DataSetControllerTest {\n     CdrBigQuerySchemaConfigService.class,\n     CdrVersionService.class,\n     CloudStorageService.class,\n+    CohortBuilderService.class,\n     CohortCloningService.class,\n     CohortMaterializationService.class,\n     ComplianceService.class,\n", "next_change": {"commit": "a72b59edca1d46cc760bbf1a02ae08cec54b0169", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex f91ca50de..125aa07bb 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -231,7 +232,6 @@ public class DataSetControllerTest {\n     CohortMaterializationService.class,\n     ComplianceService.class,\n     ConceptBigQueryService.class,\n-    DataSetMapper.class,\n     DirectoryService.class,\n     FreeTierBillingService.class,\n     ParticipantCohortAnnotationMapper.class,\n", "next_change": {"commit": "95be3bcbc5cead07194e7c29c181eaa26c8a10ed", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 125aa07bb..62e5100d0 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -220,22 +225,27 @@ public class DataSetControllerTest {\n     UserServiceTestConfiguration.class,\n     WorkspaceMapperImpl.class,\n     WorkspaceResourcesServiceImpl.class,\n+    WorkspaceServiceImpl.class,\n     WorkspacesController.class,\n-    WorkspaceServiceImpl.class\n   })\n   @MockBean({\n+    BigQueryService.class,\n+    BillingProjectAuditor.class,\n     CdrBigQuerySchemaConfigService.class,\n     CdrVersionService.class,\n     CloudStorageService.class,\n+    CohortBuilderMapper.class,\n     CohortBuilderService.class,\n     CohortCloningService.class,\n     CohortMaterializationService.class,\n+    CohortQueryBuilder.class,\n     ComplianceService.class,\n     ConceptBigQueryService.class,\n     DirectoryService.class,\n     FreeTierBillingService.class,\n     ParticipantCohortAnnotationMapper.class,\n     ParticipantCohortStatusMapper.class,\n+    ReviewQueryBuilder.class,\n     UserRecentResourceService.class,\n     UserServiceAuditor.class,\n     WorkspaceAuditor.class,\n", "next_change": {"commit": "e7b992d15bf2a72cec3520f72a74a8e3aab42a60", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 62e5100d0..854e99b9f 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -249,6 +251,7 @@ public class DataSetControllerTest {\n     UserRecentResourceService.class,\n     UserServiceAuditor.class,\n     WorkspaceAuditor.class,\n+    WgsCohortExtractionService.class\n   })\n   static class Configuration {\n \n", "next_change": {"commit": "746a967d459c56f4ac1059272dc6fd6d3aed7ed3", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 854e99b9f..19c4ba19e 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -250,8 +258,7 @@ public class DataSetControllerTest {\n     ReviewQueryBuilder.class,\n     UserRecentResourceService.class,\n     UserServiceAuditor.class,\n-    WorkspaceAuditor.class,\n-    WgsCohortExtractionService.class\n+    WorkspaceAuditor.class\n   })\n   static class Configuration {\n \n", "next_change": {"commit": "82e4f55b98b31b124682458b3243e9f63f740025", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 19c4ba19e..84f6bd26c 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -261,12 +264,6 @@ public class DataSetControllerTest {\n     WorkspaceAuditor.class\n   })\n   static class Configuration {\n-\n-    @Bean(END_USER_CLOUD_BILLING)\n-    Cloudbilling endUserCloudbilling() {\n-      return TestMockFactory.createMockedCloudbilling();\n-    }\n-\n     @Bean(SERVICE_ACCOUNT_CLOUD_BILLING)\n     Cloudbilling serviceAccountCloudbilling() {\n       return TestMockFactory.createMockedCloudbilling();\n", "next_change": {"commit": "0038ace467f34982763e4f352dc821d99bed9657", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\nindex 84f6bd26c..fcf941527 100644\n--- a/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/api/DataSetControllerTest.java\n", "chunk": "@@ -259,9 +264,11 @@ public class DataSetControllerTest {\n     ParticipantCohortAnnotationMapper.class,\n     ParticipantCohortStatusMapper.class,\n     ReviewQueryBuilder.class,\n+    TaskQueueService.class,\n     UserRecentResourceService.class,\n     UserServiceAuditor.class,\n-    WorkspaceAuditor.class\n+    WorkspaceAuditor.class,\n+    WorkspaceOperationMapper.class,\n   })\n   static class Configuration {\n     @Bean(SERVICE_ACCOUNT_CLOUD_BILLING)\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "f608d10bb1d2223f4dc61bea52b155965a033d53", "committedDate": "2020-02-19 11:50:47 -0500", "message": "[RW-4450][Risk=no] Remove limit on SQL query in notebooks (#3151)"}, {"oid": "a25e3b68dae7550bd8c5368f5f095b9d9b823914", "committedDate": "2020-02-20 17:41:04 -0500", "message": "[risk=low][RW-4259]Enforce Verified Institutional Affiliation (API only) for new account creation if feature flag is set (#3139)"}, {"oid": "a4c7c6e5e434e8da675cb647521991994ad2bb24", "committedDate": "2020-02-27 11:00:19 -0500", "message": "[risk=low] Back end updates for RW-4160 which we need for RW-4161 (#3190)"}, {"oid": "3875ba10c6b2577e6bd7a5a32f40d6a4b52530d6", "committedDate": "2020-03-16 15:21:08 -0400", "message": "[RW-4412][RISK=NO]Format Dataset builder SQL query for readability (#3252)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "5cd4085aa2d1de1cc1bf72fa51801c0a45d16c5b", "committedDate": "2020-03-23 13:44:43 -0400", "message": "[risk=no]UserServiceTestConfiguration: transitive imports for UserServiceImpl (#3285)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "452bab947f2dc2a4186b3720191d72ce9174d032", "committedDate": "2020-04-20 10:05:57 -0700", "message": "[RW-4713][risk=moderate] Fix admin page auth and rename service methods (#3437)"}, {"oid": "cc5b96f62fea70763360385cbd1b577c3389896a", "committedDate": "2020-04-29 09:01:37 -0500", "message": "[RW-4444][risk=no] lowercasing column names in data set builder (#3496)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "0efdbf0dde2a1388d1ef296c8ccc6681671db973", "committedDate": "2020-06-03 11:56:20 -0500", "message": "[no ticket][risk=no] Implementing BQ integration tests for DataSet Builder (#3584)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "b606a49dea9b99bfb6ac2c1f164f34d85d609bd4", "committedDate": "2020-06-24 15:25:55 -0400", "message": "[RW-5056][Risk=low] DataSetController - use DataSetServiceImpl instead of dataSetDao, conceptSetDao and cohortDao (#3702)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}, {"oid": "7dae09e1d06d715ac4424f7c2397fc354fb334fa", "committedDate": "2020-06-29 14:13:20 -0500", "message": "[RW-5058][risk=no] Move DataSetService into dataset package (#3722)"}, {"oid": "744bc7682cd8ece8a4d9f96c7d5dc3d89dfa5c90", "committedDate": "2020-08-13 11:13:52 -0500", "message": "[no ticket][risk=no] update mapper packages in CB (#3876)"}, {"oid": "ccf010734b40e071bd02a2d6420ea96d96f79f64", "committedDate": "2020-09-02 09:56:04 -0500", "message": "[RW-5379][risk=no] move mappers from CohortReviewController to CohortReviewService (#3938)"}, {"oid": "a72b59edca1d46cc760bbf1a02ae08cec54b0169", "committedDate": "2020-09-11 13:23:03 -0400", "message": "[RW-5388][risk=no]\t [P1]- cannot export Dataset to notebook using the snowman menu (#3977)"}, {"oid": "b3d0ecafc70efb7a8b38cb9fe7dd1ec3a54c3532", "committedDate": "2020-09-17 17:06:20 -0400", "message": "[risk=low][RW-3627] Delete project when deleting workspace (#3985)"}, {"oid": "41cd89ae77a6b281f5ed709d54ec966357bf6c35", "committedDate": "2020-10-20 15:44:54 -0400", "message": "[RW-5045][risk=no] Hail Microarray Demo codegen (#4185)"}, {"oid": "30f0a09970a553753635ab37942981cfcfdf872a", "committedDate": "2020-10-26 13:07:20 -0700", "message": "[risk=low] Update codegen for image changes and quality of life (#4201)"}, {"oid": "e432ef9b3b9bd0ba2a3d1ad3367725f35e07276b", "committedDate": "2020-11-12 18:20:02 -0500", "message": "[RW-5672][risk=low]  API: Create 4 \"fake\" concept sets to support 4 fitbit tables (#4273)"}, {"oid": "ccafcccf0bb59a3e1bb325d7c849efa7099022f1", "committedDate": "2020-11-16 14:38:39 -0600", "message": "[RW-5687][risk=moderate]UI: Create 4 \"fake\" concept sets to support 4 fitbit tables (#4293)"}, {"oid": "c09e4ad1bf8b7aea986e9bd714c716c3e0f088ba", "committedDate": "2020-11-18 20:18:53 -0600", "message": "[RW-4606][risk=no] Enable Concept flag for Physical Measurements in preprod (#4304)"}, {"oid": "10015c2c672a4d9da320c4e91636bedc8f4ad731", "committedDate": "2020-11-20 08:12:44 -0500", "message": "[risk=low][RW-4798][RW-4688][RW-3882][RW-4308][RW-5091] Teardown Feature Flags, part 1 (#4308)"}, {"oid": "8f81c292b93b6b1679d6d81738d52ae2ae9cfdf7", "committedDate": "2020-12-01 09:58:03 -0600", "message": "[RW-5954][risk=no] Adding standard/source flag to Concept Sets (#4329)"}, {"oid": "0507ee696f35333aeb22cffefa5d1ded68776cda", "committedDate": "2020-12-03 15:49:34 -0500", "message": "[risk=no] Use WorkbenchConfig.createEmptyConfig() in tests wherever possible (#4349)"}, {"oid": "644e6ec62a5ab860ebf1b1187a7318fadf55d80d", "committedDate": "2020-12-17 14:59:38 -0600", "message": "[RW-5500][risk=no] remove code referencing the enableConceptSetSearchV2 feature flag (#4419)"}, {"oid": "95be3bcbc5cead07194e7c29c181eaa26c8a10ed", "committedDate": "2021-02-01 08:55:09 -0600", "message": "[RW-5381][risk=no] Refactor CohortReviewController (#4513)"}, {"oid": "fc76ba68856b4a0c668e925d4e3dcc7f7c32dc4c", "committedDate": "2021-02-23 10:16:12 -0500", "message": "[risk=medium][RW-5241] Add Access Tier to Billing Buffer (#4576)"}, {"oid": "a716a2999c3e726fedd023a702629d267704910e", "committedDate": "2021-02-25 13:35:06 -0500", "message": "[RW-6180][risk=medium] update Workspace logic for Multi Tier  (#4607)"}, {"oid": "6b41db804664bf50054be92c120d42e01e3a01a5", "committedDate": "2021-03-03 11:08:26 -0500", "message": "[RW-6187][risk=low] Remove dataAccessLevel from Workspace / DbWorkspace (#4635)"}, {"oid": "e7b992d15bf2a72cec3520f72a74a8e3aab42a60", "committedDate": "2021-03-06 02:51:39 -0500", "message": "[risk=no][RW-6290] Add create cohort table and extraction tables to WGS cohort extraction  (#4636)"}, {"oid": "eae67d762e94796699acfe81de4862db2880508d", "committedDate": "2021-03-23 15:47:52 -0400", "message": "[risk=low][RW-6187] Populate a new DbUserAccessTier whenever Registration status is updated (#4679)"}, {"oid": "eeb65606c5f6da11b2fc83e7322ff019bfe2bb71", "committedDate": "2021-03-24 13:35:41 -0400", "message": "[RW-6153][risk=no]  Update existing services that read from data_dictionary entry (Data Dictionary) (#4687)"}, {"oid": "ce8aeaf499883aba8f38de4ff876b36575ae130e", "committedDate": "2021-03-24 12:46:19 -0500", "message": "[RW-6444][risk=no] Remove unused Service/Dao/Dbmodel (#4724)"}, {"oid": "a1ce5d334f1d3aa9ffca6d1db49de9cea667279e", "committedDate": "2021-03-25 11:02:32 -0400", "message": "Fix data dictionary for multiple entries (#4742)"}, {"oid": "dbeae00006f5fa1bbc7d714354320c157acad4a1", "committedDate": "2021-03-30 16:57:23 -0400", "message": "[risk=low] Refactoring WorkspaceService; Moving functionality into WorkspaceAuthService and WorkspaceDao (#4751)"}, {"oid": "dd9d6b84a9d73585ff7794ff0774fa453b2d514c", "committedDate": "2021-04-13 16:00:14 -0400", "message": "[RW-6502][risk=no]  Create prepackaged (fake) all whole genome variant data concept set (#4805)"}, {"oid": "746a967d459c56f4ac1059272dc6fd6d3aed7ed3", "committedDate": "2021-04-15 16:44:48 -0700", "message": "[RW-6499][risk=low] mv WGS extract from cohort -> dataset (#4827)"}, {"oid": "37a2d723d532faaabcb162a31560d3284d6c4af3", "committedDate": "2021-04-27 12:28:24 -0700", "message": "[RW-6654][risk=no] rm microarray references in CDR version / codegen (#4871)"}, {"oid": "f4e7d86c810d5c6fb6c3337a8d8ac67afb8998af", "committedDate": "2021-04-28 17:44:48 -0400", "message": "[RW-6293][risk=no] Abort cromwell submission (#4883)"}, {"oid": "c1ab0948e5e8027dc4e0ccfc52f952cf6944bbcb", "committedDate": "2021-04-29 12:17:26 -0700", "message": "[RW-6632][risk=no] Add genomics extract feature flag (#4888)"}, {"oid": "742322dcf0d99cf5622589ccbdb06ba6000333c2", "committedDate": "2021-05-03 10:48:50 -0700", "message": "[RW-6670][risk=low] Fix DataSetController access controls (#4918)"}, {"oid": "6689df4ec752dc8c7589b9c5c2cd01cf2a378a0e", "committedDate": "2021-05-20 12:23:15 -0400", "message": "[RW-6503][risk=moderate] Separate Create/Save Dataset functionality; Code Preview replaced with read only notebook renderings (#5008)"}, {"oid": "be223bc8435317641facba105c9c01503802ecf2", "committedDate": "2021-05-29 01:03:36 -0400", "message": "[RW-6633][RW-6634] Add Genomics Analysis Code Generation options (#5060)"}, {"oid": "a91baeab6c35b5139e9ced1d8dfb39d8577daa63", "committedDate": "2021-06-04 13:29:06 -0400", "message": "[RW-6791][risk=no] Upgrade to junit 5 (#5033)"}, {"oid": "99e8ae5fb6d3c8619de8e7d5f7b2b45ccdfa5492", "committedDate": "2021-06-08 15:13:26 -0400", "message": "[risk=low][RW-6703] Access expiration email infrastructure (#5044)"}, {"oid": "18af79001c12c13eff10b1b66f7e15524091d622", "committedDate": "2021-06-24 16:41:16 -0400", "message": "[risk=no][RW-4598] Remove some obsolete Profile fields (#5130)"}, {"oid": "48b08ba7af41a265628113ff97906d5dd9e0ca28", "committedDate": "2021-07-07 15:58:27 -0400", "message": "[RW-6896][risk=low]: Call Terra to update billing account.  (#5185)"}, {"oid": "b762fdc9df1bfa1d406ce149ddc57560bbf1a734", "committedDate": "2021-07-15 15:33:26 -0400", "message": "[RW-6929][risk=low]: Dual write and backfill completion time for all modules (#5254)"}, {"oid": "ed4503dd1fe4f949d6bf066cbd229006d85c188d", "committedDate": "2021-10-04 21:56:13 -0400", "message": "[RW-7278][risk=low]Remove PPW feature flag (#5687)"}, {"oid": "934dc30ded981ffeec668d013e3b3c536f68d8e2", "committedDate": "2021-10-05 17:33:08 -0400", "message": "[RW-7278][risk-low] Remove billing buffer, drop db table, delete related cron jobs (#5705)"}, {"oid": "0af8c87c1ebe78563d6599d98c2426a5554362f6", "committedDate": "2021-10-19 15:15:01 -0400", "message": "[risk=low][no ticket] Extract a WorkspaceResourceMapper from WorkspaceMapper (#5778)"}, {"oid": "0912ada215ceef05ae2336348772c309c3c0c6f0", "committedDate": "2021-10-20 09:30:34 -0700", "message": "[risk=no] Update Terra Workspace model to latest (#5785)"}, {"oid": "710836017e9c767489faa9c9a9c40295a37af577", "committedDate": "2021-11-04 16:02:20 -0700", "message": "[risk=no] FakeClockConfiguration rework (#5843)"}, {"oid": "b8fea78f86194addf482b20007de4f7c14e49374", "committedDate": "2021-12-01 12:54:56 -0500", "message": "[risk=moderate][RW-7609] getCdrVersionsByTier() returns RT+CT tiers to RT users (#5951)"}, {"oid": "ea7ed892e7e71ba9a6072418ff3369851f570d04", "committedDate": "2021-12-01 13:35:58 -0500", "message": "[RW-7394][risk=low]: Grant user permission to run workflows when sharing/cloning/creating workspaces (#5903)"}, {"oid": "82e4f55b98b31b124682458b3243e9f63f740025", "committedDate": "2022-01-11 13:18:31 -0500", "message": "[RW-4790][risk=low] Remove enableBillingUpgrade usage in API  (#6130)"}, {"oid": "4f56ae2d08538cf5a65b64881bda7cc7152ff8eb", "committedDate": "2022-01-25 09:14:27 -0600", "message": "[RW-7657][risk=no] adding message for datasets with multiple domains (#6200)"}, {"oid": "bb7af537d335174a76e44985f1f06a066b92f0fe", "committedDate": "2022-02-11 10:17:35 -0600", "message": "[RW-7776][risk=no] Test Coverage: DataSetController (#6300)"}, {"oid": "6580563d5f1fbd21f3d98030e18c1ce059dd89fd", "committedDate": "2022-02-15 09:00:37 -0600", "message": "[no ticket][risk=no] no ticket src to target db fix for data set mapper (#6320)"}, {"oid": "8cfed0cb2965b3030cac5d9b3ffaaeafe98cbe7a", "committedDate": "2022-02-21 10:50:34 -0600", "message": "[RW-7564][risk=no] Add missing concept set / dataset access tests (#6344)"}, {"oid": "0038ace467f34982763e4f352dc821d99bed9657", "committedDate": "2022-03-02 08:17:01 -0500", "message": "[risk=low][RW-7973] Add async endpoint and queue for Create Workspace (#6389)"}, {"oid": "261c6152942beb2614bd51b9d7d7ab41b8001e5b", "committedDate": "2022-05-24 08:57:38 -0500", "message": "[RW-8375][risk=no] Cleanup unused endpoints from CohortsController (#6720)"}, {"oid": "64fdfed2666561126c7c005641223540a6a7ebf6", "committedDate": "2022-07-18 09:53:44 -0400", "message": "[risk=low][RW-8309] Move WorkspaceResourceService and UserRecentResourceService to workspaces/resources (#6850)"}, {"oid": "18d5ed45371c03928bfba11d8ea8808074a47b86", "committedDate": "2022-09-13 14:16:48 -0500", "message": "[no ticket][risk=no] Renaming SearchRequest to CohortDefinition (#6971)"}, {"oid": "148ff00d4180cf64088f3535be5e6de05a10b4fd", "committedDate": "2022-09-28 10:58:20 -0400", "message": "[risk=low][no ticket] Some refactoring mainly related to last-modified-by (#7017)"}, {"oid": "d42521e0042c445f4652f86d51b8348e3c68c7e5", "committedDate": "2022-10-06 13:37:31 -0400", "message": "[RW-8410] [risk=low]Audit-large-objects (#7013)"}, {"oid": "ec69515763441bb036059cb0936748ed27ae9097", "committedDate": "2023-05-03 11:50:33 -0400", "message": "[RW-9955][risk=no] Made equivalents of TestMockFactory that do not require repositories. (#7633)"}, {"oid": "7d188000ae375679de243917f213871e8d6331d1", "committedDate": "2023-05-04 12:39:46 -0400", "message": "[RW-9656][risk=low][part 2] Migrate workspaceApi and billingApi from firecloud-orch  to Rawls (#7601)"}, {"oid": "d329d15d1cc8575e5158a91cbc499b9b08a95b87", "committedDate": "2023-05-05 14:02:52 -0500", "message": "[DT-379][risk=no] Fix tidyverse read_csv problem. (#7662)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0ODU3Mg==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377948572", "body": "is there a nice const or other value you can use here that shows why 4 is correct?  Is it `PayloadKey.values().size()`?", "bodyText": "is there a nice const or other value you can use here that shows why 4 is correct?  Is it PayloadKey.values().size()?", "bodyHTML": "<p dir=\"auto\">is there a nice const or other value you can use here that shows why 4 is correct?  Is it <code>PayloadKey.values().size()</code>?</p>", "author": "jmthibault79", "createdAt": "2020-02-11T22:53:58Z", "path": "api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java", "diffHunk": "@@ -79,20 +92,18 @@ public void testRecordMeasurementBundle_writes() {\n     assertThat(logEntry.getSeverity()).isEqualTo(Severity.INFO);\n \n     final Map<String, Object> payloadMap = logEntry.<JsonPayload>getPayload().getDataAsMap();\n-    assertThat(payloadMap).hasSize(3);\n+    assertThat(payloadMap).hasSize(4);", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI3MDc3Nw==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378270777", "bodyText": "now that i have the. enum, yes.", "author": "jaycarlton", "createdAt": "2020-02-12T14:06:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0ODU3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxNjE5Nw==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378516197", "bodyText": "Could you make that update please?  :)", "author": "jmthibault79", "createdAt": "2020-02-12T21:15:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0ODU3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIyNzY3MQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r379227671", "bodyText": "It's fixed locally in a couple places.", "author": "jaycarlton", "createdAt": "2020-02-14T02:48:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk0ODU3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "8c61a455cdfc68380560b8cfb9cbbaea06e92504", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\nindex b461932c1..66ad5bf94 100644\n--- a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n", "chunk": "@@ -92,7 +92,7 @@ public class LogsBasedMetricsServiceTest {\n     assertThat(logEntry.getSeverity()).isEqualTo(Severity.INFO);\n \n     final Map<String, Object> payloadMap = logEntry.<JsonPayload>getPayload().getDataAsMap();\n-    assertThat(payloadMap).hasSize(4);\n+    assertThat(payloadMap).hasSize(PayloadKey.values().length);\n \n     final String metricName = (String) payloadMap.getOrDefault(PayloadKey.NAME.getKeyName(), \"\");\n     assertThat(metricName).isEqualTo(GaugeMetric.WORKSPACE_COUNT.getName());\n", "next_change": {"commit": "47bdf13e28b582c2e2dbf7848e4828183a0d805c", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\nindex 66ad5bf94..7cb305443 100644\n--- a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n", "chunk": "@@ -94,10 +93,11 @@ public class LogsBasedMetricsServiceTest {\n     final Map<String, Object> payloadMap = logEntry.<JsonPayload>getPayload().getDataAsMap();\n     assertThat(payloadMap).hasSize(PayloadKey.values().length);\n \n-    final String metricName = (String) payloadMap.getOrDefault(PayloadKey.NAME.getKeyName(), \"\");\n+    final String metricName = (String) payloadMap.get(PayloadKey.NAME.getKeyName());\n     assertThat(metricName).isEqualTo(GaugeMetric.WORKSPACE_COUNT.getName());\n \n-    final Double metricValue = (Double) payloadMap.getOrDefault(PayloadKey.VALUE.getKeyName(), \"\");\n+    final Double metricValue = (Double) payloadMap.get(PayloadKey.VALUE.getKeyName());\n+\n     assertThat(metricValue).isEqualTo(3.0);\n \n     @SuppressWarnings(\"unchecked\")\n", "next_change": null}]}}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\nindex b461932c1..7cb305443 100644\n--- a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n", "chunk": "@@ -92,12 +91,13 @@ public class LogsBasedMetricsServiceTest {\n     assertThat(logEntry.getSeverity()).isEqualTo(Severity.INFO);\n \n     final Map<String, Object> payloadMap = logEntry.<JsonPayload>getPayload().getDataAsMap();\n-    assertThat(payloadMap).hasSize(4);\n+    assertThat(payloadMap).hasSize(PayloadKey.values().length);\n \n-    final String metricName = (String) payloadMap.getOrDefault(PayloadKey.NAME.getKeyName(), \"\");\n+    final String metricName = (String) payloadMap.get(PayloadKey.NAME.getKeyName());\n     assertThat(metricName).isEqualTo(GaugeMetric.WORKSPACE_COUNT.getName());\n \n-    final Double metricValue = (Double) payloadMap.getOrDefault(PayloadKey.VALUE.getKeyName(), \"\");\n+    final Double metricValue = (Double) payloadMap.get(PayloadKey.VALUE.getKeyName());\n+\n     assertThat(metricValue).isEqualTo(3.0);\n \n     @SuppressWarnings(\"unchecked\")\n", "next_change": {"commit": "031dfeef058db66acf8f18f838abf9b20e134a54", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\nindex 7cb305443..7694fb745 100644\n--- a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n", "chunk": "@@ -105,8 +106,10 @@ public class LogsBasedMetricsServiceTest {\n         (Map<String, String>)\n             payloadMap.getOrDefault(PayloadKey.LABELS.getKeyName(), ImmutableMap.of());\n     assertThat(labelToValue).hasSize(2);\n-    assertThat(labelToValue.get(MetricLabel.DATA_ACCESS_LEVEL.getName()))\n-        .isEqualTo(DataAccessLevel.PROTECTED.toString());\n+    assertThat(labelToValue.get(MetricLabel.WORKSPACE_ACTIVE_STATUS.getName()))\n+        .isEqualTo(WorkspaceActiveStatus.ACTIVE.toString());\n+    assertThat(labelToValue.get(MetricLabel.ACCESS_TIER_SHORT_NAME.getName()))\n+        .isEqualTo(AccessTierService.REGISTERED_TIER_SHORT_NAME);\n   }\n \n   @NotNull\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "031dfeef058db66acf8f18f838abf9b20e134a54", "committedDate": "2021-04-14 16:49:07 -0400", "message": "[risk=low][RW-6137] Update billing buffer, user, and workspace count metrics for multi-tier (#4818)"}, {"oid": "a91baeab6c35b5139e9ced1d8dfb39d8577daa63", "committedDate": "2021-06-04 13:29:06 -0400", "message": "[RW-6791][risk=no] Upgrade to junit 5 (#5033)"}, {"oid": "710836017e9c767489faa9c9a9c40295a37af577", "committedDate": "2021-11-04 16:02:20 -0700", "message": "[risk=no] FakeClockConfiguration rework (#5843)"}, {"oid": "c7ca70f18751e912799287d74f1cd7534bbffd69", "committedDate": "2022-05-11 17:54:23 -0400", "message": "[risk=low][no ticket] bump google-truth and update method calls (#6671)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk1MTY2NQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r377951665", "body": "worth making some asserts on the logs here?", "bodyText": "worth making some asserts on the logs here?", "bodyHTML": "<p dir=\"auto\">worth making some asserts on the logs here?</p>", "author": "jmthibault79", "createdAt": "2020-02-11T23:02:08Z", "path": "api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java", "diffHunk": "@@ -121,12 +132,103 @@ public void testRecord_handlesMultipleMeasurements() {\n         sentEntries.stream()\n             .map(e -> (JsonPayload) e.getPayload())\n             .map(JsonPayload::getDataAsMap)\n-            .map(m -> (String) m.get(LogsBasedMetricService.METRIC_NAME_KEY))\n+            .map(m -> (String) m.get(PayloadKey.NAME.getKeyName()))\n             .filter(Objects::nonNull)\n             .collect(ImmutableSet.toImmutableSet());\n     assertThat(metricNames)\n         .containsAllIn(\n             ImmutableSet.of(\n                 EventMetric.NOTEBOOK_CLONE.getName(), EventMetric.NOTEBOOK_DELETE.getName()));\n   }\n+\n+  @Test\n+  public void testTimeAndRecordWithRunnable() {\n+    Set<Integer> sideEffectSet = new HashSet<>();\n+    logsBasedMetricService.recordElapsedTime(\n+        MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"test1\"),\n+        DistributionMetric.WORKSPACE_OPERATION_TIME,\n+        () -> {\n+          int innerInt = 2;\n+          sideEffectSet.add(3);\n+          innerInt -= 3;\n+          assertThat(innerInt).isEqualTo(-1);\n+        });\n+    assertThat(sideEffectSet).contains(3);\n+    verify(mockLogging).write(logEntriesCaptor.capture());\n+    final Map<String, Object> entryData =\n+        StreamSupport.stream(logEntriesCaptor.getValue().spliterator(), false)\n+            .map(LogEntry::getPayload)\n+            .map(p -> (JsonPayload) p)\n+            .map(JsonPayload::getDataAsMap)\n+            .findFirst()\n+            .orElse(Collections.emptyMap());\n+    assertThat(entryData).hasSize(4);\n+    assertThat(entryData.get(PayloadKey.NAME.getKeyName()))\n+        .isEqualTo(DistributionMetric.WORKSPACE_OPERATION_TIME.getName());\n+    assertThat((double) entryData.get(PayloadKey.VALUE.getKeyName()))\n+        .isEqualTo((double) OPERATION_DURATION.toMillis());\n+  }\n+\n+  public void testTimeAndRecordWithSupplier() {\n+    Set<Integer> aSet = new HashSet<>();\n+    final int result =\n+        logsBasedMetricService.recordElapsedTime(\n+            MeasurementBundle.builder().addTag(MetricLabel.OPERATION_NAME, \"test1\"),\n+            DistributionMetric.WORKSPACE_OPERATION_TIME,\n+            () -> {\n+              return 99;\n+            });\n+    assertThat(aSet).contains(3);\n+    assertThat(result).isEqualTo(99);\n+\n+    verify(mockLogging).write(logEntriesCaptor.capture());\n+    final Map<String, Object> entryData =\n+        StreamSupport.stream(logEntriesCaptor.getValue().spliterator(), false)\n+            .map(LogEntry::getPayload)\n+            .map(p -> (JsonPayload) p)\n+            .map(JsonPayload::getDataAsMap)\n+            .findFirst()\n+            .orElse(Collections.emptyMap());\n+    assertThat(entryData).hasSize(4);\n+    assertThat(entryData.get(PayloadKey.NAME.getKeyName()))\n+        .isEqualTo(DistributionMetric.WORKSPACE_OPERATION_TIME.getName());\n+    assertThat(entryData.get(PayloadKey.UNIT.getKeyName()))\n+        .isEqualTo(UnitOfMeasure.MILLISECOND.getUcmSymbol());\n+\n+    assertThat((Double) entryData.get(PayloadKey.VALUE.getKeyName()))\n+        .isEqualTo(OPERATION_DURATION.toMillis());\n+  }\n+\n+  @Test(expected = IllegalAccessError.class)\n+  public void testRecordElapsedTime_throws() {\n+    logsBasedMetricService.recordElapsedTime(\n+        MeasurementBundle.builder(),\n+        DistributionMetric.COHORT_OPERATION_TIME,\n+        () -> {\n+          throw new IllegalAccessError(\"Boo!\");\n+        });\n+  }\n+\n+  @Test\n+  public void testRecordElapsedTime_nestedWorks() {", "originalCommit": "78171accb6e37a5939b7cb97beafffb9288ba1ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI3MTA2Mg==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378271062", "bodyText": "Not sure if I can mock the stopwatch to give ttwo different times.  I'll see what I can do.", "author": "jaycarlton", "createdAt": "2020-02-12T14:07:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzk1MTY2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "c2262a94c235dd7e61e871b0e209fcc773fe7bf0", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\nindex b461932c1..a63477423 100644\n--- a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n", "chunk": "@@ -212,10 +215,14 @@ public class LogsBasedMetricsServiceTest {\n   @Test\n   public void testRecordElapsedTime_nestedWorks() {\n     final Set<Integer> someSet = new HashSet<>();\n+    final Duration innerTime = Duration.ofMillis(30);\n+    final Duration outerTime = Duration.ofMillis(100);\n+\n     logsBasedMetricService.recordElapsedTime(\n         MeasurementBundle.builder(),\n         DistributionMetric.UNIFORM_RANDOM_SAMPLE,\n         () -> {\n+          doReturn(innerTime).when(mockStopwatch).elapsed();\n           someSet.add(1);\n           someSet.add(3);\n           Boolean b =\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\nindex b461932c1..7cb305443 100644\n--- a/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/monitoring/LogsBasedMetricsServiceTest.java\n", "chunk": "@@ -212,10 +216,14 @@ public class LogsBasedMetricsServiceTest {\n   @Test\n   public void testRecordElapsedTime_nestedWorks() {\n     final Set<Integer> someSet = new HashSet<>();\n+    final Duration innerTime = Duration.ofMillis(30);\n+    final Duration outerTime = Duration.ofMillis(100);\n+\n     logsBasedMetricService.recordElapsedTime(\n         MeasurementBundle.builder(),\n         DistributionMetric.UNIFORM_RANDOM_SAMPLE,\n         () -> {\n+          doReturn(innerTime).when(mockStopwatch).elapsed();\n           someSet.add(1);\n           someSet.add(3);\n           Boolean b =\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "031dfeef058db66acf8f18f838abf9b20e134a54", "committedDate": "2021-04-14 16:49:07 -0400", "message": "[risk=low][RW-6137] Update billing buffer, user, and workspace count metrics for multi-tier (#4818)"}, {"oid": "a91baeab6c35b5139e9ced1d8dfb39d8577daa63", "committedDate": "2021-06-04 13:29:06 -0400", "message": "[RW-6791][risk=no] Upgrade to junit 5 (#5033)"}, {"oid": "710836017e9c767489faa9c9a9c40295a37af577", "committedDate": "2021-11-04 16:02:20 -0700", "message": "[risk=no] FakeClockConfiguration rework (#5843)"}, {"oid": "c7ca70f18751e912799287d74f1cd7534bbffd69", "committedDate": "2022-05-11 17:54:23 -0400", "message": "[risk=low][no ticket] bump google-truth and update method calls (#6671)"}]}, {"oid": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "url": "https://github.com/all-of-us/workbench/commit/ccbec34e063fc0896f6d515df8f75ad1991ac176", "message": "cleanup  w/ helper methods", "committedDate": "2020-02-12T16:24:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNDYyOA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378414628", "body": "Really like this pattern.", "bodyText": "Really like this pattern.", "bodyHTML": "<p dir=\"auto\">Really like this pattern.</p>", "author": "calbach", "createdAt": "2020-02-12T17:52:45Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceFakeImpl.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package org.pmiops.workbench.monitoring;\n+\n+import java.util.function.Supplier;\n+import org.pmiops.workbench.monitoring.MeasurementBundle.Builder;\n+import org.pmiops.workbench.monitoring.views.DistributionMetric;\n+import org.pmiops.workbench.monitoring.views.EventMetric;\n+import org.springframework.stereotype.Service;\n+\n+/**\n+ * While it's possible to mock this service correctly, it's much less intrusive to simply provide a\n+ * no-op implementation. If you're curious on what the stubbing looks like, see\n+ * https://stackoverflow.com/questions/60138415/which-breaks-first-mockito-or-java-generics for\n+ * details on how to mock the generic supplier matcher.\n+ */\n+@Service(\"LOGS_BASED_METRIC_SERVICE_FAKE\")\n+public class LogsBasedMetricServiceFakeImpl implements LogsBasedMetricService {", "originalCommit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null, "revised_code_in_main": null, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNTY2OA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378415668", "body": "spelling: manually", "bodyText": "spelling: manually", "bodyHTML": "<p dir=\"auto\">spelling: manually</p>", "author": "calbach", "createdAt": "2020-02-12T17:54:43Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java", "diffHunk": "@@ -79,4 +121,41 @@ private LogEntry payloadToLogEntry(JsonPayload jsonPayload) {\n         .setResource(stackdriverStatsExporterService.getLoggingMonitoredResource())\n         .build();\n   }\n+\n+  /**\n+   * Allowed labels for the JsonPayload are here.\n+   *\n+   * <p>NAME: name of the metric, to show up in the Metric Explorer. Should be snake_case. Existing\n+   * EventMetric class's getName() method works.\n+   *\n+   * <p>VALUE: double value for the metric for this sample. Either 1.0 for count metrics, or some\n+   * number in the distribution for a distribution metric. For cumulative metrics, just use a value\n+   * to be summed, and choose the right aggregation on the Stackdriver side. That is, there's no\n+   * separate option for it.\n+   *\n+   * <p>LABELS: String-String map of label to value. Should only contain keys and discrete values\n+   * allowed by the EventMetric and MetricLabel classes, respectively. (Using a MeasurementBundle\n+   * ensures this).\n+   *\n+   * <p>UNIT: Official unit of measure. It looks like you still have to set this up manuaally when", "originalCommit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8c61a455cdfc68380560b8cfb9cbbaea06e92504", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java b/api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java\nindex 5b8ec565a..a54d17238 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java\n", "chunk": "@@ -137,7 +137,7 @@ public class LogsBasedMetricServiceImpl implements LogsBasedMetricService {\n    * allowed by the EventMetric and MetricLabel classes, respectively. (Using a MeasurementBundle\n    * ensures this).\n    *\n-   * <p>UNIT: Official unit of measure. It looks like you still have to set this up manuaally when\n+   * <p>UNIT: Official unit of measure. It looks like you still have to set this up manually when\n    * making a Logs-based metric in the GUI. I.e. it won't honor this field. But it's still good to\n    * have as a reminder if you're just surfing the log.\n    */\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java b/api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java\nindex 5b8ec565a..0c967e8aa 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/LogsBasedMetricServiceImpl.java\n", "chunk": "@@ -137,7 +143,7 @@ public class LogsBasedMetricServiceImpl implements LogsBasedMetricService {\n    * allowed by the EventMetric and MetricLabel classes, respectively. (Using a MeasurementBundle\n    * ensures this).\n    *\n-   * <p>UNIT: Official unit of measure. It looks like you still have to set this up manuaally when\n+   * <p>UNIT: Official unit of measure. It looks like you still have to set this up manually when\n    * making a Logs-based metric in the GUI. I.e. it won't honor this field. But it's still good to\n    * have as a reminder if you're just surfing the log.\n    */\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "258aa7f7cd880a35b006e139401fd0d694d4bbb1", "committedDate": "2020-03-10 16:37:58 -0400", "message": "[RW-4498][risk=no] supply not-really-optional name param (#3240)"}, {"oid": "8cbd70cd7fe270162a7b2caa2c6d856e6dfbb03e", "committedDate": "2020-08-20 12:12:25 -0400", "message": "[RW-5382][risk=no] Streaming BQ upload service (#3882)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNjMxNg==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378416316", "body": "spelling: OpenCensus here and below", "bodyText": "spelling: OpenCensus here and below", "bodyHTML": "<p dir=\"auto\">spelling: OpenCensus here and below</p>", "author": "calbach", "createdAt": "2020-02-12T17:55:54Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.pmiops.workbench.monitoring.views;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.opencensus.stats.Aggregation;\n+import io.opencensus.stats.Aggregation.Distribution;\n+import io.opencensus.stats.BucketBoundaries;\n+\n+/**\n+ * Aggregation values to use with OpenCensus Distribution metrics. The bucket bounadries are inner\n+ * boundaries, so a list of [0.25, 0.50, 0.75] would actually make 5 buckets, with the lowest being\n+ * [0.0, 0.25), [0.25, 0.5), [0.5, 0.75), [0.75, MAX_DOUBLE].\n+ *\n+ * <p>Note: These buckets are provided for use with OpenCenss distribution metrics, which are not", "originalCommit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0NzY3Ng==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378447676", "bodyText": "thanks. my keyboard is dying.", "author": "jaycarlton", "createdAt": "2020-02-12T18:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNjMxNg=="}], "type": "inlineReview", "revised_code": {"commit": "8c61a455cdfc68380560b8cfb9cbbaea06e92504", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\nindex eaa5b804a..bef34ea64 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n", "chunk": "@@ -6,14 +6,14 @@ import io.opencensus.stats.Aggregation.Distribution;\n import io.opencensus.stats.BucketBoundaries;\n \n /**\n- * Aggregation values to use with OpenCensus Distribution metrics. The bucket bounadries are inner\n+ * Aggregation values to use with OpenCensus Distribution metrics. The bucket boundaries are inner\n  * boundaries, so a list of [0.25, 0.50, 0.75] would actually make 5 buckets, with the lowest being\n  * [0.0, 0.25), [0.25, 0.5), [0.5, 0.75), [0.75, MAX_DOUBLE].\n  *\n- * <p>Note: These buckets are provided for use with OpenCenss distribution metrics, which are not\n- * currenlty in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n+ * <p>Note: These buckets are provided for use with OpenCensus distribution metrics, which are not\n+ * currently in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n  * Logs-based workaround to be a drop-in replacement as much as possible, I decided to keep them\n- * around until we have a resolution on the OpenCenss issues.\n+ * around until we have a resolution on the OpenCensus issues.\n  */\n public enum DistributionAggregation {\n   RANDOM_DOUBLE(\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\nindex eaa5b804a..bef34ea64 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n", "chunk": "@@ -6,14 +6,14 @@ import io.opencensus.stats.Aggregation.Distribution;\n import io.opencensus.stats.BucketBoundaries;\n \n /**\n- * Aggregation values to use with OpenCensus Distribution metrics. The bucket bounadries are inner\n+ * Aggregation values to use with OpenCensus Distribution metrics. The bucket boundaries are inner\n  * boundaries, so a list of [0.25, 0.50, 0.75] would actually make 5 buckets, with the lowest being\n  * [0.0, 0.25), [0.25, 0.5), [0.5, 0.75), [0.75, MAX_DOUBLE].\n  *\n- * <p>Note: These buckets are provided for use with OpenCenss distribution metrics, which are not\n- * currenlty in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n+ * <p>Note: These buckets are provided for use with OpenCensus distribution metrics, which are not\n+ * currently in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n  * Logs-based workaround to be a drop-in replacement as much as possible, I decided to keep them\n- * around until we have a resolution on the OpenCenss issues.\n+ * around until we have a resolution on the OpenCensus issues.\n  */\n public enum DistributionAggregation {\n   RANDOM_DOUBLE(\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNjM4NQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378416385", "body": "currently", "bodyText": "currently", "bodyHTML": "<p dir=\"auto\">currently</p>", "author": "calbach", "createdAt": "2020-02-12T17:56:02Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.pmiops.workbench.monitoring.views;\n+\n+import com.google.common.collect.ImmutableList;\n+import io.opencensus.stats.Aggregation;\n+import io.opencensus.stats.Aggregation.Distribution;\n+import io.opencensus.stats.BucketBoundaries;\n+\n+/**\n+ * Aggregation values to use with OpenCensus Distribution metrics. The bucket bounadries are inner\n+ * boundaries, so a list of [0.25, 0.50, 0.75] would actually make 5 buckets, with the lowest being\n+ * [0.0, 0.25), [0.25, 0.5), [0.5, 0.75), [0.75, MAX_DOUBLE].\n+ *\n+ * <p>Note: These buckets are provided for use with OpenCenss distribution metrics, which are not\n+ * currenlty in service. Since every MetricBase needs an Aggregation anyway, and I wanted the", "originalCommit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8c61a455cdfc68380560b8cfb9cbbaea06e92504", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\nindex eaa5b804a..bef34ea64 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n", "chunk": "@@ -6,14 +6,14 @@ import io.opencensus.stats.Aggregation.Distribution;\n import io.opencensus.stats.BucketBoundaries;\n \n /**\n- * Aggregation values to use with OpenCensus Distribution metrics. The bucket bounadries are inner\n+ * Aggregation values to use with OpenCensus Distribution metrics. The bucket boundaries are inner\n  * boundaries, so a list of [0.25, 0.50, 0.75] would actually make 5 buckets, with the lowest being\n  * [0.0, 0.25), [0.25, 0.5), [0.5, 0.75), [0.75, MAX_DOUBLE].\n  *\n- * <p>Note: These buckets are provided for use with OpenCenss distribution metrics, which are not\n- * currenlty in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n+ * <p>Note: These buckets are provided for use with OpenCensus distribution metrics, which are not\n+ * currently in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n  * Logs-based workaround to be a drop-in replacement as much as possible, I decided to keep them\n- * around until we have a resolution on the OpenCenss issues.\n+ * around until we have a resolution on the OpenCensus issues.\n  */\n public enum DistributionAggregation {\n   RANDOM_DOUBLE(\n", "next_change": null}]}, "revised_code_in_main": {"commit": "352c84794a82b47abd4a80388c5d0f3095c05945", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\nindex eaa5b804a..bef34ea64 100644\n--- a/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n+++ b/api/src/main/java/org/pmiops/workbench/monitoring/views/DistributionAggregation.java\n", "chunk": "@@ -6,14 +6,14 @@ import io.opencensus.stats.Aggregation.Distribution;\n import io.opencensus.stats.BucketBoundaries;\n \n /**\n- * Aggregation values to use with OpenCensus Distribution metrics. The bucket bounadries are inner\n+ * Aggregation values to use with OpenCensus Distribution metrics. The bucket boundaries are inner\n  * boundaries, so a list of [0.25, 0.50, 0.75] would actually make 5 buckets, with the lowest being\n  * [0.0, 0.25), [0.25, 0.5), [0.5, 0.75), [0.75, MAX_DOUBLE].\n  *\n- * <p>Note: These buckets are provided for use with OpenCenss distribution metrics, which are not\n- * currenlty in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n+ * <p>Note: These buckets are provided for use with OpenCensus distribution metrics, which are not\n+ * currently in service. Since every MetricBase needs an Aggregation anyway, and I wanted the\n  * Logs-based workaround to be a drop-in replacement as much as possible, I decided to keep them\n- * around until we have a resolution on the OpenCenss issues.\n+ * around until we have a resolution on the OpenCensus issues.\n  */\n public enum DistributionAggregation {\n   RANDOM_DOUBLE(\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNzQ4NA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378417484", "body": "This doesn't exactly match the pattern you've added in the log service, but I think it would be less intrusive to handle method-level timing in an interceptor, e.g. https://github.com/all-of-us/workbench/blob/8541d09075b0bbc3e4ad786212a4fea8c84aee54/api/src/main/java/org/pmiops/workbench/interceptors/TracingInterceptor.java", "bodyText": "This doesn't exactly match the pattern you've added in the log service, but I think it would be less intrusive to handle method-level timing in an interceptor, e.g. https://github.com/all-of-us/workbench/blob/8541d09075b0bbc3e4ad786212a4fea8c84aee54/api/src/main/java/org/pmiops/workbench/interceptors/TracingInterceptor.java", "bodyHTML": "<p dir=\"auto\">This doesn't exactly match the pattern you've added in the log service, but I think it would be less intrusive to handle method-level timing in an interceptor, e.g. <a href=\"https://github.com/all-of-us/workbench/blob/8541d09075b0bbc3e4ad786212a4fea8c84aee54/api/src/main/java/org/pmiops/workbench/interceptors/TracingInterceptor.java\">https://github.com/all-of-us/workbench/blob/8541d09075b0bbc3e4ad786212a4fea8c84aee54/api/src/main/java/org/pmiops/workbench/interceptors/TracingInterceptor.java</a></p>", "author": "calbach", "createdAt": "2020-02-12T17:58:08Z", "path": "api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java", "diffHunk": "@@ -246,6 +254,13 @@ private void maybeFileZendeskReviewRequest(Workspace workspace) {\n \n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n+    return ResponseEntity.ok(\n+        recordOperationTime(() -> createWorkspaceImpl(workspace), \"createWorkspace\"));", "originalCommit": "ccbec34e063fc0896f6d515df8f75ad1991ac176", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1MTA1NQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378451055", "bodyText": "I had hoped to be able to pull live latency distributions from the traces to use. with Alerting. @blrubenstein looked into whether we could alert on Traces. and said the systems were basically totally separate.\nI do see they have alerting, but it appears to be more limited to the number of Stackdriver Trace spans ingested per month, your quota usage, and your rate of span ingestion\nIt looks like they do expose a handful of metrics, but so far I'm only seeing builtin GCP services represented.\n\nFor my purposes here, I basically needed quantities to send to verify the service is working for distributions.", "author": "jaycarlton", "createdAt": "2020-02-12T19:02:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNzQ4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1NzY0MA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378457640", "bodyText": "Ignore StackDriver tracing for now, I'm asking whether you can implement recording a request's latency using an interceptor, similar to the approach used in the code I linked, instead of writing new code on every method.", "author": "calbach", "createdAt": "2020-02-12T19:14:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNzQ4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ2NjA2OA==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378466068", "bodyText": "Drive-by comment here: for some reason I'd been thinking we wouldn't be able to use an interceptor for logging per-inbound-request latency, but it looks to me like it would totally work.\nThe fancy stuff I'd done in #2901 editing Swagger templates was important for instrumenting outbound API requests where RW acts as a client to Firecloud, but for inbound APIs an interceptor does seem to have most of the information we'd need.", "author": "gjuggler", "createdAt": "2020-02-12T19:30:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNzQ4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUyODQxMg==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r378528412", "bodyText": "Oh you're saying to hack a trace interceptor to record the request latency. Sure.\nThis isn't intended to be a pattern for every method.  Just a handful of things that are of major perf importance like workspaces and cohorts.\nI don't have a story for that yet.", "author": "jaycarlton", "createdAt": "2020-02-12T21:40:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNzQ4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1Nzc3Mg==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r379157772", "bodyText": "No. I regret linking the TraceInterceptor, I used it as an example because it's the most similar to what you'd need to do.\nInterceptors are a standard spring concept where you can install some pre and post-processing hook on a set of controller endpoitns. We have several such interceptors defined here: https://github.com/all-of-us/workbench/tree/2599364f3f32bacb1878854dae47ec8c61d08970/api/src/main/java/org/pmiops/workbench/interceptors\nWhy would we not want to record a general purpose latency metric split out by method name?", "author": "calbach", "createdAt": "2020-02-13T22:34:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNzQ4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1OTE0MQ==", "url": "https://github.com/all-of-us/workbench/pull/3108#discussion_r379159141", "bodyText": "We do want to do that. Until very recently we thought we had to hack swagger-codegen to do it. I'm happy and eager to do that on a later ticket.\nThe priority with this branch is integrating and demonstrating distribution metrics, and elapsed time was an easy starting point.", "author": "jaycarlton", "createdAt": "2020-02-13T22:38:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQxNzQ4NA=="}], "type": "inlineReview", "revised_code": null, "revised_code_in_main": {"commit": "2f2597114fbb9a204927a6736e323674ba2b61a2", "changed_code": [{"header": "diff --git a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\nindex 83afa22f3..53db2ce7d 100644\n--- a/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n+++ b/api/src/main/java/org/pmiops/workbench/workspaces/WorkspacesController.java\n", "chunk": "@@ -225,33 +204,6 @@ public class WorkspacesController implements WorkspacesApiDelegate {\n         workspaceId.getWorkspaceNamespace(), workspaceId.getWorkspaceName());\n   }\n \n-  private void maybeFileZendeskReviewRequest(Workspace workspace) {\n-    if (!workspace.getResearchPurpose().getReviewRequested()) {\n-      return;\n-    }\n-\n-    final Request zdReq;\n-    try {\n-      zdReq =\n-          zendeskProvider\n-              .get()\n-              .createRequest(\n-                  ZendeskRequests.workspaceToReviewRequest(userProvider.get(), workspace));\n-    } catch (ZendeskException e) {\n-      log.log(\n-          Level.SEVERE,\n-          String.format(\n-              \"Failed to file Zendesk review ticket for workspace %s/%s\",\n-              workspace.getNamespace(), workspace.getId()),\n-          e);\n-      return;\n-    }\n-    log.info(\n-        String.format(\n-            \"filed Zendesk review request ticket with title %s, ID %s\",\n-            zdReq.getSubject(), zdReq.getId()));\n-  }\n-\n   @Override\n   public ResponseEntity<Workspace> createWorkspace(Workspace workspace) throws BadRequestException {\n     return ResponseEntity.ok(\n", "next_change": null}]}, "commits_in_main": [{"oid": "352c84794a82b47abd4a80388c5d0f3095c05945", "message": "Merge commit", "committedDate": null}, {"oid": "8dcdb63c76268b5a252054acc6b6aee191d80c40", "committedDate": "2020-02-25 16:36:06 -0500", "message": "[RW-4418][risk=low] Add project.rb tool to delete workspaces (#3170)"}, {"oid": "98794e380f8ff40a4fe148f82a5d7e24c84945e4", "committedDate": "2020-03-17 14:59:36 -0400", "message": "[RW-3212][Risk=no] Working workspace billing info (#3255)"}, {"oid": "7d64640cf5bfcfb5755438e6e89ff88a8b24ba45", "committedDate": "2020-03-26 16:26:26 -0400", "message": "[RW-4367] Manual Workspace Migration (Part 1) - toApiWorkspace, researchPurpose (#3278)"}, {"oid": "383edff2a8abba55dd7f6485a9d724314b9b194f", "committedDate": "2020-03-27 14:14:45 -0400", "message": "[RW-4367][risk=no] Migrate ManualWorkspaceMapper to WorkspaceMapper (#3310)"}, {"oid": "7c3217c3265bf6d5fd1be4b1816d1fcd45c3d63f", "committedDate": "2020-03-30 12:28:18 -0700", "message": "[RW-4583][risk=low] Switch to Rawls cloneWorkspace (#3315)"}, {"oid": "6aa028a3a53c82cdf34bce6c12a057ba33031673", "committedDate": "2020-04-13 11:23:28 -0400", "message": "[RW-4249][Risk=low] Srubenst/data page objects (#3333)"}, {"oid": "03601f3f5518020c3fec73ebb9ccb6bf3fa8e7f8", "committedDate": "2020-04-20 15:38:43 -0700", "message": "[RW-3187][risk=no] Clean up dead clone workspace code (#3445)"}, {"oid": "2f2597114fbb9a204927a6736e323674ba2b61a2", "committedDate": "2020-05-28 21:52:43 -0700", "message": "[RW-4788][risk=no] Remove Zendesk integration on review request (#3619)"}, {"oid": "3a8c60e0f83f7271bf626524d7c2ccca3a03d68e", "committedDate": "2020-06-09 10:15:27 -0400", "message": "[RW-4825][risk=no] Misc. tweaks & small refactors split from main story branch (#3620)"}, {"oid": "cd5b5e28f3fdb8704994ef7a35ccb0fae1b08bbd", "committedDate": "2020-06-23 14:20:34 -0400", "message": "[RW-2400][RISK=HIGH] Prompt to update research purpose (#3684)"}, {"oid": "a77a1b75d797b27aa9785724cd146108d3e9e555", "committedDate": "2020-06-26 09:22:48 -0400", "message": "[risk=no] Remove our hacky API mapper and move all Controllers to the standard api package (#3710)"}]}, {"oid": "8c61a455cdfc68380560b8cfb9cbbaea06e92504", "url": "https://github.com/all-of-us/workbench/commit/8c61a455cdfc68380560b8cfb9cbbaea06e92504", "message": "pr fixes", "committedDate": "2020-02-12T21:24:21Z", "type": "commit"}, {"oid": "edc30030f149600010e063b707184f51c37f3e23", "url": "https://github.com/all-of-us/workbench/commit/edc30030f149600010e063b707184f51c37f3e23", "message": "spt", "committedDate": "2020-02-12T21:24:43Z", "type": "commit"}, {"oid": "c2262a94c235dd7e61e871b0e209fcc773fe7bf0", "url": "https://github.com/all-of-us/workbench/commit/c2262a94c235dd7e61e871b0e209fcc773fe7bf0", "message": "add assertions at  both levels  in nested ttest", "committedDate": "2020-02-12T21:36:26Z", "type": "commit"}, {"oid": "4ba37882a3d9a382afc1a5ac48cf8c49a9599d0f", "url": "https://github.com/all-of-us/workbench/commit/4ba37882a3d9a382afc1a5ac48cf8c49a9599d0f", "message": "merge master", "committedDate": "2020-02-13T17:31:55Z", "type": "commit"}, {"oid": "7ca640f668ec2443f55de1d7c3d7ed095a867cea", "url": "https://github.com/all-of-us/workbench/commit/7ca640f668ec2443f55de1d7c3d7ed095a867cea", "message": "record gauge collection times", "committedDate": "2020-02-13T22:17:00Z", "type": "commit"}, {"oid": "a9c23b8fdd4d3b1ea05544735cbf6656c8f65a2b", "url": "https://github.com/all-of-us/workbench/commit/a9c23b8fdd4d3b1ea05544735cbf6656c8f65a2b", "message": "merge master", "committedDate": "2020-02-13T23:08:22Z", "type": "commit"}, {"oid": "70adc47133f6171c974ac16bf3ba2e725d76197e", "url": "https://github.com/all-of-us/workbench/commit/70adc47133f6171c974ac16bf3ba2e725d76197e", "message": "cleanup", "committedDate": "2020-02-14T02:47:50Z", "type": "commit"}, {"oid": "47bdf13e28b582c2e2dbf7848e4828183a0d805c", "url": "https://github.com/all-of-us/workbench/commit/47bdf13e28b582c2e2dbf7848e4828183a0d805c", "message": "simplifyu", "committedDate": "2020-02-14T02:54:33Z", "type": "commit"}, {"oid": "1f70c38b62d26f516a479536658008eda9134a46", "url": "https://github.com/all-of-us/workbench/commit/1f70c38b62d26f516a479536658008eda9134a46", "message": "remove extraneous tmp file", "committedDate": "2020-02-14T03:01:31Z", "type": "commit"}, {"oid": "00af4bfdd30bfd01550a0b72b5ad73e6d098d21a", "url": "https://github.com/all-of-us/workbench/commit/00af4bfdd30bfd01550a0b72b5ad73e6d098d21a", "message": "dep", "committedDate": "2020-02-14T03:16:20Z", "type": "commit"}, {"oid": "4daf118079db199673ac3363255076071519e53d", "url": "https://github.com/all-of-us/workbench/commit/4daf118079db199673ac3363255076071519e53d", "message": "spotless", "committedDate": "2020-02-14T15:38:31Z", "type": "commit"}]}