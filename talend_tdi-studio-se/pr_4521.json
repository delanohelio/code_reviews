{"pr_number": 4521, "pr_title": "CreateTable component should use given connection", "pr_author": "jiezhang-tlnd", "pr_createdAt": "2020-03-11T10:26:42Z", "pr_url": "https://github.com/Talend/tdi-studio-se/pull/4521", "merge_commit": "f3ff8ec8168adaec13caa9dff02897c1cbffb6e1", "timeline": [{"oid": "0642d443c7881f6883e204d2b7759906b3495834", "url": "https://github.com/Talend/tdi-studio-se/commit/0642d443c7881f6883e204d2b7759906b3495834", "message": "CreateTable component should use given connection", "committedDate": "2020-03-11T10:22:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE3MDcyOQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4521#discussion_r394170729", "body": "I don't think it is specific for tCreateTable and we already have another constructure \r\npublic RepositoryReviewDialog(Shell parentShell, ERepositoryObjectType type, String repositoryType, String[] itemFilter) , itemFilter is used to filter the repository item to select . \r\nIf can't reuse this constructor , you can refer to this implementation.\r\n", "bodyText": "I don't think it is specific for tCreateTable and we already have another constructure\npublic RepositoryReviewDialog(Shell parentShell, ERepositoryObjectType type, String repositoryType, String[] itemFilter) , itemFilter is used to filter the repository item to select .\nIf can't reuse this constructor , you can refer to this implementation.", "bodyHTML": "<p dir=\"auto\">I don't think it is specific for tCreateTable and we already have another constructure<br>\npublic RepositoryReviewDialog(Shell parentShell, ERepositoryObjectType type, String repositoryType, String[] itemFilter) , itemFilter is used to filter the repository item to select .<br>\nIf can't reuse this constructor , you can refer to this implementation.</p>", "author": "wchen-talend", "createdAt": "2020-03-18T08:19:11Z", "path": "main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java", "diffHunk": "@@ -236,6 +246,16 @@ protected boolean selectRepositoryNode(Viewer viewer, RepositoryNode parentNode,\n                         return false;\n                     }\n                 }\n+\n+                if (connection instanceof DatabaseConnectionImpl) {\n+                    String databaseType = ((DatabaseConnectionImpl) connection).getDatabaseType();\n+                    if (StringUtils.equals(\"tCreateTable\", this.componentName) && listItemsDisplayName != null) {", "originalCommit": "0642d443c7881f6883e204d2b7759906b3495834", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d299fcad48ac2f1f3ed9df6b3f66c39e4381d3ee", "changed_code": [{"header": "diff --git a/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java b/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java\nindex 70bb8c8e8a..591e15184f 100644\n--- a/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java\n+++ b/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java\n", "chunk": "@@ -246,16 +236,6 @@ public class RepositoryTypeProcessor extends SingleTypeProcessor {\n                         return false;\n                     }\n                 }\n-\n-                if (connection instanceof DatabaseConnectionImpl) {\n-                    String databaseType = ((DatabaseConnectionImpl) connection).getDatabaseType();\n-                    if (StringUtils.equals(\"tCreateTable\", this.componentName) && listItemsDisplayName != null) {\n-                        if (!ArrayUtils.contains(listItemsDisplayName, databaseType)) {\n-                            return false;\n-                        }\n-                    }\n-                }\n-\n             }\n         }\n         if (repositoryType.startsWith(ERepositoryCategoryType.HEADERFOOTER.getName())) {\n", "next_change": null}]}, "revised_code_in_main": {"commit": "f3ff8ec8168adaec13caa9dff02897c1cbffb6e1", "changed_code": [{"header": "diff --git a/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java b/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java\nindex 70bb8c8e8a..9997d292a1 100644\n--- a/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java\n+++ b/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/processor/RepositoryTypeProcessor.java\n", "chunk": "@@ -239,23 +230,16 @@ public class RepositoryTypeProcessor extends SingleTypeProcessor {\n                     if (hidenTypeSelection) {\n                         return true;\n                     }\n-                    if (!MetadataTalendType.sameDBProductType(neededDbType, currentDbType)) {\n+                    \n+                    String currentXmlType = EDatabaseTypeName.getTypeFromDbType(currentDbType).getXMLType();\n+\t\t\t\t\tif (!MetadataTalendType.sameDBProductType(neededDbType, currentDbType)\n+\t\t\t\t\t\t\t&& !MetadataTalendType.sameDBProductType(neededDbType, currentXmlType)) {\n                         return false;\n                     }\n                     if(isGeneric && connection.getCompProperties() == null){\n                         return false;\n                     }\n                 }\n-\n-                if (connection instanceof DatabaseConnectionImpl) {\n-                    String databaseType = ((DatabaseConnectionImpl) connection).getDatabaseType();\n-                    if (StringUtils.equals(\"tCreateTable\", this.componentName) && listItemsDisplayName != null) {\n-                        if (!ArrayUtils.contains(listItemsDisplayName, databaseType)) {\n-                            return false;\n-                        }\n-                    }\n-                }\n-\n             }\n         }\n         if (repositoryType.startsWith(ERepositoryCategoryType.HEADERFOOTER.getName())) {\n", "next_change": null}]}, "commits_in_main": [{"oid": "f3ff8ec8168adaec13caa9dff02897c1cbffb6e1", "message": "Merge commit", "committedDate": null}, {"oid": "1b6a75cc1c491a7e22106d166039f454c133c15b", "committedDate": "2020-05-12 11:57:50 +0800", "message": "fix(TUP-27000):Talend Salesforce Einstein connector Repository (#4670)"}, {"oid": "7f4f5334389b242a9a1172f2753b212a2cc3ba72", "committedDate": "2021-03-04 18:06:13 +0800", "message": "feat(TUP-30114) Update Copyrights to 2021 for master code (#5902)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE3MTY4NQ==", "url": "https://github.com/Talend/tdi-studio-se/pull/4521#discussion_r394171685", "body": "https://github.com/Talend/tdi-studio-se/blob/master/main/plugins/org.talend.designer.core/src/main/java/org/talend/designer/core/ui/editor/properties/controllers/PropertyTypeController.java#L342\r\nCan we reuse the code in PropertyTypeController instead of here ?", "bodyText": "https://github.com/Talend/tdi-studio-se/blob/master/main/plugins/org.talend.designer.core/src/main/java/org/talend/designer/core/ui/editor/properties/controllers/PropertyTypeController.java#L342\nCan we reuse the code in PropertyTypeController instead of here ?", "bodyHTML": "<p dir=\"auto\"><a href=\"https://github.com/Talend/tdi-studio-se/blob/master/main/plugins/org.talend.designer.core/src/main/java/org/talend/designer/core/ui/editor/properties/controllers/PropertyTypeController.java#L342\">https://github.com/Talend/tdi-studio-se/blob/master/main/plugins/org.talend.designer.core/src/main/java/org/talend/designer/core/ui/editor/properties/controllers/PropertyTypeController.java#L342</a><br>\nCan we reuse the code in PropertyTypeController instead of here ?</p>", "author": "wchen-talend", "createdAt": "2020-03-18T08:21:10Z", "path": "main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java", "diffHunk": "@@ -305,6 +305,13 @@ private IRepositoryTypeProcessor createTypeProcessor() {\n                 return processor;\n             }\n         }\n+        String componentName = null;\n+        String[] listItemsDisplayName = null;\n+        if (this.elem != null && (this.elem instanceof INode)) {\n+            componentName = ((INode) elem).getComponent().getName();\n+            IElementParameter elementParameter = ((INode) elem).getElementParameter(\"DBTYPE\");\n+            listItemsDisplayName = elementParameter.getListItemsDisplayName();", "originalCommit": "0642d443c7881f6883e204d2b7759906b3495834", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d299fcad48ac2f1f3ed9df6b3f66c39e4381d3ee", "changed_code": [{"header": "diff --git a/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java b/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java\nindex 776f64b163..2a18376177 100644\n--- a/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java\n+++ b/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java\n", "chunk": "@@ -305,13 +305,6 @@ public class RepositoryReviewDialog extends Dialog {\n                 return processor;\n             }\n         }\n-        String componentName = null;\n-        String[] listItemsDisplayName = null;\n-        if (this.elem != null && (this.elem instanceof INode)) {\n-            componentName = ((INode) elem).getComponent().getName();\n-            IElementParameter elementParameter = ((INode) elem).getElementParameter(\"DBTYPE\");\n-            listItemsDisplayName = elementParameter.getListItemsDisplayName();\n-        }\n         boolean isGeneric = false;\n         if(this.elem != null && (this.elem instanceof INode)\n                 && ((INode)elem).getComponent().getComponentType() == EComponentType.GENERIC){\n", "next_change": null}]}, "revised_code_in_main": {"commit": "f3ff8ec8168adaec13caa9dff02897c1cbffb6e1", "changed_code": [{"header": "diff --git a/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java b/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java\nindex 776f64b163..2a18376177 100644\n--- a/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java\n+++ b/main/plugins/org.talend.repository/src/main/java/org/talend/repository/ui/dialog/RepositoryReviewDialog.java\n", "chunk": "@@ -305,13 +305,6 @@ public class RepositoryReviewDialog extends Dialog {\n                 return processor;\n             }\n         }\n-        String componentName = null;\n-        String[] listItemsDisplayName = null;\n-        if (this.elem != null && (this.elem instanceof INode)) {\n-            componentName = ((INode) elem).getComponent().getName();\n-            IElementParameter elementParameter = ((INode) elem).getElementParameter(\"DBTYPE\");\n-            listItemsDisplayName = elementParameter.getListItemsDisplayName();\n-        }\n         boolean isGeneric = false;\n         if(this.elem != null && (this.elem instanceof INode)\n                 && ((INode)elem).getComponent().getComponentType() == EComponentType.GENERIC){\n", "next_change": null}]}, "commits_in_main": [{"oid": "f3ff8ec8168adaec13caa9dff02897c1cbffb6e1", "message": "Merge commit", "committedDate": null}, {"oid": "9a6f1bbf40b6d8d4738c8c1c26194e1c509c55bf", "committedDate": "2020-09-24 09:12:51 +0800", "message": "feat(TUP-27654):Databricks Delta Lake - Support ELT & MERGE (#5078) (#5246)"}, {"oid": "9e0c3fe4cee6977f45a49c2277546c5aef2e1a62", "committedDate": "2021-02-26 17:47:36 +0800", "message": "feat(TUP-29014): backport 2021-02-26 (#5879) (#5880)"}, {"oid": "7f4f5334389b242a9a1172f2753b212a2cc3ba72", "committedDate": "2021-03-04 18:06:13 +0800", "message": "feat(TUP-30114) Update Copyrights to 2021 for master code (#5902)"}, {"oid": "ed40eed2ff0c0e9b4d1447f1b1d329b81e7f3450", "committedDate": "2023-01-10 15:58:44 +0800", "message": "TUP-30674 Support rename on custom jar and inner code. (#8212) (#8384)"}, {"oid": "72486c469338e4de51e76d973015690a5630e1ef", "committedDate": "2023-05-05 14:14:31 +0800", "message": "item(TUP-38247): provide component schema data (#8731)"}, {"oid": "63e07b425479ab75a24c9e204eb86584363cf8f4", "committedDate": "2023-06-02 10:45:45 +0800", "message": "item(TUP-38907): Duplicate designer plugins (#8832)"}]}, {"oid": "d299fcad48ac2f1f3ed9df6b3f66c39e4381d3ee", "url": "https://github.com/Talend/tdi-studio-se/commit/d299fcad48ac2f1f3ed9df6b3f66c39e4381d3ee", "message": "fix(TUP-23956)CreateTable component should not to use JDBC connection", "committedDate": "2020-03-18T10:14:46Z", "type": "commit"}, {"oid": "2bb06e61e8d234c7cd9e221f148185b2b7452d19", "url": "https://github.com/Talend/tdi-studio-se/commit/2bb06e61e8d234c7cd9e221f148185b2b7452d19", "message": "fix(TUP-23956)CreateTable component should not to use JDBC connection", "committedDate": "2020-03-18T14:35:14Z", "type": "commit"}, {"oid": "fa03502347a666a423d52027c3887c63a12b27da", "url": "https://github.com/Talend/tdi-studio-se/commit/fa03502347a666a423d52027c3887c63a12b27da", "message": "fix some metadata connection could not select tCreateTable when drag and\ndrop", "committedDate": "2020-03-24T07:27:55Z", "type": "commit"}, {"oid": "3fda6b5a93c2e9e4b2bfd79365af596b4ebf4284", "url": "https://github.com/Talend/tdi-studio-se/commit/3fda6b5a93c2e9e4b2bfd79365af596b4ebf4284", "message": "Merge branch 'master' into jzhang/bugfix/TUP-23956_CreateTable_should_use_given_connection", "committedDate": "2020-04-16T01:46:48Z", "type": "commit"}, {"oid": "8f4010359a3a301a56c3ac369ace7cbb4e3f1b09", "url": "https://github.com/Talend/tdi-studio-se/commit/8f4010359a3a301a56c3ac369ace7cbb4e3f1b09", "message": "fix(TUP-23956)CreateTable component should not to use JDBC connection", "committedDate": "2020-04-16T06:33:57Z", "type": "commit"}]}