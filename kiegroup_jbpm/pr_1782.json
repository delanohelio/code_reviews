{"pr_number": 1782, "pr_title": "[JBPM-9434] REST endpoint authetication fails if Authorization header\u2026", "pr_author": "abhijithumbe", "pr_createdAt": "2020-10-18T11:56:43Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1782", "timeline": [{"oid": "9c3805de6657a57e5dbc02e8e83ada3025bb4347", "url": "https://github.com/kiegroup/jbpm/commit/9c3805de6657a57e5dbc02e8e83ada3025bb4347", "message": "[JBPM-9434] REST endpoint authetication fails if Authorization header has == in encoded key in REST WIH", "committedDate": "2020-10-18T11:52:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQwODY5Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1782#discussion_r508408693", "body": "We can keep previous separator, but forcing the length of the resulting array, just to split with the first separator:\r\n```suggestion\r\n             String[] headerParts = h.split(\"=\", 2);\r\n```", "bodyText": "We can keep previous separator, but forcing the length of the resulting array, just to split with the first separator:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                         String[] headerParts = h.split(\":\");\n          \n          \n            \n                         String[] headerParts = h.split(\"=\", 2);", "bodyHTML": "<p dir=\"auto\">We can keep previous separator, but forcing the length of the resulting array, just to split with the first separator:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">             <span class=\"pl-k\">String</span>[] headerParts <span class=\"pl-k\">=</span> h<span class=\"pl-k\">.</span>split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first\">:</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">             <span class=\"pl-k\">String</span>[] headerParts <span class=\"pl-k\">=</span> h<span class=\"pl-k\">.</span>split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first\">=</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">, </span><span class=\"pl-c1 x x-last\">2</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "gmunozfe", "createdAt": "2020-10-20T11:02:55Z", "path": "jbpm-workitems/jbpm-workitems-rest/src/main/java/org/jbpm/process/workitem/rest/RESTWorkItemHandler.java", "diffHunk": "@@ -905,7 +905,7 @@ protected void addAcceptHeader(HttpRequestBase theMethod,\n     protected void addCustomHeaders(String headers,\n             BiConsumer<String, String> consumer) {\n         for(String h : headers.split(\";\")) {\n-             String[] headerParts = h.split(\"=\");\n+             String[] headerParts = h.split(\":\");", "originalCommit": "9c3805de6657a57e5dbc02e8e83ada3025bb4347", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0NTMwMA==", "url": "https://github.com/kiegroup/jbpm/pull/1782#discussion_r508445300", "bodyText": "@gmunozfe Thank you for pointing it out. I should have thought about backward compatibility.", "author": "abhijithumbe", "createdAt": "2020-10-20T12:07:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQwODY5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQxMTI5Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1782#discussion_r508411293", "body": "It should be the other way around (expected, current):\r\n```suggestion\r\n        assertEquals(headerValue, result);\r\n```\r\n", "bodyText": "It should be the other way around (expected, current):\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertEquals(result, headerValue);\n          \n          \n            \n                    assertEquals(headerValue, result);", "bodyHTML": "<p dir=\"auto\">It should be the other way around (expected, current):</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        assertEquals(<span class=\"x x-first x-last\">result, headerValue</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        assertEquals(<span class=\"x x-first x-last\">headerValue, result</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "gmunozfe", "createdAt": "2020-10-20T11:07:32Z", "path": "jbpm-workitems/jbpm-workitems-rest/src/test/java/org/jbpm/process/workitem/rest/RestWorkItemHandlerTest.java", "diffHunk": "@@ -1069,7 +1069,29 @@ public void testHeadersSingleValue() {\n         RESTWorkItemHandler handler = new RESTWorkItemHandler();\n         String headerKey = \"headerKey\";\n         String headerValue = \"headerValue\";\n-        String headers = headerKey + \"=\" + headerValue;\n+        String headers = headerKey + \":\" + headerValue;\n+         \n+        WorkItemImpl workItem = new WorkItemImpl();\n+        workItem.setParameter(\"Url\",\n+                              serverURL + \"/header/\" + headerKey);\n+        workItem.setParameter(\"Method\",\n+                              \"GET\");\n+        workItem.setParameter(PARAM_HEADERS, headers);\n+        \n+        WorkItemManager manager = new TestWorkItemManager();\n+        handler.executeWorkItem(workItem,\n+                                manager);\n+        Map<String, Object> results = ((TestWorkItemManager) manager).getResults(workItem.getId());\n+        String result = (String) results.get(PARAM_RESULT);\n+        assertEquals(result, headerValue);", "originalCommit": "9c3805de6657a57e5dbc02e8e83ada3025bb4347", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0NTc0MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1782#discussion_r508445741", "bodyText": "@gmunozfe Made suggested changes in this test case and in other test cases as well.", "author": "abhijithumbe", "createdAt": "2020-10-20T12:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQxMTI5Mw=="}], "type": "inlineReview"}, {"oid": "b55256baa72789b130b2809776c1e46111896974", "url": "https://github.com/kiegroup/jbpm/commit/b55256baa72789b130b2809776c1e46111896974", "message": "[JBPM-9434] REST endpoint authetication fails if Authorization header has == in encoded key in REST WIH", "committedDate": "2020-10-20T12:04:13Z", "type": "commit"}]}