{"pr_number": 1694, "pr_title": "[RHPAM-2796] Test for aborted type task when aborting process", "pr_author": "gmunozfe", "pr_createdAt": "2020-07-06T09:04:20Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1694", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY5NTI5MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1694#discussion_r450695291", "body": "I think below message is slightly clearer. I removed `Active` cause I understand that it might be in a different status other than Active? wdyt?\r\n\r\n```suggestion\r\n        assertEquals(\"Task node instance when aborting process should be in ABORTED status (2)\", \r\n```", "bodyText": "I think below message is slightly clearer. I removed Active cause I understand that it might be in a different status other than Active? wdyt?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertEquals(\"Active task node instance when aborting process should be at ABORTED type -2-\", \n          \n          \n            \n                    assertEquals(\"Task node instance when aborting process should be in ABORTED status (2)\",", "bodyHTML": "<p dir=\"auto\">I think below message is slightly clearer. I removed <code>Active</code> cause I understand that it might be in a different status other than Active? wdyt?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        assertEquals(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">Active task </span>node instance when aborting process should be <span class=\"x x-first x-last\">at</span> ABORTED <span class=\"x x-first x-last\">type -2-</span><span class=\"pl-pds\">\"</span></span>, </td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        assertEquals(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">Task </span>node instance when aborting process should be <span class=\"x x-first x-last\">in</span> ABORTED <span class=\"x x-first x-last\">status (2)</span><span class=\"pl-pds\">\"</span></span>, </td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "afalhambra", "createdAt": "2020-07-07T08:28:47Z", "path": "jbpm-audit/src/test/java/org/jbpm/process/audit/StandaloneAuditLogServiceTest.java", "diffHunk": "@@ -106,4 +108,23 @@ public void setAuditLogServiceForCommandTest() {\n         processInstances = setAuditLogServiceAndExecute(new FindProcessInstancesCommand(PROCESS_ID));\n         assertEquals(0, processInstances.size());\n     }\n+    \n+    @Test\n+    public void whenAbortingProcess_activeTaskShouldBeAtAbortedType() { \n+        String PROCESS_ID = \"com.sample.ruleflow4\";\n+        // start process instance\n+        long processInstanceId = ksession.startProcess(PROCESS_ID).getId();\n+        \n+        logger.info(\"Checking process instances for process '{}' before aborting\", PROCESS_ID);\n+       \n+        ksession.abortProcessInstance(processInstanceId);\n+        \n+        List<NodeInstanceLog> nodeInstances = auditLogService.findNodeInstances(processInstanceId);\n+        \n+        assertEquals(\"There should be 4 node instances\", 4, nodeInstances.size());\n+        assertEquals(\"Active task node instance when aborting process should be at ABORTED type -2-\", ", "originalCommit": "f5a762bedb3949f95a55ed07cdb12902423a48c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4OTg2OA==", "url": "https://github.com/kiegroup/jbpm/pull/1694#discussion_r451189868", "bodyText": "Done", "author": "gmunozfe", "createdAt": "2020-07-07T22:58:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY5NTI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY5NzYxMQ==", "url": "https://github.com/kiegroup/jbpm/pull/1694#discussion_r450697611", "body": "```suggestion\r\n        ksession.getWorkItemManager().registerWorkItemHandler(\"Not completed task\", new DoNothingWorkItemHandler());\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ksession.getWorkItemManager().registerWorkItemHandler(\"No completed task\", new DoNothingWorkItemHandler());\n          \n          \n            \n                    ksession.getWorkItemManager().registerWorkItemHandler(\"Not completed task\", new DoNothingWorkItemHandler());", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        ksession<span class=\"pl-k\">.</span>getWorkItemManager()<span class=\"pl-k\">.</span>registerWorkItemHandler(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">No</span> completed task<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">DoNothingWorkItemHandler</span>());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        ksession<span class=\"pl-k\">.</span>getWorkItemManager()<span class=\"pl-k\">.</span>registerWorkItemHandler(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">Not</span> completed task<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">DoNothingWorkItemHandler</span>());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "afalhambra", "createdAt": "2020-07-07T08:32:29Z", "path": "jbpm-audit/src/test/java/org/jbpm/process/audit/StandaloneAuditLogServiceTest.java", "diffHunk": "@@ -59,7 +60,8 @@ public void setUp() throws Exception {\n         ksession = createKieSession(kbase, env);\n         new JPAWorkingMemoryDbLogger(ksession);\n         ksession.getWorkItemManager().registerWorkItemHandler(\"Human Task\", new SystemOutWorkItemHandler());\n-       \n+        //Register a workitem that does not complete it when executed\n+        ksession.getWorkItemManager().registerWorkItemHandler(\"No completed task\", new DoNothingWorkItemHandler());", "originalCommit": "f5a762bedb3949f95a55ed07cdb12902423a48c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE5MDYyMQ==", "url": "https://github.com/kiegroup/jbpm/pull/1694#discussion_r451190621", "bodyText": "Done", "author": "gmunozfe", "createdAt": "2020-07-07T23:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY5NzYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcxNTAzNQ==", "url": "https://github.com/kiegroup/jbpm/pull/1694#discussion_r450715035", "body": "```suggestion\r\n    public void whenAbortingProcessTaskShouldBeInAbortedStatus() { \r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void whenAbortingProcess_activeTaskShouldBeAtAbortedType() { \n          \n          \n            \n                public void whenAbortingProcessTaskShouldBeInAbortedStatus() {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">whenAbortingProcess_activeTaskShouldBeAtAbortedType</span>() { </td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">whenAbortingProcessTaskShouldBeInAbortedStatus</span>() { </td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "afalhambra", "createdAt": "2020-07-07T09:00:42Z", "path": "jbpm-audit/src/test/java/org/jbpm/process/audit/StandaloneAuditLogServiceTest.java", "diffHunk": "@@ -106,4 +108,23 @@ public void setAuditLogServiceForCommandTest() {\n         processInstances = setAuditLogServiceAndExecute(new FindProcessInstancesCommand(PROCESS_ID));\n         assertEquals(0, processInstances.size());\n     }\n+    \n+    @Test\n+    public void whenAbortingProcess_activeTaskShouldBeAtAbortedType() { ", "originalCommit": "f5a762bedb3949f95a55ed07cdb12902423a48c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE5MTU1Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1694#discussion_r451191557", "bodyText": "Done", "author": "gmunozfe", "createdAt": "2020-07-07T23:04:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcxNTAzNQ=="}], "type": "inlineReview"}, {"oid": "04bed3c3cb45f296a0844e86f7130e5bff7d24aa", "url": "https://github.com/kiegroup/jbpm/commit/04bed3c3cb45f296a0844e86f7130e5bff7d24aa", "message": "[RHPAM-2796] Test for aborted type task when aborting process", "committedDate": "2020-07-07T23:03:19Z", "type": "commit"}, {"oid": "04bed3c3cb45f296a0844e86f7130e5bff7d24aa", "url": "https://github.com/kiegroup/jbpm/commit/04bed3c3cb45f296a0844e86f7130e5bff7d24aa", "message": "[RHPAM-2796] Test for aborted type task when aborting process", "committedDate": "2020-07-07T23:03:19Z", "type": "forcePushed"}]}