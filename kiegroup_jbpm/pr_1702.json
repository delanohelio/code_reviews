{"pr_number": 1702, "pr_title": "[JBPM-9248] RuntimeDataServiceCDIImplTest must abort process before deleting tables at after", "pr_author": "gmunozfe", "pr_createdAt": "2020-07-20T15:51:50Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1702", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkxMDQ1OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457910459", "body": "not sure why do we need to remove this line? Don't we have to abort instances before removing data from the tables?\r\nAlso, same method will be called in the `@after` method cleanup once this test is finished.", "bodyText": "not sure why do we need to remove this line? Don't we have to abort instances before removing data from the tables?\nAlso, same method will be called in the @after method cleanup once this test is finished.", "bodyHTML": "<p dir=\"auto\">not sure why do we need to remove this line? Don't we have to abort instances before removing data from the tables?<br>\nAlso, same method will be called in the <code>@after</code> method cleanup once this test is finished.</p>", "author": "afalhambra", "createdAt": "2020-07-21T08:01:08Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1038,7 +1038,6 @@ public void testGetTaskByIdWithCorrelation() {\n         assertNotNull(userTask);\n         assertCorrelationAndProcess(userTask, correlationKey);\n         assertEquals(processInstanceId, userTask.getProcessInstanceId());\n-        processService.abortProcessInstance(processInstanceId);", "originalCommit": "fa69f3eaafe531f2beefd636f4a5aa01964ecf80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk4MjQ2Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457982463", "bodyText": "In the after method, it will be aborted as other tests, so it's not strictly needed. Before this fixing, it was necessary for CDI tests to avoid failing and it was the main clue for understanding what was happening.", "author": "gmunozfe", "createdAt": "2020-07-21T10:03:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkxMDQ1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyMzcyNw==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457923727", "body": "this method is checking for the correlationKey rather than pids. Probably in this case correlationKey = pid always? would it not make sense to modify `assertTasks` method to fetch pids instead of correlationKey? all the calls to this method are passing pids. What do you think?", "bodyText": "this method is checking for the correlationKey rather than pids. Probably in this case correlationKey = pid always? would it not make sense to modify assertTasks method to fetch pids instead of correlationKey? all the calls to this method are passing pids. What do you think?", "bodyHTML": "<p dir=\"auto\">this method is checking for the correlationKey rather than pids. Probably in this case correlationKey = pid always? would it not make sense to modify <code>assertTasks</code> method to fetch pids instead of correlationKey? all the calls to this method are passing pids. What do you think?</p>", "author": "afalhambra", "createdAt": "2020-07-21T08:23:58Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1152,6 +1151,7 @@ public void testGetTaskAssignedAsBusinessAdminByStatus() {\n         List<TaskSummary> tasks = runtimeDataService.getTasksAssignedAsBusinessAdministratorByStatus(\"Administrator\", statuses, new QueryFilter(0, 5));\n         assertNotNull(tasks);\n         assertEquals(5, tasks.size());\n+        assertTasks(tasks, 5, pids);", "originalCommit": "fa69f3eaafe531f2beefd636f4a5aa01964ecf80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk4NDE5OA==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457984198", "bodyText": "the goal for this assertTasks method is to verify that correlationKey and processType have the expected value (pids and process respectively), as it was introduced in the jbpm#1680", "author": "gmunozfe", "createdAt": "2020-07-21T10:06:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyMzcyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyNTM4Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457925387", "body": "Small typo\r\n\r\n```suggestion\r\n        // need to abort all processes before deleting all the tables\r\n```", "bodyText": "Small typo\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    //neeed to abort all processes before deleting all the tables\n          \n          \n            \n                    // need to abort all processes before deleting all the tables", "bodyHTML": "<p dir=\"auto\">Small typo</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span><span class=\"x x-first x-last\">neeed</span> to abort all processes before deleting all the tables</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span><span class=\"x x-first x-last\"> need</span> to abort all processes before deleting all the tables</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "afalhambra", "createdAt": "2020-07-21T08:26:36Z", "path": "jbpm-services/jbpm-services-cdi/src/test/java/org/jbpm/services/cdi/test/RuntimeDataServiceCDIImplTest.java", "diffHunk": "@@ -173,7 +173,9 @@ public void setIdentityProvider(TestIdentityProvider identityProvider) {\n \t\n \t@After\n \tpublic void removeAllData() {\n-\t\tint deleted = 0;\n+        //neeed to abort all processes before deleting all the tables", "originalCommit": "fa69f3eaafe531f2beefd636f4a5aa01964ecf80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk4NDk1Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457984956", "bodyText": "done", "author": "gmunozfe", "createdAt": "2020-07-21T10:07:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyNTM4Nw=="}], "type": "inlineReview"}, {"oid": "bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "url": "https://github.com/kiegroup/jbpm/commit/bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "message": "[JBPM-9248] RuntimeDataServiceCDIImplTest must abort process before", "committedDate": "2020-07-21T10:07:05Z", "type": "commit"}, {"oid": "bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "url": "https://github.com/kiegroup/jbpm/commit/bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "message": "[JBPM-9248] RuntimeDataServiceCDIImplTest must abort process before", "committedDate": "2020-07-21T10:07:05Z", "type": "forcePushed"}]}