{"pr_number": 1741, "pr_title": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from t\u2026", "pr_author": "elguardian", "pr_createdAt": "2020-08-26T14:39:47Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1741", "timeline": [{"oid": "082b769fc85295ef5544a87ae8018daaedfa6f42", "url": "https://github.com/kiegroup/jbpm/commit/082b769fc85295ef5544a87ae8018daaedfa6f42", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-08-27T07:24:37Z", "type": "forcePushed"}, {"oid": "7f4a38cd0ccfdcb5286803edc07974e1227f25ba", "url": "https://github.com/kiegroup/jbpm/commit/7f4a38cd0ccfdcb5286803edc07974e1227f25ba", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-08-27T09:50:02Z", "type": "forcePushed"}, {"oid": "de5a7fa07f62d0607a93f9692c04c905090f2158", "url": "https://github.com/kiegroup/jbpm/commit/de5a7fa07f62d0607a93f9692c04c905090f2158", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-08-28T07:42:55Z", "type": "forcePushed"}, {"oid": "881b840b1a63dc908ad0f023a9f2e818426ad752", "url": "https://github.com/kiegroup/jbpm/commit/881b840b1a63dc908ad0f023a9f2e818426ad752", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-08-28T14:10:23Z", "type": "forcePushed"}, {"oid": "045277f82de8625b025eb87aac38557b364a8d64", "url": "https://github.com/kiegroup/jbpm/commit/045277f82de8625b025eb87aac38557b364a8d64", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-08-31T07:00:12Z", "type": "forcePushed"}, {"oid": "c20cffa0a939e8287b17d45bc73dd465051ec21e", "url": "https://github.com/kiegroup/jbpm/commit/c20cffa0a939e8287b17d45bc73dd465051ec21e", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-09-01T07:45:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgwOTE5NA==", "url": "https://github.com/kiegroup/jbpm/pull/1741#discussion_r481809194", "body": "`Arrays.asList().stream()` can be replaced with `Arrays.stream()` and method reference can be used in lambda\r\n```suggestion\r\n            descriptorHierarchy.addAll(Arrays.stream(presets).filter(Objects::nonNull).collect(toList()));\r\n```", "bodyText": "Arrays.asList().stream() can be replaced with Arrays.stream() and method reference can be used in lambda\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        descriptorHierarchy.addAll(asList(presets).stream().filter(e -> e != null).collect(toList()));\n          \n          \n            \n                        descriptorHierarchy.addAll(Arrays.stream(presets).filter(Objects::nonNull).collect(toList()));", "bodyHTML": "<p dir=\"auto\"><code>Arrays.asList().stream()</code> can be replaced with <code>Arrays.stream()</code> and method reference can be used in lambda</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            descriptorHierarchy<span class=\"pl-k\">.</span>addAll(<span class=\"x x-first x-last\">asList(presets)</span><span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>filter(<span class=\"x x-first\">e </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x\"> e </span><span class=\"pl-k x\">!=</span><span class=\"x\"> </span><span class=\"pl-c1 x x-last\">null</span>)<span class=\"pl-k\">.</span>collect(toList()));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            descriptorHierarchy<span class=\"pl-k\">.</span>addAll(<span class=\"pl-smi x x-first x-last\">Arrays</span><span class=\"pl-k\">.</span>stream(<span class=\"x x-first x-last\">presets</span>)<span class=\"pl-k\">.</span>filter(<span class=\"pl-smi x x-first\">Objects</span><span class=\"pl-k x\">::</span><span class=\"x x-last\">nonNull</span>)<span class=\"pl-k\">.</span>collect(toList()));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "afalhambra", "createdAt": "2020-09-02T07:02:07Z", "path": "jbpm-runtime-manager/src/main/java/org/jbpm/runtime/manager/impl/deploy/DeploymentDescriptorManagerUtil.java", "diffHunk": "@@ -35,6 +40,30 @@\n \n     private static final Logger logger = LoggerFactory.getLogger(DeploymentDescriptorManagerUtil.class);\n \n+    /**\n+     * This creates a deployment descriptor\n+     * @param manager\n+     * @param kieContainer\n+     * @param presets\n+     * @return\n+     */\n+    public static DeploymentDescriptor getDeploymentDescriptor(DeploymentDescriptorManager manager, KieContainer kieContainer, MergeMode mode, DeploymentDescriptor ...presets) {\n+        List<DeploymentDescriptor> descriptorHierarchy = new ArrayList<DeploymentDescriptor>();\n+        \n+\n+        if(presets != null) {\n+            descriptorHierarchy.addAll(asList(presets).stream().filter(e -> e != null).collect(toList()));", "originalCommit": "c20cffa0a939e8287b17d45bc73dd465051ec21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5OTE2OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1741#discussion_r483499169", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-04T09:23:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgwOTE5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgxMDEwNg==", "url": "https://github.com/kiegroup/jbpm/pull/1741#discussion_r481810106", "body": "Not used. Please remove", "bodyText": "Not used. Please remove", "bodyHTML": "<p dir=\"auto\">Not used. Please remove</p>", "author": "afalhambra", "createdAt": "2020-09-02T07:03:17Z", "path": "jbpm-runtime-manager/src/main/java/org/jbpm/runtime/manager/impl/deploy/DeploymentDescriptorManagerUtil.java", "diffHunk": "@@ -15,6 +15,10 @@\n  */\n package org.jbpm.runtime.manager.impl.deploy;\n \n+import static java.util.Arrays.asList;\n+import static java.util.Collections.addAll;", "originalCommit": "c20cffa0a939e8287b17d45bc73dd465051ec21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5NzQyNQ==", "url": "https://github.com/kiegroup/jbpm/pull/1741#discussion_r483497425", "bodyText": "asList is used", "author": "elguardian", "createdAt": "2020-09-04T09:19:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgxMDEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgxODQ3OA==", "url": "https://github.com/kiegroup/jbpm/pull/1741#discussion_r481818478", "body": "Can be simplified - `descriptor != null` is always true\r\n```suggestion\r\n    \t} else if (!deploymentUnit.isDeployed()) {\r\n```", "bodyText": "Can be simplified - descriptor != null is always true\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                \t} else if (descriptor != null && !deploymentUnit.isDeployed()) {\n          \n          \n            \n                \t} else if (!deploymentUnit.isDeployed()) {", "bodyHTML": "<p dir=\"auto\">Can be simplified - <code>descriptor != null</code> is always true</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    \t} <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"x x-first\">descriptor </span><span class=\"pl-k x\">!=</span><span class=\"x\"> </span><span class=\"pl-c1 x\">null</span><span class=\"x\"> </span><span class=\"pl-k x\">&amp;&amp;</span><span class=\"x x-last\"> </span><span class=\"pl-k\">!</span>deploymentUnit<span class=\"pl-k\">.</span>isDeployed()) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    \t} <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-k\">!</span>deploymentUnit<span class=\"pl-k\">.</span>isDeployed()) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "afalhambra", "createdAt": "2020-09-02T07:13:59Z", "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/KModuleDeploymentService.java", "diffHunk": "@@ -253,19 +253,12 @@ protected RuntimeEnvironmentBuilder boostrapRuntimeEnvironmentBuilder(KModuleDep\n     \tDeploymentDescriptor descriptor = deploymentUnit.getDeploymentDescriptor();\n     \tif (descriptor == null || ((DeploymentDescriptorImpl)descriptor).isEmpty()) { // skip empty descriptors as its default can override settings\n \t    \tDeploymentDescriptorManager descriptorManager = new DeploymentDescriptorManager(\"org.jbpm.domain\");\n-            List<DeploymentDescriptor> descriptorHierarchy = DeploymentDescriptorManagerUtil.getDeploymentDescriptorHierarchy(descriptorManager, kieContainer);\n-\n-\t\t\tdescriptor = merger.merge(descriptorHierarchy, mode);\n-\t\t\tdeploymentUnit.setDeploymentDescriptor(descriptor);\n+\t    \tdescriptor = getDeploymentDescriptor(descriptorManager, kieContainer, mode);\n     \t} else if (descriptor != null && !deploymentUnit.isDeployed()) {", "originalCommit": "c20cffa0a939e8287b17d45bc73dd465051ec21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5NzkzNQ==", "url": "https://github.com/kiegroup/jbpm/pull/1741#discussion_r483497935", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-04T09:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTgxODQ3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2NjcwNw==", "url": "https://github.com/kiegroup/jbpm/pull/1741#discussion_r483166707", "body": "Previously, descriptor was only set in both cases of previous \"if...else..\"; however, now it would be set even if deploymentUnit is deployed, is it right?", "bodyText": "Previously, descriptor was only set in both cases of previous \"if...else..\"; however, now it would be set even if deploymentUnit is deployed, is it right?", "bodyHTML": "<p dir=\"auto\">Previously, descriptor was only set in both cases of previous \"if...else..\"; however, now it would be set even if deploymentUnit is deployed, is it right?</p>", "author": "gmunozfe", "createdAt": "2020-09-03T18:14:12Z", "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/KModuleDeploymentService.java", "diffHunk": "@@ -253,19 +253,12 @@ protected RuntimeEnvironmentBuilder boostrapRuntimeEnvironmentBuilder(KModuleDep\n     \tDeploymentDescriptor descriptor = deploymentUnit.getDeploymentDescriptor();\n     \tif (descriptor == null || ((DeploymentDescriptorImpl)descriptor).isEmpty()) { // skip empty descriptors as its default can override settings\n \t    \tDeploymentDescriptorManager descriptorManager = new DeploymentDescriptorManager(\"org.jbpm.domain\");\n-            List<DeploymentDescriptor> descriptorHierarchy = DeploymentDescriptorManagerUtil.getDeploymentDescriptorHierarchy(descriptorManager, kieContainer);\n-\n-\t\t\tdescriptor = merger.merge(descriptorHierarchy, mode);\n-\t\t\tdeploymentUnit.setDeploymentDescriptor(descriptor);\n+\t    \tdescriptor = getDeploymentDescriptor(descriptorManager, kieContainer, mode);\n     \t} else if (descriptor != null && !deploymentUnit.isDeployed()) {\n     \t\tDeploymentDescriptorManager descriptorManager = new DeploymentDescriptorManager(\"org.jbpm.domain\");\n-            List<DeploymentDescriptor> descriptorHierarchy = DeploymentDescriptorManagerUtil.getDeploymentDescriptorHierarchy(descriptorManager, kieContainer);\n-\n-\t    \tdescriptorHierarchy.add(0, descriptor);\n-\t    \tdescriptor = merger.merge(descriptorHierarchy, mode);\n-\t\t\tdeploymentUnit.setDeploymentDescriptor(descriptor);\n+    \t\tdescriptor = getDeploymentDescriptor(descriptorManager, kieContainer, mode, deploymentUnit.getDeploymentDescriptor());\n     \t}\n-\n+        deploymentUnit.setDeploymentDescriptor(descriptor);", "originalCommit": "c20cffa0a939e8287b17d45bc73dd465051ec21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5ODU4OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1741#discussion_r483498589", "bodyText": "not sure about this. But I will change it how it was previously.", "author": "elguardian", "createdAt": "2020-09-04T09:22:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE2NjcwNw=="}], "type": "inlineReview"}, {"oid": "c0aba9842124f5bf6c84dcbe92b61ac1ae6d17a6", "url": "https://github.com/kiegroup/jbpm/commit/c0aba9842124f5bf6c84dcbe92b61ac1ae6d17a6", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-09-04T09:22:04Z", "type": "forcePushed"}, {"oid": "6016a8a39c178377940e18055222cdf79eb9af15", "url": "https://github.com/kiegroup/jbpm/commit/6016a8a39c178377940e18055222cdf79eb9af15", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-09-04T09:23:10Z", "type": "commit"}, {"oid": "6016a8a39c178377940e18055222cdf79eb9af15", "url": "https://github.com/kiegroup/jbpm/commit/6016a8a39c178377940e18055222cdf79eb9af15", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-09-04T09:23:10Z", "type": "forcePushed"}]}