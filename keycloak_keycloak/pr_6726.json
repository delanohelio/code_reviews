{"pr_number": 6726, "pr_title": "KEYCLOAK-10898 WildFly Adapter CLI based installation scripts", "pr_author": "vramik", "pr_createdAt": "2020-02-04T11:09:41Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6726", "timeline": [{"oid": "a0c57e6326008cc3f9622a2c966ca602dfb22771", "url": "https://github.com/keycloak/keycloak/commit/a0c57e6326008cc3f9622a2c966ca602dfb22771", "message": "KEYCLOAK-10898 WildFly Adapter CLI based installation scripts", "committedDate": "2020-02-04T15:11:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE3NDE1NQ==", "url": "https://github.com/keycloak/keycloak/pull/6726#discussion_r375174155", "body": "deploymentName should have quotes around it, otherwise spaces are lost and it becomes \"WARMODULENAME.war\" in standalone.xml.", "bodyText": "deploymentName should have quotes around it, otherwise spaces are lost and it becomes \"WARMODULENAME.war\" in standalone.xml.", "bodyHTML": "<p dir=\"auto\">deploymentName should have quotes around it, otherwise spaces are lost and it becomes \"WARMODULENAME.war\" in standalone.xml.</p>", "author": "stianst", "createdAt": "2020-02-05T10:28:20Z", "path": "services/src/main/java/org/keycloak/protocol/oidc/installation/KeycloakOIDCJbossSubsystemClientCliInstallation.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.protocol.oidc.installation;\n+\n+import org.keycloak.Config;\n+import org.keycloak.models.ClientModel;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.protocol.ClientInstallationProvider;\n+import org.keycloak.protocol.oidc.OIDCLoginProtocol;\n+\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.net.URI;\n+import java.util.Map;\n+\n+public class KeycloakOIDCJbossSubsystemClientCliInstallation implements ClientInstallationProvider {\n+\n+    @Override\n+    public Response generateInstallation(KeycloakSession session, RealmModel realm, ClientModel client, URI baseUri) {\n+        String deploymentName = \"WAR MODULE NAME.war\";\n+        StringBuilder builder = new StringBuilder();\n+        \n+        builder\n+                .append(\"/subsystem=keycloak/secure-deployment=\").append(deploymentName).append(\"/:add( \\\\\\n\")", "originalCommit": "a0c57e6326008cc3f9622a2c966ca602dfb22771", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE3NTc4OA==", "url": "https://github.com/keycloak/keycloak/pull/6726#discussion_r375175788", "body": "Use quotes instead of _ to make it consistent with XML download.", "bodyText": "Use quotes instead of _ to make it consistent with XML download.", "bodyHTML": "<p dir=\"auto\">Use quotes instead of _ to make it consistent with XML download.</p>", "author": "stianst", "createdAt": "2020-02-05T10:31:26Z", "path": "services/src/main/java/org/keycloak/protocol/saml/installation/KeycloakSamlSubsystemCliInstallation.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.protocol.saml.installation;\n+\n+import org.keycloak.Config;\n+import org.keycloak.models.ClientModel;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.protocol.ClientInstallationProvider;\n+import org.keycloak.protocol.saml.SamlClient;\n+import org.keycloak.protocol.saml.SamlProtocol;\n+\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.net.URI;\n+import javax.ws.rs.core.UriBuilder;\n+import org.keycloak.services.resources.RealmsResource;\n+\n+public class KeycloakSamlSubsystemCliInstallation implements ClientInstallationProvider {\n+\n+    @Override\n+    public Response generateInstallation(KeycloakSession session, RealmModel realm, ClientModel client, URI baseUri) {\n+        SamlClient samlClient = new SamlClient(client);\n+        StringBuilder builder = new StringBuilder();\n+        String entityId = client.getBaseUrl() == null ? \"SPECIFY_YOUR_entityID!\" : client.getBaseUrl();", "originalCommit": "a0c57e6326008cc3f9622a2c966ca602dfb22771", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE3NTgxNw==", "url": "https://github.com/keycloak/keycloak/pull/6726#discussion_r375175817", "body": "Use quotes instead of _ to make it consistent with XML download.", "bodyText": "Use quotes instead of _ to make it consistent with XML download.", "bodyHTML": "<p dir=\"auto\">Use quotes instead of _ to make it consistent with XML download.</p>", "author": "stianst", "createdAt": "2020-02-05T10:31:30Z", "path": "services/src/main/java/org/keycloak/protocol/saml/installation/KeycloakSamlSubsystemCliInstallation.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.protocol.saml.installation;\n+\n+import org.keycloak.Config;\n+import org.keycloak.models.ClientModel;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.protocol.ClientInstallationProvider;\n+import org.keycloak.protocol.saml.SamlClient;\n+import org.keycloak.protocol.saml.SamlProtocol;\n+\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.net.URI;\n+import javax.ws.rs.core.UriBuilder;\n+import org.keycloak.services.resources.RealmsResource;\n+\n+public class KeycloakSamlSubsystemCliInstallation implements ClientInstallationProvider {\n+\n+    @Override\n+    public Response generateInstallation(KeycloakSession session, RealmModel realm, ClientModel client, URI baseUri) {\n+        SamlClient samlClient = new SamlClient(client);\n+        StringBuilder builder = new StringBuilder();\n+        String entityId = client.getBaseUrl() == null ? \"SPECIFY_YOUR_entityID!\" : client.getBaseUrl();\n+        String bindingUrl = RealmsResource.protocolUrl(UriBuilder.fromUri(baseUri))\n+                .build(realm.getName(), SamlProtocol.LOGIN_PROTOCOL).toString();\n+        \n+        builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/:add\\n\\n\")\n+                .append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                .append(entityId)\n+                .append(\"/:add(sslPolicy=\")\n+                .append(realm.getSslRequired().name())\n+                .append(\",logoutPage=SPECIFY_YOUR_LOGOUT_PAGE!)\\n\\n\");", "originalCommit": "a0c57e6326008cc3f9622a2c966ca602dfb22771", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE3NTk2Mg==", "url": "https://github.com/keycloak/keycloak/pull/6726#discussion_r375175962", "body": "Use quotes instead of _ to make it consistent with XML download.", "bodyText": "Use quotes instead of _ to make it consistent with XML download.", "bodyHTML": "<p dir=\"auto\">Use quotes instead of _ to make it consistent with XML download.</p>", "author": "stianst", "createdAt": "2020-02-05T10:31:46Z", "path": "services/src/main/java/org/keycloak/protocol/saml/installation/KeycloakSamlSubsystemCliInstallation.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.protocol.saml.installation;\n+\n+import org.keycloak.Config;\n+import org.keycloak.models.ClientModel;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.protocol.ClientInstallationProvider;\n+import org.keycloak.protocol.saml.SamlClient;\n+import org.keycloak.protocol.saml.SamlProtocol;\n+\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.net.URI;\n+import javax.ws.rs.core.UriBuilder;\n+import org.keycloak.services.resources.RealmsResource;\n+\n+public class KeycloakSamlSubsystemCliInstallation implements ClientInstallationProvider {\n+\n+    @Override\n+    public Response generateInstallation(KeycloakSession session, RealmModel realm, ClientModel client, URI baseUri) {\n+        SamlClient samlClient = new SamlClient(client);\n+        StringBuilder builder = new StringBuilder();\n+        String entityId = client.getBaseUrl() == null ? \"SPECIFY_YOUR_entityID!\" : client.getBaseUrl();\n+        String bindingUrl = RealmsResource.protocolUrl(UriBuilder.fromUri(baseUri))\n+                .build(realm.getName(), SamlProtocol.LOGIN_PROTOCOL).toString();\n+        \n+        builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/:add\\n\\n\")\n+                .append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                .append(entityId)\n+                .append(\"/:add(sslPolicy=\")\n+                .append(realm.getSslRequired().name())\n+                .append(\",logoutPage=SPECIFY_YOUR_LOGOUT_PAGE!)\\n\\n\");\n+        if (samlClient.requiresClientSignature()) {\n+            builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                    .append(entityId)\n+                    .append(\"/Key=KEY1:add(signing=true, \\\\\\nPrivateKeyPem=\\\"\")\n+                    .append(samlClient.getClientSigningPrivateKey() == null ? \"PRIVATE_KEY_NOT_SET_UP_OR_KNOWN\" : samlClient.getClientSigningPrivateKey())\n+                    .append(\"\\\", \\\\\\nCertificatePem=\\\"\")\n+                    .append(samlClient.getClientSigningCertificate() == null ? \"YOU_MUST_CONFIGURE_YOUR_CLIENT's_SIGNING_CERTIFICATE\" : samlClient.getClientSigningCertificate())\n+                    .append(\"\\\")\\n\\n\");\n+        }\n+        if (samlClient.requiresEncryption()) {\n+            builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                    .append(entityId)\n+                    .append(\"/Key=KEY2:add(encryption=true,PrivateKeyPem=\\\"\")\n+                    .append(samlClient.getClientEncryptingPrivateKey() == null ? \"PRIVATE_KEY_NOT_SET_UP_OR_KNOWN\" : samlClient.getClientEncryptingPrivateKey())", "originalCommit": "a0c57e6326008cc3f9622a2c966ca602dfb22771", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE3NTk4Mw==", "url": "https://github.com/keycloak/keycloak/pull/6726#discussion_r375175983", "body": "Use quotes instead of _ to make it consistent with XML download.", "bodyText": "Use quotes instead of _ to make it consistent with XML download.", "bodyHTML": "<p dir=\"auto\">Use quotes instead of _ to make it consistent with XML download.</p>", "author": "stianst", "createdAt": "2020-02-05T10:31:49Z", "path": "services/src/main/java/org/keycloak/protocol/saml/installation/KeycloakSamlSubsystemCliInstallation.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.protocol.saml.installation;\n+\n+import org.keycloak.Config;\n+import org.keycloak.models.ClientModel;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.protocol.ClientInstallationProvider;\n+import org.keycloak.protocol.saml.SamlClient;\n+import org.keycloak.protocol.saml.SamlProtocol;\n+\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.net.URI;\n+import javax.ws.rs.core.UriBuilder;\n+import org.keycloak.services.resources.RealmsResource;\n+\n+public class KeycloakSamlSubsystemCliInstallation implements ClientInstallationProvider {\n+\n+    @Override\n+    public Response generateInstallation(KeycloakSession session, RealmModel realm, ClientModel client, URI baseUri) {\n+        SamlClient samlClient = new SamlClient(client);\n+        StringBuilder builder = new StringBuilder();\n+        String entityId = client.getBaseUrl() == null ? \"SPECIFY_YOUR_entityID!\" : client.getBaseUrl();\n+        String bindingUrl = RealmsResource.protocolUrl(UriBuilder.fromUri(baseUri))\n+                .build(realm.getName(), SamlProtocol.LOGIN_PROTOCOL).toString();\n+        \n+        builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/:add\\n\\n\")\n+                .append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                .append(entityId)\n+                .append(\"/:add(sslPolicy=\")\n+                .append(realm.getSslRequired().name())\n+                .append(\",logoutPage=SPECIFY_YOUR_LOGOUT_PAGE!)\\n\\n\");\n+        if (samlClient.requiresClientSignature()) {\n+            builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                    .append(entityId)\n+                    .append(\"/Key=KEY1:add(signing=true, \\\\\\nPrivateKeyPem=\\\"\")\n+                    .append(samlClient.getClientSigningPrivateKey() == null ? \"PRIVATE_KEY_NOT_SET_UP_OR_KNOWN\" : samlClient.getClientSigningPrivateKey())\n+                    .append(\"\\\", \\\\\\nCertificatePem=\\\"\")\n+                    .append(samlClient.getClientSigningCertificate() == null ? \"YOU_MUST_CONFIGURE_YOUR_CLIENT's_SIGNING_CERTIFICATE\" : samlClient.getClientSigningCertificate())", "originalCommit": "a0c57e6326008cc3f9622a2c966ca602dfb22771", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE3NjAwOA==", "url": "https://github.com/keycloak/keycloak/pull/6726#discussion_r375176008", "body": "Use quotes instead of _ to make it consistent with XML download.", "bodyText": "Use quotes instead of _ to make it consistent with XML download.", "bodyHTML": "<p dir=\"auto\">Use quotes instead of _ to make it consistent with XML download.</p>", "author": "stianst", "createdAt": "2020-02-05T10:31:52Z", "path": "services/src/main/java/org/keycloak/protocol/saml/installation/KeycloakSamlSubsystemCliInstallation.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.protocol.saml.installation;\n+\n+import org.keycloak.Config;\n+import org.keycloak.models.ClientModel;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.protocol.ClientInstallationProvider;\n+import org.keycloak.protocol.saml.SamlClient;\n+import org.keycloak.protocol.saml.SamlProtocol;\n+\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.net.URI;\n+import javax.ws.rs.core.UriBuilder;\n+import org.keycloak.services.resources.RealmsResource;\n+\n+public class KeycloakSamlSubsystemCliInstallation implements ClientInstallationProvider {\n+\n+    @Override\n+    public Response generateInstallation(KeycloakSession session, RealmModel realm, ClientModel client, URI baseUri) {\n+        SamlClient samlClient = new SamlClient(client);\n+        StringBuilder builder = new StringBuilder();\n+        String entityId = client.getBaseUrl() == null ? \"SPECIFY_YOUR_entityID!\" : client.getBaseUrl();\n+        String bindingUrl = RealmsResource.protocolUrl(UriBuilder.fromUri(baseUri))\n+                .build(realm.getName(), SamlProtocol.LOGIN_PROTOCOL).toString();\n+        \n+        builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/:add\\n\\n\")\n+                .append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                .append(entityId)\n+                .append(\"/:add(sslPolicy=\")\n+                .append(realm.getSslRequired().name())\n+                .append(\",logoutPage=SPECIFY_YOUR_LOGOUT_PAGE!)\\n\\n\");\n+        if (samlClient.requiresClientSignature()) {\n+            builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                    .append(entityId)\n+                    .append(\"/Key=KEY1:add(signing=true, \\\\\\nPrivateKeyPem=\\\"\")\n+                    .append(samlClient.getClientSigningPrivateKey() == null ? \"PRIVATE_KEY_NOT_SET_UP_OR_KNOWN\" : samlClient.getClientSigningPrivateKey())", "originalCommit": "a0c57e6326008cc3f9622a2c966ca602dfb22771", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bf321b9ca864ee2830852a31a7d926b3edec3e90", "url": "https://github.com/keycloak/keycloak/commit/bf321b9ca864ee2830852a31a7d926b3edec3e90", "message": "KEYCLOAK-10898 WildFly Adapter CLI based installation scripts", "committedDate": "2020-02-05T14:28:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgzNzQxMQ==", "url": "https://github.com/keycloak/keycloak/pull/6726#discussion_r375837411", "body": "introduce a method for escaping the quotes in any user-entered data: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/management_cli_guide/index#quotation_marks\r\n\r\n```suggestion\r\n                .append(\"/subsystem=keycloak/secure-deployment=\\\"\").append(quote(deploymentName)).append(\"\\\"/:add( \\\\\\n\")\r\n```", "bodyText": "introduce a method for escaping the quotes in any user-entered data: https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/management_cli_guide/index#quotation_marks\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .append(\"/subsystem=keycloak/secure-deployment=\\\"\").append(deploymentName).append(\"\\\"/:add( \\\\\\n\")\n          \n          \n            \n                            .append(\"/subsystem=keycloak/secure-deployment=\\\"\").append(quote(deploymentName)).append(\"\\\"/:add( \\\\\\n\")", "bodyHTML": "<p dir=\"auto\">introduce a method for escaping the quotes in any user-entered data: <a href=\"https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/management_cli_guide/index#quotation_marks\" rel=\"nofollow\">https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.1/html-single/management_cli_guide/index#quotation_marks</a></p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                .append(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/subsystem=keycloak/secure-deployment=<span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span>)<span class=\"pl-k\">.</span>append(deploymentName)<span class=\"pl-k\">.</span>append(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\\"</span>/:add( <span class=\"pl-cce\">\\\\\\n</span><span class=\"pl-pds\">\"</span></span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                .append(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/subsystem=keycloak/secure-deployment=<span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span>)<span class=\"pl-k\">.</span>append(<span class=\"x x-first x-last\">quote(</span>deploymentName<span class=\"x x-first x-last\">)</span>)<span class=\"pl-k\">.</span>append(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\\"</span>/:add( <span class=\"pl-cce\">\\\\\\n</span><span class=\"pl-pds\">\"</span></span>)</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "hmlnarik", "createdAt": "2020-02-06T13:38:52Z", "path": "services/src/main/java/org/keycloak/protocol/oidc/installation/KeycloakOIDCJbossSubsystemClientCliInstallation.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.protocol.oidc.installation;\n+\n+import org.keycloak.Config;\n+import org.keycloak.models.ClientModel;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.protocol.ClientInstallationProvider;\n+import org.keycloak.protocol.oidc.OIDCLoginProtocol;\n+\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.net.URI;\n+import java.util.Map;\n+\n+public class KeycloakOIDCJbossSubsystemClientCliInstallation implements ClientInstallationProvider {\n+\n+    @Override\n+    public Response generateInstallation(KeycloakSession session, RealmModel realm, ClientModel client, URI baseUri) {\n+        String deploymentName = \"WAR MODULE NAME.war\";\n+        StringBuilder builder = new StringBuilder();\n+        \n+        builder\n+                .append(\"/subsystem=keycloak/secure-deployment=\\\"\").append(deploymentName).append(\"\\\"/:add( \\\\\\n\")", "originalCommit": "bf321b9ca864ee2830852a31a7d926b3edec3e90", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a3ce9bee5f9b20d45c31a84c39f7b8b3808d6b73", "url": "https://github.com/keycloak/keycloak/commit/a3ce9bee5f9b20d45c31a84c39f7b8b3808d6b73", "message": "KEYCLOAK-10898 WildFly Adapter CLI based installation scripts", "committedDate": "2020-02-10T09:49:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk1MjAyMg==", "url": "https://github.com/keycloak/keycloak/pull/6726#discussion_r383952022", "body": "The `value` has to be quoted per https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/management_cli_guide/index#cli_special_characters", "bodyText": "The value has to be quoted per https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/management_cli_guide/index#cli_special_characters", "bodyHTML": "<p dir=\"auto\">The <code>value</code> has to be quoted per <a href=\"https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/management_cli_guide/index#cli_special_characters\" rel=\"nofollow\">https://access.redhat.com/documentation/en-us/red_hat_jboss_enterprise_application_platform/7.2/html-single/management_cli_guide/index#cli_special_characters</a></p>", "author": "hmlnarik", "createdAt": "2020-02-25T15:29:22Z", "path": "services/src/main/java/org/keycloak/protocol/saml/installation/KeycloakSamlSubsystemCliInstallation.java", "diffHunk": "@@ -0,0 +1,170 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates\n+ * and other contributors as indicated by the @author tags.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.keycloak.protocol.saml.installation;\n+\n+import org.keycloak.Config;\n+import org.keycloak.models.ClientModel;\n+import org.keycloak.models.KeycloakSession;\n+import org.keycloak.models.KeycloakSessionFactory;\n+import org.keycloak.models.RealmModel;\n+import org.keycloak.protocol.ClientInstallationProvider;\n+import org.keycloak.protocol.saml.SamlClient;\n+import org.keycloak.protocol.saml.SamlProtocol;\n+\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.net.URI;\n+import javax.ws.rs.core.UriBuilder;\n+import org.keycloak.services.resources.RealmsResource;\n+\n+public class KeycloakSamlSubsystemCliInstallation implements ClientInstallationProvider {\n+\n+    @Override\n+    public Response generateInstallation(KeycloakSession session, RealmModel realm, ClientModel client, URI baseUri) {\n+        SamlClient samlClient = new SamlClient(client);\n+        StringBuilder builder = new StringBuilder();\n+        String entityId = client.getBaseUrl() == null ? \"SPECIFY YOUR entityID!\" : client.getBaseUrl();\n+        String bindingUrl = RealmsResource.protocolUrl(UriBuilder.fromUri(baseUri))\n+                .build(realm.getName(), SamlProtocol.LOGIN_PROTOCOL).toString();\n+        \n+        builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/:add\\n\\n\")\n+                .append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                .append(quote(entityId))\n+                .append(\"/:add(sslPolicy=\")\n+                .append(realm.getSslRequired().name())\n+                .append(\",logoutPage=\")\n+                .append(quote(\"SPECIFY YOUR LOGOUT PAGE!\"))\n+                .append(\"\\n\\n\");\n+        if (samlClient.requiresClientSignature()) {\n+            builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                    .append(quote(entityId))\n+                    .append(\"/Key=KEY1:add(signing=true, \\\\\\nPrivateKeyPem=\")\n+                    .append(quote(samlClient.getClientSigningPrivateKey() == null ? \"PRIVATE KEY NOT SET UP OR KNOWN\" : samlClient.getClientSigningPrivateKey()))\n+                    .append(\", \\\\\\nCertificatePem=\")\n+                    .append(quote(samlClient.getClientSigningCertificate() == null ? \"YOU MUST CONFIGURE YOUR_CLIENT's SIGNING CERTIFICATE\" : samlClient.getClientSigningCertificate()))\n+                    .append(\")\\n\\n\");\n+        }\n+        if (samlClient.requiresEncryption()) {\n+            builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                    .append(quote(entityId))\n+                    .append(\"/Key=KEY2:add(encryption=true,PrivateKeyPem=\")\n+                    .append(quote(samlClient.getClientEncryptingPrivateKey() == null ? \"PRIVATE KEY NOT SET UP OR KNOWN\" : samlClient.getClientEncryptingPrivateKey()))\n+                    .append(\")\\n\\n\");\n+        }\n+        \n+        builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                .append(quote(entityId))\n+                .append(\"/IDP=idp/:add( \\\\\\n    SingleSignOnService={ \\\\\\n        signRequest=\")\n+                .append(Boolean.toString(samlClient.requiresClientSignature()))\n+                .append(\", \\\\\\n        validateResponseSignature=\")\n+                .append(Boolean.toString(samlClient.requiresRealmSignature()))\n+                .append(\", \\\\\\n        validateAssertionSignature=\")\n+                .append(Boolean.toString(samlClient.requiresAssertionSignature()))\n+                .append(\", \\\\\\n        requestBinding=POST, \\\\\\n        bindingUrl=\")\n+                .append(bindingUrl)\n+                .append(\"}, \\\\\\n    SingleLogoutService={ \\\\\\n        signRequest=\")\n+                .append(Boolean.toString(samlClient.requiresClientSignature()))\n+                .append(\", \\\\\\n        signResponse=\")\n+                .append(Boolean.toString(samlClient.requiresClientSignature()))\n+                .append(\", \\\\\\n        validateRequestSignature=\")\n+                .append(Boolean.toString(samlClient.requiresRealmSignature()))\n+                .append(\", \\\\\\n        validateResponseSignature=\")\n+                .append(Boolean.toString(samlClient.requiresRealmSignature()))\n+                .append(\", \\\\\\n        requestBinding=POST, \\\\\\n        responseBinding=POST, \\\\\\n        postBindingUrl=\")\n+                .append(bindingUrl)\n+                .append(\", \\\\\\n        redirectBindingUrl=\")\n+                .append(bindingUrl)\n+                .append(\"} \\\\\\n)\\n\\n\");\n+\n+        if (samlClient.requiresClientSignature()) {\n+            builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                    .append(quote(entityId))\n+                    .append(\"/IDP=idp/:write-attribute(name=signatureAlgorithm,value=\")\n+                    .append(samlClient.getSignatureAlgorithm())\n+                    .append(\")\\n\\n\");\n+            if (samlClient.getCanonicalizationMethod() != null) {\n+                builder.append(\"/subsystem=keycloak-saml/secure-deployment=YOUR-WAR.war/SP=\")\n+                        .append(quote(entityId))\n+                        .append(\"/IDP=idp/:write-attribute(name=signatureCanonicalizationMethod,value=\")\n+                        .append(samlClient.getCanonicalizationMethod())\n+                        .append(\")\\n\");\n+            }\n+        }\n+        \n+        return Response.ok(builder.toString(), MediaType.TEXT_PLAIN_TYPE).build();\n+    }\n+\n+    @Override\n+    public String getProtocol() {\n+        return SamlProtocol.LOGIN_PROTOCOL;\n+    }\n+\n+    @Override\n+    public String getDisplayType() {\n+        return \"Keycloak SAML JBoss Subsystem CLI\";\n+    }\n+\n+    @Override\n+    public String getHelpText() {\n+        return \"CLI script you must edit and apply to your client app server. This type of configuration is useful when you can't or don't want to crack open your WAR file.\";\n+    }\n+\n+    @Override\n+    public String getFilename() {\n+        return \"keycloak-saml-subsystem.cli\";\n+    }\n+\n+    @Override\n+    public String getMediaType() {\n+        return MediaType.TEXT_PLAIN;\n+    }\n+\n+    @Override\n+    public boolean isDownloadOnly() {\n+        return false;\n+    }\n+\n+    @Override\n+    public void close() {\n+\n+    }\n+\n+    @Override\n+    public ClientInstallationProvider create(KeycloakSession session) {\n+        return this;\n+    }\n+\n+    @Override\n+    public void init(Config.Scope config) {\n+\n+    }\n+\n+    @Override\n+    public void postInit(KeycloakSessionFactory factory) {\n+\n+    }\n+\n+    @Override\n+    public String getId() {\n+        return \"keycloak-saml-subsystem-cli\";\n+    }\n+\n+    private String quote(String value) {\n+        return \"\\\"\" + value + \"\\\"\";", "originalCommit": "a3ce9bee5f9b20d45c31a84c39f7b8b3808d6b73", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4fda71c80568f01e2564535a31b19479758027de", "url": "https://github.com/keycloak/keycloak/commit/4fda71c80568f01e2564535a31b19479758027de", "message": "KEYCLOAK-10898 WildFly Adapter CLI based installation scripts", "committedDate": "2020-02-26T14:28:04Z", "type": "forcePushed"}, {"oid": "e0ca09d1d3ee30ce38c92e7845776a6736fb877e", "url": "https://github.com/keycloak/keycloak/commit/e0ca09d1d3ee30ce38c92e7845776a6736fb877e", "message": "KEYCLOAK-10898 WildFly Adapter CLI based installation scripts", "committedDate": "2020-02-28T09:14:53Z", "type": "commit"}, {"oid": "e0ca09d1d3ee30ce38c92e7845776a6736fb877e", "url": "https://github.com/keycloak/keycloak/commit/e0ca09d1d3ee30ce38c92e7845776a6736fb877e", "message": "KEYCLOAK-10898 WildFly Adapter CLI based installation scripts", "committedDate": "2020-02-28T09:14:53Z", "type": "forcePushed"}]}