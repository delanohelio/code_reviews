{"pr_number": 3848, "pr_title": "Cexio streaming orderbook return an empty snapshot as first response \u2026", "pr_author": "katamarano", "pr_createdAt": "2020-12-21T17:44:56Z", "pr_url": "https://github.com/knowm/XChange/pull/3848", "merge_commit": "99ec3fbb22e34aa38e6969a50822b2d580cb00c3", "timeline": [{"oid": "1069b3fff371a400aa944686cd83dc23bb1df106", "url": "https://github.com/knowm/XChange/commit/1069b3fff371a400aa944686cd83dc23bb1df106", "message": "Cexio streaming orderbook return an empty snapshot as first response #3845", "committedDate": "2020-12-21T17:43:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg1MDI2Nw==", "url": "https://github.com/knowm/XChange/pull/3848#discussion_r546850267", "body": "Why is this second arg an array?", "bodyText": "Why is this second arg an array?", "bodyHTML": "<p dir=\"auto\">Why is this second arg an array?</p>", "author": "earce", "createdAt": "2020-12-21T18:02:11Z", "path": "xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java", "diffHunk": "@@ -73,7 +74,16 @@ private Object GetEventSubscriptionData(String channelName, boolean isSubscribe,\n       case ORDERBOOK:\n         {\n           CurrencyPair currencyPair = (CurrencyPair) args[0];\n-          return new CexioWebSocketOrderBookSubscriptionData(currencyPair, isSubscribe);\n+          int depth = 0;\n+          if (args[1] != null && args[1] instanceof Object[] && ((Object[]) args[1]).length > 0) {\n+            Object[] objArgs = (Object[]) args[1];", "originalCommit": "1069b3fff371a400aa944686cd83dc23bb1df106", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkxMDY1Mg==", "url": "https://github.com/knowm/XChange/pull/3848#discussion_r546910652", "bodyText": "It was the result of passing a vararg parameter, inside another varargs parameter. Yes, you are right, not needed and I already pushed a change to make things easier and clearer.", "author": "katamarano", "createdAt": "2020-12-21T20:18:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg1MDI2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "c12230d4649dddb8ea110421da33f7f49f23f285", "changed_code": [{"header": "diff --git a/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java b/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\nindex a124772214..223db3443d 100644\n--- a/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\n+++ b/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\n", "chunk": "@@ -74,15 +74,7 @@ public class CexioStreamingRawService extends JsonNettyStreamingService {\n       case ORDERBOOK:\n         {\n           CurrencyPair currencyPair = (CurrencyPair) args[0];\n-          int depth = 0;\n-          if (args[1] != null && args[1] instanceof Object[] && ((Object[]) args[1]).length > 0) {\n-            Object[] objArgs = (Object[]) args[1];\n-            if (objArgs.length > 0 && objArgs[0] instanceof Integer) {\n-              depth = (Integer) objArgs[0];\n-            } else {\n-              throw new IllegalArgumentException(\"Wrong value for depth parameter: \" + objArgs);\n-            }\n-          }\n+          int depth = (Integer) args[1];\n           return new CexioWebSocketOrderBookSubscriptionData(currencyPair, isSubscribe, depth);\n         }\n       default:\n", "next_change": null}]}, "revised_code_in_main": {"commit": "99ec3fbb22e34aa38e6969a50822b2d580cb00c3", "changed_code": [{"header": "diff --git a/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java b/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\nindex a124772214..223db3443d 100644\n--- a/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\n+++ b/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\n", "chunk": "@@ -74,15 +74,7 @@ public class CexioStreamingRawService extends JsonNettyStreamingService {\n       case ORDERBOOK:\n         {\n           CurrencyPair currencyPair = (CurrencyPair) args[0];\n-          int depth = 0;\n-          if (args[1] != null && args[1] instanceof Object[] && ((Object[]) args[1]).length > 0) {\n-            Object[] objArgs = (Object[]) args[1];\n-            if (objArgs.length > 0 && objArgs[0] instanceof Integer) {\n-              depth = (Integer) objArgs[0];\n-            } else {\n-              throw new IllegalArgumentException(\"Wrong value for depth parameter: \" + objArgs);\n-            }\n-          }\n+          int depth = (Integer) args[1];\n           return new CexioWebSocketOrderBookSubscriptionData(currencyPair, isSubscribe, depth);\n         }\n       default:\n", "next_change": {"commit": "5abd4911b858a90a1d266d4f817676d854b517e9", "changed_code": [{"header": "diff --git a/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java b/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\nindex 223db3443d..34863f60d7 100644\n--- a/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\n+++ b/xchange-stream-cexio/src/main/java/info/bitrich/xchangestream/cexio/CexioStreamingRawService.java\n", "chunk": "@@ -74,7 +74,10 @@ public class CexioStreamingRawService extends JsonNettyStreamingService {\n       case ORDERBOOK:\n         {\n           CurrencyPair currencyPair = (CurrencyPair) args[0];\n-          int depth = (Integer) args[1];\n+          int depth = 0;\n+          if (args.length > 1 && args[1] instanceof Integer) {\n+            depth = (int) args[1];\n+          }\n           return new CexioWebSocketOrderBookSubscriptionData(currencyPair, isSubscribe, depth);\n         }\n       default:\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "99ec3fbb22e34aa38e6969a50822b2d580cb00c3", "message": "Merge commit", "committedDate": null}, {"oid": "5abd4911b858a90a1d266d4f817676d854b517e9", "committedDate": "2020-12-23 17:49:51 +0100", "message": "Fix missing depth parameter in case of call from unsubscribe"}, {"oid": "1ac1be15d8234ba549622ba93e3ae7ba5d9c77bf", "committedDate": "2020-12-31 09:37:25 +0100", "message": "bump xchart dep and format code"}, {"oid": "112d7906def0d3a9a8a74fffb11424c6453a6888", "committedDate": "2021-06-30 08:54:15 +1000", "message": "Added vararsg to streaming getUnsubscribeMessage"}, {"oid": "723a38dc58330e75a8ef0d1d8a108823610235aa", "committedDate": "2022-01-24 22:27:09 +0100", "message": "format and organize imports"}, {"oid": "015000afaf62f55f3a31a92d42710af1f6e61836", "committedDate": "2022-09-02 18:24:45 +0200", "message": "replace mapper.readValue(json.toString(), CLASS.class) with mapper.treeToValue(json, CLASS.class)"}]}, {"oid": "c12230d4649dddb8ea110421da33f7f49f23f285", "url": "https://github.com/knowm/XChange/commit/c12230d4649dddb8ea110421da33f7f49f23f285", "message": "Cexio streaming orderbook return an empty snapshot as first response #3845\n-simplified passing of depth parameter", "committedDate": "2020-12-21T20:16:15Z", "type": "commit"}]}