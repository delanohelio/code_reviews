{"pr_number": 3463, "pr_title": "[Binance] Add subAccount Transfert History", "pr_author": "trixprod", "pr_createdAt": "2020-03-22T20:02:25Z", "pr_url": "https://github.com/knowm/XChange/pull/3463", "timeline": [{"oid": "c1df6cfe4296ba6877685db50fe967971eba64c8", "url": "https://github.com/knowm/XChange/commit/c1df6cfe4296ba6877685db50fe967971eba64c8", "message": "Add Sub Account transfert history", "committedDate": "2020-03-22T19:55:08Z", "type": "commit"}, {"oid": "5f3cb906c55448d83ff1ef842e4c74603b5fb1dd", "url": "https://github.com/knowm/XChange/commit/5f3cb906c55448d83ff1ef842e4c74603b5fb1dd", "message": "Add Sub Account transfert history", "committedDate": "2020-03-22T19:55:11Z", "type": "commit"}, {"oid": "520197da8563256e708dc1e924c4c19d1697a6b4", "url": "https://github.com/knowm/XChange/commit/520197da8563256e708dc1e924c4c19d1697a6b4", "message": "Restore version of xchange", "committedDate": "2020-03-22T19:57:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398388277", "body": "if your using lombok then these setters / getters are not needed", "bodyText": "if your using lombok then these setters / getters are not needed", "bodyHTML": "<p dir=\"auto\">if your using lombok then these setters / getters are not needed</p>", "author": "walec51", "createdAt": "2020-03-26T08:22:45Z", "path": "xchange-binance/src/main/java/org/knowm/xchange/binance/dto/account/TransfertHistoryResponse.java", "diffHunk": "@@ -0,0 +1,80 @@\n+package org.knowm.xchange.binance.dto.account;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import java.math.BigDecimal;\n+import java.util.Arrays;\n+import java.util.List;\n+import lombok.Data;\n+\n+public final class TransfertHistoryResponse\n+    extends WapiResponse<List<TransfertHistoryResponse.TransfertHistory>> {\n+\n+  private final TransfertHistory[] transfertHistories;\n+\n+  public TransfertHistoryResponse(\n+      @JsonProperty(\"transfers\") TransfertHistoryResponse.TransfertHistory[] transfertHistories,\n+      @JsonProperty(\"success\") boolean success,\n+      @JsonProperty(\"msg\") String msg) {\n+    super(success, msg);\n+    this.transfertHistories = transfertHistories;\n+  }\n+\n+  @Override\n+  public List<TransfertHistory> getData() {\n+    return Arrays.asList(transfertHistories);\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return \"transfertHistories [rows=\" + Arrays.toString(transfertHistories) + \"]\";\n+  }\n+\n+  @Data\n+  public static final class TransfertHistory {\n+    private String from;\n+    private String to;\n+    private String asset;\n+    private BigDecimal qty;\n+    private long time;\n+\n+    public String getFrom() {\n+      return from;\n+    }", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQwMjk0Mg==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398402942", "bodyText": "I haven't created unit test but if you remove getter, are you still able to create UT ?", "author": "trixprod", "createdAt": "2020-03-26T08:49:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3OTA5Mg==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r399779092", "bodyText": "I'm not telling to remove getters\nI'm telling to remove the getter code you have written by hand\nlombok will generate getters for you - this is how the @Data annotation you have used here works https://projectlombok.org/features/Data", "author": "walec51", "createdAt": "2020-03-29T10:45:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NjMyNw==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r402456327", "bodyText": "file name has a typo", "author": "conspyrosy", "createdAt": "2020-04-02T16:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0NjcwMg==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r402546702", "bodyText": "file name has a typo\n\nFixed all references from Transfert to Transfer ( without the 't' )", "author": "trixprod", "createdAt": "2020-04-02T19:06:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4ODI3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4OTczMQ==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398389731", "body": "I don't think this is needed", "bodyText": "I don't think this is needed", "bodyHTML": "<p dir=\"auto\">I don't think this is needed</p>", "author": "walec51", "createdAt": "2020-03-26T08:25:15Z", "path": "xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java", "diffHunk": "@@ -287,6 +304,52 @@ public TradeHistoryParams createFundingHistoryParams() {\n                 });\n       }\n \n+      final String finalEmail = email;", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODQwMzQxNQ==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398403415", "bodyText": "Lambda need final field. email field is null then affected to a value if needed.", "author": "trixprod", "createdAt": "2020-03-26T08:49:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4OTczMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM5MDI1Mg==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398390252", "body": "please use builder", "bodyText": "please use builder", "bodyHTML": "<p dir=\"auto\">please use builder</p>", "author": "walec51", "createdAt": "2020-03-26T08:26:10Z", "path": "xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java", "diffHunk": "@@ -287,6 +304,52 @@ public TradeHistoryParams createFundingHistoryParams() {\n                 });\n       }\n \n+      final String finalEmail = email;\n+\n+      if (email != null) {\n+        super.getTransfertHistory(email, startTime, endTime, page, limit)\n+            .forEach(\n+                a -> {\n+                  result.add(\n+                      new FundingRecord(", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM5MDMzOA==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398390338", "body": "please use builder", "bodyText": "please use builder", "bodyHTML": "<p dir=\"auto\">please use builder</p>", "author": "walec51", "createdAt": "2020-03-26T08:26:21Z", "path": "xchange-binance/src/main/java/org/knowm/xchange/binance/service/BinanceAccountService.java", "diffHunk": "@@ -287,6 +304,52 @@ public TradeHistoryParams createFundingHistoryParams() {\n                 });\n       }\n \n+      final String finalEmail = email;\n+\n+      if (email != null) {\n+        super.getTransfertHistory(email, startTime, endTime, page, limit)\n+            .forEach(\n+                a -> {\n+                  result.add(\n+                      new FundingRecord(\n+                          finalEmail,\n+                          null,\n+                          new Date(a.getTime()),\n+                          Currency.getInstance(a.getAsset()),\n+                          a.getQty(),\n+                          null,\n+                          null,\n+                          Type.SUBACCOUNT_OUTFLOW,\n+                          Status.COMPLETE,\n+                          null,\n+                          null,\n+                          null));\n+                });\n+      }\n+\n+      if (subAccount) {\n+\n+        Integer type = deposits && withdrawals ? null : deposits ? 1 : 0;\n+        super.getSubUserHistory(asset, type, startTime, endTime, limit)\n+            .forEach(\n+                a -> {\n+                  result.add(\n+                      new FundingRecord(", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM5ODQ5MQ==", "url": "https://github.com/knowm/XChange/pull/3463#discussion_r398398491", "body": "I think more generic names would be better as this is to Binance-specific\r\n\r\nsome exchanges have a flat structure with many account for a given currency and no master\r\n\r\nI would suggest:\r\n\r\n```\r\n    /**\r\n     * Withdrawal from the exchange a blockchain address or a bank account.\r\n     *\r\n     * Usually results in a withdrawal fee being subtracted\r\n     */\r\n    WITHDRAWAL(false),\r\n\r\n    /** Deposit from a blockchain address or a bank account to the exchange */\r\n    DEPOSIT(true),\r\n\r\n    /** Used for transfers between exchanges accounts */\r\n    INTERNAL_WITHDRAWAL(false);\r\n\r\n    /** Used for transfers between exchanges accounts */\r\n    INTERNAL_DEPOSIT(true),\r\n\r\n    /** Used for transfers between exchanges accounts */\r\n    INTERNAL_WITHDRAWAL(false);\r\n```", "bodyText": "I think more generic names would be better as this is to Binance-specific\nsome exchanges have a flat structure with many account for a given currency and no master\nI would suggest:\n    /**\n     * Withdrawal from the exchange a blockchain address or a bank account.\n     *\n     * Usually results in a withdrawal fee being subtracted\n     */\n    WITHDRAWAL(false),\n\n    /** Deposit from a blockchain address or a bank account to the exchange */\n    DEPOSIT(true),\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_WITHDRAWAL(false);\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_DEPOSIT(true),\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_WITHDRAWAL(false);", "bodyHTML": "<p dir=\"auto\">I think more generic names would be better as this is to Binance-specific</p>\n<p dir=\"auto\">some exchanges have a flat structure with many account for a given currency and no master</p>\n<p dir=\"auto\">I would suggest:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    /**\n     * Withdrawal from the exchange a blockchain address or a bank account.\n     *\n     * Usually results in a withdrawal fee being subtracted\n     */\n    WITHDRAWAL(false),\n\n    /** Deposit from a blockchain address or a bank account to the exchange */\n    DEPOSIT(true),\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_WITHDRAWAL(false);\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_DEPOSIT(true),\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_WITHDRAWAL(false);\"><pre><code>    /**\n     * Withdrawal from the exchange a blockchain address or a bank account.\n     *\n     * Usually results in a withdrawal fee being subtracted\n     */\n    WITHDRAWAL(false),\n\n    /** Deposit from a blockchain address or a bank account to the exchange */\n    DEPOSIT(true),\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_WITHDRAWAL(false);\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_DEPOSIT(true),\n\n    /** Used for transfers between exchanges accounts */\n    INTERNAL_WITHDRAWAL(false);\n</code></pre></div>", "author": "walec51", "createdAt": "2020-03-26T08:41:09Z", "path": "xchange-core/src/main/java/org/knowm/xchange/dto/account/FundingRecord.java", "diffHunk": "@@ -298,7 +298,13 @@ public String toString() {\n      * outflows defined above or their nature could not have been deduced from the exchanges\n      * response\n      */\n-    OTHER_OUTFLOW(false);\n+    OTHER_OUTFLOW(false),\n+\n+    /** Used for inflows that come from a sub account to the master account */\n+    SUBACCOUNT_INFLOW(true),", "originalCommit": "520197da8563256e708dc1e924c4c19d1697a6b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6c386a1dc6084af842ae06f5a561d0ce629421c0", "url": "https://github.com/knowm/XChange/commit/6c386a1dc6084af842ae06f5a561d0ce629421c0", "message": "[Binance] PR Review #3463\nAdd Sub Account transfert history", "committedDate": "2020-04-01T23:05:18Z", "type": "commit"}, {"oid": "e0f0a7390ec9df7934abe7009d69ee21289ef51f", "url": "https://github.com/knowm/XChange/commit/e0f0a7390ec9df7934abe7009d69ee21289ef51f", "message": "[Binance] PR Review #3463\nFix typo on Transfer(t)\nAdd Sub Account transfert history", "committedDate": "2020-04-02T19:02:12Z", "type": "commit"}]}