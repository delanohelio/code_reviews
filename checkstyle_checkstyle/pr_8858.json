{"pr_number": 8858, "pr_title": "Issue #8856: Local records fail to parse when annotated", "pr_author": "nmancus1", "pr_createdAt": "2020-09-29T18:22:02Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8858", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAxMDg3Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r497010876", "body": "Do we need this two lines?", "bodyText": "Do we need this two lines?", "bodyHTML": "<p dir=\"auto\">Do we need this two lines?</p>", "author": "pbludov", "createdAt": "2020-09-29T20:03:35Z", "path": "src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14LocalRecordAnnotation.java", "diffHunk": "@@ -0,0 +1,27 @@\n+//non-compiled with javac: Compilable with Java14\n+package com.puppycrawl.tools.checkstyle.grammar.java14;\n+\n+class InputJava14LocalRecordAnnotation {\n+\n+    public void doThing() {\n+        // No error unless an annotation is present\n+        @ProblemCauser\n+        record Test(String hello, int world) {}\n+\n+        @ProblemCauser\n+        class TestClass {}\n+\n+        @ProblemCauser @Deprecated\n+        record Test2(String hello, int world) {}\n+\n+        @ProblemCauser @Deprecated\n+        class TestClass2 {}\n+\n+        final var item = new Test(\"hi there\", 22);", "originalCommit": "254ea6f907fd1589d145f28dd84237d95dfaafe6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAxOTA3Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r497019076", "bodyText": "I usually try to keep inputs as close to the actual bug report as possible(must change the file name and add the header, etc), but I can remove them if you want.", "author": "nmancus1", "createdAt": "2020-09-29T20:19:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAxMDg3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAzMDE0Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r497030143", "bodyText": "I'm ok to keep this one.", "author": "pbludov", "createdAt": "2020-09-29T20:36:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAxMDg3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAzMjUzMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r497032533", "bodyText": "I just removed it anyway, I had to fix a spelling; I figured that I should get rid of it to prevent further CI runs. :)", "author": "nmancus1", "createdAt": "2020-09-29T20:39:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAxMDg3Ng=="}], "type": "inlineReview"}, {"oid": "ea66e86d1ae31cafd54b518936d6e22531e2a64e", "url": "https://github.com/checkstyle/checkstyle/commit/ea66e86d1ae31cafd54b518936d6e22531e2a64e", "message": "Issue #8856: Local records fail to parse when annotated", "committedDate": "2020-09-29T20:33:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1NzQxNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r499257416", "body": "please add few test cases with visibility modifers like \"private/public\" to see how they are located in AST under same `|--MODIFIERS`\r\n\r\nhttps://github.com/checkstyle/checkstyle/blob/3b73e3467fd7993cfd806fcd7ca44b6abed58dbe/src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14Records.java#L39", "bodyText": "please add few test cases with visibility modifers like \"private/public\" to see how they are located in AST under same |--MODIFIERS\n\n  \n    \n      checkstyle/src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14Records.java\n    \n    \n         Line 39\n      in\n      3b73e34\n    \n    \n    \n    \n\n        \n          \n           public record Polar(double r, double theta) implements Coords {", "bodyHTML": "<p dir=\"auto\">please add few test cases with visibility modifers like \"private/public\" to see how they are located in AST under same <code>|--MODIFIERS</code></p>\n<p dir=\"auto\"><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/checkstyle/checkstyle/blob/3b73e3467fd7993cfd806fcd7ca44b6abed58dbe/src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14Records.java#L39\">checkstyle/src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14Records.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 39\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/checkstyle/checkstyle/commit/3b73e3467fd7993cfd806fcd7ca44b6abed58dbe\">3b73e34</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L39\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"39\"></td>\n          <td id=\"LC39\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> record <span class=\"pl-en\">Polar</span>(<span class=\"pl-k\">double</span> <span class=\"pl-v\">r</span>, <span class=\"pl-k\">double</span> <span class=\"pl-v\">theta</span>) implements Coords { </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "author": "romani", "createdAt": "2020-10-04T15:17:35Z", "path": "src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14LocalRecordAnnotation.java", "diffHunk": "@@ -0,0 +1,24 @@\n+//non-compiled with javac: Compilable with Java14\n+package com.puppycrawl.tools.checkstyle.grammar.java14;\n+\n+class InputJava14LocalRecordAnnotation {\n+\n+    public void doThing() {\n+        // No error unless an annotation is present\n+        @ProblemCauser\n+        record Test(String hello, int world) {}", "originalCommit": "ea66e86d1ae31cafd54b518936d6e22531e2a64e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2OTI4MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r499269280", "bodyText": "Local records cannot have visibility modifiers:\n\u279c  src /usr/lib/jvm/java-14-openjdk/bin/javac --enable-preview --source 14 InputJava14LocalRecordAnnotation.java\nInputJava14LocalRecordAnnotation.java:15: error: modifier public not allowed here\n        public record Test2(String hello, int world) {}\n               ^\nNote: InputJava14LocalRecordAnnotation.java uses preview language features.\nNote: Recompile with -Xlint:preview for details.\n1 error\n\u279c  src /usr/lib/jvm/java-14-openjdk/bin/javac --enable-preview --source 14 InputJava14LocalRecordAnnotation.java\nInputJava14LocalRecordAnnotation.java:15: error: modifier private not allowed here\n        private record Test2(String hello, int world) {}\n                ^\nNote: InputJava14LocalRecordAnnotation.java uses preview language features.\nNote: Recompile with -Xlint:preview for details.\n1 error\n\u279c  src /usr/lib/jvm/java-14-openjdk/bin/javac --enable-preview --source 14 InputJava14LocalRecordAnnotation.java\nInputJava14LocalRecordAnnotation.java:15: error: modifier protected not allowed here\n        protected record Test2(String hello, int world) {}\n                  ^\nNote: InputJava14LocalRecordAnnotation.java uses preview language features.\nNote: Recompile with -Xlint:preview for details.\n1 error", "author": "nmancus1", "createdAt": "2020-10-04T17:28:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1NzQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3NzU1OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r499277559", "bodyText": "Please pay attention to link to source that I provided, I meant records at level of class fields, not inside methods.\nIf we have such already please share link", "author": "romani", "createdAt": "2020-10-04T18:58:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1NzQxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTMwNjEzOA==", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r499306138", "bodyText": "If we have such already please share link\n\nI'm sure we do in a check update UT somewhere, but it's probably faster to just add some.\n\nplease add few test cases\n\nDone.", "author": "nmancus1", "createdAt": "2020-10-05T00:37:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1NzQxNg=="}], "type": "inlineReview"}, {"oid": "73503f6f6ff99257e6ac21f043652846a286c3aa", "url": "https://github.com/checkstyle/checkstyle/commit/73503f6f6ff99257e6ac21f043652846a286c3aa", "message": "Issue #8856: Local records fail to parse when annotated", "committedDate": "2020-10-05T00:30:33Z", "type": "commit"}, {"oid": "73503f6f6ff99257e6ac21f043652846a286c3aa", "url": "https://github.com/checkstyle/checkstyle/commit/73503f6f6ff99257e6ac21f043652846a286c3aa", "message": "Issue #8856: Local records fail to parse when annotated", "committedDate": "2020-10-05T00:30:33Z", "type": "forcePushed"}]}