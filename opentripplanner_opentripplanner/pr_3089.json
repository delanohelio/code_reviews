{"pr_number": 3089, "pr_title": "Add support for public/private code", "pr_author": "gmellemstrand", "pr_createdAt": "2020-06-03T08:39:24Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089", "timeline": [{"oid": "65b35555e5a0bd58d81b2f1b85cc57f30246dee5", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/65b35555e5a0bd58d81b2f1b85cc57f30246dee5", "message": "Add support for public/private code", "committedDate": "2020-06-03T08:27:32Z", "type": "commit"}, {"oid": "d78db428c59a4d0cb35d6446fdaec3167d2e17a7", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d78db428c59a4d0cb35d6446fdaec3167d2e17a7", "message": "Javadoc", "committedDate": "2020-06-03T08:33:49Z", "type": "commit"}, {"oid": "d2e224ab15bc9fcd9c5f92ad230f342e301aeee6", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d2e224ab15bc9fcd9c5f92ad230f342e301aeee6", "message": "Added changelog entry", "committedDate": "2020-06-03T08:40:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzNTIwMg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r435835202", "body": "I suggest mapping the Netex `tripPublicCode` into `tripShortName` - maybe not exactly the same - but close enogh. Is there something in Netex that mappes better to GTFS `tripShortName`?\r\n\r\nWe should discuss on tuesday what to do with `tripPrivateCode`. The options are:\r\n 1. Add it to trip (as done here) - and add documentation.\r\n 2. Add a new field `Trip.extNetex` with type `NetexTripExtention`. The `NetexTripExtention` will have one field and that is `tripPrivateCode`. \r\n 3. Mape and index(Map) from Trip.id to 'tripPrivetCode' and store it in GraphIndex.\r\n\r\nConsiderations:\r\n- Is this a \"Entur\" specific hack?\r\n- Is it likely that we need to add more fields to Trip later, then option 2 is best. Also this make a good example on how to add stuff like this.\r\n", "bodyText": "I suggest mapping the Netex tripPublicCode into tripShortName - maybe not exactly the same - but close enogh. Is there something in Netex that mappes better to GTFS tripShortName?\nWe should discuss on tuesday what to do with tripPrivateCode. The options are:\n\nAdd it to trip (as done here) - and add documentation.\nAdd a new field Trip.extNetex with type NetexTripExtention. The NetexTripExtention will have one field and that is tripPrivateCode.\nMape and index(Map) from Trip.id to 'tripPrivetCode' and store it in GraphIndex.\n\nConsiderations:\n\nIs this a \"Entur\" specific hack?\nIs it likely that we need to add more fields to Trip later, then option 2 is best. Also this make a good example on how to add stuff like this.", "bodyHTML": "<p dir=\"auto\">I suggest mapping the Netex <code>tripPublicCode</code> into <code>tripShortName</code> - maybe not exactly the same - but close enogh. Is there something in Netex that mappes better to GTFS <code>tripShortName</code>?</p>\n<p dir=\"auto\">We should discuss on tuesday what to do with <code>tripPrivateCode</code>. The options are:</p>\n<ol dir=\"auto\">\n<li>Add it to trip (as done here) - and add documentation.</li>\n<li>Add a new field <code>Trip.extNetex</code> with type <code>NetexTripExtention</code>. The <code>NetexTripExtention</code> will have one field and that is <code>tripPrivateCode</code>.</li>\n<li>Mape and index(Map) from Trip.id to 'tripPrivetCode' and store it in GraphIndex.</li>\n</ol>\n<p dir=\"auto\">Considerations:</p>\n<ul dir=\"auto\">\n<li>Is this a \"Entur\" specific hack?</li>\n<li>Is it likely that we need to add more fields to Trip later, then option 2 is best. Also this make a good example on how to add stuff like this.</li>\n</ul>", "author": "t2gran", "createdAt": "2020-06-05T10:32:14Z", "path": "src/main/java/org/opentripplanner/model/Trip.java", "diffHunk": "@@ -15,6 +15,10 @@\n \n     private String tripShortName;\n \n+    private String tripPublicCode;\n+\n+    private String tripPrivateCode;\n+", "originalCommit": "d2e224ab15bc9fcd9c5f92ad230f342e301aeee6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjUxMTQ1MA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r436511450", "bodyText": "onebusaway-gtfs has the concept of extensions which could be used to add generic objects/fields to existing entities, which we've used extensively. It would be great to see something similar in OTP2.\nFrom NeTEx we also have a list of elements it would be nice to be able to store on objects: ServiceFacilitySetRef for ServiceJourneys, or PrivateCode for Quays and StopPlaces.\nMaybe adding a Map<Class<?>, Object> to TransitEntity<?> to store extensions (similar to the onebusaway-gtfs IdentityBean) could be an option?", "author": "flaktack", "createdAt": "2020-06-08T07:46:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzNTIwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgzNzQyNA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r438837424", "bodyText": "@flaktack We discussed this today, and I do not want a generic solution, because:\n\nIf this information is just \"pass through otp\", than maybe it make sense, but as soon as we add logic on top of it it this become problematic.\nWe want to encourage standardisation - enabling to have reusable components in the trip planning ecosystem.\nWe do not want to leave the documentation and integration to the OTP service provider.\nAdding a fields to TransitEntity would increase the memory consumption and overall performance - maybe not much, but enough that I care.\n\nWe agreed to map the NeTEx tripPublicCodeto the internal tripShortName and to add a new field internalRef for the NeTEx privateCode.", "author": "t2gran", "createdAt": "2020-06-11T14:41:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzNTIwMg=="}], "type": "inlineReview"}, {"oid": "665cb0876640fabc64a4b99ba346998878a5547c", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/665cb0876640fabc64a4b99ba346998878a5547c", "message": "Remove publicCode, remap to tripShortName and document", "committedDate": "2020-06-11T12:09:53Z", "type": "commit"}, {"oid": "17faa72c35496743d6cfc83bfe6d0669d25436d3", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/17faa72c35496743d6cfc83bfe6d0669d25436d3", "message": "Rename privateCode to internalPlanningCode", "committedDate": "2020-06-11T12:13:58Z", "type": "commit"}, {"oid": "ce02f7cdd001ae55f845e8a479366648a4bf9f64", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/ce02f7cdd001ae55f845e8a479366648a4bf9f64", "message": "Merge branch 'dev-2.x' into otp2_public_private_code", "committedDate": "2020-06-11T12:17:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg0NDQxNQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r438844415", "body": "In NeTEx this maps to {@link ServiceJourney#privateCode}, there is no GTFS equivalent.", "bodyText": "In NeTEx this maps to {@link ServiceJourney#privateCode}, there is no GTFS equivalent.", "bodyHTML": "<p dir=\"auto\">In NeTEx this maps to {<a class=\"user-mention\" data-hovercard-type=\"organization\" data-hovercard-url=\"/orgs/link/hovercard\" href=\"https://github.com/link\">@link</a> ServiceJourney#privateCode}, there is no GTFS equivalent.</p>", "author": "t2gran", "createdAt": "2020-06-11T14:51:30Z", "path": "src/main/java/org/opentripplanner/model/Trip.java", "diffHunk": "@@ -110,6 +115,17 @@ public void setTripShortName(String tripShortName) {\n         this.tripShortName = tripShortName;\n     }\n \n+    /**\n+     * Internal code (non-public identifier) for the journey (e.g. train- or trip number from\n+     * the planners' tool). This is kept to ensure compatibility with legacy planning systems.\n+     * There is no GTFS equivalent.", "originalCommit": "ce02f7cdd001ae55f845e8a479366648a4bf9f64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f2805240d46070656f8bb552ab09a5655bc93436", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f2805240d46070656f8bb552ab09a5655bc93436", "message": "Update changelog", "committedDate": "2020-06-12T09:48:18Z", "type": "commit"}, {"oid": "f4159d582448eec5d0dd9f56738edbff7109580c", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/f4159d582448eec5d0dd9f56738edbff7109580c", "message": "Update javadoc", "committedDate": "2020-06-12T09:49:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM3NDY5OA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3089#discussion_r439374698", "body": "No need to wrap this with a `if`", "bodyText": "No need to wrap this with a if", "bodyHTML": "<p dir=\"auto\">No need to wrap this with a <code>if</code></p>", "author": "t2gran", "createdAt": "2020-06-12T11:55:17Z", "path": "src/main/java/org/opentripplanner/netex/loader/mapping/TripMapper.java", "diffHunk": "@@ -62,6 +62,12 @@ Trip mapServiceJourney(ServiceJourney serviceJourney){\n         trip.setRoute(route);\n         trip.setServiceId(idFactory.createId(serviceId));\n         trip.setShapeId(getShapeId(serviceJourney));\n+        if (serviceJourney.getPrivateCode() != null) {\n+          trip.setInternalPlanningCode(serviceJourney.getPrivateCode().getValue());\n+        }\n+        if (serviceJourney.getPublicCode() != null) {\n+          trip.setTripShortName(serviceJourney.getPublicCode());\n+        }", "originalCommit": "f4159d582448eec5d0dd9f56738edbff7109580c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7c7aa6fe1cdd162d9430260c7abd21b41085f37e", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7c7aa6fe1cdd162d9430260c7abd21b41085f37e", "message": "Remove unecessary if-check", "committedDate": "2020-06-16T08:40:51Z", "type": "commit"}, {"oid": "fe2156f225fcb377cf3c6d51678d6d4c8f33f75f", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/fe2156f225fcb377cf3c6d51678d6d4c8f33f75f", "message": "Merge branch 'dev-2.x' into otp2_public_private_code", "committedDate": "2020-06-16T08:42:36Z", "type": "commit"}]}