{"pr_number": 3713, "pr_title": "Use BackendStatus to show BE's infomation in `show backends;`", "pr_author": "WingsGo", "pr_createdAt": "2020-05-28T08:06:06Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3713", "timeline": [{"oid": "60cf102d6ad8422487a0dd2a122043ecfed80b4b", "url": "https://github.com/apache/incubator-doris/commit/60cf102d6ad8422487a0dd2a122043ecfed80b4b", "message": "Use BackendStatus to show BE's infomation in `show backends;`\n    The infomation is displayed in JSON format.", "committedDate": "2020-05-28T07:31:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MjU2MA==", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r431672560", "body": "```suggestion\r\n    private BackendStatus backendStatus = new BackendStatus();\r\n```\r\nAnd remove all constructors below.", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private BackendStatus backendStatus;\n          \n          \n            \n                private BackendStatus backendStatus = new BackendStatus();\n          \n      \n    \n    \n  \n\nAnd remove all constructors below.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">BackendStatus</span> backendStatus;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">BackendStatus</span> backendStatus<span class=\"x x-first\"> </span><span class=\"pl-k x\">=</span><span class=\"x\"> </span><span class=\"pl-k x\">new</span><span class=\"x\"> </span><span class=\"pl-smi x\">BackendStatus</span><span class=\"x x-last\">()</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">And remove all constructors below.</p>", "author": "morningman", "createdAt": "2020-05-28T08:36:35Z", "path": "fe/src/main/java/org/apache/doris/system/Backend.java", "diffHunk": "@@ -94,6 +94,9 @@\n     // this field is set by tablet report, and just for metric monitor, no need to persist.\n     private AtomicLong tabletMaxCompactionScore = new AtomicLong(0);\n \n+    // additional backendStatus information for BE, display in JSON format\n+    private BackendStatus backendStatus;", "originalCommit": "60cf102d6ad8422487a0dd2a122043ecfed80b4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzI5OQ==", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r431673299", "body": "Better to create a method called `backend.updateStatus()`  to set these infos. \r\nMaybe we will add more info later.", "bodyText": "Better to create a method called backend.updateStatus()  to set these infos.\nMaybe we will add more info later.", "bodyHTML": "<p dir=\"auto\">Better to create a method called <code>backend.updateStatus()</code>  to set these infos.<br>\nMaybe we will add more info later.</p>", "author": "morningman", "createdAt": "2020-05-28T08:37:41Z", "path": "fe/src/main/java/org/apache/doris/master/ReportHandler.java", "diffHunk": "@@ -247,6 +249,13 @@ private static void tabletReport(long backendId, Map<Long, TTablet> backendTable\n         LOG.info(\"backend[{}] reports {} tablet(s). report version: {}\",\n                  backendId, backendTablets.size(), backendReportVersion);\n \n+        final SystemInfoService currentSystemInfo = Catalog.getCurrentSystemInfo();\n+        Backend reportBackend = currentSystemInfo.getBackend(backendId);\n+        if (reportBackend != null) {\n+            BackendStatus backendStatus = reportBackend.getBackendStatus();\n+            backendStatus.lastTabletReportTime = TimeUtils.longToTimeString(start);", "originalCommit": "60cf102d6ad8422487a0dd2a122043ecfed80b4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcwMjM4Mw==", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r431702383", "bodyText": "if we need add more info, we can just add a new Field in BackendStatus and set the field's value, and new info will be shown in show backends, why we need to set the value and update the value?I think we can just set the value, and the new value will be shown when we use show backends?", "author": "WingsGo", "createdAt": "2020-05-28T09:27:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzI5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg1NzUxOQ==", "url": "https://github.com/apache/incubator-doris/pull/3713#discussion_r433857519", "bodyText": "It ok, not a big deal.\nOh, I suggest to set this value right after the report in done, in case some other error happens during the report process.", "author": "morningman", "createdAt": "2020-06-02T13:03:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzI5OQ=="}], "type": "inlineReview"}, {"oid": "32767a7900af2bb18432c5a3d5b9637bf859e51a", "url": "https://github.com/apache/incubator-doris/commit/32767a7900af2bb18432c5a3d5b9637bf859e51a", "message": "fix by review", "committedDate": "2020-05-28T09:36:26Z", "type": "commit"}, {"oid": "ec338d61290c1f91696b119919b91c0b6cd6ef3c", "url": "https://github.com/apache/incubator-doris/commit/ec338d61290c1f91696b119919b91c0b6cd6ef3c", "message": "add doc", "committedDate": "2020-05-28T12:24:37Z", "type": "commit"}, {"oid": "3f931fdc054f6f0d73155ad71a79bac3e3d089ce", "url": "https://github.com/apache/incubator-doris/commit/3f931fdc054f6f0d73155ad71a79bac3e3d089ce", "message": "fix by review", "committedDate": "2020-06-03T03:52:46Z", "type": "commit"}, {"oid": "e442ffad3cd14c880c94aeba8c9012d71cc0bb63", "url": "https://github.com/apache/incubator-doris/commit/e442ffad3cd14c880c94aeba8c9012d71cc0bb63", "message": "Merge branch 'add_be_status' of github.com:WingsGo/incubator-doris into add_be_status", "committedDate": "2020-06-03T03:53:30Z", "type": "commit"}]}