{"pr_number": 4778, "pr_title": "Error happened when open a view in DBeaver", "pr_author": "pengxiangyu", "pr_createdAt": "2020-10-22T07:57:43Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4778", "timeline": [{"oid": "bfaf1b684a3c8649d74f9a5e38935dc2c1266d18", "url": "https://github.com/apache/incubator-doris/commit/bfaf1b684a3c8649d74f9a5e38935dc2c1266d18", "message": "Error happened when open a view in DBeaver", "committedDate": "2020-10-22T07:27:17Z", "type": "commit"}, {"oid": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "url": "https://github.com/apache/incubator-doris/commit/bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "message": "Fix bug: Error happened when open a view in DBeaver", "committedDate": "2020-10-22T08:00:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE3MTYxMQ==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r510171611", "body": "Add comment for this new field", "bodyText": "Add comment for this new field", "bodyHTML": "<p dir=\"auto\">Add comment for this new field</p>", "author": "morningman", "createdAt": "2020-10-22T13:42:29Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/Table.java", "diffHunk": "@@ -95,6 +95,8 @@\n     // table(view)'s comment\n     protected String comment = \"\";\n \n+    protected String ddlSql = \"\";", "originalCommit": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTY5OTE2Mg==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r511699162", "body": "why this column length is 77, you should add a comment, this column in mysql is 288", "bodyText": "why this column length is 77, you should add a comment, this column in mysql is 288", "bodyHTML": "<p dir=\"auto\">why this column length is 77, you should add a comment, this column in mysql is 288</p>", "author": "yangzhg", "createdAt": "2020-10-26T03:09:13Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java", "diffHunk": "@@ -281,6 +281,23 @@ public static Builder builder() {\n                                                  .column(\"XA\", ScalarType.createVarchar(3))\n                                                  .column(\"SAVEPOINTS\", ScalarType.createVarchar(3))\n                                                  .build()))\n+                    .put(\"views\",\n+                        new SchemaTable(\n+                                SystemIdGenerator.getNextId(),\n+                                \"views\",\n+                                TableType.SCHEMA,\n+                                builder()\n+                                        .column(\"TABLE_CATALOG\", ScalarType.createVarchar(512))\n+                                        .column(\"TABLE_SCHEMA\", ScalarType.createVarchar(64))\n+                                        .column(\"TABLE_NAME\", ScalarType.createVarchar(64))\n+                                        .column(\"VIEW_DEFINITION\", ScalarType.createVarchar(8096))\n+                                        .column(\"CHECK_OPTION\", ScalarType.createVarchar(8))\n+                                        .column(\"IS_UPDATABLE\", ScalarType.createVarchar(3))\n+                                        .column(\"DEFINER\", ScalarType.createVarchar(77))\n+                                        .column(\"SECURITY_TYPE\", ScalarType.createVarchar(7))", "originalCommit": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUxMTExOA==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r512511118", "bodyText": "Maybe you get another version of mysql. the sql I got is like this.", "author": "pengxiangyu", "createdAt": "2020-10-27T08:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTY5OTE2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTY5OTIxOA==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r511699218", "body": "why 32", "bodyText": "why 32", "bodyHTML": "<p dir=\"auto\">why 32</p>", "author": "yangzhg", "createdAt": "2020-10-26T03:09:25Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java", "diffHunk": "@@ -281,6 +281,23 @@ public static Builder builder() {\n                                                  .column(\"XA\", ScalarType.createVarchar(3))\n                                                  .column(\"SAVEPOINTS\", ScalarType.createVarchar(3))\n                                                  .build()))\n+                    .put(\"views\",\n+                        new SchemaTable(\n+                                SystemIdGenerator.getNextId(),\n+                                \"views\",\n+                                TableType.SCHEMA,\n+                                builder()\n+                                        .column(\"TABLE_CATALOG\", ScalarType.createVarchar(512))\n+                                        .column(\"TABLE_SCHEMA\", ScalarType.createVarchar(64))\n+                                        .column(\"TABLE_NAME\", ScalarType.createVarchar(64))\n+                                        .column(\"VIEW_DEFINITION\", ScalarType.createVarchar(8096))\n+                                        .column(\"CHECK_OPTION\", ScalarType.createVarchar(8))\n+                                        .column(\"IS_UPDATABLE\", ScalarType.createVarchar(3))\n+                                        .column(\"DEFINER\", ScalarType.createVarchar(77))\n+                                        .column(\"SECURITY_TYPE\", ScalarType.createVarchar(7))\n+                                        .column(\"CHARACTER_SET_CLIENT\", ScalarType.createVarchar(32))\n+                                        .column(\"COLLATION_CONNECTION\", ScalarType.createVarchar(32))", "originalCommit": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUxMTM0OA==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r512511348", "bodyText": "the sql I got is like this.", "author": "pengxiangyu", "createdAt": "2020-10-27T08:52:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTY5OTIxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcwMDU1NA==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r511700554", "body": "```suggestion\r\n               List<Table> tables = db.getTables();\r\n                if (params.isSetType() && \"VIEW\".equals(params.getType())) {\r\n                    tables = db. getViews();\r\n                }\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            }\n          \n          \n            \n                           List<Table> tables = db.getTables();\n          \n          \n            \n                            if (params.isSetType() && \"VIEW\".equals(params.getType())) {\n          \n          \n            \n                                tables = db. getViews();\n          \n          \n            \n                            }", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"262\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">               <span class=\"x x-first x-last\"> }</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"262\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">               <span class=\"pl-k\"><span class=\"x x-first\">List&lt;</span><span class=\"pl-smi x\">Table</span><span class=\"x\">&gt;</span></span><span class=\"x\"> tables </span><span class=\"pl-k x\">=</span><span class=\"x\"> db</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getTables();</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"263\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">if</span> (params<span class=\"pl-k\">.</span>isSetType() <span class=\"pl-k\">&amp;&amp;</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>VIEW<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">.</span>equals(params<span class=\"pl-k\">.</span>getType())) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"264\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                    tables <span class=\"pl-k\">=</span> db. getViews();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"265\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "yangzhg", "createdAt": "2020-10-26T03:16:09Z", "path": "fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java", "diffHunk": "@@ -248,7 +248,19 @@ public TListTableStatusResult listTableStatus(TGetTablesParams params) throws TE\n         if (db != null) {\n             db.readLock();\n             try {\n-                for (Table table : db.getTables()) {\n+                List<Table> tables = null;\n+                if (!params.isSetType() || params.getType() == null || params.getType().isEmpty()) {\n+                    tables = db.getTables();\n+                } else {\n+                    switch (params.getType()) {\n+                        case \"VIEW\":\n+                            tables = db.getViews();\n+                            break;\n+                        default:\n+                            tables = db.getTables();\n+                    }\n+                }", "originalCommit": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUxNDQyMg==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r512514422", "bodyText": "If type is view, this will call getTables() which is not required. When the count of tables in this db is too many, this will take more time.", "author": "pengxiangyu", "createdAt": "2020-10-27T08:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcwMDU1NA=="}], "type": "inlineReview"}, {"oid": "c58f31bfa130c6a9ebb2ca0c85fa85fc2d4174e7", "url": "https://github.com/apache/incubator-doris/commit/c58f31bfa130c6a9ebb2ca0c85fa85fc2d4174e7", "message": "Fix bug: Error happened when open a view in DBeaver", "committedDate": "2020-10-27T09:08:43Z", "type": "commit"}, {"oid": "79be4f098fbffb793193aac8246cedd48cff56bf", "url": "https://github.com/apache/incubator-doris/commit/79be4f098fbffb793193aac8246cedd48cff56bf", "message": "Fix bug: Error happened when open a view in DBeaver", "committedDate": "2020-10-27T09:18:41Z", "type": "commit"}, {"oid": "59066ea666b95e753bd92869a5ea361e9c65c916", "url": "https://github.com/apache/incubator-doris/commit/59066ea666b95e753bd92869a5ea361e9c65c916", "message": "Fix bug: Error happened when open a view in DBeaver", "committedDate": "2020-10-29T02:14:11Z", "type": "commit"}]}