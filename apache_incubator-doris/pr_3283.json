{"pr_number": 3283, "pr_title": "Support setting replica quota in db level", "pr_author": "caiconghui", "pr_createdAt": "2020-04-09T04:47:17Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3283", "timeline": [{"oid": "1428ee6b565697b734d436bb8c4ad2821aa0f115", "url": "https://github.com/apache/incubator-doris/commit/1428ee6b565697b734d436bb8c4ad2821aa0f115", "message": "Support setting replica quota in db level", "committedDate": "2020-04-09T03:46:32Z", "type": "commit"}, {"oid": "572e104f5694252ffc7afdaa1ef4d61bab32c4ad", "url": "https://github.com/apache/incubator-doris/commit/572e104f5694252ffc7afdaa1ef4d61bab32c4ad", "message": "change replicaSize to replicaCount", "committedDate": "2020-04-09T10:02:58Z", "type": "commit"}, {"oid": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "url": "https://github.com/apache/incubator-doris/commit/c6bbc5ddfd11dab91c8e731a71346413942fc20a", "message": "fix", "committedDate": "2020-04-09T10:39:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzMjYxNQ==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406232615", "body": "Plz do not modify the origin column name \"Size\", it may cause some compatibility problem.", "bodyText": "Plz do not modify the origin column name \"Size\", it may cause some compatibility problem.", "bodyHTML": "<p dir=\"auto\">Plz do not modify the origin column name \"Size\", it may cause some compatibility problem.</p>", "author": "morningman", "createdAt": "2020-04-09T14:10:22Z", "path": "fe/src/main/java/org/apache/doris/analysis/ShowDataStmt.java", "diffHunk": "@@ -52,14 +52,16 @@\n     private static final ShowResultSetMetaData SHOW_TABLE_DATA_META_DATA =\n             ShowResultSetMetaData.builder()\n                     .addColumn(new Column(\"TableName\", ScalarType.createVarchar(20)))\n-                    .addColumn(new Column(\"Size\", ScalarType.createVarchar(30)))\n+                    .addColumn(new Column(\"DataSize\", ScalarType.createVarchar(30)))", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzNjE5MA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406236190", "body": "```suggestion\r\n        long quota = stmt.getQuota();\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    long quota = (quotaType == QuotaType.DATA ? db.getDataQuota() : db.getReplicaQuota());\n          \n          \n            \n                    long quota = stmt.getQuota();", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">long</span> quota <span class=\"pl-k\">=</span> <span class=\"x x-first\">(quotaType </span><span class=\"pl-k x\">==</span><span class=\"x\"> </span><span class=\"pl-smi x\">QuotaType</span><span class=\"pl-c1\"><span class=\"pl-k x\">.</span><span class=\"x\">DATA</span></span><span class=\"x\"> </span><span class=\"pl-k x\">?</span><span class=\"x\"> db</span><span class=\"pl-k x\">.</span><span class=\"x\">getDataQuota() </span><span class=\"pl-k x\">:</span><span class=\"x\"> db</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getReplicaQuota()</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">long</span> quota <span class=\"pl-k\">=</span> <span class=\"x x-first\">stmt</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getQuota(</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "morningman", "createdAt": "2020-04-09T14:15:29Z", "path": "fe/src/main/java/org/apache/doris/catalog/Catalog.java", "diffHunk": "@@ -2781,16 +2782,25 @@ public void alterDatabaseQuota(AlterDatabaseQuotaStmt stmt) throws DdlException\n             ErrorReport.reportDdlException(ErrorCode.ERR_BAD_DB_ERROR, dbName);\n         }\n \n-        db.setDataQuotaWithLock(stmt.getQuota());\n-\n-        DatabaseInfo dbInfo = new DatabaseInfo(dbName, \"\", db.getDataQuota());\n+        QuotaType quotaType = stmt.getQuotaType();\n+        if (quotaType == QuotaType.DATA) {\n+            db.setDataQuotaWithLock(stmt.getQuota());\n+        } else if (quotaType == QuotaType.REPLICA) {\n+            db.setReplicaQuotaWithLock(stmt.getQuota());\n+        }\n+        long quota = (quotaType == QuotaType.DATA ? db.getDataQuota() : db.getReplicaQuota());", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzNzAzMQ==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406237031", "body": "How about change `QuotaType.DATA` to `null`? For better understanding?", "bodyText": "How about change QuotaType.DATA to null? For better understanding?", "bodyHTML": "<p dir=\"auto\">How about change <code>QuotaType.DATA</code> to <code>null</code>? For better understanding?</p>", "author": "morningman", "createdAt": "2020-04-09T14:16:33Z", "path": "fe/src/main/java/org/apache/doris/catalog/Catalog.java", "diffHunk": "@@ -2835,7 +2845,7 @@ public void renameDatabase(AlterDatabaseRename stmt) throws DdlException {\n             fullNameToDb.remove(fullDbName);\n             fullNameToDb.put(newFullDbName, db);\n \n-            DatabaseInfo dbInfo = new DatabaseInfo(fullDbName, newFullDbName, -1L);\n+            DatabaseInfo dbInfo = new DatabaseInfo(fullDbName, newFullDbName, -1L, QuotaType.DATA);", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU5NzgyNA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406597824", "bodyText": "@morningman null may cause NullPointerException, so I use QuotaType.NONE instead of null", "author": "caiconghui", "createdAt": "2020-04-10T04:32:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzNzAzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzODAyMA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406238020", "body": "```suggestion\r\n        if (replicaVolumn <= 0L) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (replicaVolumn < 0L) {\n          \n          \n            \n                    if (replicaVolumn <= 0L) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (replicaVolumn <span class=\"pl-k\">&lt;</span> <span class=\"pl-c1\">0L</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">if</span> (replicaVolumn <span class=\"pl-k\">&lt;<span class=\"x x-first x-last\">=</span></span> <span class=\"pl-c1\">0L</span>) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "morningman", "createdAt": "2020-04-09T14:17:55Z", "path": "fe/src/main/java/org/apache/doris/common/util/ParseUtil.java", "diffHunk": "@@ -71,4 +71,17 @@ public static long analyzeDataVolumn(String dataVolumnStr) throws UserException\n         return dataVolumn;\n     }\n \n+    public static long analyzeReplicaVolumn(String replicaVolumnStr) throws AnalysisException {\n+        long replicaVolumn = 0;\n+        try {\n+            replicaVolumn = Long.parseLong(replicaVolumnStr);\n+        } catch (NumberFormatException nfe) {\n+            throw new AnalysisException(\"invalid data volumn:\" + replicaVolumnStr);\n+        }\n+        if (replicaVolumn < 0L) {", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIzODczNA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406238734", "body": "Why not just using `table.getReplicaCount()`?", "bodyText": "Why not just using table.getReplicaCount()?", "bodyHTML": "<p dir=\"auto\">Why not just using <code>table.getReplicaCount()</code>?</p>", "author": "morningman", "createdAt": "2020-04-09T14:18:56Z", "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "diffHunk": "@@ -232,7 +250,34 @@ public long getDataQuotaLeftWithLock() {\n         }\n     }\n \n-    public void checkQuota() throws DdlException {\n+\n+    public long getReplicaQuotaLeftWithLock() {\n+        long usedReplicaQuota = 0;\n+        readLock();\n+        try {\n+            for (Table table : this.idToTable.values()) {\n+                if (table.getType() != TableType.OLAP) {\n+                    continue;\n+                }\n+\n+                OlapTable olapTable = (OlapTable) table;", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0MDI4Nw==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406240287", "body": "```suggestion\r\n        } else {\r\n            this.replicaQuotaSize = FeConstants.default_db_replica_quota_size;\r\n        }\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    }\n          \n          \n            \n                    } else {\n          \n          \n            \n                        this.replicaQuotaSize = FeConstants.default_db_replica_quota_size;\n          \n          \n            \n                    }", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"496\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"496\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }<span class=\"x x-first\"> </span><span class=\"pl-k x\">else</span><span class=\"x x-last\"> {</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"497\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>replicaQuotaSize <span class=\"pl-k\">=</span> <span class=\"pl-smi\">FeConstants</span><span class=\"pl-k\">.</span>default_db_replica_quota_size;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"498\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "morningman", "createdAt": "2020-04-09T14:21:15Z", "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "diffHunk": "@@ -450,6 +513,10 @@ public void readFields(DataInput in) throws IOException {\n                 name2Function.put(name, builder.build());\n             }\n         }\n+\n+        if (Catalog.getCurrentCatalogJournalVersion() >= FeMetaVersion.VERSION_80) {\n+            replicaQuotaSize = in.readLong();\n+        }", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0MTIzMQ==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406241231", "body": "Plz not modify the origin column name `Quota`, for compatibility.", "bodyText": "Plz not modify the origin column name Quota, for compatibility.", "bodyHTML": "<p dir=\"auto\">Plz not modify the origin column name <code>Quota</code>, for compatibility.</p>", "author": "morningman", "createdAt": "2020-04-09T14:22:43Z", "path": "fe/src/main/java/org/apache/doris/common/proc/DbsProcDir.java", "diffHunk": "@@ -39,7 +39,7 @@\n  */\n public class DbsProcDir implements ProcDirInterface {\n     public static final ImmutableList<String> TITLE_NAMES = new ImmutableList.Builder<String>()\n-            .add(\"DbId\").add(\"DbName\").add(\"TableNum\").add(\"Quota\")\n+            .add(\"DbId\").add(\"DbName\").add(\"TableNum\").add(\"DataQuota\").add(\"ReplicaQuota\")", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0MTg2OA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406241868", "body": "Add the new column at the end of columns, for compatibility", "bodyText": "Add the new column at the end of columns, for compatibility", "bodyHTML": "<p dir=\"auto\">Add the new column at the end of columns, for compatibility</p>", "author": "morningman", "createdAt": "2020-04-09T14:23:36Z", "path": "fe/src/main/java/org/apache/doris/common/proc/TablesProcDir.java", "diffHunk": "@@ -43,7 +43,7 @@\n public class TablesProcDir implements ProcDirInterface {\n     public static final ImmutableList<String> TITLE_NAMES = new ImmutableList.Builder<String>()\n             .add(\"TableId\").add(\"TableName\").add(\"IndexNum\").add(\"PartitionColumnName\")\n-            .add(\"PartitionNum\").add(\"State\").add(\"Type\").add(\"LastConsistencyCheckTime\")\n+            .add(\"PartitionNum\").add(\"ReplicaCount\").add(\"State\").add(\"Type\").add(\"LastConsistencyCheckTime\")", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI0MjY3NA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406242674", "body": "remove the unused `set` method.", "bodyText": "remove the unused set method.", "bodyHTML": "<p dir=\"auto\">remove the unused <code>set</code> method.</p>", "author": "morningman", "createdAt": "2020-04-09T14:24:42Z", "path": "fe/src/main/java/org/apache/doris/persist/DatabaseInfo.java", "diffHunk": "@@ -107,4 +115,12 @@ public void setDbState(DbState dbState) {\n         this.dbState = dbState;\n     }\n \n+    public QuotaType getQuotaType() {\n+        return quotaType;\n+    }\n+\n+    public void setQuotaType(QuotaType quotaType) {", "originalCommit": "c6bbc5ddfd11dab91c8e731a71346413942fc20a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b8337ee3d0ebb16c89e7c5524f641ef9b66a7110", "url": "https://github.com/apache/incubator-doris/commit/b8337ee3d0ebb16c89e7c5524f641ef9b66a7110", "message": "fix", "committedDate": "2020-04-10T05:19:46Z", "type": "commit"}, {"oid": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d", "url": "https://github.com/apache/incubator-doris/commit/f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d", "message": "fix doc", "committedDate": "2020-04-10T05:49:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406660640", "body": "The 1000000 is too small.  In meituan.com, the replica number for one database has exceeded 1000000. I think your initial value 1024 * 1024 * 1024 is OK.", "bodyText": "The 1000000 is too small.  In meituan.com, the replica number for one database has exceeded 1000000. I think your initial value 1024 * 1024 * 1024 is OK.", "bodyHTML": "<p dir=\"auto\">The 1000000 is too small.  In meituan.com, the replica number for one database has exceeded 1000000. I think your initial value 1024 * 1024 * 1024 is OK.</p>", "author": "kangkaisen", "createdAt": "2020-04-10T08:30:15Z", "path": "fe/src/main/java/org/apache/doris/common/FeConstants.java", "diffHunk": "@@ -31,6 +31,7 @@\n     public static int shortkey_max_column_count = 3;\n     public static int shortkey_maxsize_bytes = 36;\n     public static long default_db_data_quota_bytes = 1024 * 1024 * 1024 * 1024L; // 1TB\n+    public static long default_db_replica_quota_size = 1000000;", "originalCommit": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MTkyNA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406661924", "bodyText": "Why not set -1 as default value, which means no limit?\nOtherwise I'm afraid some cluster can't create table after cluster upgrade.", "author": "imay", "createdAt": "2020-04-10T08:34:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2NjM4Ng==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406666386", "bodyText": "OK. I will change it to original default value", "author": "caiconghui", "createdAt": "2020-04-10T08:46:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MDYxMA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406670610", "bodyText": "@imay 1024 * 1024 * 1024 is a large value and enough, if one table has 100000 tablets , about 10000 tables can exits in on db?", "author": "caiconghui", "createdAt": "2020-04-10T08:58:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3NTQ5OA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406675498", "bodyText": "in my point of view, quota is a necessary limit for resource usage, the resource is limited, replica quota should like data quota, not set to be -1 @imay", "author": "caiconghui", "createdAt": "2020-04-10T09:11:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MDY0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2NDMyMA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406664320", "body": "Why not enlarge the meta version?", "bodyText": "Why not enlarge the meta version?", "bodyHTML": "<p dir=\"auto\">Why not enlarge the meta version?</p>", "author": "kangkaisen", "createdAt": "2020-04-10T08:40:53Z", "path": "fe/src/main/java/org/apache/doris/catalog/Database.java", "diffHunk": "@@ -450,6 +488,12 @@ public void readFields(DataInput in) throws IOException {\n                 name2Function.put(name, builder.build());\n             }\n         }\n+\n+        if (Catalog.getCurrentCatalogJournalVersion() >= FeMetaVersion.VERSION_80) {", "originalCommit": "f211d2a2ea0e6b939ff044f76e25c11e3ab4aa6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2NjI1NA==", "url": "https://github.com/apache/incubator-doris/pull/3283#discussion_r406666254", "bodyText": "ok, it is a bug", "author": "caiconghui", "createdAt": "2020-04-10T08:46:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2NDMyMA=="}], "type": "inlineReview"}, {"oid": "b753195cf468e7b41636cd1ec50b0be50fa21e7f", "url": "https://github.com/apache/incubator-doris/commit/b753195cf468e7b41636cd1ec50b0be50fa21e7f", "message": "modify default_db_replica_quota_size to 1073741824", "committedDate": "2020-04-10T08:44:05Z", "type": "commit"}, {"oid": "2ffc7663a665f2fadebddb481055aaba978413f5", "url": "https://github.com/apache/incubator-doris/commit/2ffc7663a665f2fadebddb481055aaba978413f5", "message": "fix meta version error", "committedDate": "2020-04-10T08:49:48Z", "type": "commit"}, {"oid": "3947f51781767a7cf799ca491775f92e78eac08a", "url": "https://github.com/apache/incubator-doris/commit/3947f51781767a7cf799ca491775f92e78eac08a", "message": "fix sql syntax style", "committedDate": "2020-04-12T03:41:55Z", "type": "commit"}, {"oid": "36b5a7758d9190c32cac9f0ebc1c4ee191e4ecf1", "url": "https://github.com/apache/incubator-doris/commit/36b5a7758d9190c32cac9f0ebc1c4ee191e4ecf1", "message": "make replica count only for visible materialized index", "committedDate": "2020-04-12T14:18:15Z", "type": "commit"}]}