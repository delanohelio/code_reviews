{"pr_number": 4215, "pr_title": "Reject expired data", "pr_author": "chimp1984", "pr_createdAt": "2020-04-29T23:39:27Z", "pr_url": "https://github.com/bisq-network/bisq/pull/4215", "timeline": [{"oid": "d9628802cbf0622496c9a7c5c926d49a7a4c75db", "url": "https://github.com/bisq-network/bisq/commit/d9628802cbf0622496c9a7c5c926d49a7a4c75db", "message": "If a new received protectedStorageEntry is expired we do not store it\nand do not broadcast.\n\nIt is unclear why we receive expired data (some are very old), but a\nmanipulated node might produce that and as it only removed at each\nbatch process running each minute to clean out expired data it still\ncould propagate. Is an attack vector also to flood the network with\noutdated offers where the maker is likely not online.\n\nShould fix https://github.com/bisq-network/bisq/issues/4026", "committedDate": "2020-04-29T23:37:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgxOTk4MA==", "url": "https://github.com/bisq-network/bisq/pull/4215#discussion_r417819980", "body": "I guess you meant peer.\r\n```suggestion\r\n            log.warn(\"We received an expired protectedStorageEntry from peer {}. getCreationTimeStamp={}, protectedStorageEntry={}\",\r\n```", "bodyText": "I guess you meant peer.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.warn(\"We received an expired protectedStorageEntry from ppper {}. getCreationTimeStamp={}, protectedStorageEntry={}\",\n          \n          \n            \n                        log.warn(\"We received an expired protectedStorageEntry from peer {}. getCreationTimeStamp={}, protectedStorageEntry={}\",", "bodyHTML": "<p dir=\"auto\">I guess you meant peer.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            log<span class=\"pl-k\">.</span>warn(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>We received an expired protectedStorageEntry from <span class=\"x x-first x-last\">ppper</span> {}. getCreationTimeStamp={}, protectedStorageEntry={}<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            log<span class=\"pl-k\">.</span>warn(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>We received an expired protectedStorageEntry from <span class=\"x x-first x-last\">peer</span> {}. getCreationTimeStamp={}, protectedStorageEntry={}<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "ripcurlx", "createdAt": "2020-04-30T07:48:16Z", "path": "p2p/src/main/java/bisq/network/p2p/storage/P2PDataStorage.java", "diffHunk": "@@ -580,6 +577,15 @@ private boolean addProtectedStorageEntry(ProtectedStorageEntry protectedStorageE\n             return false;\n         }\n \n+        // To avoid that expired data get stored and broadcast we check early for expire date.\n+        if (protectedStorageEntry.isExpired(clock)) {\n+            log.warn(\"We received an expired protectedStorageEntry from ppper {}. getCreationTimeStamp={}, protectedStorageEntry={}\",", "originalCommit": "d9628802cbf0622496c9a7c5c926d49a7a4c75db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c57e73b867692e65d75c6301b7d90e5775a51c0a", "url": "https://github.com/bisq-network/bisq/commit/c57e73b867692e65d75c6301b7d90e5775a51c0a", "message": "Fix typo in log statement", "committedDate": "2020-04-30T08:23:37Z", "type": "commit"}]}