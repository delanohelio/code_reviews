{"pr_number": 971, "pr_title": "Resolves #970: improve GML explain exporter to support operator-depen\u2026", "pr_author": "normen662", "pr_createdAt": "2020-06-15T18:51:35Z", "pr_url": "https://github.com/FoundationDB/fdb-record-layer/pull/971", "timeline": [{"oid": "5ee261a7da22a5b5d2da9f48d1b0568b95d54ee1", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/5ee261a7da22a5b5d2da9f48d1b0568b95d54ee1", "message": "Resolves #970: improve GML explain exporter to support operator-dependent variables and node information", "committedDate": "2020-06-15T19:04:07Z", "type": "forcePushed"}, {"oid": "ced25340a875aec684a1190d9d11b20134d828da", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/ced25340a875aec684a1190d9d11b20134d828da", "message": "Resolves #970: improve GML explain exporter to support operator-dependent variables and node information", "committedDate": "2020-06-15T20:56:55Z", "type": "forcePushed"}, {"oid": "ba09399588c0493bbed69b94f99408a9f8294c22", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/ba09399588c0493bbed69b94f99408a9f8294c22", "message": "Resolves #970: improve GML explain exporter to support operator-dependent variables and node information", "committedDate": "2020-06-16T20:14:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE3NDkwMQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441174901", "body": "```suggestion\r\n * Explanatory information about the Record Layer's plan operators and storage objects.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Operator infos for all operators and storage objects in the record layer.\n          \n          \n            \n             * Explanatory information about the Record Layer's plan operators and storage objects.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"> <span class=\"pl-k\">*</span> <span class=\"pl-smi x x-first\">Operator</span><span class=\"x\"> infos </span><span class=\"pl-k x\">for</span><span class=\"x x-last\"> all </span>operators and storage objects<span class=\"x x-first x-last\"> in the record layer</span>.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span> <span class=\"pl-smi x x-first\">Explanatory</span><span class=\"x\"> information about the </span><span class=\"pl-smi x\">Record</span><span class=\"x\"> </span><span class=\"pl-smi x\">Layer</span><span class=\"pl-s\"><span class=\"pl-pds x\">'</span><span class=\"x x-last\">s plan </span>operators and storage objects.</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-16T22:21:10Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE3NTc5Nw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441175797", "body": "I think that this should be a container class with various `public static final` objects, rather than an enum, so that it can be extended by users of the API.", "bodyText": "I think that this should be a container class with various public static final objects, rather than an enum, so that it can be extended by users of the API.", "bodyHTML": "<p dir=\"auto\">I think that this should be a container class with various <code>public static final</code> objects, rather than an enum, so that it can be extended by users of the API.</p>", "author": "nschiefer", "createdAt": "2020-06-16T22:23:39Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxOTcxOA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441219718", "bodyText": "done.", "author": "normen662", "createdAt": "2020-06-17T00:50:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE3NTc5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE3NTkxOQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441175919", "body": "Same with `Icon`, I think.", "bodyText": "Same with Icon, I think.", "bodyHTML": "<p dir=\"auto\">Same with <code>Icon</code>, I think.</p>", "author": "nschiefer", "createdAt": "2020-06-16T22:23:59Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),\n+    INDEX_DATA(\n+            \"IndexData\",\n+            Icon.INDEX_DATA,\n+            \"Index\",\n+            \"An index is a data structure that is created based on a user-supplied ordering that enables index scans.\"),\n+    TEMPORARY_BUFFER_DATA(\n+            \"TempBufferData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Temporary Buffer\",\n+            \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),\n+    VALUES_DATA(\n+            \"ValuesData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Values\",\n+            \"A list of values as specified.\"),\n+    COVERING_INDEX_SCAN_OPERATOR(\n+            \"CoveringIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Covering Index Scan\",\n+            \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base record.\"),\n+    INDEX_SCAN_OPERATOR(\n+            \"IndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Index Scan\",\n+            \"An index scan operator uses a secondary index to quickly find records in the index within a given search range.\"),\n+    INTERSECTION_OPERATOR(\n+            \"IntersectionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Intersection\",\n+            \"An intersection operator processes its inputs in a common order and only returns those records that appear in all inputs.\"),\n+    NESTED_LOOP_JOIN_OPERATOR(\n+            \"NestedLoopJoinOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Nested Loop Join\",\n+            \"A nested loop join operator performs a relational join between its two input operands by reevaluating the right (inner) side for each left (outer) record.\"),\n+    LOAD_BY_KEYS_OPERATOR(\n+            \"LoadByKeysOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Load By Keys\",\n+            \"A load by keys operator loads records from the database that match the set of given keys.\"),\n+    PREDICATE_FILTER_OPERATOR(\n+            \"PredicateFilterOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Predicate Filter\",\n+            \"A predicate filter operator processes the input and returns only those records for which the predicate expression is true.\"),\n+    SCAN_OPERATOR(\n+            \"ScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Scan\",\n+            \"A scan operator loads a set of records from the database that are within the given range of primary keys.\"),\n+    SCORE_FOR_RANK_OPERATOR(\n+            \"ScoreForRankOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Score For Rank\",\n+            \"A score for rank operator converts ranks to scores and executes its input plan with the conversion results bound in named parameters.\"),\n+    TABLE_FUNCTION_OPERATOR(\n+            \"TableFunctionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Table Function\",\n+            \"A table function operator returns a table of records each time it is evaluated with a set of arguments that are specific to each individual table function.\"),\n+    TEXT_INDEX_SCAN_OPERATOR(\n+            \"TextIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Text Index Scan\",\n+            \"A text index scan operator uses a text index to quickly find records in the index for a set of given tokens.\"),\n+    TYPE_FILTER_OPERATOR(\n+            \"TypeFilterOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Type Filter\",\n+            \"A type filter operator processes the input and returns only those records for whose type is among the set of given types.\"),\n+    UNION_OPERATOR(\n+            \"UnionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Union Distinct\",\n+            \"A union distinct operator processes its two or more inputs and returns the unioned set of all input records (all records are distinct). This operator needs all inputs to be compatibly ordered.\"),\n+    UNORDERED_DISTINCT_OPERATOR(\n+            \"UnorderedDistinct\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Unordered Distinct\",\n+            \"An unordered distinct operator processes its input records and returns the set of distinct records. It does not require its input records to be ordered but does impose a memory overhead as it needs to track records it has already encountered.\"),\n+    UNORDERED_PRIMARY_KEY_DISTINCT_OPERATOR(\n+            \"UnorderedPrimaryKeyDistinct\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Unordered Primary Key Distinct\",\n+            \"An unordered primary key distinct operator processes its input records and returns the set of distinct records. It does not require its input records to be ordered but does impose a memory overhead as it needs to track primary keys of records it has already encountered.\"),\n+    UNORDERED_UNION_OPERATOR(\n+            \"UnorderedUnionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Union All\",\n+            \"A union all operator processes its two or more inputs and returns the unioned multiset of all input records (duplicates are preserved). The operator does not required its inputs to be compatible ordered.\");\n+\n+    /**\n+     * Icon Ids. Do not change!\n+     */\n+    public enum Icon {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxOTc3OQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441219779", "bodyText": "Done as well.", "author": "normen662", "createdAt": "2020-06-17T00:50:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE3NTkxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNjM0NA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441206344", "body": "I think that the covering index plan should basically look like an index plan, but with a different operator name, rather than having  regular index plan as a child, even though that's how it's implemented.", "bodyText": "I think that the covering index plan should basically look like an index plan, but with a different operator name, rather than having  regular index plan as a child, even though that's how it's implemented.", "bodyHTML": "<p dir=\"auto\">I think that the covering index plan should basically look like an index plan, but with a different operator name, rather than having  regular index plan as a child, even though that's how it's implemented.</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:00:33Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryCoveringIndexPlan.java", "diffHunk": "@@ -193,4 +195,14 @@ public int planHash() {\n     public List<? extends Quantifier> getQuantifiers() {\n         return ImmutableList.of();\n     }\n+\n+    @Nonnull\n+    @Override\n+    public PlannerGraph rewritePlannerGraph(@Nonnull final List<? extends PlannerGraph> childGraphs) {\n+        final PlannerGraph indexPlannerGraph = indexPlan.rewritePlannerGraph(childGraphs);\n+        return PlannerGraph.fromNodeAndChildGraphs(\n+                new PlannerGraph.OperatorNodeWithInfo(this,\n+                        NodeInfo.COVERING_INDEX_SCAN_OPERATOR),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxOTgyNg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441219826", "bodyText": "Done.", "author": "normen662", "createdAt": "2020-06-17T00:50:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNjM0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNzQ2MQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441207461", "body": "I think that it is more idiomatic in the Record Layer to return a nullable `TupleRange` rather than a non null `Optional<TupleRange>`. With IntelliJ's inspections, we don't even lose the static analysis.", "bodyText": "I think that it is more idiomatic in the Record Layer to return a nullable TupleRange rather than a non null Optional<TupleRange>. With IntelliJ's inspections, we don't even lose the static analysis.", "bodyHTML": "<p dir=\"auto\">I think that it is more idiomatic in the Record Layer to return a nullable <code>TupleRange</code> rather than a non null <code>Optional&lt;TupleRange&gt;</code>. With IntelliJ's inspections, we don't even lose the static analysis.</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:04:34Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryIndexPlan.java", "diffHunk": "@@ -182,14 +186,12 @@ protected void appendScanDetails(StringBuilder str) {\n     }\n \n     @Nonnull\n-    private String getRange() {\n-        String range;\n+    private Optional<TupleRange> getTupleRangeOptional() {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyMjkxNA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441222914", "bodyText": "done", "author": "normen662", "createdAt": "2020-06-17T01:02:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNzQ2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNzY1NQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441207655", "body": "I think this should probably be `-\u221e` or something like that. Alternatively, we could use literals like \"start of range\" or \"end of range\" or something like that.", "bodyText": "I think this should probably be -\u221e or something like that. Alternatively, we could use literals like \"start of range\" or \"end of range\" or something like that.", "bodyHTML": "<p dir=\"auto\">I think this should probably be <code>-\u221e</code> or something like that. Alternatively, we could use literals like \"start of range\" or \"end of range\" or something like that.</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:05:21Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryIndexPlan.java", "diffHunk": "@@ -206,14 +208,39 @@ public int getComplexity() {\n     @Nonnull\n     @Override\n     public PlannerGraph rewritePlannerGraph(@Nonnull final List<? extends PlannerGraph> childGraphs) {\n-        final PlannerGraph.Node root =\n-                new PlannerGraph.Node(this,\n-                        getClass().getSimpleName(),\n-                        getRange() + \"; \" + (scanType == IndexScanType.BY_VALUE ? scanType : \"\") + \"; \" + (reverse ? \"reverse\" : \"\"));\n-        final PlannerGraph.SourceNode source = new PlannerGraph.SourceNode(getIndexName());\n-        return PlannerGraph.builder(root)\n-                .addNode(source)\n-                .addEdge(source, root, new PlannerGraph.Edge())\n-                .build();\n+        final Optional<TupleRange> tupleRangeOptional = getTupleRangeOptional();\n+\n+        final ImmutableList.Builder<String> detailsBuilder = ImmutableList.builder();\n+        final ImmutableMap.Builder<String, Attribute> additionalAttributes = ImmutableMap.builder();\n+\n+        if (scanType != IndexScanType.BY_VALUE) {\n+            detailsBuilder.add(\"scanType: {{scanType}}\");\n+            additionalAttributes.put(\"scanType\", Attribute.gml(scanType.toString()));\n+        }\n+\n+        if (tupleRangeOptional.isPresent()) {\n+            final TupleRange tupleRange = tupleRangeOptional.get();\n+            detailsBuilder.add(\"range: \" + tupleRange.getLowEndpoint().toString(false) + \"{{low}}, {{high}}\" + tupleRange.getHighEndpoint().toString(true));\n+            additionalAttributes.put(\"low\", Attribute.gml(tupleRange.getLow() == null ? \"\u221e\" : tupleRange.getLow().toString()));", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzOTcxOA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441239718", "bodyText": "done", "author": "normen662", "createdAt": "2020-06-17T02:08:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwNzY1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODAwMg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441208002", "body": "As you know, this isn't my favorite representation of index scans. I would prefer to think of an index scan as a single operator with the index name as an attribute, like the predicate for a predicate filter.\r\n\r\nI'm happy to merge this for now and continue this discussion another time, though. Can you create an issue to track it?", "bodyText": "As you know, this isn't my favorite representation of index scans. I would prefer to think of an index scan as a single operator with the index name as an attribute, like the predicate for a predicate filter.\nI'm happy to merge this for now and continue this discussion another time, though. Can you create an issue to track it?", "bodyHTML": "<p dir=\"auto\">As you know, this isn't my favorite representation of index scans. I would prefer to think of an index scan as a single operator with the index name as an attribute, like the predicate for a predicate filter.</p>\n<p dir=\"auto\">I'm happy to merge this for now and continue this discussion another time, though. Can you create an issue to track it?</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:06:35Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryIndexPlan.java", "diffHunk": "@@ -206,14 +208,39 @@ public int getComplexity() {\n     @Nonnull\n     @Override\n     public PlannerGraph rewritePlannerGraph(@Nonnull final List<? extends PlannerGraph> childGraphs) {\n-        final PlannerGraph.Node root =\n-                new PlannerGraph.Node(this,\n-                        getClass().getSimpleName(),\n-                        getRange() + \"; \" + (scanType == IndexScanType.BY_VALUE ? scanType : \"\") + \"; \" + (reverse ? \"reverse\" : \"\"));\n-        final PlannerGraph.SourceNode source = new PlannerGraph.SourceNode(getIndexName());\n-        return PlannerGraph.builder(root)\n-                .addNode(source)\n-                .addEdge(source, root, new PlannerGraph.Edge())\n-                .build();\n+        final Optional<TupleRange> tupleRangeOptional = getTupleRangeOptional();\n+\n+        final ImmutableList.Builder<String> detailsBuilder = ImmutableList.builder();\n+        final ImmutableMap.Builder<String, Attribute> additionalAttributes = ImmutableMap.builder();\n+\n+        if (scanType != IndexScanType.BY_VALUE) {\n+            detailsBuilder.add(\"scanType: {{scanType}}\");\n+            additionalAttributes.put(\"scanType\", Attribute.gml(scanType.toString()));\n+        }\n+\n+        if (tupleRangeOptional.isPresent()) {\n+            final TupleRange tupleRange = tupleRangeOptional.get();\n+            detailsBuilder.add(\"range: \" + tupleRange.getLowEndpoint().toString(false) + \"{{low}}, {{high}}\" + tupleRange.getHighEndpoint().toString(true));\n+            additionalAttributes.put(\"low\", Attribute.gml(tupleRange.getLow() == null ? \"\u221e\" : tupleRange.getLow().toString()));\n+            additionalAttributes.put(\"high\", Attribute.gml(tupleRange.getHigh() == null ? \"\u221e\" : tupleRange.getHigh().toString()));\n+        } else {\n+            detailsBuilder.add(\"comparisons: {{comparisons}}\");\n+            additionalAttributes.put(\"comparisons\", Attribute.gml(comparisons.toString()));\n+        }\n+\n+        if (reverse) {\n+            detailsBuilder.add(\"direction: {{direction}}\");\n+            additionalAttributes.put(\"direction\", Attribute.gml(\"reversed\"));\n+        }\n+\n+        return PlannerGraph.fromNodeAndChildGraphs(\n+                new PlannerGraph.OperatorNodeWithInfo(this,\n+                        NodeInfo.INDEX_SCAN_OPERATOR,\n+                        detailsBuilder.build(),\n+                        additionalAttributes.build()),\n+                ImmutableList.of(\n+                        PlannerGraph.fromNodeAndChildGraphs(\n+                                new PlannerGraph.DataNodeWithInfo(NodeInfo.INDEX_DATA, ImmutableList.copyOf(getUsedIndexes())),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyMzAyMg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441223022", "bodyText": "tabled", "author": "normen662", "createdAt": "2020-06-17T01:03:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODAwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyNTQ2Mw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441225463", "bodyText": "#973", "author": "normen662", "createdAt": "2020-06-17T01:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODAwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODM2NA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441208364", "body": "I think that all of the implementations of `RecordQueryPlanWithIndex` override this method, so we can delete the default implementation on this interface.", "bodyText": "I think that all of the implementations of RecordQueryPlanWithIndex override this method, so we can delete the default implementation on this interface.", "bodyHTML": "<p dir=\"auto\">I think that all of the implementations of <code>RecordQueryPlanWithIndex</code> override this method, so we can delete the default implementation on this interface.</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:07:47Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryPlanWithIndex.java", "diffHunk": "@@ -84,10 +85,10 @@\n     @Override\n     default PlannerGraph rewritePlannerGraph(@Nonnull final List<? extends PlannerGraph> childGraphs) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyODE5MA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441228190", "bodyText": "this is done differently now as we covering index scans are dealt with as a composition. please take another look.", "author": "normen662", "createdAt": "2020-06-17T01:24:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODM2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODc5OA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441208798", "body": "```suggestion\r\n     * Use the overloaded constructor {@link #RecordQueryScanPlan(Set, ScanComparisons, boolean)}\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Please use the overloaded constructor {@link #RecordQueryScanPlan(Set, ScanComparisons, boolean)}\n          \n          \n            \n                 * Use the overloaded constructor {@link #RecordQueryScanPlan(Set, ScanComparisons, boolean)}", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> <span class=\"pl-smi x x-first\">Please</span><span class=\"x x-last\"> use</span> the overloaded constructor {<span class=\"pl-k\">@link</span> #RecordQueryScanPlan(<span class=\"pl-smi\">Set</span>, <span class=\"pl-smi\">ScanComparisons</span>, <span class=\"pl-k\">boolean</span>)}</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> <span class=\"pl-smi x x-first x-last\">Use</span> the overloaded constructor {<span class=\"pl-k\">@link</span> #RecordQueryScanPlan(<span class=\"pl-smi\">Set</span>, <span class=\"pl-smi\">ScanComparisons</span>, <span class=\"pl-k\">boolean</span>)}</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:09:28Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryScanPlan.java", "diffHunk": "@@ -32,28 +32,55 @@\n import com.apple.foundationdb.record.query.expressions.Comparisons;\n import com.apple.foundationdb.record.query.plan.ScanComparisons;\n import com.apple.foundationdb.record.query.plan.temp.RelationalExpression;\n+import com.apple.foundationdb.record.query.plan.temp.explain.Attribute;\n+import com.apple.foundationdb.record.query.plan.temp.explain.NodeInfo;\n import com.apple.foundationdb.record.query.plan.temp.explain.PlannerGraph;\n import com.apple.foundationdb.record.query.plan.temp.explain.PlannerGraphRewritable;\n import com.google.common.base.Verify;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n import com.google.protobuf.Message;\n \n import javax.annotation.Nonnull;\n import javax.annotation.Nullable;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Objects;\n+import java.util.Optional;\n import java.util.Set;\n \n /**\n  * A query plan that scans records directly from the main tree within a range of primary keys.\n  */\n @API(API.Status.MAINTAINED)\n public class RecordQueryScanPlan implements RecordQueryPlanWithNoChildren, RecordQueryPlanWithComparisons, PlannerGraphRewritable {\n+    @Nullable\n+    private final Set<String> recordTypes;\n+\n     @Nonnull\n     private final ScanComparisons comparisons;\n     private boolean reverse;\n \n+    /**\n+     * Overloaded constructor.\n+     * Please use the overloaded constructor {@link #RecordQueryScanPlan(Set, ScanComparisons, boolean)}", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyNTc2MQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441225761", "bodyText": "where is the politeness in this world. removed", "author": "normen662", "createdAt": "2020-06-17T01:14:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODc5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODkyNQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441208925", "body": "Same comment about using a nullable `TupleRange` instead of an `Optional<TupleRange>`.", "bodyText": "Same comment about using a nullable TupleRange instead of an Optional<TupleRange>.", "bodyHTML": "<p dir=\"auto\">Same comment about using a nullable <code>TupleRange</code> instead of an <code>Optional&lt;TupleRange&gt;</code>.</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:09:55Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryScanPlan.java", "diffHunk": "@@ -112,20 +144,17 @@ public boolean hasLoadBykeys() {\n     @Nonnull\n     @Override\n     public String toString() {\n-        String range;\n-        range = getRange();\n+        final String range = getTupleRangeOptional().map(TupleRange::toString).orElse(comparisons.toString());\n         return \"Scan(\" + range + \")\";\n     }\n \n     @Nonnull\n-    private String getRange() {\n-        String range;\n+    private Optional<TupleRange> getTupleRangeOptional() {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyNTgwOA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441225808", "bodyText": "done.", "author": "normen662", "createdAt": "2020-06-17T01:14:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwODkyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwOTA1Ng==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441209056", "body": "Same comment about `-\u221e` or using a different representation.", "bodyText": "Same comment about -\u221e or using a different representation.", "bodyHTML": "<p dir=\"auto\">Same comment about <code>-\u221e</code> or using a different representation.</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:10:25Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryScanPlan.java", "diffHunk": "@@ -173,16 +203,50 @@ public int getComplexity() {\n      * @return the rewritten planner graph that models scanned storage as a separate node that is connected to the\n      *         actual scan plan node.\n      */\n+    @SuppressWarnings(\"UnstableApiUsage\")\n     @Nonnull\n     @Override\n     public PlannerGraph rewritePlannerGraph(@Nonnull List<? extends PlannerGraph> childGraphs) {\n         Verify.verify(childGraphs.isEmpty());\n-        final PlannerGraph.Node root = new PlannerGraph.Node(this,\n-                getClass().getSimpleName());\n-        final PlannerGraph.SourceNode source = new PlannerGraph.SourceNode(getRange());\n-        return PlannerGraph.builder(root)\n-                .addNode(source)\n-                .addEdge(source, root, new PlannerGraph.Edge())\n-                .build();\n+\n+        final Optional<TupleRange> tupleRangeOptional = getTupleRangeOptional();\n+\n+        final ImmutableList.Builder<String> detailsBuilder = ImmutableList.builder();\n+        final ImmutableMap.Builder<String, Attribute> additionalAttributes = ImmutableMap.builder();\n+\n+        if (tupleRangeOptional.isPresent()) {\n+            final TupleRange tupleRange = tupleRangeOptional.get();\n+            detailsBuilder.add(\"range: \" + tupleRange.getLowEndpoint().toString(false) + \"{{low}}, {{high}}\" + tupleRange.getHighEndpoint().toString(true));\n+            additionalAttributes.put(\"low\", Attribute.gml(tupleRange.getLow() == null ? \"\u221e\" : tupleRange.getLow().toString()));", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyNjE3MA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441226170", "bodyText": "done.", "author": "normen662", "createdAt": "2020-06-17T01:16:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwOTA1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwOTI1NQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441209255", "body": "This tuple range handling code seems to be the same as the code for the index range scans (which makes sense, since they use the same implementation). Could you pull this out into a utility method (possibly on `ScanComparisons`)?", "bodyText": "This tuple range handling code seems to be the same as the code for the index range scans (which makes sense, since they use the same implementation). Could you pull this out into a utility method (possibly on ScanComparisons)?", "bodyHTML": "<p dir=\"auto\">This tuple range handling code seems to be the same as the code for the index range scans (which makes sense, since they use the same implementation). Could you pull this out into a utility method (possibly on <code>ScanComparisons</code>)?</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:11:09Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryScanPlan.java", "diffHunk": "@@ -173,16 +203,50 @@ public int getComplexity() {\n      * @return the rewritten planner graph that models scanned storage as a separate node that is connected to the\n      *         actual scan plan node.\n      */\n+    @SuppressWarnings(\"UnstableApiUsage\")\n     @Nonnull\n     @Override\n     public PlannerGraph rewritePlannerGraph(@Nonnull List<? extends PlannerGraph> childGraphs) {\n         Verify.verify(childGraphs.isEmpty());\n-        final PlannerGraph.Node root = new PlannerGraph.Node(this,\n-                getClass().getSimpleName());\n-        final PlannerGraph.SourceNode source = new PlannerGraph.SourceNode(getRange());\n-        return PlannerGraph.builder(root)\n-                .addNode(source)\n-                .addEdge(source, root, new PlannerGraph.Edge())\n-                .build();\n+\n+        final Optional<TupleRange> tupleRangeOptional = getTupleRangeOptional();\n+\n+        final ImmutableList.Builder<String> detailsBuilder = ImmutableList.builder();\n+        final ImmutableMap.Builder<String, Attribute> additionalAttributes = ImmutableMap.builder();\n+\n+        if (tupleRangeOptional.isPresent()) {\n+            final TupleRange tupleRange = tupleRangeOptional.get();", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwOTQyOQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441209429", "body": "This is really messy but I think it's the best we can do with the current text scan plan. This will be much better someday :-)", "bodyText": "This is really messy but I think it's the best we can do with the current text scan plan. This will be much better someday :-)", "bodyHTML": "<p dir=\"auto\">This is really messy but I think it's the best we can do with the current text scan plan. This will be much better someday :-)</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:11:45Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryTextIndexPlan.java", "diffHunk": "@@ -162,4 +168,40 @@ public int planHash() {\n     public String toString() {\n         return \"TextIndex(\" + textScan.getIndex().getName() + \" \" + textScan.getGroupingComparisons() + \", \" + textScan.getTextComparison() + \", \" + textScan.getSuffixComparisons() + \")\";\n     }\n+\n+    /**\n+     * Rewrite the planner graph for better visualization of a query index plan.\n+     * @param childGraphs planner graphs of children expression that already have been computed\n+     * @return the rewritten planner graph that models the index as a separate node that is connected to the\n+     *         actual index scan plan node.\n+     */\n+    @Nonnull\n+    @Override\n+    public PlannerGraph rewritePlannerGraph(@Nonnull final List<? extends PlannerGraph> childGraphs) {\n+        final ImmutableMap.Builder<String, Attribute> additionalAttributesBuilder = ImmutableMap.builder();\n+        if (textScan.getGroupingComparisons() != null) {\n+            additionalAttributesBuilder.put(\"groupingComparisons\", Attribute.gml(Objects.requireNonNull(textScan.getGroupingComparisons()).toString()));\n+        } else {\n+            additionalAttributesBuilder.put(\"groupingComparisons\", Attribute.gml(\"none\"));\n+        }\n+        if (textScan.getSuffixComparisons() != null) {\n+            additionalAttributesBuilder.put(\"suffixComparisons\", Attribute.gml(Objects.requireNonNull(textScan.getSuffixComparisons()).toString()));\n+        } else {\n+            additionalAttributesBuilder.put(\"suffixComparisons\", Attribute.gml(\"none\"));\n+        }\n+        additionalAttributesBuilder.put(\"textComparisons\", Attribute.gml(Objects.requireNonNull(textScan.getTextComparison()).toString()));\n+\n+        final PlannerGraph.Node root =\n+                new PlannerGraph.OperatorNodeWithInfo(this,\n+                        NodeInfo.TEXT_INDEX_SCAN_OPERATOR,\n+                        ImmutableList.of(\"grouping comparisons: {{groupingComparisons}}\",\n+                                \"text comparisons: {{textComparisons}}\",\n+                                \"suffix comparisons: {{suffixComparisons}}\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwOTc4OA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441209788", "body": "I think that this operator needs to include the `comparisonKey`, which is what's used to determine distinctness.\r\n\r\nFor now, we can just use `KeyExpression.toString()` for that.", "bodyText": "I think that this operator needs to include the comparisonKey, which is what's used to determine distinctness.\nFor now, we can just use KeyExpression.toString() for that.", "bodyHTML": "<p dir=\"auto\">I think that this operator needs to include the <code>comparisonKey</code>, which is what's used to determine distinctness.</p>\n<p dir=\"auto\">For now, we can just use <code>KeyExpression.toString()</code> for that.</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:13:00Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryUnorderedDistinctPlan.java", "diffHunk": "@@ -159,4 +161,12 @@ public void logPlanStructure(StoreTimer timer) {\n     public int getComplexity() {\n         return 1 + getInner().getComplexity();\n     }\n+\n+    @Nonnull\n+    @Override\n+    public PlannerGraph rewritePlannerGraph(@Nonnull final List<? extends PlannerGraph> childGraphs) {\n+        return PlannerGraph.fromNodeAndChildGraphs(\n+                new PlannerGraph.OperatorNodeWithInfo(this, NodeInfo.UNORDERED_DISTINCT_OPERATOR),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyNzYzNg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441227636", "bodyText": "good catch. done.", "author": "normen662", "createdAt": "2020-06-17T01:22:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIwOTc4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDAxMw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441210013", "body": "```suggestion\r\n         * @param identity object identifying this node. Two nodes in the graph are considered equal if and only if their\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     * @param identity identity object this node should assume. Two nodes in the graph are considered equal if their\n          \n          \n            \n                     * @param identity object identifying this node. Two nodes in the graph are considered equal if and only if their", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">         <span class=\"pl-k\">*</span> <span class=\"pl-k\">@param</span> identity <span class=\"x x-first x-last\">identity </span>object <span class=\"pl-c1\">this</span> node<span class=\"x x-first x-last\"> should assume</span>. <span class=\"pl-smi\">Two</span> nodes in the graph are considered equal <span class=\"pl-k\">if</span> their</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">         <span class=\"pl-k\">*</span> <span class=\"pl-k\">@param</span> identity object <span class=\"x x-first x-last\">identifying </span><span class=\"pl-c1\">this</span> node. <span class=\"pl-smi\">Two</span> nodes in the graph are considered equal<span class=\"x x-first\"> </span><span class=\"pl-k x\">if</span><span class=\"x x-last\"> and only</span> <span class=\"pl-k\">if</span> their</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:13:53Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/AbstractPlannerGraph.java", "diffHunk": "@@ -145,17 +147,29 @@ public N getRoot() {\n         @Nonnull\n         final String name;\n         @Nullable\n-        final String expression;\n+        final List<String> details;\n \n         @SuppressWarnings(\"unused\") // used in clients\n         public AbstractNode(final Object identity, final String name) {\n             this(identity, name, null);\n         }\n \n-        public AbstractNode(final Object identity, final String name, @Nullable final String expression) {\n+        /**\n+         * Overloaded constructor.\n+         * @param identity identity object this node should assume. Two nodes in the graph are considered equal if their", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyNzgwNg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441227806", "bodyText": "done.", "author": "normen662", "createdAt": "2020-06-17T01:23:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDAxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDA5NQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441210095", "body": "```suggestion\r\n         *        identity is equal (using reference equality)\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     *        identity is equal (using {@code ==})\n          \n          \n            \n                     *        identity is equal (using reference equality)", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">         <span class=\"pl-k\">*</span>        identity is equal (using <span class=\"x x-first\">{</span><span class=\"pl-k x\">@code</span><span class=\"x\"> </span><span class=\"pl-k x\">==</span><span class=\"x x-last\">}</span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">         <span class=\"pl-k\">*</span>        identity is equal (using <span class=\"x x-first x-last\">reference equality</span>)</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:14:11Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/AbstractPlannerGraph.java", "diffHunk": "@@ -145,17 +147,29 @@ public N getRoot() {\n         @Nonnull\n         final String name;\n         @Nullable\n-        final String expression;\n+        final List<String> details;\n \n         @SuppressWarnings(\"unused\") // used in clients\n         public AbstractNode(final Object identity, final String name) {\n             this(identity, name, null);\n         }\n \n-        public AbstractNode(final Object identity, final String name, @Nullable final String expression) {\n+        /**\n+         * Overloaded constructor.\n+         * @param identity identity object this node should assume. Two nodes in the graph are considered equal if their\n+         *        identity is equal (using {@code ==})", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyOTc5Ng==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441229796", "bodyText": "done", "author": "normen662", "createdAt": "2020-06-17T01:30:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDQ0OQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441210449", "body": "```suggestion\r\n         * @param details list of strings with auxiliary information about the node. These strings are used\r\n         *        to construct the label of the node depending on the exporter. This parameter is {@code Nullable}. If\r\n         *        null, the label is omitted. If empty, it creates an empty list if the target format supports lists.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     * @param details list of strings with auxiliary information about the node. These strings are used\n          \n          \n            \n                     *        to construct the label of the node depending on the exporter. This parameter is {@code Nullable}. If\n          \n          \n            \n                     *        null the exporter treats this object as absent, if empty it creates am empty list if the target format\n          \n          \n            \n                     *        supports lists.\n          \n          \n            \n                     * @param details list of strings with auxiliary information about the node. These strings are used\n          \n          \n            \n                     *        to construct the label of the node depending on the exporter. This parameter is {@code Nullable}. If\n          \n          \n            \n                     *        null, the label is omitted. If empty, it creates an empty list if the target format supports lists.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">         <span class=\"pl-k\">*</span> <span class=\"pl-k\">@param</span> details list of strings with auxiliary information about the node. <span class=\"pl-smi\">These</span> strings are used</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">         <span class=\"pl-k\">*</span>        to construct the label of the node depending on the exporter. <span class=\"pl-smi\">This</span> parameter is {<span class=\"pl-k\">@code</span> <span class=\"pl-smi\">Nullable</span>}<span class=\"pl-c1\">.</span> <span class=\"pl-smi\">If</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">         <span class=\"pl-k\">*</span>        <span class=\"pl-c1\">null</span> the exporter treats <span class=\"pl-c1\">this</span> object as absent, <span class=\"pl-k\">if</span> empty it creates am empty list <span class=\"pl-k\">if</span> the target format</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">         <span class=\"pl-k\">*</span>        supports lists.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">         <span class=\"pl-k\">*</span> <span class=\"pl-k\">@param</span> details list of strings with auxiliary information about the node. <span class=\"pl-smi\">These</span> strings are used</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">         <span class=\"pl-k\">*</span>        to construct the label of the node depending on the exporter. <span class=\"pl-smi\">This</span> parameter is {<span class=\"pl-k\">@code</span> <span class=\"pl-smi\">Nullable</span>}<span class=\"pl-c1\">.</span> <span class=\"pl-smi\">If</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">         <span class=\"pl-k\">*</span>        <span class=\"pl-c1\">null</span>, the label is omitted. <span class=\"pl-smi\">If</span> empty, it creates an empty list <span class=\"pl-k\">if</span> the target format supports lists.</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:15:23Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/AbstractPlannerGraph.java", "diffHunk": "@@ -145,17 +147,29 @@ public N getRoot() {\n         @Nonnull\n         final String name;\n         @Nullable\n-        final String expression;\n+        final List<String> details;\n \n         @SuppressWarnings(\"unused\") // used in clients\n         public AbstractNode(final Object identity, final String name) {\n             this(identity, name, null);\n         }\n \n-        public AbstractNode(final Object identity, final String name, @Nullable final String expression) {\n+        /**\n+         * Overloaded constructor.\n+         * @param identity identity object this node should assume. Two nodes in the graph are considered equal if their\n+         *        identity is equal (using {@code ==})\n+         * @param name name of the object to be used to construct the label that is displayed\n+         * @param details list of strings with auxiliary information about the node. These strings are used\n+         *        to construct the label of the node depending on the exporter. This parameter is {@code Nullable}. If\n+         *        null the exporter treats this object as absent, if empty it creates am empty list if the target format\n+         *        supports lists.", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMDA3MQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441230071", "bodyText": "done", "author": "normen662", "createdAt": "2020-06-17T01:31:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDQ0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDY1OA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441210658", "body": "```suggestion\r\n        public AbstractNode(@Nonnull final Object identity, @Nonnull final String name, @Nullable final List<String> details) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public AbstractNode(final Object identity, final String name, @Nullable final List<String> details) {\n          \n          \n            \n                    public AbstractNode(@Nonnull final Object identity, @Nonnull final String name, @Nullable final List<String> details) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">public</span> AbstractNode(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">Object</span> identity, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> name, <span class=\"pl-k\">@Nullable</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">String</span>&gt;</span> details) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">public</span> AbstractNode(<span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-smi\">Object</span> identity,<span class=\"x x-first\"> </span><span class=\"pl-k x x-last\">@Nonnull</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> name, <span class=\"pl-k\">@Nullable</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">String</span>&gt;</span> details) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:16:11Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/AbstractPlannerGraph.java", "diffHunk": "@@ -145,17 +147,29 @@ public N getRoot() {\n         @Nonnull\n         final String name;\n         @Nullable\n-        final String expression;\n+        final List<String> details;\n \n         @SuppressWarnings(\"unused\") // used in clients\n         public AbstractNode(final Object identity, final String name) {\n             this(identity, name, null);\n         }\n \n-        public AbstractNode(final Object identity, final String name, @Nullable final String expression) {\n+        /**\n+         * Overloaded constructor.\n+         * @param identity identity object this node should assume. Two nodes in the graph are considered equal if their\n+         *        identity is equal (using {@code ==})\n+         * @param name name of the object to be used to construct the label that is displayed\n+         * @param details list of strings with auxiliary information about the node. These strings are used\n+         *        to construct the label of the node depending on the exporter. This parameter is {@code Nullable}. If\n+         *        null the exporter treats this object as absent, if empty it creates am empty list if the target format\n+         *        supports lists.\n+         */\n+        public AbstractNode(final Object identity, final String name, @Nullable final List<String> details) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDgxMA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441210810", "body": "```suggestion\r\n     * as well as {@link AbstractPlannerGraph.AbstractEdge} that are use to serialize to GML.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * as well as {@link AbstractPlannerGraph.AbstractEdge} that are use to serialize to gml.\n          \n          \n            \n                 * as well as {@link AbstractPlannerGraph.AbstractEdge} that are use to serialize to GML.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> as well as {<span class=\"pl-k\">@link</span> <span class=\"pl-smi\">AbstractPlannerGraph</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">AbstractEdge</span>} that are use to serialize to <span class=\"x x-first x-last\">gml</span>.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> as well as {<span class=\"pl-k\">@link</span> <span class=\"pl-smi\">AbstractPlannerGraph</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">AbstractEdge</span>} that are use to serialize to <span class=\"pl-c1 x x-first x-last\">GML</span>.</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:16:50Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/Attribute.java", "diffHunk": "@@ -21,42 +21,150 @@\n package com.apple.foundationdb.record.query.plan.temp.explain;\n \n import javax.annotation.Nonnull;\n-import javax.annotation.Nullable;\n-import java.util.Objects;\n \n /**\n- * Basic class for all attributes of {@link AbstractPlannerGraph.AbstractNode}\n+ * Basic interface for all attributes of {@link AbstractPlannerGraph.AbstractNode}\n  * as well as {@link AbstractPlannerGraph.AbstractEdge}.\n  *\n  * Represents a tag object that annotates an {@link AbstractPlannerGraph.AbstractNode} or an\n  * {@link AbstractPlannerGraph.AbstractEdge}, providing additional information to a {@link GraphExporter}.\n  */\n-public abstract class Attribute {\n+public interface Attribute {\n+    /**\n+     * Returns whether this method is visible in the given context.\n+     * @param context the exporter context of the exporter being used\n+     * @param <N> node type\n+     * @param <E> edge type\n+     * @return {@code true} if the attribute is semantic, {@code false} otherwise.\n+     */\n+    <N, E> boolean isVisible(GraphExporter<N, E>.ExporterContext context);\n+\n+    /**\n+     * Return the underlying object this attribute refers to.\n+     * @return the object.\n+     */\n     @Nonnull\n-    private final Object reference;\n+    Object getReference();\n+\n+    /**\n+     * Basic interface all attributes of {@link AbstractPlannerGraph.AbstractNode}\n+     * as well as {@link AbstractPlannerGraph.AbstractEdge} that are use to serialize to gml.", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMzg3OQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441233879", "bodyText": "done", "author": "normen662", "createdAt": "2020-06-17T01:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMDgxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTIyMw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441211223", "body": "Is there a reason that these are all anonymous classes, rather than instantiations of some simple implementation class. If this sits on a hot code path, I think that the performance differences might matter?", "bodyText": "Is there a reason that these are all anonymous classes, rather than instantiations of some simple implementation class. If this sits on a hot code path, I think that the performance differences might matter?", "bodyHTML": "<p dir=\"auto\">Is there a reason that these are all anonymous classes, rather than instantiations of some simple implementation class. If this sits on a hot code path, I think that the performance differences might matter?</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:18:23Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/Attribute.java", "diffHunk": "@@ -21,42 +21,150 @@\n package com.apple.foundationdb.record.query.plan.temp.explain;\n \n import javax.annotation.Nonnull;\n-import javax.annotation.Nullable;\n-import java.util.Objects;\n \n /**\n- * Basic class for all attributes of {@link AbstractPlannerGraph.AbstractNode}\n+ * Basic interface for all attributes of {@link AbstractPlannerGraph.AbstractNode}\n  * as well as {@link AbstractPlannerGraph.AbstractEdge}.\n  *\n  * Represents a tag object that annotates an {@link AbstractPlannerGraph.AbstractNode} or an\n  * {@link AbstractPlannerGraph.AbstractEdge}, providing additional information to a {@link GraphExporter}.\n  */\n-public abstract class Attribute {\n+public interface Attribute {\n+    /**\n+     * Returns whether this method is visible in the given context.\n+     * @param context the exporter context of the exporter being used\n+     * @param <N> node type\n+     * @param <E> edge type\n+     * @return {@code true} if the attribute is semantic, {@code false} otherwise.\n+     */\n+    <N, E> boolean isVisible(GraphExporter<N, E>.ExporterContext context);\n+\n+    /**\n+     * Return the underlying object this attribute refers to.\n+     * @return the object.\n+     */\n     @Nonnull\n-    private final Object reference;\n+    Object getReference();\n+\n+    /**\n+     * Basic interface all attributes of {@link AbstractPlannerGraph.AbstractNode}\n+     * as well as {@link AbstractPlannerGraph.AbstractEdge} that are use to serialize to gml.\n+     */\n+    interface GmlAttribute extends Attribute {\n+        @Override\n+        default <N, E> boolean isVisible(GraphExporter<N, E>.ExporterContext context) {\n+            return context.getExporter() instanceof GmlExporter;\n+        }\n+    }\n \n-    protected Attribute(final Object reference) {\n-        this.reference = reference;\n+    /**\n+     * Interface for attributes of {@link AbstractPlannerGraph.AbstractNode}\n+     * as well as {@link AbstractPlannerGraph.AbstractEdge} that are used to serialize to dot.\n+     */\n+    interface DotAttribute extends Attribute {\n+        @Override\n+        default <N, E> boolean isVisible(GraphExporter<N, E>.ExporterContext context) {\n+            return context.getExporter() instanceof DotExporter;\n+        }\n     }\n \n     /**\n-     * Returns whether this method is semantic of it contains visual cues of other non-semantic information.\n-     *\n-     * @return {@code true} if the attribute is semantic, {@code false} otherwise.\n+     * Interface for attributes of {@link AbstractPlannerGraph.AbstractNode}\n+     * as well as {@link AbstractPlannerGraph.AbstractEdge} that are used to serialize to gml or to dot.\n      */\n-    public abstract boolean isSemanticAttribute();\n+    interface CommonAttribute extends GmlAttribute, DotAttribute {\n+        @Override\n+        default <N, E> boolean isVisible(GraphExporter<N, E>.ExporterContext context) {\n+            return true;\n+        }\n+    }\n \n     /**\n-     * Return the underlying object this attribute refers to.\n-     * @return the object.\n+     * Interface for attributes of {@link AbstractPlannerGraph.AbstractNode}\n+     * as well as {@link AbstractPlannerGraph.AbstractEdge} that are used to neither serialize to gml or to dot.\n+     * Attributes of this kind can only be referred to via variable substitution.\n      */\n-    @Nullable\n-    public Object getReference() {\n-        return reference;\n+    interface InvisibleAttribute extends GmlAttribute, DotAttribute {\n+        @Override\n+        default <N, E> boolean isVisible(GraphExporter<N, E>.ExporterContext context) {\n+            return false;\n+        }\n     }\n \n-    @Override\n-    public String toString() {\n-        return Objects.requireNonNull(reference).toString();\n+    /**\n+     * Static factory method to create a GML attribute based on a reference to some object.\n+     * @param reference the reference\n+     * @return a new attribute that is only visible to the GML exporter\n+     */\n+    static GmlAttribute gml(@Nonnull final Object reference) {\n+        return new GmlAttribute() {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMDg2Nw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441230867", "bodyText": "I would like to offer for users to potentially create their own sort of attributes but I would like to mix in the gml(), or the dot() flavor as well. It's nicer to provide interfaces if possible. The fact that they are anonymous classes does not make this implementation slower, the JVM just creates an implementation in-place with a cryptic name and uses that as a class name.", "author": "normen662", "createdAt": "2020-06-17T01:34:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTIyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTMyOA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441211328", "body": "```suggestion\r\n            // and expression by creating an HTML table.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // and expression by creating an html table\n          \n          \n            \n                        // and expression by creating an HTML table.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-c\"><span class=\"pl-c\">//</span> and expression by creating an <span class=\"x x-first x-last\">html</span> table</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-c\"><span class=\"pl-c\">//</span> and expression by creating an <span class=\"x x-first x-last\">HTML</span> table<span class=\"x x-first x-last\">.</span></span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:18:48Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/DotExporter.java", "diffHunk": "@@ -243,16 +246,40 @@ protected void renderNode(final ExporterContext context, final N node, final Map\n         final PrintWriter out = context.getPrintWriter();\n         out.print(INDENT);\n         out.print(getVertexID(node));\n+\n+        out.print(\" [ \");\n+        @Nullable final String htmlLabel;\n+        if (attributes.get(\"label\") == null) {\n+            // We allow a node or edge to override the label; if it's not overridden we build it here from name\n+            // and expression by creating an html table", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzNDAzMw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441234033", "bodyText": "done", "author": "normen662", "createdAt": "2020-06-17T01:46:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTMyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTUwNQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441211505", "body": "```suggestion\r\n    private String substituteVariables(@Nonnull final String detail,\r\n                                       @Nonnull final Map<String, Attribute> nodeAttributes,\r\n                                       @Nonnull final Function<Attribute, String> toStringFn) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private String substituteVariables(final String detail,\n          \n          \n            \n                                                   final Map<String, Attribute> nodeAttributes,\n          \n          \n            \n                                                   final Function<Attribute, String> toStringFn) {\n          \n          \n            \n                private String substituteVariables(@Nonnull final String detail,\n          \n          \n            \n                                                   @Nonnull final Map<String, Attribute> nodeAttributes,\n          \n          \n            \n                                                   @Nonnull final Function<Attribute, String> toStringFn) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">String</span> substituteVariables(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> detail,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                                       <span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Attribute</span>&gt;</span> nodeAttributes,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                                       <span class=\"pl-k\">final</span> <span class=\"pl-k\">Function&lt;<span class=\"pl-smi\">Attribute</span>, <span class=\"pl-smi\">String</span>&gt;</span> toStringFn) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">String</span> substituteVariables(<span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> detail,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                                       <span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Attribute</span>&gt;</span> nodeAttributes,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                                       <span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-k\">Function&lt;<span class=\"pl-smi\">Attribute</span>, <span class=\"pl-smi\">String</span>&gt;</span> toStringFn) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:19:27Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/DotExporter.java", "diffHunk": "@@ -303,48 +346,67 @@ protected void renderFooter(final ExporterContext context) {\n      */\n     private void renderAttributes(final ExporterContext context,\n                                   final Map<String, Attribute> attributes) {\n-        final PrintWriter out = context.getPrintWriter();\n-        out.print(\" [ \");\n-        @Nullable final String htmlLabel;\n-        if (attributes.get(\"label\") == null) {\n-            // We allow a node or edge to override the label; if it's not overridden we build it here from name\n-            // and expression by creating an html table\n-            @Nullable final Attribute name = attributes.get(\"name\");\n-            @Nullable final Attribute expression = attributes.get(\"expression\");\n-            htmlLabel = name == null\n-                        ? null\n-                        : getLabel(name, expression);\n-        } else {\n-            htmlLabel = getLabel(attributes.get(\"label\"));\n+        for (Map.Entry<String, Attribute> entry : attributes.entrySet()) {\n+            final Attribute value = entry.getValue();\n+            if (value.isVisible(context)) {\n+                renderAttribute(context, entry.getKey(), value, \" \");\n+            }\n         }\n+    }\n \n-        if (htmlLabel != null) {\n-            out.print(\"label=\");\n-            out.print(htmlLabel);\n-            out.print(\" \");\n+    @SuppressWarnings({\"squid:S3358\", \"unchecked\"})\n+    public String getNodeLabel(@Nonnull final Attribute name, final Attribute details, final Map<String, Attribute> nodeAttributes) {\n+        if (details == null || ((List<?>)details.getReference()).isEmpty()) {\n+            return \"<<table border=\\\"0\\\" cellborder=\\\"1\\\" cellspacing=\\\"0\\\" cellpadding=\\\"8\\\"><tr><td>\" +\n+                   escaper.escape(name.getReference().toString()) +\n+                   \"</td></tr></table>>\";\n         }\n \n-        for (Map.Entry<String, Attribute> entry : attributes.entrySet()) {\n-            final String key = entry.getKey();\n-            if (doNotRenderVerbatim.contains(key)) {\n-                // already handled by special case above\n-                continue;\n-            }\n-            renderAttribute(context, key, entry.getValue(), \" \");\n-        }\n-        out.print(\"]\");\n+        final String detailsString =\n+                ((List<?>)details.getReference())\n+                        .stream()\n+                        .map(Object::toString)\n+                        .map(escaper::escape)\n+                        .map(detail ->\n+                                substituteVariables(detail,\n+                                        nodeAttributes,\n+                                        attribute -> attribute == null\n+                                                     ? \"<b>undefined</b>\"\n+                                                     : (attribute.getReference() instanceof Collection)\n+                                                       ? escapeCollection((Collection<Attribute>)attribute.getReference())\n+                                                       : escaper.escape(attribute.getReference().toString())))\n+                        .map(detail -> \"<tr><td>\" + detail + \"</td></tr>\")\n+                        .collect(Collectors.joining());\n+\n+        return \"<<table border=\\\"0\\\" cellborder=\\\"1\\\" cellspacing=\\\"0\\\" cellpadding=\\\"8\\\"><tr><td>\" +\n+               escaper.escape(name.getReference().toString()) + \"</td></tr>\" +\n+               detailsString + \"</table>>\";\n+    }\n+\n+    private String escapeCollection(final Collection<Attribute> attributes) {\n+        return \"[\" + attributes.stream().map(a -> escaper.escape(a.toString())).collect(Collectors.joining(\", \")) + \"]\";\n     }\n \n-    public String getLabel(@Nonnull final Attribute name, final Attribute expression) {\n-        if (expression == null || expression.toString().isEmpty()) {\n-            return \"<<table border=\\\"0\\\" cellborder=\\\"1\\\" cellspacing=\\\"0\\\" cellpadding=\\\"8\\\"><tr><td>\" + name + \"</td></tr></table>>\";\n+    private String substituteVariables(final String detail,\n+                                       final Map<String, Attribute> nodeAttributes,\n+                                       final Function<Attribute, String> toStringFn) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzMjc5OQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441232799", "bodyText": "done for every method in that hierarchy.", "author": "normen662", "createdAt": "2020-06-17T01:41:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTUwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTgyMg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441211822", "body": "```suggestion\r\n            \"Primary storage stores the data of all records.\"),\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"Primary storage is stores the data of all records.\"),\n          \n          \n            \n                        \"Primary storage stores the data of all records.\"),", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Primary storage <span class=\"x x-first x-last\">is </span>stores the data of all records.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Primary storage stores the data of all records.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:20:31Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzNDIyNg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441234226", "bodyText": "done.", "author": "normen662", "createdAt": "2020-06-17T01:47:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMTgyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjA0OA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441212048", "body": "```suggestion\r\n            \"A temporary buffer is a temporary, in-memory structure storing up to a fixed number of records.\"),\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),\n          \n          \n            \n                        \"A temporary buffer is a temporary, in-memory structure storing up to a fixed number of records.\"),", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A temporary buffer is <span class=\"x x-first x-last\">an </span>in-memory <span class=\"x x-first x-last\">temporary data </span>structure storing <span class=\"x x-first x-last\">records</span> to a <span class=\"x x-first x-last\">certain limit</span>.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A temporary buffer is <span class=\"x x-first x-last\">a temporary, </span>in-memory structure storing <span class=\"x x-first x-last\">up</span> to a <span class=\"x x-first x-last\">fixed number of records</span>.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:21:23Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),\n+    INDEX_DATA(\n+            \"IndexData\",\n+            Icon.INDEX_DATA,\n+            \"Index\",\n+            \"An index is a data structure that is created based on a user-supplied ordering that enables index scans.\"),\n+    TEMPORARY_BUFFER_DATA(\n+            \"TempBufferData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Temporary Buffer\",\n+            \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIzNDM2OA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441234368", "bodyText": "done.", "author": "normen662", "createdAt": "2020-06-17T01:48:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjA0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjEzOA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441212138", "body": "```suggestion\r\n            \"A constant list of values.\"),\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"A list of values as specified.\"),\n          \n          \n            \n                        \"A constant list of values.\"),", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A list of values<span class=\"x x-first x-last\"> as specified</span>.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A <span class=\"x x-first x-last\">constant </span>list of values.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:21:37Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),\n+    INDEX_DATA(\n+            \"IndexData\",\n+            Icon.INDEX_DATA,\n+            \"Index\",\n+            \"An index is a data structure that is created based on a user-supplied ordering that enables index scans.\"),\n+    TEMPORARY_BUFFER_DATA(\n+            \"TempBufferData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Temporary Buffer\",\n+            \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),\n+    VALUES_DATA(\n+            \"ValuesData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Values\",\n+            \"A list of values as specified.\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjIyMA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441212220", "body": "```suggestion\r\n            \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base records.\"),\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base record.\"),\n          \n          \n            \n                        \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base records.\"),", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base <span class=\"x x-first x-last\">record</span>.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base <span class=\"x x-first x-last\">records</span>.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:21:59Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),\n+    INDEX_DATA(\n+            \"IndexData\",\n+            Icon.INDEX_DATA,\n+            \"Index\",\n+            \"An index is a data structure that is created based on a user-supplied ordering that enables index scans.\"),\n+    TEMPORARY_BUFFER_DATA(\n+            \"TempBufferData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Temporary Buffer\",\n+            \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),\n+    VALUES_DATA(\n+            \"ValuesData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Values\",\n+            \"A list of values as specified.\"),\n+    COVERING_INDEX_SCAN_OPERATOR(\n+            \"CoveringIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Covering Index Scan\",\n+            \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base record.\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjQwOA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441212408", "body": "```suggestion\r\n            \"A load by keys operator loads records from the database that match the given set of primary keys.\"),\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"A load by keys operator loads records from the database that match the set of given keys.\"),\n          \n          \n            \n                        \"A load by keys operator loads records from the database that match the given set of primary keys.\"),", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A load by keys operator loads records from the database that match the set of <span class=\"x x-first x-last\">given</span> keys.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A load by keys operator loads records from the database that match the <span class=\"x x-first x-last\">given </span>set of <span class=\"x x-first x-last\">primary</span> keys.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:22:44Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),\n+    INDEX_DATA(\n+            \"IndexData\",\n+            Icon.INDEX_DATA,\n+            \"Index\",\n+            \"An index is a data structure that is created based on a user-supplied ordering that enables index scans.\"),\n+    TEMPORARY_BUFFER_DATA(\n+            \"TempBufferData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Temporary Buffer\",\n+            \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),\n+    VALUES_DATA(\n+            \"ValuesData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Values\",\n+            \"A list of values as specified.\"),\n+    COVERING_INDEX_SCAN_OPERATOR(\n+            \"CoveringIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Covering Index Scan\",\n+            \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base record.\"),\n+    INDEX_SCAN_OPERATOR(\n+            \"IndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Index Scan\",\n+            \"An index scan operator uses a secondary index to quickly find records in the index within a given search range.\"),\n+    INTERSECTION_OPERATOR(\n+            \"IntersectionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Intersection\",\n+            \"An intersection operator processes its inputs in a common order and only returns those records that appear in all inputs.\"),\n+    NESTED_LOOP_JOIN_OPERATOR(\n+            \"NestedLoopJoinOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Nested Loop Join\",\n+            \"A nested loop join operator performs a relational join between its two input operands by reevaluating the right (inner) side for each left (outer) record.\"),\n+    LOAD_BY_KEYS_OPERATOR(\n+            \"LoadByKeysOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Load By Keys\",\n+            \"A load by keys operator loads records from the database that match the set of given keys.\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjY2OA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441212668", "body": "```suggestion\r\n            \"A text index scan operator uses a text index to quickly find records in the index for the given full text predicate.\"),\r\n```\r\nsince our full text scans offer more than just \"find these tokens\".", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"A text index scan operator uses a text index to quickly find records in the index for a set of given tokens.\"),\n          \n          \n            \n                        \"A text index scan operator uses a text index to quickly find records in the index for the given full text predicate.\"),\n          \n      \n    \n    \n  \n\nsince our full text scans offer more than just \"find these tokens\".", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A text index scan operator uses a text index to quickly find records in the index for <span class=\"x x-first x-last\">a set of given tokens</span>.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A text index scan operator uses a text index to quickly find records in the index for <span class=\"x x-first x-last\">the given full text predicate</span>.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">since our full text scans offer more than just \"find these tokens\".</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:23:47Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),\n+    INDEX_DATA(\n+            \"IndexData\",\n+            Icon.INDEX_DATA,\n+            \"Index\",\n+            \"An index is a data structure that is created based on a user-supplied ordering that enables index scans.\"),\n+    TEMPORARY_BUFFER_DATA(\n+            \"TempBufferData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Temporary Buffer\",\n+            \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),\n+    VALUES_DATA(\n+            \"ValuesData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Values\",\n+            \"A list of values as specified.\"),\n+    COVERING_INDEX_SCAN_OPERATOR(\n+            \"CoveringIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Covering Index Scan\",\n+            \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base record.\"),\n+    INDEX_SCAN_OPERATOR(\n+            \"IndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Index Scan\",\n+            \"An index scan operator uses a secondary index to quickly find records in the index within a given search range.\"),\n+    INTERSECTION_OPERATOR(\n+            \"IntersectionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Intersection\",\n+            \"An intersection operator processes its inputs in a common order and only returns those records that appear in all inputs.\"),\n+    NESTED_LOOP_JOIN_OPERATOR(\n+            \"NestedLoopJoinOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Nested Loop Join\",\n+            \"A nested loop join operator performs a relational join between its two input operands by reevaluating the right (inner) side for each left (outer) record.\"),\n+    LOAD_BY_KEYS_OPERATOR(\n+            \"LoadByKeysOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Load By Keys\",\n+            \"A load by keys operator loads records from the database that match the set of given keys.\"),\n+    PREDICATE_FILTER_OPERATOR(\n+            \"PredicateFilterOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Predicate Filter\",\n+            \"A predicate filter operator processes the input and returns only those records for which the predicate expression is true.\"),\n+    SCAN_OPERATOR(\n+            \"ScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Scan\",\n+            \"A scan operator loads a set of records from the database that are within the given range of primary keys.\"),\n+    SCORE_FOR_RANK_OPERATOR(\n+            \"ScoreForRankOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Score For Rank\",\n+            \"A score for rank operator converts ranks to scores and executes its input plan with the conversion results bound in named parameters.\"),\n+    TABLE_FUNCTION_OPERATOR(\n+            \"TableFunctionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Table Function\",\n+            \"A table function operator returns a table of records each time it is evaluated with a set of arguments that are specific to each individual table function.\"),\n+    TEXT_INDEX_SCAN_OPERATOR(\n+            \"TextIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Text Index Scan\",\n+            \"A text index scan operator uses a text index to quickly find records in the index for a set of given tokens.\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjc0NA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441212744", "body": "```suggestion\r\n            \"A type filter operator processes the input and returns only those records for whose type is among the given set of types.\"),\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"A type filter operator processes the input and returns only those records for whose type is among the set of given types.\"),\n          \n          \n            \n                        \"A type filter operator processes the input and returns only those records for whose type is among the given set of types.\"),", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A type filter operator processes the input and returns only those records for whose type is among the set of<span class=\"x x-first x-last\"> given</span> types.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>A type filter operator processes the input and returns only those records for whose type is among the <span class=\"x x-first x-last\">given </span>set of types.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:24:02Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),\n+    INDEX_DATA(\n+            \"IndexData\",\n+            Icon.INDEX_DATA,\n+            \"Index\",\n+            \"An index is a data structure that is created based on a user-supplied ordering that enables index scans.\"),\n+    TEMPORARY_BUFFER_DATA(\n+            \"TempBufferData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Temporary Buffer\",\n+            \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),\n+    VALUES_DATA(\n+            \"ValuesData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Values\",\n+            \"A list of values as specified.\"),\n+    COVERING_INDEX_SCAN_OPERATOR(\n+            \"CoveringIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Covering Index Scan\",\n+            \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base record.\"),\n+    INDEX_SCAN_OPERATOR(\n+            \"IndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Index Scan\",\n+            \"An index scan operator uses a secondary index to quickly find records in the index within a given search range.\"),\n+    INTERSECTION_OPERATOR(\n+            \"IntersectionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Intersection\",\n+            \"An intersection operator processes its inputs in a common order and only returns those records that appear in all inputs.\"),\n+    NESTED_LOOP_JOIN_OPERATOR(\n+            \"NestedLoopJoinOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Nested Loop Join\",\n+            \"A nested loop join operator performs a relational join between its two input operands by reevaluating the right (inner) side for each left (outer) record.\"),\n+    LOAD_BY_KEYS_OPERATOR(\n+            \"LoadByKeysOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Load By Keys\",\n+            \"A load by keys operator loads records from the database that match the set of given keys.\"),\n+    PREDICATE_FILTER_OPERATOR(\n+            \"PredicateFilterOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Predicate Filter\",\n+            \"A predicate filter operator processes the input and returns only those records for which the predicate expression is true.\"),\n+    SCAN_OPERATOR(\n+            \"ScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Scan\",\n+            \"A scan operator loads a set of records from the database that are within the given range of primary keys.\"),\n+    SCORE_FOR_RANK_OPERATOR(\n+            \"ScoreForRankOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Score For Rank\",\n+            \"A score for rank operator converts ranks to scores and executes its input plan with the conversion results bound in named parameters.\"),\n+    TABLE_FUNCTION_OPERATOR(\n+            \"TableFunctionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Table Function\",\n+            \"A table function operator returns a table of records each time it is evaluated with a set of arguments that are specific to each individual table function.\"),\n+    TEXT_INDEX_SCAN_OPERATOR(\n+            \"TextIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Text Index Scan\",\n+            \"A text index scan operator uses a text index to quickly find records in the index for a set of given tokens.\"),\n+    TYPE_FILTER_OPERATOR(\n+            \"TypeFilterOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Type Filter\",\n+            \"A type filter operator processes the input and returns only those records for whose type is among the set of given types.\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMzg1NA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441213854", "body": "```suggestion\r\n            \"An ordered union operator processes produces the set of all input records returned by its two or more inputs (all records are distinct). This operator needs all inputs to be compatibly ordered, and returns them in the same order.\"),\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"A union distinct operator processes its two or more inputs and returns the unioned set of all input records (all records are distinct). This operator needs all inputs to be compatibly ordered.\"),\n          \n          \n            \n                        \"An ordered union operator processes produces the set of all input records returned by its two or more inputs (all records are distinct). This operator needs all inputs to be compatibly ordered, and returns them in the same order.\"),", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">A </span>union <span class=\"x x-first x-last\">distinct </span>operator processes <span class=\"x x-first x-last\">its two or more inputs and returns the unioned set of all input records</span> (all records are distinct). This operator needs all inputs to be compatibly ordered.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">An ordered </span>union operator processes <span class=\"x x-first x-last\">produces the set of all input records returned by its two or more inputs</span> (all records are distinct). This operator needs all inputs to be compatibly ordered<span class=\"x x-first x-last\">, and returns them in the same order</span>.<span class=\"pl-pds\">\"</span></span>),</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:28:03Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/NodeInfo.java", "diffHunk": "@@ -0,0 +1,191 @@\n+/*\n+ * NodeInfo.java\n+ *\n+ * This source file is part of the FoundationDB open source project\n+ *\n+ * Copyright 2015-2020 Apple Inc. and the FoundationDB project authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.apple.foundationdb.record.query.plan.temp.explain;\n+\n+import com.google.common.collect.ImmutableMap;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Arrays;\n+import java.util.Map;\n+\n+/**\n+ * Operator infos for all operators and storage objects in the record layer.\n+ */\n+public enum NodeInfo {\n+    BASE_DATA(\n+            \"BaseData\",\n+            Icon.BASE_DATA,\n+            \"Primary Storage\",\n+            \"Primary storage is stores the data of all records.\"),\n+    INDEX_DATA(\n+            \"IndexData\",\n+            Icon.INDEX_DATA,\n+            \"Index\",\n+            \"An index is a data structure that is created based on a user-supplied ordering that enables index scans.\"),\n+    TEMPORARY_BUFFER_DATA(\n+            \"TempBufferData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Temporary Buffer\",\n+            \"A temporary buffer is an in-memory temporary data structure storing records to a certain limit.\"),\n+    VALUES_DATA(\n+            \"ValuesData\",\n+            Icon.IN_MEMORY_TEMPORARY_DATA,\n+            \"Values\",\n+            \"A list of values as specified.\"),\n+    COVERING_INDEX_SCAN_OPERATOR(\n+            \"CoveringIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Covering Index Scan\",\n+            \"A covering index scan operator uses a secondary index to quickly find records in a given search range without looking up the base record.\"),\n+    INDEX_SCAN_OPERATOR(\n+            \"IndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Index Scan\",\n+            \"An index scan operator uses a secondary index to quickly find records in the index within a given search range.\"),\n+    INTERSECTION_OPERATOR(\n+            \"IntersectionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Intersection\",\n+            \"An intersection operator processes its inputs in a common order and only returns those records that appear in all inputs.\"),\n+    NESTED_LOOP_JOIN_OPERATOR(\n+            \"NestedLoopJoinOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Nested Loop Join\",\n+            \"A nested loop join operator performs a relational join between its two input operands by reevaluating the right (inner) side for each left (outer) record.\"),\n+    LOAD_BY_KEYS_OPERATOR(\n+            \"LoadByKeysOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Load By Keys\",\n+            \"A load by keys operator loads records from the database that match the set of given keys.\"),\n+    PREDICATE_FILTER_OPERATOR(\n+            \"PredicateFilterOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Predicate Filter\",\n+            \"A predicate filter operator processes the input and returns only those records for which the predicate expression is true.\"),\n+    SCAN_OPERATOR(\n+            \"ScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Scan\",\n+            \"A scan operator loads a set of records from the database that are within the given range of primary keys.\"),\n+    SCORE_FOR_RANK_OPERATOR(\n+            \"ScoreForRankOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Score For Rank\",\n+            \"A score for rank operator converts ranks to scores and executes its input plan with the conversion results bound in named parameters.\"),\n+    TABLE_FUNCTION_OPERATOR(\n+            \"TableFunctionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Table Function\",\n+            \"A table function operator returns a table of records each time it is evaluated with a set of arguments that are specific to each individual table function.\"),\n+    TEXT_INDEX_SCAN_OPERATOR(\n+            \"TextIndexScanOperator\",\n+            Icon.DATA_ACCESS_OPERATOR,\n+            \"Text Index Scan\",\n+            \"A text index scan operator uses a text index to quickly find records in the index for a set of given tokens.\"),\n+    TYPE_FILTER_OPERATOR(\n+            \"TypeFilterOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Type Filter\",\n+            \"A type filter operator processes the input and returns only those records for whose type is among the set of given types.\"),\n+    UNION_OPERATOR(\n+            \"UnionOperator\",\n+            Icon.COMPUTATION_OPERATOR,\n+            \"Union Distinct\",\n+            \"A union distinct operator processes its two or more inputs and returns the unioned set of all input records (all records are distinct). This operator needs all inputs to be compatibly ordered.\"),", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDA2Mg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441214062", "body": "```suggestion\r\n        // is important for join order, among other things.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // is important for e.g. join order, etc.\n          \n          \n            \n                    // is important for join order, among other things.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> is important for <span class=\"x x-first x-last\">e.g. </span>join order, <span class=\"x x-first x-last\">etc</span>.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> is important for join order, <span class=\"x x-first x-last\">among other things</span>.</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:28:52Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/PlannerGraph.java", "diffHunk": "@@ -20,27 +20,48 @@\n \n package com.apple.foundationdb.record.query.plan.temp.explain;\n \n+import com.apple.foundationdb.record.query.plan.plans.RecordQueryPlan;\n import com.apple.foundationdb.record.query.plan.temp.ExpressionRef;\n import com.apple.foundationdb.record.query.plan.temp.RelationalExpression;\n import com.google.common.collect.ImmutableMap;\n import com.google.common.collect.ImmutableSet;\n-import com.google.common.escape.Escaper;\n import com.google.common.graph.Network;\n-import com.google.common.html.HtmlEscapers;\n \n import javax.annotation.Nonnull;\n import javax.annotation.Nullable;\n+import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n /**\n  * Lightweight class to save some boilerplate.\n  */\n @SuppressWarnings(\"UnstableApiUsage\")\n public class PlannerGraph extends AbstractPlannerGraph<PlannerGraph.Node, PlannerGraph.Edge> {\n \n-    private static final Escaper escaper = HtmlEscapers.htmlEscaper();\n+    public static PlannerGraph fromNodeAndChildGraphs(@Nonnull final Node node,\n+                                                      @Nonnull final List<? extends PlannerGraph> childGraphs) {\n+        final InternalPlannerGraphBuilder plannerGraphBuilder =\n+                builder(node);\n+\n+        // Traverse results from children and create graph edges. Hand in the directly preceding edge\n+        // in the dependsOn set. That in turn causes the dot exporter to render the graph left to right which\n+        // is important for e.g. join order, etc.", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDI3NA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441214274", "body": "```suggestion\r\n        public Node(@Nonnull final Object identity, @Nonnull final String name, @Nullable final List<String> details) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public Node(final Object identity, final String name, @Nullable final List<String> details) {\n          \n          \n            \n                    public Node(@Nonnull final Object identity, @Nonnull final String name, @Nullable final List<String> details) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">public</span> Node(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">Object</span> identity, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> name, <span class=\"pl-k\">@Nullable</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">String</span>&gt;</span> details) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">public</span> Node(<span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-smi\">Object</span> identity,<span class=\"x x-first\"> </span><span class=\"pl-k x x-last\">@Nonnull</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> name, <span class=\"pl-k\">@Nullable</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">String</span>&gt;</span> details) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:29:45Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/PlannerGraph.java", "diffHunk": "@@ -60,29 +81,42 @@ public PlannerGraph build() {\n     /**\n      * Node class functioning as parent for any nodes in the network.\n      */\n+    @SuppressWarnings(\"squid:S2160\")\n     public static class Node extends AbstractPlannerGraph.AbstractNode {\n+        private final Map<String, Attribute> additionalAttributes;\n+\n         public Node(final Object identity, final String name) {\n             this(identity, name, null);\n         }\n \n-        public Node(final Object identity, final String name, @Nullable final String expression) {\n-            super(identity, name, expression);\n+        public Node(final Object identity, final String name, @Nullable final List<String> details) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDMzMQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441214331", "body": "```suggestion\r\n        public Node(@Nonnull final Object identity, @Nonnull final String name, @Nullable final List<String> details, @Nonnull final Map<String, Attribute> additionalAttributes) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    public Node(final Object identity, final String name, @Nullable final List<String> details, final Map<String, Attribute> additionalAttributes) {\n          \n          \n            \n                    public Node(@Nonnull final Object identity, @Nonnull final String name, @Nullable final List<String> details, @Nonnull final Map<String, Attribute> additionalAttributes) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">public</span> Node(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">Object</span> identity, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> name, <span class=\"pl-k\">@Nullable</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">String</span>&gt;</span> details, <span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Attribute</span>&gt;</span> additionalAttributes) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">public</span> Node(<span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-smi\">Object</span> identity, <span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> name, <span class=\"pl-k\">@Nullable</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">String</span>&gt;</span> details,<span class=\"x x-first\"> </span><span class=\"pl-k x x-last\">@Nonnull</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Attribute</span>&gt;</span> additionalAttributes) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:30:00Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/PlannerGraph.java", "diffHunk": "@@ -60,29 +81,42 @@ public PlannerGraph build() {\n     /**\n      * Node class functioning as parent for any nodes in the network.\n      */\n+    @SuppressWarnings(\"squid:S2160\")\n     public static class Node extends AbstractPlannerGraph.AbstractNode {\n+        private final Map<String, Attribute> additionalAttributes;\n+\n         public Node(final Object identity, final String name) {\n             this(identity, name, null);\n         }\n \n-        public Node(final Object identity, final String name, @Nullable final String expression) {\n-            super(identity, name, expression);\n+        public Node(final Object identity, final String name, @Nullable final List<String> details) {\n+            this(identity, name, details, ImmutableMap.of());\n+        }\n+\n+        public Node(final Object identity, final String name, @Nullable final List<String> details, final Map<String, Attribute> additionalAttributes) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDQ2Nw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441214467", "body": "These constructors need nullability annotations. \ud83d\ude43 ", "bodyText": "These constructors need nullability annotations. \ud83d\ude43", "bodyHTML": "<p dir=\"auto\">These constructors need nullability annotations. <g-emoji class=\"g-emoji\" alias=\"upside_down_face\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f643.png\">\ud83d\ude43</g-emoji></p>", "author": "nschiefer", "createdAt": "2020-06-17T00:30:27Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/PlannerGraph.java", "diffHunk": "@@ -113,22 +147,91 @@ public String getFontName() {\n \n         @Nonnull\n         public String getFontSize() {\n-            return getExpression() == null\n+            return getDetails() == null || getDetails().isEmpty()\n                    ? \"12\"\n                    : \"8\";\n         }\n     }\n \n     /**\n-     * Node class.\n+     * Interface to be implemented by all node classes that need to externalize an info id for exporting global\n+     * information such as names and descriptions.\n      */\n-    public static class SourceNode extends Node {\n-        public SourceNode(final String name) {\n-            this(name, null);\n+    public interface WithInfoId {\n+        String getInfoId();\n+    }\n+\n+    /**\n+     * Node class that additionally captures a reference to a {@link NodeInfo}. {@code NodeInfo}s are used to provide\n+     * names, descriptions, and other cues to the exporter that are specific to the kind of node, not the node itself.\n+     */\n+    @SuppressWarnings(\"squid:S2160\")\n+    public static class NodeWithInfo extends Node implements WithInfoId {\n+        @Nonnull\n+        private NodeInfo nodeInfo;\n+\n+        @SuppressWarnings(\"unused\")\n+        public NodeWithInfo(final Object identity, final NodeInfo nodeInfo) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDU1Nw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441214557", "body": "These constructors, too.", "bodyText": "These constructors, too.", "bodyHTML": "<p dir=\"auto\">These constructors, too.</p>", "author": "nschiefer", "createdAt": "2020-06-17T00:30:41Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/PlannerGraph.java", "diffHunk": "@@ -113,22 +147,91 @@ public String getFontName() {\n \n         @Nonnull\n         public String getFontSize() {\n-            return getExpression() == null\n+            return getDetails() == null || getDetails().isEmpty()\n                    ? \"12\"\n                    : \"8\";\n         }\n     }\n \n     /**\n-     * Node class.\n+     * Interface to be implemented by all node classes that need to externalize an info id for exporting global\n+     * information such as names and descriptions.\n      */\n-    public static class SourceNode extends Node {\n-        public SourceNode(final String name) {\n-            this(name, null);\n+    public interface WithInfoId {\n+        String getInfoId();\n+    }\n+\n+    /**\n+     * Node class that additionally captures a reference to a {@link NodeInfo}. {@code NodeInfo}s are used to provide\n+     * names, descriptions, and other cues to the exporter that are specific to the kind of node, not the node itself.\n+     */\n+    @SuppressWarnings(\"squid:S2160\")\n+    public static class NodeWithInfo extends Node implements WithInfoId {\n+        @Nonnull\n+        private NodeInfo nodeInfo;\n+\n+        @SuppressWarnings(\"unused\")\n+        public NodeWithInfo(final Object identity, final NodeInfo nodeInfo) {\n+            this(identity, nodeInfo, null);\n+        }\n+\n+        public NodeWithInfo(final Object identity, final NodeInfo nodeInfo, @Nullable final List<String> details) {\n+            this(identity, nodeInfo, details, ImmutableMap.of());\n+        }\n+\n+        public NodeWithInfo(final Object identity, final NodeInfo nodeInfo, @Nullable final List<String> details, final Map<String, Attribute> additionalAttributes) {\n+            super(identity, nodeInfo.getName(), details, additionalAttributes);\n+            this.nodeInfo = nodeInfo;\n+        }\n+\n+        @Nonnull\n+        public NodeInfo getNodeInfo() {\n+            return nodeInfo;\n+        }\n+\n+        @Override\n+        public String getInfoId() {\n+            return getNodeInfo().getId();\n+        }\n+\n+        @Nonnull\n+        @Override\n+        public Map<String, Attribute> getAttributes() {\n+            final Map<String, Attribute> attributes = super.getAttributes();\n+            return ImmutableMap\n+                    .<String, Attribute>builder()\n+                    .putAll(attributes)\n+                    .put(\"infoId\", Attribute.gml(nodeInfo.getId()))\n+                    .build();\n+        }\n+    }\n+\n+    /**\n+     * Node class for data objects.\n+     */\n+    @SuppressWarnings(\"squid:S2160\")\n+    public static class DataNodeWithInfo extends NodeWithInfo {\n+        public DataNodeWithInfo(final NodeInfo nodeInfo) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDY4Ng==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441214686", "body": "```suggestion\r\n    public static String explain(@Nonnull final RelationalExpression relationalExpression,\r\n                                 @Nonnull final Map<String, Attribute> additionalDescriptionMap) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static String explain(final RelationalExpression relationalExpression,\n          \n          \n            \n                                             final Map<String, Attribute> additionalDescriptionMap) {\n          \n          \n            \n                public static String explain(@Nonnull final RelationalExpression relationalExpression,\n          \n          \n            \n                                             @Nonnull final Map<String, Attribute> additionalDescriptionMap) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">String</span> explain(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">RelationalExpression</span> relationalExpression,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                                 <span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Attribute</span>&gt;</span> additionalDescriptionMap) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">String</span> explain(<span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-smi\">RelationalExpression</span> relationalExpression,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                                 <span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Attribute</span>&gt;</span> additionalDescriptionMap) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:31:07Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/PlannerGraphProperty.java", "diffHunk": "@@ -178,10 +183,23 @@ public String apply(final PlannerGraph.Node component) {\n      */\n     @Nonnull\n     public static String explain(final RelationalExpression relationalExpression) {\n+        return explain(relationalExpression, ImmutableMap.of());\n+    }\n+\n+\n+    /**\n+     * Generate the explain of the planner expression that is passed in.\n+     * @param relationalExpression the planner expression to be explained.\n+     * @param additionalDescriptionMap a map used to generate names and descriptions for operators.\n+     * @return the explain of the planner expression handing in as a string in GML format.\n+     */\n+    @Nonnull\n+    public static String explain(final RelationalExpression relationalExpression,\n+                                 final Map<String, Attribute> additionalDescriptionMap) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIyMTI4OQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441221289", "bodyText": "done for all of them", "author": "normen662", "createdAt": "2020-06-17T00:56:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDY4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxNDc1MQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441214751", "body": "```suggestion\r\n    public static String exportToGml(@Nonnull final PlannerGraph plannerGraph,\r\n                                     @Nonnull final Map<String, Attribute> additionalInfoMap) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static String exportToGml(final PlannerGraph plannerGraph,\n          \n          \n            \n                                                 final Map<String, Attribute> additionalInfoMap) {\n          \n          \n            \n                public static String exportToGml(@Nonnull final PlannerGraph plannerGraph,\n          \n          \n            \n                                                 @Nonnull final Map<String, Attribute> additionalInfoMap) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">String</span> exportToGml(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">PlannerGraph</span> plannerGraph,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                                     <span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Attribute</span>&gt;</span> additionalInfoMap) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">String</span> exportToGml(<span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-smi\">PlannerGraph</span> plannerGraph,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                                     <span class=\"pl-k x x-first\">@Nonnull</span><span class=\"x x-last\"> </span><span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Attribute</span>&gt;</span> additionalInfoMap) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T00:31:22Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/temp/explain/PlannerGraphProperty.java", "diffHunk": "@@ -191,36 +209,42 @@ public static String explain(final RelationalExpression relationalExpression) {\n     /**\n      * Creates a serialized format of this graph as a gml-compatible definition.\n      * @param plannerGraph the planner graph to be exported\n-     *\n+     * @param additionalInfoMap a map used to generate names and descriptions for operators.\n      * @return the graph as string in gml format.\n      */\n     @Nonnull\n-    public static String exportToGml(final PlannerGraph plannerGraph) {\n-        final GraphExporter<PlannerGraph.Node, PlannerGraph.Edge> exporter = createGmlExporter();\n+    public static String exportToGml(final PlannerGraph plannerGraph,\n+                                     final Map<String, Attribute> additionalInfoMap) {", "originalCommit": "ba09399588c0493bbed69b94f99408a9f8294c22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9d1dd5ea5a303266b95d4237270a5fe3542a265c", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/9d1dd5ea5a303266b95d4237270a5fe3542a265c", "message": "Resolves #970: improve GML explain exporter to support operator-dependent variables and node information", "committedDate": "2020-06-17T02:22:57Z", "type": "forcePushed"}, {"oid": "f3c18dea1f7338b087118c65cfcf54d94c2a75d4", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/f3c18dea1f7338b087118c65cfcf54d94c2a75d4", "message": "Resolves #970: improve GML explain exporter to support operator-dependent variables and node information", "committedDate": "2020-06-17T02:48:23Z", "type": "forcePushed"}, {"oid": "50d750b2de321d8feee44bb22cdd7e7cd146578c", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/50d750b2de321d8feee44bb22cdd7e7cd146578c", "message": "Resolves #970: improve GML explain exporter to support operator-dependent variables and node information", "committedDate": "2020-06-17T02:57:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwNjU4MA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441606580", "body": "I think this needs a more evocative name. Perhaps:\r\n```suggestion\r\n    public TupleRange toTupleRangeWithoutContext() {\r\n```", "bodyText": "I think this needs a more evocative name. Perhaps:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public TupleRange toTupleRangeSafe() {\n          \n          \n            \n                public TupleRange toTupleRangeWithoutContext() {", "bodyHTML": "<p dir=\"auto\">I think this needs a more evocative name. Perhaps:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">TupleRange</span> <span class=\"x x-first x-last\">toTupleRangeSafe</span>() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">TupleRange</span> <span class=\"x x-first x-last\">toTupleRangeWithoutContext</span>() {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T14:51:35Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/ScanComparisons.java", "diffHunk": "@@ -260,6 +260,14 @@ public TupleRange toTupleRange(@Nullable FDBRecordStoreBase<?> store, @Nullable\n         return rangeCombiner.toTupleRange();\n     }\n \n+    @Nullable\n+    public TupleRange toTupleRangeSafe() {", "originalCommit": "50d750b2de321d8feee44bb22cdd7e7cd146578c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwNzM4Mg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/971#discussion_r441607382", "body": "```suggestion\r\n     * index scan path. It is called by {@link #rewritePlannerGraph} to create the subgraph but allows for greater\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * index scan path. It is called by {@link #rewritePlannerGraph} to create the sub graph but allows for greater\n          \n          \n            \n                 * index scan path. It is called by {@link #rewritePlannerGraph} to create the subgraph but allows for greater", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> index scan path. <span class=\"pl-smi\">It</span> is called by {<span class=\"pl-k\">@link</span> #rewritePlannerGraph} to create the <span class=\"x x-first x-last\">sub graph</span> but allows <span class=\"pl-k\">for</span> greater</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> index scan path. <span class=\"pl-smi\">It</span> is called by {<span class=\"pl-k\">@link</span> #rewritePlannerGraph} to create the <span class=\"x x-first x-last\">subgraph</span> but allows <span class=\"pl-k\">for</span> greater</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "nschiefer", "createdAt": "2020-06-17T14:52:40Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/query/plan/plans/RecordQueryPlanWithIndex.java", "diffHunk": "@@ -83,14 +88,27 @@\n     @Nonnull\n     @Override\n     default PlannerGraph rewritePlannerGraph(@Nonnull final List<? extends PlannerGraph> childGraphs) {\n-        final PlannerGraph.Node root =\n-                new PlannerGraph.Node(this,\n-                        getClass().getSimpleName(),\n-                        toString());\n-        final PlannerGraph.SourceNode source = new PlannerGraph.SourceNode(getIndexName());\n-        return PlannerGraph.builder(root)\n-                .addNode(source)\n-                .addEdge(source, root, new PlannerGraph.Edge())\n-                .build();\n+        Verify.verify(childGraphs.isEmpty());\n+        return createIndexPlannerGraph(this,\n+                NodeInfo.INDEX_SCAN_OPERATOR,\n+                ImmutableList.of(),\n+                ImmutableMap.of());\n     }\n+\n+    /**\n+     * Create an planner graph for this index scan. Note that this method allows for composition with the covering\n+     * index scan path. It is called by {@link #rewritePlannerGraph} to create the sub graph but allows for greater", "originalCommit": "50d750b2de321d8feee44bb22cdd7e7cd146578c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "90c07b25e3eeb6fd1bda7d52f8caa72ca1edef09", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/90c07b25e3eeb6fd1bda7d52f8caa72ca1edef09", "message": "Resolves #970: improve GML explain exporter to support operator-dependent variables and node information", "committedDate": "2020-06-17T15:15:55Z", "type": "commit"}, {"oid": "90c07b25e3eeb6fd1bda7d52f8caa72ca1edef09", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/90c07b25e3eeb6fd1bda7d52f8caa72ca1edef09", "message": "Resolves #970: improve GML explain exporter to support operator-dependent variables and node information", "committedDate": "2020-06-17T15:15:55Z", "type": "forcePushed"}]}