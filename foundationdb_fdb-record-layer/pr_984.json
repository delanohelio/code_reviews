{"pr_number": 984, "pr_title": "Resolves #983: FDBDatabaseRunner should use FDBRecordContextConfig more", "pr_author": "MMcM", "pr_createdAt": "2020-06-30T21:04:26Z", "pr_url": "https://github.com/FoundationDB/fdb-record-layer/pull/984", "merge_commit": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "timeline": [{"oid": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/a92d7d1d566a09a2473c61fad7fd378251af89b1", "message": "Resolves #983: FDBDatabaseRunner should use FDBRecordContextConfig more", "committedDate": "2020-07-01T15:24:05Z", "type": "commit"}, {"oid": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/a92d7d1d566a09a2473c61fad7fd378251af89b1", "message": "Resolves #983: FDBDatabaseRunner should use FDBRecordContextConfig more", "committedDate": "2020-07-01T15:24:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2MjA1Mw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448662053", "body": "```suggestion\r\n    @Nonnull\r\n    FDBRecordContextConfig.Builder getContextConfigBuilder();\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                FDBRecordContextConfig.Builder getContextConfigBuilder();\n          \n          \n            \n                @Nonnull\n          \n          \n            \n                FDBRecordContextConfig.Builder getContextConfigBuilder();", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"78\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-smi x x-first\">FDBRecordContextConfig</span><span class=\"pl-k x\">.</span><span class=\"pl-smi x\">Builder</span><span class=\"x x-last\"> getContextConfigBuilder();</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"78\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k x x-first x-last\">@Nonnull</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"79\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-smi\">FDBRecordContextConfig</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">Builder</span> getContextConfigBuilder();</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "alecgrieser", "createdAt": "2020-07-01T23:11:47Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java", "diffHunk": "@@ -69,6 +69,18 @@\n     @Nonnull\n     FDBDatabase getDatabase();\n \n+    /**\n+     * Get the configuration used in record contexts opened by this runner.\n+     * @return configuration to use\n+     */\n+    FDBRecordContextConfig.Builder getContextConfigBuilder();", "originalCommit": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fdfd33cca3032363b049f3f8fa9935fe34933246", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\nindex 2165a001..e19f519d 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n", "chunk": "@@ -73,6 +73,7 @@ public interface FDBDatabaseRunner extends AutoCloseable {\n      * Get the configuration used in record contexts opened by this runner.\n      * @return configuration to use\n      */\n+    @Nonnull\n     FDBRecordContextConfig.Builder getContextConfigBuilder();\n \n     /**\n", "next_change": {"commit": "7f83a95bdbdd8872905e4f246534d2c30a45d789", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\nindex e19f519d..77962186 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n", "chunk": "@@ -71,9 +71,9 @@ public interface FDBDatabaseRunner extends AutoCloseable {\n \n     /**\n      * Get the configuration used in record contexts opened by this runner.\n+     * Any changes made to the returned builder will be reflected in contexts opened by this runner.\n      * @return configuration to use\n      */\n-    @Nonnull\n     FDBRecordContextConfig.Builder getContextConfigBuilder();\n \n     /**\n", "next_change": {"commit": "e032e722c50ae47f516a1399fdd49f089c9615da", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\nindex 77962186..d5612a5c 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n", "chunk": "@@ -74,6 +74,7 @@ public interface FDBDatabaseRunner extends AutoCloseable {\n      * Any changes made to the returned builder will be reflected in contexts opened by this runner.\n      * @return configuration to use\n      */\n+    @Nonnull\n     FDBRecordContextConfig.Builder getContextConfigBuilder();\n \n     /**\n", "next_change": null}]}}]}}]}, "revised_code_in_main": {"commit": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\nindex 2165a001..d5612a5c 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n", "chunk": "@@ -71,8 +71,10 @@ public interface FDBDatabaseRunner extends AutoCloseable {\n \n     /**\n      * Get the configuration used in record contexts opened by this runner.\n+     * Any changes made to the returned builder will be reflected in contexts opened by this runner.\n      * @return configuration to use\n      */\n+    @Nonnull\n     FDBRecordContextConfig.Builder getContextConfigBuilder();\n \n     /**\n", "next_change": null}]}, "commits_in_main": [{"oid": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "message": "Merge commit", "committedDate": null}, {"oid": "3e8e2a6b8079fb1f2645db5f0ccbe6c52464f020", "committedDate": "2021-04-28 06:10:47 -0400", "message": "Resolves #1255: RL uses of FDBDatabaseRunner should include logging d\u2026 (#1256)"}, {"oid": "fc29c80c2433aeee46073f26a0e1af25f3daa8f6", "committedDate": "2022-05-05 11:02:08 -0700", "message": "Resolves #1645: FDBRecordContext::newRunner drops property storage"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2MjY1OQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448662659", "body": "I suppose this should have a Javadoc comment along the lines of the other getters in this builder", "bodyText": "I suppose this should have a Javadoc comment along the lines of the other getters in this builder", "bodyHTML": "<p dir=\"auto\">I suppose this should have a Javadoc comment along the lines of the other getters in this builder</p>", "author": "alecgrieser", "createdAt": "2020-07-01T23:13:50Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java", "diffHunk": "@@ -344,7 +354,7 @@ public Builder setTransactionTimeoutMillis(long transactionTimeoutMillis) {\n             return this;\n         }\n \n-        private long getTransactionTimeoutMillis() {\n+        public long getTransactionTimeoutMillis() {", "originalCommit": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3ODYyMw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448678623", "bodyText": "Added", "author": "MMcM", "createdAt": "2020-07-02T00:10:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2MjY1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "7f83a95bdbdd8872905e4f246534d2c30a45d789", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java\nindex 2e683165..a4811871 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java\n", "chunk": "@@ -354,6 +354,12 @@ public class FDBRecordContextConfig {\n             return this;\n         }\n \n+        /**\n+         * Set the transaction timeout time in milliseconds.\n+         * A value of {@link FDBDatabaseFactory#DEFAULT_TR_TIMEOUT_MILLIS} indicates that a created transaction should inherit its default from the {@link FDBDatabaseFactory}\n+         * used to create it. A value of {@link FDBDatabaseFactory#UNLIMITED_TR_TIMEOUT_MILLIS} indicates that no timeout will be imposed on the transaction.\n+         * @return the timeout time in milliseconds\n+         */\n         public long getTransactionTimeoutMillis() {\n             return transactionTimeoutMillis;\n         }\n", "next_change": null}]}, "revised_code_in_main": {"commit": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java\nindex 2e683165..a4811871 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBRecordContextConfig.java\n", "chunk": "@@ -354,6 +354,12 @@ public class FDBRecordContextConfig {\n             return this;\n         }\n \n+        /**\n+         * Set the transaction timeout time in milliseconds.\n+         * A value of {@link FDBDatabaseFactory#DEFAULT_TR_TIMEOUT_MILLIS} indicates that a created transaction should inherit its default from the {@link FDBDatabaseFactory}\n+         * used to create it. A value of {@link FDBDatabaseFactory#UNLIMITED_TR_TIMEOUT_MILLIS} indicates that no timeout will be imposed on the transaction.\n+         * @return the timeout time in milliseconds\n+         */\n         public long getTransactionTimeoutMillis() {\n             return transactionTimeoutMillis;\n         }\n", "next_change": null}]}, "commits_in_main": [{"oid": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "message": "Merge commit", "committedDate": null}, {"oid": "46677245865ea993bd241e08dd12ebab153a687a", "committedDate": "2020-07-02 13:50:12 -0400", "message": "Resolves #985: Get rid of finalizer (#986)"}, {"oid": "8c2a105e1686d26f813c8dc4500ba3db65c267b9", "committedDate": "2021-06-30 10:30:12 -0700", "message": "Resolves #1304: Expose transaction option setServerRequestTracing in context config"}, {"oid": "2cd73397f248de241a1e93e95fada022ab4714dd", "committedDate": "2021-07-01 10:53:58 -0700", "message": "Update Javadoc for server request tracing option"}, {"oid": "5efeb2355be9507a9802d18439e53016dfc1cac3", "committedDate": "2021-10-04 13:29:21 -0400", "message": "Resolves #1402: Add per-transaction metrics and commit failure metrics (#1403)"}, {"oid": "93db7e3282554ebbc85fa77a8aa8368c0d7a7ac8", "committedDate": "2021-12-06 16:00:49 -0800", "message": "Resolves #1478: Support properties passing into FDBRecordStore, configured by adopter. Firstly used for Lucene indexing's parameters for compression/encryption."}, {"oid": "888c38c8077b1828b264f0881530a8c354bbc2be", "committedDate": "2023-05-15 10:17:46 +0100", "message": "A couple of additions to FDBRecordContextConfig (#2117)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDI4OQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448664289", "body": "It is a little weird that this sets the default option here... I suppose another approach would be to make the argument to `FDBDatabaseRunnerImpl` `@Nullable` and then fill it in with a default builder (like this) if `null` is provided, and then filling in the defaults is the job of in `FDBDatabaseRunnerImpl` (or there's a \"default config builder\" method in `FDBDatabase` and then _that_ does the job of filling in the default values).\r\n\r\nI think all of those things could be changed later, though, without affecting the API.", "bodyText": "It is a little weird that this sets the default option here... I suppose another approach would be to make the argument to FDBDatabaseRunnerImpl @Nullable and then fill it in with a default builder (like this) if null is provided, and then filling in the defaults is the job of in FDBDatabaseRunnerImpl (or there's a \"default config builder\" method in FDBDatabase and then that does the job of filling in the default values).\nI think all of those things could be changed later, though, without affecting the API.", "bodyHTML": "<p dir=\"auto\">It is a little weird that this sets the default option here... I suppose another approach would be to make the argument to <code>FDBDatabaseRunnerImpl</code> <code>@Nullable</code> and then fill it in with a default builder (like this) if <code>null</code> is provided, and then filling in the defaults is the job of in <code>FDBDatabaseRunnerImpl</code> (or there's a \"default config builder\" method in <code>FDBDatabase</code> and then <em>that</em> does the job of filling in the default values).</p>\n<p dir=\"auto\">I think all of those things could be changed later, though, without affecting the API.</p>", "author": "alecgrieser", "createdAt": "2020-07-01T23:19:30Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java", "diffHunk": "@@ -766,14 +766,23 @@ private Transaction createTransaction(@Nonnull FDBRecordContextConfig config,\n         return transaction;\n     }\n \n+    /**\n+     * Create an {@link FDBDatabaseRunner} for use against this database.\n+     * @param contextConfigBuilder options for contexts opened by the new runner\n+     * @return a new runner\n+     */\n+    @Nonnull\n+    public FDBDatabaseRunner newRunner(@Nonnull FDBRecordContextConfig.Builder contextConfigBuilder) {\n+        return new FDBDatabaseRunnerImpl(this, contextConfigBuilder);\n+    }\n \n     /**\n      * Create an {@link FDBDatabaseRunner} for use against this database.\n      * @return a new runner\n      */\n     @Nonnull\n     public FDBDatabaseRunner newRunner() {\n-        return new FDBDatabaseRunnerImpl(this);\n+        return newRunner(FDBRecordContextConfig.newBuilder().setTransactionTimeoutMillis(factory.getTransactionTimeoutMillis()));", "originalCommit": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3ODk2OA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448678968", "bodyText": "This turns out not to be necessary. The old code has some redundancy that was copied into the new. The default is to get from the factory where the default is to leave it alone from the FDB client's setting. There is no need to read from the factory here.", "author": "MMcM", "createdAt": "2020-07-02T00:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDI4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "7f83a95bdbdd8872905e4f246534d2c30a45d789", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\nindex 1a1dc86a..69852b32 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n", "chunk": "@@ -782,7 +784,7 @@ public class FDBDatabase {\n      */\n     @Nonnull\n     public FDBDatabaseRunner newRunner() {\n-        return newRunner(FDBRecordContextConfig.newBuilder().setTransactionTimeoutMillis(factory.getTransactionTimeoutMillis()));\n+        return newRunner(FDBRecordContextConfig.newBuilder());\n     }\n \n     /**\n", "next_change": null}]}, "revised_code_in_main": {"commit": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\nindex 1a1dc86a..5c0fb0cc 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n", "chunk": "@@ -782,7 +784,7 @@ public class FDBDatabase {\n      */\n     @Nonnull\n     public FDBDatabaseRunner newRunner() {\n-        return newRunner(FDBRecordContextConfig.newBuilder().setTransactionTimeoutMillis(factory.getTransactionTimeoutMillis()));\n+        return newRunner(FDBRecordContextConfig.newBuilder());\n     }\n \n     /**\n", "next_change": null}]}, "commits_in_main": [{"oid": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "message": "Merge commit", "committedDate": null}, {"oid": "46677245865ea993bd241e08dd12ebab153a687a", "committedDate": "2020-07-02 13:50:12 -0400", "message": "Resolves #985: Get rid of finalizer (#986)"}, {"oid": "3a804e313bd6565dc179b0e24917027d34ff9b2c", "committedDate": "2021-02-11 14:59:09 -0800", "message": "Resolves #949: Useful system keys should be exposed through a more useful API (#979)"}, {"oid": "03798fd8846f18dd70119119f698ed80ff0ddaf9", "committedDate": "2021-03-18 18:20:40 -0700", "message": "Resolves #1191: Remove non-controversial deprecated methods"}, {"oid": "3e8e2a6b8079fb1f2645db5f0ccbe6c52464f020", "committedDate": "2021-04-28 06:10:47 -0400", "message": "Resolves #1255: RL uses of FDBDatabaseRunner should include logging d\u2026 (#1256)"}, {"oid": "f260d1b00ded7d9c773237c647f96af67b0bb7b8", "committedDate": "2021-05-05 16:43:48 -0400", "message": "Adding FDB metrics to store timer (#1265)"}, {"oid": "1e3667f3315fe27ba820598e0af7890dd012f1a5", "committedDate": "2021-05-06 10:03:22 -0700", "message": "Merge remote-tracking branch 'upstream/fdb-record-layer-develop-3.0' into merge-3.0-to-main"}, {"oid": "93859f0c8f948c057822265a94a7a59e98cce341", "committedDate": "2021-08-26 07:17:08 -0400", "message": "Refactor FDBDatabase and FDBDatabaseFactory (#1344)"}, {"oid": "5efeb2355be9507a9802d18439e53016dfc1cac3", "committedDate": "2021-10-04 13:29:21 -0400", "message": "Resolves #1402: Add per-transaction metrics and commit failure metrics (#1403)"}, {"oid": "d19f7b2f448c1c1a42443a6c38b9054435df7c43", "committedDate": "2022-05-06 13:37:24 -0700", "message": "Resolves #1639: Support a configurable FDB API version (#1642)"}, {"oid": "7463ac84699961183a0a30103a0418a6f54173d1", "committedDate": "2022-05-24 14:49:11 -0700", "message": "Resolves #1692: Remove ERROR level log on failed no-ops"}, {"oid": "200ac05041a1af712f621a27b4c5c37f9eab001c", "committedDate": "2022-05-31 19:06:05 -0700", "message": "Resolves #1623: Need to upgrade PMD (#1706)"}, {"oid": "459ad21f18aca111aa7e82a030841f4b9bc942a9", "committedDate": "2023-02-09 20:08:12 +0000", "message": "Resolves #1998: Delay publishing commit-dependent metrics until after commit (#2000)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDU1OA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448664558", "body": "It might be worth clarifying that the builder passed in will be the same object used in the runner, so future changes to the state of the argument will also affect the values as seen in the runner (as it's running).", "bodyText": "It might be worth clarifying that the builder passed in will be the same object used in the runner, so future changes to the state of the argument will also affect the values as seen in the runner (as it's running).", "bodyHTML": "<p dir=\"auto\">It might be worth clarifying that the builder passed in will be the same object used in the runner, so future changes to the state of the argument will also affect the values as seen in the runner (as it's running).</p>", "author": "alecgrieser", "createdAt": "2020-07-01T23:20:25Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java", "diffHunk": "@@ -766,14 +766,23 @@ private Transaction createTransaction(@Nonnull FDBRecordContextConfig config,\n         return transaction;\n     }\n \n+    /**\n+     * Create an {@link FDBDatabaseRunner} for use against this database.\n+     * @param contextConfigBuilder options for contexts opened by the new runner", "originalCommit": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3ODk5Mw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448678993", "bodyText": "Added", "author": "MMcM", "createdAt": "2020-07-02T00:11:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDU1OA=="}], "type": "inlineReview", "revised_code": {"commit": "7f83a95bdbdd8872905e4f246534d2c30a45d789", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\nindex 1a1dc86a..69852b32 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n", "chunk": "@@ -768,6 +768,8 @@ public class FDBDatabase {\n \n     /**\n      * Create an {@link FDBDatabaseRunner} for use against this database.\n+     * Changes made to {@code contextConfigBuilder} subsequently will continue to be reflected in contexts opened\n+     * by the runner.\n      * @param contextConfigBuilder options for contexts opened by the new runner\n      * @return a new runner\n      */\n", "next_change": null}]}, "revised_code_in_main": {"commit": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\nindex 1a1dc86a..5c0fb0cc 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n", "chunk": "@@ -768,6 +768,8 @@ public class FDBDatabase {\n \n     /**\n      * Create an {@link FDBDatabaseRunner} for use against this database.\n+     * Changes made to {@code contextConfigBuilder} subsequently will continue to be reflected in contexts opened\n+     * by the runner.\n      * @param contextConfigBuilder options for contexts opened by the new runner\n      * @return a new runner\n      */\n", "next_change": null}]}, "commits_in_main": [{"oid": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "message": "Merge commit", "committedDate": null}, {"oid": "46677245865ea993bd241e08dd12ebab153a687a", "committedDate": "2020-07-02 13:50:12 -0400", "message": "Resolves #985: Get rid of finalizer (#986)"}, {"oid": "3a804e313bd6565dc179b0e24917027d34ff9b2c", "committedDate": "2021-02-11 14:59:09 -0800", "message": "Resolves #949: Useful system keys should be exposed through a more useful API (#979)"}, {"oid": "03798fd8846f18dd70119119f698ed80ff0ddaf9", "committedDate": "2021-03-18 18:20:40 -0700", "message": "Resolves #1191: Remove non-controversial deprecated methods"}, {"oid": "3e8e2a6b8079fb1f2645db5f0ccbe6c52464f020", "committedDate": "2021-04-28 06:10:47 -0400", "message": "Resolves #1255: RL uses of FDBDatabaseRunner should include logging d\u2026 (#1256)"}, {"oid": "f260d1b00ded7d9c773237c647f96af67b0bb7b8", "committedDate": "2021-05-05 16:43:48 -0400", "message": "Adding FDB metrics to store timer (#1265)"}, {"oid": "1e3667f3315fe27ba820598e0af7890dd012f1a5", "committedDate": "2021-05-06 10:03:22 -0700", "message": "Merge remote-tracking branch 'upstream/fdb-record-layer-develop-3.0' into merge-3.0-to-main"}, {"oid": "93859f0c8f948c057822265a94a7a59e98cce341", "committedDate": "2021-08-26 07:17:08 -0400", "message": "Refactor FDBDatabase and FDBDatabaseFactory (#1344)"}, {"oid": "5efeb2355be9507a9802d18439e53016dfc1cac3", "committedDate": "2021-10-04 13:29:21 -0400", "message": "Resolves #1402: Add per-transaction metrics and commit failure metrics (#1403)"}, {"oid": "d19f7b2f448c1c1a42443a6c38b9054435df7c43", "committedDate": "2022-05-06 13:37:24 -0700", "message": "Resolves #1639: Support a configurable FDB API version (#1642)"}, {"oid": "7463ac84699961183a0a30103a0418a6f54173d1", "committedDate": "2022-05-24 14:49:11 -0700", "message": "Resolves #1692: Remove ERROR level log on failed no-ops"}, {"oid": "200ac05041a1af712f621a27b4c5c37f9eab001c", "committedDate": "2022-05-31 19:06:05 -0700", "message": "Resolves #1623: Need to upgrade PMD (#1706)"}, {"oid": "459ad21f18aca111aa7e82a030841f4b9bc942a9", "committedDate": "2023-02-09 20:08:12 +0000", "message": "Resolves #1998: Delay publishing commit-dependent metrics until after commit (#2000)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDg3OQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448664879", "body": "```suggestion\r\n        return newRunner(timer, mdcContext, null);\r\n```\r\nI think. I can make arguments that the other two `newRunner`s should remain as is, but this one seems like it should populate the default value of the other one.", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    FDBDatabaseRunner runner = newRunner();\n          \n          \n            \n                    runner.getContextConfigBuilder().setTimer(timer).setMdcContext(mdcContext);\n          \n          \n            \n                    return runner;\n          \n          \n            \n                    return newRunner(timer, mdcContext, null);\n          \n      \n    \n    \n  \n\nI think. I can make arguments that the other two newRunners should remain as is, but this one seems like it should populate the default value of the other one.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-smi\">FDBDatabaseRunner</span> runner <span class=\"pl-k\">=</span> newRunner();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        runner<span class=\"pl-k\">.</span>getContextConfigBuilder()<span class=\"pl-k\">.</span>setTimer(timer)<span class=\"pl-k\">.</span>setMdcContext(mdcContext);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">return</span> runner;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">return</span> newRunner(timer, mdcContext, <span class=\"pl-c1\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">I think. I can make arguments that the other two <code>newRunner</code>s should remain as is, but this one seems like it should populate the default value of the other one.</p>", "author": "alecgrieser", "createdAt": "2020-07-01T23:21:30Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java", "diffHunk": "@@ -784,7 +793,9 @@ public FDBDatabaseRunner newRunner() {\n      */\n     @Nonnull\n     public FDBDatabaseRunner newRunner(@Nullable FDBStoreTimer timer, @Nullable Map<String, String> mdcContext) {\n-        return new FDBDatabaseRunnerImpl(this, timer, mdcContext);\n+        FDBDatabaseRunner runner = newRunner();\n+        runner.getContextConfigBuilder().setTimer(timer).setMdcContext(mdcContext);\n+        return runner;", "originalCommit": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3OTExNQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448679115", "bodyText": "How so? The default for weakSemantics is null, right?", "author": "MMcM", "createdAt": "2020-07-02T00:12:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDg3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4NTExNA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448685114", "bodyText": "Right, sorry. I meant just that this method should call newRunner(FDBStoreTimer, Map, WeakReadSemantics) with a null WeakReadSemantics rather than tweaking the context config builder just so that it fits into the Java pattern for \"methods with default parameters\". But I don't feel strongly about this and could see this staying as is", "author": "alecgrieser", "createdAt": "2020-07-02T00:35:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDg3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4NjM2Mw==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448686363", "bodyText": "Oh, I see. I would just as soon deprecate those two methods. But either way, I don't think the one with all the arguments is, in fact, the most general one, like in that pattern. The one with one argument is, so maybe they should be expressed in terms of that?", "author": "MMcM", "createdAt": "2020-07-02T00:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NDg3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "a61b8435a30d2b8115d86daf89920eb05a640e86", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\nindex 1a1dc86a..5c0fb0cc 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n", "chunk": "@@ -793,9 +795,7 @@ public class FDBDatabase {\n      */\n     @Nonnull\n     public FDBDatabaseRunner newRunner(@Nullable FDBStoreTimer timer, @Nullable Map<String, String> mdcContext) {\n-        FDBDatabaseRunner runner = newRunner();\n-        runner.getContextConfigBuilder().setTimer(timer).setMdcContext(mdcContext);\n-        return runner;\n+        return newRunner(FDBRecordContextConfig.newBuilder().setTimer(timer).setMdcContext(mdcContext));\n     }\n \n     /**\n", "next_change": null}]}, "revised_code_in_main": {"commit": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\nindex 1a1dc86a..5c0fb0cc 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n", "chunk": "@@ -793,9 +795,7 @@ public class FDBDatabase {\n      */\n     @Nonnull\n     public FDBDatabaseRunner newRunner(@Nullable FDBStoreTimer timer, @Nullable Map<String, String> mdcContext) {\n-        FDBDatabaseRunner runner = newRunner();\n-        runner.getContextConfigBuilder().setTimer(timer).setMdcContext(mdcContext);\n-        return runner;\n+        return newRunner(FDBRecordContextConfig.newBuilder().setTimer(timer).setMdcContext(mdcContext));\n     }\n \n     /**\n", "next_change": null}]}, "commits_in_main": [{"oid": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "message": "Merge commit", "committedDate": null}, {"oid": "46677245865ea993bd241e08dd12ebab153a687a", "committedDate": "2020-07-02 13:50:12 -0400", "message": "Resolves #985: Get rid of finalizer (#986)"}, {"oid": "3a804e313bd6565dc179b0e24917027d34ff9b2c", "committedDate": "2021-02-11 14:59:09 -0800", "message": "Resolves #949: Useful system keys should be exposed through a more useful API (#979)"}, {"oid": "03798fd8846f18dd70119119f698ed80ff0ddaf9", "committedDate": "2021-03-18 18:20:40 -0700", "message": "Resolves #1191: Remove non-controversial deprecated methods"}, {"oid": "3e8e2a6b8079fb1f2645db5f0ccbe6c52464f020", "committedDate": "2021-04-28 06:10:47 -0400", "message": "Resolves #1255: RL uses of FDBDatabaseRunner should include logging d\u2026 (#1256)"}, {"oid": "f260d1b00ded7d9c773237c647f96af67b0bb7b8", "committedDate": "2021-05-05 16:43:48 -0400", "message": "Adding FDB metrics to store timer (#1265)"}, {"oid": "1e3667f3315fe27ba820598e0af7890dd012f1a5", "committedDate": "2021-05-06 10:03:22 -0700", "message": "Merge remote-tracking branch 'upstream/fdb-record-layer-develop-3.0' into merge-3.0-to-main"}, {"oid": "93859f0c8f948c057822265a94a7a59e98cce341", "committedDate": "2021-08-26 07:17:08 -0400", "message": "Refactor FDBDatabase and FDBDatabaseFactory (#1344)"}, {"oid": "5efeb2355be9507a9802d18439e53016dfc1cac3", "committedDate": "2021-10-04 13:29:21 -0400", "message": "Resolves #1402: Add per-transaction metrics and commit failure metrics (#1403)"}, {"oid": "d19f7b2f448c1c1a42443a6c38b9054435df7c43", "committedDate": "2022-05-06 13:37:24 -0700", "message": "Resolves #1639: Support a configurable FDB API version (#1642)"}, {"oid": "7463ac84699961183a0a30103a0418a6f54173d1", "committedDate": "2022-05-24 14:49:11 -0700", "message": "Resolves #1692: Remove ERROR level log on failed no-ops"}, {"oid": "200ac05041a1af712f621a27b4c5c37f9eab001c", "committedDate": "2022-05-31 19:06:05 -0700", "message": "Resolves #1623: Need to upgrade PMD (#1706)"}, {"oid": "459ad21f18aca111aa7e82a030841f4b9bc942a9", "committedDate": "2023-02-09 20:08:12 +0000", "message": "Resolves #1998: Delay publishing commit-dependent metrics until after commit (#2000)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NTU4Ng==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448665586", "body": "It's probably worth clarifying that as the object returned is the same object as (not a copy of) the one used by the runner, if one changes one of the values of the builder, then this will affect the values used when the runner creates new contexts.", "bodyText": "It's probably worth clarifying that as the object returned is the same object as (not a copy of) the one used by the runner, if one changes one of the values of the builder, then this will affect the values used when the runner creates new contexts.", "bodyHTML": "<p dir=\"auto\">It's probably worth clarifying that as the object returned is the same object as (not a copy of) the one used by the runner, if one changes one of the values of the builder, then this will affect the values used when the runner creates new contexts.</p>", "author": "alecgrieser", "createdAt": "2020-07-01T23:23:59Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java", "diffHunk": "@@ -69,6 +69,18 @@\n     @Nonnull\n     FDBDatabase getDatabase();\n \n+    /**\n+     * Get the configuration used in record contexts opened by this runner.", "originalCommit": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3OTE0NA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448679144", "bodyText": "Added.", "author": "MMcM", "createdAt": "2020-07-02T00:12:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NTU4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "fdfd33cca3032363b049f3f8fa9935fe34933246", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\nindex 2165a001..e19f519d 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n", "chunk": "@@ -73,6 +73,7 @@ public interface FDBDatabaseRunner extends AutoCloseable {\n      * Get the configuration used in record contexts opened by this runner.\n      * @return configuration to use\n      */\n+    @Nonnull\n     FDBRecordContextConfig.Builder getContextConfigBuilder();\n \n     /**\n", "next_change": {"commit": "7f83a95bdbdd8872905e4f246534d2c30a45d789", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\nindex e19f519d..77962186 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n", "chunk": "@@ -71,9 +71,9 @@ public interface FDBDatabaseRunner extends AutoCloseable {\n \n     /**\n      * Get the configuration used in record contexts opened by this runner.\n+     * Any changes made to the returned builder will be reflected in contexts opened by this runner.\n      * @return configuration to use\n      */\n-    @Nonnull\n     FDBRecordContextConfig.Builder getContextConfigBuilder();\n \n     /**\n", "next_change": {"commit": "e032e722c50ae47f516a1399fdd49f089c9615da", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\nindex 77962186..d5612a5c 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n", "chunk": "@@ -74,6 +74,7 @@ public interface FDBDatabaseRunner extends AutoCloseable {\n      * Any changes made to the returned builder will be reflected in contexts opened by this runner.\n      * @return configuration to use\n      */\n+    @Nonnull\n     FDBRecordContextConfig.Builder getContextConfigBuilder();\n \n     /**\n", "next_change": null}]}}]}}]}, "revised_code_in_main": {"commit": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\nindex 2165a001..d5612a5c 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n", "chunk": "@@ -71,8 +71,10 @@ public interface FDBDatabaseRunner extends AutoCloseable {\n \n     /**\n      * Get the configuration used in record contexts opened by this runner.\n+     * Any changes made to the returned builder will be reflected in contexts opened by this runner.\n      * @return configuration to use\n      */\n+    @Nonnull\n     FDBRecordContextConfig.Builder getContextConfigBuilder();\n \n     /**\n", "next_change": null}]}, "commits_in_main": [{"oid": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "message": "Merge commit", "committedDate": null}, {"oid": "3e8e2a6b8079fb1f2645db5f0ccbe6c52464f020", "committedDate": "2021-04-28 06:10:47 -0400", "message": "Resolves #1255: RL uses of FDBDatabaseRunner should include logging d\u2026 (#1256)"}, {"oid": "fc29c80c2433aeee46073f26a0e1af25f3daa8f6", "committedDate": "2022-05-05 11:02:08 -0700", "message": "Resolves #1645: FDBRecordContext::newRunner drops property storage"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NjE1Ng==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448666156", "body": "Looks like get/set transaction timeout millis can be similarly removed", "bodyText": "Looks like get/set transaction timeout millis can be similarly removed", "bodyHTML": "<p dir=\"auto\">Looks like get/set transaction timeout millis can be similarly removed</p>", "author": "alecgrieser", "createdAt": "2020-07-01T23:26:02Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/synchronizedsession/SynchronizedSessionRunner.java", "diffHunk": "@@ -206,52 +205,18 @@ public FDBDatabase getDatabase() {\n     }\n \n     @Override\n-    public Executor getExecutor() {\n-        return underlying.getExecutor();\n-    }\n-\n-    @Override\n-    @Nullable\n-    public FDBStoreTimer getTimer() {\n-        return underlying.getTimer();\n-    }\n-\n-    @Override\n-    public void setTimer(@Nullable FDBStoreTimer timer) {\n-        underlying.setTimer(timer);\n-    }\n-\n-    @Override\n-    @Nullable\n-    public Map<String, String> getMdcContext() {\n-        return underlying.getMdcContext();\n+    public FDBRecordContextConfig.Builder getContextConfigBuilder() {\n+        return underlying.getContextConfigBuilder();\n     }\n \n     @Override\n-    public void setMdcContext(@Nullable Map<String, String> mdcContext) {\n-        underlying.setMdcContext(mdcContext);\n+    public void setContextConfigBuilder(final FDBRecordContextConfig.Builder contextConfigBuilder) {\n+        underlying.setContextConfigBuilder(contextConfigBuilder);\n     }\n \n     @Override\n-    @Nullable\n-    public FDBDatabase.WeakReadSemantics getWeakReadSemantics() {\n-        return underlying.getWeakReadSemantics();\n-    }\n-\n-    @Override\n-    public void setWeakReadSemantics(@Nullable FDBDatabase.WeakReadSemantics weakReadSemantics) {\n-        underlying.setWeakReadSemantics(weakReadSemantics);\n-    }\n-\n-    @Nonnull\n-    @Override\n-    public FDBTransactionPriority getPriority() {\n-        return underlying.getPriority();", "originalCommit": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3OTE2Mg==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448679162", "bodyText": "Removed", "author": "MMcM", "createdAt": "2020-07-02T00:12:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NjE1Ng=="}], "type": "inlineReview", "revised_code": null, "revised_code_in_main": null, "commits_in_main": [{"oid": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "message": "Merge commit", "committedDate": null}, {"oid": "3e8e2a6b8079fb1f2645db5f0ccbe6c52464f020", "committedDate": "2021-04-28 06:10:47 -0400", "message": "Resolves #1255: RL uses of FDBDatabaseRunner should include logging d\u2026 (#1256)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NzQ2MA==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448667460", "body": "It's a little weird that one might forget to set the default transaction timeout millis here if one isn't careful...I suppose a \"default context config builder\" method on a database (or, I suppose, a static \"default builder\" method on a `FDBRecordContextConfig` that took an `FDBDatabase`) as suggested in a different comment might help with that.", "bodyText": "It's a little weird that one might forget to set the default transaction timeout millis here if one isn't careful...I suppose a \"default context config builder\" method on a database (or, I suppose, a static \"default builder\" method on a FDBRecordContextConfig that took an FDBDatabase) as suggested in a different comment might help with that.", "bodyHTML": "<p dir=\"auto\">It's a little weird that one might forget to set the default transaction timeout millis here if one isn't careful...I suppose a \"default context config builder\" method on a database (or, I suppose, a static \"default builder\" method on a <code>FDBRecordContextConfig</code> that took an <code>FDBDatabase</code>) as suggested in a different comment might help with that.</p>", "author": "alecgrieser", "createdAt": "2020-07-01T23:30:26Z", "path": "fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java", "diffHunk": "@@ -766,14 +766,23 @@ private Transaction createTransaction(@Nonnull FDBRecordContextConfig config,\n         return transaction;\n     }\n \n+    /**\n+     * Create an {@link FDBDatabaseRunner} for use against this database.\n+     * @param contextConfigBuilder options for contexts opened by the new runner\n+     * @return a new runner\n+     */\n+    @Nonnull\n+    public FDBDatabaseRunner newRunner(@Nonnull FDBRecordContextConfig.Builder contextConfigBuilder) {\n+        return new FDBDatabaseRunnerImpl(this, contextConfigBuilder);", "originalCommit": "a92d7d1d566a09a2473c61fad7fd378251af89b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY3OTIxNQ==", "url": "https://github.com/FoundationDB/fdb-record-layer/pull/984#discussion_r448679215", "bodyText": "This is no longer the case.", "author": "MMcM", "createdAt": "2020-07-02T00:12:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2NzQ2MA=="}], "type": "inlineReview", "revised_code": {"commit": "7f83a95bdbdd8872905e4f246534d2c30a45d789", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\nindex 1a1dc86a..69852b32 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n", "chunk": "@@ -768,6 +768,8 @@ public class FDBDatabase {\n \n     /**\n      * Create an {@link FDBDatabaseRunner} for use against this database.\n+     * Changes made to {@code contextConfigBuilder} subsequently will continue to be reflected in contexts opened\n+     * by the runner.\n      * @param contextConfigBuilder options for contexts opened by the new runner\n      * @return a new runner\n      */\n", "next_change": null}]}, "revised_code_in_main": {"commit": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "changed_code": [{"header": "diff --git a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\nindex 1a1dc86a..5c0fb0cc 100644\n--- a/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n+++ b/fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabase.java\n", "chunk": "@@ -768,6 +768,8 @@ public class FDBDatabase {\n \n     /**\n      * Create an {@link FDBDatabaseRunner} for use against this database.\n+     * Changes made to {@code contextConfigBuilder} subsequently will continue to be reflected in contexts opened\n+     * by the runner.\n      * @param contextConfigBuilder options for contexts opened by the new runner\n      * @return a new runner\n      */\n", "next_change": null}]}, "commits_in_main": [{"oid": "282fcea70eea2237f8fb3fcbb761b62f2d39c4a3", "message": "Merge commit", "committedDate": null}, {"oid": "46677245865ea993bd241e08dd12ebab153a687a", "committedDate": "2020-07-02 13:50:12 -0400", "message": "Resolves #985: Get rid of finalizer (#986)"}, {"oid": "3a804e313bd6565dc179b0e24917027d34ff9b2c", "committedDate": "2021-02-11 14:59:09 -0800", "message": "Resolves #949: Useful system keys should be exposed through a more useful API (#979)"}, {"oid": "03798fd8846f18dd70119119f698ed80ff0ddaf9", "committedDate": "2021-03-18 18:20:40 -0700", "message": "Resolves #1191: Remove non-controversial deprecated methods"}, {"oid": "3e8e2a6b8079fb1f2645db5f0ccbe6c52464f020", "committedDate": "2021-04-28 06:10:47 -0400", "message": "Resolves #1255: RL uses of FDBDatabaseRunner should include logging d\u2026 (#1256)"}, {"oid": "f260d1b00ded7d9c773237c647f96af67b0bb7b8", "committedDate": "2021-05-05 16:43:48 -0400", "message": "Adding FDB metrics to store timer (#1265)"}, {"oid": "1e3667f3315fe27ba820598e0af7890dd012f1a5", "committedDate": "2021-05-06 10:03:22 -0700", "message": "Merge remote-tracking branch 'upstream/fdb-record-layer-develop-3.0' into merge-3.0-to-main"}, {"oid": "93859f0c8f948c057822265a94a7a59e98cce341", "committedDate": "2021-08-26 07:17:08 -0400", "message": "Refactor FDBDatabase and FDBDatabaseFactory (#1344)"}, {"oid": "5efeb2355be9507a9802d18439e53016dfc1cac3", "committedDate": "2021-10-04 13:29:21 -0400", "message": "Resolves #1402: Add per-transaction metrics and commit failure metrics (#1403)"}, {"oid": "d19f7b2f448c1c1a42443a6c38b9054435df7c43", "committedDate": "2022-05-06 13:37:24 -0700", "message": "Resolves #1639: Support a configurable FDB API version (#1642)"}, {"oid": "7463ac84699961183a0a30103a0418a6f54173d1", "committedDate": "2022-05-24 14:49:11 -0700", "message": "Resolves #1692: Remove ERROR level log on failed no-ops"}, {"oid": "200ac05041a1af712f621a27b4c5c37f9eab001c", "committedDate": "2022-05-31 19:06:05 -0700", "message": "Resolves #1623: Need to upgrade PMD (#1706)"}, {"oid": "459ad21f18aca111aa7e82a030841f4b9bc942a9", "committedDate": "2023-02-09 20:08:12 +0000", "message": "Resolves #1998: Delay publishing commit-dependent metrics until after commit (#2000)"}]}, {"oid": "fdfd33cca3032363b049f3f8fa9935fe34933246", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/fdfd33cca3032363b049f3f8fa9935fe34933246", "message": "Update fdb-record-layer-core/src/main/java/com/apple/foundationdb/record/provider/foundationdb/FDBDatabaseRunner.java\n\nCo-authored-by: Alec Grieser <alloc@apple.com>", "committedDate": "2020-07-01T23:45:19Z", "type": "commit"}, {"oid": "7f83a95bdbdd8872905e4f246534d2c30a45d789", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/7f83a95bdbdd8872905e4f246534d2c30a45d789", "message": "Simplify timeout defaults", "committedDate": "2020-07-02T00:08:53Z", "type": "commit"}, {"oid": "e032e722c50ae47f516a1399fdd49f089c9615da", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/e032e722c50ae47f516a1399fdd49f089c9615da", "message": "Merge branch 'more-context-config' of github.com:MMcM/fdb-record-layer into more-context-config", "committedDate": "2020-07-02T00:09:04Z", "type": "commit"}, {"oid": "a61b8435a30d2b8115d86daf89920eb05a640e86", "url": "https://github.com/FoundationDB/fdb-record-layer/commit/a61b8435a30d2b8115d86daf89920eb05a640e86", "message": "try another way", "committedDate": "2020-07-02T00:41:40Z", "type": "commit"}]}