{"pr_number": 1229, "pr_title": "Make cacheRecord immutable, insist on non-null AccountRecord", "pr_author": "AdamBJohnsonx", "pr_createdAt": "2020-11-13T00:55:14Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1229", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDcxMzg4NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1229#discussion_r524713885", "body": "Nit: Variable naming here may be improvable", "bodyText": "Nit: Variable naming here may be improvable", "bodyHTML": "<p dir=\"auto\">Nit: Variable naming here may be improvable</p>", "author": "iambmelt", "createdAt": "2020-11-16T23:00:31Z", "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java", "diffHunk": "@@ -64,16 +64,18 @@ public AcquireTokenResult execute() {\n                 expiryDate);\n \n         // Create parameters for dummy authentication result\n-        final CacheRecord cacheRecord = new CacheRecord();\n-        cacheRecord.setAccount(new AccountRecord());\n-        cacheRecord.getAccount().setHomeAccountId(\"abcd\");\n-        cacheRecord.getAccount().setLocalAccountId(\"abcd\");\n+        final CacheRecordBuilder cacheRecord = new CacheRecord.builder();\n+        final AccountRecord accountRecord = new AccountRecord();\n+        cacheRecord.account(accountRecord);\n+        accountRecord.setHomeAccountId(\"abcd\");\n+        accountRecord.setLocalAccountId(\"abcd\");\n         final List<ICacheRecord> cacheRecordList = new ArrayList<>();\n-        cacheRecordList.add(cacheRecord);\n+        final ICacheRecord build = cacheRecord.build();", "originalCommit": "8aa480049dbc716724b147dec76962d11d5a06b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ba352fcce8497619b63a151849ff393866a15c1f", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/ba352fcce8497619b63a151849ff393866a15c1f", "message": "Make cacheRecord immutable, insist on non-null AccountRecord", "committedDate": "2020-11-17T21:25:08Z", "type": "forcePushed"}, {"oid": "b48b4a8a2264da4b64cc9c42fb7d2cbcb49d91ae", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/b48b4a8a2264da4b64cc9c42fb7d2cbcb49d91ae", "message": "Make cacheRecord immutable, insist on non-null AccountRecord", "committedDate": "2020-11-30T20:30:26Z", "type": "commit"}, {"oid": "cc4a319f59925460918465133ed5a9a71eba712f", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/cc4a319f59925460918465133ed5a9a71eba712f", "message": "Address naming feedback", "committedDate": "2020-11-30T20:30:26Z", "type": "commit"}, {"oid": "cc4a319f59925460918465133ed5a9a71eba712f", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/cc4a319f59925460918465133ed5a9a71eba712f", "message": "Address naming feedback", "committedDate": "2020-11-30T20:30:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5MjQzMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1229#discussion_r532892431", "body": "Checking this for null is now moot.\r\n\r\n```suggestion\r\n                final String acctHomeAccountId = cacheRecord.getAccount().getHomeAccountId();\r\n                final String acctLocalAccountId = cacheRecord.getAccount().getLocalAccountId();\r\n```", "bodyText": "Checking this for null is now moot.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            final AccountRecord account = cacheRecord.getAccount();\n          \n          \n            \n                            if (account == null) {\n          \n          \n            \n                                // If the account is null, it can't be a home account.\n          \n          \n            \n                                continue;\n          \n          \n            \n                            }\n          \n          \n            \n                            final String acctHomeAccountId = account.getHomeAccountId();\n          \n          \n            \n                            final String acctLocalAccountId = account.getLocalAccountId();\n          \n          \n            \n                            final String acctHomeAccountId = cacheRecord.getAccount().getHomeAccountId();\n          \n          \n            \n                            final String acctLocalAccountId = cacheRecord.getAccount().getLocalAccountId();", "bodyHTML": "<p dir=\"auto\">Checking this for null is now moot.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">final</span> <span class=\"pl-smi\">AccountRecord</span> account <span class=\"pl-k\">=</span> cacheRecord<span class=\"pl-k\">.</span>getAccount();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">if</span> (account <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                    <span class=\"pl-c\"><span class=\"pl-c\">//</span> If the account is null, it can't be a home account.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                    <span class=\"pl-k\">continue</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> acctHomeAccountId <span class=\"pl-k\">=</span> account<span class=\"pl-k\">.</span>getHomeAccountId();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> acctLocalAccountId <span class=\"pl-k\">=</span> account<span class=\"pl-k\">.</span>getLocalAccountId();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> acctHomeAccountId <span class=\"pl-k\">=</span> cacheRecord<span class=\"pl-k\">.</span>getAccount()<span class=\"pl-k\">.</span>getHomeAccountId();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> acctLocalAccountId <span class=\"pl-k\">=</span> cacheRecord<span class=\"pl-k\">.</span>getAccount()<span class=\"pl-k\">.</span>getLocalAccountId();</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "AdamBJohnsonx", "createdAt": "2020-11-30T20:45:52Z", "path": "msal/src/main/java/com/microsoft/identity/client/AccountAdapter.java", "diffHunk": "@@ -79,8 +79,13 @@\n             final List<ICacheRecord> result = new ArrayList<>();\n \n             for (final ICacheRecord cacheRecord : records) {\n-                final String acctHomeAccountId = cacheRecord.getAccount().getHomeAccountId();\n-                final String acctLocalAccountId = cacheRecord.getAccount().getLocalAccountId();\n+                final AccountRecord account = cacheRecord.getAccount();\n+                if (account == null) {\n+                    // If the account is null, it can't be a home account.\n+                    continue;\n+                }\n+                final String acctHomeAccountId = account.getHomeAccountId();\n+                final String acctLocalAccountId = account.getLocalAccountId();", "originalCommit": "cc4a319f59925460918465133ed5a9a71eba712f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8af23dc36b2978268f2d4be3f9e869a18bb26a86", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/8af23dc36b2978268f2d4be3f9e869a18bb26a86", "message": "Revert impossible null check.", "committedDate": "2020-11-30T20:46:13Z", "type": "commit"}, {"oid": "364a52047677473516f67c1ccf09b30c9a9d0a63", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/364a52047677473516f67c1ccf09b30c9a9d0a63", "message": "Address missing unit test files", "committedDate": "2020-12-01T01:10:21Z", "type": "commit"}, {"oid": "639801912b6cd3280e99f7d3856433135df29d82", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/639801912b6cd3280e99f7d3856433135df29d82", "message": "Update common submodule", "committedDate": "2020-12-01T01:10:21Z", "type": "commit"}]}