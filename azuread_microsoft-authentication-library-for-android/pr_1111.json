{"pr_number": 1111, "pr_title": "Added showMsalRedirectUriInfo command and activity to MSAL", "pr_author": "shoatman", "pr_createdAt": "2020-07-26T16:54:44Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111", "timeline": [{"oid": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/e0b57c635985779c404c4ff5b6b8428823cffe5c", "message": "Added showMsalRedirectUriInfo command and activity to MSAL", "committedDate": "2020-07-26T16:51:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5Mjk4NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460992985", "body": "Needs javadoc.....Also should we rename this to something like `showExpectedMsalRedirectUriInfo` (to indicate that the redirect uri displayed here isn't the one they have already registered (in case they have) but rather the one that we actually expect)?", "bodyText": "Needs javadoc.....Also should we rename this to something like showExpectedMsalRedirectUriInfo (to indicate that the redirect uri displayed here isn't the one they have already registered (in case they have) but rather the one that we actually expect)?", "bodyHTML": "<p dir=\"auto\">Needs javadoc.....Also should we rename this to something like <code>showExpectedMsalRedirectUriInfo</code> (to indicate that the redirect uri displayed here isn't the one they have already registered (in case they have) but rather the one that we actually expect)?</p>", "author": "shahzaibj", "createdAt": "2020-07-27T15:53:49Z", "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1213,6 +1214,10 @@ public static String getSdkVersion() {\n         return BuildConfig.VERSION_NAME;\n     }\n \n+    public static void showMsalRedirectUriInfo(Activity activity){", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNTA5OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461025098", "bodyText": "I like that suggestion.  Thanks", "author": "shoatman", "createdAt": "2020-07-27T16:44:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5Mjk4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5MzcxNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460993715", "body": "Could add some javadoc here", "bodyText": "Could add some javadoc here", "bodyHTML": "<p dir=\"auto\">Could add some javadoc here</p>", "author": "shahzaibj", "createdAt": "2020-07-27T15:54:52Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNTE5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461025194", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:44:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5MzcxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk3OTU3Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460979572", "body": "nit: extra line.", "bodyText": "nit: extra line.", "bodyHTML": "<p dir=\"auto\">nit: extra line.</p>", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:33:50Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r\n+    }\r\n+\r\n+    private String getSignature(Boolean urlEncode){\r\n+\r\n+        final PackageHelper info = new PackageHelper(this.getApplicationContext().getPackageManager());\r\n+        final String signatureDigest = info.getCurrentSignatureForPackage(this.getPackageName());\r\n+        String signature = \"\";\r\n+\r\n+        try {\r\n+            if(urlEncode) {\r\n+                signature = URLEncoder.encode(signatureDigest, AuthenticationConstants.ENCODING_UTF8);\r\n+            }else{\r\n+                signature = signatureDigest;\r\n+            }\r\n+        } catch (UnsupportedEncodingException e) {\r\n+            Log.e(\"getSignature\", \"Error encoding signature digest\", e);\r\n+        }\r\n+\r\n+        return signature;\r\n+\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNTIzNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461025237", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:44:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk3OTU3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MDExOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460980118", "body": "nits: final parameter,- can this be a primitive?", "bodyText": "nits: final parameter,- can this be a primitive?", "bodyHTML": "<p dir=\"auto\">nits: final parameter,- can this be a primitive?</p>", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:34:39Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r\n+    }\r\n+\r\n+    private String getSignature(Boolean urlEncode){\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNTMyOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461025329", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:44:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4MDExOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NDM0OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460984349", "body": "I think we should be explicit here, since this is truly a \"can't happen\" case as UTF-8 has been folded into Java.  This isn't thrown for any random error encoding the string, it's thrown if the character set specified by name is not supported.  It's \"Character encoding \" + AuthenticationConstants.ENCODING_UTF8 + \" is not supported.\"  You could even use Lombok to @SneakyThrows an UnsupportedEncodingException, supposing that the upper layer can responsibly handle a \"WorldIsBrokenException\".", "bodyText": "I think we should be explicit here, since this is truly a \"can't happen\" case as UTF-8 has been folded into Java.  This isn't thrown for any random error encoding the string, it's thrown if the character set specified by name is not supported.  It's \"Character encoding \" + AuthenticationConstants.ENCODING_UTF8 + \" is not supported.\"  You could even use Lombok to @SneakyThrows an UnsupportedEncodingException, supposing that the upper layer can responsibly handle a \"WorldIsBrokenException\".", "bodyHTML": "<p dir=\"auto\">I think we should be explicit here, since this is truly a \"can't happen\" case as UTF-8 has been folded into Java.  This isn't thrown for any random error encoding the string, it's thrown if the character set specified by name is not supported.  It's \"Character encoding \" + AuthenticationConstants.ENCODING_UTF8 + \" is not supported.\"  You could even use Lombok to <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/SneakyThrows/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/SneakyThrows\">@SneakyThrows</a> an UnsupportedEncodingException, supposing that the upper layer can responsibly handle a \"WorldIsBrokenException\".</p>", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:40:53Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r\n+    }\r\n+\r\n+    private String getSignature(Boolean urlEncode){\r\n+\r\n+        final PackageHelper info = new PackageHelper(this.getApplicationContext().getPackageManager());\r\n+        final String signatureDigest = info.getCurrentSignatureForPackage(this.getPackageName());\r\n+        String signature = \"\";\r\n+\r\n+        try {\r\n+            if(urlEncode) {\r\n+                signature = URLEncoder.encode(signatureDigest, AuthenticationConstants.ENCODING_UTF8);\r\n+            }else{\r\n+                signature = signatureDigest;\r\n+            }\r\n+        } catch (UnsupportedEncodingException e) {\r\n+            Log.e(\"getSignature\", \"Error encoding signature digest\", e);\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNjY4Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461026687", "bodyText": "I don't expect this to happen... ;-).  Ack on suggestion for logging message.", "author": "shoatman", "createdAt": "2020-07-27T16:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NDM0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NTQzNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460985435", "body": "nit: extra lines", "bodyText": "nit: extra lines", "bodyHTML": "<p dir=\"auto\">nit: extra lines</p>", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:42:37Z", "path": "testapps/testapp/src/main/java/com/microsoft/identity/client/testapp/AcquireTokenFragment.java", "diffHunk": "@@ -118,6 +122,8 @@ public View onCreateView(final LayoutInflater inflater, final ViewGroup containe\n         mPopSection = view.findViewById(R.id.pop_section);\n         mLoginHintSection = view.findViewById(R.id.login_hint_section);\n \n+\n+", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NzgzNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460987836", "body": "nit: extra lines?", "bodyText": "nit: extra lines?", "bodyHTML": "<p dir=\"auto\">nit: extra lines?</p>", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:46:14Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNjc5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461026791", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:47:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk4NzgzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5MDMyMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460990320", "body": "```suggestion\r\n    String mManifestTemplate = \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\n          \n          \n            \n                String mManifestTemplate = \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-smi\">String</span> mManifestTemplate<span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>&lt;activity android:name=<span class=\"pl-cce\">\\\"</span>com.microsoft.identity.client.BrowserTabActivity<span class=\"pl-cce\">\\\"</span>&gt;<span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-smi\">String</span> mManifestTemplate<span class=\"x x-first x-last\"> </span><span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>&lt;activity android:name=<span class=\"pl-cce\">\\\"</span>com.microsoft.identity.client.BrowserTabActivity<span class=\"pl-cce\">\\\"</span>&gt;<span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:49:56Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNjkwMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461026900", "bodyText": "ack", "author": "shoatman", "createdAt": "2020-07-27T16:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5MDMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NDQ1Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460994453", "body": "Could be `private`", "bodyText": "Could be private", "bodyHTML": "<p dir=\"auto\">Could be <code>private</code></p>", "author": "shahzaibj", "createdAt": "2020-07-27T15:55:58Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTczMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460995730", "bodyText": "... and final.  and a constant?", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T15:57:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NDQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNzA4Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461027083", "bodyText": "ack, ack", "author": "shoatman", "createdAt": "2020-07-27T16:47:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NDQ1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTYyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r460995622", "body": "Do we also want to display an error on the `BrokerHelperActivity` when this happens? Looks like an empty string will be shown", "bodyText": "Do we also want to display an error on the BrokerHelperActivity when this happens? Looks like an empty string will be shown", "bodyHTML": "<p dir=\"auto\">Do we also want to display an error on the <code>BrokerHelperActivity</code> when this happens? Looks like an empty string will be shown</p>", "author": "shahzaibj", "createdAt": "2020-07-27T15:57:35Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    String mManifestTemplate= \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+          return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(mManifestTemplate, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+\r\n+\r\n+    }\r\n+\r\n+    private String getSignature(Boolean urlEncode){\r\n+\r\n+        final PackageHelper info = new PackageHelper(this.getApplicationContext().getPackageManager());\r\n+        final String signatureDigest = info.getCurrentSignatureForPackage(this.getPackageName());\r\n+        String signature = \"\";\r\n+\r\n+        try {\r\n+            if(urlEncode) {\r\n+                signature = URLEncoder.encode(signatureDigest, AuthenticationConstants.ENCODING_UTF8);\r\n+            }else{\r\n+                signature = signatureDigest;\r\n+            }\r\n+        } catch (UnsupportedEncodingException e) {\r\n+            Log.e(\"getSignature\", \"Error encoding signature digest\", e);\r\n+        }\r", "originalCommit": "e0b57c635985779c404c4ff5b6b8428823cffe5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAyNzUxMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461027513", "bodyText": "Hadn't considered that since I don't expect this to happen... wondering in this case if I should convert this to a runtime exception.", "author": "shoatman", "createdAt": "2020-07-27T16:48:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTAzODQ4NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461038484", "bodyText": "If you sneaky it out it'll land in the same place. ;-)", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T17:05:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0NzQxMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461047412", "bodyText": "I chose to convert checked exception to runtime in this case.  So I'll log and then throw a runtime exception.", "author": "shoatman", "createdAt": "2020-07-27T17:20:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDk5NTYyMg=="}], "type": "inlineReview"}, {"oid": "45c5c9d54553fe88a58343a9ee1961032bd76a7a", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/45c5c9d54553fe88a58343a9ee1961032bd76a7a", "message": "Feedback comments", "committedDate": "2020-07-27T17:23:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MTE3MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461051170", "body": "may be `shows` instead of `includes`?", "bodyText": "may be shows instead of includes?", "bodyHTML": "<p dir=\"auto\">may be <code>shows</code> instead of <code>includes</code>?</p>", "author": "shahzaibj", "createdAt": "2020-07-27T17:26:56Z", "path": "msal/src/main/java/com/microsoft/identity/client/PublicClientApplication.java", "diffHunk": "@@ -1213,6 +1214,14 @@ public static String getSdkVersion() {\n         return BuildConfig.VERSION_NAME;\n     }\n \n+    /**\n+     * Presents an activity that includes the package name, signature, redirect URI and manifest entry required for your application", "originalCommit": "45c5c9d54553fe88a58343a9ee1961032bd76a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA1MjcyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1111#discussion_r461052722", "body": "should we not attach the causing exception?", "bodyText": "should we not attach the causing exception?", "bodyHTML": "<p dir=\"auto\">should we not attach the causing exception?</p>", "author": "AdamBJohnsonx", "createdAt": "2020-07-27T17:29:31Z", "path": "msal/src/main/java/com/microsoft/identity/client/helper/BrokerHelperActivity.java", "diffHunk": "@@ -0,0 +1,81 @@\n+package com.microsoft.identity.client.helper;\r\n+\r\n+import android.app.Activity;\r\n+import android.content.Context;\r\n+import android.content.Intent;\r\n+import android.os.Bundle;\r\n+import android.util.Log;\r\n+import android.widget.TextView;\r\n+\r\n+import androidx.annotation.Nullable;\r\n+\r\n+import com.microsoft.identity.common.adal.internal.AuthenticationConstants;\r\n+import com.microsoft.identity.common.internal.broker.BrokerValidator;\r\n+import com.microsoft.identity.common.internal.broker.PackageHelper;\r\n+import com.microsoft.identity.msal.R;\r\n+\r\n+import java.io.UnsupportedEncodingException;\r\n+import java.net.URLEncoder;\r\n+\r\n+/**\r\n+ * Activity to show the expected redirect URL (which includes support for Broker)\r\n+ */\r\n+public class BrokerHelperActivity extends Activity {\r\n+\r\n+    private final String MANIFEST_TEMPLATE = \"<activity android:name=\\\"com.microsoft.identity.client.BrowserTabActivity\\\">\\n\" +\r\n+            \"    <intent-filter>\\n\" +\r\n+            \"        <action android:name=\\\"android.intent.action.VIEW\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.DEFAULT\\\" />\\n\" +\r\n+            \"        <category android:name=\\\"android.intent.category.BROWSABLE\\\" />\\n\" +\r\n+            \"        <data\\n\" +\r\n+            \"            android:host=\\\"%s\\\"\\n\" +\r\n+            \"            android:path=\\\"%s\\\"\\n\" +\r\n+            \"            android:scheme=\\\"msauth\\\" />\\n\" +\r\n+            \"    </intent-filter>\\n\" +\r\n+            \"</activity>\";\r\n+    TextView mPackageName;\r\n+    TextView mSignature;\r\n+    TextView mRedirect;\r\n+    TextView mManifest;\r\n+\r\n+    public static Intent createStartIntent(final Context context) {\r\n+        final Intent intent = new Intent(context, BrokerHelperActivity.class);\r\n+        return intent;\r\n+    }\r\n+\r\n+    @Override\r\n+    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n+        super.onCreate(savedInstanceState);\r\n+        setContentView(R.layout.broker_helper);\r\n+\r\n+        mPackageName = findViewById(R.id.txtPackageName);\r\n+        mSignature = findViewById(R.id.txtSignature);\r\n+        mRedirect = findViewById(R.id.txtRedirect);\r\n+        mManifest = findViewById(R.id.txtManifest);\r\n+\r\n+        mSignature.append(getSignature(false));\r\n+        mRedirect.append(BrokerValidator.getBrokerRedirectUri(this.getApplicationContext(), this.getPackageName()));\r\n+        mManifest.append(String.format(MANIFEST_TEMPLATE, this.getPackageName(), getSignature(false)));\r\n+        mPackageName.append(this.getPackageName());\r\n+    }\r\n+\r\n+    private String getSignature(final boolean urlEncode) {\r\n+\r\n+        final PackageHelper info = new PackageHelper(this.getApplicationContext().getPackageManager());\r\n+        final String signatureDigest = info.getCurrentSignatureForPackage(this.getPackageName());\r\n+        String signature = \"\";\r\n+\r\n+        try {\r\n+            if (urlEncode) {\r\n+                signature = URLEncoder.encode(signatureDigest, AuthenticationConstants.ENCODING_UTF8);\r\n+            } else {\r\n+                signature = signatureDigest;\r\n+            }\r\n+        } catch (UnsupportedEncodingException e) {\r\n+            Log.e(\"getSignature\", \"Character encoding \" + AuthenticationConstants.ENCODING_UTF8 + \" is not supported.\", e);\r\n+            throw new RuntimeException(\"Unexpected: Unable to get the signature for this application package.\");\r", "originalCommit": "45c5c9d54553fe88a58343a9ee1961032bd76a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}