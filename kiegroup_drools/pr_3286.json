{"pr_number": 3286, "pr_title": "DROOLS-5892 Guided Rule Editor: Method calls do not support template keys", "pr_author": "Rikkola", "pr_createdAt": "2020-12-11T14:43:53Z", "pr_url": "https://github.com/kiegroup/drools/pull/3286", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTk5NzUwNg==", "url": "https://github.com/kiegroup/drools/pull/3286#discussion_r559997506", "body": "We could simplify as:\r\n```java\r\nfinal StringBuilder drl = new StringBuilder();\r\nfor (final String setter : entry.getValue()) {\r\n  drl.append(setter).append(\"\\n\");\r\n}\r\n\r\nfinal FreeFormLine action = new FreeFormLine();\r\naction.setText(drl.toString());\r\nm.addRhsItem(action,\r\n             setStatementsPosition.get(entry.getKey()));\r\n```", "bodyText": "We could simplify as:\nfinal StringBuilder drl = new StringBuilder();\nfor (final String setter : entry.getValue()) {\n  drl.append(setter).append(\"\\n\");\n}\n\nfinal FreeFormLine action = new FreeFormLine();\naction.setText(drl.toString());\nm.addRhsItem(action,\n             setStatementsPosition.get(entry.getKey()));", "bodyHTML": "<p dir=\"auto\">We could simplify as:</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"final StringBuilder drl = new StringBuilder();\nfor (final String setter : entry.getValue()) {\n  drl.append(setter).append(&quot;\\n&quot;);\n}\n\nfinal FreeFormLine action = new FreeFormLine();\naction.setText(drl.toString());\nm.addRhsItem(action,\n             setStatementsPosition.get(entry.getKey()));\"><pre><span class=\"pl-k\">final</span> <span class=\"pl-smi\">StringBuilder</span> drl <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">StringBuilder</span>();\n<span class=\"pl-k\">for</span> (<span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> setter <span class=\"pl-k\">:</span> entry<span class=\"pl-k\">.</span>getValue()) {\n  drl<span class=\"pl-k\">.</span>append(setter)<span class=\"pl-k\">.</span>append(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">\"</span></span>);\n}\n\n<span class=\"pl-k\">final</span> <span class=\"pl-smi\">FreeFormLine</span> action <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">FreeFormLine</span>();\naction<span class=\"pl-k\">.</span>setText(drl<span class=\"pl-k\">.</span>toString());\nm<span class=\"pl-k\">.</span>addRhsItem(action,\n             setStatementsPosition<span class=\"pl-k\">.</span>get(entry<span class=\"pl-k\">.</span>getKey()));</pre></div>", "author": "jomarko", "createdAt": "2021-01-19T08:37:02Z", "path": "drools-workbench-models/drools-workbench-models-commons/src/main/java/org/drools/workbench/models/commons/backend/rule/RuleModelDRLPersistenceImpl.java", "diffHunk": "@@ -3154,16 +3200,30 @@ private void parseRhs(final RuleModel m,\n                 m.addRhsItem(action,\n                              setStatementsPosition.get(entry.getKey()));\n             } else {\n-                StringBuilder sb = new StringBuilder();\n-                for (String setter : entry.getValue()) {\n-                    sb.append(setter).append(\"\\n\");\n+\n+                if (splitEvals) {\n+\n+                    for (final String drl : entry.getValue()) {\n+\n+                        final FreeFormLine action = new FreeFormLine();\n+                        action.setText(drl);\n+                        m.addRhsItem(action,\n+                                     setStatementsPosition.get(entry.getKey()));\n+                    }\n+                } else {\n+\n+                    final StringBuilder sb = new StringBuilder();\n+                    for (final String setter : entry.getValue()) {\n+                        sb.append(setter).append(\"\\n\");\n+                    }\n+                    final String drl = sb.toString();\n+\n+                    final FreeFormLine action = new FreeFormLine();\n+                    action.setText(drl);\n+                    m.addRhsItem(action,\n+                                 setStatementsPosition.get(entry.getKey()));", "originalCommit": "b58bc9ec51783754ed18f102fbcd705515979287", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDAwMDE5Ng==", "url": "https://github.com/kiegroup/drools/pull/3286#discussion_r560000196", "body": "could we please javadoc `splitEvals` parameter?", "bodyText": "could we please javadoc splitEvals parameter?", "bodyHTML": "<p dir=\"auto\">could we please javadoc <code>splitEvals</code> parameter?</p>", "author": "jomarko", "createdAt": "2021-01-19T08:41:07Z", "path": "drools-workbench-models/drools-workbench-models-commons/src/main/java/org/drools/workbench/models/commons/backend/rule/RuleModelPersistence.java", "diffHunk": "@@ -30,6 +30,11 @@ RuleModel unmarshal(final String str,\n                         final List<String> globals,\n                         final PackageDataModelOracle dmo);\n \n+    RuleModel unmarshal(final String str,\n+                        final List<String> globals,\n+                        final PackageDataModelOracle dmo,\n+                        final boolean splitEvals);", "originalCommit": "b58bc9ec51783754ed18f102fbcd705515979287", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDAwMDk2Nw==", "url": "https://github.com/kiegroup/drools/pull/3286#discussion_r560000967", "body": "Do not understand this comment, could you please clarify?", "bodyText": "Do not understand this comment, could you please clarify?", "bodyHTML": "<p dir=\"auto\">Do not understand this comment, could you please clarify?</p>", "author": "jomarko", "createdAt": "2021-01-19T08:42:33Z", "path": "drools-workbench-models/drools-workbench-models-guided-dtable/src/main/java/org/drools/workbench/models/guided/dtable/backend/util/GuidedDTBRDRLPersistence.java", "diffHunk": "@@ -317,28 +319,67 @@ protected void generateModifyMethodSeparator(final RHSGeneratorContext gctx,\n             }\n         }\n \n+        @Override\n+        public void visitActionCallMethod(final ActionCallMethod action) {\n+\n+            // Clony clonies", "originalCommit": "b58bc9ec51783754ed18f102fbcd705515979287", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1c01f38fd5d03d621b9d59d5c4d22d83f7a26f4d", "url": "https://github.com/kiegroup/drools/commit/1c01f38fd5d03d621b9d59d5c4d22d83f7a26f4d", "message": "Better support for method calls types", "committedDate": "2021-01-29T10:52:40Z", "type": "forcePushed"}, {"oid": "fb271489fc8f74700374910429d3740c637d38e1", "url": "https://github.com/kiegroup/drools/commit/fb271489fc8f74700374910429d3740c637d38e1", "message": "Better support for method calls types", "committedDate": "2021-02-01T08:49:02Z", "type": "forcePushed"}, {"oid": "2d7f30e071eb0bec3bc03ff7bb6714514c3a9216", "url": "https://github.com/kiegroup/drools/commit/2d7f30e071eb0bec3bc03ff7bb6714514c3a9216", "message": "Better support for method calls types", "committedDate": "2021-02-01T15:01:10Z", "type": "forcePushed"}, {"oid": "fb88996145528a2d28fcf5ac94fe3937acdcee68", "url": "https://github.com/kiegroup/drools/commit/fb88996145528a2d28fcf5ac94fe3937acdcee68", "message": "Better support for method calls types", "committedDate": "2021-02-01T16:42:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODQ3MTk3MA==", "url": "https://github.com/kiegroup/drools/pull/3286#discussion_r568471970", "body": "Could we please use `Object.equals` to prevent possible NPE? Or is NPE demanded as `templateKeyValue` should be never null?", "bodyText": "Could we please use Object.equals to prevent possible NPE? Or is NPE demanded as templateKeyValue should be never null?", "bodyHTML": "<p dir=\"auto\">Could we please use <code>Object.equals</code> to prevent possible NPE? Or is NPE demanded as <code>templateKeyValue</code> should be never null?</p>", "author": "jomarko", "createdAt": "2021-02-02T10:01:09Z", "path": "drools-workbench-models/drools-workbench-models-guided-dtable/src/main/java/org/drools/workbench/models/guided/dtable/backend/util/GuidedDTBRDRLPersistence.java", "diffHunk": "@@ -317,28 +319,70 @@ protected void generateModifyMethodSeparator(final RHSGeneratorContext gctx,\n             }\n         }\n \n+        @Override\n+        public void visitActionCallMethod(final ActionCallMethod action) {\n+\n+            final ActionCallMethod clone = new ActionCallMethod();\n+            clone.setState(action.getState());\n+            clone.setVariable(action.getVariable());\n+            clone.setMethodName(action.getMethodName());\n+\n+            final ActionFieldValue[] actionFieldValuesClones = new ActionFieldValue[action.getFieldValues().length];\n+            clone.setFieldValues(actionFieldValuesClones);\n+            for (int i = 0; i < action.getFieldValues().length; i++) {\n+                final ActionFieldValue fieldValue = action.getFieldValue(i);\n+\n+                if (fieldValue instanceof ActionFieldFunction) {\n+                    final ActionFieldFunction afvClone = new ActionFieldFunction();\n+                    afvClone.setMethod(((ActionFieldFunction) fieldValue).getMethod());\n+                    afvClone.setField(fieldValue.getField());\n+                    afvClone.setNature(BaseSingleFieldConstraint.TYPE_LITERAL);\n+                    afvClone.setType(fieldValue.getType());\n+                    String value = fieldValue.getValue();\n+                    String templateKeyValue = rowDataProvider.getTemplateKeyValue(value);\n+                    if (\"\".equals(templateKeyValue)) {", "originalCommit": "fb88996145528a2d28fcf5ac94fe3937acdcee68", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1defbd0c5b03650ec209fdaa16e091cbf2adca63", "url": "https://github.com/kiegroup/drools/commit/1defbd0c5b03650ec209fdaa16e091cbf2adca63", "message": "Better support for method calls types", "committedDate": "2021-02-03T10:03:14Z", "type": "forcePushed"}, {"oid": "988dc3c3c2db2f0bf352bf11df3c58ccdcf0181d", "url": "https://github.com/kiegroup/drools/commit/988dc3c3c2db2f0bf352bf11df3c58ccdcf0181d", "message": "DROOLS-5892 Guided Rule Editor: Method calls do not support template keys", "committedDate": "2021-03-24T08:32:50Z", "type": "commit"}, {"oid": "670513b04763a16e659382f56c814356a1025cfb", "url": "https://github.com/kiegroup/drools/commit/670513b04763a16e659382f56c814356a1025cfb", "message": "Better support for method calls types", "committedDate": "2021-03-24T08:32:50Z", "type": "commit"}, {"oid": "670513b04763a16e659382f56c814356a1025cfb", "url": "https://github.com/kiegroup/drools/commit/670513b04763a16e659382f56c814356a1025cfb", "message": "Better support for method calls types", "committedDate": "2021-03-24T08:32:50Z", "type": "forcePushed"}]}