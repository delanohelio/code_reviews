{"pr_number": 8824, "pr_title": "[Issue 8338][Function Worker] Splitting the authentication logic of function worker and client", "pr_author": "nodece", "pr_createdAt": "2020-12-04T06:49:33Z", "pr_url": "https://github.com/apache/pulsar/pull/8824", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwMDAzOA==", "url": "https://github.com/apache/pulsar/pull/8824#discussion_r535900038", "body": "Don't use `boolean`. This would cause a compatibility issue. The worker service is not able to start with an old configuration.\r\n\r\nUse boxed `Boolean`.\r\n\r\n```\r\nprivate Boolean brokerClientAuthenticationEnabled = null;\r\n```\r\n\r\nThen add an implementation `isBrokerClientAuthenticationEnabled` to check if `brokerClientAuthenticationEnabled` is set or not. If `brokerClientAuthenticationEnabled` is not set, fall back to use `authenticationEnabled`.\r\n\r\n```\r\npublic boolean isBrokerClientAuthenticationEnabled() {\r\n    if (brokerClientAuthenticationEnabled != null) {\r\n        return brokerClientAuthenticationEnabled;\r\n    } else {\r\n        return authenticationEnabled;\r\n    }\r\n}\r\n```", "bodyText": "Don't use boolean. This would cause a compatibility issue. The worker service is not able to start with an old configuration.\nUse boxed Boolean.\nprivate Boolean brokerClientAuthenticationEnabled = null;\n\nThen add an implementation isBrokerClientAuthenticationEnabled to check if brokerClientAuthenticationEnabled is set or not. If brokerClientAuthenticationEnabled is not set, fall back to use authenticationEnabled.\npublic boolean isBrokerClientAuthenticationEnabled() {\n    if (brokerClientAuthenticationEnabled != null) {\n        return brokerClientAuthenticationEnabled;\n    } else {\n        return authenticationEnabled;\n    }\n}", "bodyHTML": "<p dir=\"auto\">Don't use <code>boolean</code>. This would cause a compatibility issue. The worker service is not able to start with an old configuration.</p>\n<p dir=\"auto\">Use boxed <code>Boolean</code>.</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"private Boolean brokerClientAuthenticationEnabled = null;\"><pre><code>private Boolean brokerClientAuthenticationEnabled = null;\n</code></pre></div>\n<p dir=\"auto\">Then add an implementation <code>isBrokerClientAuthenticationEnabled</code> to check if <code>brokerClientAuthenticationEnabled</code> is set or not. If <code>brokerClientAuthenticationEnabled</code> is not set, fall back to use <code>authenticationEnabled</code>.</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"public boolean isBrokerClientAuthenticationEnabled() {\n    if (brokerClientAuthenticationEnabled != null) {\n        return brokerClientAuthenticationEnabled;\n    } else {\n        return authenticationEnabled;\n    }\n}\"><pre><code>public boolean isBrokerClientAuthenticationEnabled() {\n    if (brokerClientAuthenticationEnabled != null) {\n        return brokerClientAuthenticationEnabled;\n    } else {\n        return authenticationEnabled;\n    }\n}\n</code></pre></div>", "author": "sijie", "createdAt": "2020-12-04T07:50:21Z", "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java", "diffHunk": "@@ -273,6 +273,11 @@\n         doc = \"The frequency of instance liveness check, in milliseconds\"\n     )\n     private long instanceLivenessCheckFreqMs;\n+    @FieldContext(\n+            category = CATEGORY_CLIENT_SECURITY,\n+            doc = \"Whether to enable the broker client authentication used by function workers to talk to brokers\"\n+    )\n+    private boolean brokerClientAuthenticationEnabled = false;", "originalCommit": "ea3adcff255e62950dc4b26288bfe1ec6ddeaa48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwNzkwOQ==", "url": "https://github.com/apache/pulsar/pull/8824#discussion_r535907909", "bodyText": "@sijie Done.", "author": "nodece", "createdAt": "2020-12-04T08:05:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwMDAzOA=="}], "type": "inlineReview"}, {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f", "url": "https://github.com/apache/pulsar/commit/c4f197d7ac8f93303068c57cece05cbbf029c11f", "message": "Splitting the authentication logic of function worker and client\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>", "committedDate": "2020-12-04T08:05:38Z", "type": "commit"}, {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f", "url": "https://github.com/apache/pulsar/commit/c4f197d7ac8f93303068c57cece05cbbf029c11f", "message": "Splitting the authentication logic of function worker and client\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>", "committedDate": "2020-12-04T08:05:38Z", "type": "forcePushed"}]}