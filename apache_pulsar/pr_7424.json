{"pr_number": 7424, "pr_title": "[Issue: 7379] Improve security setting of Pulsar Functions", "pr_author": "wolfstudy", "pr_createdAt": "2020-07-02T02:49:05Z", "pr_url": "https://github.com/apache/pulsar/pull/7424", "timeline": [{"oid": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "url": "https://github.com/apache/pulsar/commit/46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "message": "Improve security setting of Pulsar Functions\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>", "committedDate": "2020-07-02T02:43:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1MTc2Nw==", "url": "https://github.com/apache/pulsar/pull/7424#discussion_r448751767", "body": "You need to consider backward compatibility. You can add `getBrokerClientAuthenticationPlugin()` method in WorkerConfig.\r\n\r\n```\r\nString getBrokerClientAuthenticationPlugin() {\r\n    if (null == brokerClientAuthenticationParameters) {\r\n        return clientAuthenticationParameters;\r\n    } else {\r\n        return brokerClientAuthenticationParameters;\r\n    }\r\n}\r\n```\r\nWe should do the same thing for `getBrokerClientAuthenticationPlugin`.", "bodyText": "You need to consider backward compatibility. You can add getBrokerClientAuthenticationPlugin() method in WorkerConfig.\nString getBrokerClientAuthenticationPlugin() {\n    if (null == brokerClientAuthenticationParameters) {\n        return clientAuthenticationParameters;\n    } else {\n        return brokerClientAuthenticationParameters;\n    }\n}\n\nWe should do the same thing for getBrokerClientAuthenticationPlugin.", "bodyHTML": "<p dir=\"auto\">You need to consider backward compatibility. You can add <code>getBrokerClientAuthenticationPlugin()</code> method in WorkerConfig.</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"String getBrokerClientAuthenticationPlugin() {\n    if (null == brokerClientAuthenticationParameters) {\n        return clientAuthenticationParameters;\n    } else {\n        return brokerClientAuthenticationParameters;\n    }\n}\n\"><pre><code>String getBrokerClientAuthenticationPlugin() {\n    if (null == brokerClientAuthenticationParameters) {\n        return clientAuthenticationParameters;\n    } else {\n        return brokerClientAuthenticationParameters;\n    }\n}\n</code></pre></div>\n<p dir=\"auto\">We should do the same thing for <code>getBrokerClientAuthenticationPlugin</code>.</p>", "author": "sijie", "createdAt": "2020-07-02T05:08:48Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/functions/worker/PulsarFunctionE2ESecurityTest.java", "diffHunk": "@@ -177,10 +177,10 @@ void setup(Method method) throws Exception {\n \n         ClientBuilder clientBuilder = PulsarClient.builder().serviceUrl(this.workerConfig.getPulsarServiceUrl())\n                 .operationTimeout(1000, TimeUnit.MILLISECONDS);\n-        if (isNotBlank(workerConfig.getClientAuthenticationPlugin())\n-                && isNotBlank(workerConfig.getClientAuthenticationParameters())) {\n-            clientBuilder.authentication(workerConfig.getClientAuthenticationPlugin(),\n-                    workerConfig.getClientAuthenticationParameters());\n+        if (isNotBlank(workerConfig.getBrokerClientAuthenticationPlugin())", "originalCommit": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc1MTkyNQ==", "url": "https://github.com/apache/pulsar/pull/7424#discussion_r448751925", "body": "Please keep the original settings and mark them as deprecated.", "bodyText": "Please keep the original settings and mark them as deprecated.", "bodyHTML": "<p dir=\"auto\">Please keep the original settings and mark them as deprecated.</p>", "author": "sijie", "createdAt": "2020-07-02T05:09:17Z", "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java", "diffHunk": "@@ -258,12 +258,12 @@\n         category = CATEGORY_CLIENT_SECURITY,\n         doc = \"The authentication plugin used by function workers to talk to brokers\"\n     )\n-    private String clientAuthenticationPlugin;\n+    private String brokerClientAuthenticationPlugin;", "originalCommit": "46a90e4d9a5194bf298abc1c41ca37bafd9936b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b1ff3e765d911b78f7b9455e9d37c870e990374c", "url": "https://github.com/apache/pulsar/commit/b1ff3e765d911b78f7b9455e9d37c870e990374c", "message": "fix comments\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>", "committedDate": "2020-07-02T06:29:29Z", "type": "commit"}, {"oid": "031c94cb981c3d6361afe69f0c1645e9adf273a1", "url": "https://github.com/apache/pulsar/commit/031c94cb981c3d6361afe69f0c1645e9adf273a1", "message": "fix comments\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>", "committedDate": "2020-07-02T07:14:45Z", "type": "commit"}]}