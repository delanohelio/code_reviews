{"pr_number": 6310, "pr_title": "Enable get precise backlog and backlog without delayed messages.", "pr_author": "codelipenghui", "pr_createdAt": "2020-02-12T14:23:50Z", "pr_url": "https://github.com/apache/pulsar/pull/6310", "timeline": [{"oid": "f20807ed1047dbb9deab00631d1364af06e25ead", "url": "https://github.com/apache/pulsar/commit/f20807ed1047dbb9deab00631d1364af06e25ead", "message": "Enable get precise backlog and backlog with delayed messages.", "committedDate": "2020-02-12T14:20:49Z", "type": "commit"}, {"oid": "2ac4885a24733eee49e70a3203a5a161b1a2071a", "url": "https://github.com/apache/pulsar/commit/2ac4885a24733eee49e70a3203a5a161b1a2071a", "message": "Fix checkstyle", "committedDate": "2020-02-12T14:35:55Z", "type": "commit"}, {"oid": "d9493be6871d8a8135ce7600f670459087d2a37b", "url": "https://github.com/apache/pulsar/commit/d9493be6871d8a8135ce7600f670459087d2a37b", "message": "Add docs.", "committedDate": "2020-02-13T02:16:56Z", "type": "commit"}, {"oid": "d3a191a550d9856dec6d2186b9ee8ab8e0f90594", "url": "https://github.com/apache/pulsar/commit/d3a191a550d9856dec6d2186b9ee8ab8e0f90594", "message": "Apply comment", "committedDate": "2020-02-14T12:10:58Z", "type": "commit"}, {"oid": "5df8abe4ae85ecba403f606b4bb29d0ae83de9c0", "url": "https://github.com/apache/pulsar/commit/5df8abe4ae85ecba403f606b4bb29d0ae83de9c0", "message": "Fix unit test", "committedDate": "2020-02-14T13:13:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgxMA==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379874810", "body": "just a suggestion for future tasks:\r\n\r\nif we are changing a method to add another flag, it would be better to add an overloaded method rather than directly updating the original method. It will reduce the number of files to be changed.\r\n\r\n```\r\ndefault long getNumberOfEntriesInBacklog() {\r\n    return getNumberOfEntriesInBacklog(false);\r\n}\r\n\r\nlong getNumberOfEntriesInBacklog(boolean isPreciseBacklog);\r\n```", "bodyText": "just a suggestion for future tasks:\nif we are changing a method to add another flag, it would be better to add an overloaded method rather than directly updating the original method. It will reduce the number of files to be changed.\ndefault long getNumberOfEntriesInBacklog() {\n    return getNumberOfEntriesInBacklog(false);\n}\n\nlong getNumberOfEntriesInBacklog(boolean isPreciseBacklog);", "bodyHTML": "<p dir=\"auto\">just a suggestion for future tasks:</p>\n<p dir=\"auto\">if we are changing a method to add another flag, it would be better to add an overloaded method rather than directly updating the original method. It will reduce the number of files to be changed.</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"default long getNumberOfEntriesInBacklog() {\n    return getNumberOfEntriesInBacklog(false);\n}\n\nlong getNumberOfEntriesInBacklog(boolean isPreciseBacklog);\n\"><pre><code>default long getNumberOfEntriesInBacklog() {\n    return getNumberOfEntriesInBacklog(false);\n}\n\nlong getNumberOfEntriesInBacklog(boolean isPreciseBacklog);\n</code></pre></div>", "author": "sijie", "createdAt": "2020-02-16T04:39:36Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Subscription.java", "diffHunk": "@@ -53,7 +53,7 @@ default void removeConsumer(Consumer consumer) throws BrokerServiceException {\n \n     Dispatcher getDispatcher();\n \n-    long getNumberOfEntriesInBacklog();\n+    long getNumberOfEntriesInBacklog(boolean isPreciseBacklog);", "originalCommit": "5df8abe4ae85ecba403f606b4bb29d0ae83de9c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDk5OQ==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379874999", "bodyText": "Got it.", "author": "codelipenghui", "createdAt": "2020-02-16T04:44:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgyOQ==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379874829", "body": "```suggestion\r\n            \"--get-precise-backlog\" }, description = \"Set true to get precise backlog\")\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"--is-precise-backlog\" }, description = \"Set true to get precise backlog\")\n          \n          \n            \n                        \"--get-precise-backlog\" }, description = \"Set true to get precise backlog\")", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>--<span class=\"x x-first x-last\">is</span>-precise-backlog<span class=\"pl-pds\">\"</span></span> }, description <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Set true to get precise backlog<span class=\"pl-pds\">\"</span></span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>--<span class=\"x x-first x-last\">get</span>-precise-backlog<span class=\"pl-pds\">\"</span></span> }, description <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Set true to get precise backlog<span class=\"pl-pds\">\"</span></span>)</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "sijie", "createdAt": "2020-02-16T04:40:24Z", "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java", "diffHunk": "@@ -370,10 +370,14 @@ void run() throws PulsarAdminException {\n         @Parameter(description = \"persistent://tenant/namespace/topic\\n\", required = true)\n         private java.util.List<String> params;\n \n+        @Parameter(names = { \"-ipb\",\n+            \"--is-precise-backlog\" }, description = \"Set true to get precise backlog\")", "originalCommit": "5df8abe4ae85ecba403f606b4bb29d0ae83de9c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NTAwNQ==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379875005", "bodyText": "yes, get-precise-backlog is better.", "author": "codelipenghui", "createdAt": "2020-02-16T04:44:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMTI0Ng==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379901246", "bodyText": "@sijie Has been renamed, PTAL.", "author": "codelipenghui", "createdAt": "2020-02-16T12:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgyOQ=="}], "type": "inlineReview"}, {"oid": "3e209dd496c0fc3dd75e9178c25d3850e6d5a1fc", "url": "https://github.com/apache/pulsar/commit/3e209dd496c0fc3dd75e9178c25d3850e6d5a1fc", "message": "Rename is-precise-backlog to get-precise-backlog.", "committedDate": "2020-02-16T12:52:52Z", "type": "commit"}]}