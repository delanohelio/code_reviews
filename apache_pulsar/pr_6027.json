{"pr_number": 6027, "pr_title": "[Issue 5999] Support create/update tenant with empty cluster", "pr_author": "murong00", "pr_createdAt": "2020-01-10T06:13:27Z", "pr_url": "https://github.com/apache/pulsar/pull/6027", "timeline": [{"oid": "f7772ecfa2a0b986a8b45fe9844ccc69bf71cddf", "url": "https://github.com/apache/pulsar/commit/f7772ecfa2a0b986a8b45fe9844ccc69bf71cddf", "message": "Support create/update tenant with empty cluster.", "committedDate": "2020-01-10T06:09:55Z", "type": "commit"}, {"oid": "bdadf6c9b9406e821c5545ca7fb0af0343e6b924", "url": "https://github.com/apache/pulsar/commit/bdadf6c9b9406e821c5545ca7fb0af0343e6b924", "message": "treat a blank cluster as a cluster is not specified", "committedDate": "2020-01-13T04:20:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc3NzQ4NQ==", "url": "https://github.com/apache/pulsar/pull/6027#discussion_r365777485", "body": "Ah, I don't think this is a good fix.\r\n\r\nA better fix would be:\r\n\r\n```\r\nSet<String> allowedClusters;\r\nSet<String> nonBlankClusters = new HashSet<String>();\r\nfor (String c : allowedClusters) {\r\n      if (!StringUtils.isBlank(c)) {\r\n           nonBlankClusters.add(c);\r\n      }\r\n}\r\n\r\nif (info == null || nonBlankClusters.isEmpty()) {\r\n   info = new TenantInfo();\r\n}\r\n```", "bodyText": "Ah, I don't think this is a good fix.\nA better fix would be:\nSet<String> allowedClusters;\nSet<String> nonBlankClusters = new HashSet<String>();\nfor (String c : allowedClusters) {\n      if (!StringUtils.isBlank(c)) {\n           nonBlankClusters.add(c);\n      }\n}\n\nif (info == null || nonBlankClusters.isEmpty()) {\n   info = new TenantInfo();\n}", "bodyHTML": "<p dir=\"auto\">Ah, I don't think this is a good fix.</p>\n<p dir=\"auto\">A better fix would be:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Set&lt;String&gt; allowedClusters;\nSet&lt;String&gt; nonBlankClusters = new HashSet&lt;String&gt;();\nfor (String c : allowedClusters) {\n      if (!StringUtils.isBlank(c)) {\n           nonBlankClusters.add(c);\n      }\n}\n\nif (info == null || nonBlankClusters.isEmpty()) {\n   info = new TenantInfo();\n}\n\"><pre><code>Set&lt;String&gt; allowedClusters;\nSet&lt;String&gt; nonBlankClusters = new HashSet&lt;String&gt;();\nfor (String c : allowedClusters) {\n      if (!StringUtils.isBlank(c)) {\n           nonBlankClusters.add(c);\n      }\n}\n\nif (info == null || nonBlankClusters.isEmpty()) {\n   info = new TenantInfo();\n}\n</code></pre></div>", "author": "sijie", "createdAt": "2020-01-13T12:27:03Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "diffHunk": "@@ -220,10 +221,19 @@ public void deleteTenant(\n         }\n     }\n \n+    private boolean isBlankCluster(Set<String> allowedClusters) {", "originalCommit": "bdadf6c9b9406e821c5545ca7fb0af0343e6b924", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3c690b5948dc746bac93cad2b6ce26527657d4b8", "url": "https://github.com/apache/pulsar/commit/3c690b5948dc746bac93cad2b6ce26527657d4b8", "message": "Improve non cluster logic", "committedDate": "2020-01-14T03:22:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE4Mzg0Ng==", "url": "https://github.com/apache/pulsar/pull/6027#discussion_r367183846", "body": "What's the purpose of this check? \r\n\r\nIf a caller passes a list like `[\"\", \"\"]` the request will fail because the empty string is not a valid cluster in `allowedClusters`.", "bodyText": "What's the purpose of this check?\nIf a caller passes a list like [\"\", \"\"] the request will fail because the empty string is not a valid cluster in allowedClusters.", "bodyHTML": "<p dir=\"auto\">What's the purpose of this check?</p>\n<p dir=\"auto\">If a caller passes a list like <code>[\"\", \"\"]</code> the request will fail because the empty string is not a valid cluster in <code>allowedClusters</code>.</p>", "author": "merlimat", "createdAt": "2020-01-16T00:57:20Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "diffHunk": "@@ -220,10 +222,21 @@ public void deleteTenant(\n         }\n     }\n \n+    private Set<String> getNonBlankClusters(Set<String> allowedClusters) {", "originalCommit": "3c690b5948dc746bac93cad2b6ce26527657d4b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE5MzAxMw==", "url": "https://github.com/apache/pulsar/pull/6027#discussion_r367193013", "bodyText": "This check is only used to make the request with blank clusters valid\uff0ci.e. use new TenantInfo() for create/update.", "author": "murong00", "createdAt": "2020-01-16T01:36:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE4Mzg0Ng=="}], "type": "inlineReview"}, {"oid": "20a8def4ec20811747b9f3405007d62c60c23ad6", "url": "https://github.com/apache/pulsar/commit/20a8def4ec20811747b9f3405007d62c60c23ad6", "message": "Merge branch 'master' of https://github.com/apache/pulsar into branch-6027", "committedDate": "2020-02-11T09:59:44Z", "type": "commit"}, {"oid": "65f8e0aa4cbf9c70bd656d4312f2a634a14112d7", "url": "https://github.com/apache/pulsar/commit/65f8e0aa4cbf9c70bd656d4312f2a634a14112d7", "message": "Improve the error message when clusters are empty", "committedDate": "2020-02-11T10:01:04Z", "type": "commit"}, {"oid": "7af32b11d8a87fbfab8ef77bf56fbcd81732f331", "url": "https://github.com/apache/pulsar/commit/7af32b11d8a87fbfab8ef77bf56fbcd81732f331", "message": "Remove unused test methond", "committedDate": "2020-02-11T10:05:29Z", "type": "commit"}, {"oid": "f531363c8777fc3a5384d2e20ce53ac1e43a854b", "url": "https://github.com/apache/pulsar/commit/f531363c8777fc3a5384d2e20ce53ac1e43a854b", "message": "Fix some unit test", "committedDate": "2020-02-14T08:45:28Z", "type": "commit"}, {"oid": "319ebe25b1012c2f580690c6f9fe4761c8ef5506", "url": "https://github.com/apache/pulsar/commit/319ebe25b1012c2f580690c6f9fe4761c8ef5506", "message": "Merge branch 'master' of https://github.com/apache/pulsar into branch-6027", "committedDate": "2020-02-14T13:48:24Z", "type": "commit"}, {"oid": "dbf2c416226e3a884226f53add818dff3d983cf9", "url": "https://github.com/apache/pulsar/commit/dbf2c416226e3a884226f53add818dff3d983cf9", "message": "Fix a unit test", "committedDate": "2020-02-14T14:54:30Z", "type": "commit"}]}