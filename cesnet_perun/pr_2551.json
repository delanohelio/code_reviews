{"pr_number": 2551, "pr_title": "Add new method for testing database performance", "pr_author": "stavamichal", "pr_createdAt": "2020-01-30T14:29:28Z", "pr_url": "https://github.com/CESNET/perun/pull/2551", "timeline": [{"oid": "a78c0db1f31e01d644e798e7c4c3c6612fbd4463", "url": "https://github.com/CESNET/perun/commit/a78c0db1f31e01d644e798e7c4c3c6612fbd4463", "message": "Add new method for testing database performance\n\n - new method getTimeOfQueryPerformance in DatabaseManager on all layers\n (RPC, api, bl, blImpl), can be called by anyone with role SELF and it\n will count processing time (in nanoseconds) of update operation (set\n timestamp to database table configurations to predefined property)\n - for this purpose, other methods was created to support this\n funcionality like createProperty (to create a new property in\n configurations table), propertyExists (to check if specific property\n already exists or need to be created)\n - creating of this new property was added to initialization process of\n DatabaseManager (if property doesn't exist, it will be created on start\n of Perun system)\n - method were added also to openapi perun module\n - database schemas were modified to remove existing constraint on\n configurations table to allow any property (not just database version)\n - basic tests of new methods were added\n - database version was increased\n\n IMPORTANT: database need to be changed manually for this commit,\n constraint need to be removed before using properly", "committedDate": "2020-02-03T08:45:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNDAxNw==", "url": "https://github.com/CESNET/perun/pull/2551#discussion_r374014017", "body": "Please change the return type of the method to Long:\r\n```suggestion\r\n\t\tpublic Long call(ApiCaller ac, Deserializer parms) throws PerunException {\r\n```", "bodyText": "Please change the return type of the method to Long:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tpublic Object call(ApiCaller ac, Deserializer parms) throws PerunException {\n          \n          \n            \n            \t\tpublic Long call(ApiCaller ac, Deserializer parms) throws PerunException {", "bodyHTML": "<p dir=\"auto\">Please change the return type of the method to Long:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t<span class=\"pl-k\">public</span> <span class=\"pl-smi x x-first x-last\">Object</span> call(<span class=\"pl-smi\">ApiCaller</span> ac, <span class=\"pl-smi\">Deserializer</span> parms) throws <span class=\"pl-smi\">PerunException</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t<span class=\"pl-k\">public</span> <span class=\"pl-smi x x-first x-last\">Long</span> call(<span class=\"pl-smi\">ApiCaller</span> ac, <span class=\"pl-smi\">Deserializer</span> parms) throws <span class=\"pl-smi\">PerunException</span> {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "martin-kuba", "createdAt": "2020-02-03T10:04:33Z", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/DatabaseManagerMethod.java", "diffHunk": "@@ -50,5 +52,21 @@ public Object call(ApiCaller ac, Deserializer parms) throws PerunException {\n \n \t\t\treturn ac.getDatabaseManager().getDatabaseInformation(ac.getSession());\n \t\t}\n+\t},\n+\n+\t/**\n+\t *\tGet time in ns \"nanoseconds\" of calling 1 simple update query to DB.\n+\t *  This query will update property for this purpose in configurations table.\n+\t *\n+\t * @exampleResponse \"196920\"\n+\t * @return time of processing query in nanoseconds\n+\t */\n+\tgetTimeOfQueryPerformance {\n+\n+\t\t@Override\n+\t\tpublic Object call(ApiCaller ac, Deserializer parms) throws PerunException {", "originalCommit": "a78c0db1f31e01d644e798e7c4c3c6612fbd4463", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA0NDcwMA==", "url": "https://github.com/CESNET/perun/pull/2551#discussion_r374044700", "bodyText": "Done.", "author": "stavamichal", "createdAt": "2020-02-03T11:11:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNDAxNw=="}], "type": "inlineReview"}, {"oid": "fdedae6652b8a7bcac2a27858a29302de4a937fd", "url": "https://github.com/CESNET/perun/commit/fdedae6652b8a7bcac2a27858a29302de4a937fd", "message": "Add new method for testing database performance\n\n - new method getTimeOfQueryPerformance in DatabaseManager on all layers\n (RPC, api, bl, blImpl), can be called by anyone with role SELF and it\n will count processing time (in nanoseconds) of update operation (set\n timestamp to database table configurations to predefined property)\n - for this purpose, other methods was created to support this\n funcionality like createProperty (to create a new property in\n configurations table), propertyExists (to check if specific property\n already exists or need to be created)\n - creating of this new property was added to initialization process of\n DatabaseManager (if property doesn't exist, it will be created on start\n of Perun system)\n - method were added also to openapi perun module\n - database schemas were modified to remove existing constraint on\n configurations table to allow any property (not just database version)\n - basic tests of new methods were added\n - database version was increased\n\n IMPORTANT: database need to be changed manually for this commit,\n constraint need to be removed before using properly", "committedDate": "2020-02-03T11:10:12Z", "type": "commit"}, {"oid": "fdedae6652b8a7bcac2a27858a29302de4a937fd", "url": "https://github.com/CESNET/perun/commit/fdedae6652b8a7bcac2a27858a29302de4a937fd", "message": "Add new method for testing database performance\n\n - new method getTimeOfQueryPerformance in DatabaseManager on all layers\n (RPC, api, bl, blImpl), can be called by anyone with role SELF and it\n will count processing time (in nanoseconds) of update operation (set\n timestamp to database table configurations to predefined property)\n - for this purpose, other methods was created to support this\n funcionality like createProperty (to create a new property in\n configurations table), propertyExists (to check if specific property\n already exists or need to be created)\n - creating of this new property was added to initialization process of\n DatabaseManager (if property doesn't exist, it will be created on start\n of Perun system)\n - method were added also to openapi perun module\n - database schemas were modified to remove existing constraint on\n configurations table to allow any property (not just database version)\n - basic tests of new methods were added\n - database version was increased\n\n IMPORTANT: database need to be changed manually for this commit,\n constraint need to be removed before using properly", "committedDate": "2020-02-03T11:10:12Z", "type": "forcePushed"}]}