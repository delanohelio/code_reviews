{"pr_number": 2689, "pr_title": "CORE: Fixed getAssignedServices(resource)", "pr_author": "zlamalp", "pr_createdAt": "2020-05-08T17:11:30Z", "pr_url": "https://github.com/CESNET/perun/pull/2689", "timeline": [{"oid": "1760ce3b70fe41fe7561025ef9fa1d90ae33cb56", "url": "https://github.com/CESNET/perun/commit/1760ce3b70fe41fe7561025ef9fa1d90ae33cb56", "message": "CORE: Fixed getAssignedServices(resource)\n\n- It previously retrieved service IDs and then asked\n  for each service by ID in the BL. Now we retrieve\n  list of services directly in DAO layer.", "committedDate": "2020-05-08T17:10:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzNDQzNQ==", "url": "https://github.com/CESNET/perun/pull/2689#discussion_r422834435", "body": "```suggestion\r\n\t\t\t\t\t\" from services join resource_services on services.id=resource_services.service_id where resource_services.resource_id=?\",\r\n```\r\nI just wanted to ask, if there is a reason to use the condition in the join like you do, instead of writing WHERE?", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\" from services join resource_services on services.id=resource_services.service_id and resource_services.resource_id=?\",\n          \n          \n            \n            \t\t\t\t\t\" from services join resource_services on services.id=resource_services.service_id where resource_services.resource_id=?\",\n          \n      \n    \n    \n  \n\nI just wanted to ask, if there is a reason to use the condition in the join like you do, instead of writing WHERE?", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"566\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t\t\t<span class=\"pl-s\"><span class=\"pl-pds\">\"</span> from services join resource_services on services.id=resource_services.service_id <span class=\"x x-first x-last\">and</span> resource_services.resource_id=?<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"566\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t\t\t\t<span class=\"pl-s\"><span class=\"pl-pds\">\"</span> from services join resource_services on services.id=resource_services.service_id <span class=\"x x-first x-last\">where</span> resource_services.resource_id=?<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">I just wanted to ask, if there is a reason to use the condition in the join like you do, instead of writing WHERE?</p>", "author": "Vojtech-Sassmann", "createdAt": "2020-05-11T07:23:43Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/ResourcesManagerImpl.java", "diffHunk": "@@ -560,9 +560,11 @@ public boolean isGroupAssigned(PerunSession sess, Group group, Resource resource\n \t}\n \n \t@Override\n-\tpublic List<Integer> getAssignedServices(PerunSession sess, Resource resource) throws InternalErrorException {\n+\tpublic List<Service> getAssignedServices(PerunSession sess, Resource resource) throws InternalErrorException {\n \t\ttry {\n-\t\t\treturn jdbc.query(\"select service_id as id from resource_services where resource_id=?\", Utils.ID_MAPPER, resource.getId());\n+\t\t\treturn jdbc.query(\"select \"+ ServicesManagerImpl.serviceMappingSelectQuery +\n+\t\t\t\t\t\" from services join resource_services on services.id=resource_services.service_id and resource_services.resource_id=?\",", "originalCommit": "1760ce3b70fe41fe7561025ef9fa1d90ae33cb56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzODc1NQ==", "url": "https://github.com/CESNET/perun/pull/2689#discussion_r422838755", "bodyText": "Joined table can be constrained before actual joining. When you use condition in where, then whole tables are joined first and then invalid data is discarded. For our numbers of records within tables it doesn't really matter + clever sql planners can optimize it even if it`s in a where clause.", "author": "zlamalp", "createdAt": "2020-05-11T07:31:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzNDQzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzOTcxMg==", "url": "https://github.com/CESNET/perun/pull/2689#discussion_r422839712", "bodyText": "Ok, I thought it might be something like that. Thanks.", "author": "Vojtech-Sassmann", "createdAt": "2020-05-11T07:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzNDQzNQ=="}], "type": "inlineReview"}]}