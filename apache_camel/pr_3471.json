{"pr_number": 3471, "pr_title": "Clean-ups following \"CAMEL-14361: Update to avoid reflection in creating http method\"", "pr_author": "PascalSchumacher", "pr_createdAt": "2020-01-09T19:01:45Z", "pr_url": "https://github.com/apache/camel/pull/3471", "timeline": [{"oid": "ee544424659883f13aaf5f2dad782c27b3662a36", "url": "https://github.com/apache/camel/commit/ee544424659883f13aaf5f2dad782c27b3662a36", "message": "CAMEL-14361: Update to avoid reflection in creating http method\n\nRemove unnecessary wrapping of IllegalArgumentException in RuntimeException.", "committedDate": "2020-01-09T18:56:56Z", "type": "commit"}, {"oid": "6d573054ddf6b1b539a0323171b1f01d87d2cf15", "url": "https://github.com/apache/camel/commit/6d573054ddf6b1b539a0323171b1f01d87d2cf15", "message": "CAMEL-14361: Update to avoid reflection in creating http method\n\nRemove unused clazz field.", "committedDate": "2020-01-09T18:59:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkxMzExMg==", "url": "https://github.com/apache/camel/pull/3471#discussion_r364913112", "body": "Perhaps?\r\n```suggestion\r\n            throw new IllegalArgumentException(\"Unupported HTTP verb: \" + this);\r\n```", "bodyText": "Perhaps?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new RuntimeException(\"no such method \" + this);\n          \n          \n            \n                        throw new IllegalArgumentException(\"Unupported HTTP verb: \" + this);", "bodyHTML": "<p dir=\"auto\">Perhaps?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"69\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi x x-first\">RuntimeException</span><span class=\"x\">(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x x-last\">no such method</span> <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> <span class=\"pl-c1\">this</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"69\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi x x-first\">IllegalArgumentException</span><span class=\"x\">(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x x-last\">Unupported HTTP verb:</span> <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> <span class=\"pl-c1\">this</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "zregvart", "createdAt": "2020-01-09T19:11:58Z", "path": "components/camel-http/src/main/java/org/apache/camel/component/http/HttpMethods.java", "diffHunk": "@@ -41,38 +41,32 @@\n     OPTIONS(HttpOptions.class),\n     TRACE(HttpTrace.class);\n \n-    final Class<? extends HttpRequestBase> clazz;\n     final boolean entity;\n \n     HttpMethods(Class<? extends HttpRequestBase> clazz) {\n-        this.clazz = clazz;\n         entity = HttpEntityEnclosingRequestBase.class.isAssignableFrom(clazz);\n     }\n \n     public HttpRequestBase createMethod(final String url) {\n-        try {\n-            switch (this) {\n-            case GET:\n-                return new HttpGet(url);\n-            case PATCH:\n-                return new HttpPatch(url);\n-            case POST:\n-                return new HttpPost(url);\n-            case PUT:\n-                return new HttpPut(url);\n-            case DELETE:\n-                return new HttpDelete(url);\n-            case HEAD:\n-                return new HttpHead(url);\n-            case OPTIONS:\n-                return new HttpOptions(url);\n-            case TRACE:\n-                return new HttpTrace(url);\n-            default:\n-                throw new RuntimeException(\"no such method \" + this);\n-            }\n-        } catch (IllegalArgumentException e) {\n-            throw new RuntimeException(e);\n+        switch (this) {\n+        case GET:\n+            return new HttpGet(url);\n+        case PATCH:\n+            return new HttpPatch(url);\n+        case POST:\n+            return new HttpPost(url);\n+        case PUT:\n+            return new HttpPut(url);\n+        case DELETE:\n+            return new HttpDelete(url);\n+        case HEAD:\n+            return new HttpHead(url);\n+        case OPTIONS:\n+            return new HttpOptions(url);\n+        case TRACE:\n+            return new HttpTrace(url);\n+        default:\n+            throw new RuntimeException(\"no such method \" + this);", "originalCommit": "6d573054ddf6b1b539a0323171b1f01d87d2cf15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkzOTc3Mg==", "url": "https://github.com/apache/camel/pull/3471#discussion_r364939772", "bodyText": "Yes, that was another part of ceffe62 I considered changing.\nBut the exception will only be thrown if another constant is added to the HttpMethods enum and no matching case is added to this switch (or am I missing something?). I was not sure which exception class to use. My first thought was llegalArgumentException as well, but as the switch is on this and not on an argument of the createMethod method so using an llegalArgumentException seemed misleading. An exception signalling that a bug (missing implementation) was encountered seems more appropriate (like GroovyBugError used by Groovy).", "author": "PascalSchumacher", "createdAt": "2020-01-09T20:14:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkxMzExMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTE3NzM1Mg==", "url": "https://github.com/apache/camel/pull/3471#discussion_r365177352", "bodyText": "Yeah, I'm nitpicking, there's little chance for that exception to even occur. IllegalArgumentException or IllegalStateException are my go-to exceptions in lieu of RuntimeException. Not that important, only of you think it merits the change...", "author": "zregvart", "createdAt": "2020-01-10T10:50:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkxMzExMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI3ODcxOQ==", "url": "https://github.com/apache/camel/pull/3471#discussion_r365278719", "bodyText": "Replacing the swith with inheritance (see: #3475) would allow us to get rid of the exception.", "author": "PascalSchumacher", "createdAt": "2020-01-10T15:09:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkxMzExMg=="}], "type": "inlineReview"}]}