{"pr_number": 8566, "pr_title": "SAK-44292: FORUMS: Error unique result while Automatically create multiple topics for groups", "pr_author": "feralvarez95", "pr_createdAt": "2020-09-14T11:32:15Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/8566", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r492816449", "body": "this should be a list() as more than one group/section should be returned.", "bodyText": "this should be a list() as more than one group/section should be returned.", "bodyHTML": "<p dir=\"auto\">this should be a list() as more than one group/section should be returned.</p>", "author": "ern", "createdAt": "2020-09-22T15:12:09Z", "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/MessageForumsForumManagerImpl.java", "diffHunk": "@@ -1527,6 +1527,7 @@ public String getAllowedGroupForRestrictedTopic(final Long topicId, final String\n \t\t\t\t.getNamedQuery(\"findAllowedGroupInTopic\")\n \t\t\t\t.setLong(\"id\", topicId)\n \t\t\t\t.setString(\"permissionLevelName\", permissionName)\n+\t\t\t\t.setMaxResults(1)\n \t\t\t\t.uniqueResult();", "originalCommit": "8cddd595db4b6f186c7a327d68e09098ae91c384", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxNTQzMQ==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r494215431", "bodyText": "Done!", "author": "feralvarez95", "createdAt": "2020-09-24T10:44:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzMxNzIzOQ==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r497317239", "bodyText": "@ern Is there any problem with the changes?", "author": "jesusmmp", "createdAt": "2020-09-30T08:02:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1OTkxMg==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r497759912", "bodyText": "Earle has a huge refactoring of msgcntr queued up ... with huge performance gains.\nAlso, I was never able to replicate the reported bug. I tried several times on my local trunk  .....", "author": "ottenhoff", "createdAt": "2020-09-30T19:48:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwMjk2Ng==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r498002966", "bodyText": "@ottenhoff I uploaded a video with the problem. Have you seen it?", "author": "jesusmmp", "createdAt": "2020-10-01T06:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1MzI0Nw==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r498253247", "bodyText": "Yes, I watched several times and followed the steps several times.", "author": "ottenhoff", "createdAt": "2020-10-01T13:41:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgxNzUxMA==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r504817510", "bodyText": "We have reproduced this issue in our Sakai 20 in production. We introduced a new ticket (SAK-44462) but @jesusmmp has advised that our new ticket in fact duplicated SAK-44292 Maybe our testing plan in SAK-44462 can help to reproduce the issue", "author": "mateullas", "createdAt": "2020-10-14T16:34:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgzNjM1OQ==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r504836359", "bodyText": "I was able to replicate today. @ern and I are looking at it", "author": "ottenhoff", "createdAt": "2020-10-14T17:04:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk1MTc5OA==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r504951798", "bodyText": "yes looking", "author": "ern", "createdAt": "2020-10-14T20:26:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgxNjQ0OQ=="}], "type": "inlineReview"}, {"oid": "71db8e1f8e0a27ae5cad850d076c55cbbb2b5db8", "url": "https://github.com/sakaiproject/sakai/commit/71db8e1f8e0a27ae5cad850d076c55cbbb2b5db8", "message": "SAK-44292: FORUMS: Error unique result while Automatically create multiple topics for groups", "committedDate": "2020-09-24T10:40:53Z", "type": "forcePushed"}, {"oid": "5dc1d0689ff28812f7b7ae6fcf448c60f4431161", "url": "https://github.com/sakaiproject/sakai/commit/5dc1d0689ff28812f7b7ae6fcf448c60f4431161", "message": "SAK-44292: FORUMS: Error unique result while Automatically create multiple topics for groups", "committedDate": "2020-10-14T08:23:38Z", "type": "forcePushed"}, {"oid": "74f805cb1baaaf6b83454296f18fa333d38d8367", "url": "https://github.com/sakaiproject/sakai/commit/74f805cb1baaaf6b83454296f18fa333d38d8367", "message": "SAK-44292: FORUMS: Error unique result while Automatically create multiple topics for groups", "committedDate": "2020-10-14T08:40:21Z", "type": "commit"}, {"oid": "74f805cb1baaaf6b83454296f18fa333d38d8367", "url": "https://github.com/sakaiproject/sakai/commit/74f805cb1baaaf6b83454296f18fa333d38d8367", "message": "SAK-44292: FORUMS: Error unique result while Automatically create multiple topics for groups", "committedDate": "2020-10-14T08:40:21Z", "type": "forcePushed"}, {"oid": "f9661f9d2cce75d55b48f30ea8e0d94c305f49ad", "url": "https://github.com/sakaiproject/sakai/commit/f9661f9d2cce75d55b48f30ea8e0d94c305f49ad", "message": "Use siteId", "committedDate": "2020-10-14T19:27:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk2MjYwMA==", "url": "https://github.com/sakaiproject/sakai/pull/8566#discussion_r504962600", "body": "```suggestion\r\n            return groups.stream().map(site::getGroup).anyMatch(g -> groupTitle.contains(g.getTitle()));\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for(String group: groupTitle) {\n          \n          \n            \n                      \t  if(groups.stream().map(site::getGroup).anyMatch(g -> g.getTitle().equals(group)))\n          \n          \n            \n                      \t\t  return true;\n          \n          \n            \n                        }\n          \n          \n            \n                        return groups.stream().map(site::getGroup).anyMatch(g -> groupTitle.contains(g.getTitle()));", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">for</span>(<span class=\"pl-smi\">String</span> group<span class=\"pl-k\">:</span> groupTitle) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          \t  <span class=\"pl-k\">if</span>(groups<span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>map(site<span class=\"pl-k\">::</span>getGroup)<span class=\"pl-k\">.</span>anyMatch(g <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> g<span class=\"pl-k\">.</span>getTitle()<span class=\"pl-k\">.</span>equals(group)))</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          \t\t  <span class=\"pl-k\">return</span> <span class=\"pl-c1\">true</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">return</span> groups<span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>map(site<span class=\"pl-k\">::</span>getGroup)<span class=\"pl-k\">.</span>anyMatch(g <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> groupTitle<span class=\"pl-k\">.</span>contains(g<span class=\"pl-k\">.</span>getTitle()));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "ern", "createdAt": "2020-10-14T20:47:35Z", "path": "msgcntr/messageforums-component-impl/src/java/org/sakaiproject/component/app/messageforums/ui/UIPermissionsManagerImpl.java", "diffHunk": "@@ -130,7 +130,10 @@ private boolean isInstructorForAllowedGroup(Long forumId, boolean isForum) {\n         try {\n             Site site = siteService.getSite(siteId);\n             Set<String> groups = getGroupsWithMember(site, getCurrentUserId());\n-            return groups.stream().map(site::getGroup).anyMatch(g -> g.getTitle().equals(groupTitle));\n+            for(String group: groupTitle) {\n+          \t  if(groups.stream().map(site::getGroup).anyMatch(g -> g.getTitle().equals(group)))\n+          \t\t  return true;\n+            }", "originalCommit": "f9661f9d2cce75d55b48f30ea8e0d94c305f49ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4f7624b2b856f5775144cf09643888e8d16be499", "url": "https://github.com/sakaiproject/sakai/commit/4f7624b2b856f5775144cf09643888e8d16be499", "message": "updated lambda for matching group title", "committedDate": "2020-10-14T20:48:32Z", "type": "commit"}]}