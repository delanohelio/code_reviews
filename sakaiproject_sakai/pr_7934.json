{"pr_number": 7934, "pr_title": "SAK-43273 - Group Manager - Manually added users are not a selectable option when auto-forming groups", "pr_author": "mpellicer", "pr_createdAt": "2020-02-24T14:42:05Z", "pr_url": "https://github.com/sakaiproject/sakai/pull/7934", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3MTI4OA==", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r387171288", "body": "@mpellicer, try the following, I think it might work for you:\r\n\r\n```\r\nAuthzGroup realm = authzGroupService.getAuthzGroup(realmID);\r\nSet<Member> grants = realm.getMembers();\r\n```\r\n\r\nThen, the `Member` object has a `.isProvided()` method:\r\n\r\n```\r\nif (!member.isProvided()) // or one line lambda\r\n{\r\n    // add to list of non-provided users\r\n}\r\n```\r\n\r\nHope this works, it's much less to write and easier to understand. For reference, I initially found this type of logic in `SiteParticipantHelper.addParticipantsFromMembers()` and `SiteParticipantHelper.prepareParticipants()`, as the participants list must show both provided and non-provided users.", "bodyText": "@mpellicer, try the following, I think it might work for you:\nAuthzGroup realm = authzGroupService.getAuthzGroup(realmID);\nSet<Member> grants = realm.getMembers();\n\nThen, the Member object has a .isProvided() method:\nif (!member.isProvided()) // or one line lambda\n{\n    // add to list of non-provided users\n}\n\nHope this works, it's much less to write and easier to understand. For reference, I initially found this type of logic in SiteParticipantHelper.addParticipantsFromMembers() and SiteParticipantHelper.prepareParticipants(), as the participants list must show both provided and non-provided users.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/mpellicer/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mpellicer\">@mpellicer</a>, try the following, I think it might work for you:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"AuthzGroup realm = authzGroupService.getAuthzGroup(realmID);\nSet&lt;Member&gt; grants = realm.getMembers();\"><pre><code>AuthzGroup realm = authzGroupService.getAuthzGroup(realmID);\nSet&lt;Member&gt; grants = realm.getMembers();\n</code></pre></div>\n<p dir=\"auto\">Then, the <code>Member</code> object has a <code>.isProvided()</code> method:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"if (!member.isProvided()) // or one line lambda\n{\n    // add to list of non-provided users\n}\"><pre><code>if (!member.isProvided()) // or one line lambda\n{\n    // add to list of non-provided users\n}\n</code></pre></div>\n<p dir=\"auto\">Hope this works, it's much less to write and easier to understand. For reference, I initially found this type of logic in <code>SiteParticipantHelper.addParticipantsFromMembers()</code> and <code>SiteParticipantHelper.prepareParticipants()</code>, as the participants list must show both provided and non-provided users.</p>", "author": "bjones86", "createdAt": "2020-03-03T17:16:16Z", "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "diffHunk": "@@ -296,6 +298,25 @@ public String showStep4(Model model, @ModelAttribute AutoGroupsForm autoGroupsFo\n                     }\n                 }\n             }\n+\n+            if (useManuallyAddedUsers) {\n+                List<Member> allSiteMembers = site.getMembers().stream().filter(m -> selectedRoleList.contains(m.getRole().getId())).collect(Collectors.toList());\n+                // Build the section list.\n+                List<Group> sectionList = site.getGroups().stream()\n+                    .filter(\n+                        group -> group.getProperties().getProperty(Group.GROUP_PROP_WSETUP_CREATED) == null || \n+                        !Boolean.valueOf(group.getProperties().getProperty(Group.GROUP_PROP_WSETUP_CREATED)).booleanValue()\n+                    ).collect(Collectors.toList());\n+                List<Member> siteSectionMembers = new ArrayList<Member>(); \n+                sectionList.forEach(section -> {siteSectionMembers.addAll(section.getMembers());});\n+                for (Member member : allSiteMembers) {\n+                    if (siteSectionMembers.stream().noneMatch(sectionMember -> sectionMember.getUserId().equals(member.getUserId()))) {\n+                        filteredMembers.add(member);\n+                    }\n+                }\n+                \n+            }", "originalCommit": "df51c06592fde40c37e82ee192b669f1dd0eacd5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyODc1NA==", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388128754", "bodyText": "Thanks @bjones86, makes sense to me. I tested with the demo mode and seems working.", "author": "mpellicer", "createdAt": "2020-03-05T08:00:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3MTI4OA=="}], "type": "inlineReview"}, {"oid": "4d8040572df4aad3405aa13400343699299ebab8", "url": "https://github.com/sakaiproject/sakai/commit/4d8040572df4aad3405aa13400343699299ebab8", "message": "SAK-43273 - Group Manager - Manually added users are not a selectable option when auto-forming groups", "committedDate": "2020-03-05T07:59:05Z", "type": "commit"}, {"oid": "4d8040572df4aad3405aa13400343699299ebab8", "url": "https://github.com/sakaiproject/sakai/commit/4d8040572df4aad3405aa13400343699299ebab8", "message": "SAK-43273 - Group Manager - Manually added users are not a selectable option when auto-forming groups", "committedDate": "2020-03-05T07:59:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyODk2Nw==", "url": "https://github.com/sakaiproject/sakai/pull/7934#discussion_r388128967", "body": "@bjones86 simpler and nicer.", "bodyText": "@bjones86 simpler and nicer.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/bjones86/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/bjones86\">@bjones86</a> simpler and nicer.</p>", "author": "mpellicer", "createdAt": "2020-03-05T08:00:54Z", "path": "site-manage/site-group-manager/src/main/java/org/sakaiproject/groupmanager/controller/AutoGroupsController.java", "diffHunk": "@@ -296,6 +298,13 @@ public String showStep4(Model model, @ModelAttribute AutoGroupsForm autoGroupsFo\n                     }\n                 }\n             }\n+\n+            if (useManuallyAddedUsers) {\n+                // Add non-provided members filtering by the selected roles.", "originalCommit": "4d8040572df4aad3405aa13400343699299ebab8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "29f14b462dc6ee6f11f42474b0460b23c2e6da92", "url": "https://github.com/sakaiproject/sakai/commit/29f14b462dc6ee6f11f42474b0460b23c2e6da92", "message": "Added label for the checkbox", "committedDate": "2020-03-05T16:31:00Z", "type": "commit"}]}