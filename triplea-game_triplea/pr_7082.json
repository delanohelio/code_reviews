{"pr_number": 7082, "pr_title": "#7034 NPE when setting preferred size and null chat, in ChatPlayerPan\u2026", "pr_author": "tjrbrom", "pr_createdAt": "2020-07-09T11:06:02Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7082", "timeline": [{"oid": "e9f64682b0011055bf50fd9ca8f1e6982f131705", "url": "https://github.com/triplea-game/triplea/commit/e9f64682b0011055bf50fd9ca8f1e6982f131705", "message": "#7034 NPE when setting preferred size and null chat, in ChatPlayerPanel#setDynamicPreferredSize", "committedDate": "2020-07-09T11:05:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUzMDA2Mg==", "url": "https://github.com/triplea-game/triplea/pull/7082#discussion_r452530062", "body": "I was thinking about this for a while, but I think this isn't the right fix for this.\r\nThe stacktrace in #7034 makes it clear that this `NullPointerException` occurs when shutting down a game, so adjusting the preffered size just before the game is closed doesn't really make sense to me.\r\n\r\nThat's why I'd recommend making this method no-op if `chat` is null i.e.\r\n```java\r\nif (chat == null) {\r\n  return;\r\n}\r\n```\r\nAt the start if the method", "bodyText": "I was thinking about this for a while, but I think this isn't the right fix for this.\nThe stacktrace in #7034 makes it clear that this NullPointerException occurs when shutting down a game, so adjusting the preffered size just before the game is closed doesn't really make sense to me.\nThat's why I'd recommend making this method no-op if chat is null i.e.\nif (chat == null) {\n  return;\n}\nAt the start if the method", "bodyHTML": "<p dir=\"auto\">I was thinking about this for a while, but I think this isn't the right fix for this.<br>\nThe stacktrace in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"650830063\" data-permission-text=\"Title is private\" data-url=\"https://github.com/triplea-game/triplea/issues/7034\" data-hovercard-type=\"issue\" data-hovercard-url=\"/triplea-game/triplea/issues/7034/hovercard\" href=\"https://github.com/triplea-game/triplea/issues/7034\">#7034</a> makes it clear that this <code>NullPointerException</code> occurs when shutting down a game, so adjusting the preffered size just before the game is closed doesn't really make sense to me.</p>\n<p dir=\"auto\">That's why I'd recommend making this method no-op if <code>chat</code> is null i.e.</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"if (chat == null) {\n  return;\n}\"><pre><span class=\"pl-k\">if</span> (chat <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>) {\n  <span class=\"pl-k\">return</span>;\n}</pre></div>\n<p dir=\"auto\">At the start if the method</p>", "author": "RoiEXLab", "createdAt": "2020-07-09T22:45:30Z", "path": "game-core/src/main/java/games/strategy/engine/chat/ChatPlayerPanel.java", "diffHunk": "@@ -85,9 +85,11 @@ public void setChat(final Chat chat) {\n    */\n   private void setDynamicPreferredSize() {\n     int maxNameLength = 0;\n-    final FontMetrics fontMetrics = this.getFontMetrics(UIManager.getFont(\"TextField.font\"));\n-    for (final UserName onlinePlayer : chat.getOnlinePlayers()) {\n-      maxNameLength = Math.max(maxNameLength, fontMetrics.stringWidth(onlinePlayer.getValue()));\n+    if (chat != null) {", "originalCommit": "e9f64682b0011055bf50fd9ca8f1e6982f131705", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY0ODUyOQ==", "url": "https://github.com/triplea-game/triplea/pull/7082#discussion_r452648529", "bodyText": "Just pushed that, and verifying zero interactions with renderer mock. Was wondering if I should create more unit tests/test cases (in general) ?", "author": "tjrbrom", "createdAt": "2020-07-10T06:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUzMDA2Mg=="}], "type": "inlineReview"}, {"oid": "5bdf33a5ad18a6454a0ed55e617cbc44a0b76c08", "url": "https://github.com/triplea-game/triplea/commit/5bdf33a5ad18a6454a0ed55e617cbc44a0b76c08", "message": "#7034 if chat is null, exit without setting/calculating new dynamic preferred size", "committedDate": "2020-07-10T06:27:18Z", "type": "commit"}, {"oid": "ce4b8aa521f363a72b7bf9654ba45fca3f312960", "url": "https://github.com/triplea-game/triplea/commit/ce4b8aa521f363a72b7bf9654ba45fca3f312960", "message": "replace verifyNoInteractions with never", "committedDate": "2020-07-10T06:55:38Z", "type": "commit"}]}