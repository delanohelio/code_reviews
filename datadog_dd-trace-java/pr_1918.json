{"pr_number": 1918, "pr_title": "Support 'dd.trace.startup.logs' system property and 'DD_TRACE_STARTUP_LOGS' environment variable", "pr_author": "mcculls", "pr_createdAt": "2020-09-28T12:39:55Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1918", "timeline": [{"oid": "440989a704cfe5de169cd06df4c3f30445941802", "url": "https://github.com/DataDog/dd-trace-java/commit/440989a704cfe5de169cd06df4c3f30445941802", "message": "Support 'dd.trace.startup.logs' system property and 'DD_TRACE_STARTUP_LOGS' environment variable.\nWhen \"false\" we configure the log level at startup to WARN to hide agent info messages at startup.\n\nThis doesn't affect agent warning or error messages. The startup logs setting also has no effect\nwhen debug mode (dd.trace.debug) is enabled.", "committedDate": "2020-09-28T12:16:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2MTUyMA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1918#discussion_r496061520", "body": " it's 3rd place where we use this pattern ( `isAppUsingCustomLogManager()`, `isDebugMode()` ) in this file. But I'm still not sure whatever it deserves to be a separate method.\r\n\r\nand here also:\r\nhttps://github.com/DataDog/dd-trace-java/blob/c1df1007a6aa23844a211d6b1af13733cc1bcd5d/internal-api/src/main/java/datadog/trace/bootstrap/config/provider/EnvironmentConfigSource.java#L22\r\n\r\nhttps://github.com/DataDog/dd-trace-java/blob/master/internal-api/src/main/java/datadog/trace/api/Config.java", "bodyText": "it's 3rd place where we use this pattern ( isAppUsingCustomLogManager(), isDebugMode() ) in this file. But I'm still not sure whatever it deserves to be a separate method.\nand here also:\n\n  \n    \n      dd-trace-java/internal-api/src/main/java/datadog/trace/bootstrap/config/provider/EnvironmentConfigSource.java\n    \n    \n         Line 22\n      in\n      c1df100\n    \n    \n    \n    \n\n        \n          \n           private static String propertyNameToEnvironmentVariableName(final String setting) { \n        \n    \n  \n\n\nhttps://github.com/DataDog/dd-trace-java/blob/master/internal-api/src/main/java/datadog/trace/api/Config.java", "bodyHTML": "<p dir=\"auto\">it's 3rd place where we use this pattern ( <code>isAppUsingCustomLogManager()</code>, <code>isDebugMode()</code> ) in this file. But I'm still not sure whatever it deserves to be a separate method.</p>\n<p dir=\"auto\">and here also:<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/DataDog/dd-trace-java/blob/c1df1007a6aa23844a211d6b1af13733cc1bcd5d/internal-api/src/main/java/datadog/trace/bootstrap/config/provider/EnvironmentConfigSource.java#L22\">dd-trace-java/internal-api/src/main/java/datadog/trace/bootstrap/config/provider/EnvironmentConfigSource.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 22\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/DataDog/dd-trace-java/commit/c1df1007a6aa23844a211d6b1af13733cc1bcd5d\">c1df100</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L22\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"22\"></td>\n          <td id=\"LC22\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">String</span> <span class=\"pl-en\">propertyNameToEnvironmentVariableName</span>(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-v\">setting</span>) { </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p dir=\"auto\"><a href=\"https://github.com/DataDog/dd-trace-java/blob/master/internal-api/src/main/java/datadog/trace/api/Config.java\">https://github.com/DataDog/dd-trace-java/blob/master/internal-api/src/main/java/datadog/trace/api/Config.java</a></p>", "author": "lpriima", "createdAt": "2020-09-28T15:58:32Z", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/Agent.java", "diffHunk": "@@ -435,6 +437,21 @@ private static boolean isDebugMode() {\n     return false;\n   }\n \n+  /**\n+   * Determine if we should log startup info messages according to dd.trace.startup.logs\n+   *\n+   * @return true if we should\n+   */\n+  private static boolean isStartupLogsEnabled() {\n+    final String startupLogsSysprop = \"dd.trace.startup.logs\";\n+    String startupLogsEnabled = System.getProperty(startupLogsSysprop);\n+    if (startupLogsEnabled == null) {\n+      startupLogsEnabled = System.getenv(startupLogsSysprop.replace('.', '_').toUpperCase());\n+    }", "originalCommit": "440989a704cfe5de169cd06df4c3f30445941802", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU2Mzc1MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1918#discussion_r496563751", "bodyText": "yes, I'll have a go at clearing this up in a follow-up PR - I found propertyNameToEnvironmentVariableName prepends \"dd.\" to the property string before converting it to an environment variable, which is subtly different from the direct system-property name to environment variable conversions that don't do this prepend. We also have two implementations of propertyNameToEnvironmentVariableName in the codebase that could be avoided.", "author": "mcculls", "createdAt": "2020-09-29T09:13:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjA2MTUyMA=="}], "type": "inlineReview"}]}