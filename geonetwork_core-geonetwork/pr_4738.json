{"pr_number": 4738, "pr_title": "Fixed bug with history link to the metadata.", "pr_author": "ianwallen", "pr_createdAt": "2020-06-04T22:04:44Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/4738", "timeline": [{"oid": "429fe5b29bb9e3c51b735d155da862810573ee38", "url": "https://github.com/geonetwork/core-geonetwork/commit/429fe5b29bb9e3c51b735d155da862810573ee38", "message": "Fixed bug with where the history link to the metadata was not working because it was linking using the id instead of the uuid\nThis fix also add metadata uuid to the status api results.", "committedDate": "2020-06-04T22:02:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc2OTE3NQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4738#discussion_r435769175", "body": "I would \r\n```java\r\n@Autowired\r\nIMetadataUtils metadataUtils;\r\nString uuid = metadataUtils.getMetadataUuid(Integer.toString(s.getId().getMetadataId()));\r\n```\r\n to keep it similar to what is done in other places?", "bodyText": "I would\n@Autowired\nIMetadataUtils metadataUtils;\nString uuid = metadataUtils.getMetadataUuid(Integer.toString(s.getId().getMetadataId()));\nto keep it similar to what is done in other places?", "bodyHTML": "<p dir=\"auto\">I would</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@Autowired\nIMetadataUtils metadataUtils;\nString uuid = metadataUtils.getMetadataUuid(Integer.toString(s.getId().getMetadataId()));\"><pre><span class=\"pl-k\">@Autowired</span>\n<span class=\"pl-smi\">IMetadataUtils</span> metadataUtils;\n<span class=\"pl-smi\">String</span> uuid <span class=\"pl-k\">=</span> metadataUtils<span class=\"pl-k\">.</span>getMetadataUuid(<span class=\"pl-smi\">Integer</span><span class=\"pl-k\">.</span>toString(s<span class=\"pl-k\">.</span>getId()<span class=\"pl-k\">.</span>getMetadataId()));</pre></div>\n<p dir=\"auto\">to keep it similar to what is done in other places?</p>", "author": "fxprunayre", "createdAt": "2020-06-05T08:29:40Z", "path": "services/src/main/java/org/fao/geonet/api/records/MetadataWorkflowApi.java", "diffHunk": "@@ -473,6 +474,17 @@ public MetadataStatus convertParameter(int id, MetadataStatusParameter parameter\n             }\n             status.setTitle(title);\n \n+            String uuid = uuids.get(s.getId().getMetadataId());\n+            if (uuid == null) {\n+                try {\n+                    // Collect metadata uuid. For now we use Lucene\n+                    uuid = LuceneSearcher.getMetadataFromIndexById(language, s.getId().getMetadataId() + \"\", \"_uuid\");", "originalCommit": "429fe5b29bb9e3c51b735d155da862810573ee38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4ODk4OQ==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4738#discussion_r435788989", "bodyText": "Indeed.", "author": "josegar74", "createdAt": "2020-06-05T09:04:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc2OTE3NQ=="}], "type": "inlineReview"}, {"oid": "8133ee6581c99e168489c4140cf30af3f449a83e", "url": "https://github.com/geonetwork/core-geonetwork/commit/8133ee6581c99e168489c4140cf30af3f449a83e", "message": "Update UUID retrieval to use metadataUtils", "committedDate": "2020-06-09T11:39:30Z", "type": "commit"}]}