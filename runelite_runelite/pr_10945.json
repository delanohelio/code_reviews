{"pr_number": 10945, "pr_title": "Hiscore: autocomplete recent search history", "pr_author": "DSerp", "pr_createdAt": "2020-03-04T03:34:29Z", "pr_url": "https://github.com/runelite/runelite/pull/10945", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQzOTY5NA==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r387439694", "body": "Can't these classes be replaced with an evicting queue? ", "bodyText": "Can't these classes be replaced with an evicting queue?", "bodyHTML": "<p dir=\"auto\">Can't these classes be replaced with an evicting queue?</p>", "author": "raiyni", "createdAt": "2020-03-04T04:10:20Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/SearchHistoryManager.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright (c) 2020, Daniel <serpa88@hotmail.ca>\n+ * All rights reserved.\n+ *\n+ * Redistribution and use in source and binary forms, with or without\n+ * modification, are permitted provided that the following conditions are met:\n+ *\n+ * 1. Redistributions of source code must retain the above copyright notice, this\n+ *    list of conditions and the following disclaimer.\n+ * 2. Redistributions in binary form must reproduce the above copyright notice,\n+ *    this list of conditions and the following disclaimer in the documentation\n+ *    and/or other materials provided with the distribution.\n+ *\n+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n+ * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n+ * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\n+ * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n+ * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n+ * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n+ */\n+package net.runelite.client.plugins.hiscore;\n+\n+import com.google.inject.Inject;\n+import java.util.ArrayList;\n+import java.util.stream.Collectors;\n+import static net.runelite.http.api.RuneLiteAPI.GSON;\n+import net.runelite.http.api.hiscore.HiscoreResult;\n+\n+public class SearchHistoryManager", "originalCommit": "8b14963c74c5b455f2de2e4c7fcc7c353682abfa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAxOTAzMA==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388019030", "bodyText": "The code has been refactored. Please let me know what you think now", "author": "DSerp", "createdAt": "2020-03-05T00:44:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQzOTY5NA=="}], "type": "inlineReview"}, {"oid": "ad77a51f002700556008071b4f95473e05804be3", "url": "https://github.com/runelite/runelite/commit/ad77a51f002700556008071b4f95473e05804be3", "message": "Hiscore: autocomplete recent search history", "committedDate": "2020-03-05T00:40:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzMTMxNw==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388031317", "body": "initialize the size here", "bodyText": "initialize the size here", "bodyHTML": "<p dir=\"auto\">initialize the size here</p>", "author": "raiyni", "createdAt": "2020-03-05T01:27:46Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -50,15 +54,22 @@\n \t/**\n \t * Non-breaking space character.\n \t */\n-\tprivate static final String NBSP = Character.toString((char)160);\n+\tprivate static final String NBSP = Character.toString((char) 160);\n \n \t/**\n \t * Character class for characters that cannot be in an RSN.\n \t */\n \tprivate static final Pattern INVALID_CHARS = Pattern.compile(\"[^a-zA-Z0-9_ -]\");\n \n+\tprivate static final Pattern RSN_PATTERN = Pattern.compile(\"[A-Za-z0-9 ]+\");\n+\tprivate static final int MAX_SEARCH_HISTORY = 25;\n+\n \tprivate final Client client;\n \n+\tprivate final HiscoreConfig config;\n+\n+\tprivate EvictingQueue<String> searchHistory;", "originalCommit": "ad77a51f002700556008071b4f95473e05804be3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAzMjAwNQ==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388032005", "body": "I don't think using this matcher really matters? It can just be initialized with the values split from `Text::COMMA_SPLITTER`", "bodyText": "I don't think using this matcher really matters? It can just be initialized with the values split from Text::COMMA_SPLITTER", "bodyHTML": "<p dir=\"auto\">I don't think using this matcher really matters? It can just be initialized with the values split from <code>Text::COMMA_SPLITTER</code></p>", "author": "raiyni", "createdAt": "2020-03-05T01:30:12Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -241,6 +260,27 @@ private boolean findAutocompleteName(String nameStart)\n \t\treturn autocompleteName.isPresent();\n \t}\n \n+\tprivate void populateSearchHistory()\n+\t{\n+\t\tsearchHistory = EvictingQueue.create(MAX_SEARCH_HISTORY);\n+\t\tMatcher m = RSN_PATTERN.matcher(config.searchHistory());", "originalCommit": "ad77a51f002700556008071b4f95473e05804be3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA0MzQ1Ng==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388043456", "body": "There are a lot of irrelevant changes in this, are you using our style format file?", "bodyText": "There are a lot of irrelevant changes in this, are you using our style format file?", "bodyHTML": "<p dir=\"auto\">There are a lot of irrelevant changes in this, are you using our style format file?</p>", "author": "raiyni", "createdAt": "2020-03-05T02:13:49Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -145,7 +158,7 @@ public void keyTyped(KeyEvent e)\n \n \tprivate void newAutocomplete(KeyEvent e)\n \t{\n-\t\tfinal JTextComponent input = (JTextComponent)e.getSource();\n+\t\tfinal JTextComponent input = (JTextComponent) e.getSource();", "originalCommit": "ad77a51f002700556008071b4f95473e05804be3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA1OTU4MQ==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388059581", "bodyText": "Yes, I am using the style found in the wiki. I'll change them back", "author": "DSerp", "createdAt": "2020-03-05T03:22:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA0MzQ1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA0MzY3OA==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388043678", "body": "You should be able to use `String::join`", "bodyText": "You should be able to use String::join", "bodyHTML": "<p dir=\"auto\">You should be able to use <code>String::join</code></p>", "author": "raiyni", "createdAt": "2020-03-05T02:14:41Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -241,6 +260,27 @@ private boolean findAutocompleteName(String nameStart)\n \t\treturn autocompleteName.isPresent();\n \t}\n \n+\tprivate void populateSearchHistory()\n+\t{\n+\t\tsearchHistory = EvictingQueue.create(MAX_SEARCH_HISTORY);\n+\t\tMatcher m = RSN_PATTERN.matcher(config.searchHistory());\n+\n+\t\twhile (m.find())\n+\t\t{\n+\t\t\tsearchHistory.add(m.group());\n+\t\t}\n+\t}\n+\n+\tvoid addToSearchHistory(@NonNull String name)\n+\t{\n+\t\tif (!searchHistory.contains(name))\n+\t\t{\n+\t\t\tsearchHistory.offer(name);\n+\t\t\tString result = searchHistory.stream().collect(Collectors.joining(\",\"));", "originalCommit": "ad77a51f002700556008071b4f95473e05804be3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA2MjY0MQ==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388062641", "bodyText": "I used Text::toCSV here", "author": "DSerp", "createdAt": "2020-03-05T03:37:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA0MzY3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA3NDI0NQ==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r388074245", "body": "This will need to be able to populate when you log into a runelite account too", "bodyText": "This will need to be able to populate when you log into a runelite account too", "bodyHTML": "<p dir=\"auto\">This will need to be able to populate when you log into a runelite account too</p>", "author": "raiyni", "createdAt": "2020-03-05T04:36:15Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -70,9 +79,11 @@\n \tprivate Pattern autocompleteNamePattern;\n \n \t@Inject\n-\tprivate NameAutocompleter(@Nullable Client client)\n+\tprivate NameAutocompleter(@Nullable Client client, HiscoreConfig config)\n \t{\n \t\tthis.client = client;\n+\t\tthis.config = config;\n+\t\tsearchHistory.addAll(Text.fromCSV(config.searchHistory()));", "originalCommit": "0e69821cd2a88ab26ae2ead7d1008928aedcf3ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE3Mzc1MQ==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r389173751", "bodyText": "Irrelevant now with persistence functionality removed", "author": "DSerp", "createdAt": "2020-03-06T22:25:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA3NDI0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyNTQ0NA==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r389225444", "body": "Make this a package-private-only getter:\r\n```suggestion\r\n\t@Getter(AccessLevel.PACKAGE)\r\n```", "bodyText": "Make this a package-private-only getter:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t@Getter\n          \n          \n            \n            \t@Getter(AccessLevel.PACKAGE)", "bodyHTML": "<p dir=\"auto\">Make this a package-private-only getter:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t<span class=\"pl-k\">@Getter</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t<span class=\"pl-k\">@Getter</span><span class=\"x x-first\">(</span><span class=\"pl-smi x\">AccessLevel</span><span class=\"pl-c1\"><span class=\"pl-k x\">.</span><span class=\"x\">PACKAGE</span></span><span class=\"x x-last\">)</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Nightfirecat", "createdAt": "2020-03-07T03:59:09Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/HiscorePlugin.java", "diffHunk": "@@ -89,6 +90,7 @@\n \tprivate HiscorePanel hiscorePanel;\n \n \t@Inject\n+\t@Getter", "originalCommit": "23689b1daaa8aa705e0da016f706a07f9b6c051f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyNzkwMQ==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r389227901", "body": "```suggestion\r\n\t\t// Search friends if previous searches weren't matched\r\n\t\tif (!autocompleteName.isPresent())\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tif (!autocompleteName.isPresent())\n          \n          \n            \n            \t\t// Search friends if previous searches weren't matched\n          \n          \n            \n            \t\tif (!autocompleteName.isPresent())", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"213\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t<span class=\"pl-k\">if</span> <span class=\"x x-first\">(</span><span class=\"pl-k x\">!</span><span class=\"x\">autocompleteName</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">isPresent())</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"213\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t<span class=\"pl-c\"><span class=\"pl-c x x-first\">//</span><span class=\"x x-last\"> Search friends </span>if <span class=\"x x-first x-last\">previous searches weren't matched</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"214\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t<span class=\"pl-k\">if</span> (<span class=\"pl-k\">!</span>autocompleteName<span class=\"pl-k\">.</span>isPresent())</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Nightfirecat", "createdAt": "2020-03-07T04:44:08Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/NameAutocompleter.java", "diffHunk": "@@ -191,15 +200,21 @@ private boolean findAutocompleteName(String nameStart)\n \n \t\tautocompleteName = Optional.empty();\n \n-\t\t// TODO: Search lookup history\n+\t\t// Search all previous successful queries\n+\t\tautocompleteName = searchHistory.stream()\n+\t\t\t.filter(n -> pattern.matcher(n).matches())\n+\t\t\t.findFirst();\n \n-\t\tNameableContainer<Friend> friendContainer = client.getFriendContainer();\n-\t\tif (friendContainer != null)\n+\t\tif (!autocompleteName.isPresent())", "originalCommit": "23689b1daaa8aa705e0da016f706a07f9b6c051f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyODMxOQ==", "url": "https://github.com/runelite/runelite/pull/10945#discussion_r389228319", "body": "This is no longer used and can be removed. (as can the HiscorePanelTest change)", "bodyText": "This is no longer used and can be removed. (as can the HiscorePanelTest change)", "bodyHTML": "<p dir=\"auto\">This is no longer used and can be removed. (as can the HiscorePanelTest change)</p>", "author": "Nightfirecat", "createdAt": "2020-03-07T04:52:48Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/hiscore/HiscoreConfig.java", "diffHunk": "@@ -85,4 +85,22 @@ default boolean bountylookup()\n \t{\n \t\treturn false;\n \t}\n-}\n\\ No newline at end of file\n+\n+\t@ConfigItem(\n+\t\tkeyName = \"searchHistory\",\n+\t\tname = \"\",\n+\t\tdescription = \"\",\n+\t\thidden = true\n+\t)\n+\tdefault String searchHistory()\n+\t{\n+\t\treturn \"\";\n+\t}\n+\n+\t@ConfigItem(\n+\t\tkeyName = \"searchHistory\",\n+\t\tname = \"\",\n+\t\tdescription = \"\"\n+\t)\n+\tvoid searchHistory(String searchHistory);", "originalCommit": "23689b1daaa8aa705e0da016f706a07f9b6c051f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "729d948040e20d06ecdf5ea2fde89300990e2024", "url": "https://github.com/runelite/runelite/commit/729d948040e20d06ecdf5ea2fde89300990e2024", "message": "hiscore panel: autocomplete recent search history\n\nCo-authored-by: Daniel <serpa88@hotmail.ca>", "committedDate": "2020-03-17T00:21:08Z", "type": "commit"}, {"oid": "729d948040e20d06ecdf5ea2fde89300990e2024", "url": "https://github.com/runelite/runelite/commit/729d948040e20d06ecdf5ea2fde89300990e2024", "message": "hiscore panel: autocomplete recent search history\n\nCo-authored-by: Daniel <serpa88@hotmail.ca>", "committedDate": "2020-03-17T00:21:08Z", "type": "forcePushed"}]}