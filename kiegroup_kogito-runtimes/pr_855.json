{"pr_number": 855, "pr_title": "FAI-214: add the execution ID as a header in the response", "pr_author": "kostola", "pr_createdAt": "2020-10-28T12:00:37Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/855", "timeline": [{"oid": "8efadb1613e9a04a2ae7654f578af237bd9cb34f", "url": "https://github.com/kiegroup/kogito-runtimes/commit/8efadb1613e9a04a2ae7654f578af237bd9cb34f", "message": "FAI-214: add the execution ID as a header in the response", "committedDate": "2020-10-28T11:48:04Z", "type": "commit"}, {"oid": "3f21d4b79c387783347e200812eae33602524c95", "url": "https://github.com/kiegroup/kogito-runtimes/commit/3f21d4b79c387783347e200812eae33602524c95", "message": "FAI-214: merge 'master' into 'FAI-214'", "committedDate": "2020-10-29T09:23:54Z", "type": "commit"}, {"oid": "5c94a3747b28b68e9de1c9b92f7f4c0d952a4b34", "url": "https://github.com/kiegroup/kogito-runtimes/commit/5c94a3747b28b68e9de1c9b92f7f4c0d952a4b34", "message": "FAI-214: cleaner code", "committedDate": "2020-10-29T10:52:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE5NDAyOA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/855#discussion_r514194028", "body": "I think you should swap these two lines and avoid to add `Metadata` to `rest.DMNResult`. This object is sent back to user and it should not contain other/external data\r\n```suggestion\r\n        enrichResponseHeaders(result);\r\n        org.kie.kogito.dmn.rest.DMNResult result = new org.kie.kogito.dmn.rest.DMNResult(\"$modelNamespace$\", \"$modelName$\", decision.evaluateAll(DMNJSONUtils.ctx(decision, $inputData$)));\r\n```", "bodyText": "I think you should swap these two lines and avoid to add Metadata to rest.DMNResult. This object is sent back to user and it should not contain other/external data\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    org.kie.kogito.dmn.rest.DMNResult result = new org.kie.kogito.dmn.rest.DMNResult(\"$modelNamespace$\", \"$modelName$\", decision.evaluateAll(DMNJSONUtils.ctx(decision, $inputData$)));\n          \n          \n            \n                    enrichResponseHeaders(result);\n          \n          \n            \n                    enrichResponseHeaders(result);\n          \n          \n            \n                    org.kie.kogito.dmn.rest.DMNResult result = new org.kie.kogito.dmn.rest.DMNResult(\"$modelNamespace$\", \"$modelName$\", decision.evaluateAll(DMNJSONUtils.ctx(decision, $inputData$)));", "bodyHTML": "<p dir=\"auto\">I think you should swap these two lines and avoid to add <code>Metadata</code> to <code>rest.DMNResult</code>. This object is sent back to user and it should not contain other/external data</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-smi\"><span class=\"x x-first\">org.kie.kogito.dmn.rest</span><span class=\"pl-k x\">.</span><span class=\"x\">DMNResult</span></span><span class=\"x\"> result </span><span class=\"pl-k x\">=</span><span class=\"x\"> </span><span class=\"pl-k x\">new</span><span class=\"x\"> </span><span class=\"pl-smi\"><span class=\"x\">org.kie.kogito.dmn.rest</span><span class=\"pl-k x\">.</span><span class=\"x\">DMNResult</span></span><span class=\"x\">(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">$modelNamespace$</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">, </span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">$modelName$</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">, decision</span><span class=\"pl-k x\">.</span><span class=\"x\">evaluateAll(</span><span class=\"pl-smi x\">DMNJSONUtils</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">ctx(decision, $inputData$))</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"x x-first x-last\">enrichResponseHeaders(</span>result);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"x x-first x-last\">enrichResponseHeaders(result</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-smi\"><span class=\"x x-first\">org.kie.kogito.dmn.rest</span><span class=\"pl-k x\">.</span><span class=\"x\">DMNResult</span></span><span class=\"x x-last\"> </span>result<span class=\"x x-first\"> </span><span class=\"pl-k x\">=</span><span class=\"x\"> </span><span class=\"pl-k x\">new</span><span class=\"x\"> </span><span class=\"pl-smi\"><span class=\"x\">org.kie.kogito.dmn.rest</span><span class=\"pl-k x\">.</span><span class=\"x\">DMNResult</span></span><span class=\"x\">(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">$modelNamespace$</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">, </span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">$modelName$</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">, decision</span><span class=\"pl-k x\">.</span><span class=\"x\">evaluateAll(</span><span class=\"pl-smi x\">DMNJSONUtils</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">ctx(decision, $inputData$))</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danielezonca", "createdAt": "2020-10-29T11:40:56Z", "path": "kogito-codegen/src/main/resources/class-templates/DecisionRestResourceTemplate.java", "diffHunk": "@@ -39,11 +33,12 @@\n     @io.swagger.v3.oas.annotations.responses.ApiResponse(content = @io.swagger.v3.oas.annotations.media.Content(mediaType = \"application/json\",schema = @io.swagger.v3.oas.annotations.media.Schema(ref = \"/dmnDefinitions.json#/definitions/OutputSet1\")))\n     public $outputType$ dmn($inputType$ variables) {\n         org.kie.kogito.decision.DecisionModel decision = application.decisionModels().getDecisionModel(\"$modelNamespace$\", \"$modelName$\");\n-        OutputSet outputSet = (OutputSet)StronglyTypedUtils.convertToOutputSet(variables, OutputSet.class);\n+        OutputSet outputSet = (OutputSet) StronglyTypedUtils.convertToOutputSet(variables, OutputSet.class);\n         org.kie.kogito.dmn.rest.DMNResult result = new org.kie.kogito.dmn.rest.DMNResult(\"$modelNamespace$\", \"$modelName$\", decision.evaluateAll(DMNJSONUtils.ctx(decision, $inputData$)));\n+        enrichResponseHeaders(result);", "originalCommit": "5c94a3747b28b68e9de1c9b92f7f4c0d952a4b34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIwNTkxNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/855#discussion_r514205915", "bodyText": "I like this as it would imply no modification to DMNResult implementations required \ud83d\udc4d\nOn other hand this just go to highlight there is no clear strategy for \"metadata\" handling on Kogito design", "author": "tarilabs", "createdAt": "2020-10-29T12:03:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE5NDAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIyNjk5Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/855#discussion_r514226996", "bodyText": "I removed that now...no need for it anymore with the latest changes \ud83d\udc4d", "author": "kostola", "createdAt": "2020-10-29T12:40:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE5NDAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE5NDUzMA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/855#discussion_r514194530", "body": "Why return a value that is not used?\r\n```suggestion\r\n    private void enrichResponseHeaders(DMNResult result) {\r\n```", "bodyText": "Why return a value that is not used?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private DMNResult enrichResponseHeaders(DMNResult result) {\n          \n          \n            \n                private void enrichResponseHeaders(DMNResult result) {", "bodyHTML": "<p dir=\"auto\">Why return a value that is not used?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi x x-first x-last\">DMNResult</span> enrichResponseHeaders(<span class=\"pl-smi\">DMNResult</span> result) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-k x x-first x-last\">void</span> enrichResponseHeaders(<span class=\"pl-smi\">DMNResult</span> result) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danielezonca", "createdAt": "2020-10-29T11:41:56Z", "path": "kogito-codegen/src/main/resources/class-templates/DecisionRestResourceTemplate.java", "diffHunk": "@@ -102,11 +94,18 @@ private Object extractSingletonDSIfSucceded(DMNResult result) {\n             throw new DMNEvaluationErrorException(result);\n         }\n     }\n-    \n-    private void enrichResponseHeaders(DMNResult result) {\n-        if (!result.getMessages().isEmpty()) {\n+\n+    private DMNResult enrichResponseHeaders(DMNResult result) {", "originalCommit": "5c94a3747b28b68e9de1c9b92f7f4c0d952a4b34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDIyNzIxNg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/855#discussion_r514227216", "bodyText": "It was a leftover from previous changes. Fixed now \ud83d\udc4d", "author": "kostola", "createdAt": "2020-10-29T12:41:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE5NDUzMA=="}], "type": "inlineReview"}, {"oid": "7f40be8bb761093e97feee2b49bd62344afae4a5", "url": "https://github.com/kiegroup/kogito-runtimes/commit/7f40be8bb761093e97feee2b49bd62344afae4a5", "message": "FAI-214: cleaner code pt.2", "committedDate": "2020-10-29T12:29:15Z", "type": "commit"}, {"oid": "0d7861812f146f63c0ecde63eb75d175b83f38a6", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0d7861812f146f63c0ecde63eb75d175b83f38a6", "message": "FAI-214: merge branch 'master' into 'FAI-214'", "committedDate": "2020-11-04T15:45:04Z", "type": "commit"}]}