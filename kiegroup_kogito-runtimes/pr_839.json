{"pr_number": 839, "pr_title": "KOGITO-3407 CloudEvent Kafka Publisher+Emitter (Spring Boot)", "pr_author": "evacchi", "pr_createdAt": "2020-10-20T13:09:25Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/839", "timeline": [{"oid": "4ae44a4c34ba208d040b3b5b35fbcd49de66a70a", "url": "https://github.com/kiegroup/kogito-runtimes/commit/4ae44a4c34ba208d040b3b5b35fbcd49de66a70a", "message": "KOGITO-3407 CloudEvent Kafka Publisher+Emitter (Spring Boot)", "committedDate": "2020-10-20T13:19:43Z", "type": "forcePushed"}, {"oid": "6906e1f9bc0cebe21f41181b4c716d64e794369c", "url": "https://github.com/kiegroup/kogito-runtimes/commit/6906e1f9bc0cebe21f41181b4c716d64e794369c", "message": "fix dependency", "committedDate": "2020-10-23T07:21:32Z", "type": "forcePushed"}, {"oid": "dacecc21daf517402548978d664561ed71919ffd", "url": "https://github.com/kiegroup/kogito-runtimes/commit/dacecc21daf517402548978d664561ed71919ffd", "message": "KOGITO-3407 CloudEvent Kafka Publisher+Emitter (Spring Boot)", "committedDate": "2020-10-27T13:11:22Z", "type": "forcePushed"}, {"oid": "950116bbeeea21209871051a17494f077e1d94e6", "url": "https://github.com/kiegroup/kogito-runtimes/commit/950116bbeeea21209871051a17494f077e1d94e6", "message": "KOGITO-3407 CloudEvent Kafka Publisher+Emitter (Spring Boot)", "committedDate": "2020-10-27T15:54:59Z", "type": "commit"}, {"oid": "950116bbeeea21209871051a17494f077e1d94e6", "url": "https://github.com/kiegroup/kogito-runtimes/commit/950116bbeeea21209871051a17494f077e1d94e6", "message": "KOGITO-3407 CloudEvent Kafka Publisher+Emitter (Spring Boot)", "committedDate": "2020-10-27T15:54:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2Mzg4Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513263886", "body": "To be removed?", "bodyText": "To be removed?", "bodyHTML": "<p dir=\"auto\">To be removed?</p>", "author": "danielezonca", "createdAt": "2020-10-28T08:38:54Z", "path": "kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java", "diffHunk": "@@ -6,27 +6,29 @@\n import org.kie.kogito.process.Process;\n import org.kie.kogito.services.event.impl.AbstractMessageConsumer;\n \n+import org.reactivestreams.Publisher;\n+import reactor.core.publisher.Flux;\n+\n @org.springframework.stereotype.Component()\n public class $Type$MessageConsumer extends AbstractMessageConsumer<$Type$, $DataType$, $DataEventType$> {\n \n     @org.springframework.beans.factory.annotation.Autowired()\n     $Type$MessageConsumer(\n             Application application,\n             @org.springframework.beans.factory.annotation.Qualifier(\"$ProcessName$\") Process<$Type$> process,\n-            ConfigBean configBean\n-            /*,  @Qualified(\"kogito_event_publisher\") Publisher<String> eventPublisher */) {\n+            ConfigBean configBean,\n+            @org.springframework.beans.factory.annotation.Qualifier(\"kogito_event_publisher\") Publisher<String> eventPublisher) {\n         super(application,\n               process,\n               $DataType$.class,\n               $DataEventType$.class,\n               \"$Trigger$\",\n               new DefaultEventConsumerFactory(),\n               configBean.useCloudEvents());\n-    }\n \n-    @org.springframework.kafka.annotation.KafkaListener(topics = \"$Trigger$\")\n-    public void consume(String payload) {\n-        super.consume(payload);\n+        Flux.from(eventPublisher)\n+            .log()", "originalCommit": "950116bbeeea21209871051a17494f077e1d94e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQwNDI2OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513404268", "bodyText": "+1 to remove, or at least map the log explicitly as a debug.", "author": "tiagodolphine", "createdAt": "2020-10-28T12:31:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2Mzg4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "changed_code": [{"header": "diff --git a/kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java b/kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java\nindex 1143059c99..4f49baf723 100644\n--- a/kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java\n+++ b/kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java\n", "chunk": "@@ -27,8 +27,7 @@ public class $Type$MessageConsumer extends AbstractMessageConsumer<$Type$, $Data\n               configBean.useCloudEvents());\n \n         Flux.from(eventPublisher)\n-            .log()\n-            .subscribe(this::consume);\n+                .subscribe(this::consume);\n     }\n \n     protected $Type$ eventToModel($DataType$ event) {\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2NTYyMQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513265621", "body": "Shouldn't we check the result and log the error (if any)?", "bodyText": "Shouldn't we check the result and log the error (if any)?", "bodyHTML": "<p dir=\"auto\">Shouldn't we check the result and log the error (if any)?</p>", "author": "danielezonca", "createdAt": "2020-10-28T08:41:54Z", "path": "addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java", "diffHunk": "@@ -21,23 +21,30 @@\n \n import org.kie.kogito.services.event.CloudEventEmitter;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n import org.springframework.stereotype.Component;\n \n /**\n  * Spring implementation delegating to kafka template\n- * TODO proper error handling https://issues.redhat.com/browse/KOGITO-3408\n  */\n @Component\n public class SpringKafkaCloudEventEmitter implements CloudEventEmitter {\n+\n     @Autowired\n     org.springframework.kafka.core.KafkaTemplate<String, String> emitter;\n+    @Value(value = \"${spring.kafka.bootstrap-servers}\")\n+    String kafkaBootstrapAddress;\n+    @Value(value = \"${kogito.addon.cloudevents.kafka.kogito_outgoing_stream:kogito_outgoing_stream}\")\n+    String kafkaTopicName;\n \n     public CompletionStage<Void> emit(String e) {\n-        return emitter.send(\"kogito_outgoing_stream\", e)\n+        return emitter.send(kafkaTopicName, e)\n                 .completable()\n-                .thenRun(() -> {}); // discard return to comply with the signature\n+                .thenRun(() -> {\n+                }); // discard return to comply with the signature", "originalCommit": "950116bbeeea21209871051a17494f077e1d94e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQwNDQyMg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513404422", "bodyText": "I think the completable() method does something already with the failed future, I will check", "author": "evacchi", "createdAt": "2020-10-28T12:31:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2NTYyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU1NjA2MA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513556060", "bodyText": "I have added a log to AbstractMessageProducer. This just propagates the CompletableFuture (which may be completed exceptionally) and discards the return value to comply with the signature (I 100% agree we should not just throw this away, but let's at least make it work now)", "author": "evacchi", "createdAt": "2020-10-28T15:49:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI2NTYyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "changed_code": [{"header": "diff --git a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\nindex 3c530dbe71..ad4cc4a5ad 100644\n--- a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n+++ b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n", "chunk": "@@ -34,14 +35,13 @@ public class SpringKafkaCloudEventEmitter implements CloudEventEmitter {\n     org.springframework.kafka.core.KafkaTemplate<String, String> emitter;\n     @Value(value = \"${spring.kafka.bootstrap-servers}\")\n     String kafkaBootstrapAddress;\n-    @Value(value = \"${kogito.addon.cloudevents.kafka.kogito_outgoing_stream:kogito_outgoing_stream}\")\n+    @Value(value = \"${kogito.addon.cloudevents.kafka.\" + KogitoEventStreams.OUTGOING + \":\" + KogitoEventStreams.OUTGOING + \"}\")\n     String kafkaTopicName;\n \n     public CompletionStage<Void> emit(String e) {\n         return emitter.send(kafkaTopicName, e)\n                 .completable()\n-                .thenRun(() -> {\n-                }); // discard return to comply with the signature\n+                .thenApply(r -> null); // discard return to comply with the signature\n     }\n \n     @Deprecated\n", "next_change": {"commit": "192366d0c2bfead82931e57e0745ced916ad08dc", "changed_code": [{"header": "diff --git a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\nindex ad4cc4a5ad..5cfe27ecfd 100644\n--- a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n+++ b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n", "chunk": "@@ -44,8 +44,4 @@ public class SpringKafkaCloudEventEmitter implements CloudEventEmitter {\n                 .thenApply(r -> null); // discard return to comply with the signature\n     }\n \n-    @Deprecated\n-    public void emit(String topic, String message) {\n-        emitter.send(topic, message);\n-    }\n }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM4MjM5Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513382393", "body": "What do you mean with _demo_?", "bodyText": "What do you mean with demo?", "bodyHTML": "<p dir=\"auto\">What do you mean with <em>demo</em>?</p>", "author": "danielezonca", "createdAt": "2020-10-28T11:52:14Z", "path": "addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventPublisher.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+\n+package org.kie.kogito.addon.cloudevents.spring;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.apache.kafka.clients.consumer.ConsumerConfig;\n+import org.apache.kafka.common.serialization.StringDeserializer;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.stereotype.Component;\n+import reactor.core.publisher.Flux;\n+import reactor.kafka.receiver.KafkaReceiver;\n+import reactor.kafka.receiver.ReceiverOffset;\n+import reactor.kafka.receiver.ReceiverOptions;\n+import reactor.kafka.receiver.ReceiverRecord;\n+\n+@Component\n+public class SpringKafkaCloudEventPublisher {\n+\n+    private static final Logger log = LoggerFactory.getLogger(SpringKafkaCloudEventPublisher.class.getName());\n+\n+    private final ReceiverOptions<Integer, String> receiverOptions;\n+    private final SimpleDateFormat dateFormat;\n+\n+    private final String topic;\n+\n+    public SpringKafkaCloudEventPublisher(\n+            @Value(value = \"${spring.kafka.bootstrap-servers}\") String kafkaBootstrapAddress,\n+            @Value(value = \"${spring.kafka.consumer.group-id}\") String groupId,\n+            @Value(value = \"${kogito.addon.cloudevents.kafka.kogito_incoming_stream:kogito_incoming_stream}\") String kafkaTopicName) {\n+        this.topic = kafkaTopicName;\n+\n+        Map<String, Object> props = new HashMap<>();\n+        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaBootstrapAddress);\n+        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n+        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n+        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n+        receiverOptions = ReceiverOptions.create(props);\n+        dateFormat = new SimpleDateFormat(\"HH:mm:ss:SSS z dd MMM yyyy\");\n+    }\n+\n+    @Bean\n+    @Qualifier(\"kogito_event_publisher\")\n+    public Flux<String> convert_to_demo_topic() {", "originalCommit": "950116bbeeea21209871051a17494f077e1d94e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5NzM5MA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513397390", "bodyText": "and I think it would be better using camelCase for the method name, and something indicating you are creating a bean, that would be similar to the @Producer on CDI.", "author": "tiagodolphine", "createdAt": "2020-10-28T12:19:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM4MjM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQwNDExMw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513404113", "bodyText": "\ud83d\ude05 copy paste", "author": "evacchi", "createdAt": "2020-10-28T12:30:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM4MjM5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "changed_code": [{"header": "diff --git a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventPublisher.java b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventPublisher.java\nindex b179be4293..3ea0a9f844 100644\n--- a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventPublisher.java\n+++ b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventPublisher.java\n", "chunk": "@@ -63,12 +64,8 @@ public class SpringKafkaCloudEventPublisher {\n     }\n \n     @Bean\n-    @Qualifier(\"kogito_event_publisher\")\n-    public Flux<String> convert_to_demo_topic() {\n-        return makeConsumer();\n-    }\n-\n-    private Flux<String> makeConsumer() {\n+    @Qualifier(KogitoEventStreams.PUBLISHER)\n+    public Flux<String> makeConsumer() {\n         ReceiverOptions<Integer, String> options = receiverOptions.subscription(Collections.singleton(topic))\n                 .addAssignListener(partitions -> log.debug(\"onPartitionsAssigned {}\", partitions))\n                 .addRevokeListener(partitions -> log.debug(\"onPartitionsRevoked {}\", partitions));\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM5NDg4OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513394888", "body": "I think using `.thenApply(() -> null)` would be better, because it would be similar to `.map(...)`", "bodyText": "I think using .thenApply(() -> null) would be better, because it would be similar to .map(...)", "bodyHTML": "<p dir=\"auto\">I think using <code>.thenApply(() -&gt; null)</code> would be better, because it would be similar to <code>.map(...)</code></p>", "author": "tiagodolphine", "createdAt": "2020-10-28T12:14:41Z", "path": "addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java", "diffHunk": "@@ -21,23 +21,30 @@\n \n import org.kie.kogito.services.event.CloudEventEmitter;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n import org.springframework.stereotype.Component;\n \n /**\n  * Spring implementation delegating to kafka template\n- * TODO proper error handling https://issues.redhat.com/browse/KOGITO-3408\n  */\n @Component\n public class SpringKafkaCloudEventEmitter implements CloudEventEmitter {\n+\n     @Autowired\n     org.springframework.kafka.core.KafkaTemplate<String, String> emitter;\n+    @Value(value = \"${spring.kafka.bootstrap-servers}\")\n+    String kafkaBootstrapAddress;\n+    @Value(value = \"${kogito.addon.cloudevents.kafka.kogito_outgoing_stream:kogito_outgoing_stream}\")\n+    String kafkaTopicName;\n \n     public CompletionStage<Void> emit(String e) {\n-        return emitter.send(\"kogito_outgoing_stream\", e)\n+        return emitter.send(kafkaTopicName, e)\n                 .completable()\n-                .thenRun(() -> {}); // discard return to comply with the signature\n+                .thenRun(() -> {", "originalCommit": "950116bbeeea21209871051a17494f077e1d94e6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "changed_code": [{"header": "diff --git a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\nindex 3c530dbe71..ad4cc4a5ad 100644\n--- a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n+++ b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n", "chunk": "@@ -34,14 +35,13 @@ public class SpringKafkaCloudEventEmitter implements CloudEventEmitter {\n     org.springframework.kafka.core.KafkaTemplate<String, String> emitter;\n     @Value(value = \"${spring.kafka.bootstrap-servers}\")\n     String kafkaBootstrapAddress;\n-    @Value(value = \"${kogito.addon.cloudevents.kafka.kogito_outgoing_stream:kogito_outgoing_stream}\")\n+    @Value(value = \"${kogito.addon.cloudevents.kafka.\" + KogitoEventStreams.OUTGOING + \":\" + KogitoEventStreams.OUTGOING + \"}\")\n     String kafkaTopicName;\n \n     public CompletionStage<Void> emit(String e) {\n         return emitter.send(kafkaTopicName, e)\n                 .completable()\n-                .thenRun(() -> {\n-                }); // discard return to comply with the signature\n+                .thenApply(r -> null); // discard return to comply with the signature\n     }\n \n     @Deprecated\n", "next_change": {"commit": "192366d0c2bfead82931e57e0745ced916ad08dc", "changed_code": [{"header": "diff --git a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\nindex ad4cc4a5ad..5cfe27ecfd 100644\n--- a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n+++ b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n", "chunk": "@@ -44,8 +44,4 @@ public class SpringKafkaCloudEventEmitter implements CloudEventEmitter {\n                 .thenApply(r -> null); // discard return to comply with the signature\n     }\n \n-    @Deprecated\n-    public void emit(String topic, String message) {\n-        emitter.send(topic, message);\n-    }\n }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQwMDc0NQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513400745", "body": "we could revisit this in the future, but in some way, we should give the flexibility to let the consumer ack the received message, like after executing some computation successfully or whatever, and not ack in case of failure, this would the same for quarkus approach.. anyway just a comment for us to think as a future improvement.", "bodyText": "we could revisit this in the future, but in some way, we should give the flexibility to let the consumer ack the received message, like after executing some computation successfully or whatever, and not ack in case of failure, this would the same for quarkus approach.. anyway just a comment for us to think as a future improvement.", "bodyHTML": "<p dir=\"auto\">we could revisit this in the future, but in some way, we should give the flexibility to let the consumer ack the received message, like after executing some computation successfully or whatever, and not ack in case of failure, this would the same for quarkus approach.. anyway just a comment for us to think as a future improvement.</p>", "author": "tiagodolphine", "createdAt": "2020-10-28T12:25:03Z", "path": "addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventPublisher.java", "diffHunk": "@@ -0,0 +1,90 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+\n+package org.kie.kogito.addon.cloudevents.spring;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.apache.kafka.clients.consumer.ConsumerConfig;\n+import org.apache.kafka.common.serialization.StringDeserializer;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.stereotype.Component;\n+import reactor.core.publisher.Flux;\n+import reactor.kafka.receiver.KafkaReceiver;\n+import reactor.kafka.receiver.ReceiverOffset;\n+import reactor.kafka.receiver.ReceiverOptions;\n+import reactor.kafka.receiver.ReceiverRecord;\n+\n+@Component\n+public class SpringKafkaCloudEventPublisher {\n+\n+    private static final Logger log = LoggerFactory.getLogger(SpringKafkaCloudEventPublisher.class.getName());\n+\n+    private final ReceiverOptions<Integer, String> receiverOptions;\n+    private final SimpleDateFormat dateFormat;\n+\n+    private final String topic;\n+\n+    public SpringKafkaCloudEventPublisher(\n+            @Value(value = \"${spring.kafka.bootstrap-servers}\") String kafkaBootstrapAddress,\n+            @Value(value = \"${spring.kafka.consumer.group-id}\") String groupId,\n+            @Value(value = \"${kogito.addon.cloudevents.kafka.kogito_incoming_stream:kogito_incoming_stream}\") String kafkaTopicName) {\n+        this.topic = kafkaTopicName;\n+\n+        Map<String, Object> props = new HashMap<>();\n+        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaBootstrapAddress);\n+        props.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);\n+        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n+        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);\n+        receiverOptions = ReceiverOptions.create(props);\n+        dateFormat = new SimpleDateFormat(\"HH:mm:ss:SSS z dd MMM yyyy\");\n+    }\n+\n+    @Bean\n+    @Qualifier(\"kogito_event_publisher\")\n+    public Flux<String> convert_to_demo_topic() {\n+        return makeConsumer();\n+    }\n+\n+    private Flux<String> makeConsumer() {\n+        ReceiverOptions<Integer, String> options = receiverOptions.subscription(Collections.singleton(topic))\n+                .addAssignListener(partitions -> log.debug(\"onPartitionsAssigned {}\", partitions))\n+                .addRevokeListener(partitions -> log.debug(\"onPartitionsRevoked {}\", partitions));\n+        Flux<ReceiverRecord<Integer, String>> kafkaFlux = KafkaReceiver.create(options).receive();\n+\n+        return kafkaFlux.map(record -> {\n+            ReceiverOffset offset = record.receiverOffset();\n+            log.debug(\"Received message: topic-partition={} offset={} timestamp={} key={} value={}\\n\",\n+                      offset.topicPartition(),\n+                      offset.offset(),\n+                      dateFormat.format(new Date(record.timestamp())),\n+                      record.key(),\n+                      record.value());\n+            offset.acknowledge();", "originalCommit": "950116bbeeea21209871051a17494f077e1d94e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2NjY5Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513466693", "bodyText": "yes, good point", "author": "evacchi", "createdAt": "2020-10-28T14:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQwMDc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA2MzMyNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r514063325", "bodyText": "filed https://issues.redhat.com/browse/KOGITO-3733", "author": "evacchi", "createdAt": "2020-10-29T07:54:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQwMDc0NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQwMzU4Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513403583", "body": "what about using a constant for `\"kogito_event_publisher\"` to centralize the name, in this way it would be easier to change if necessary in the future.", "bodyText": "what about using a constant for \"kogito_event_publisher\" to centralize the name, in this way it would be easier to change if necessary in the future.", "bodyHTML": "<p dir=\"auto\">what about using a constant for <code>\"kogito_event_publisher\"</code> to centralize the name, in this way it would be easier to change if necessary in the future.</p>", "author": "tiagodolphine", "createdAt": "2020-10-28T12:29:59Z", "path": "kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java", "diffHunk": "@@ -6,27 +6,29 @@\n import org.kie.kogito.process.Process;\n import org.kie.kogito.services.event.impl.AbstractMessageConsumer;\n \n+import org.reactivestreams.Publisher;\n+import reactor.core.publisher.Flux;\n+\n @org.springframework.stereotype.Component()\n public class $Type$MessageConsumer extends AbstractMessageConsumer<$Type$, $DataType$, $DataEventType$> {\n \n     @org.springframework.beans.factory.annotation.Autowired()\n     $Type$MessageConsumer(\n             Application application,\n             @org.springframework.beans.factory.annotation.Qualifier(\"$ProcessName$\") Process<$Type$> process,\n-            ConfigBean configBean\n-            /*,  @Qualified(\"kogito_event_publisher\") Publisher<String> eventPublisher */) {\n+            ConfigBean configBean,\n+            @org.springframework.beans.factory.annotation.Qualifier(\"kogito_event_publisher\") Publisher<String> eventPublisher) {", "originalCommit": "950116bbeeea21209871051a17494f077e1d94e6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "changed_code": [{"header": "diff --git a/kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java b/kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java\nindex 1143059c99..4f49baf723 100644\n--- a/kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java\n+++ b/kogito-codegen/src/main/resources/class-templates/SpringMessageConsumerTemplate.java\n", "chunk": "@@ -17,7 +17,7 @@ public class $Type$MessageConsumer extends AbstractMessageConsumer<$Type$, $Data\n             Application application,\n             @org.springframework.beans.factory.annotation.Qualifier(\"$ProcessName$\") Process<$Type$> process,\n             ConfigBean configBean,\n-            @org.springframework.beans.factory.annotation.Qualifier(\"kogito_event_publisher\") Publisher<String> eventPublisher) {\n+            @org.springframework.beans.factory.annotation.Qualifier(KogitoEventStreams.PUBLISHER) Publisher<String> eventPublisher) {\n         super(application,\n               process,\n               $DataType$.class,\n", "next_change": null}]}}, {"oid": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "url": "https://github.com/kiegroup/kogito-runtimes/commit/a08407c1af4aeabf5e8513d15f1578d461168cc0", "message": "apply suggestions", "committedDate": "2020-10-28T15:52:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0MDA1NA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r513840054", "body": "@evacchi Im just afraid that we end up limiting the options that can be tweaked for the receiver with this new approach. Having in the application.properties in a way that all kafka properties could be used allows great flexibility.\r\n@MarianMacik have you had to tweak these in your tests? Just wondering as an example about how this is important.", "bodyText": "@evacchi Im just afraid that we end up limiting the options that can be tweaked for the receiver with this new approach. Having in the application.properties in a way that all kafka properties could be used allows great flexibility.\n@MarianMacik have you had to tweak these in your tests? Just wondering as an example about how this is important.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/evacchi/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/evacchi\">@evacchi</a> Im just afraid that we end up limiting the options that can be tweaked for the receiver with this new approach. Having in the application.properties in a way that all kafka properties could be used allows great flexibility.<br>\n<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/MarianMacik/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/MarianMacik\">@MarianMacik</a> have you had to tweak these in your tests? Just wondering as an example about how this is important.</p>", "author": "cristianonicolai", "createdAt": "2020-10-29T00:30:10Z", "path": "addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventPublisher.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+\n+package org.kie.kogito.addon.cloudevents.spring;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Collections;\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import org.apache.kafka.clients.consumer.ConsumerConfig;\n+import org.apache.kafka.common.serialization.StringDeserializer;\n+import org.kie.kogito.event.KogitoEventStreams;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.stereotype.Component;\n+import reactor.core.publisher.Flux;\n+import reactor.kafka.receiver.KafkaReceiver;\n+import reactor.kafka.receiver.ReceiverOffset;\n+import reactor.kafka.receiver.ReceiverOptions;\n+import reactor.kafka.receiver.ReceiverRecord;\n+\n+@Component\n+public class SpringKafkaCloudEventPublisher {\n+\n+    private static final Logger log = LoggerFactory.getLogger(SpringKafkaCloudEventPublisher.class.getName());\n+\n+    private final ReceiverOptions<Integer, String> receiverOptions;\n+    private final SimpleDateFormat dateFormat;\n+\n+    private final String topic;\n+\n+    public SpringKafkaCloudEventPublisher(\n+            @Value(value = \"${spring.kafka.bootstrap-servers}\") String kafkaBootstrapAddress,\n+            @Value(value = \"${spring.kafka.consumer.group-id}\") String groupId,\n+            @Value(value = \"${kogito.addon.cloudevents.kafka.\" + KogitoEventStreams.INCOMING + \":\" + KogitoEventStreams.INCOMING + \"}\") String kafkaTopicName) {\n+        this.topic = kafkaTopicName;\n+\n+        Map<String, Object> props = new HashMap<>();\n+        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaBootstrapAddress);", "originalCommit": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA2MTg2Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r514061866", "bodyText": "not sure what you mean. this is mapped to application.properties, and the config option is the same that is used by the \"plain\" spring boot kafka connector. If you mean having different kafkas for each topic then AFAIK this worked the same even before this PR (only 1 broker)", "author": "evacchi", "createdAt": "2020-10-29T07:51:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0MDA1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNjY1MA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r514636650", "bodyText": "@evacchi my point is about setting up the consumer config properties. Kafka exposes a set of other configurations, not only the groupid and bootstrap server as used in here. See https://kafka.apache.org/documentation/#consumerconfigs\nMy concern is that in some situation, these properties will need to be tweaked, and I think we would allow that with this new approach.", "author": "cristianonicolai", "createdAt": "2020-10-30T00:09:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0MDA1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU5MDQwNg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r516590406", "bodyText": "Sorry, just read it now. Not sure about the cloud events here (I guess something Kafka-related), but there are properties which may need to be tweaked theoretically. So do I get it right that this consumes events from external kafka but then publishes them in something called Kogito Event Streams, i.e. in Kogito ecosystem? Hence the name of the class ending in Publisher I guess....", "author": "MarianMacik", "createdAt": "2020-11-03T11:13:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0MDA1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY2NzYyNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r516667625", "bodyText": "@cristianonicolai ^^", "author": "MarianMacik", "createdAt": "2020-11-03T13:32:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0MDA1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjczMTY1Mg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r516731652", "bodyText": "I have created https://issues.redhat.com/browse/KOGITO-3760 because we can probably reuse the reactive template, which supports standard spring config while retaining the nonblocking API", "author": "evacchi", "createdAt": "2020-11-03T15:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0MDA1NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA3NDQ2NQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r514074465", "body": "```suggestion\r\n        logger.debug(\"Received: {} on thread {}\", payload, Thread.currentThread().getName());\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    logger.info(\"Received: {} on thread {}\", payload, Thread.currentThread().getName());\n          \n          \n            \n                    logger.debug(\"Received: {} on thread {}\", payload, Thread.currentThread().getName());", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        logger<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">info</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Received: {} on thread {}<span class=\"pl-pds\">\"</span></span>, payload, <span class=\"pl-smi\">Thread</span><span class=\"pl-k\">.</span>currentThread()<span class=\"pl-k\">.</span>getName());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        logger<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">debug</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Received: {} on thread {}<span class=\"pl-pds\">\"</span></span>, payload, <span class=\"pl-smi\">Thread</span><span class=\"pl-k\">.</span>currentThread()<span class=\"pl-k\">.</span>getName());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danielezonca", "createdAt": "2020-10-29T08:17:08Z", "path": "api/kogito-services/src/main/java/org/kie/kogito/services/event/impl/AbstractMessageConsumer.java", "diffHunk": "@@ -82,6 +82,7 @@ public void setParams(\n     }\n \n     public void consume(String payload) {\n+        logger.info(\"Received: {} on thread {}\", payload, Thread.currentThread().getName());", "originalCommit": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "39aab28ba24693bee63561f65bd0297a6c877804", "changed_code": [{"header": "diff --git a/api/kogito-services/src/main/java/org/kie/kogito/services/event/impl/AbstractMessageConsumer.java b/api/kogito-services/src/main/java/org/kie/kogito/services/event/impl/AbstractMessageConsumer.java\nindex 57069b0428..4e40838212 100644\n--- a/api/kogito-services/src/main/java/org/kie/kogito/services/event/impl/AbstractMessageConsumer.java\n+++ b/api/kogito-services/src/main/java/org/kie/kogito/services/event/impl/AbstractMessageConsumer.java\n", "chunk": "@@ -82,7 +82,7 @@ public abstract class AbstractMessageConsumer<M extends Model, D, T extends Abst\n     }\n \n     public void consume(String payload) {\n-        logger.info(\"Received: {} on thread {}\", payload, Thread.currentThread().getName());\n+        logger.debug(\"Received: {} on thread {}\", payload, Thread.currentThread().getName());\n         eventConsumerFactory.get(this::eventToModel, dataEventClass, cloudEventClass, useCloudEvents)\n                 .consume(application, (Process<Model>) process, payload, trigger);\n     }\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA3NTcyNg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/839#discussion_r514075726", "body": "Ticket to remove this method?", "bodyText": "Ticket to remove this method?", "bodyHTML": "<p dir=\"auto\">Ticket to remove this method?</p>", "author": "danielezonca", "createdAt": "2020-10-29T08:19:20Z", "path": "addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java", "diffHunk": "@@ -19,25 +19,32 @@\n \n import java.util.concurrent.CompletionStage;\n \n+import org.kie.kogito.event.KogitoEventStreams;\n import org.kie.kogito.services.event.CloudEventEmitter;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n import org.springframework.stereotype.Component;\n \n /**\n  * Spring implementation delegating to kafka template\n- * TODO proper error handling https://issues.redhat.com/browse/KOGITO-3408\n  */\n @Component\n public class SpringKafkaCloudEventEmitter implements CloudEventEmitter {\n+\n     @Autowired\n     org.springframework.kafka.core.KafkaTemplate<String, String> emitter;\n+    @Value(value = \"${spring.kafka.bootstrap-servers}\")\n+    String kafkaBootstrapAddress;\n+    @Value(value = \"${kogito.addon.cloudevents.kafka.\" + KogitoEventStreams.OUTGOING + \":\" + KogitoEventStreams.OUTGOING + \"}\")\n+    String kafkaTopicName;\n \n     public CompletionStage<Void> emit(String e) {\n-        return emitter.send(\"kogito_outgoing_stream\", e)\n+        return emitter.send(kafkaTopicName, e)\n                 .completable()\n-                .thenRun(() -> {}); // discard return to comply with the signature\n+                .thenApply(r -> null); // discard return to comply with the signature\n     }\n \n+    @Deprecated", "originalCommit": "a08407c1af4aeabf5e8513d15f1578d461168cc0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "192366d0c2bfead82931e57e0745ced916ad08dc", "changed_code": [{"header": "diff --git a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\nindex ad4cc4a5ad..5cfe27ecfd 100644\n--- a/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n+++ b/addons/cloudevents/cloudevents-spring-boot-addon/src/main/java/org/kie/kogito/addon/cloudevents/spring/SpringKafkaCloudEventEmitter.java\n", "chunk": "@@ -44,8 +44,4 @@ public class SpringKafkaCloudEventEmitter implements CloudEventEmitter {\n                 .thenApply(r -> null); // discard return to comply with the signature\n     }\n \n-    @Deprecated\n-    public void emit(String topic, String message) {\n-        emitter.send(topic, message);\n-    }\n }\n", "next_change": null}]}}, {"oid": "39aab28ba24693bee63561f65bd0297a6c877804", "url": "https://github.com/kiegroup/kogito-runtimes/commit/39aab28ba24693bee63561f65bd0297a6c877804", "message": "debug log", "committedDate": "2020-10-29T10:55:56Z", "type": "commit"}, {"oid": "192366d0c2bfead82931e57e0745ced916ad08dc", "url": "https://github.com/kiegroup/kogito-runtimes/commit/192366d0c2bfead82931e57e0745ced916ad08dc", "message": "cloud event emitter: remove deprecated method", "committedDate": "2020-10-29T10:56:14Z", "type": "commit"}]}