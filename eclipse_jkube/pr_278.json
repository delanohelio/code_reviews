{"pr_number": 278, "pr_title": "fix: Properly define + document JKubeProjectAssembly behavior", "pr_author": "manusa", "pr_createdAt": "2020-07-03T15:55:02Z", "pr_url": "https://github.com/eclipse/jkube/pull/278", "timeline": [{"oid": "047bffae93f410c5017f930fa69c1f4eb7fcf222", "url": "https://github.com/eclipse/jkube/commit/047bffae93f410c5017f930fa69c1f4eb7fcf222", "message": "WIP: TODO, fix documentation, check rest of examples\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-03T16:03:49Z", "type": "forcePushed"}, {"oid": "51332fc1b23556b00f18047b8878ec79277e9178", "url": "https://github.com/eclipse/jkube/commit/51332fc1b23556b00f18047b8878ec79277e9178", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-06T13:49:49Z", "type": "forcePushed"}, {"oid": "ef8de0095fbcc3bf96ba2bb2756dbdc35c246596", "url": "https://github.com/eclipse/jkube/commit/ef8de0095fbcc3bf96ba2bb2756dbdc35c246596", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-06T15:10:09Z", "type": "forcePushed"}, {"oid": "4fb2b13b18cc9c5f26e102a85ec8ad756dd8c600", "url": "https://github.com/eclipse/jkube/commit/4fb2b13b18cc9c5f26e102a85ec8ad756dd8c600", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-06T15:12:43Z", "type": "forcePushed"}, {"oid": "b1990afa96db340124e6f3d54ee18975acf6a5df", "url": "https://github.com/eclipse/jkube/commit/b1990afa96db340124e6f3d54ee18975acf6a5df", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-06T15:30:43Z", "type": "forcePushed"}, {"oid": "71f6c1d0c1706b9e4f888078f620ceb75521e47b", "url": "https://github.com/eclipse/jkube/commit/71f6c1d0c1706b9e4f888078f620ceb75521e47b", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-08T11:46:33Z", "type": "forcePushed"}, {"oid": "0158f25a46284d5253860d671f27caa4b773e964", "url": "https://github.com/eclipse/jkube/commit/0158f25a46284d5253860d671f27caa4b773e964", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-08T12:53:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY3Nzk5MQ==", "url": "https://github.com/eclipse/jkube/pull/278#discussion_r452677991", "body": "```suggestion\r\n                \" dependencies for your application to run.\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \" dependencies for you application to run.\");\n          \n          \n            \n                            \" dependencies for your application to run.\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-s\"><span class=\"pl-pds\">\"</span> dependencies for <span class=\"x x-first x-last\">you</span> application to run.<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-s\"><span class=\"pl-pds\">\"</span> dependencies for <span class=\"x x-first x-last\">your</span> application to run.<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "rohanKanojia", "createdAt": "2020-07-10T07:43:20Z", "path": "jkube-kit/generator/java-exec/src/main/java/org/eclipse/jkube/generator/javaexec/JavaExecGenerator.java", "diffHunk": "@@ -173,21 +170,17 @@ protected AssemblyConfiguration createAssembly() {\n     }\n \n     protected void addAssembly(AssemblyConfiguration.AssemblyConfigurationBuilder builder) {\n-        String assemblyRef = getConfig(Config.assemblyRef);\n-        if (assemblyRef != null) {\n-            builder.descriptorRef(assemblyRef);\n-        } else {\n-            final List<AssemblyFileSet> fileSets = new ArrayList<>(addAdditionalFiles());\n-            if (isFatJar()) {\n-                FatJarDetector.Result fatJar = detectFatJar();\n-                if (fatJar != null) {\n-                    fileSets.add(getOutputDirectoryFileSet(fatJar, getProject()));\n-                }\n-            } else {\n-                builder.descriptorRef(\"artifact-with-dependencies\");\n+        final List<AssemblyFileSet> fileSets = new ArrayList<>(addAdditionalFiles());\n+        if (isFatJar()) {\n+            FatJarDetector.Result fatJar = detectFatJar();\n+            if (fatJar != null) {\n+                fileSets.add(getOutputDirectoryFileSet(fatJar, getProject()));\n             }\n-            builder.inline(Assembly.builder().fileSets(fileSets).build());\n+        } else {\n+            log.warn(\"No fat Jar detected, make sure your image assembly configuration contains all the required\" +\n+                \" dependencies for you application to run.\");", "originalCommit": "0158f25a46284d5253860d671f27caa4b773e964", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0ODU5Mg==", "url": "https://github.com/eclipse/jkube/pull/278#discussion_r452748592", "body": "```suggestion\r\n                \" dependencies for your application to run.\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \" dependencies for you application to run.\");\n          \n          \n            \n                            \" dependencies for your application to run.\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-s\"><span class=\"pl-pds\">\"</span> dependencies for <span class=\"x x-first x-last\">you</span> application to run.<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-s\"><span class=\"pl-pds\">\"</span> dependencies for <span class=\"x x-first x-last\">your</span> application to run.<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "rohanKanojia", "createdAt": "2020-07-10T10:01:07Z", "path": "jkube-kit/jkube-kit-openliberty/src/main/java/org/eclipse/jkube/openliberty/generator/OpenLibertyGenerator.java", "diffHunk": "@@ -70,26 +70,22 @@ public boolean isApplicable(List<ImageConfiguration> configs) {\n \n     @Override\n     protected void addAssembly(AssemblyConfiguration.AssemblyConfigurationBuilder builder) {\n-        String assemblyRef = getConfig(Config.assemblyRef);\n-        if (assemblyRef != null) {\n-            builder.descriptorRef(assemblyRef);\n-        } else {\n-            final List<AssemblyFileSet> fileSets = new ArrayList<>(addAdditionalFiles());\n-            if (isFatJar()) {\n-                FatJarDetector.Result fatJar = detectFatJar();\n-                JavaProject project = getProject();\n-                if (fatJar != null) {\n-                    AssemblyFileSet fileSet = getOutputDirectoryFileSet(fatJar, project);\n-                    if (LIBERTY_SELF_EXTRACTOR.equals(fatJar.getMainClass())) {\n-                        this.runnableJarName = fatJar.getArchiveFile().getName();\n-                    }\n-                    fileSets.add(fileSet);\n+        final List<AssemblyFileSet> fileSets = new ArrayList<>(addAdditionalFiles());\n+        if (isFatJar()) {\n+            FatJarDetector.Result fatJar = detectFatJar();\n+            JavaProject project = getProject();\n+            if (fatJar != null) {\n+                AssemblyFileSet fileSet = getOutputDirectoryFileSet(fatJar, project);\n+                if (LIBERTY_SELF_EXTRACTOR.equals(fatJar.getMainClass())) {\n+                    this.runnableJarName = fatJar.getArchiveFile().getName();\n                 }\n-            } else {\n-                builder.descriptorRef(\"artifact-with-dependencies\");\n+                fileSets.add(fileSet);\n             }\n-            builder.inline(Assembly.builder().fileSets(fileSets).build());\n+        } else {\n+            log.warn(\"No fat Jar detected, make sure your image assembly configuration contains all the required\" +\n+                \" dependencies for you application to run.\");", "originalCommit": "0158f25a46284d5253860d671f27caa4b773e964", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "498b54da91f570290b0b77c5aa3fa903235cccae", "url": "https://github.com/eclipse/jkube/commit/498b54da91f570290b0b77c5aa3fa903235cccae", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-10T12:54:59Z", "type": "forcePushed"}, {"oid": "6457ea07bc5f762f9f46f48075affa27d643026b", "url": "https://github.com/eclipse/jkube/commit/6457ea07bc5f762f9f46f48075affa27d643026b", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-10T13:24:17Z", "type": "commit"}, {"oid": "6457ea07bc5f762f9f46f48075affa27d643026b", "url": "https://github.com/eclipse/jkube/commit/6457ea07bc5f762f9f46f48075affa27d643026b", "message": "fix: Properly define + document JKubeProjectAssembly behavior\n\n- AssemblyFileSet supports wildcard includes and excludes\n- AssemblyFileSet contains default file and directory modes\n- Removed no longer working descriptor and descriptorRef configs from AssemblyFileSet\n- Removed unsupported assembly .xml descriptors\n- Removed outdated documentation\n- xml-config quickstart works as expected\n- Fixed *Controller*Enricher to support xml configured names (just like replicas or image pull policy)\n- Updated Assembly related documentation\n- Updated ibm-javaee8-webprofile-liberty example\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-07-10T13:24:17Z", "type": "forcePushed"}]}