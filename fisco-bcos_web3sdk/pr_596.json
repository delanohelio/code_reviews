{"pr_number": 596, "pr_title": "remove fastjson", "pr_author": "ywy2090", "pr_createdAt": "2020-06-09T08:17:44Z", "pr_url": "https://github.com/FISCO-BCOS/web3sdk/pull/596", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyMjAyOA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/596#discussion_r437222028", "body": "__[PMD Java]__ The class 'Account' is suspected to be a Data Class (WOC=0.000%, NOPA=0, NOAM=6, WMC=6) ([view](https://sider.review/gh/repos/113938008/pulls/596#issue-3948538))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| ---- | ------- | -------- |\n| `DataClass` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#dataclass>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/596#issue-3948538) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD Java] The class 'Account' is suspected to be a Data Class (WOC=0.000%, NOPA=0, NOAM=6, WMC=6) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataClass\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#dataclass\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD Java]</strong> The class 'Account' is suspected to be a Data Class (WOC=0.000%, NOPA=0, NOAM=6, WMC=6) (<a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948538\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>DataClass</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#dataclass\" rel=\"nofollow\">https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#dataclass</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948538\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-06-09T08:18:27Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -23,6 +23,36 @@\n \n     KeyInfo() {}\n \n+    private static class Account {", "originalCommit": "234622a33813d16f3f5783a7550f4a0911353fd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyMjAzMQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/596#discussion_r437222031", "body": "__[PMD Java]__ It is somewhat confusing to have a field name matching the declaring class name ([view](https://sider.review/gh/repos/113938008/pulls/596#issue-3948539))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| ---- | ------- | -------- |\n| `AvoidFieldNameMatchingTypeName` | Error Prone | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidfieldnamematchingtypename>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/596#issue-3948539) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD Java] It is somewhat confusing to have a field name matching the declaring class name (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidFieldNameMatchingTypeName\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidfieldnamematchingtypename\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD Java]</strong> It is somewhat confusing to have a field name matching the declaring class name (<a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948539\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>AvoidFieldNameMatchingTypeName</code></td>\n<td>Error Prone</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidfieldnamematchingtypename\" rel=\"nofollow\">https://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidfieldnamematchingtypename</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948539\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-06-09T08:18:27Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -23,6 +23,36 @@\n \n     KeyInfo() {}\n \n+    private static class Account {\n+        private String privateKey;\n+        private String publicKey;\n+        private String account;", "originalCommit": "234622a33813d16f3f5783a7550f4a0911353fd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyMjAzMg==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/596#discussion_r437222032", "body": "__[PMD Java]__ Potential violation of Law of Demeter (method chain calls) ([view](https://sider.review/gh/repos/113938008/pulls/596#issue-3948540))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| ---- | ------- | -------- |\n| `LawOfDemeter` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/596#issue-3948540) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD Java]</strong> Potential violation of Law of Demeter (method chain calls) (<a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948540\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>LawOfDemeter</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\" rel=\"nofollow\">https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948540\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-06-09T08:18:27Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -104,18 +134,13 @@ public int loadKeyInfo(String keyFile) {\n         System.out.println(\"\");\n         System.out.println(\"===key info:\" + keyInfoJsonStr);\n         try {\n-            JSONObject keyInfoJsonObj = JSONObject.parseObject(keyInfoJsonStr);\n-            if (keyInfoJsonObj == null) {\n-                System.out.println(\"load json str from key info failed\");\n-                logger.error(\"load json str from key info failed\");\n-                return RetCode.parseJsonFailed;\n-            }\n-            if (keyInfoJsonObj.containsKey(privJsonKey))\n-                privateKey = keyInfoJsonObj.getString(privJsonKey);\n-            if (keyInfoJsonObj.containsKey(pubJsonKey))\n-                publicKey = keyInfoJsonObj.getString(pubJsonKey);\n-            if (keyInfoJsonObj.containsKey(accountJsonKey))\n-                account = keyInfoJsonObj.getString(accountJsonKey);\n+            Account key =\n+                    ObjectMapperFactory.getObjectMapper().readValue(keyInfoJsonStr, Account.class);", "originalCommit": "234622a33813d16f3f5783a7550f4a0911353fd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyMjAzNA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/596#discussion_r437222034", "body": "__[PMD Java]__ Potential violation of Law of Demeter (method chain calls) ([view](https://sider.review/gh/repos/113938008/pulls/596#issue-3948541))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| ---- | ------- | -------- |\n| `LawOfDemeter` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/596#issue-3948541) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD Java]</strong> Potential violation of Law of Demeter (method chain calls) (<a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948541\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>LawOfDemeter</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\" rel=\"nofollow\">https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948541\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-06-09T08:18:27Z", "path": "src/main/java/org/fisco/bcos/web3j/crypto/gm/KeyInfo.java", "diffHunk": "@@ -159,13 +184,12 @@ private static int writeFile(String keyFile, String content) {\n     @Override\n     public int storeKeyInfo(String keyFile) {\n         try {\n-            // Map<String, String> keyMap = new HashMap<String, String>();\n-            JSONObject keyMapJson = new JSONObject();\n-            keyMapJson.put(privJsonKey, privateKey);\n-            keyMapJson.put(pubJsonKey, publicKey);\n-            keyMapJson.put(accountJsonKey, account);\n+            Account key = new Account();\n+            key.setPrivateKey(getPrivateKey());\n+            key.setPublicKey(getPublicKey());\n+            key.setAccount(getAccount());\n \n-            String keyJsonInfo = keyMapJson.toString();\n+            String keyJsonInfo = ObjectMapperFactory.getObjectMapper().writeValueAsString(key);", "originalCommit": "234622a33813d16f3f5783a7550f4a0911353fd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyMjAzNw==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/596#discussion_r437222037", "body": "__[PMD Java]__ The String literal \" invalid json, abi: {}, e: {} \" appears 4 times in this file; the first occurrence is on line 83 ([view](https://sider.review/gh/repos/113938008/pulls/596#issue-3948542))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| ---- | ------- | -------- |\n| `AvoidDuplicateLiterals` | Error Prone | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidduplicateliterals>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/596#issue-3948542) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD Java] The String literal \" invalid json, abi: {}, e: {} \" appears 4 times in this file; the first occurrence is on line 83 (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidDuplicateLiterals\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidduplicateliterals\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD Java]</strong> The String literal \" invalid json, abi: {}, e: {} \" appears 4 times in this file; the first occurrence is on line 83 (<a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948542\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>AvoidDuplicateLiterals</code></td>\n<td>Error Prone</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidduplicateliterals\" rel=\"nofollow\">https://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidduplicateliterals</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3948542\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-06-09T08:18:27Z", "path": "src/main/java/org/fisco/bcos/web3j/tx/txdecode/ContractAbiUtil.java", "diffHunk": "@@ -38,31 +44,45 @@\n      * @return\n      */\n     public static AbiDefinition getConstructorAbiDefinition(String contractAbi) {\n-        JSONArray abiArr = JSONArray.parseArray(contractAbi);\n-        AbiDefinition result = null;\n-        for (Object object : abiArr) {\n-            AbiDefinition abiDefinition = JSON.parseObject(object.toString(), AbiDefinition.class);\n-            if (TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n-                result = abiDefinition;\n-                break;\n+        try {\n+            ObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+            AbiDefinition[] abiDefinitions =\n+                    objectMapper.readValue(contractAbi, AbiDefinition[].class);\n+\n+            for (AbiDefinition abiDefinition : abiDefinitions) {\n+                if (TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n+                    return abiDefinition;\n+                }\n             }\n+        } catch (JsonProcessingException e) {\n+            logger.warn(\" invalid  json, abi: {}, e: {} \", contractAbi, e);\n+        } catch (IOException e) {\n+            logger.warn(\" invalid  json, abi: {}, e: {} \", contractAbi, e);\n         }\n-        return result;\n+        return null;\n     }\n \n     /**\n      * @param contractAbi\n      * @return\n      */\n     public static List<AbiDefinition> getFuncAbiDefinition(String contractAbi) {\n-        JSONArray abiArr = JSONArray.parseArray(contractAbi);\n         List<AbiDefinition> result = new ArrayList<>();\n-        for (Object object : abiArr) {\n-            AbiDefinition abiDefinition = JSON.parseObject(object.toString(), AbiDefinition.class);\n-            if (TYPE_FUNCTION.equals(abiDefinition.getType())\n-                    || TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n-                result.add(abiDefinition);\n+        try {\n+            ObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+            AbiDefinition[] abiDefinitions =\n+                    objectMapper.readValue(contractAbi, AbiDefinition[].class);\n+\n+            for (AbiDefinition abiDefinition : abiDefinitions) {\n+                if (TYPE_FUNCTION.equals(abiDefinition.getType())\n+                        || TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n+                    result.add(abiDefinition);\n+                }\n             }\n+        } catch (JsonProcessingException e) {\n+            logger.warn(\" invalid json, abi: {}, e: {} \", contractAbi, e);", "originalCommit": "234622a33813d16f3f5783a7550f4a0911353fd8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d93f2d163b2b5ca10d9c5021ff5136e881e0af42", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/d93f2d163b2b5ca10d9c5021ff5136e881e0af42", "message": "remove fastjson", "committedDate": "2020-06-09T16:06:14Z", "type": "commit"}, {"oid": "d93f2d163b2b5ca10d9c5021ff5136e881e0af42", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/d93f2d163b2b5ca10d9c5021ff5136e881e0af42", "message": "remove fastjson", "committedDate": "2020-06-09T16:06:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU1MTcyOQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/596#discussion_r437551729", "body": "__[PMD Java]__ Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block ([view](https://sider.review/gh/repos/113938008/pulls/596#issue-3951366))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| ---- | ------- | -------- |\n| `AvoidCatchingGenericException` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/596#issue-3951366) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD Java] Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidCatchingGenericException\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD Java]</strong> Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (<a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3951366\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>AvoidCatchingGenericException</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception\" rel=\"nofollow\">https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3951366\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-06-09T16:10:53Z", "path": "src/main/java/org/fisco/bcos/web3j/tx/txdecode/ContractAbiUtil.java", "diffHunk": "@@ -38,49 +42,68 @@\n      * @return\n      */\n     public static AbiDefinition getConstructorAbiDefinition(String contractAbi) {\n-        JSONArray abiArr = JSONArray.parseArray(contractAbi);\n-        AbiDefinition result = null;\n-        for (Object object : abiArr) {\n-            AbiDefinition abiDefinition = JSON.parseObject(object.toString(), AbiDefinition.class);\n-            if (TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n-                result = abiDefinition;\n-                break;\n+        try {\n+            ObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+            AbiDefinition[] abiDefinitions =\n+                    objectMapper.readValue(contractAbi, AbiDefinition[].class);\n+\n+            for (AbiDefinition abiDefinition : abiDefinitions) {\n+                if (TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n+                    return abiDefinition;\n+                }\n             }\n+        } catch (Exception e) {", "originalCommit": "d93f2d163b2b5ca10d9c5021ff5136e881e0af42", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU1MTczNw==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/596#discussion_r437551737", "body": "__[PMD Java]__ Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block ([view](https://sider.review/gh/repos/113938008/pulls/596#issue-3951367))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| ---- | ------- | -------- |\n| `AvoidCatchingGenericException` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/596#issue-3951367) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD Java] Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidCatchingGenericException\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD Java]</strong> Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (<a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3951367\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>AvoidCatchingGenericException</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception\" rel=\"nofollow\">https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3951367\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-06-09T16:10:53Z", "path": "src/main/java/org/fisco/bcos/web3j/tx/txdecode/ContractAbiUtil.java", "diffHunk": "@@ -38,49 +42,68 @@\n      * @return\n      */\n     public static AbiDefinition getConstructorAbiDefinition(String contractAbi) {\n-        JSONArray abiArr = JSONArray.parseArray(contractAbi);\n-        AbiDefinition result = null;\n-        for (Object object : abiArr) {\n-            AbiDefinition abiDefinition = JSON.parseObject(object.toString(), AbiDefinition.class);\n-            if (TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n-                result = abiDefinition;\n-                break;\n+        try {\n+            ObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+            AbiDefinition[] abiDefinitions =\n+                    objectMapper.readValue(contractAbi, AbiDefinition[].class);\n+\n+            for (AbiDefinition abiDefinition : abiDefinitions) {\n+                if (TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n+                    return abiDefinition;\n+                }\n             }\n+        } catch (Exception e) {\n+            logger.warn(\" invalid  json, abi: {}, e: \", contractAbi, e);\n         }\n-        return result;\n+        return null;\n     }\n \n     /**\n      * @param contractAbi\n      * @return\n      */\n     public static List<AbiDefinition> getFuncAbiDefinition(String contractAbi) {\n-        JSONArray abiArr = JSONArray.parseArray(contractAbi);\n         List<AbiDefinition> result = new ArrayList<>();\n-        for (Object object : abiArr) {\n-            AbiDefinition abiDefinition = JSON.parseObject(object.toString(), AbiDefinition.class);\n-            if (TYPE_FUNCTION.equals(abiDefinition.getType())\n-                    || TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n-                result.add(abiDefinition);\n+        try {\n+            ObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+            AbiDefinition[] abiDefinitions =\n+                    objectMapper.readValue(contractAbi, AbiDefinition[].class);\n+\n+            for (AbiDefinition abiDefinition : abiDefinitions) {\n+                if (TYPE_FUNCTION.equals(abiDefinition.getType())\n+                        || TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n+                    result.add(abiDefinition);\n+                }\n             }\n+\n+            return result;\n+        } catch (Exception e) {", "originalCommit": "d93f2d163b2b5ca10d9c5021ff5136e881e0af42", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU1MTc0Mw==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/596#discussion_r437551743", "body": "__[PMD Java]__ Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block ([view](https://sider.review/gh/repos/113938008/pulls/596#issue-3951368))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| ---- | ------- | -------- |\n| `AvoidCatchingGenericException` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/596#issue-3951368) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD Java] Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidCatchingGenericException\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD Java]</strong> Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (<a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3951368\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>AvoidCatchingGenericException</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception\" rel=\"nofollow\">https://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#avoidcatchinggenericexception</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/596#issue-3951368\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-06-09T16:10:53Z", "path": "src/main/java/org/fisco/bcos/web3j/tx/txdecode/ContractAbiUtil.java", "diffHunk": "@@ -38,49 +42,68 @@\n      * @return\n      */\n     public static AbiDefinition getConstructorAbiDefinition(String contractAbi) {\n-        JSONArray abiArr = JSONArray.parseArray(contractAbi);\n-        AbiDefinition result = null;\n-        for (Object object : abiArr) {\n-            AbiDefinition abiDefinition = JSON.parseObject(object.toString(), AbiDefinition.class);\n-            if (TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n-                result = abiDefinition;\n-                break;\n+        try {\n+            ObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+            AbiDefinition[] abiDefinitions =\n+                    objectMapper.readValue(contractAbi, AbiDefinition[].class);\n+\n+            for (AbiDefinition abiDefinition : abiDefinitions) {\n+                if (TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n+                    return abiDefinition;\n+                }\n             }\n+        } catch (Exception e) {\n+            logger.warn(\" invalid  json, abi: {}, e: \", contractAbi, e);\n         }\n-        return result;\n+        return null;\n     }\n \n     /**\n      * @param contractAbi\n      * @return\n      */\n     public static List<AbiDefinition> getFuncAbiDefinition(String contractAbi) {\n-        JSONArray abiArr = JSONArray.parseArray(contractAbi);\n         List<AbiDefinition> result = new ArrayList<>();\n-        for (Object object : abiArr) {\n-            AbiDefinition abiDefinition = JSON.parseObject(object.toString(), AbiDefinition.class);\n-            if (TYPE_FUNCTION.equals(abiDefinition.getType())\n-                    || TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n-                result.add(abiDefinition);\n+        try {\n+            ObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+            AbiDefinition[] abiDefinitions =\n+                    objectMapper.readValue(contractAbi, AbiDefinition[].class);\n+\n+            for (AbiDefinition abiDefinition : abiDefinitions) {\n+                if (TYPE_FUNCTION.equals(abiDefinition.getType())\n+                        || TYPE_CONSTRUCTOR.equals(abiDefinition.getType())) {\n+                    result.add(abiDefinition);\n+                }\n             }\n+\n+            return result;\n+        } catch (Exception e) {\n+            logger.warn(\" invalid json, abi: {}, e: \", contractAbi, e);\n+            return new ArrayList<>();\n         }\n-        return result;\n     }\n \n     /**\n      * @param contractAbi\n      * @return\n      */\n     public static List<AbiDefinition> getEventAbiDefinitions(String contractAbi) {\n-        JSONArray abiArr = JSONArray.parseArray(contractAbi);\n         List<AbiDefinition> result = new ArrayList<>();\n-        for (Object object : abiArr) {\n-            AbiDefinition abiDefinition = JSON.parseObject(object.toString(), AbiDefinition.class);\n-            if (TYPE_EVENT.equals(abiDefinition.getType())) {\n-                result.add(abiDefinition);\n+        try {\n+            ObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+            AbiDefinition[] abiDefinitions =\n+                    objectMapper.readValue(contractAbi, AbiDefinition[].class);\n+\n+            for (AbiDefinition abiDefinition : abiDefinitions) {\n+                if (TYPE_EVENT.equals(abiDefinition.getType())) {\n+                    result.add(abiDefinition);\n+                }\n             }\n+            return result;\n+        } catch (Exception e) {", "originalCommit": "d93f2d163b2b5ca10d9c5021ff5136e881e0af42", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}