{"pr_number": 575, "pr_title": "add error log when p2p port is used for channel connection", "pr_author": "ywy2090", "pr_createdAt": "2020-04-24T12:06:38Z", "pr_url": "https://github.com/FISCO-BCOS/web3sdk/pull/575", "timeline": [{"oid": "a6959fedf0aeab6df58ff812f51e9ffc5b93d6d2", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/a6959fedf0aeab6df58ff812f51e9ffc5b93d6d2", "message": "add warn log when p2p port is used for channel connection", "committedDate": "2020-04-24T12:05:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDc5Mg==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/575#discussion_r414524792", "body": "__[PMD]__ Avoid throwing raw exception types. ([view](https://sider.review/gh/repos/113938008/pulls/575#issue-5511767))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `AvoidThrowingRawExceptionTypes` | Design | 1 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#avoidthrowingrawexceptiontypes>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/575#issue-5511767) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD] Avoid throwing raw exception types. (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidThrowingRawExceptionTypes\nDesign\n1\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#avoidthrowingrawexceptiontypes\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> Avoid throwing raw exception types. (<a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511767\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>AvoidThrowingRawExceptionTypes</code></td>\n<td>Design</td>\n<td>1</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#avoidthrowingrawexceptiontypes\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#avoidthrowingrawexceptiontypes</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511767\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-04-24T12:07:49Z", "path": "src/main/java/org/fisco/bcos/channel/handler/ConnectionCallback.java", "diffHunk": "@@ -419,7 +419,23 @@ public void onDisconnect(ChannelHandlerContext ctx) {\n     public void onMessage(ChannelHandlerContext ctx, ByteBuf message) {\n         try {\n             Message msg = new Message();\n-            msg.readHeader(message);\n+\n+            try {\n+                msg.readHeader(message);\n+            } catch (Exception e) {\n+                String host =\n+                        ((SocketChannel) ctx.channel())\n+                                .remoteAddress()\n+                                .getAddress()\n+                                .getHostAddress();\n+                Integer port = ((SocketChannel) ctx.channel()).remoteAddress().getPort();\n+\n+                logger.error(\n+                        \" Maybe p2p port is used to channel connection, please check the configuration, peer {}:{}\",\n+                        host,\n+                        port);\n+                throw new RuntimeException(e.getCause());", "originalCommit": "a6959fedf0aeab6df58ff812f51e9ffc5b93d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDgwMQ==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/575#discussion_r414524801", "body": "__[PMD]__ Potential violation of Law of Demeter (method chain calls) ([view](https://sider.review/gh/repos/113938008/pulls/575#issue-5511765))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `LawOfDemeter` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#lawofdemeter>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/575#issue-5511765) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> Potential violation of Law of Demeter (method chain calls) (<a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511765\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>LawOfDemeter</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#lawofdemeter\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#lawofdemeter</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511765\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-04-24T12:07:50Z", "path": "src/main/java/org/fisco/bcos/channel/handler/ConnectionCallback.java", "diffHunk": "@@ -419,7 +419,23 @@ public void onDisconnect(ChannelHandlerContext ctx) {\n     public void onMessage(ChannelHandlerContext ctx, ByteBuf message) {\n         try {\n             Message msg = new Message();\n-            msg.readHeader(message);\n+\n+            try {\n+                msg.readHeader(message);\n+            } catch (Exception e) {\n+                String host =\n+                        ((SocketChannel) ctx.channel())", "originalCommit": "a6959fedf0aeab6df58ff812f51e9ffc5b93d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDgxMg==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/575#discussion_r414524812", "body": "__[PMD]__ Potential violation of Law of Demeter (method chain calls) ([view](https://sider.review/gh/repos/113938008/pulls/575#issue-5511766))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `LawOfDemeter` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#lawofdemeter>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/575#issue-5511766) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> Potential violation of Law of Demeter (method chain calls) (<a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511766\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>LawOfDemeter</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#lawofdemeter\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#lawofdemeter</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511766\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-04-24T12:07:51Z", "path": "src/main/java/org/fisco/bcos/channel/handler/ConnectionCallback.java", "diffHunk": "@@ -419,7 +419,23 @@ public void onDisconnect(ChannelHandlerContext ctx) {\n     public void onMessage(ChannelHandlerContext ctx, ByteBuf message) {\n         try {\n             Message msg = new Message();\n-            msg.readHeader(message);\n+\n+            try {\n+                msg.readHeader(message);\n+            } catch (Exception e) {\n+                String host =\n+                        ((SocketChannel) ctx.channel())\n+                                .remoteAddress()\n+                                .getAddress()\n+                                .getHostAddress();\n+                Integer port = ((SocketChannel) ctx.channel()).remoteAddress().getPort();", "originalCommit": "a6959fedf0aeab6df58ff812f51e9ffc5b93d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDgxNw==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/575#discussion_r414524817", "body": "__[PMD]__ Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block ([view](https://sider.review/gh/repos/113938008/pulls/575#issue-5511764))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `AvoidCatchingGenericException` | Design | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#avoidcatchinggenericexception>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/575#issue-5511764) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD] Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidCatchingGenericException\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#avoidcatchinggenericexception\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (<a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511764\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>AvoidCatchingGenericException</code></td>\n<td>Design</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#avoidcatchinggenericexception\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_design.html#avoidcatchinggenericexception</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511764\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-04-24T12:07:52Z", "path": "src/main/java/org/fisco/bcos/channel/handler/ConnectionCallback.java", "diffHunk": "@@ -419,7 +419,23 @@ public void onDisconnect(ChannelHandlerContext ctx) {\n     public void onMessage(ChannelHandlerContext ctx, ByteBuf message) {\n         try {\n             Message msg = new Message();\n-            msg.readHeader(message);\n+\n+            try {\n+                msg.readHeader(message);\n+            } catch (Exception e) {", "originalCommit": "a6959fedf0aeab6df58ff812f51e9ffc5b93d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDgzMA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/575#discussion_r414524830", "body": "__[PMD]__ New exception is thrown in catch block, original stack trace may be lost ([view](https://sider.review/gh/repos/113938008/pulls/575#issue-5511768))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `PreserveStackTrace` | Best Practices | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_bestpractices.html#preservestacktrace>\n\nYou can [close this issue](https://sider.review/gh/repos/113938008/pulls/575#issue-5511768) if no need to fix it. [Learn more](https://help.sider.review/getting-started/working-with-issues).\n\n</details>", "bodyText": "[PMD] New exception is thrown in catch block, original stack trace may be lost (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nPreserveStackTrace\nBest Practices\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_bestpractices.html#preservestacktrace\n\nYou can close this issue if no need to fix it. Learn more.", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> New exception is thrown in catch block, original stack trace may be lost (<a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511768\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>PreserveStackTrace</code></td>\n<td>Best Practices</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_bestpractices.html#preservestacktrace\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_bestpractices.html#preservestacktrace</a></li>\n</ul>\n<p dir=\"auto\">You can <a href=\"https://sider.review/gh/repos/113938008/pulls/575#issue-5511768\" rel=\"nofollow\">close this issue</a> if no need to fix it. <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">Learn more</a>.</p>\n</details>", "author": "sider", "createdAt": "2020-04-24T12:07:53Z", "path": "src/main/java/org/fisco/bcos/channel/handler/ConnectionCallback.java", "diffHunk": "@@ -419,7 +419,23 @@ public void onDisconnect(ChannelHandlerContext ctx) {\n     public void onMessage(ChannelHandlerContext ctx, ByteBuf message) {\n         try {\n             Message msg = new Message();\n-            msg.readHeader(message);\n+\n+            try {\n+                msg.readHeader(message);\n+            } catch (Exception e) {\n+                String host =\n+                        ((SocketChannel) ctx.channel())\n+                                .remoteAddress()\n+                                .getAddress()\n+                                .getHostAddress();\n+                Integer port = ((SocketChannel) ctx.channel()).remoteAddress().getPort();\n+\n+                logger.error(\n+                        \" Maybe p2p port is used to channel connection, please check the configuration, peer {}:{}\",\n+                        host,\n+                        port);\n+                throw new RuntimeException(e.getCause());", "originalCommit": "a6959fedf0aeab6df58ff812f51e9ffc5b93d6d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}