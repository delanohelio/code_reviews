{"pr_number": 524, "pr_title": "remove test cache code for SM2Signer", "pr_author": "ywy2090", "pr_createdAt": "2020-03-05T14:54:58Z", "pr_url": "https://github.com/FISCO-BCOS/web3sdk/pull/524", "timeline": [{"oid": "8682d3a1da20702042955c0d6d56c505f7d32c51", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/8682d3a1da20702042955c0d6d56c505f7d32c51", "message": "remove test cache code for SM2Signer", "committedDate": "2020-03-05T15:13:47Z", "type": "commit"}, {"oid": "8682d3a1da20702042955c0d6d56c505f7d32c51", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/8682d3a1da20702042955c0d6d56c505f7d32c51", "message": "remove test cache code for SM2Signer", "committedDate": "2020-03-05T15:13:47Z", "type": "forcePushed"}, {"oid": "08476ab2e960e31682d07f68fbf8701c8b0c527c", "url": "https://github.com/FISCO-BCOS/web3sdk/commit/08476ab2e960e31682d07f68fbf8701c8b0c527c", "message": "close writer stream when PerformanceTest", "committedDate": "2020-03-05T16:05:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTM4Mg==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/524#discussion_r388395382", "body": "__[PMD]__ Found 'DU'-anomaly for variable 'writer' (lines '561'-'684'). ([view](https://sider.review/gh/repos/113938008/pulls/524#issue-5274283))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `DataflowAnomalyAnalysis` | Error Prone | 5 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis>\n\n*You can [mark this issue as **closed**](https://sider.review/gh/repos/113938008/pulls/524#issue-5274283) if you should not tackle it. (see our [document](https://help.sider.review/getting-started/working-with-issues) about issues)*\n\n</details>", "bodyText": "[PMD] Found 'DU'-anomaly for variable 'writer' (lines '561'-'684'). (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataflowAnomalyAnalysis\nError Prone\n5\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis\n\nYou can mark this issue as closed if you should not tackle it. (see our document about issues)", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> Found 'DU'-anomaly for variable 'writer' (lines '561'-'684'). (<a href=\"https://sider.review/gh/repos/113938008/pulls/524#issue-5274283\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>DataflowAnomalyAnalysis</code></td>\n<td>Error Prone</td>\n<td>5</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis</a></li>\n</ul>\n<p dir=\"auto\"><em>You can <a href=\"https://sider.review/gh/repos/113938008/pulls/524#issue-5274283\" rel=\"nofollow\">mark this issue as <strong>closed</strong></a> if you should not tackle it. (see our <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">document</a> about issues)</em></p>\n</details>", "author": "sider", "createdAt": "2020-03-05T16:07:15Z", "path": "src/test/java/org/fisco/bcos/channel/test/parallel/precompile/PerformanceDTTest.java", "diffHunk": "@@ -386,53 +385,47 @@\n                         + \" ,sps = \"\n                         + (totalSignedTxCount.intValue() / elapsed));\n \n-        System.out.println(\"\");\n-\n-        if (SM2Sign.isOpenSM2SignerCache()) {\n-            System.out.println(\"SM2Signer Object Count => \" + SM2Sign.getsM2SignerCache().size());\n-        }\n-\n         System.exit(0);\n     }\n \n~    public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci) {\n~        System.out.println(\"Start UserTransfer test...\");\n~        System.out.println(\"===================================================================\");\n~\n~        String dirName = \"./.signed_transactions\";\n~        File dir = new File(dirName);\n~        if (dir.exists()) {\n~            File[] fileList = dir.listFiles();\n~            for (File file : fileList) {\n~                if (!file.delete()) {\n~                    System.out.printf(\"Can't clean %s%n\", dirName);\n~                    System.exit(0);\n~                }\n~            }\n~        } else {\n~            if (!dir.mkdir()) {\n~                System.out.printf(\"Can't create directory %s%n\", dirName);\n~                System.exit(0);\n~            }\n~        }\n~\n~        try {\n~            System.out.println(dateFormat.format(new Date()) + \" Querying account state...\");\n~", "originalCommit": "08476ab2e960e31682d07f68fbf8701c8b0c527c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTM5MA==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/524#discussion_r388395390", "body": "__[PMD]__ Assigning an Object to null is a code smell.  Consider refactoring. ([view](https://sider.review/gh/repos/113938008/pulls/524#issue-5274284))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `NullAssignment` | Error Prone | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#nullassignment>\n\n*You can [mark this issue as **closed**](https://sider.review/gh/repos/113938008/pulls/524#issue-5274284) if you should not tackle it. (see our [document](https://help.sider.review/getting-started/working-with-issues) about issues)*\n\n</details>", "bodyText": "[PMD] Assigning an Object to null is a code smell.  Consider refactoring. (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nNullAssignment\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#nullassignment\n\nYou can mark this issue as closed if you should not tackle it. (see our document about issues)", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> Assigning an Object to null is a code smell.  Consider refactoring. (<a href=\"https://sider.review/gh/repos/113938008/pulls/524#issue-5274284\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>NullAssignment</code></td>\n<td>Error Prone</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#nullassignment\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#nullassignment</a></li>\n</ul>\n<p dir=\"auto\"><em>You can <a href=\"https://sider.review/gh/repos/113938008/pulls/524#issue-5274284\" rel=\"nofollow\">mark this issue as <strong>closed</strong></a> if you should not tackle it. (see our <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">document</a> about issues)</em></p>\n</details>", "author": "sider", "createdAt": "2020-03-05T16:07:16Z", "path": "src/test/java/org/fisco/bcos/channel/test/parallel/precompile/PerformanceDTTest.java", "diffHunk": "@@ -386,53 +385,47 @@\n                         + \" ,sps = \"\n                         + (totalSignedTxCount.intValue() / elapsed));\n \n-        System.out.println(\"\");\n-\n-        if (SM2Sign.isOpenSM2SignerCache()) {\n-            System.out.println(\"SM2Signer Object Count => \" + SM2Sign.getsM2SignerCache().size());\n-        }\n-\n         System.exit(0);\n     }\n \n~    public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci) {\n~        System.out.println(\"Start UserTransfer test...\");\n~        System.out.println(\"===================================================================\");\n~\n~        String dirName = \"./.signed_transactions\";\n~        File dir = new File(dirName);\n~        if (dir.exists()) {\n~            File[] fileList = dir.listFiles();\n~            for (File file : fileList) {\n~                if (!file.delete()) {\n~                    System.out.printf(\"Can't clean %s%n\", dirName);\n~                    System.exit(0);\n~                }\n~            }\n~        } else {\n~            if (!dir.mkdir()) {\n~                System.out.printf(\"Can't create directory %s%n\", dirName);\n~                System.exit(0);\n~            }\n~        }\n~\n~        try {\n~            System.out.println(dateFormat.format(new Date()) + \" Querying account state...\");\n~", "originalCommit": "08476ab2e960e31682d07f68fbf8701c8b0c527c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTQwMw==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/524#discussion_r388395403", "body": "__[PMD]__ Avoid instantiating new objects inside loops ([view](https://sider.review/gh/repos/113938008/pulls/524#issue-5274281))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `AvoidInstantiatingObjectsInLoops` | Performance | 3 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_performance.html#avoidinstantiatingobjectsinloops>\n\n*You can [mark this issue as **closed**](https://sider.review/gh/repos/113938008/pulls/524#issue-5274281) if you should not tackle it. (see our [document](https://help.sider.review/getting-started/working-with-issues) about issues)*\n\n</details>", "bodyText": "[PMD] Avoid instantiating new objects inside loops (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidInstantiatingObjectsInLoops\nPerformance\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_performance.html#avoidinstantiatingobjectsinloops\n\nYou can mark this issue as closed if you should not tackle it. (see our document about issues)", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> Avoid instantiating new objects inside loops (<a href=\"https://sider.review/gh/repos/113938008/pulls/524#issue-5274281\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>AvoidInstantiatingObjectsInLoops</code></td>\n<td>Performance</td>\n<td>3</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_performance.html#avoidinstantiatingobjectsinloops\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_performance.html#avoidinstantiatingobjectsinloops</a></li>\n</ul>\n<p dir=\"auto\"><em>You can <a href=\"https://sider.review/gh/repos/113938008/pulls/524#issue-5274281\" rel=\"nofollow\">mark this issue as <strong>closed</strong></a> if you should not tackle it. (see our <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">document</a> about issues)</em></p>\n</details>", "author": "sider", "createdAt": "2020-03-05T16:07:17Z", "path": "src/test/java/org/fisco/bcos/channel/test/parallel/precompile/PerformanceDTTest.java", "diffHunk": "@@ -386,53 +385,47 @@\n                         + \" ,sps = \"\n                         + (totalSignedTxCount.intValue() / elapsed));\n \n-        System.out.println(\"\");\n-\n-        if (SM2Sign.isOpenSM2SignerCache()) {\n-            System.out.println(\"SM2Signer Object Count => \" + SM2Sign.getsM2SignerCache().size());\n-        }\n-\n         System.exit(0);\n     }\n \n~    public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci) {\n~        System.out.println(\"Start UserTransfer test...\");\n~        System.out.println(\"===================================================================\");\n~\n~        String dirName = \"./.signed_transactions\";\n~        File dir = new File(dirName);", "originalCommit": "08476ab2e960e31682d07f68fbf8701c8b0c527c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTQxNg==", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/524#discussion_r388395416", "body": "__[PMD]__ Found 'DD'-anomaly for variable 'writer' (lines '561'-'484'). ([view](https://sider.review/gh/repos/113938008/pulls/524#issue-5274282))\n\n<details>\n\n| Rule | Ruleset | Priority |\n| - | - | - |\n| `DataflowAnomalyAnalysis` | Error Prone | 5 |\n\nReferences:\n- <https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis>\n\n*You can [mark this issue as **closed**](https://sider.review/gh/repos/113938008/pulls/524#issue-5274282) if you should not tackle it. (see our [document](https://help.sider.review/getting-started/working-with-issues) about issues)*\n\n</details>", "bodyText": "[PMD] Found 'DD'-anomaly for variable 'writer' (lines '561'-'484'). (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataflowAnomalyAnalysis\nError Prone\n5\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis\n\nYou can mark this issue as closed if you should not tackle it. (see our document about issues)", "bodyHTML": "<p dir=\"auto\"><strong>[PMD]</strong> Found 'DD'-anomaly for variable 'writer' (lines '561'-'484'). (<a href=\"https://sider.review/gh/repos/113938008/pulls/524#issue-5274282\" rel=\"nofollow\">view</a>)</p>\n<details>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Rule</th>\n<th>Ruleset</th>\n<th>Priority</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>DataflowAnomalyAnalysis</code></td>\n<td>Error Prone</td>\n<td>5</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">References:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis\" rel=\"nofollow\">https://pmd.github.io/pmd-6.21.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis</a></li>\n</ul>\n<p dir=\"auto\"><em>You can <a href=\"https://sider.review/gh/repos/113938008/pulls/524#issue-5274282\" rel=\"nofollow\">mark this issue as <strong>closed</strong></a> if you should not tackle it. (see our <a href=\"https://help.sider.review/getting-started/working-with-issues\" rel=\"nofollow\">document</a> about issues)</em></p>\n</details>", "author": "sider", "createdAt": "2020-03-05T16:07:18Z", "path": "src/test/java/org/fisco/bcos/channel/test/parallel/precompile/PerformanceDTTest.java", "diffHunk": "@@ -386,53 +385,47 @@\n                         + \" ,sps = \"\n                         + (totalSignedTxCount.intValue() / elapsed));\n \n-        System.out.println(\"\");\n-\n-        if (SM2Sign.isOpenSM2SignerCache()) {\n-            System.out.println(\"SM2Signer Object Count => \" + SM2Sign.getsM2SignerCache().size());\n-        }\n-\n         System.exit(0);\n     }\n \n~    public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci) {\n~        System.out.println(\"Start UserTransfer test...\");\n~        System.out.println(\"===================================================================\");\n~\n~        String dirName = \"./.signed_transactions\";\n~        File dir = new File(dirName);\n~        if (dir.exists()) {\n~            File[] fileList = dir.listFiles();\n~            for (File file : fileList) {\n~                if (!file.delete()) {\n~                    System.out.printf(\"Can't clean %s%n\", dirName);\n~                    System.exit(0);\n~                }\n~            }\n~        } else {\n~            if (!dir.mkdir()) {\n~                System.out.printf(\"Can't create directory %s%n\", dirName);\n~                System.exit(0);\n~            }\n~        }\n~\n~        try {\n~            System.out.println(dateFormat.format(new Date()) + \" Querying account state...\");\n~", "originalCommit": "08476ab2e960e31682d07f68fbf8701c8b0c527c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}