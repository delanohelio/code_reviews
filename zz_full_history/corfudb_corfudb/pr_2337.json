{"pr_number": 2337, "pr_title": "Do not log empty secondary indexes when creating CorfuTable.", "pr_author": "pankti-m", "pr_createdAt": "2020-01-31T01:52:35Z", "pr_url": "https://github.com/CorfuDB/CorfuDB/pull/2337", "merge_commit": "e788d89ab4e2d78b0a5bb4092e15801bd89aead5", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI4NTI4MA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2337#discussion_r373285280", "body": "Just use !secondaryIndexes.isEmpty()?", "bodyText": "Just use !secondaryIndexes.isEmpty()?", "bodyHTML": "<p dir=\"auto\">Just use !secondaryIndexes.isEmpty()?</p>", "author": "Maithem", "createdAt": "2020-01-31T01:56:41Z", "path": "runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java", "diffHunk": "@@ -100,8 +100,12 @@ public CorfuTable(Index.Registry<K, V> indices,\n             indexSpec.add(index);\n         });\n \n-        log.info(\"CorfuTable: creating CorfuTable with the following indexes: {}\",\n-                secondaryIndexes.keySet());\n+        if (secondaryIndexes.keySet().size() > 0) {", "originalCommit": "6ace4f4136088adb5956a5146f5d1fb9e3b16178", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI4NzY5MQ==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2337#discussion_r373287691", "bodyText": "done", "author": "pankti-m", "createdAt": "2020-01-31T02:09:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI4NTI4MA=="}], "type": "inlineReview", "revised_code": {"commit": "e45cbde73593abc4768d7c1b4feb2cfb4e84c487", "changed_code": [{"header": "diff --git a/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java b/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\nindex c3ec12062de..bd7de40a827 100644\n--- a/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\n+++ b/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\n", "chunk": "@@ -100,7 +100,7 @@ public class CorfuTable<K ,V> implements\n             indexSpec.add(index);\n         });\n \n-        if (secondaryIndexes.keySet().size() > 0) {\n+        if (!secondaryIndexes.isEmpty()) {\n             log.info(\n                 \"CorfuTable: creating CorfuTable with the following indexes: {}\",\n                 secondaryIndexes.keySet()\n", "next_change": null}]}, "revised_code_in_main": {"commit": "e788d89ab4e2d78b0a5bb4092e15801bd89aead5", "changed_code": [{"header": "diff --git a/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java b/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\nindex c3ec12062de..bd7de40a827 100644\n--- a/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\n+++ b/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\n", "chunk": "@@ -100,7 +100,7 @@ public class CorfuTable<K ,V> implements\n             indexSpec.add(index);\n         });\n \n-        if (secondaryIndexes.keySet().size() > 0) {\n+        if (!secondaryIndexes.isEmpty()) {\n             log.info(\n                 \"CorfuTable: creating CorfuTable with the following indexes: {}\",\n                 secondaryIndexes.keySet()\n", "next_change": {"commit": "3620fe8fb70a1967bb78772bf6796dd057eb4476", "changed_code": [{"header": "diff --git a/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java b/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\nindex bd7de40a827..7bd912b0c9d 100644\n--- a/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\n+++ b/runtime/src/main/java/org/corfudb/runtime/collections/CorfuTable.java\n", "chunk": "@@ -89,14 +106,15 @@ public class CorfuTable<K ,V> implements\n                       VersionPolicy versionPolicy) {\n         this.indexSpec = new HashSet<>();\n         this.secondaryIndexes = new HashMap<>();\n+        this.secondaryIndexesAliasToPath = new HashMap<>();\n         this.mainMap = streamingMapSupplier.get();\n         this.versionPolicy = versionPolicy;\n-\n         this.optimisticTable = new CorfuTable<>(this.mainMap.getOptimisticMap(), this.indexSpec,\n                 this.secondaryIndexes, null);\n \n         indices.forEach(index -> {\n             secondaryIndexes.put(index.getName().get(), new HashMap<>());\n+            secondaryIndexesAliasToPath.put(index.getAlias().get(), index.getName().get());\n             indexSpec.add(index);\n         });\n \n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "e788d89ab4e2d78b0a5bb4092e15801bd89aead5", "message": "Merge commit", "committedDate": null}, {"oid": "ba3676473e477b74af9ddd9730fcf0027c76fef8", "committedDate": "2020-01-31 14:12:40 -0800", "message": "VersionLockedObject and CorfuTable Deadlock (#2325)"}, {"oid": "e8f154e9330bf164003147b16c50fd77c6df58a5", "committedDate": "2020-01-31 16:20:32 -0800", "message": "Explicitly Close Map Streams"}, {"oid": "3681c59cb70da349ee125c8016194ee56f33663e", "committedDate": "2020-02-11 13:11:16 -0800", "message": "move scanAndFilter to StreamingMap (#2385)"}, {"oid": "ddb715f4fe5e1af14f61ed60a369c7228a1fd81a", "committedDate": "2020-03-03 16:29:13 -0800", "message": "CorfuTable Thread Pool Sizing Bug"}, {"oid": "6cd43d2e15ba041888972ab1c6a8b00a6bd75b07", "committedDate": "2020-04-17 11:32:01 -0700", "message": "Fix CorfuTable values() API that incorrectly deduplicates on return."}, {"oid": "8b401c1d3ea1a07b8f7d6ef9d6222f26a8f6d314", "committedDate": "2020-11-25 23:17:19 -0800", "message": "Client side metrics"}, {"oid": "3026ff15a3b803b0f77cdff43834d48a0950d525", "committedDate": "2020-12-03 12:44:26 -0800", "message": "UFO Secondary Indexes remove comparator for indexes on Protobufs (#2831)"}, {"oid": "3620fe8fb70a1967bb78772bf6796dd057eb4476", "committedDate": "2021-01-07 19:29:23 -0800", "message": "Nested Secondary Index Alias Support (#2851)"}, {"oid": "49643fead51ffa9d7abca4fa2000ec5702543979", "committedDate": "2021-03-04 12:42:10 -0800", "message": "Injection Framework refactoring. Step 1. LongevityApp dockerization (#2822)"}, {"oid": "d80a98c75e5efdd4b5e8d2ef9e3d0da0f1d6c0ae", "committedDate": "2021-10-05 00:32:28 -0700", "message": "Optimize scanAndFilter for Immutable Objects (#3068)"}, {"oid": "34e304461e0c63c13b796080ac788d9c603cbb91", "committedDate": "2022-02-10 20:07:20 -0800", "message": "Adding additional metrics required to measure compactor's performance - (#3158)"}, {"oid": "bec1857222d7bbe1336f871a55b91d37e1489373", "committedDate": "2022-09-06 15:30:37 -0700", "message": "Update CorfuTable getByIndex API (#3340)"}, {"oid": "78da667a908e1dfbc6ec4965ebf6fbae25efb774", "committedDate": "2022-09-07 11:01:21 -0700", "message": "Revert \"Update CorfuTable getByIndex API (#3340)\" (#3343)"}, {"oid": "42ac7c0181d8649bc95b711a17b925c7222187e6", "committedDate": "2022-09-29 13:18:56 -0700", "message": "Fix Secondary Index Leak (#3361)"}, {"oid": "3279a8109810a6aef32a767d5713b5b7632c044b", "committedDate": "2022-10-24 20:12:30 -0700", "message": "MVCC (#3387)"}, {"oid": "5dffafc2ee50cf08c41ba78db3baabd8289d9f35", "committedDate": "2022-11-16 12:05:01 -0800", "message": "Bug fix in NO_CACHE and freeTableData for MVO use case (#3398)"}]}, {"oid": "e45cbde73593abc4768d7c1b4feb2cfb4e84c487", "url": "https://github.com/CorfuDB/CorfuDB/commit/e45cbde73593abc4768d7c1b4feb2cfb4e84c487", "message": "Do not log empty secondary indexes when creating CorfuTable.", "committedDate": "2020-01-31T02:06:58Z", "type": "commit"}, {"oid": "e45cbde73593abc4768d7c1b4feb2cfb4e84c487", "url": "https://github.com/CorfuDB/CorfuDB/commit/e45cbde73593abc4768d7c1b4feb2cfb4e84c487", "message": "Do not log empty secondary indexes when creating CorfuTable.", "committedDate": "2020-01-31T02:06:58Z", "type": "forcePushed"}, {"oid": "f8133d283e245b65c49d60755fa55731e699b8db", "url": "https://github.com/CorfuDB/CorfuDB/commit/f8133d283e245b65c49d60755fa55731e699b8db", "message": "Merge branch 'master' into corfuTable_logging", "committedDate": "2020-01-31T18:42:25Z", "type": "commit"}]}