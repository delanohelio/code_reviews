{"pr_number": 4153, "pr_title": "Add 3 \"placeholders\" usable in \"entering town titles\".", "pr_author": "Yldales", "pr_createdAt": "2020-07-09T18:20:06Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/4153", "timeline": [{"oid": "d9b6e45e48405fc524e6edc45647349fed43f3e7", "url": "https://github.com/TownyAdvanced/Towny/commit/d9b6e45e48405fc524e6edc45647349fed43f3e7", "message": "Added a new Town method, getNumResidentsOnline(), returning as integer the count of the online(s) resident(s) inside the town.", "committedDate": "2020-07-08T21:08:10Z", "type": "commit"}, {"oid": "dbaa6e7fbf7e48c76f8a5ab1afa81994f654985a", "url": "https://github.com/TownyAdvanced/Towny/commit/dbaa6e7fbf7e48c76f8a5ab1afa81994f654985a", "message": "Added 3 \"placeholders\" ({town_motd}, {town_residents} and {town_residents_online}) who can be used inside notification.titles.*.", "committedDate": "2020-07-08T21:10:05Z", "type": "commit"}, {"oid": "71b79ee51e4644b2e933ca35a73a6e8338b00215", "url": "https://github.com/TownyAdvanced/Towny/commit/71b79ee51e4644b2e933ca35a73a6e8338b00215", "message": "Merge remote-tracking branch 'remotes/upstream/master'", "committedDate": "2020-07-08T21:12:41Z", "type": "commit"}, {"oid": "fe0f4162d91743c68f040177822e2cc38ad8cf03", "url": "https://github.com/TownyAdvanced/Towny/commit/fe0f4162d91743c68f040177822e2cc38ad8cf03", "message": "Clean up.", "committedDate": "2020-07-09T17:48:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxMzkyOQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4153#discussion_r452413929", "body": "This needs to be removed, we already have a method `TownyAPI#getOnlineResidents()` that does this.", "bodyText": "This needs to be removed, we already have a method TownyAPI#getOnlineResidents() that does this.", "bodyHTML": "<p dir=\"auto\">This needs to be removed, we already have a method <code>TownyAPI#getOnlineResidents()</code> that does this.</p>", "author": null, "createdAt": "2020-07-09T18:35:11Z", "path": "src/com/palmergames/bukkit/towny/object/Town.java", "diffHunk": "@@ -296,6 +297,22 @@ public int getNumResidents() {\n \t\treturn residents.size();\n \t}\n \n+\tpublic int getNumResidentsOnline() {\n+\t\tint onlineResidents = 0;\n+\t\tfor(Resident resident: getResidents()) {\n+\t\t\tif(resident.isNPC()) {\n+\t\t\t\tonlineResidents++;\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\t\t\t\n+\t\t\tPlayer player = Bukkit.getServer().getPlayer(resident.getName());\n+\t\t\tif(player.isOnline()) {\n+\t\t\t\tonlineResidents++;\n+\t\t\t}\n+\t\t}\n+\t\treturn onlineResidents;\n+\t}\n+\t", "originalCommit": "fe0f4162d91743c68f040177822e2cc38ad8cf03", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d75743ad0d33e964dabf1d0ae811b78670d83c42", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/object/Town.java b/src/com/palmergames/bukkit/towny/object/Town.java\nindex 739dafecf..e4f29cf60 100644\n--- a/src/com/palmergames/bukkit/towny/object/Town.java\n+++ b/src/com/palmergames/bukkit/towny/object/Town.java\n", "chunk": "@@ -297,22 +291,6 @@ public class Town extends TownyObject implements ResidentList, TownyInviter, Obj\n \t\treturn residents.size();\n \t}\n \n-\tpublic int getNumResidentsOnline() {\n-\t\tint onlineResidents = 0;\n-\t\tfor(Resident resident: getResidents()) {\n-\t\t\tif(resident.isNPC()) {\n-\t\t\t\tonlineResidents++;\n-\t\t\t\tcontinue;\n-\t\t\t}\n-\t\t\t\n-\t\t\tPlayer player = Bukkit.getServer().getPlayer(resident.getName());\n-\t\t\tif(player.isOnline()) {\n-\t\t\t\tonlineResidents++;\n-\t\t\t}\n-\t\t}\n-\t\treturn onlineResidents;\n-\t}\n-\t\n \tpublic boolean isCapital() {\n \n \t\treturn hasNation() && nation.isCapital(this);\n", "next_change": null}]}}, {"oid": "f48511adcff567f94e8138c04c0fc2aad1b05faf", "url": "https://github.com/TownyAdvanced/Towny/commit/f48511adcff567f94e8138c04c0fc2aad1b05faf", "message": "Removed `getNumResidentsOnline()`.", "committedDate": "2020-07-09T19:05:36Z", "type": "commit"}, {"oid": "69621d15c6af546dceb6b15fc57004a282b8d5e3", "url": "https://github.com/TownyAdvanced/Towny/commit/69621d15c6af546dceb6b15fc57004a282b8d5e3", "message": "Make `{town_residents_online}` use `TownyAPI#getOnlineResidents(town)`.", "committedDate": "2020-07-09T19:07:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQzMzM5Mg==", "url": "https://github.com/TownyAdvanced/Towny/pull/4153#discussion_r452433392", "body": "Undo wildcard import.", "bodyText": "Undo wildcard import.", "bodyHTML": "<p dir=\"auto\">Undo wildcard import.</p>", "author": "LlmDl", "createdAt": "2020-07-09T19:12:21Z", "path": "src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java", "diffHunk": "@@ -1,11 +1,6 @@\n package com.palmergames.bukkit.towny.listeners;\n \n-import com.palmergames.bukkit.towny.Towny;\n-import com.palmergames.bukkit.towny.TownyAPI;\n-import com.palmergames.bukkit.towny.TownyMessaging;\n-import com.palmergames.bukkit.towny.TownySettings;\n-import com.palmergames.bukkit.towny.TownyTimerHandler;\n-import com.palmergames.bukkit.towny.TownyUniverse;\n+import com.palmergames.bukkit.towny.*;", "originalCommit": "69621d15c6af546dceb6b15fc57004a282b8d5e3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f3cf0282ec21ac21b14e47a9b1198feb3a8c4be3", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex b9738ed03..3029b7545 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -1,6 +1,11 @@\n package com.palmergames.bukkit.towny.listeners;\n \n-import com.palmergames.bukkit.towny.*;\n+import com.palmergames.bukkit.towny.Towny;\n+import com.palmergames.bukkit.towny.TownyAPI;\n+import com.palmergames.bukkit.towny.TownyMessaging;\n+import com.palmergames.bukkit.towny.TownySettings;\n+import com.palmergames.bukkit.towny.TownyTimerHandler;\n+import com.palmergames.bukkit.towny.TownyUniverse;\n import com.palmergames.bukkit.towny.db.TownyDataSource;\n import com.palmergames.bukkit.towny.event.PlayerChangePlotEvent;\n import com.palmergames.bukkit.towny.event.PlayerEnterTownEvent;\n", "next_change": {"commit": "82dce06e0372e5d62fd065a1bc3171fdf5836819", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 3029b7545..2d199920e 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -7,6 +7,7 @@ import com.palmergames.bukkit.towny.TownySettings;\n import com.palmergames.bukkit.towny.TownyTimerHandler;\n import com.palmergames.bukkit.towny.TownyUniverse;\n import com.palmergames.bukkit.towny.db.TownyDataSource;\n+import com.palmergames.bukkit.towny.event.BedExplodeEvent;\n import com.palmergames.bukkit.towny.event.PlayerChangePlotEvent;\n import com.palmergames.bukkit.towny.event.PlayerEnterTownEvent;\n import com.palmergames.bukkit.towny.event.PlayerLeaveTownEvent;\n", "next_change": {"commit": "0e4403b076d064d2490791f9128202eb1a9be90f", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 2d199920e..21d962cd2 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -11,17 +11,16 @@ import com.palmergames.bukkit.towny.event.BedExplodeEvent;\n import com.palmergames.bukkit.towny.event.PlayerChangePlotEvent;\n import com.palmergames.bukkit.towny.event.PlayerEnterTownEvent;\n import com.palmergames.bukkit.towny.event.PlayerLeaveTownEvent;\n+import com.palmergames.bukkit.towny.event.executors.TownyActionEventExecutor;\n import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;\n import com.palmergames.bukkit.towny.exceptions.TownyException;\n import com.palmergames.bukkit.towny.object.Coord;\n import com.palmergames.bukkit.towny.object.Nation;\n import com.palmergames.bukkit.towny.object.PlayerCache;\n-import com.palmergames.bukkit.towny.object.PlayerCache.TownBlockStatus;\n import com.palmergames.bukkit.towny.object.Resident;\n import com.palmergames.bukkit.towny.object.Town;\n import com.palmergames.bukkit.towny.object.TownBlock;\n import com.palmergames.bukkit.towny.object.TownBlockType;\n-import com.palmergames.bukkit.towny.object.TownyPermission;\n import com.palmergames.bukkit.towny.object.TownyPermission.ActionType;\n import com.palmergames.bukkit.towny.object.TownyWorld;\n import com.palmergames.bukkit.towny.object.Translation;\n", "next_change": {"commit": "5825f24e07a3679a186f8cf538d1ffd0949a61f7", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 21d962cd2..65b26d72e 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -6,22 +6,20 @@ import com.palmergames.bukkit.towny.TownyMessaging;\n import com.palmergames.bukkit.towny.TownySettings;\n import com.palmergames.bukkit.towny.TownyTimerHandler;\n import com.palmergames.bukkit.towny.TownyUniverse;\n-import com.palmergames.bukkit.towny.db.TownyDataSource;\n import com.palmergames.bukkit.towny.event.BedExplodeEvent;\n import com.palmergames.bukkit.towny.event.PlayerChangePlotEvent;\n import com.palmergames.bukkit.towny.event.PlayerEnterTownEvent;\n import com.palmergames.bukkit.towny.event.PlayerLeaveTownEvent;\n import com.palmergames.bukkit.towny.event.executors.TownyActionEventExecutor;\n import com.palmergames.bukkit.towny.exceptions.NotRegisteredException;\n-import com.palmergames.bukkit.towny.exceptions.TownyException;\n import com.palmergames.bukkit.towny.object.Coord;\n-import com.palmergames.bukkit.towny.object.Nation;\n import com.palmergames.bukkit.towny.object.PlayerCache;\n import com.palmergames.bukkit.towny.object.Resident;\n import com.palmergames.bukkit.towny.object.Town;\n import com.palmergames.bukkit.towny.object.TownBlock;\n import com.palmergames.bukkit.towny.object.TownBlockType;\n import com.palmergames.bukkit.towny.object.TownyPermission.ActionType;\n+import com.palmergames.bukkit.towny.object.jail.UnJailReason;\n import com.palmergames.bukkit.towny.object.TownyWorld;\n import com.palmergames.bukkit.towny.object.Translation;\n import com.palmergames.bukkit.towny.object.WorldCoord;\n", "next_change": {"commit": "215e0d6f753fcfae657759b0c97696789db35cab", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 65b26d72e..3210d8dc1 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -19,9 +20,9 @@ import com.palmergames.bukkit.towny.object.Town;\n import com.palmergames.bukkit.towny.object.TownBlock;\n import com.palmergames.bukkit.towny.object.TownBlockType;\n import com.palmergames.bukkit.towny.object.TownyPermission.ActionType;\n+import com.palmergames.bukkit.towny.object.Translatable;\n import com.palmergames.bukkit.towny.object.jail.UnJailReason;\n import com.palmergames.bukkit.towny.object.TownyWorld;\n-import com.palmergames.bukkit.towny.object.Translation;\n import com.palmergames.bukkit.towny.object.WorldCoord;\n import com.palmergames.bukkit.towny.permissions.PermissionNodes;\n import com.palmergames.bukkit.towny.permissions.TownyPerms;\n", "next_change": {"commit": "ce63029a85e48c87ca27bbdfad6cbbe0d9b60b66", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 3210d8dc1..2ee1a8dbb 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -26,6 +26,8 @@ import com.palmergames.bukkit.towny.object.TownyWorld;\n import com.palmergames.bukkit.towny.object.WorldCoord;\n import com.palmergames.bukkit.towny.permissions.PermissionNodes;\n import com.palmergames.bukkit.towny.permissions.TownyPerms;\n+import com.palmergames.bukkit.towny.tasks.CooldownTimerTask;\n+import com.palmergames.bukkit.towny.tasks.CooldownTimerTask.CooldownType;\n import com.palmergames.bukkit.towny.tasks.OnPlayerLogin;\n import com.palmergames.bukkit.towny.tasks.TeleportWarmupTimerTask;\n import com.palmergames.bukkit.towny.utils.CombatUtil;\n", "next_change": {"commit": "f01e77bf931166101eb2a2558f219532b5aae2ca", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 2ee1a8dbb..1055e10bc 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -26,22 +26,17 @@ import com.palmergames.bukkit.towny.object.TownyWorld;\n import com.palmergames.bukkit.towny.object.WorldCoord;\n import com.palmergames.bukkit.towny.permissions.PermissionNodes;\n import com.palmergames.bukkit.towny.permissions.TownyPerms;\n-import com.palmergames.bukkit.towny.tasks.CooldownTimerTask;\n-import com.palmergames.bukkit.towny.tasks.CooldownTimerTask.CooldownType;\n import com.palmergames.bukkit.towny.tasks.OnPlayerLogin;\n import com.palmergames.bukkit.towny.tasks.TeleportWarmupTimerTask;\n import com.palmergames.bukkit.towny.utils.CombatUtil;\n import com.palmergames.bukkit.towny.utils.EntityTypeUtil;\n import com.palmergames.bukkit.towny.utils.JailUtil;\n-import com.palmergames.bukkit.towny.utils.SpawnUtil;\n+import com.palmergames.bukkit.towny.utils.ResidentUtil;\n import com.palmergames.bukkit.util.BukkitTools;\n import com.palmergames.bukkit.util.ChatTools;\n import com.palmergames.bukkit.util.ItemLists;\n import com.palmergames.util.StringMgmt;\n \n-import com.palmergames.util.TimeMgmt;\n-import net.citizensnpcs.api.CitizensAPI;\n-\n import org.bukkit.Bukkit;\n import org.bukkit.ChatColor;\n import org.bukkit.Location;\n", "next_change": {"commit": "f7ef2c10bad26fc330b2c5c3f61aab050ac3c189", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 1055e10bc..c8a5b51a6 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -45,6 +46,7 @@ import org.bukkit.Tag;\n import org.bukkit.World.Environment;\n import org.bukkit.block.Block;\n import org.bukkit.block.BlockFace;\n+import org.bukkit.block.data.type.RespawnAnchor;\n import org.bukkit.block.data.type.Sign;\n import org.bukkit.block.data.type.WallSign;\n import org.bukkit.entity.Entity;\n", "next_change": {"commit": "0e21a8df1c4b3ae2d8fe2a2dd7867367db092d37", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex c8a5b51a6..395561145 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -42,10 +44,13 @@ import org.bukkit.Bukkit;\n import org.bukkit.ChatColor;\n import org.bukkit.Location;\n import org.bukkit.Material;\n+import org.bukkit.NamespacedKey;\n import org.bukkit.Tag;\n import org.bukkit.World.Environment;\n import org.bukkit.block.Block;\n import org.bukkit.block.BlockFace;\n+import org.bukkit.block.data.Directional;\n+import org.bukkit.block.data.Rotatable;\n import org.bukkit.block.data.type.RespawnAnchor;\n import org.bukkit.block.data.type.Sign;\n import org.bukkit.block.data.type.WallSign;\n", "next_change": {"commit": "c917a5cedd8ab65d2a1484452f43e508db006d94", "changed_code": [{"header": "diff --git a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\nindex 395561145..968a7be56 100644\n--- a/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n+++ b/src/com/palmergames/bukkit/towny/listeners/TownyPlayerListener.java\n", "chunk": "@@ -49,8 +49,6 @@ import org.bukkit.Tag;\n import org.bukkit.World.Environment;\n import org.bukkit.block.Block;\n import org.bukkit.block.BlockFace;\n-import org.bukkit.block.data.Directional;\n-import org.bukkit.block.data.Rotatable;\n import org.bukkit.block.data.type.RespawnAnchor;\n import org.bukkit.block.data.type.Sign;\n import org.bukkit.block.data.type.WallSign;\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}, {"oid": "2ebb63b4345f56bc278bce454ba957f5c189ff85", "url": "https://github.com/TownyAdvanced/Towny/commit/2ebb63b4345f56bc278bce454ba957f5c189ff85", "message": "Revert back Town.java.", "committedDate": "2020-07-09T19:20:06Z", "type": "commit"}, {"oid": "f4c069422f635224f8a99e277c4c0fa325f765a8", "url": "https://github.com/TownyAdvanced/Towny/commit/f4c069422f635224f8a99e277c4c0fa325f765a8", "message": "Restore imports in TownyPlayerListener.java.", "committedDate": "2020-07-09T19:26:20Z", "type": "commit"}, {"oid": "484fd4abd0415de2b9e4bc881c103ba24d0a6c7c", "url": "https://github.com/TownyAdvanced/Towny/commit/484fd4abd0415de2b9e4bc881c103ba24d0a6c7c", "message": "Removed unwanted empty line in TownyPlayerListener.java.", "committedDate": "2020-07-09T19:34:03Z", "type": "commit"}, {"oid": "90dec42e56ecb0a22fa1a956ac48f94fc677aa0a", "url": "https://github.com/TownyAdvanced/Towny/commit/90dec42e56ecb0a22fa1a956ac48f94fc677aa0a", "message": "Fix {town_residents_online} output :x", "committedDate": "2020-07-09T19:41:38Z", "type": "commit"}]}