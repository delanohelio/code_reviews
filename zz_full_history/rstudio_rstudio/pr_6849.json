{"pr_number": 6849, "pr_title": "Rework Source structure", "pr_author": "melissa-barca", "pr_createdAt": "2020-05-11T17:22:36Z", "pr_url": "https://github.com/rstudio/rstudio/pull/6849", "timeline": [{"oid": "f04fd9828feb1e3c57c1e960d2512ee938ff4b17", "url": "https://github.com/rstudio/rstudio/commit/f04fd9828feb1e3c57c1e960d2512ee938ff4b17", "message": "start base for third column", "committedDate": "2020-03-25T23:48:19Z", "type": "commit"}, {"oid": "ff95517936c254875ef3c68e8440dc1393e4a3db", "url": "https://github.com/rstudio/rstudio/commit/ff95517936c254875ef3c68e8440dc1393e4a3db", "message": "allow for multiple source views (WIP)", "committedDate": "2020-03-26T23:37:47Z", "type": "commit"}, {"oid": "7298e3a283b04682d2bf75f61c953014806a9c67", "url": "https://github.com/rstudio/rstudio/commit/7298e3a283b04682d2bf75f61c953014806a9c67", "message": "put multiple LayoutPanels within the SourcePane", "committedDate": "2020-03-27T00:40:16Z", "type": "commit"}, {"oid": "cc5dda489711fbee619ff673b6d0b7f730c703eb", "url": "https://github.com/rstudio/rstudio/commit/cc5dda489711fbee619ff673b6d0b7f730c703eb", "message": "ugly experimental code", "committedDate": "2020-03-28T00:56:37Z", "type": "commit"}, {"oid": "48d29d3e70dcaaf2cf3f7649437bc2991d233dea", "url": "https://github.com/rstudio/rstudio/commit/48d29d3e70dcaaf2cf3f7649437bc2991d233dea", "message": "hard-coded to display 3 columns - two source", "committedDate": "2020-03-30T23:07:04Z", "type": "commit"}, {"oid": "ed7f259d8e925847737f33290f36b2c0773fbebc", "url": "https://github.com/rstudio/rstudio/commit/ed7f259d8e925847737f33290f36b2c0773fbebc", "message": "start work for multiple SourceShims", "committedDate": "2020-03-31T00:34:26Z", "type": "commit"}, {"oid": "02e06b32ebb513b68ddecc22fb34d59bd0c6be2d", "url": "https://github.com/rstudio/rstudio/commit/02e06b32ebb513b68ddecc22fb34d59bd0c6be2d", "message": "add to allowing multiple sources", "committedDate": "2020-03-31T22:01:55Z", "type": "commit"}, {"oid": "fbeca078998138456cc8ac121d6fc5fd48ee3118", "url": "https://github.com/rstudio/rstudio/commit/fbeca078998138456cc8ac121d6fc5fd48ee3118", "message": "begin removal of SourceShim", "committedDate": "2020-04-02T23:31:06Z", "type": "commit"}, {"oid": "057c4422363f1e7b7301d19d78ec2e460afe224c", "url": "https://github.com/rstudio/rstudio/commit/057c4422363f1e7b7301d19d78ec2e460afe224c", "message": "make the Source constructor act more like the shim so neccesary dependencies can load before setting\nup the display pane", "committedDate": "2020-04-03T00:45:30Z", "type": "commit"}, {"oid": "3658c416d8f49e6609a2b8a79162d08583b79ca3", "url": "https://github.com/rstudio/rstudio/commit/3658c416d8f49e6609a2b8a79162d08583b79ca3", "message": "add class for managing different source views", "committedDate": "2020-04-03T19:59:14Z", "type": "commit"}, {"oid": "5e62e2857ccd9bf945640a709c3fa3a11ad3e6e1", "url": "https://github.com/rstudio/rstudio/commit/5e62e2857ccd9bf945640a709c3fa3a11ad3e6e1", "message": "fix spacing and add missing event handlers", "committedDate": "2020-04-03T21:04:10Z", "type": "commit"}, {"oid": "dd22ca55a3399c846c401e6945310ec1001bc8df", "url": "https://github.com/rstudio/rstudio/commit/dd22ca55a3399c846c401e6945310ec1001bc8df", "message": "working on getting source to display", "committedDate": "2020-04-06T19:32:24Z", "type": "commit"}, {"oid": "dc70d3b9c5f892fe621e4438d212c80a071ab51f", "url": "https://github.com/rstudio/rstudio/commit/dc70d3b9c5f892fe621e4438d212c80a071ab51f", "message": "add missing event handles to Source", "committedDate": "2020-04-07T01:19:22Z", "type": "commit"}, {"oid": "a4671ed06029a8815d1111faa1a52b0206dd244f", "url": "https://github.com/rstudio/rstudio/commit/a4671ed06029a8815d1111faa1a52b0206dd244f", "message": "debug code", "committedDate": "2020-04-07T21:01:54Z", "type": "commit"}, {"oid": "ee0c0fc1c465136d8f5e7799d5b177e84ef95e12", "url": "https://github.com/rstudio/rstudio/commit/ee0c0fc1c465136d8f5e7799d5b177e84ef95e12", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/add-source-pane", "committedDate": "2020-04-07T21:36:40Z", "type": "commit"}, {"oid": "69f583bf8b3c382e9d7a5976b748b009b5510a05", "url": "https://github.com/rstudio/rstudio/commit/69f583bf8b3c382e9d7a5976b748b009b5510a05", "message": "remove code for adding multiple source columns.", "committedDate": "2020-04-16T20:34:10Z", "type": "commit"}, {"oid": "a1bd5838e029ebce62a76eae70ca8bb835740b4b", "url": "https://github.com/rstudio/rstudio/commit/a1bd5838e029ebce62a76eae70ca8bb835740b4b", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/source-columns", "committedDate": "2020-04-16T20:35:15Z", "type": "commit"}, {"oid": "aa43c480a0e9b456ad35b455ecb1f74b3935a802", "url": "https://github.com/rstudio/rstudio/commit/aa43c480a0e9b456ad35b455ecb1f74b3935a802", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/source-columns", "committedDate": "2020-04-16T22:03:31Z", "type": "commit"}, {"oid": "2bde2906b0f582ed3458c0323f6ae7e1e13e1c31", "url": "https://github.com/rstudio/rstudio/commit/2bde2906b0f582ed3458c0323f6ae7e1e13e1c31", "message": "load all source events for satellite windows, broken in previous commit", "committedDate": "2020-04-17T01:00:56Z", "type": "commit"}, {"oid": "cbd1743aac144fd5b6126367a8c685a47365837b", "url": "https://github.com/rstudio/rstudio/commit/cbd1743aac144fd5b6126367a8c685a47365837b", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/source-columns", "committedDate": "2020-04-23T20:10:10Z", "type": "commit"}, {"oid": "b29ad0b5e29c0672d4e83743fc75ec51f5d509d6", "url": "https://github.com/rstudio/rstudio/commit/b29ad0b5e29c0672d4e83743fc75ec51f5d509d6", "message": "debug code", "committedDate": "2020-04-23T22:38:28Z", "type": "commit"}, {"oid": "5562100641e75ec06fc975b8ad788bb74d0e00e4", "url": "https://github.com/rstudio/rstudio/commit/5562100641e75ec06fc975b8ad788bb74d0e00e4", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/source-columns", "committedDate": "2020-04-23T22:56:44Z", "type": "commit"}, {"oid": "c4592dc4700792ce029045ee1a09fe4f8b698db0", "url": "https://github.com/rstudio/rstudio/commit/c4592dc4700792ce029045ee1a09fe4f8b698db0", "message": "Fix issue where UserPrefs were loaded before StatePrefs", "committedDate": "2020-04-24T00:46:24Z", "type": "commit"}, {"oid": "76f6d71109605da56eb3f73c45947527c17770ec", "url": "https://github.com/rstudio/rstudio/commit/76f6d71109605da56eb3f73c45947527c17770ec", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/source-columns", "committedDate": "2020-04-24T17:21:48Z", "type": "commit"}, {"oid": "31bc3fc540546dd2052154e952b005316f6d770d", "url": "https://github.com/rstudio/rstudio/commit/31bc3fc540546dd2052154e952b005316f6d770d", "message": "fix drag and drop desktop issue", "committedDate": "2020-05-04T22:13:48Z", "type": "commit"}, {"oid": "c263037e1eac15e3664611ef76e20aaae145fdc7", "url": "https://github.com/rstudio/rstudio/commit/c263037e1eac15e3664611ef76e20aaae145fdc7", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/source-columns", "committedDate": "2020-05-04T23:06:04Z", "type": "commit"}, {"oid": "e80e5f7ea37ec8908bebe22915be86ee2235c650", "url": "https://github.com/rstudio/rstudio/commit/e80e5f7ea37ec8908bebe22915be86ee2235c650", "message": "Merge branch 'master' of https://github.com/rstudio/rstudio into feature/source-columns", "committedDate": "2020-05-11T17:04:29Z", "type": "commit"}, {"oid": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "url": "https://github.com/rstudio/rstudio/commit/6b0f1284217369ad95fe502f4c976aac4cbf4feb", "message": "remove comments", "committedDate": "2020-05-11T17:15:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MDA2Mw==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424570063", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:25:28Z", "path": "src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java", "diffHunk": "@@ -120,6 +120,11 @@ public DocTabLayoutPanel(boolean closeableTabs,\n       events_.addHandler(DocTabDragStartedEvent.TYPE, dragManager_);\n       commands_ = RStudioGinjector.INSTANCE.getCommands();\n \n+   }", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0OTkyNg==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424649926", "bodyText": "Done.", "author": "melissa-barca", "createdAt": "2020-05-13T18:35:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3MDA2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "70390b3181ba94e1e0699e50dea4b56aaa7b98c1", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java b/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\nindex 65fcd69df5..972a2cafb1 100644\n--- a/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\n+++ b/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\n", "chunk": "@@ -120,11 +122,6 @@ public class DocTabLayoutPanel\n       events_.addHandler(DocTabDragStartedEvent.TYPE, dragManager_);\n       commands_ = RStudioGinjector.INSTANCE.getCommands();\n \n-   }\n-\n-   @Override\n-   public void onLoad()\n-   {\n       // sink drag-related events on the tab bar element; unfortunately\n       // GWT does not provide bits for the drag-related events, and \n       Scheduler.get().scheduleDeferred(new ScheduledCommand()\n", "next_change": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java b/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\nindex 972a2cafb1..d60b179efc 100644\n--- a/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\n+++ b/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\n", "chunk": "@@ -122,6 +120,11 @@ public class DocTabLayoutPanel\n       events_.addHandler(DocTabDragStartedEvent.TYPE, dragManager_);\n       commands_ = RStudioGinjector.INSTANCE.getCommands();\n \n+   }\n+\n+   @Override\n+   public void onLoad()\n+   {\n       // sink drag-related events on the tab bar element; unfortunately\n       // GWT does not provide bits for the drag-related events, and \n       Scheduler.get().scheduleDeferred(new ScheduledCommand()\n", "next_change": {"commit": "cb3f6128fdebcf64586cf425d6a6eb53242e9a2f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java b/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\nindex d60b179efc..286dc7512a 100644\n--- a/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\n+++ b/src/gwt/src/org/rstudio/core/client/theme/DocTabLayoutPanel.java\n", "chunk": "@@ -126,7 +124,7 @@ public class DocTabLayoutPanel\n    public void onLoad()\n    {\n       // sink drag-related events on the tab bar element; unfortunately\n-      // GWT does not provide bits for the drag-related events, and \n+      // GWT does not provide bits for the drag-related events, and\n       Scheduler.get().scheduleDeferred(new ScheduledCommand()\n       {\n          @Override\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3Mjg0Nw==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424572847", "body": "Can you elaborate on how/why this might be? Maybe it's obvious as I read more of the code.", "bodyText": "Can you elaborate on how/why this might be? Maybe it's obvious as I read more of the code.", "bodyHTML": "<p dir=\"auto\">Can you elaborate on how/why this might be? Maybe it's obvious as I read more of the code.</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:29:45Z", "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "diffHunk": "@@ -206,7 +207,18 @@ public void run()\n             MathJaxLoader.ensureMathJaxLoaded();\n \n             // initialize workbench\n-            initializeWorkbench();\n+            // refresh prefs incase they were loaded without sessionInfo", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1MjE0Mg==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424652142", "bodyText": "This happens exclusively in desktop mode, I was able to track down the issue enough to find that userPrefs were being loaded before sessionInfo but couldn't find when this was happening or if it was truly necessary. I updated the comment with that clarification.", "author": "melissa-barca", "createdAt": "2020-05-13T18:39:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3Mjg0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/application/Application.java b/src/gwt/src/org/rstudio/studio/client/application/Application.java\nindex c94d3a6fa5..5a669372c6 100644\n--- a/src/gwt/src/org/rstudio/studio/client/application/Application.java\n+++ b/src/gwt/src/org/rstudio/studio/client/application/Application.java\n", "chunk": "@@ -207,18 +207,15 @@ public class Application implements ApplicationEventHandlers\n             MathJaxLoader.ensureMathJaxLoaded();\n \n             // initialize workbench\n-            // refresh prefs incase they were loaded without sessionInfo\n-            userState_.get().writeState(\n-                  new CommandWithArg<Boolean>() {\n-                     public void execute(Boolean arg) {\n-                        userPrefs_.get().writeUserPrefs(\n-                              new CommandWithArg<Boolean>() {\n-                                 public void execute(Boolean arg) {\n-                                    initializeWorkbench();\n-                                 }\n-                              });\n-                        }\n-                  });\n+            // refresh prefs incase they were loaded without sessionInfo (this happens exclusively\n+            // in desktop mode, though unsure why)\n+            userState_.get().writeState(boolArg ->\n+            {\n+               userPrefs_.get().writeUserPrefs(boolArg1 ->\n+               {\n+                  initializeWorkbench();\n+               });\n+            });\n          }\n \n          public void onError(ServerError error)\n", "next_change": {"commit": "da79642e4625eacee3bc2b898472c46e884fa0ae", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/application/Application.java b/src/gwt/src/org/rstudio/studio/client/application/Application.java\nindex 5a669372c6..4f657a7822 100644\n--- a/src/gwt/src/org/rstudio/studio/client/application/Application.java\n+++ b/src/gwt/src/org/rstudio/studio/client/application/Application.java\n", "chunk": "@@ -223,8 +222,19 @@ public class Application implements ApplicationEventHandlers\n             Debug.logError(error);\n             dismissLoadingProgress.execute();\n \n-            globalDisplay_.showErrorMessage(\"RStudio Initialization Error\",\n-                                            error.getUserMessage());\n+            if (!StringUtil.isNullOrEmpty(error.getRedirectUrl()))\n+            {\n+               // error is informing us that we should redirect\n+               // redirect to the specified URL (as a sub URL of the site's root)\n+               String redirectUrl = ApplicationUtils.getHostPageBaseURLWithoutContext(false) + \n+            \t\t   error.getRedirectUrl();\n+               navigateWindowWithDelay(redirectUrl);\n+            }\n+            else\n+            {\n+               globalDisplay_.showErrorMessage(\"RStudio Initialization Error\",\n+                                               error.getUserMessage());\n+            }\n          }\n       };\n       \n", "next_change": {"commit": "cb3f6128fdebcf64586cf425d6a6eb53242e9a2f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/application/Application.java b/src/gwt/src/org/rstudio/studio/client/application/Application.java\nindex 4f657a7822..2ed35c536b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/application/Application.java\n+++ b/src/gwt/src/org/rstudio/studio/client/application/Application.java\n", "chunk": "@@ -237,17 +235,17 @@ public class Application implements ApplicationEventHandlers\n             }\n          }\n       };\n-      \n+\n       final ApplicationClientInit clientInit = pClientInit_.get();\n \n       if (timeoutOptions != null)\n       {\n          timeoutOptions.setObserver(clientInit);\n       }\n-      \n+\n       // read options from querystring\n       SessionInitOptions options = SessionInitOptions.create(\n-            SessionInitOptions.RESTORE_WORKSPACE_DEFAULT, \n+            SessionInitOptions.RESTORE_WORKSPACE_DEFAULT,\n             SessionInitOptions.RUN_RPROFILE_DEFAULT);\n       try\n       {\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3NzI1Mg==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424577252", "body": "Using lambdas you can tidy this up to:\r\n```\r\n            userState_.get().writeState(boolArg ->\r\n            {\r\n               userPrefs_.get().writeUserPrefs(boolArg1 ->\r\n               {\r\n                     initializeWorkbench();\r\n               });\r\n            });\r\n         }\r\n```\r\n\r\nYou could drop the braces and make it more compact, but I personally find that harder to read especially when there are multiple lambda happening at once (but that's just me):\r\n\r\n```\r\n            userState_.get().writeState(boolArg ->\r\n               userPrefs_.get().writeUserPrefs(boolArg1 ->\r\n                  initializeWorkbench()));\r\n```", "bodyText": "Using lambdas you can tidy this up to:\n            userState_.get().writeState(boolArg ->\n            {\n               userPrefs_.get().writeUserPrefs(boolArg1 ->\n               {\n                     initializeWorkbench();\n               });\n            });\n         }\n\nYou could drop the braces and make it more compact, but I personally find that harder to read especially when there are multiple lambda happening at once (but that's just me):\n            userState_.get().writeState(boolArg ->\n               userPrefs_.get().writeUserPrefs(boolArg1 ->\n                  initializeWorkbench()));", "bodyHTML": "<p dir=\"auto\">Using lambdas you can tidy this up to:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"            userState_.get().writeState(boolArg -&gt;\n            {\n               userPrefs_.get().writeUserPrefs(boolArg1 -&gt;\n               {\n                     initializeWorkbench();\n               });\n            });\n         }\"><pre><code>            userState_.get().writeState(boolArg -&gt;\n            {\n               userPrefs_.get().writeUserPrefs(boolArg1 -&gt;\n               {\n                     initializeWorkbench();\n               });\n            });\n         }\n</code></pre></div>\n<p dir=\"auto\">You could drop the braces and make it more compact, but I personally find that harder to read especially when there are multiple lambda happening at once (but that's just me):</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"            userState_.get().writeState(boolArg -&gt;\n               userPrefs_.get().writeUserPrefs(boolArg1 -&gt;\n                  initializeWorkbench()));\"><pre><code>            userState_.get().writeState(boolArg -&gt;\n               userPrefs_.get().writeUserPrefs(boolArg1 -&gt;\n                  initializeWorkbench()));\n</code></pre></div>", "author": "gtritchie", "createdAt": "2020-05-13T16:36:33Z", "path": "src/gwt/src/org/rstudio/studio/client/application/Application.java", "diffHunk": "@@ -206,7 +207,18 @@ public void run()\n             MathJaxLoader.ensureMathJaxLoaded();\n \n             // initialize workbench\n-            initializeWorkbench();\n+            // refresh prefs incase they were loaded without sessionInfo\n+            userState_.get().writeState(\n+                  new CommandWithArg<Boolean>() {\n+                     public void execute(Boolean arg) {\n+                        userPrefs_.get().writeUserPrefs(\n+                              new CommandWithArg<Boolean>() {\n+                                 public void execute(Boolean arg) {\n+                                    initializeWorkbench();\n+                                 }\n+                              });\n+                        }\n+                  });\n          }", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NjMwMQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424656301", "bodyText": "Thanks, I left the braces.", "author": "melissa-barca", "createdAt": "2020-05-13T18:46:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3NzI1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/application/Application.java b/src/gwt/src/org/rstudio/studio/client/application/Application.java\nindex c94d3a6fa5..5a669372c6 100644\n--- a/src/gwt/src/org/rstudio/studio/client/application/Application.java\n+++ b/src/gwt/src/org/rstudio/studio/client/application/Application.java\n", "chunk": "@@ -207,18 +207,15 @@ public class Application implements ApplicationEventHandlers\n             MathJaxLoader.ensureMathJaxLoaded();\n \n             // initialize workbench\n-            // refresh prefs incase they were loaded without sessionInfo\n-            userState_.get().writeState(\n-                  new CommandWithArg<Boolean>() {\n-                     public void execute(Boolean arg) {\n-                        userPrefs_.get().writeUserPrefs(\n-                              new CommandWithArg<Boolean>() {\n-                                 public void execute(Boolean arg) {\n-                                    initializeWorkbench();\n-                                 }\n-                              });\n-                        }\n-                  });\n+            // refresh prefs incase they were loaded without sessionInfo (this happens exclusively\n+            // in desktop mode, though unsure why)\n+            userState_.get().writeState(boolArg ->\n+            {\n+               userPrefs_.get().writeUserPrefs(boolArg1 ->\n+               {\n+                  initializeWorkbench();\n+               });\n+            });\n          }\n \n          public void onError(ServerError error)\n", "next_change": {"commit": "da79642e4625eacee3bc2b898472c46e884fa0ae", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/application/Application.java b/src/gwt/src/org/rstudio/studio/client/application/Application.java\nindex 5a669372c6..4f657a7822 100644\n--- a/src/gwt/src/org/rstudio/studio/client/application/Application.java\n+++ b/src/gwt/src/org/rstudio/studio/client/application/Application.java\n", "chunk": "@@ -223,8 +222,19 @@ public class Application implements ApplicationEventHandlers\n             Debug.logError(error);\n             dismissLoadingProgress.execute();\n \n-            globalDisplay_.showErrorMessage(\"RStudio Initialization Error\",\n-                                            error.getUserMessage());\n+            if (!StringUtil.isNullOrEmpty(error.getRedirectUrl()))\n+            {\n+               // error is informing us that we should redirect\n+               // redirect to the specified URL (as a sub URL of the site's root)\n+               String redirectUrl = ApplicationUtils.getHostPageBaseURLWithoutContext(false) + \n+            \t\t   error.getRedirectUrl();\n+               navigateWindowWithDelay(redirectUrl);\n+            }\n+            else\n+            {\n+               globalDisplay_.showErrorMessage(\"RStudio Initialization Error\",\n+                                               error.getUserMessage());\n+            }\n          }\n       };\n       \n", "next_change": {"commit": "cb3f6128fdebcf64586cf425d6a6eb53242e9a2f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/application/Application.java b/src/gwt/src/org/rstudio/studio/client/application/Application.java\nindex 4f657a7822..2ed35c536b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/application/Application.java\n+++ b/src/gwt/src/org/rstudio/studio/client/application/Application.java\n", "chunk": "@@ -237,17 +235,17 @@ public class Application implements ApplicationEventHandlers\n             }\n          }\n       };\n-      \n+\n       final ApplicationClientInit clientInit = pClientInit_.get();\n \n       if (timeoutOptions != null)\n       {\n          timeoutOptions.setObserver(clientInit);\n       }\n-      \n+\n       // read options from querystring\n       SessionInitOptions options = SessionInitOptions.create(\n-            SessionInitOptions.RESTORE_WORKSPACE_DEFAULT, \n+            SessionInitOptions.RESTORE_WORKSPACE_DEFAULT,\n             SessionInitOptions.RUN_RPROFILE_DEFAULT);\n       try\n       {\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MDIyNw==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424580227", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:41:08Z", "path": "src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java", "diffHunk": "@@ -65,7 +65,6 @@\n import org.rstudio.studio.client.workbench.prefs.events.UserPrefsChangedEvent;", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1MjQ1Nw==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424652457", "bodyText": "Done", "author": "melissa-barca", "createdAt": "2020-05-13T18:40:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MDIyNw=="}], "type": "inlineReview", "revised_code": {"commit": "b84d2f0e3aa32762ce8fcd842391f62c6b9d2e51", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java b/src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java\nindex 691131dfc9..d02166ada4 100644\n--- a/src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java\n+++ b/src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java\n", "chunk": "@@ -63,7 +63,6 @@ import org.rstudio.studio.client.workbench.WorkbenchContext;\n import org.rstudio.studio.client.workbench.commands.Commands;\n import org.rstudio.studio.client.workbench.model.Session;\n import org.rstudio.studio.client.workbench.prefs.events.UserPrefsChangedEvent;\n-import org.rstudio.studio.client.workbench.prefs.events.UserPrefsChangedHandler;\n import org.rstudio.studio.client.workbench.prefs.model.UserPrefs;\n import org.rstudio.studio.client.workbench.views.source.events.NotebookRenderFinishedEvent;\n \n", "next_change": {"commit": "92087c334dd6a86d1284e488dc27b26b6e22b310", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java b/src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java\nindex d02166ada4..2bd66288aa 100644\n--- a/src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java\n+++ b/src/gwt/src/org/rstudio/studio/client/rmarkdown/RmdOutput.java\n", "chunk": "@@ -71,7 +69,6 @@ import com.google.gwt.core.client.Scheduler;\n import com.google.gwt.core.client.Scheduler.ScheduledCommand;\n import com.google.gwt.event.logical.shared.ValueChangeEvent;\n import com.google.gwt.event.logical.shared.ValueChangeHandler;\n-import com.google.gwt.user.client.Command;\n import com.google.inject.Inject;\n import com.google.inject.Provider;\n import com.google.inject.Singleton;\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MTcwMQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424581701", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:43:29Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/viewer/ViewerPresenter.java", "diffHunk": "@@ -63,7 +63,6 @@\n import org.rstudio.studio.client.workbench.prefs.model.UserState;", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MzgyMQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424583821", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:46:53Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserState.java", "diffHunk": "@@ -18,6 +18,7 @@\n import com.google.inject.Inject;", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NjMwNg==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424586306", "body": "not needed", "bodyText": "not needed", "bodyHTML": "<p dir=\"auto\">not needed</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:50:42Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java", "diffHunk": "@@ -23,7 +23,9 @@\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n+import com.google.gwt.core.client.JsArrayString;", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5c6f5ac6e574d9f9f34b9ea17c934df021b22e7c", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 4ee9be9661..0ea6ace2ed 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -23,10 +23,7 @@ import org.rstudio.core.client.js.JsObject;\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n-import com.google.gwt.core.client.JsArrayString;\n import com.google.gwt.core.client.JsArray;\n-import org.rstudio.core.client.JsArrayUtil;\n-\n \n /**\n  * Accessor class for user state.\n", "next_change": {"commit": "d5fb4529898c7ababb66d90a8e6092c98ce98ad2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 0ea6ace2ed..5d10799455 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -25,6 +25,9 @@ import org.rstudio.studio.client.workbench.model.SessionInfo;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n /**\n  * Accessor class for user state.\n  */ \n", "next_change": {"commit": "18df34579d140228a29f069fca392bb63c7c68a8", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 5d10799455..510c1d1ad7 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -19,11 +19,13 @@\n \n package org.rstudio.studio.client.workbench.prefs.model;\n \n+import org.rstudio.core.client.JsArrayUtil;\n import org.rstudio.core.client.js.JsObject;\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n+import com.google.gwt.core.client.JsArrayString;\n \n import java.util.ArrayList;\n import java.util.List;\n", "next_change": {"commit": "16155412f8782edba0e81c2e70d8dd7ad86e3f20", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 510c1d1ad7..03549c8487 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -19,13 +19,11 @@\n \n package org.rstudio.studio.client.workbench.prefs.model;\n \n-import org.rstudio.core.client.JsArrayUtil;\n import org.rstudio.core.client.js.JsObject;\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n-import com.google.gwt.core.client.JsArrayString;\n \n import java.util.ArrayList;\n import java.util.List;\n", "next_change": {"commit": "56c8528bd899c88b1be5d126b784734c0eaaa2bb", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 03549c8487..091094833d 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -28,6 +28,8 @@ import com.google.gwt.core.client.JsArray;\n import java.util.ArrayList;\n import java.util.List;\n \n+import com.google.gwt.core.client.GWT;\n+\n /**\n  * Accessor class for user state.\n  */ \n", "next_change": {"commit": "8f85b6b8ed4e7db1ac167b2007d17e26c947e4fd", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 091094833d..696afaa22b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -28,8 +28,6 @@ import com.google.gwt.core.client.JsArray;\n import java.util.ArrayList;\n import java.util.List;\n \n-import com.google.gwt.core.client.GWT;\n-\n /**\n  * Accessor class for user state.\n  */ \n", "next_change": {"commit": "ccb01194363d9a4eff314a734a65e11880db6560", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 696afaa22b..c100ff9623 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -28,6 +28,8 @@ import com.google.gwt.core.client.JsArray;\n import java.util.ArrayList;\n import java.util.List;\n \n+import com.google.gwt.core.client.GWT;\n+\n /**\n  * Accessor class for user state.\n  */ \n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NjM5Ng==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424586396", "body": "not needed", "bodyText": "not needed", "bodyHTML": "<p dir=\"auto\">not needed</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:50:48Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java", "diffHunk": "@@ -23,7 +23,9 @@\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n+import com.google.gwt.core.client.JsArrayString;\n import com.google.gwt.core.client.JsArray;\n+import org.rstudio.core.client.JsArrayUtil;", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5c6f5ac6e574d9f9f34b9ea17c934df021b22e7c", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 4ee9be9661..0ea6ace2ed 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -23,10 +23,7 @@ import org.rstudio.core.client.js.JsObject;\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n-import com.google.gwt.core.client.JsArrayString;\n import com.google.gwt.core.client.JsArray;\n-import org.rstudio.core.client.JsArrayUtil;\n-\n \n /**\n  * Accessor class for user state.\n", "next_change": {"commit": "d5fb4529898c7ababb66d90a8e6092c98ce98ad2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 0ea6ace2ed..5d10799455 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -25,6 +25,9 @@ import org.rstudio.studio.client.workbench.model.SessionInfo;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n /**\n  * Accessor class for user state.\n  */ \n", "next_change": {"commit": "18df34579d140228a29f069fca392bb63c7c68a8", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 5d10799455..510c1d1ad7 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -19,11 +19,13 @@\n \n package org.rstudio.studio.client.workbench.prefs.model;\n \n+import org.rstudio.core.client.JsArrayUtil;\n import org.rstudio.core.client.js.JsObject;\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n+import com.google.gwt.core.client.JsArrayString;\n \n import java.util.ArrayList;\n import java.util.List;\n", "next_change": {"commit": "16155412f8782edba0e81c2e70d8dd7ad86e3f20", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 510c1d1ad7..03549c8487 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -19,13 +19,11 @@\n \n package org.rstudio.studio.client.workbench.prefs.model;\n \n-import org.rstudio.core.client.JsArrayUtil;\n import org.rstudio.core.client.js.JsObject;\n import org.rstudio.studio.client.workbench.model.SessionInfo;\n \n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n-import com.google.gwt.core.client.JsArrayString;\n \n import java.util.ArrayList;\n import java.util.List;\n", "next_change": {"commit": "56c8528bd899c88b1be5d126b784734c0eaaa2bb", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 03549c8487..091094833d 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -28,6 +28,8 @@ import com.google.gwt.core.client.JsArray;\n import java.util.ArrayList;\n import java.util.List;\n \n+import com.google.gwt.core.client.GWT;\n+\n /**\n  * Accessor class for user state.\n  */ \n", "next_change": {"commit": "8f85b6b8ed4e7db1ac167b2007d17e26c947e4fd", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 091094833d..696afaa22b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -28,8 +28,6 @@ import com.google.gwt.core.client.JsArray;\n import java.util.ArrayList;\n import java.util.List;\n \n-import com.google.gwt.core.client.GWT;\n-\n /**\n  * Accessor class for user state.\n  */ \n", "next_change": {"commit": "ccb01194363d9a4eff314a734a65e11880db6560", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\nindex 696afaa22b..c100ff9623 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserStateAccessor.java\n", "chunk": "@@ -28,6 +28,8 @@ import com.google.gwt.core.client.JsArray;\n import java.util.ArrayList;\n import java.util.List;\n \n+import com.google.gwt.core.client.GWT;\n+\n /**\n  * Accessor class for user state.\n  */ \n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NjkwNQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424586905", "body": "delete this extra line", "bodyText": "delete this extra line", "bodyHTML": "<p dir=\"auto\">delete this extra line</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:51:40Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -277,6 +279,7 @@ public PaneManager(Provider<MainSplitPanel> pSplitPanel,\n       left_ = createSplitWindow(panes_.get(0), panes_.get(1), LEFT_COLUMN, 0.4, splitterSize);\n       right_ = createSplitWindow(panes_.get(2), panes_.get(3), RIGHT_COLUMN, 0.6, splitterSize);\n \n+", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 6198028415..91e8a36709 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -279,7 +279,6 @@ public class PaneManager\n       left_ = createSplitWindow(panes_.get(0), panes_.get(1), LEFT_COLUMN, 0.4, splitterSize);\n       right_ = createSplitWindow(panes_.get(2), panes_.get(3), RIGHT_COLUMN, 0.6, splitterSize);\n \n-\n       panel_ = pSplitPanel.get();\n       panel_.initialize(left_, right_);\n       \n", "next_change": {"commit": "52fb6a4ec07e805d8468a7ec1ac49b2609b1fb82", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 91e8a36709..a461b4129a 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -280,7 +283,7 @@ public class PaneManager\n       right_ = createSplitWindow(panes_.get(2), panes_.get(3), RIGHT_COLUMN, 0.6, splitterSize);\n \n       panel_ = pSplitPanel.get();\n-      panel_.initialize(left_, right_);\n+      panel_.initialize(sourceColumns, left_, right_);\n       \n       // count the number of source docs assigned to this window\n       JsArray<SourceDocument> docs = \n", "next_change": {"commit": "e1debb632208db37860db4709e42c15c13ca0f6f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex a461b4129a..51ce12fbc0 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -283,21 +283,29 @@ public class PaneManager\n       right_ = createSplitWindow(panes_.get(2), panes_.get(3), RIGHT_COLUMN, 0.6, splitterSize);\n \n       panel_ = pSplitPanel.get();\n+\n+      //\u00a0get the widgets for the extra source columns to be displayed\n+      ArrayList<Widget> sourceColumns;\n+      if (source_.getViews().size() > 1)\n+         sourceColumns = new ArrayList<Widget>(\n+               source_.getViewsAsWidgets().subList(1, sourceColumnCount_ -1));\n+      else\n+         sourceColumns =  new ArrayList<Widget>();\n       panel_.initialize(sourceColumns, left_, right_);\n-      \n-      // count the number of source docs assigned to this window\n-      JsArray<SourceDocument> docs = \n-            session_.getSessionInfo().getSourceDocuments();\n-      String windowId = SourceWindowManager.getSourceWindowId();\n-      int numDocs = 0;\n-      for (int i = 0; i < docs.length(); i++)\n-      {\n-         String docWindowId = docs.get(i).getSourceWindowId();\n-         if (docWindowId == windowId)\n-         {\n-            numDocs++;\n-         }\n-      }\n+\n+     // count the number of source docs assigned to this window\n+     JsArray<SourceDocument> docs = \n+           session_.getSessionInfo().getSourceDocuments();\n+     String windowId = SourceWindowManager.getSourceWindowId();\n+     int numDocs = 0;\n+     for (int i = 0; i < docs.length(); i++)\n+     {\n+        String docWindowId = docs.get(i).getSourceWindowId();\n+        if (docWindowId == windowId)\n+        {\n+           numDocs++;\n+        }\n+     }\n       \n       for (LogicalWindow window : sourceLogicalWindows_)\n       {\n", "next_change": {"commit": "6de97083e41c743a20065ff175c4fe9945e840b9", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 51ce12fbc0..f7764ccb12 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -293,19 +292,19 @@ public class PaneManager\n          sourceColumns =  new ArrayList<Widget>();\n       panel_.initialize(sourceColumns, left_, right_);\n \n-     // count the number of source docs assigned to this window\n-     JsArray<SourceDocument> docs = \n-           session_.getSessionInfo().getSourceDocuments();\n-     String windowId = SourceWindowManager.getSourceWindowId();\n-     int numDocs = 0;\n-     for (int i = 0; i < docs.length(); i++)\n-     {\n-        String docWindowId = docs.get(i).getSourceWindowId();\n-        if (docWindowId == windowId)\n-        {\n-           numDocs++;\n-        }\n-     }\n+      // count the number of source docs assigned to this window\n+      JsArray<SourceDocument> docs = \n+            session_.getSessionInfo().getSourceDocuments();\n+      String windowId = SourceWindowManager.getSourceWindowId();\n+      int numDocs = 0;\n+      for (int i = 0; i < docs.length(); i++)\n+      {\n+         String docWindowId = docs.get(i).getSourceWindowId();\n+         if (docWindowId == windowId)\n+         {\n+            numDocs++;\n+         }\n+      }\n       \n       for (LogicalWindow window : sourceLogicalWindows_)\n       {\n", "next_change": {"commit": "5c6f5ac6e574d9f9f34b9ea17c934df021b22e7c", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex f7764ccb12..06bdb0b815 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -306,18 +295,16 @@ public class PaneManager\n          }\n       }\n       \n-      for (LogicalWindow window : sourceLogicalWindows_)\n+      if (numDocs == 0 && sourceLogicalWindow_.getState() != WindowState.HIDE)\n       {\n-         if (numDocs == 0 && window.getState() != WindowState.HIDE)\n-         {\n-            window.onWindowStateChange(\n-                  new WindowStateChangeEvent(WindowState.HIDE));\n-         }\n-         else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n-         {\n-            window.onWindowStateChange(\n-                  new WindowStateChangeEvent(WindowState.NORMAL));\n-         }\n+         sourceLogicalWindow_.onWindowStateChange(\n+               new WindowStateChangeEvent(WindowState.HIDE));\n+      }\n+      else if (numDocs > 0\n+               && sourceLogicalWindow_.getState() == WindowState.HIDE)\n+      {\n+         sourceLogicalWindow_.onWindowStateChange(\n+               new WindowStateChangeEvent(WindowState.NORMAL));\n       }\n \n       userPrefs.panes().addValueChangeHandler(evt ->\n", "next_change": {"commit": "c4f76e8ebed4986450805f52af7954955b010114", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 06bdb0b815..0557b849ba 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -295,16 +308,18 @@ public class PaneManager\n          }\n       }\n       \n-      if (numDocs == 0 && sourceLogicalWindow_.getState() != WindowState.HIDE)\n-      {\n-         sourceLogicalWindow_.onWindowStateChange(\n-               new WindowStateChangeEvent(WindowState.HIDE));\n-      }\n-      else if (numDocs > 0\n-               && sourceLogicalWindow_.getState() == WindowState.HIDE)\n+      for (LogicalWindow window : sourceLogicalWindows_)\n       {\n-         sourceLogicalWindow_.onWindowStateChange(\n-               new WindowStateChangeEvent(WindowState.NORMAL));\n+         if (numDocs == 0 && window.getState() != WindowState.HIDE)\n+         {\n+            window.onWindowStateChange(\n+                  new WindowStateChangeEvent(WindowState.HIDE));\n+         }\n+         else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n+         {\n+            window.onWindowStateChange(\n+                  new WindowStateChangeEvent(WindowState.NORMAL));\n+         }\n       }\n \n       userPrefs.panes().addValueChangeHandler(evt ->\n", "next_change": {"commit": "a5240b647de8e743f55a04aad93cac2b0d674c49", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 0557b849ba..780f223d7d 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -322,6 +322,7 @@ public class PaneManager\n          }\n       }\n \n+      source_.loadDisplay();\n       userPrefs.panes().addValueChangeHandler(evt ->\n       {\n          ArrayList<LogicalWindow> newPanes = createPanes(\n", "next_change": {"commit": "3fdda38e9a78a984a25c44e1672cf0869fad19cd", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 780f223d7d..9ea99c6515 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -308,21 +295,18 @@ public class PaneManager\n          }\n       }\n       \n-      for (LogicalWindow window : sourceLogicalWindows_)\n+      if (numDocs == 0 && sourceLogicalWindow_.getState() != WindowState.HIDE)\n       {\n-         if (numDocs == 0 && window.getState() != WindowState.HIDE)\n-         {\n-            window.onWindowStateChange(\n-                  new WindowStateChangeEvent(WindowState.HIDE));\n-         }\n-         else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n-         {\n-            window.onWindowStateChange(\n-                  new WindowStateChangeEvent(WindowState.NORMAL));\n-         }\n+         sourceLogicalWindow_.onWindowStateChange(\n+               new WindowStateChangeEvent(WindowState.HIDE));\n+      }\n+      else if (numDocs > 0\n+               && sourceLogicalWindow_.getState() == WindowState.HIDE)\n+      {\n+         sourceLogicalWindow_.onWindowStateChange(\n+               new WindowStateChangeEvent(WindowState.NORMAL));\n       }\n \n-      source_.loadDisplay();\n       userPrefs.panes().addValueChangeHandler(evt ->\n       {\n          ArrayList<LogicalWindow> newPanes = createPanes(\n", "next_change": {"commit": "91b6ee06cc56af6c542b24bdb6e63ce835afed79", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 9ea99c6515..cf1e114e88 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -295,18 +309,21 @@ public class PaneManager\n          }\n       }\n       \n-      if (numDocs == 0 && sourceLogicalWindow_.getState() != WindowState.HIDE)\n-      {\n-         sourceLogicalWindow_.onWindowStateChange(\n-               new WindowStateChangeEvent(WindowState.HIDE));\n-      }\n-      else if (numDocs > 0\n-               && sourceLogicalWindow_.getState() == WindowState.HIDE)\n+      for (LogicalWindow window : sourceLogicalWindows_)\n       {\n-         sourceLogicalWindow_.onWindowStateChange(\n-               new WindowStateChangeEvent(WindowState.NORMAL));\n+         if (numDocs == 0 && window.getState() != WindowState.HIDE)\n+         {\n+            window.onWindowStateChange(\n+                  new WindowStateChangeEvent(WindowState.HIDE));\n+         }\n+         else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n+         {\n+            window.onWindowStateChange(\n+                  new WindowStateChangeEvent(WindowState.NORMAL));\n+         }\n       }\n \n+      source_.loadDisplay();\n       userPrefs.panes().addValueChangeHandler(evt ->\n       {\n          ArrayList<LogicalWindow> newPanes = createPanes(\n", "next_change": {"commit": "df5ac59866ccf09903719bb138466099db1a20f7", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex cf1e114e88..3ac5d28ca8 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -308,22 +294,19 @@ public class PaneManager\n             numDocs++;\n          }\n       }\n-      \n-      for (LogicalWindow window : sourceLogicalWindows_)\n+\n+      if (numDocs == 0 && sourceLogicalWindow_.getState() != WindowState.HIDE)\n       {\n-         if (numDocs == 0 && window.getState() != WindowState.HIDE)\n-         {\n-            window.onWindowStateChange(\n-                  new WindowStateChangeEvent(WindowState.HIDE));\n-         }\n-         else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n-         {\n-            window.onWindowStateChange(\n-                  new WindowStateChangeEvent(WindowState.NORMAL));\n-         }\n+         sourceLogicalWindow_.onWindowStateChange(\n+               new WindowStateChangeEvent(WindowState.HIDE));\n+      }\n+      else if (numDocs > 0\n+               && sourceLogicalWindow_.getState() == WindowState.HIDE)\n+      {\n+         sourceLogicalWindow_.onWindowStateChange(\n+               new WindowStateChangeEvent(WindowState.NORMAL));\n       }\n \n-      source_.loadDisplay();\n       userPrefs.panes().addValueChangeHandler(evt ->\n       {\n          ArrayList<LogicalWindow> newPanes = createPanes(\n", "next_change": {"commit": "2e7020ca7ef21b96dd1b4e1424f56feb6d5b7f0f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 3ac5d28ca8..54db3e3dd5 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -294,19 +308,22 @@ public class PaneManager\n             numDocs++;\n          }\n       }\n-\n-      if (numDocs == 0 && sourceLogicalWindow_.getState() != WindowState.HIDE)\n-      {\n-         sourceLogicalWindow_.onWindowStateChange(\n-               new WindowStateChangeEvent(WindowState.HIDE));\n-      }\n-      else if (numDocs > 0\n-               && sourceLogicalWindow_.getState() == WindowState.HIDE)\n+      \n+      for (LogicalWindow window : sourceLogicalWindows_)\n       {\n-         sourceLogicalWindow_.onWindowStateChange(\n-               new WindowStateChangeEvent(WindowState.NORMAL));\n+         if (numDocs == 0 && window.getState() != WindowState.HIDE)\n+         {\n+            window.onWindowStateChange(\n+                  new WindowStateChangeEvent(WindowState.HIDE));\n+         }\n+         else if (numDocs > 0 && window.getState() == WindowState.HIDE)\n+         {\n+            window.onWindowStateChange(\n+                  new WindowStateChangeEvent(WindowState.NORMAL));\n+         }\n       }\n \n+      source_.loadDisplay();\n       userPrefs.panes().addValueChangeHandler(evt ->\n       {\n          ArrayList<LogicalWindow> newPanes = createPanes(\n", "next_change": {"commit": "da1f2b1a53af886edf8f21ccf12bec49870b3440", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 54db3e3dd5..3d5be52f2a 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -329,7 +368,7 @@ public class PaneManager\n          ArrayList<LogicalWindow> newPanes = createPanes(\n                validateConfig(evt.getValue().cast()));\n          panes_ = newPanes;\n-         left_.replaceWindows(newPanes.get(0), newPanes.get(1));\n+         center_.replaceWindows(newPanes.get(0), newPanes.get(1));\n          right_.replaceWindows(newPanes.get(2), newPanes.get(3));\n \n          tabSet1TabPanel_.clear();\n", "next_change": {"commit": "d52fb69f316f1f984af7c23ef6f9ab139d0bd32c", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 3d5be52f2a..218d437e44 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -368,7 +366,7 @@ public class PaneManager\n          ArrayList<LogicalWindow> newPanes = createPanes(\n                validateConfig(evt.getValue().cast()));\n          panes_ = newPanes;\n-         center_.replaceWindows(newPanes.get(0), newPanes.get(1));\n+         left_.replaceWindows(newPanes.get(0), newPanes.get(1));\n          right_.replaceWindows(newPanes.get(2), newPanes.get(3));\n \n          tabSet1TabPanel_.clear();\n", "next_change": {"commit": "23db03ce6cade3242092b1be37eec0d20ef6c3ce", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 218d437e44..f394973fe1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -366,7 +368,7 @@ public class PaneManager\n          ArrayList<LogicalWindow> newPanes = createPanes(\n                validateConfig(evt.getValue().cast()));\n          panes_ = newPanes;\n-         left_.replaceWindows(newPanes.get(0), newPanes.get(1));\n+         center_.replaceWindows(newPanes.get(0), newPanes.get(1));\n          right_.replaceWindows(newPanes.get(2), newPanes.get(3));\n \n          tabSet1TabPanel_.clear();\n", "next_change": {"commit": "6dd9859082c8cc35f4cb08fc19cae4dae492f0b4", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex f394973fe1..93e44c7697 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n", "chunk": "@@ -371,16 +371,27 @@ public class PaneManager\n          center_.replaceWindows(newPanes.get(0), newPanes.get(1));\n          right_.replaceWindows(newPanes.get(2), newPanes.get(3));\n \n+         tabs1_ = tabNamesToTabs(evt.getValue().getTabSet1());\n+         tabs2_ = tabNamesToTabs(evt.getValue().getTabSet2());\n+\n+         setWindowStateOnTabChange(panesByName_.get(\"TabSet1\"), tabSet1TabPanel_, tabs1_);\n+         setWindowStateOnTabChange(panesByName_.get(\"TabSet2\"), tabSet2TabPanel_, tabs2_);\n+         \n          tabSet1TabPanel_.clear();\n          tabSet2TabPanel_.clear();\n          hiddenTabSetTabPanel_.clear();\n-         tabs1_ = tabNamesToTabs(evt.getValue().getTabSet1());\n          populateTabPanel(tabs1_, tabSet1TabPanel_, tabSet1MinPanel_);\n-         tabs2_ = tabNamesToTabs(evt.getValue().getTabSet2());\n          populateTabPanel(tabs2_, tabSet2TabPanel_, tabSet2MinPanel_);\n          hiddenTabs_ = tabNamesToTabs(evt.getValue().getHiddenTabSet());\n          populateTabPanel(hiddenTabs_, hiddenTabSetTabPanel_, hiddenTabSetMinPanel_);\n \n+         // manage source column commands\n+         boolean visible = userPrefs.allowSourceColumns().getValue() &&\n+            (userPrefs.panes().getValue().getAdditionalSourceColumns() < MAX_COLUMN_COUNT);\n+\n+         commands_.newSourceColumn().setVisible(visible);\n+         commands_.openSourceDocNewColumn().setVisible(visible);\n+\n          manageLayoutCommands();\n       });\n \n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NzE4MQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424587181", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T16:52:11Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "diffHunk": "@@ -64,7 +64,7 @@\n import org.rstudio.studio.client.workbench.views.console.events.WorkingDirChangedHandler;", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3d90b2d61d1c2cc4f38c9c34bde30f6b216840e5", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\nindex b780eb6c37..1d3871e343 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n", "chunk": "@@ -61,7 +61,6 @@ import org.rstudio.studio.client.workbench.views.buildtools.model.BuildServerOpe\n import org.rstudio.studio.client.workbench.views.buildtools.model.BuildState;\n import org.rstudio.studio.client.workbench.views.console.events.SendToConsoleEvent;\n import org.rstudio.studio.client.workbench.views.console.events.WorkingDirChangedEvent;\n-import org.rstudio.studio.client.workbench.views.console.events.WorkingDirChangedHandler;\n import org.rstudio.studio.client.workbench.views.files.model.FilesServerOperations;\n import org.rstudio.studio.client.workbench.views.jobs.model.JobManager;\n import org.rstudio.studio.client.workbench.views.source.Source;\n", "next_change": {"commit": "cb3f6128fdebcf64586cf425d6a6eb53242e9a2f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\nindex 1d3871e343..c7dfd7068f 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n", "chunk": "@@ -66,34 +65,34 @@ import org.rstudio.studio.client.workbench.views.jobs.model.JobManager;\n import org.rstudio.studio.client.workbench.views.source.Source;\n import org.rstudio.studio.client.workbench.views.terminal.TerminalHelper;\n \n-public class BuildPresenter extends BasePresenter \n+public class BuildPresenter extends BasePresenter\n {\n    public interface Display extends WorkbenchView\n    {\n       void buildStarted();\n-      \n+\n       void showOutput(CompileOutput output, boolean tail);\n       void scrollToBottom();\n-      \n+\n       void showErrors(String basePath,\n-                      JsArray<SourceMarker> errors, \n+                      JsArray<SourceMarker> errors,\n                       boolean ensureVisible,\n                       int autoSelect,\n                       boolean openErrors,\n                       String buildType);\n       void buildCompleted();\n-      \n+\n       HasSelectionCommitHandlers<CodeNavigationTarget> errorList();\n-      \n+\n       HasSelectionCommitHandlers<String> buildSubType();\n-          \n+\n       HasClickHandlers stopButton();\n-      \n+\n       String errorsBuildType();\n    }\n-   \n+\n    @Inject\n-   public BuildPresenter(Display display, \n+   public BuildPresenter(Display display,\n                          GlobalDisplay globalDisplay,\n                          UserPrefs uiPrefs,\n                          WorkbenchContext workbenchContext,\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5MDUwMw==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424590503", "body": "While you're touching this... could be lambda-fied. Braces and newlines as you see fit:\r\n```\r\n      source_.withSaveFilesBeforeCommand(() ->\r\n      {\r\n         withDevtoolsLoadAllPath(loadAllPath ->\r\n         {\r\n            sendLoadCommandToConsole(\"devtools::load_all(\\\"\" + loadAllPath + \"\\\")\");\r\n         });\r\n      }, () -> {}, \"Build\");\r\n```", "bodyText": "While you're touching this... could be lambda-fied. Braces and newlines as you see fit:\n      source_.withSaveFilesBeforeCommand(() ->\n      {\n         withDevtoolsLoadAllPath(loadAllPath ->\n         {\n            sendLoadCommandToConsole(\"devtools::load_all(\\\"\" + loadAllPath + \"\\\")\");\n         });\n      }, () -> {}, \"Build\");", "bodyHTML": "<p dir=\"auto\">While you're touching this... could be lambda-fied. Braces and newlines as you see fit:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"      source_.withSaveFilesBeforeCommand(() -&gt;\n      {\n         withDevtoolsLoadAllPath(loadAllPath -&gt;\n         {\n            sendLoadCommandToConsole(&quot;devtools::load_all(\\&quot;&quot; + loadAllPath + &quot;\\&quot;)&quot;);\n         });\n      }, () -&gt; {}, &quot;Build&quot;);\"><pre><code>      source_.withSaveFilesBeforeCommand(() -&gt;\n      {\n         withDevtoolsLoadAllPath(loadAllPath -&gt;\n         {\n            sendLoadCommandToConsole(\"devtools::load_all(\\\"\" + loadAllPath + \"\\\")\");\n         });\n      }, () -&gt; {}, \"Build\");\n</code></pre></div>", "author": "gtritchie", "createdAt": "2020-05-13T16:57:24Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "diffHunk": "@@ -309,7 +309,7 @@ void onBuildAll()\n    \n    void onDevtoolsLoadAll()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1NzgzNg==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424657836", "bodyText": "Done.", "author": "melissa-barca", "createdAt": "2020-05-13T18:49:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5MDUwMw=="}], "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\nindex b780eb6c37..5396a3810a 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n", "chunk": "@@ -309,26 +309,13 @@ public class BuildPresenter extends BasePresenter\n    \n    void onDevtoolsLoadAll()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n-         @Override\n-         public void execute()\n-         {\n-            withDevtoolsLoadAllPath(new CommandWithArg<String>() {\n-               @Override\n-               public void execute(String loadAllPath)\n-               {\n-                  sendLoadCommandToConsole(\n-                              \"devtools::load_all(\\\"\" + loadAllPath + \"\\\")\");\n-               } \n-            }); \n-         }\n-      },\n-      new Command() {\n-         public void execute()\n+      source_.withSaveFilesBeforeCommand(() ->\n+      {\n+         withDevtoolsLoadAllPath(loadAllPath ->\n          {\n-         }\n-      },\n-      \"Build\");\n+            sendLoadCommandToConsole(\"devtools::load_all(\\\"\" + loadAllPath + \"\\\")\");\n+         });\n+      }, () -> {}, \"Build\");\n    }\n      \n    void onBuildSourcePackage()\n", "next_change": {"commit": "cb3f6128fdebcf64586cf425d6a6eb53242e9a2f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\nindex 5396a3810a..c7dfd7068f 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n", "chunk": "@@ -317,17 +306,17 @@ public class BuildPresenter extends BasePresenter\n          });\n       }, () -> {}, \"Build\");\n    }\n-     \n+\n    void onBuildSourcePackage()\n    {\n       startBuild(\"build-source-package\");\n    }\n-   \n+\n    void onBuildBinaryPackage()\n    {\n       startBuild(\"build-binary-package\");\n    }\n-   \n+\n    void onRoxygenizePackage()\n    {\n       dependencyManager_.withRoxygen(\n", "next_change": {"commit": "6f0eb6e50f9219ddd9a083eb6743ddc1827124a0", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\nindex c7dfd7068f..9d9b3a9528 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n", "chunk": "@@ -320,8 +339,8 @@ public class BuildPresenter extends BasePresenter\n    void onRoxygenizePackage()\n    {\n       dependencyManager_.withRoxygen(\n-            \"Building package documentation\",\n-            \"Building package documentation\",\n+            constants_.packageDocumentationProgressCaption(),\n+            constants_.packageDocumentationProgressCaption(),\n             () -> startBuild(\"roxygenize-package\"));\n    }\n \n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5MTc4Mw==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424591783", "body": "Another lambda-ing opportunity:\r\n\r\n```\r\n      source_.withSaveFilesBeforeCommand(() ->\r\n      {\r\n         server_.startBuild(type, subType, new SimpleRequestCallback<Boolean>() {\r\n            @Override\r\n            public void onResponseReceived(Boolean response)\r\n            {\r\n            }\r\n\r\n            @Override\r\n            public void onError(ServerError error)\r\n            {\r\n               super.onError(error);\r\n               workbenchContext_.setBuildInProgress(false);\r\n            }\r\n         });\r\n      }, () -> {}, \"Build\");\r\n```", "bodyText": "Another lambda-ing opportunity:\n      source_.withSaveFilesBeforeCommand(() ->\n      {\n         server_.startBuild(type, subType, new SimpleRequestCallback<Boolean>() {\n            @Override\n            public void onResponseReceived(Boolean response)\n            {\n            }\n\n            @Override\n            public void onError(ServerError error)\n            {\n               super.onError(error);\n               workbenchContext_.setBuildInProgress(false);\n            }\n         });\n      }, () -> {}, \"Build\");", "bodyHTML": "<p dir=\"auto\">Another lambda-ing opportunity:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"      source_.withSaveFilesBeforeCommand(() -&gt;\n      {\n         server_.startBuild(type, subType, new SimpleRequestCallback&lt;Boolean&gt;() {\n            @Override\n            public void onResponseReceived(Boolean response)\n            {\n            }\n\n            @Override\n            public void onError(ServerError error)\n            {\n               super.onError(error);\n               workbenchContext_.setBuildInProgress(false);\n            }\n         });\n      }, () -&gt; {}, &quot;Build&quot;);\"><pre><code>      source_.withSaveFilesBeforeCommand(() -&gt;\n      {\n         server_.startBuild(type, subType, new SimpleRequestCallback&lt;Boolean&gt;() {\n            @Override\n            public void onResponseReceived(Boolean response)\n            {\n            }\n\n            @Override\n            public void onError(ServerError error)\n            {\n               super.onError(error);\n               workbenchContext_.setBuildInProgress(false);\n            }\n         });\n      }, () -&gt; {}, \"Build\");\n</code></pre></div>", "author": "gtritchie", "createdAt": "2020-05-13T16:59:19Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java", "diffHunk": "@@ -442,7 +448,13 @@ public void onError(ServerError error)\n \n             });\n          }\n-      }, \"Build\");\n+      },\n+      new Command() {", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\nindex b780eb6c37..5396a3810a 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n", "chunk": "@@ -427,34 +414,23 @@ public class BuildPresenter extends BasePresenter\n       // attempt to start a build (this will be a silent no-op if there\n       // is already a build running)\n       workbenchContext_.setBuildInProgress(true);\n-      source_.withSaveFilesBeforeCommand(new Command() {\n-         @Override\n-         public void execute()\n-         {\n-            server_.startBuild(type, subType, \n-                  new SimpleRequestCallback<Boolean>() {\n-               @Override\n-               public void onResponseReceived(Boolean response)\n-               {\n-\n-               }\n+      source_.withSaveFilesBeforeCommand(() ->\n+      {\n+         server_.startBuild(type, subType, new SimpleRequestCallback<Boolean>() {\n+            @Override\n+            public void onResponseReceived(Boolean response)\n+            {\n+            }\n \n-               @Override\n-               public void onError(ServerError error)\n-               {\n-                  super.onError(error);\n-                  workbenchContext_.setBuildInProgress(false);\n-               }\n+            @Override\n+            public void onError(ServerError error)\n+            {\n+               super.onError(error);\n+               workbenchContext_.setBuildInProgress(false);\n+            }\n \n-            });\n-         }\n-      },\n-      new Command() {\n-         public void execute()\n-         {\n-         }\n-      },\n-      \"Build\");\n+         });\n+      }, () -> {}, \"Build\");\n    }\n \n    void onStopBuild()\n", "next_change": {"commit": "6f0eb6e50f9219ddd9a083eb6743ddc1827124a0", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\nindex 5396a3810a..9d9b3a9528 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/buildtools/BuildPresenter.java\n", "chunk": "@@ -436,20 +466,20 @@ public class BuildPresenter extends BasePresenter\n    void onStopBuild()\n    {\n        server_.terminateBuild(new DelayedProgressRequestCallback<Boolean>(\n-                                                       \"Terminating Build...\"){\n+                                                       constants_.terminatingBuildMessage()){\n          @Override\n          protected void onSuccess(Boolean response)\n          {\n             if (!response)\n             {\n                globalDisplay_.showErrorMessage(\n-                     \"Error Terminating Build\",\n-                     \"Unable to terminate build. Please try again.\");\n+                     constants_.errorTerminatingBuildCaption(),\n+                     constants_.errorTerminatingBuildMessage());\n             }\n          }\n-       });  \n+       });\n    }\n-   \n+\n    @Override\n    public void onSelected()\n    {\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NDcyMA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424594720", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:04:06Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java", "diffHunk": "@@ -83,7 +83,6 @@\n import org.rstudio.studio.client.workbench.views.environment.model.RObject;", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eee8192f8a852d9ac28481bf52a4f4d273ed8663", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\nindex d617cde3ba..0d61e9bbee 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n", "chunk": "@@ -83,6 +85,7 @@ import org.rstudio.studio.client.workbench.views.environment.model.EnvironmentSe\n import org.rstudio.studio.client.workbench.views.environment.model.RObject;\n import org.rstudio.studio.client.workbench.views.environment.view.EnvironmentClientState;\n import org.rstudio.studio.client.workbench.views.source.Source;\n+import org.rstudio.studio.client.workbench.views.source.SourceColumnManager;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserFinishedEvent;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserHighlightEvent;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserNavigationEvent;\n", "next_change": {"commit": "2377d488f3b224d1a284dac40c59c4a7aa21e777", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\nindex 0d61e9bbee..97940dc186 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n", "chunk": "@@ -89,6 +89,7 @@ import org.rstudio.studio.client.workbench.views.source.SourceColumnManager;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserFinishedEvent;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserHighlightEvent;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserNavigationEvent;\n+import org.rstudio.studio.client.workbench.views.source.events.ScrollToPositionEvent;\n import org.rstudio.studio.client.workbench.views.source.model.SourceServerOperations;\n \n import java.util.ArrayList;\n", "next_change": {"commit": "5380606fde18c3d97b05270e6fdbcafa2e563652", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\nindex 97940dc186..edaec6fefe 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n", "chunk": "@@ -85,7 +84,6 @@ import org.rstudio.studio.client.workbench.views.environment.model.EnvironmentSe\n import org.rstudio.studio.client.workbench.views.environment.model.RObject;\n import org.rstudio.studio.client.workbench.views.environment.view.EnvironmentClientState;\n import org.rstudio.studio.client.workbench.views.source.Source;\n-import org.rstudio.studio.client.workbench.views.source.SourceColumnManager;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserFinishedEvent;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserHighlightEvent;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserNavigationEvent;\n", "next_change": {"commit": "65506942fa3ba41e1484b562342d13d4eb63b38f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\nindex edaec6fefe..660cbfcde4 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n", "chunk": "@@ -81,8 +84,11 @@ import org.rstudio.studio.client.workbench.views.environment.model.CallFrame;\n import org.rstudio.studio.client.workbench.views.environment.model.DownloadInfo;\n import org.rstudio.studio.client.workbench.views.environment.model.EnvironmentContextData;\n import org.rstudio.studio.client.workbench.views.environment.model.EnvironmentServerOperations;\n+import org.rstudio.studio.client.workbench.views.environment.model.MemoryUsageReport;\n import org.rstudio.studio.client.workbench.views.environment.model.RObject;\n import org.rstudio.studio.client.workbench.views.environment.view.EnvironmentClientState;\n+import org.rstudio.studio.client.workbench.views.environment.view.MemoryUsageSummary;\n+import org.rstudio.studio.client.workbench.views.environment.view.MemoryUsageSummaryDialog;\n import org.rstudio.studio.client.workbench.views.source.Source;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserFinishedEvent;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserHighlightEvent;\n", "next_change": {"commit": "4cd9558a762b640b689776c2b330f3b457028336", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\nindex 660cbfcde4..7d00683c25 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n", "chunk": "@@ -87,7 +87,6 @@ import org.rstudio.studio.client.workbench.views.environment.model.EnvironmentSe\n import org.rstudio.studio.client.workbench.views.environment.model.MemoryUsageReport;\n import org.rstudio.studio.client.workbench.views.environment.model.RObject;\n import org.rstudio.studio.client.workbench.views.environment.view.EnvironmentClientState;\n-import org.rstudio.studio.client.workbench.views.environment.view.MemoryUsageSummary;\n import org.rstudio.studio.client.workbench.views.environment.view.MemoryUsageSummaryDialog;\n import org.rstudio.studio.client.workbench.views.source.Source;\n import org.rstudio.studio.client.workbench.views.source.events.CodeBrowserFinishedEvent;\n", "next_change": null}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NTI1Mw==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424595253", "body": "not used", "bodyText": "not used", "bodyHTML": "<p dir=\"auto\">not used</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:04:59Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -14,6 +14,7 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n+import com.google.gwt.core.client.GWT;", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..82c41da0b2 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -14,7 +14,6 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n-import com.google.gwt.core.client.GWT;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n", "next_change": {"commit": "6cd8b0a21c42715e7338de6aa1b3251a4224514b", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 82c41da0b2..a8b6ae8ca9 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -14,6 +14,7 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n+import com.google.gwt.core.client.GWT;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n", "next_change": {"commit": "f80341e1290ec0ed7126347d255c59d685a460ab", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex a8b6ae8ca9..c2171003a1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -14,7 +14,6 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n-import com.google.gwt.core.client.GWT;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n", "next_change": {"commit": "7e13afd3d15d3b84985f7deb0df7b80091f62c7e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex c2171003a1..4719ec35fc 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -14,6 +14,7 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n+import com.google.gwt.core.client.GWT;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n", "next_change": {"commit": "3fdda38e9a78a984a25c44e1672cf0869fad19cd", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 4719ec35fc..3daad397d3 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -14,7 +14,6 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n-import com.google.gwt.core.client.GWT;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n", "next_change": {"commit": "fcc85338d4567365a7461736d7350b9639fc8e00", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 3daad397d3..0141ba6497 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -14,6 +14,7 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n+import com.google.gwt.core.client.GWT;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n", "next_change": {"commit": "97eddbe8a25f6b54bb910fe9703052bb12efde0f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 0141ba6497..b6431bf1a6 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -14,7 +14,6 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n-import com.google.gwt.core.client.GWT;\n import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n", "next_change": {"commit": "b4aa7719fa1042d6151479dc111fedca120e9bdf", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex b6431bf1a6..dcadfa99c0 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -19,8 +19,6 @@ import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n import com.google.gwt.core.client.Scheduler;\n import com.google.gwt.core.client.Scheduler.ScheduledCommand;\n-import com.google.gwt.event.dom.client.ChangeEvent;\n-import com.google.gwt.event.dom.client.ChangeHandler;\n import com.google.gwt.event.dom.client.FocusEvent;\n import com.google.gwt.event.dom.client.KeyCodes;\n import com.google.gwt.event.logical.shared.HasBeforeSelectionHandlers;\n", "next_change": {"commit": "0f1748d525c17dbb9b4021d3cb65b3784e7e0c68", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex dcadfa99c0..c7e5ea0a19 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -14,7 +14,6 @@\n  */\n package org.rstudio.studio.client.workbench.views.source;\n \n-import com.google.gwt.core.client.JavaScriptObject;\n import com.google.gwt.core.client.JsArray;\n import com.google.gwt.core.client.JsArrayString;\n import com.google.gwt.core.client.Scheduler;\n", "next_change": {"commit": "9484252433810ac79cc940c4ef041bf2e5d8adee", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex c7e5ea0a19..7861be295a 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -22,7 +22,6 @@ import com.google.gwt.event.dom.client.FocusEvent;\n import com.google.gwt.event.dom.client.KeyCodes;\n import com.google.gwt.event.logical.shared.HasBeforeSelectionHandlers;\n import com.google.gwt.event.logical.shared.HasSelectionHandlers;\n-import com.google.gwt.event.shared.HandlerRegistration;\n import com.google.gwt.user.client.Command;\n import com.google.gwt.user.client.Event;\n import com.google.gwt.user.client.Event.NativePreviewEvent;\n", "next_change": {"commit": "0da6779905d14018e12dff776755a8daf1b0d61a", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 7861be295a..73e7948119 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -22,6 +22,7 @@ import com.google.gwt.event.dom.client.FocusEvent;\n import com.google.gwt.event.dom.client.KeyCodes;\n import com.google.gwt.event.logical.shared.HasBeforeSelectionHandlers;\n import com.google.gwt.event.logical.shared.HasSelectionHandlers;\n+import com.google.gwt.event.shared.HandlerRegistration;\n import com.google.gwt.user.client.Command;\n import com.google.gwt.user.client.Event;\n import com.google.gwt.user.client.Event.NativePreviewEvent;\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NzU3NQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424597575", "body": "Doesn't this trigger an infinite recursive loop? (onNewDocumentWithCode calling itself?).", "bodyText": "Doesn't this trigger an infinite recursive loop? (onNewDocumentWithCode calling itself?).", "bodyHTML": "<p dir=\"auto\">Doesn't this trigger an infinite recursive loop? (onNewDocumentWithCode calling itself?).</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:09:02Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -409,40 +413,48 @@ public Source(Commands commands,\n          command.setVisible(false);\n          command.setEnabled(false);\n       }\n-\n-      // fake shortcuts for commands which we handle at a lower level\n-      commands.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n-      commands.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n-\n-      // If tab has been disabled for auto complete by the user, set the \"shortcut\" to ctrl-space instead.\n-      if (userPrefs_.tabCompletion().getValue() && !userPrefs_.tabKeyMoveFocus().getValue())\n-         commands.codeCompletion().setShortcut(new KeyboardShortcut(\"Tab\", KeyCodes.KEY_TAB, KeyboardShortcut.NONE));\n-      else\n-      {\n-         KeySequence sequence = new KeySequence();\n-         sequence.add(new KeyCombination(\"Ctrl+Space\", KeyCodes.KEY_SPACE, KeyCodes.KEY_CTRL));\n-         commands.codeCompletion().setShortcut(new KeyboardShortcut(sequence));\n-      }\n-      \n-      events.addHandler(ShowContentEvent.TYPE, this);\n-      events.addHandler(ShowDataEvent.TYPE, this);\n-      events.addHandler(OpenObjectExplorerEvent.TYPE, this);\n-\n-      events.addHandler(CodeBrowserNavigationEvent.TYPE, this);\n       \n-      events.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n+      vimCommands_ = new SourceVimCommands();\n \n-      events.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n+      view_.addTabClosingHandler(this);\n+      view_.addTabCloseHandler(this);\n+      view_.addTabClosedHandler(this);\n+      view_.addTabReorderHandler(this);\n+      view_.addSelectionHandler(this);\n+      view_.addBeforeShowHandler(this);\n \n-      events.addHandler(FileTypeChangedEvent.TYPE, new FileTypeChangedHandler()\n+      events_.addHandler(EditPresentationSourceEvent.TYPE, this);\n+      events_.addHandler(FileEditEvent.TYPE, this);\n+      events_.addHandler(InsertSourceEvent.TYPE, this);\n+      events_.addHandler(ShowContentEvent.TYPE, this);\n+      events_.addHandler(ShowDataEvent.TYPE, this);\n+      events_.addHandler(OpenObjectExplorerEvent.TYPE, this);\n+      events_.addHandler(OpenPresentationSourceFileEvent.TYPE, this);\n+      events_.addHandler(OpenSourceFileEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserNavigationEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n+      events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n+      events_.addHandler(SnippetsChangedEvent.TYPE, this);\n+      events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n+\n+      events_.addHandler(FileTypeChangedEvent.TYPE, new FileTypeChangedHandler()\n       {\n          public void onFileTypeChanged(FileTypeChangedEvent event)\n          {\n             manageCommands();\n          }\n       });\n       \n-      events.addHandler(SourceOnSaveChangedEvent.TYPE, \n+      events_.addHandler(NewDocumentWithCodeEvent.TYPE,\n+                         new NewDocumentWithCodeEvent.Handler() {\n+         @Override\n+         public void onNewDocumentWithCode(NewDocumentWithCodeEvent event)\n+         {\n+            onNewDocumentWithCode(event);", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczOTI5MQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424739291", "bodyText": "You're right and we've already added the handler on +438 so I've removed this.", "author": "melissa-barca", "createdAt": "2020-05-13T21:23:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU5NzU3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "b51a5a1abe6b8eaa54470b881a1cfff19f3ca658", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..08fd2f2084 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -445,15 +444,6 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n       \n-      events_.addHandler(NewDocumentWithCodeEvent.TYPE,\n-                         new NewDocumentWithCodeEvent.Handler() {\n-         @Override\n-         public void onNewDocumentWithCode(NewDocumentWithCodeEvent event)\n-         {\n-            onNewDocumentWithCode(event);\n-         }\n-      });\n-\n       events_.addHandler(SourceOnSaveChangedEvent.TYPE, \n                         new SourceOnSaveChangedHandler() {\n          @Override\n", "next_change": {"commit": "b4aa7719fa1042d6151479dc111fedca120e9bdf", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 08fd2f2084..dcadfa99c0 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -436,20 +263,13 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n \n-      events_.addHandler(FileTypeChangedEvent.TYPE, new FileTypeChangedHandler()\n+      // !!! move to column manager\n+      events_.addHandler(DocTabActivatedEvent.TYPE, new DocTabActivatedEvent.Handler()\n       {\n-         public void onFileTypeChanged(FileTypeChangedEvent event)\n-         {\n-            manageCommands();\n-         }\n-      });\n-      \n-      events_.addHandler(SourceOnSaveChangedEvent.TYPE, \n-                        new SourceOnSaveChangedHandler() {\n-         @Override\n-         public void onSourceOnSaveChanged(SourceOnSaveChangedEvent event)\n+         public void onDocTabActivated(DocTabActivatedEvent event)\n          {\n-            manageSaveCommands();\n+\n+            columnManager_.setActiveDocId(event.getId());\n          }\n       });\n \n", "next_change": {"commit": "29ab246060f23296d28e8e105be209c40205d867", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex dcadfa99c0..242487f201 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -263,16 +270,6 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n \n-      // !!! move to column manager\n-      events_.addHandler(DocTabActivatedEvent.TYPE, new DocTabActivatedEvent.Handler()\n-      {\n-         public void onDocTabActivated(DocTabActivatedEvent event)\n-         {\n-\n-            columnManager_.setActiveDocId(event.getId());\n-         }\n-      });\n-\n       events_.addHandler(SwitchToDocEvent.TYPE, new SwitchToDocHandler()\n       {\n          public void onSwitchToDoc(SwitchToDocEvent event)\n", "next_change": {"commit": "2ff8bdf0a6b7282c92548a4fc52d0cd1d5b89f3d", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 242487f201..82d7283380 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -269,6 +322,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n+      events_.addHandler(XRefNavigationEvent.TYPE, this);\n \n       events_.addHandler(SwitchToDocEvent.TYPE, new SwitchToDocHandler()\n       {\n", "next_change": {"commit": "065ce3136b881eef2ccabafcff0ab630416dd9ae", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 82d7283380..1871fc523e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -322,7 +313,6 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n-      events_.addHandler(XRefNavigationEvent.TYPE, this);\n \n       events_.addHandler(SwitchToDocEvent.TYPE, new SwitchToDocHandler()\n       {\n", "next_change": {"commit": "77a15040fae10062c997cc72d52a5ba3d89cf6ea", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 1871fc523e..099b330388 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -313,6 +312,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n+      events_.addHandler(XRefNavigationEvent.TYPE, this);\n \n       events_.addHandler(SwitchToDocEvent.TYPE, new SwitchToDocHandler()\n       {\n", "next_change": {"commit": "12b87a84cf8594e96697c2b8a6f6b861244642c4", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 099b330388..4461869817 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -314,19 +324,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n \n-      events_.addHandler(SwitchToDocEvent.TYPE, new SwitchToDocHandler()\n-      {\n-         public void onSwitchToDoc(SwitchToDocEvent event)\n-         {\n-            columnManager_.ensureVisible(false);\n-            \n-            // Fire an activation event just to ensure the activated\n-            // tab gets focus\n-            commands_.activateSource().execute();\n-         }\n-      });\n-\n-      events_.addHandler(SourcePathChangedEvent.TYPE, \n+      events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n          \n", "next_change": {"commit": "532a64030c34005cec5144d5a28eeb8217097d69", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 4461869817..d1cf923689 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -324,7 +326,19 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n \n-      events_.addHandler(SourcePathChangedEvent.TYPE,\n+      events_.addHandler(SwitchToDocEvent.TYPE, new SwitchToDocHandler()\n+      {\n+         public void onSwitchToDoc(SwitchToDocEvent event)\n+         {\n+            columnManager_.ensureVisible(false);\n+            \n+            // Fire an activation event just to ensure the activated\n+            // tab gets focus\n+            commands_.activateSource().execute();\n+         }\n+      });\n+\n+      events_.addHandler(SourcePathChangedEvent.TYPE, \n             new SourcePathChangedEvent.Handler()\n       {\n          \n", "next_change": {"commit": "00cfd5a0f26d30b99d73156f2c89d6b2a39a107b", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex d1cf923689..4f05981cc4 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -326,19 +322,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n \n-      events_.addHandler(SwitchToDocEvent.TYPE, new SwitchToDocHandler()\n-      {\n-         public void onSwitchToDoc(SwitchToDocEvent event)\n-         {\n-            columnManager_.ensureVisible(false);\n-            \n-            // Fire an activation event just to ensure the activated\n-            // tab gets focus\n-            commands_.activateSource().execute();\n-         }\n-      });\n-\n-      events_.addHandler(SourcePathChangedEvent.TYPE, \n+      events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n          \n", "next_change": {"commit": "9ca25e3964734e51ae61eaf154aee05e37540c3c", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 4f05981cc4..243525d94a 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -321,6 +328,8 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n+      if (Desktop.hasDesktopFrame())\n+         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n \n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n", "next_change": {"commit": "2377d488f3b224d1a284dac40c59c4a7aa21e777", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 243525d94a..792123b36c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -326,6 +328,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n       events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n+      events_.addHandler(ScrollToPositionEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n", "next_change": {"commit": "5ba4653bbae1d557bd89e3fffff3b3e071d3a07e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 792123b36c..702c61aabe 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -328,7 +326,6 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n       events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n-      events_.addHandler(ScrollToPositionEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n", "next_change": {"commit": "0c4858cb7dd47016a872d3f3bb375afe768c7214", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 702c61aabe..521fd0673c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -326,6 +328,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n       events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n+      events_.addHandler(ScrollToPositionEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n", "next_change": {"commit": "07b5634fb240fdacbf7b17556fc779f323407451", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 521fd0673c..0c07859a1f 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -332,7 +336,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n-         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n+         events_.addHandler(MouseNavigateEvent.TYPE, this);\n \n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n", "next_change": {"commit": "11ddddd72af34d3c7884fabce1b8a544d9dc86ac", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 0c07859a1f..8f40b7dd15 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -336,7 +336,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n-         events_.addHandler(MouseNavigateEvent.TYPE, this);\n+         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n \n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n", "next_change": {"commit": "2ffbb8c164f85ac594d6106828f35aa9e0b81f18", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 8f40b7dd15..e576d02828 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -336,7 +338,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n-         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n+         events_.addHandler(MouseNavigateEvent.TYPE, this);\n \n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n", "next_change": {"commit": "ad62ae7a93f9751d3d1ef6bff40a32f68167da5c", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex e576d02828..260de94421 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -338,7 +336,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n-         events_.addHandler(MouseNavigateEvent.TYPE, this);\n+         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n \n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n", "next_change": {"commit": "53d8c0dd4a0f1d8ef4854dd3596f69bd63a8f76b", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 260de94421..830b920d80 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -336,7 +338,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n-         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n+         events_.addHandler(MouseNavigateEvent.TYPE, this);\n \n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n", "next_change": {"commit": "ddcd7191ec89c4da00e77afae7e9f27e61e87c36", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 830b920d80..f2b053c11f 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -338,7 +336,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n-         events_.addHandler(MouseNavigateEvent.TYPE, this);\n+         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n \n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n", "next_change": {"commit": "c2f82509d3fb8755ec89a4d2b41bda7578379e5d", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex f2b053c11f..a8117eb0ce 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -336,7 +339,7 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n       events_.addHandler(XRefNavigationEvent.TYPE, this);\n       if (Desktop.hasDesktopFrame())\n-         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n+         events_.addHandler(MouseNavigateEvent.TYPE, this);\n \n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n", "next_change": {"commit": "158f93133d96e8c2fd8429a2dcbe63c0cd025979", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex a8117eb0ce..c142b4f71c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -348,6 +337,9 @@ public class Source implements InsertSourceHandler,\n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n+            // Satellites also need to know about this happening, for example if a file\n+            // is renamed via the tab context menu or externally\n+            events_.fireEventToAllSatellites(event);\n \n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}, {"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 702c61aabe..521fd0673c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -334,18 +337,18 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-         \n+\n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-            \n+\n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath = \n+                  FileSystemItem toPath =\n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": null}]}}, {"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 792123b36c..702c61aabe 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -337,18 +334,18 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-\n+         \n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-\n+            \n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath =\n+                  FileSystemItem toPath = \n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": {"commit": "0c4858cb7dd47016a872d3f3bb375afe768c7214", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 702c61aabe..521fd0673c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -334,18 +337,18 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-         \n+\n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-            \n+\n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath = \n+                  FileSystemItem toPath =\n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": null}]}}]}}, {"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 243525d94a..792123b36c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -334,18 +337,18 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-         \n+\n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-            \n+\n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath = \n+                  FileSystemItem toPath =\n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": {"commit": "5ba4653bbae1d557bd89e3fffff3b3e071d3a07e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 792123b36c..702c61aabe 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -337,18 +334,18 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-\n+         \n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-\n+            \n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath =\n+                  FileSystemItem toPath = \n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": {"commit": "0c4858cb7dd47016a872d3f3bb375afe768c7214", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 702c61aabe..521fd0673c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -334,18 +337,18 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-         \n+\n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-            \n+\n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath = \n+                  FileSystemItem toPath =\n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwMzEzMA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424603130", "body": "extra whitespace", "bodyText": "extra whitespace", "bodyHTML": "<p dir=\"auto\">extra whitespace</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:18:22Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -464,15 +476,15 @@ public void onSwitchToDoc(SwitchToDocEvent event)\n          }\n       });\n \n-      events.addHandler(SourceFileSavedEvent.TYPE, new SourceFileSavedHandler()\n+      events_.addHandler(SourceFileSavedEvent.TYPE, new SourceFileSavedHandler()\n       {\n          public void onSourceFileSaved(SourceFileSavedEvent event)\n          {\n             pMruList_.get().add(event.getPath());\n          }\n       });\n-      \n-      events.addHandler(SourcePathChangedEvent.TYPE, \n+         ", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..82c41da0b2 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -483,7 +482,7 @@ public class Source implements InsertSourceHandler,\n             pMruList_.get().add(event.getPath());\n          }\n       });\n-         \n+\n       events_.addHandler(SourcePathChangedEvent.TYPE, \n             new SourcePathChangedEvent.Handler()\n       {\n", "next_change": {"commit": "97eddbe8a25f6b54bb910fe9703052bb12efde0f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 82c41da0b2..b6431bf1a6 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -475,14 +454,6 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n \n-      events_.addHandler(SourceFileSavedEvent.TYPE, new SourceFileSavedHandler()\n-      {\n-         public void onSourceFileSaved(SourceFileSavedEvent event)\n-         {\n-            pMruList_.get().add(event.getPath());\n-         }\n-      });\n-\n       events_.addHandler(SourcePathChangedEvent.TYPE, \n             new SourcePathChangedEvent.Handler()\n       {\n", "next_change": {"commit": "25802daf75dce70a540d5f948a80c9bb0bc4c884", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex b6431bf1a6..9208ee632e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -462,7 +448,7 @@ public class Source implements InsertSourceHandler,\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n             \n-            inEditorForPath(event.getFrom(), \n+            columnManager_.inEditorForPath(event.getFrom(), \n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n", "next_change": {"commit": "d5d6cfcbf0e3b5859c552f6997a5bd0715f0071f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 9208ee632e..901d7e14e1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -448,7 +300,7 @@ public class Source implements InsertSourceHandler,\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n             \n-            columnManager_.inEditorForPath(event.getFrom(), \n+            columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n", "next_change": {"commit": "2377d488f3b224d1a284dac40c59c4a7aa21e777", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 901d7e14e1..792123b36c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -268,45 +328,27 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(CodeBrowserFinishedEvent.TYPE, this);\n       events_.addHandler(CodeBrowserHighlightEvent.TYPE, this);\n       events_.addHandler(SnippetsChangedEvent.TYPE, this);\n+      events_.addHandler(ScrollToPositionEvent.TYPE, this);\n       events_.addHandler(NewDocumentWithCodeEvent.TYPE, this);\n+      events_.addHandler(XRefNavigationEvent.TYPE, this);\n+      if (Desktop.hasDesktopFrame())\n+         events_.addHandler(MouseNavigateSourceHistoryEvent.TYPE, this);\n \n-      // !!! move to column manager\n-      events_.addHandler(DocTabActivatedEvent.TYPE, new DocTabActivatedEvent.Handler()\n-      {\n-         public void onDocTabActivated(DocTabActivatedEvent event)\n-         {\n-\n-            columnManager_.setActiveDocId(event.getId());\n-         }\n-      });\n-\n-      events_.addHandler(SwitchToDocEvent.TYPE, new SwitchToDocHandler()\n-      {\n-         public void onSwitchToDoc(SwitchToDocEvent event)\n-         {\n-            columnManager_.ensureVisible(false);\n-            \n-            // Fire an activation event just to ensure the activated\n-            // tab gets focus\n-            commands_.activateSource().execute();\n-         }\n-      });\n-\n-      events_.addHandler(SourcePathChangedEvent.TYPE, \n+      events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-         \n+\n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-            \n+\n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath = \n+                  FileSystemItem toPath =\n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": {"commit": "5ba4653bbae1d557bd89e3fffff3b3e071d3a07e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 792123b36c..702c61aabe 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -337,18 +334,18 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-\n+         \n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-\n+            \n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath =\n+                  FileSystemItem toPath = \n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": {"commit": "0c4858cb7dd47016a872d3f3bb375afe768c7214", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 702c61aabe..521fd0673c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -334,18 +337,18 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(SourcePathChangedEvent.TYPE,\n             new SourcePathChangedEvent.Handler()\n       {\n-         \n+\n          @Override\n          public void onSourcePathChanged(final SourcePathChangedEvent event)\n          {\n-            \n+\n             columnManager_.inEditorForPath(event.getFrom(),\n                             new OperationWithInput<EditingTarget>()\n             {\n                @Override\n                public void execute(EditingTarget input)\n                {\n-                  FileSystemItem toPath = \n+                  FileSystemItem toPath =\n                         FileSystemItem.createFile(event.getTo());\n                   if (input instanceof TextEditingTarget)\n                   {\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwMzI2NA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424603264", "body": "extra whitespace", "bodyText": "extra whitespace", "bodyHTML": "<p dir=\"auto\">extra whitespace</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:18:32Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -518,8 +530,8 @@ public void onSourceNavigation(SourceNavigationEvent event)\n          }\n       });\n       \n-      events.addHandler(SourceExtendedTypeDetectedEvent.TYPE, this);\n-      \n+      events_.addHandler(SourceExtendedTypeDetectedEvent.TYPE, this);\n+         ", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..82c41da0b2 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -531,7 +530,7 @@ public class Source implements InsertSourceHandler,\n       });\n       \n       events_.addHandler(SourceExtendedTypeDetectedEvent.TYPE, this);\n-         \n+\n       sourceNavigationHistory_.addChangeHandler(new ChangeHandler()\n       {\n \n", "next_change": {"commit": "25802daf75dce70a540d5f948a80c9bb0bc4c884", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 82c41da0b2..9208ee632e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -529,8 +486,6 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n       \n-      events_.addHandler(SourceExtendedTypeDetectedEvent.TYPE, this);\n-\n       sourceNavigationHistory_.addChangeHandler(new ChangeHandler()\n       {\n \n", "next_change": {"commit": "b4aa7719fa1042d6151479dc111fedca120e9bdf", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 9208ee632e..dcadfa99c0 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -486,26 +331,6 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n       \n-      sourceNavigationHistory_.addChangeHandler(new ChangeHandler()\n-      {\n-\n-         @Override\n-         public void onChange(ChangeEvent event)\n-         {\n-            manageSourceNavigationCommands();\n-         }\n-      });\n-      \n-      events_.addHandler(SynctexStatusChangedEvent.TYPE, \n-                        new SynctexStatusChangedEvent.Handler()\n-      {\n-         @Override\n-         public void onSynctexStatusChanged(SynctexStatusChangedEvent event)\n-         {\n-            manageSynctexCommands();\n-         }\n-      });\n-      \n       events_.addHandler(CollabEditStartedEvent.TYPE, \n             new CollabEditStartedEvent.Handler() \n       {\n", "next_change": {"commit": "d5d6cfcbf0e3b5859c552f6997a5bd0715f0071f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex dcadfa99c0..901d7e14e1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -330,7 +337,7 @@ public class Source implements InsertSourceHandler,\n             }\n          }\n       });\n-      \n+\n       events_.addHandler(CollabEditStartedEvent.TYPE, \n             new CollabEditStartedEvent.Handler() \n       {\n", "next_change": {"commit": "0f1748d525c17dbb9b4021d3cb65b3784e7e0c68", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 901d7e14e1..c7e5ea0a19 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -333,7 +315,7 @@ public class Source implements InsertSourceHandler,\n          {\n             if (!suspendSourceNavigationAdding_)\n             {\n-               sourceNavigationHistory_.add(event.getNavigation());\n+               columnManager_.getSourceNavigationHistory().add(event.getNavigation());\n             }\n          }\n       });\n", "next_change": {"commit": "065ce3136b881eef2ccabafcff0ab630416dd9ae", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex c7e5ea0a19..1871fc523e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -308,19 +360,7 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n \n-      events_.addHandler(SourceNavigationEvent.TYPE, \n-                        new SourceNavigationHandler() {\n-         @Override\n-         public void onSourceNavigation(SourceNavigationEvent event)\n-         {\n-            if (!suspendSourceNavigationAdding_)\n-            {\n-               columnManager_.getSourceNavigationHistory().add(event.getNavigation());\n-            }\n-         }\n-      });\n-\n-      events_.addHandler(CollabEditStartedEvent.TYPE, \n+      events_.addHandler(CollabEditStartedEvent.TYPE,\n             new CollabEditStartedEvent.Handler() \n       {\n          @Override\n", "next_change": {"commit": "7b000de8d04fc2c6652f526550b0c09e28d01ab7", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 1871fc523e..407fd57a5d 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -360,7 +372,19 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n \n-      events_.addHandler(CollabEditStartedEvent.TYPE,\n+      events_.addHandler(SourceNavigationEvent.TYPE, \n+                        new SourceNavigationHandler() {\n+         @Override\n+         public void onSourceNavigation(SourceNavigationEvent event)\n+         {\n+            if (!suspendSourceNavigationAdding_)\n+            {\n+               columnManager_.getSourceNavigationHistory().add(event.getNavigation());\n+            }\n+         }\n+      });\n+\n+      events_.addHandler(CollabEditStartedEvent.TYPE, \n             new CollabEditStartedEvent.Handler() \n       {\n          @Override\n", "next_change": {"commit": "f535ced4b6e7e6d9d8e2aebec3870bddca7fe12a", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 407fd57a5d..db00d3851b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -384,7 +380,7 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n \n-      events_.addHandler(CollabEditStartedEvent.TYPE, \n+      events_.addHandler(CollabEditStartedEvent.TYPE,\n             new CollabEditStartedEvent.Handler() \n       {\n          @Override\n", "next_change": {"commit": "12b87a84cf8594e96697c2b8a6f6b861244642c4", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex db00d3851b..4461869817 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -380,7 +370,7 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n \n-      events_.addHandler(CollabEditStartedEvent.TYPE,\n+      events_.addHandler(CollabEditStartedEvent.TYPE, \n             new CollabEditStartedEvent.Handler() \n       {\n          @Override\n", "next_change": {"commit": "00cfd5a0f26d30b99d73156f2c89d6b2a39a107b", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 4461869817..4f05981cc4 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -370,7 +368,7 @@ public class Source implements InsertSourceHandler,\n          }\n       });\n \n-      events_.addHandler(CollabEditStartedEvent.TYPE, \n+      events_.addHandler(CollabEditStartedEvent.TYPE,\n             new CollabEditStartedEvent.Handler() \n       {\n          @Override\n", "next_change": {"commit": "2377d488f3b224d1a284dac40c59c4a7aa21e777", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 4f05981cc4..792123b36c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -369,10 +381,10 @@ public class Source implements InsertSourceHandler,\n       });\n \n       events_.addHandler(CollabEditStartedEvent.TYPE,\n-            new CollabEditStartedEvent.Handler() \n+            new CollabEditStartedEvent.Handler()\n       {\n          @Override\n-         public void onCollabEditStarted(final CollabEditStartedEvent collab) \n+         public void onCollabEditStarted(final CollabEditStartedEvent collab)\n          {\n             columnManager_.inEditorForPath(collab.getStartParams().getPath(),\n                new OperationWithInput<EditingTarget>()\n", "next_change": {"commit": "5ba4653bbae1d557bd89e3fffff3b3e071d3a07e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 792123b36c..702c61aabe 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -381,10 +378,10 @@ public class Source implements InsertSourceHandler,\n       });\n \n       events_.addHandler(CollabEditStartedEvent.TYPE,\n-            new CollabEditStartedEvent.Handler()\n+            new CollabEditStartedEvent.Handler() \n       {\n          @Override\n-         public void onCollabEditStarted(final CollabEditStartedEvent collab)\n+         public void onCollabEditStarted(final CollabEditStartedEvent collab) \n          {\n             columnManager_.inEditorForPath(collab.getStartParams().getPath(),\n                new OperationWithInput<EditingTarget>()\n", "next_change": {"commit": "0c4858cb7dd47016a872d3f3bb375afe768c7214", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 702c61aabe..521fd0673c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -378,10 +381,10 @@ public class Source implements InsertSourceHandler,\n       });\n \n       events_.addHandler(CollabEditStartedEvent.TYPE,\n-            new CollabEditStartedEvent.Handler() \n+            new CollabEditStartedEvent.Handler()\n       {\n          @Override\n-         public void onCollabEditStarted(final CollabEditStartedEvent collab) \n+         public void onCollabEditStarted(final CollabEditStartedEvent collab)\n          {\n             columnManager_.inEditorForPath(collab.getStartParams().getPath(),\n                new OperationWithInput<EditingTarget>()\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNDQzMg==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424604432", "body": "Why is this added here?", "bodyText": "Why is this added here?", "bodyHTML": "<p dir=\"auto\">Why is this added here?</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:20:24Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -688,14 +727,61 @@ else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDIN\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session);\n+         openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n       \n       // add vim commands\n       initVimCommands();\n+      ensureVisible(false);", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY4NDg1Ng==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424684856", "bodyText": "Original thought process was that at this point we don't need to be visible but there's no need to ensure it so I've removed.", "author": "melissa-barca", "createdAt": "2020-05-13T19:38:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNDQzMg=="}], "type": "inlineReview", "revised_code": {"commit": "2050408f950459d3e5c3f72ed9385da57a0e8b79", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..5ec2845fa5 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -733,9 +732,15 @@ public class Source implements InsertSourceHandler,\n       \n       // add vim commands\n       initVimCommands();\n-      ensureVisible(false);\n    }\n    \n+   /**\n+    * Process the save_files_before_build user preference.\n+    * If false, ask the user how to handle unsaved changes and act accordingly.\n+    * @param command The command to run after the files are handled.\n+    * @param cancelCommand The command to run if the user cancels the request.\n+    * @param commandSource The title to be used by the dialog asking how to handle files.\n+    */\n    public void withSaveFilesBeforeCommand(final Command command,\n                                           final Command cancelCommand,\n                                           String commandSource)\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNTA3MA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424605070", "body": "Brief JavaDoc comment about method's purpose would be good.", "bodyText": "Brief JavaDoc comment about method's purpose would be good.", "bodyHTML": "<p dir=\"auto\">Brief JavaDoc comment about method's purpose would be good.</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:21:25Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -688,14 +727,61 @@ else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDIN\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session);\n+         openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n       \n       // add vim commands\n       initVimCommands();\n+      ensureVisible(false);\n    }\n    \n+   public void withSaveFilesBeforeCommand(final Command command,", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY4NDE4OQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424684189", "bodyText": "Added.", "author": "melissa-barca", "createdAt": "2020-05-13T19:36:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNTA3MA=="}], "type": "inlineReview", "revised_code": {"commit": "2050408f950459d3e5c3f72ed9385da57a0e8b79", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..5ec2845fa5 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -733,9 +732,15 @@ public class Source implements InsertSourceHandler,\n       \n       // add vim commands\n       initVimCommands();\n-      ensureVisible(false);\n    }\n    \n+   /**\n+    * Process the save_files_before_build user preference.\n+    * If false, ask the user how to handle unsaved changes and act accordingly.\n+    * @param command The command to run after the files are handled.\n+    * @param cancelCommand The command to run if the user cancels the request.\n+    * @param commandSource The title to be used by the dialog asking how to handle files.\n+    */\n    public void withSaveFilesBeforeCommand(final Command command,\n                                           final Command cancelCommand,\n                                           String commandSource)\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwNzAwNA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424607004", "body": "lambda:\r\n\r\n```\r\n            new UnsavedChangesDialog(\r\n                  commandSource,\r\n                  alwaysSaveOption,\r\n                  unsavedSourceDocs,\r\n                  dialogResult ->\r\n                  {\r\n                     if (dialogResult.getAlwaysSave())\r\n                     {\r\n                        userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\r\n                        userPrefs_.writeUserPrefs();\r\n                     }\r\n   \r\n                     handleUnsavedChangesBeforeExit(\r\n                                           dialogResult.getSaveTargets(),\r\n                                           command);\r\n   \r\n                  },\r\n                  cancelCommand\r\n            ).showModal();\r\n```", "bodyText": "lambda:\n            new UnsavedChangesDialog(\n                  commandSource,\n                  alwaysSaveOption,\n                  unsavedSourceDocs,\n                  dialogResult ->\n                  {\n                     if (dialogResult.getAlwaysSave())\n                     {\n                        userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\n                        userPrefs_.writeUserPrefs();\n                     }\n   \n                     handleUnsavedChangesBeforeExit(\n                                           dialogResult.getSaveTargets(),\n                                           command);\n   \n                  },\n                  cancelCommand\n            ).showModal();", "bodyHTML": "<p dir=\"auto\">lambda:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"            new UnsavedChangesDialog(\n                  commandSource,\n                  alwaysSaveOption,\n                  unsavedSourceDocs,\n                  dialogResult -&gt;\n                  {\n                     if (dialogResult.getAlwaysSave())\n                     {\n                        userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\n                        userPrefs_.writeUserPrefs();\n                     }\n   \n                     handleUnsavedChangesBeforeExit(\n                                           dialogResult.getSaveTargets(),\n                                           command);\n   \n                  },\n                  cancelCommand\n            ).showModal();\"><pre><code>            new UnsavedChangesDialog(\n                  commandSource,\n                  alwaysSaveOption,\n                  unsavedSourceDocs,\n                  dialogResult -&gt;\n                  {\n                     if (dialogResult.getAlwaysSave())\n                     {\n                        userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\n                        userPrefs_.writeUserPrefs();\n                     }\n   \n                     handleUnsavedChangesBeforeExit(\n                                           dialogResult.getSaveTargets(),\n                                           command);\n   \n                  },\n                  cancelCommand\n            ).showModal();\n</code></pre></div>", "author": "gtritchie", "createdAt": "2020-05-13T17:24:36Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -688,14 +727,61 @@ else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDIN\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session);\n+         openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n       \n       // add vim commands\n       initVimCommands();\n+      ensureVisible(false);\n    }\n    \n+   public void withSaveFilesBeforeCommand(final Command command,\n+                                          final Command cancelCommand,\n+                                          String commandSource)\n+   {\n+      if (userPrefs_.saveFilesBeforeBuild().getValue())\n+      {\n+         saveUnsavedDocuments(command);\n+      }\n+      else\n+      {\n+         String alwaysSaveOption = !userPrefs_.saveFilesBeforeBuild().getValue() ?\n+                                    \"Always save files before build\" : null;\n+\n+         ArrayList<UnsavedChangesTarget> unsavedSourceDocs = getUnsavedChanges(TYPE_FILE_BACKED);\n+\n+         if (unsavedSourceDocs.size() > 0)\n+         {\n+            new UnsavedChangesDialog(\n+                  commandSource,\n+                  alwaysSaveOption,\n+                  unsavedSourceDocs,\n+                  new OperationWithInput<UnsavedChangesDialog.Result>() {\n+                     public void execute(UnsavedChangesDialog.Result result)\n+                     {\n+                        if (result.getAlwaysSave())\n+                        {\n+                           userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\n+                           userPrefs_.writeUserPrefs();\n+                        }\n+\n+                        handleUnsavedChangesBeforeExit(\n+                                              result.getSaveTargets(),\n+                                              command);\n+\n+                     }\n+                   },\n+                   cancelCommand\n+            ).showModal();", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..82c41da0b2 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -757,22 +756,19 @@ public class Source implements InsertSourceHandler,\n                   commandSource,\n                   alwaysSaveOption,\n                   unsavedSourceDocs,\n-                  new OperationWithInput<UnsavedChangesDialog.Result>() {\n-                     public void execute(UnsavedChangesDialog.Result result)\n+                  dialogResult ->\n+                  {\n+                     if (dialogResult.getAlwaysSave())\n                      {\n-                        if (result.getAlwaysSave())\n-                        {\n-                           userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\n-                           userPrefs_.writeUserPrefs();\n-                        }\n-\n-                        handleUnsavedChangesBeforeExit(\n-                                              result.getSaveTargets(),\n-                                              command);\n-\n+                        userPrefs_.saveFilesBeforeBuild().setGlobalValue(true);\n+                        userPrefs_.writeUserPrefs();\n                      }\n-                   },\n-                   cancelCommand\n+                     handleUnsavedChangesBeforeExit(\n+                                           dialogResult.getSaveTargets(),\n+                                           command);\n+\n+                  },\n+                  cancelCommand\n             ).showModal();\n          }\n          else\n", "next_change": {"commit": "f80341e1290ec0ed7126347d255c59d685a460ab", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 82c41da0b2..c2171003a1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -777,6 +777,16 @@ public class Source implements InsertSourceHandler,\n          }\n       }\n    }\n+   \n+   // see if there are additional command pallette entries made available\n+   // the by the active editor\n+   public List<CommandPaletteEntry> getCommandPaletteEntries()\n+   {\n+      if (activeEditor_ != null) \n+         return activeEditor_.getCommandPaletteEntries();\n+      else\n+         return null;\n+   }\n \n    private boolean consoleEditorHadFocusLast()\n    {\n", "next_change": {"commit": "7e13afd3d15d3b84985f7deb0df7b80091f62c7e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex c2171003a1..4719ec35fc 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -777,16 +903,6 @@ public class Source implements InsertSourceHandler,\n          }\n       }\n    }\n-   \n-   // see if there are additional command pallette entries made available\n-   // the by the active editor\n-   public List<CommandPaletteEntry> getCommandPaletteEntries()\n-   {\n-      if (activeEditor_ != null) \n-         return activeEditor_.getCommandPaletteEntries();\n-      else\n-         return null;\n-   }\n \n    private boolean consoleEditorHadFocusLast()\n    {\n", "next_change": {"commit": "3fdda38e9a78a984a25c44e1672cf0869fad19cd", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 4719ec35fc..3daad397d3 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -903,6 +777,16 @@ public class Source implements InsertSourceHandler,\n          }\n       }\n    }\n+   \n+   // see if there are additional command pallette entries made available\n+   // the by the active editor\n+   public List<CommandPaletteEntry> getCommandPaletteEntries()\n+   {\n+      if (activeEditor_ != null) \n+         return activeEditor_.getCommandPaletteEntries();\n+      else\n+         return null;\n+   }\n \n    private boolean consoleEditorHadFocusLast()\n    {\n", "next_change": {"commit": "fcc85338d4567365a7461736d7350b9639fc8e00", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 3daad397d3..0141ba6497 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -777,16 +928,6 @@ public class Source implements InsertSourceHandler,\n          }\n       }\n    }\n-   \n-   // see if there are additional command pallette entries made available\n-   // the by the active editor\n-   public List<CommandPaletteEntry> getCommandPaletteEntries()\n-   {\n-      if (activeEditor_ != null) \n-         return activeEditor_.getCommandPaletteEntries();\n-      else\n-         return null;\n-   }\n \n    private boolean consoleEditorHadFocusLast()\n    {\n", "next_change": {"commit": "d5d6cfcbf0e3b5859c552f6997a5bd0715f0071f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 0141ba6497..901d7e14e1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -929,6 +599,16 @@ public class Source implements InsertSourceHandler,\n       }\n    }\n \n+   // see if there are additional command pallette entries made available\n+   // the by the active editor\n+   public List<CommandPaletteEntry> getCommandPaletteEntries()\n+   {\n+      if (activeEditor_ != null)\n+         return activeEditor_.getCommandPaletteEntries();\n+      else\n+         return null;\n+   }\n+\n    private boolean consoleEditorHadFocusLast()\n    {\n       String id = MainWindowObject.lastFocusedEditorId().get();\n", "next_change": {"commit": "29ab246060f23296d28e8e105be209c40205d867", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 901d7e14e1..242487f201 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -609,6 +599,11 @@ public class Source implements InsertSourceHandler,\n          return null;\n    }\n \n+   public SourceColumnManager getColumnManager()\n+   {\n+      return columnManager_;\n+   }\n+\n    private boolean consoleEditorHadFocusLast()\n    {\n       String id = MainWindowObject.lastFocusedEditorId().get();\n", "next_change": {"commit": "0f1748d525c17dbb9b4021d3cb65b3784e7e0c68", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 242487f201..c7e5ea0a19 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -609,94 +595,6 @@ public class Source implements InsertSourceHandler,\n       String id = MainWindowObject.lastFocusedEditorId().get();\n       return \"rstudio_console_input\".equals(id);\n    }\n-   \n-   private void withTarget(String id,\n-                           CommandWithArg<TextEditingTarget> command,\n-                           Command onFailure)\n-   {\n-      EditingTarget target = StringUtil.isNullOrEmpty(id)\n-            ? activeEditor_\n-            : columnManager_.findEditor(id);\n-      \n-      if (target == null)\n-      {\n-         if (onFailure != null)\n-            onFailure.execute();\n-         return;\n-      }\n-      \n-      if (!(target instanceof TextEditingTarget))\n-      {\n-         if (onFailure != null)\n-            onFailure.execute();\n-         return;\n-      }\n-      \n-      command.execute((TextEditingTarget) target);\n-   }\n-   \n-   private void getEditorContext(String id, String path, DocDisplay docDisplay)\n-   {\n-      AceEditor editor = (AceEditor) docDisplay;\n-      Selection selection = editor.getNativeSelection();\n-      Range[] ranges = selection.getAllRanges();\n-      \n-      // clamp ranges to document boundaries\n-      for (Range range : ranges)\n-      {\n-         Position start = range.getStart();\n-         start.setRow(MathUtil.clamp(start.getRow(), 0, editor.getRowCount()));\n-         start.setColumn(MathUtil.clamp(start.getColumn(), 0, editor.getLine(start.getRow()).length()));\n-         \n-         Position end = range.getEnd();\n-         end.setRow(MathUtil.clamp(end.getRow(), 0, editor.getRowCount()));\n-         end.setColumn(MathUtil.clamp(end.getColumn(), 0, editor.getLine(end.getRow()).length()));\n-      }\n-\n-      JsArray<DocumentSelection> docSelections = JavaScriptObject.createArray().cast();\n-      for (int i = 0; i < ranges.length; i++)\n-      {\n-         docSelections.push(DocumentSelection.create(\n-               ranges[i],\n-               editor.getTextForRange(ranges[i])));\n-      }\n-\n-      id = StringUtil.notNull(id);\n-      path = StringUtil.notNull(path);\n-      \n-      GetEditorContextEvent.SelectionData data =\n-            GetEditorContextEvent.SelectionData.create(id, path, editor.getCode(), docSelections);\n-      \n-      server_.getEditorContextCompleted(data, new VoidServerRequestCallback());\n-   }\n-   \n-   private void withTarget(String id, CommandWithArg<TextEditingTarget> command)\n-   {\n-      withTarget(id, command, null);\n-   }\n-   \n-   private void initVimCommands()\n-   {\n-      vimCommands_.save(this);\n-      vimCommands_.selectTabIndex(this);\n-      vimCommands_.selectNextTab(this);\n-      vimCommands_.selectPreviousTab(this);\n-      vimCommands_.closeActiveTab(this);\n-      vimCommands_.closeAllTabs(this);\n-      vimCommands_.createNewDocument(this);\n-      vimCommands_.saveAndCloseActiveTab(this);\n-      vimCommands_.readFile(this, userPrefs_.defaultEncoding().getValue());\n-      vimCommands_.runRScript(this);\n-      vimCommands_.reflowText(this);\n-      vimCommands_.showVimHelp(\n-            RStudioGinjector.INSTANCE.getShortcutViewer());\n-      vimCommands_.showHelpAtCursor(this);\n-      vimCommands_.reindent(this);\n-      vimCommands_.expandShrinkSelection(this);\n-      vimCommands_.openNextFile(this);\n-      vimCommands_.openPreviousFile(this);\n-      vimCommands_.addStarRegister();\n-   }\n \n    public Widget asWidget()\n    {\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwODY0Nw==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424608647", "body": "Reduce this whole method to:\r\n\r\n```\r\n public Command revertUnsavedChangesBeforeExitCommand(final Command onCompleted)\r\n   {\r\n      return () -> handleUnsavedChangesBeforeExit(new ArrayList<>(), onCompleted);\r\n   }\r\n```", "bodyText": "Reduce this whole method to:\n public Command revertUnsavedChangesBeforeExitCommand(final Command onCompleted)\n   {\n      return () -> handleUnsavedChangesBeforeExit(new ArrayList<>(), onCompleted);\n   }", "bodyHTML": "<p dir=\"auto\">Reduce this whole method to:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" public Command revertUnsavedChangesBeforeExitCommand(final Command onCompleted)\n   {\n      return () -&gt; handleUnsavedChangesBeforeExit(new ArrayList&lt;&gt;(), onCompleted);\n   }\"><pre><code> public Command revertUnsavedChangesBeforeExitCommand(final Command onCompleted)\n   {\n      return () -&gt; handleUnsavedChangesBeforeExit(new ArrayList&lt;&gt;(), onCompleted);\n   }\n</code></pre></div>", "author": "gtritchie", "createdAt": "2020-05-13T17:27:16Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -2577,6 +2662,21 @@ public void saveWithPrompt(UnsavedChangesTarget target,\n          editingTarget.saveWithPrompt(onCompleted, onCancelled);\n    }\n    \n+   public Command revertUnsavedChangesBeforeExitCommand(\n+                                               final Command onCompleted)\n+   {\n+      return new Command()\n+      {\n+         @Override\n+         public void execute()\n+         {\n+            handleUnsavedChangesBeforeExit(\n+                                 new ArrayList<UnsavedChangesTarget>(),\n+                                 onCompleted);\n+         }\n+\n+      };\n+   }", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..82c41da0b2 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -2665,17 +2661,8 @@ public class Source implements InsertSourceHandler,\n    public Command revertUnsavedChangesBeforeExitCommand(\n                                                final Command onCompleted)\n    {\n-      return new Command()\n-      {\n-         @Override\n-         public void execute()\n-         {\n-            handleUnsavedChangesBeforeExit(\n-                                 new ArrayList<UnsavedChangesTarget>(),\n-                                 onCompleted);\n-         }\n-\n-      };\n+      return () -> handleUnsavedChangesBeforeExit(new ArrayList<UnsavedChangesTarget>(),\n+                                                  onCompleted);\n    }\n    public void handleUnsavedChangesBeforeExit(\n                         final ArrayList<UnsavedChangesTarget> saveTargets,\n", "next_change": {"commit": "0f1748d525c17dbb9b4021d3cb65b3784e7e0c68", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 82c41da0b2..c7e5ea0a19 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -1744,2536 +1288,742 @@ public class Source implements InsertSourceHandler,\n             }\n       });\n    }\n-   \n-   private void newRMarkdownV1Doc()\n-   {\n-      newSourceDocWithTemplate(FileTypeRegistry.RMARKDOWN, \n-            \"\", \n-            \"v1.Rmd\",\n-            Position.create(3, 0));\n-   }\n-   \n-   private void newRMarkdownV2Doc()\n+\n+   @Handler\n+   public void onActivateSource()\n    {\n-      rmarkdown_.showNewRMarkdownDialog(\n-         new OperationWithInput<NewRMarkdownDialog.Result>()\n-         {\n-            @Override\n-            public void execute(final NewRMarkdownDialog.Result result)\n-            {\n-               if (result == null)\n-               {\n-                  // No document chosen, just create an empty one\n-                  newSourceDocWithTemplate(FileTypeRegistry.RMARKDOWN, \"\", \"default.Rmd\");\n-               }\n-               else if (result.isNewDocument())\n-               {\n-                  NewRMarkdownDialog.RmdNewDocument doc = \n-                        result.getNewDocument();\n-                  String author = doc.getAuthor();\n-                  if (author.length() > 0)\n-                  {\n-                     userPrefs_.documentAuthor().setGlobalValue(author);\n-                     userPrefs_.writeUserPrefs();\n-                  }\n-                  newRMarkdownV2Doc(doc);\n-               }\n-               else\n-               {\n-                  newDocFromRmdTemplate(result);\n-               }\n-            }\n-         });\n+      onActivateSource(null);\n    }\n    \n-   private void newDocFromRmdTemplate(final NewRMarkdownDialog.Result result)\n+   public void onActivateSource(final Command afterActivation)\n    {\n-      final RmdChosenTemplate template = result.getFromTemplate();\n-      if (template.createDir())\n-      {\n-         rmarkdown_.createDraftFromTemplate(template);\n+      // give the window manager a chance to activate the last source pane\n+      if (pWindowManager_.get().activateLastFocusedSource())\n          return;\n-      }\n-\n-      rmarkdown_.getTemplateContent(template, \n-         new OperationWithInput<String>() {\n-            @Override\n-            public void execute(final String content)\n-            {\n-               if (content.length() == 0)\n-                  globalDisplay_.showErrorMessage(\"Template Content Missing\", \n-                        \"The template at \" + template.getTemplatePath() + \n-                        \" is missing.\");\n-               newDoc(FileTypeRegistry.RMARKDOWN, content, null);\n-            }\n-      });\n+      columnManager_.activateColumns(afterActivation);\n    }\n    \n-   private void newRMarkdownV2Doc(\n-         final NewRMarkdownDialog.RmdNewDocument doc)\n+   @Handler\n+   public void onLayoutZoomSource()\n    {\n-      rmarkdown_.frontMatterToYAML((RmdFrontMatter)doc.getJSOResult().cast(), \n-            null,\n-            new CommandWithArg<String>()\n+      onActivateSource(new Command()\n       {\n          @Override\n-         public void execute(final String yaml)\n+         public void execute()\n          {\n-            String template = \"\";\n-            // select a template appropriate to the document type we're creating\n-            if (doc.getTemplate().equals(RmdTemplateData.PRESENTATION_TEMPLATE))\n-               template = \"presentation.Rmd\";\n-            else if (doc.isShiny())\n-            {\n-               if (doc.getFormat().endsWith(\n-                     RmdOutputFormat.OUTPUT_PRESENTATION_SUFFIX))\n-                  template = \"shiny_presentation.Rmd\";\n-               else\n-                  template = \"shiny.Rmd\";\n-            }\n-            else\n-               template = \"document.Rmd\";\n-            newSourceDocWithTemplate(FileTypeRegistry.RMARKDOWN, \n-                  \"\", \n-                  template,\n-                  Position.create(1, 0),\n-                  null,\n-                  new TransformerCommand<String>()\n-                  {\n-                     @Override\n-                     public String transform(String input)\n-                     {\n-                        return RmdFrontMatter.FRONTMATTER_SEPARATOR + \n-                               yaml + \n-                               RmdFrontMatter.FRONTMATTER_SEPARATOR + \"\\n\" + \n-                               input;\n-                     }\n-                  });\n+            events_.fireEvent(new ZoomPaneEvent(\"Source\"));\n          }\n       });\n    }\n-   \n-   private void newSourceDocWithTemplate(final TextFileType fileType, \n-                                         String name,\n-                                         String template)\n-   {\n-      newSourceDocWithTemplate(fileType, name, template, null);\n-   }\n \n-   private void newSourceDocWithTemplate(final TextFileType fileType, \n-                                         String name,\n-                                         String template,\n-                                         final Position cursorPosition)\n+   @Override\n+   public void onPopoutDoc(final PopoutDocEvent e)\n    {\n-      newSourceDocWithTemplate(fileType, name, template, cursorPosition, null);\n+      // disowning the doc may cause the entire window to close, so defer it\n+      // to allow any other popout processing to occur\n+      Scheduler.get().scheduleDeferred(new ScheduledCommand()\n+      {\n+         @Override\n+         public void execute()\n+         {\n+            columnManager_.disownDoc(e.getDocId());\n+         }\n+      });\n    }\n    \n-   private void newSourceDocWithTemplate(\n-                       final TextFileType fileType, \n-                       String name,\n-                       String template,\n-                       final Position cursorPosition,\n-                       final CommandWithArg<EditingTarget> onSuccess)\n+   @Override\n+   public void onDocWindowChanged(final DocWindowChangedEvent e)\n    {\n-      newSourceDocWithTemplate(fileType, name, template, cursorPosition, onSuccess, null);\n-   }\n+      // Determine the old column before making any changes\n+      final SourceColumn oldDisplay = columnManager_.findByDocument(e.getDocId());\n \n-   private void newSourceDocWithTemplate(\n-                       final TextFileType fileType, \n-                       String name,\n-                       String template,\n-                       final Position cursorPosition,\n-                       final CommandWithArg<EditingTarget> onSuccess,\n-                       final TransformerCommand<String> contentTransformer)\n-   {\n-      final ProgressIndicator indicator = new GlobalProgressDelayer(\n-            globalDisplay_, 500, \"Creating new document...\").getIndicator();\n+      if (e.getNewWindowId().equals(SourceWindowManager.getSourceWindowId()))\n+      {\n+         columnManager_.ensureVisible(true);\n \n-      server_.getSourceTemplate(name, \n-                                template, \n-                                new ServerRequestCallback<String>() {\n-         @Override\n-         public void onResponseReceived(String templateContents)\n-         {\n-            indicator.onCompleted();\n+         // look for a collaborative editing session currently running inside\n+         // the document being transferred between windows--if we didn't know\n+         // about one with the event, try to look it up in the local cache of\n+         // source documents\n+         final CollabEditStartParams collabParams =\n+             e.getCollabParams() == null ?\n+                 pWindowManager_.get().getDocCollabParams(e.getDocId()) :\n+                 e.getCollabParams();\n+\n+         // If we can not determine the new column and the window has more than one column,\n+         // log a warning but continue to prevent the tab from being lost.\n+         final SourceColumn newDisplay = columnManager_.findByPosition(e.getXPos());\n+         if (newDisplay == null && columnManager_.getSize() > 1)\n+            Debug.logWarning(\"Couldn't determine new window column for dragged document.\");\n+\n+         // the event doesn't contain the display info, so we add it now\n+         pWindowManager_.get().assignSourceDocDisplay(\n+             e.getDocId(),\n+             (newDisplay == null) ?\n+                 columnManager_.getActive().getName() :\n+                 (newDisplay).getName(),\n+             true);\n \n-            if (contentTransformer != null)\n-               templateContents = contentTransformer.transform(templateContents);\n+         // if we're the adopting window, add the doc\n+         server_.getSourceDocument(e.getDocId(),\n+             new ServerRequestCallback<SourceDocument>()\n+             {\n+                @Override\n+                public void onResponseReceived(final SourceDocument doc)\n+                {\n+                   final EditingTarget target = columnManager_.addTab(doc, e.getPos(),\n+                       newDisplay);\n+\n+                   Scheduler.get().scheduleDeferred(new Scheduler.ScheduledCommand()\n+                   {\n+                      @Override\n+                      public void execute()\n+                      {\n+                         // if there was a collab session, resume it\n+                         if (collabParams != null)\n+                            target.beginCollabSession(e.getCollabParams());\n+                      }\n+                   });\n+                }\n \n-            newDoc(fileType, \n-                  templateContents, \n-                  new ResultCallback<EditingTarget, ServerError> () {\n-               @Override\n-               public void onSuccess(EditingTarget target)\n-               {\n-                  if (cursorPosition != null)\n-                     target.setCursorPosition(cursorPosition);\n-                  \n-                  if (onSuccess != null)\n-                     onSuccess.execute(target);\n-               }\n-            });\n-         }\n+                @Override\n+                public void onError(ServerError error)\n+                {\n+                   globalDisplay_.showErrorMessage(\"Document Tab Move Failed\",\n+                       \"Couldn't move the tab to this window: \\n\" +\n+                           error.getMessage());\n+                }\n+             });\n+      }\n+      if (e.getOldWindowId().equals(SourceWindowManager.getSourceWindowId()))\n+      {\n+         columnManager_.disownDocOnDrag(e.getDocId(), oldDisplay);\n+      }\n+   }\n \n+   @Override\n+   public void onDocTabDragInitiated(final DocTabDragInitiatedEvent event)\n+   {\n+      columnManager_.inEditorForId(event.getDragParams().getDocId(),\n+            new OperationWithInput<EditingTarget>()\n+      {\n          @Override\n-         public void onError(ServerError error)\n+         public void execute(EditingTarget editor)\n          {\n-            indicator.onError(error.getUserMessage());\n-         }\n-      });\n+            DocTabDragParams params = event.getDragParams();\n+            params.setSourcePosition(editor.currentPosition());\n+            params.setDisplayName(columnManager_.findByDocument(editor.getId()).getName());\n+            events_.fireEvent(new DocTabDragStartedEvent(params));\n+          }\n+       });\n    }\n \n-   \n-   private void newDoc(EditableFileType fileType,\n-                       ResultCallback<EditingTarget, ServerError> callback)\n+   @Override\n+   public void onPopoutDocInitiated(final PopoutDocInitiatedEvent event)\n    {\n-      if (fileType instanceof TextFileType)\n+      columnManager_.inEditorForId(event.getDocId(), new OperationWithInput<EditingTarget>()\n       {\n-         // This is a text file, so see if the user has defined a template for it.\n-         TextFileType textType = (TextFileType)fileType;\n-         server_.getSourceTemplate(\"\", \n-               \"default\" + textType.getDefaultExtension(),\n-               new ServerRequestCallback<String>()\n+         @Override\n+         public void execute(EditingTarget editor)\n+         {\n+            // if this is a text editor, ensure that its content is \n+            // synchronized with the server before we pop it out\n+            if (editor instanceof TextEditingTarget)\n+            {\n+               final TextEditingTarget textEditor = (TextEditingTarget)editor;\n+               textEditor.withSavedDoc(new Command()\n                {\n                   @Override\n-                  public void onResponseReceived(String template)\n-                  {\n-                     // Create a new document with the supplied template.\n-                     newDoc(fileType, template, callback);\n-                  }\n-\n-                  @Override\n-                  public void onError(ServerError error)\n+                  public void execute()\n                   {\n-                     // Ignore errors; there's just not a template for this type.\n-                     newDoc(fileType, null, callback);\n+                     textEditor.syncLocalSourceDb();\n+                     events_.fireEvent(new PopoutDocEvent(event, \n+                        textEditor.currentPosition(),\n+                        columnManager_.findByDocument(textEditor.getId())));\n                   }\n                });\n-      }\n-      else\n-      {\n-         newDoc(fileType, null, callback);\n-      }\n-   }\n-   \n-   private void newDoc(EditableFileType fileType,\n-                       final String contents,\n-                       final ResultCallback<EditingTarget, ServerError> resultCallback)\n-   {\n-      ensureVisible(true);\n-      server_.newDocument(\n-            fileType.getTypeId(),\n-            contents,\n-            JsObject.createJsObject(),\n-            new SimpleRequestCallback<SourceDocument>(\n-                  \"Error Creating New Document\")\n+            }\n+            else\n             {\n-               @Override\n-               public void onResponseReceived(SourceDocument newDoc)\n-               {\n-                  EditingTarget target = addTab(newDoc, OPEN_INTERACTIVE);\n-                  \n-                  if (contents != null)\n-                  {\n-                     target.forceSaveCommandActive();\n-                     manageSaveCommands();\n-                  }\n-                  \n-                  if (resultCallback != null)\n-                     resultCallback.onSuccess(target);\n-               }\n-\n-               @Override\n-               public void onError(ServerError error)\n-               {\n-                  if (resultCallback != null)\n-                     resultCallback.onFailure(error);\n-               }\n-            });\n+               events_.fireEvent(new PopoutDocEvent(event, \n+                     editor.currentPosition(),\n+                     columnManager_.findByDocument(editor.getId())));\n+            }\n+         }\n+      });\n    }\n-   \n+\n    @Handler\n-   public void onFindInFiles()\n+   public void onSaveAllSourceDocs()\n    {\n-      String searchPattern = \"\";\n-      if (activeEditor_ != null && activeEditor_ instanceof TextEditingTarget)\n-      {  \n-         TextEditingTarget textEditor = (TextEditingTarget) activeEditor_;\n-         String selection = textEditor.getSelectedText();\n-         boolean multiLineSelection = selection.indexOf('\\n') != -1;\n-         \n-         if ((selection.length() != 0) && !multiLineSelection)\n-            searchPattern = selection; \n-      }\n-      \n-      events_.fireEvent(new FindInFilesEvent(searchPattern));\n+      // Save all documents in the main window\n+       columnManager_.saveAllSourceDocs();\n+\n+      // Save all documents in satellite windows\n+      pWindowManager_.get().saveUnsavedDocuments(null, null);\n    }\n \n    @Handler\n-   public void onActivateSource()\n+   public void onCloseAllSourceDocs()\n    {\n-      onActivateSource(null);\n+      closeAllSourceDocs(\"Close All\",  null, false);\n    }\n    \n-   public void onActivateSource(final Command afterActivation)\n+   @Handler\n+   public void onCloseOtherSourceDocs()\n    {\n-      // give the window manager a chance to activate the last source pane\n-      if (pWindowManager_.get().activateLastFocusedSource())\n-         return;\n-      \n-      if (activeEditor_ == null)\n+      closeAllSourceDocs(\"Close Other\",  null, true);\n+   }\n+   \n+   public void closeAllSourceDocs(final String caption, \n+         final Command onCompleted, final boolean excludeActive)\n+   { \n+      if (SourceWindowManager.isMainSourceWindow() && !excludeActive)\n       {\n-         newDoc(FileTypeRegistry.R, new ResultCallback<EditingTarget, ServerError>()\n+         // if this is the main window, close docs in the satellites first \n+         pWindowManager_.get().closeAllSatelliteDocs(caption, new Command()\n          {\n             @Override\n-            public void onSuccess(EditingTarget target)\n+            public void execute()\n             {\n-               activeEditor_ = target;\n-               doActivateSource(afterActivation);\n+               columnManager_.closeAllLocalSourceDocs(caption, onCompleted, excludeActive);\n             }\n-            \n          });\n       }\n       else\n       {\n-         doActivateSource(afterActivation);\n+         // this is a satellite (or we don't need to query satellites)--just\n+         // close our own tabs\n+         columnManager_.closeAllLocalSourceDocs(caption, onCompleted, excludeActive);\n       }\n    }\n-   \n-   @Handler\n-   public void onLayoutZoomSource()\n-   {\n-      onActivateSource(new Command()\n-      {\n-         @Override\n-         public void execute()\n-         {\n-            events_.fireEvent(new ZoomPaneEvent(\"Source\"));\n-         }\n-      });\n-   }\n-   \n-   private void doActivateSource(final Command afterActivation)\n+\n+   public ArrayList<UnsavedChangesTarget> getUnsavedChanges(int type)\n    {\n-      ensureVisible(false);\n-      if (activeEditor_ != null)\n-      {\n-         activeEditor_.focus();\n-         activeEditor_.ensureCursorVisible();\n-      }\n-      \n-      if (afterActivation != null)\n-         afterActivation.execute();\n+      return getUnsavedChanges(type,  null);\n    }\n \n-   @Handler\n-   public void onSwitchToTab()\n+   public ArrayList<UnsavedChangesTarget> getUnsavedChanges(int type, Set<String> ids)\n    {\n-      if (view_.getTabCount() == 0)\n-         return;\n+      ArrayList<UnsavedChangesTarget> targets =\n+          new ArrayList<UnsavedChangesTarget>();\n \n-      ensureVisible(false);\n+      // if this is the main window, collect all unsaved changes from\n+      // the satellite windows as well\n+      if (SourceWindowManager.isMainSourceWindow())\n+      {\n+         targets.addAll(pWindowManager_.get().getAllSatelliteUnsavedChanges(type));\n+      }\n+      targets.addAll(columnManager_.getUnsavedChanges(type, ids));\n \n-      view_.showOverflowPopup();\n+      return targets;\n    }\n \n-   @Handler\n-   public void onFirstTab()\n+   public void saveUnsavedDocuments(final Command onCompleted)\n    {\n-      if (view_.getTabCount() == 0)\n-         return;\n-\n-      ensureVisible(false);\n-      if (view_.getTabCount() > 0)\n-         setPhysicalTabIndex(0);\n+      saveUnsavedDocuments(null, onCompleted);\n    }\n-\n-   @Handler\n-   public void onPreviousTab()\n-   {\n-      switchToTab(-1, userPrefs_.wrapTabNavigation().getValue());\n-   }\n-\n-   @Handler\n-   public void onNextTab()\n+   \n+   public void saveUnsavedDocuments(final Set<String> ids,\n+                                    final Command onCompleted)\n    {\n-      switchToTab(1, userPrefs_.wrapTabNavigation().getValue());\n+      Command saveAllLocal = new Command()\n+      {\n+         @Override\n+         public void execute()\n+         {\n+            columnManager_.saveChanges(getUnsavedChanges(TYPE_FILE_BACKED, ids), onCompleted);\n+         }\n+      };\n+      \n+      // if this is the main source window, save all files in satellites first\n+      if (SourceWindowManager.isMainSourceWindow())\n+         pWindowManager_.get().saveUnsavedDocuments(ids, saveAllLocal);\n+      else\n+         saveAllLocal.execute();\n    }\n \n-   @Handler\n-   public void onLastTab()\n+   public void saveWithPrompt(UnsavedChangesTarget target, \n+                              Command onCompleted,\n+                              Command onCancelled)\n    {\n-      if (view_.getTabCount() == 0)\n+      if (SourceWindowManager.isMainSourceWindow() &&\n+          !pWindowManager_.get().getWindowIdOfDocId(target.getId()).isEmpty())\n+      {\n+         // we are the main window, and we're being asked to save a document\n+         // that's in a different window; perform the save over there\n+         pWindowManager_.get().saveWithPrompt(UnsavedChangesItem.create(target), \n+               onCompleted);\n          return;\n-\n-      ensureVisible(false);\n-      if (view_.getTabCount() > 0)\n-         setPhysicalTabIndex(view_.getTabCount() - 1);\n+      }\n+      EditingTarget editingTarget = columnManager_.findEditor(target.getId());\n+      if (editingTarget != null)\n+         editingTarget.saveWithPrompt(onCompleted, onCancelled);\n    }\n    \n-   public void nextTabWithWrap()\n+   public Command revertUnsavedChangesBeforeExitCommand(\n+                                               final Command onCompleted)\n    {\n-      switchToTab(1, true);\n+      return () -> handleUnsavedChangesBeforeExit(new ArrayList<UnsavedChangesTarget>(),\n+                                                  onCompleted);\n    }\n \n-   public void prevTabWithWrap()\n-   {\n-      switchToTab(-1, true);\n-   }\n-   \n-   private void switchToTab(int delta, boolean wrap)\n+   public void handleUnsavedChangesBeforeExit(\n+                        final ArrayList<UnsavedChangesTarget> saveTargets,\n+                        final Command onCompleted)\n    {\n-      if (view_.getTabCount() == 0)\n-         return;\n-      \n-      ensureVisible(false);\n+      // first handle saves, then revert unsaved, then callback on completed\n+      final Command completed = new Command() {\n+         @Override\n+         public void execute()\n+         {\n+            // revert unsaved\n+            columnManager_.revertUnsavedTargets(onCompleted);\n+         }\n+      };   \n \n-      int targetIndex = getPhysicalTabIndex() + delta;\n-      if (targetIndex > (view_.getTabCount() - 1))\n+      // if this is the main source window, let satellite windows save any\n+      // changes first\n+      if (SourceWindowManager.isMainSourceWindow())\n       {\n-         if (wrap)\n-            targetIndex = 0;\n-         else\n-            return;\n+         pWindowManager_.get().handleUnsavedChangesBeforeExit(\n+               saveTargets, new Command()\n+         {\n+            @Override\n+            public void execute()\n+            {\n+               columnManager_.saveChanges(saveTargets, completed);\n+            }\n+         });\n       }\n-      else if (targetIndex < 0)\n+      else\n       {\n-         if (wrap)\n-            targetIndex = view_.getTabCount() - 1;\n-         else\n-            return;\n+         columnManager_.saveChanges(saveTargets, completed);\n       }\n-      setPhysicalTabIndex(targetIndex);\n    }\n    \n-   @Handler\n-   public void onMoveTabRight()\n+   public Display getActiveView()\n    {\n-      view_.moveTab(getPhysicalTabIndex(), 1);\n+      return (Display)columnManager_.getActive();\n    }\n \n    @Handler\n-   public void onMoveTabLeft()\n-   {\n-      view_.moveTab(getPhysicalTabIndex(), -1);\n-   }\n-   \n-   @Handler\n-   public void onMoveTabToFirst()\n+   public void onOpenSourceDoc()\n    {\n-      view_.moveTab(getPhysicalTabIndex(), getPhysicalTabIndex() * -1);\n-   }\n+      fileDialogs_.openFile(\n+            \"Open File\",\n+            fileContext_,\n+            workbenchContext_.getDefaultFileDialogDir(),\n+            new ProgressOperationWithInput<FileSystemItem>()\n+            {\n+               public void execute(final FileSystemItem input,\n+                                   ProgressIndicator indicator)\n+               {\n+                  if (input == null)\n+                     return;\n \n-   @Handler\n-   public void onMoveTabToLast()\n-   {\n-      view_.moveTab(getPhysicalTabIndex(), (view_.getTabCount() - \n-            getPhysicalTabIndex()) - 1);\n-   }\n+                  workbenchContext_.setDefaultFileDialogDir(\n+                                                   input.getParentPath());\n \n-   @Override\n-   public void onPopoutDoc(final PopoutDocEvent e)\n-   {\n-      // disowning the doc may cause the entire window to close, so defer it\n-      // to allow any other popout processing to occur\n-      Scheduler.get().scheduleDeferred(new ScheduledCommand()\n-      {\n-         @Override\n-         public void execute()\n-         {\n-            disownDoc(e.getDocId());\n-         }\n-      });\n-   }\n-   \n-   @Override\n-   public void onDebugModeChanged(DebugModeChangedEvent evt)\n-   {\n-      // when debugging ends, always disengage any active debug highlights\n-      if (!evt.debugging() && activeEditor_ != null)\n-      {\n-         activeEditor_.endDebugHighlighting();\n-      }\n+                  indicator.onCompleted();\n+                  Scheduler.get().scheduleDeferred(new ScheduledCommand()\n+                  {\n+                     public void execute()\n+                     {\n+                        fileTypeRegistry_.openFile(input);\n+                     }\n+                  });\n+               }\n+            });\n    }\n    \n-   @Override\n-   public void onDocWindowChanged(final DocWindowChangedEvent e)\n+   public void onNewDocumentWithCode(final NewDocumentWithCodeEvent event)\n    {\n-      if (e.getNewWindowId() == SourceWindowManager.getSourceWindowId())\n-      {\n-         ensureVisible(true);\n-         \n-         // look for a collaborative editing session currently running inside \n-         // the document being transferred between windows--if we didn't know\n-         // about one with the event, try to look it up in the local cache of\n-         // source documents\n-         final CollabEditStartParams collabParams = \n-               e.getCollabParams() == null ? \n-                     pWindowManager_.get().getDocCollabParams(e.getDocId()) :\n-                     e.getCollabParams();\n-         \n-         // if we're the adopting window, add the doc\n-         server_.getSourceDocument(e.getDocId(),\n-               new ServerRequestCallback<SourceDocument>()\n+      // determine the type\n+      final EditableFileType docType;\n+      if (event.getType() == NewDocumentWithCodeEvent.R_SCRIPT)\n+         docType = FileTypeRegistry.R;\n+      else if (event.getType() == NewDocumentWithCodeEvent.SQL)\n+         docType = FileTypeRegistry.SQL;\n+      else\n+         docType = FileTypeRegistry.RMARKDOWN;\n+      \n+      // command to create and run the new doc\n+      Command newDocCommand = new Command() {\n+         @Override\n+         public void execute()\n          {\n-            @Override\n-            public void onResponseReceived(final SourceDocument doc)\n-            {\n-               final EditingTarget target = addTab(doc, e.getPos());\n-               \n-               Scheduler.get().scheduleDeferred(new Scheduler.ScheduledCommand()\n+            columnManager_.newDoc(docType,\n+                   event.getCode(),\n+                   new ResultCallback<EditingTarget, ServerError>() {\n+               public void onSuccess(EditingTarget arg)\n                {\n-                  @Override\n-                  public void execute()\n+                  TextEditingTarget editingTarget = (TextEditingTarget)arg;\n+                  \n+                  if (event.getCursorPosition() != null)\n                   {\n-                     // if there was a collab session, resume it\n-                     if (collabParams != null)\n-                        target.beginCollabSession(e.getCollabParams());\n+                     editingTarget.navigateToPosition(event.getCursorPosition(),\n+                                                      false);\n                   }\n-               });\n-            }\n-\n-            @Override\n-            public void onError(ServerError error)\n-            {\n-               globalDisplay_.showErrorMessage(\"Document Tab Move Failed\", \n-                     \"Couldn't move the tab to this window: \\n\" + \n-                      error.getMessage());\n-            }\n-         });\n-      }\n-      else if (e.getOldWindowId() == SourceWindowManager.getSourceWindowId())\n+                  \n+                  if (event.getExecute())\n+                  {\n+                     if (docType.equals(FileTypeRegistry.R))\n+                     {\n+                        commands_.executeToCurrentLine().execute();\n+                        commands_.activateSource().execute();\n+                     }\n+                     else if (docType.equals(FileTypeRegistry.SQL))\n+                     {\n+                        commands_.previewSql().execute();\n+                     }\n+                     else\n+                     {\n+                        commands_.executePreviousChunks().execute();\n+                     }\n+                  }\n+               }\n+            });\n+         }\n+      };\n+     \n+      // do it\n+      if (docType.equals(FileTypeRegistry.R))\n       {\n-         // cancel tab drag if it was occurring\n-         view_.cancelTabDrag();\n-         \n-         // disown this doc if it was our own\n-         disownDoc(e.getDocId());\n+         newDocCommand.execute();\n       }\n-   }\n-   \n-   private void disownDoc(String docId)\n-   {\n-      suspendDocumentClose_ = true;\n-      for (int i = 0; i < editors_.size(); i++)\n+      else\n       {\n-         if (editors_.get(i).getId() == docId)\n-         {\n-            view_.closeTab(i, false);\n-            break;\n-         }\n+         dependencyManager_.withRMarkdown(\"R Notebook\",\n+                                          \"Create R Notebook\", \n+                                          newDocCommand);\n       }\n-      suspendDocumentClose_ = false;\n    }\n-\n-   @Override\n-   public void onDocTabDragInitiated(final DocTabDragInitiatedEvent event)\n+   \n+   @Handler\n+   public void onNewRPlumberDoc()\n    {\n-      inEditorForId(event.getDragParams().getDocId(), \n-            new OperationWithInput<EditingTarget>()\n+      dependencyManager_.withRPlumber(\"Creating R Plumber API\", new Command()\n       {\n          @Override\n-         public void execute(EditingTarget editor)\n+         public void execute()\n          {\n-            DocTabDragParams params = event.getDragParams();\n-            params.setSourcePosition(editor.currentPosition());\n-            events_.fireEvent(new DocTabDragStartedEvent(params));\n-            \n+            NewPlumberAPI widget = new NewPlumberAPI(\n+                  \"New Plumber API\",\n+                  new OperationWithInput<NewPlumberAPI.Result>()\n+                  {\n+                     @Override\n+                     public void execute(NewPlumberAPI.Result input)\n+                     {\n+                        doNewRPlumberAPI(input);\n+                     }\n+                  });\n+         \n+            widget.showModal();\n+\n          }\n       });\n    }\n+    \n+   public void onOpenSourceFile(final OpenSourceFileEvent event)\n+   {\n+      doOpenSourceFile(event.getFile(),\n+                     event.getFileType(),\n+                     event.getPosition(),\n+                     null, \n+                     event.getNavigationMethod(),\n+                     false);\n+   }\n    \n-   @Override\n-   public void onPopoutDocInitiated(final PopoutDocInitiatedEvent event)\n+   public void onOpenPresentationSourceFile(OpenPresentationSourceFileEvent event)\n    {\n-      inEditorForId(event.getDocId(), new OperationWithInput<EditingTarget>()\n-      {\n-         @Override\n-         public void execute(EditingTarget editor)\n-         {\n-            // if this is a text editor, ensure that its content is \n-            // synchronized with the server before we pop it out\n-            if (editor instanceof TextEditingTarget)\n-            {\n-               final TextEditingTarget textEditor = (TextEditingTarget)editor;\n-               textEditor.withSavedDoc(new Command()\n-               {\n-                  @Override\n-                  public void execute()\n-                  {\n-                     textEditor.syncLocalSourceDb();\n-                     events_.fireEvent(new PopoutDocEvent(event, \n-                           textEditor.currentPosition()));\n-                  }\n-               });\n-            }\n-            else\n-            {\n-               events_.fireEvent(new PopoutDocEvent(event, \n-                     editor.currentPosition()));\n-            }\n-         }\n-      });\n-   }\n-\n-   @Handler\n-   public void onCloseSourceDoc()\n-   {\n-      closeSourceDoc(true);\n-   }\n-   \n-   void closeSourceDoc(boolean interactive)\n-   {\n-      if (view_.getTabCount() == 0)\n-         return;\n+      // don't do the navigation if the active document is a source\n+      // file from this presentation module\n       \n-      view_.closeTab(view_.getActiveTabIndex(), interactive);\n-   }\n-   \n-   /**\n-    * Execute the given command for each editor, using continuation-passing\n-    * style. When executed, the CPSEditingTargetCommand needs to execute its\n-    * own Command parameter to continue the iteration.\n-    * @param command The command to run on each EditingTarget\n-    */\n-   private void cpsExecuteForEachEditor(ArrayList<EditingTarget> editors,\n-                                        final CPSEditingTargetCommand command,\n-                                        final Command completedCommand)\n-   {\n-      SerializedCommandQueue queue = new SerializedCommandQueue();\n-\n-      // Clone editors_, since the original may be mutated during iteration\n-      for (final EditingTarget editor : new ArrayList<EditingTarget>(editors))\n-      {\n-         queue.addCommand(new SerializedCommand()\n-         {\n-            @Override\n-            public void onExecute(Command continuation)\n-            {\n-               command.execute(editor, continuation);\n-            }\n-         });\n-      }\n+      doOpenSourceFile(event.getFile(),\n+                       event.getFileType(),\n+                       event.getPosition(),\n+                       event.getPattern(),\n+                       NavigationMethods.HIGHLIGHT_LINE,\n+                       true);\n       \n-      if (completedCommand != null)\n-      {\n-         queue.addCommand(new SerializedCommand() {\n+   }\n    \n-            public void onExecute(Command continuation)\n-            {\n-               completedCommand.execute();\n-               continuation.execute();\n-            }  \n+   public void onEditPresentationSource(final EditPresentationSourceEvent event)\n+   { \n+      columnManager_.openFile(\n+            event.getSourceFile(), \n+            FileTypeRegistry.RPRESENTATION,\n+            new CommandWithArg<EditingTarget>() {\n+               @Override\n+               public void execute(final EditingTarget editor)\n+               {\n+                  TextEditingTargetPresentationHelper.navigateToSlide(\n+                                                         editor, \n+                                                         event.getSlideIndex());\n+               }\n          });\n-      }\n    }\n    \n-   private void cpsExecuteForEachEditor(ArrayList<EditingTarget> editors,\n-                                       final CPSEditingTargetCommand command)\n+   public void forceLoad()\n    {\n-      cpsExecuteForEachEditor(editors, command, null);\n+      AceEditor.preload();\n    }\n-   \n-   \n-   @Handler\n-   public void onSaveAllSourceDocs()\n+\n+   public String getCurrentDocId()\n    {\n-      // Save all documents in the main window\n-      cpsExecuteForEachEditor(editors_, new CPSEditingTargetCommand()\n-      {\n-         @Override\n-         public void execute(EditingTarget target, Command continuation)\n-         {\n-            if (target.dirtyState().getValue())\n-            {\n-               target.save(continuation);\n-            }\n-            else\n-            {\n-               continuation.execute();\n-            }\n-         }\n-      });\n+      return columnManager_.getActiveDocId();\n+   }\n \n-      // Save all documents in satellite windows\n-      pWindowManager_.get().saveUnsavedDocuments(null, null);\n+   public String getCurrentDocPath()\n+   {\n+      return columnManager_.getActiveDocPath();\n    }\n    \n-   \n-   private void saveEditingTargetsWithPrompt(\n-                                       String title,\n-                                       ArrayList<EditingTarget> editingTargets,\n-                                       final Command onCompleted,\n-                                       final Command onCancelled)\n+   private void doOpenSourceFile(final FileSystemItem file,\n+                                 final TextFileType fileType,\n+                                 final FilePosition position,\n+                                 final String pattern,\n+                                 final int navMethod, \n+                                 final boolean forceHighlightMode)\n    {\n-      // execute on completed right away if the list is empty\n-      if (editingTargets.size() ==  0)\n-      {\n-         onCompleted.execute();\n-      }\n+      // if the navigation should happen in another window, do that instead\n+      NavigationResult navResult = \n+            pWindowManager_.get().navigateToFile(file, position, navMethod);\n       \n-      // if there is just one thing dirty then go straight to the save dialog\n-      else if (editingTargets.size() == 1)\n-      {\n-         editingTargets.get(0).saveWithPrompt(onCompleted, onCancelled);\n-      }\n+      // we navigated externally, just skip this\n+      if (navResult.getType() == NavigationResult.RESULT_NAVIGATED)\n+         return;\n       \n-      // otherwise use the multi save changes dialog\n-      else\n+      // we're about to open in this window--if it's the main window, focus it\n+      if (SourceWindowManager.isMainSourceWindow() && Desktop.hasDesktopFrame())\n+         Desktop.getFrame().bringMainFrameToFront();\n+      \n+      final boolean isDebugNavigation = \n+            navMethod == NavigationMethods.DEBUG_STEP ||\n+            navMethod == NavigationMethods.DEBUG_END;\n+      \n+      final CommandWithArg<EditingTarget> editingTargetAction = \n+            new CommandWithArg<EditingTarget>() \n       {\n-         // convert to UnsavedChangesTarget collection\n-         ArrayList<UnsavedChangesTarget> unsavedTargets = \n-                                    new ArrayList<UnsavedChangesTarget>();\n-         unsavedTargets.addAll(editingTargets);\n-         \n-         // show dialog\n-         view_.showUnsavedChangesDialog(\n-            title,\n-            unsavedTargets, \n-            new OperationWithInput<UnsavedChangesDialog.Result>() \n+         @Override\n+         public void execute(EditingTarget target)\n+         {\n+            // the rstudioapi package can use the proxy (-1, -1) position to\n+            // indicate that source navigation should not occur; ie, we should\n+            // preserve whatever position was used in the document earlier\n+            boolean navigateToPosition =\n+                  position != null &&\n+                  (position.getLine() != -1 || position.getColumn() != -1);\n+            \n+            if (navigateToPosition)\n             {\n-               @Override\n-               public void execute(UnsavedChangesDialog.Result result)\n+               SourcePosition endPosition = null;\n+               if (isDebugNavigation)\n                {\n-                  saveChanges(result.getSaveTargets(), onCompleted);\n+                  DebugFilePosition filePos = \n+                        (DebugFilePosition) position.cast();\n+                  endPosition = SourcePosition.create(\n+                        filePos.getEndLine() - 1,\n+                        filePos.getEndColumn() + 1);\n+                  \n+                  if (Desktop.hasDesktopFrame() &&\n+                      navMethod != NavigationMethods.DEBUG_END)\n+                      Desktop.getFrame().bringMainFrameToFront();\n                }\n-            },\n-            onCancelled); \n-      }\n-   }\n-   \n-   private void saveChanges(ArrayList<UnsavedChangesTarget> targets,\n-                                 Command onCompleted)\n-   {\n-      // convert back to editing targets\n-      ArrayList<EditingTarget> saveTargets = \n-                                    new ArrayList<EditingTarget>();\n-      for (UnsavedChangesTarget target: targets)\n-      {\n-         EditingTarget saveTarget = \n-                           getEditingTargetForId(target.getId());\n-         if (saveTarget != null)\n-            saveTargets.add(saveTarget);\n-      }\n-        \n-      // execute the save\n-      cpsExecuteForEachEditor(\n-         \n-         // targets the user chose to save\n-         saveTargets, \n-         \n-         // save each editor\n-         new CPSEditingTargetCommand()\n-         {\n-            @Override\n-            public void execute(EditingTarget saveTarget, \n-                                Command continuation)\n-            {         \n-               saveTarget.save(continuation); \n+               navigate(target, \n+                        SourcePosition.create(position.getLine() - 1,\n+                                              position.getColumn() - 1),\n+                        endPosition);\n             }\n-         },\n-         \n-         // onCompleted at the end\n-         onCompleted\n-      );          \n-   }\n-          \n-   \n-   private EditingTarget getEditingTargetForId(String id)\n-   {\n-      for (EditingTarget target : editors_)\n-         if (id == target.getId())\n-            return target;\n-\n-      return null;\n-   }\n-   \n-   @Handler\n-   public void onCloseAllSourceDocs()\n-   {\n-      closeAllSourceDocs(\"Close All\",  null, false);\n-   }\n-   \n-   @Handler\n-   public void onCloseOtherSourceDocs()\n-   {\n-      closeAllSourceDocs(\"Close Other\",  null, true);\n-   }\n-   \n-   public void closeAllSourceDocs(final String caption, \n-         final Command onCompleted, final boolean excludeActive)\n-   { \n-      if (SourceWindowManager.isMainSourceWindow() && !excludeActive)\n-      {\n-         // if this is the main window, close docs in the satellites first \n-         pWindowManager_.get().closeAllSatelliteDocs(caption, new Command()\n-         {\n-            @Override\n-            public void execute()\n+            else if (pattern != null)\n             {\n-               closeAllLocalSourceDocs(caption, onCompleted, excludeActive);\n+               Position pos = target.search(pattern);\n+               if (pos != null)\n+               {\n+                  navigate(target, \n+                           SourcePosition.create(pos.getRow(), 0),\n+                           null);\n+               }\n             }\n-         });\n-      }\n-      else\n-      {\n-         // this is a satellite (or we don't need to query satellites)--just\n-         // close our own tabs\n-         closeAllLocalSourceDocs(caption, onCompleted, excludeActive);\n-      }\n-  }\n-\n-  private void closeAllLocalSourceDocs(String caption, Command onCompleted,\n-           final boolean excludeActive)\n-  {\n-      // save active editor for exclusion (it changes as we close tabs)\n-      final EditingTarget activeEditor = activeEditor_;\n-      \n-      // collect up a list of dirty documents\n-      ArrayList<EditingTarget> dirtyTargets = new ArrayList<EditingTarget>();\n-      for (EditingTarget target : editors_)\n-      {\n-         if (excludeActive && target == activeEditor)\n-            continue;\n-         if (target.dirtyState().getValue())\n-            dirtyTargets.add(target);\n-      }\n-      \n-      // create a command used to close all tabs \n-      final Command closeAllTabsCommand = new Command()\n-      {\n-         @Override\n-         public void execute()\n+         }\n+         \n+         private void navigate(final EditingTarget target,\n+                               final SourcePosition srcPosition,\n+                               final SourcePosition srcEndPosition)\n          {\n-            cpsExecuteForEachEditor(editors_, new CPSEditingTargetCommand()\n+            Scheduler.get().scheduleDeferred(new ScheduledCommand()\n             {\n                @Override\n-               public void execute(EditingTarget target, Command continuation)\n+               public void execute()\n                {\n-                  if (excludeActive && target == activeEditor)\n+                  if (navMethod == NavigationMethods.DEBUG_STEP)\n                   {\n-                     continuation.execute();\n-                     return;\n+                     target.highlightDebugLocation(\n+                           srcPosition, \n+                           srcEndPosition, \n+                           true);\n                   }\n-                  else\n+                  else if (navMethod == NavigationMethods.DEBUG_END)\n                   {\n-                     view_.closeTab(target.asWidget(), false, continuation);\n+                     target.endDebugHighlighting();\n                   }\n-               }\n-            });\n-            \n-         }     \n-      };\n-      \n-      // save targets\n-      saveEditingTargetsWithPrompt(caption,\n-                                   dirtyTargets, \n-                                   CommandUtil.join(closeAllTabsCommand,\n-                                                    onCompleted),\n-                                   null);\n-      \n-   }\n-  \n-   private boolean isUnsavedTarget(EditingTarget target, int type)\n-   {\n-      boolean fileBacked = target.getPath() != null;\n-      return target.dirtyState().getValue() && \n-              ((type == TYPE_FILE_BACKED &&  fileBacked) ||\n-               (type == TYPE_UNTITLED    && !fileBacked));\n-   }\n-   \n-   public ArrayList<UnsavedChangesTarget> getUnsavedChanges(int type)\n-   {\n-      return getUnsavedChanges(type,  null);\n-   }\n-   \n-   public ArrayList<UnsavedChangesTarget> getUnsavedChanges(int type, Set<String> ids)\n-   {\n-      ArrayList<UnsavedChangesTarget> targets = \n-                                       new ArrayList<UnsavedChangesTarget>();\n-\n-      // if this is the main window, collect all unsaved changes from \n-      // the satellite windows as well\n-      if (SourceWindowManager.isMainSourceWindow())\n-      {\n-         targets.addAll(pWindowManager_.get().getAllSatelliteUnsavedChanges(type));\n-      }\n-\n-      for (EditingTarget target : editors_)\n-      {\n-         // no need to save targets which are up-to-date\n-         if (!isUnsavedTarget(target, type))\n-            continue;\n-         \n-         // if we've requested the save of specific documents, screen\n-         // out documents not within the requested id set\n-         if (ids != null && !ids.contains(target.getId()))\n-            continue;\n-         \n-         targets.add(target);\n-      }\n-      \n-      return targets;\n-   }\n-   \n-   public void saveUnsavedDocuments(final Command onCompleted)\n-   {\n-      saveUnsavedDocuments(null, onCompleted);\n-   }\n-   \n-   public void saveUnsavedDocuments(final Set<String> ids,\n-                                    final Command onCompleted)\n-   {\n-      Command saveAllLocal = new Command()\n-      {\n-         @Override\n-         public void execute()\n-         {\n-            saveChanges(getUnsavedChanges(TYPE_FILE_BACKED, ids), onCompleted);\n-         }\n-      };\n-      \n-      // if this is the main source window, save all files in satellites first\n-      if (SourceWindowManager.isMainSourceWindow())\n-         pWindowManager_.get().saveUnsavedDocuments(ids, saveAllLocal);\n-      else\n-         saveAllLocal.execute();\n-   }\n-   \n-   public void saveWithPrompt(UnsavedChangesTarget target, \n-                              Command onCompleted,\n-                              Command onCancelled)\n-   {\n-      if (SourceWindowManager.isMainSourceWindow() &&\n-          !pWindowManager_.get().getWindowIdOfDocId(target.getId()).isEmpty())\n-      {\n-         // we are the main window, and we're being asked to save a document\n-         // that's in a different window; perform the save over there\n-         pWindowManager_.get().saveWithPrompt(UnsavedChangesItem.create(target), \n-               onCompleted);\n-         return;\n-      }\n-      EditingTarget editingTarget = getEditingTargetForId(target.getId());\n-      if (editingTarget != null)\n-         editingTarget.saveWithPrompt(onCompleted, onCancelled);\n-   }\n-   \n-   public Command revertUnsavedChangesBeforeExitCommand(\n-                                               final Command onCompleted)\n-   {\n-      return () -> handleUnsavedChangesBeforeExit(new ArrayList<UnsavedChangesTarget>(),\n-                                                  onCompleted);\n-   }\n-   public void handleUnsavedChangesBeforeExit(\n-                        final ArrayList<UnsavedChangesTarget> saveTargets,\n-                        final Command onCompleted)\n-   {\n-      // first handle saves, then revert unsaved, then callback on completed\n-      final Command completed = new Command() {\n-         @Override\n-         public void execute()\n-         {\n-            // revert unsaved\n-            revertUnsavedTargets(onCompleted);\n-         }\n-      };   \n-\n-      // if this is the main source window, let satellite windows save any\n-      // changes first\n-      if (SourceWindowManager.isMainSourceWindow())\n-      {\n-         pWindowManager_.get().handleUnsavedChangesBeforeExit(\n-               saveTargets, new Command()\n-         {\n-            @Override\n-            public void execute()\n-            {\n-               saveChanges(saveTargets, completed);\n-            }\n-         });\n-      }\n-      else\n-      {\n-         saveChanges(saveTargets, completed);\n-      }\n-   }\n-   \n-   public Display getView()\n-   {\n-      return view_;\n-   }\n-\n-   private void revertActiveDocument()\n-   {\n-      if (activeEditor_ == null)\n-         return;\n-      \n-      if (activeEditor_.getPath() != null)\n-         activeEditor_.revertChanges(null);\n-      \n-      // Ensure that the document is in view\n-      activeEditor_.ensureCursorVisible();\n-   }\n-   \n-   private void revertUnsavedTargets(Command onCompleted)\n-   {\n-      // collect up unsaved targets\n-      ArrayList<EditingTarget> unsavedTargets =  new ArrayList<EditingTarget>();\n-      for (EditingTarget target : editors_)\n-         if (isUnsavedTarget(target, TYPE_FILE_BACKED))\n-            unsavedTargets.add(target);\n-      \n-      // revert all of them\n-      cpsExecuteForEachEditor(\n-         \n-         // targets the user chose not to save\n-         unsavedTargets, \n-         \n-         // save each editor\n-         new CPSEditingTargetCommand()\n-         {\n-            @Override\n-            public void execute(EditingTarget saveTarget, \n-                                Command continuation)\n-            {\n-               if (saveTarget.getPath() != null)\n-               {\n-                  // file backed document -- revert it\n-                  saveTarget.revertChanges(continuation);\n-               }\n-               else\n-               {\n-                  // untitled document -- just close the tab non-interactively\n-                  view_.closeTab(saveTarget.asWidget(), false, continuation);\n-               }\n-            }\n-         },\n-         \n-         // onCompleted at the end\n-         onCompleted\n-      );          \n-            \n-   }\n-   \n-   @Handler\n-   public void onOpenSourceDoc()\n-   {\n-      fileDialogs_.openFile(\n-            \"Open File\",\n-            fileContext_,\n-            workbenchContext_.getDefaultFileDialogDir(),\n-            new ProgressOperationWithInput<FileSystemItem>()\n-            {\n-               public void execute(final FileSystemItem input,\n-                                   ProgressIndicator indicator)\n-               {\n-                  if (input == null)\n-                     return;\n-\n-                  workbenchContext_.setDefaultFileDialogDir(\n-                                                   input.getParentPath());\n-\n-                  indicator.onCompleted();\n-                  Scheduler.get().scheduleDeferred(new ScheduledCommand()\n-                  {\n-                     public void execute()\n-                     {\n-                        fileTypeRegistry_.openFile(input);\n-                     }\n-                  });\n-               }\n-            });\n-   }\n-   \n-   \n-   \n-   public void onNewDocumentWithCode(final NewDocumentWithCodeEvent event)\n-   {\n-      // determine the type\n-      final EditableFileType docType;\n-      if (event.getType() == NewDocumentWithCodeEvent.R_SCRIPT)\n-         docType = FileTypeRegistry.R;\n-      else if (event.getType() == NewDocumentWithCodeEvent.SQL)\n-         docType = FileTypeRegistry.SQL;\n-      else\n-         docType = FileTypeRegistry.RMARKDOWN;\n-      \n-      // command to create and run the new doc\n-      Command newDocCommand = new Command() {\n-         @Override\n-         public void execute()\n-         {\n-            newDoc(docType,\n-                   event.getCode(),\n-                   new ResultCallback<EditingTarget, ServerError>() {\n-               public void onSuccess(EditingTarget arg)\n-               {\n-                  TextEditingTarget editingTarget = (TextEditingTarget)arg;\n-                  \n-                  if (event.getCursorPosition() != null)\n-                  {\n-                     editingTarget.navigateToPosition(event.getCursorPosition(),\n-                                                      false);\n-                  }\n-                  \n-                  if (event.getExecute())\n-                  {\n-                     if (docType.equals(FileTypeRegistry.R))\n-                     {\n-                        commands_.executeToCurrentLine().execute();\n-                        commands_.activateSource().execute();\n-                     }\n-                     else if (docType.equals(FileTypeRegistry.SQL))\n-                     {\n-                        commands_.previewSql().execute();\n-                     }\n-                     else\n-                     {\n-                        commands_.executePreviousChunks().execute();\n-                     }\n-                  }\n-               }\n-            });\n-         }\n-      };\n-     \n-      // do it\n-      if (docType.equals(FileTypeRegistry.R))\n-      {\n-         newDocCommand.execute();\n-      }\n-      else\n-      {\n-         dependencyManager_.withRMarkdown(\"R Notebook\",\n-                                          \"Create R Notebook\", \n-                                          newDocCommand);\n-      }\n-   }\n-   \n-   @Handler\n-   public void onNewRPlumberDoc()\n-   {\n-      dependencyManager_.withRPlumber(\"Creating R Plumber API\", new Command()\n-      {\n-         @Override\n-         public void execute()\n-         {\n-            NewPlumberAPI widget = new NewPlumberAPI(\n-                  \"New Plumber API\",\n-                  new OperationWithInput<NewPlumberAPI.Result>()\n-                  {\n-                     @Override\n-                     public void execute(NewPlumberAPI.Result input)\n-                     {\n-                        doNewRPlumberAPI(input);\n-                     }\n-                  });\n-         \n-            widget.showModal();\n-\n-         }\n-      });\n-   }\n-    \n-   public void onOpenSourceFile(final OpenSourceFileEvent event)\n-   {\n-      doOpenSourceFile(event.getFile(),\n-                     event.getFileType(),\n-                     event.getPosition(),\n-                     null, \n-                     event.getNavigationMethod(),\n-                     false);\n-   }\n-   \n-   public void onOpenPresentationSourceFile(OpenPresentationSourceFileEvent event)\n-   {\n-      // don't do the navigation if the active document is a source\n-      // file from this presentation module\n-      \n-      doOpenSourceFile(event.getFile(),\n-                       event.getFileType(),\n-                       event.getPosition(),\n-                       event.getPattern(),\n-                       NavigationMethods.HIGHLIGHT_LINE,\n-                       true);\n-      \n-   }\n-   \n-   public void onEditPresentationSource(final EditPresentationSourceEvent event)\n-   { \n-      openingForSourceNavigation_ = true;\n-      openFile(\n-            event.getSourceFile(), \n-            FileTypeRegistry.RPRESENTATION,\n-            new CommandWithArg<EditingTarget>() {\n-               @Override\n-               public void execute(final EditingTarget editor)\n-               {   \n-                  openingForSourceNavigation_ = false;\n-                  TextEditingTargetPresentationHelper.navigateToSlide(\n-                                                         editor, \n-                                                         event.getSlideIndex());\n-               }\n-         });\n-   }\n-   \n-   public void forceLoad()\n-   {\n-      AceEditor.preload();\n-   }\n-\n-   public String getCurrentDocId()\n-   {\n-      if (getActiveEditor() == null)\n-         return null;\n-      return getActiveEditor().getId();\n-   }\n-\n-   public String getCurrentDocPath()\n-   {\n-      if (getActiveEditor() == null)\n-         return null;\n-      return getActiveEditor().getPath();\n-   }\n-   \n-   private void doOpenSourceFile(final FileSystemItem file,\n-                                 final TextFileType fileType,\n-                                 final FilePosition position,\n-                                 final String pattern,\n-                                 final int navMethod, \n-                                 final boolean forceHighlightMode)\n-   {\n-      // if the navigation should happen in another window, do that instead\n-      NavigationResult navResult = \n-            pWindowManager_.get().navigateToFile(file, position, navMethod);\n-      \n-      // we navigated externally, just skip this\n-      if (navResult.getType() == NavigationResult.RESULT_NAVIGATED)\n-         return;\n-      \n-      // we're about to open in this window--if it's the main window, focus it\n-      if (SourceWindowManager.isMainSourceWindow() && Desktop.hasDesktopFrame())\n-         Desktop.getFrame().bringMainFrameToFront();\n-      \n-      final boolean isDebugNavigation = \n-            navMethod == NavigationMethods.DEBUG_STEP ||\n-            navMethod == NavigationMethods.DEBUG_END;\n-      \n-      final CommandWithArg<EditingTarget> editingTargetAction = \n-            new CommandWithArg<EditingTarget>() \n-      {\n-         @Override\n-         public void execute(EditingTarget target)\n-         {\n-            // the rstudioapi package can use the proxy (-1, -1) position to\n-            // indicate that source navigation should not occur; ie, we should\n-            // preserve whatever position was used in the document earlier\n-            boolean navigateToPosition =\n-                  position != null &&\n-                  (position.getLine() != -1 || position.getColumn() != -1);\n-            \n-            if (navigateToPosition)\n-            {\n-               SourcePosition endPosition = null;\n-               if (isDebugNavigation)\n-               {\n-                  DebugFilePosition filePos = \n-                        (DebugFilePosition) position.cast();\n-                  endPosition = SourcePosition.create(\n-                        filePos.getEndLine() - 1,\n-                        filePos.getEndColumn() + 1);\n-                  \n-                  if (Desktop.hasDesktopFrame() &&\n-                      navMethod != NavigationMethods.DEBUG_END)\n-                      Desktop.getFrame().bringMainFrameToFront();\n-               }\n-               navigate(target, \n-                        SourcePosition.create(position.getLine() - 1,\n-                                              position.getColumn() - 1),\n-                        endPosition);\n-            }\n-            else if (pattern != null)\n-            {\n-               Position pos = target.search(pattern);\n-               if (pos != null)\n-               {\n-                  navigate(target, \n-                           SourcePosition.create(pos.getRow(), 0),\n-                           null);\n-               }\n-            }\n-         }\n-         \n-         private void navigate(final EditingTarget target,\n-                               final SourcePosition srcPosition,\n-                               final SourcePosition srcEndPosition)\n-         {\n-            Scheduler.get().scheduleDeferred(new ScheduledCommand()\n-            {\n-               @Override\n-               public void execute()\n-               {\n-                  if (navMethod == NavigationMethods.DEBUG_STEP)\n-                  {\n-                     target.highlightDebugLocation(\n-                           srcPosition, \n-                           srcEndPosition, \n-                           true);\n-                  }\n-                  else if (navMethod == NavigationMethods.DEBUG_END)\n-                  {\n-                     target.endDebugHighlighting();\n-                  }\n-                  else\n-                  {\n-                     // force highlight mode if requested\n-                     if (forceHighlightMode)\n-                        target.forceLineHighlighting();\n-                     \n-                     // now navigate to the new position\n-                     boolean highlight = \n-                           navMethod == NavigationMethods.HIGHLIGHT_LINE &&\n-                           !userPrefs_.highlightSelectedLine().getValue();\n-                     target.navigateToPosition(srcPosition,\n-                                               false,\n-                                               highlight);\n-                  }\n-               }\n-            });\n-         }\n-      };\n-\n-      if (navResult.getType() == NavigationResult.RESULT_RELOCATE)\n-      {\n-         server_.getSourceDocument(navResult.getDocId(),\n-               new ServerRequestCallback<SourceDocument>()\n-         {\n-            @Override\n-            public void onResponseReceived(final SourceDocument doc)\n-            {\n-               editingTargetAction.execute(addTab(doc, OPEN_REPLAY));\n-            }\n-\n-            @Override\n-            public void onError(ServerError error)\n-            {\n-               globalDisplay_.showErrorMessage(\"Document Tab Move Failed\", \n-                     \"Couldn't move the tab to this window: \\n\" + \n-                      error.getMessage());\n-            }\n-         });\n-         return;\n-      }\n-\n-      final CommandWithArg<FileSystemItem> action = new CommandWithArg<FileSystemItem>()\n-      {\n-         @Override\n-         public void execute(FileSystemItem file)\n-         {\n-            // set flag indicating we are opening for a source navigation\n-            openingForSourceNavigation_ = position != null || pattern != null;\n-            \n-            openFile(file,\n-                     fileType,\n-                     (target) -> {\n-                        openingForSourceNavigation_ = false;\n-                        editingTargetAction.execute(target);\n-                     });      \n-         }\n-      };\n-\n-      // If this is a debug navigation, we only want to treat this as a full\n-      // file open if the file isn't already open; otherwise, we can just\n-      // highlight in place.\n-      if (isDebugNavigation)\n-      {\n-         setPendingDebugSelection();\n-         \n-         for (int i = 0; i < editors_.size(); i++)\n-         {\n-            EditingTarget target = editors_.get(i);\n-            String path = target.getPath();\n-            if (path != null && path.equalsIgnoreCase(file.getPath()))\n-            {\n-               // the file's open; just update its highlighting \n-               if (navMethod == NavigationMethods.DEBUG_END)\n-               {\n-                  target.endDebugHighlighting();\n-               }\n-               else\n-               {\n-                  view_.selectTab(i);\n-                  editingTargetAction.execute(target);\n-               }\n-               return;\n-            }\n-         }\n-         \n-         // If we're here, the target file wasn't open in an editor. Don't\n-         // open a file just to turn off debug highlighting in the file!\n-         if (navMethod == NavigationMethods.DEBUG_END)\n-            return;\n-      }\n-\n-      // Warning: event.getFile() can be null (e.g. new Sweave document)\n-      if (file != null && file.getLength() < 0)\n-      {\n-         statQueue_.add(new StatFileEntry(file, action));\n-         if (statQueue_.size() == 1)\n-            processStatQueue();\n-      }\n-      else\n-      {\n-         action.execute(file);\n-      }\n-   }\n-   \n-   private void processStatQueue()\n-   {\n-      if (statQueue_.isEmpty())\n-         return;\n-      final StatFileEntry entry = statQueue_.peek();\n-      final Command processNextEntry = new Command()\n-            {\n-               @Override\n-               public void execute()\n-               {\n-                  statQueue_.remove();\n-                  if (!statQueue_.isEmpty())\n-                     processStatQueue();\n-               }\n-            };\n-       \n-       server_.stat(entry.file.getPath(), new ServerRequestCallback<FileSystemItem>()\n-       {\n-          @Override\n-          public void onResponseReceived(FileSystemItem response)\n-          {\n-             processNextEntry.execute();\n-             entry.action.execute(response);\n-          }\n-\n-          @Override\n-          public void onError(ServerError error)\n-          {\n-             processNextEntry.execute();\n-             // Couldn't stat the file? Proceed anyway. If the file doesn't\n-             // exist, we'll let the downstream code be the one to show the\n-             // error.\n-             entry.action.execute(entry.file);\n-          }\n-        });\n-   }\n-\n-   private void openFile(FileSystemItem file)\n-   {\n-      openFile(file, fileTypeRegistry_.getTextTypeForFile(file));\n-   }\n-   \n-   private void openFile(FileSystemItem file,  TextFileType fileType)\n-   {\n-      openFile(file, \n-               fileType, \n-               new CommandWithArg<EditingTarget>() {\n-                  @Override\n-                  public void execute(EditingTarget arg)\n-                  {\n-                     \n-                  }\n-               });\n-   }\n-   \n-   private void openFile(final FileSystemItem file,\n-                         final TextFileType fileType,\n-                         final CommandWithArg<EditingTarget> executeOnSuccess)\n-   {\n-      // add this work to the queue\n-      openFileQueue_.add(new OpenFileEntry(file, fileType, executeOnSuccess));\n-      \n-      // begin queue processing if it's the only work in the queue\n-      if (openFileQueue_.size() == 1)\n-         processOpenFileQueue();\n-   }\n-   \n-   private void processOpenFileQueue()\n-   {\n-      // no work to do\n-      if (openFileQueue_.isEmpty())\n-         return;\n-      \n-      // find the first work unit\n-      final OpenFileEntry entry = openFileQueue_.peek();\n-      \n-      // define command to advance queue\n-      final Command processNextEntry = new Command()\n-            {\n-               @Override\n-               public void execute()\n-               {\n-                  openFileQueue_.remove();\n-                  if (!openFileQueue_.isEmpty())\n-                     processOpenFileQueue();\n-                  \n-               }\n-            };\n-      \n-      openFile(entry.file,\n-            entry.fileType,\n-            new ResultCallback<EditingTarget, ServerError>() {\n-               @Override\n-               public void onSuccess(EditingTarget target)\n-               {\n-                  processNextEntry.execute();\n-                  if (entry.executeOnSuccess != null)\n-                     entry.executeOnSuccess.execute(target);\n-               }\n-\n-               @Override\n-               public void onCancelled()\n-               {\n-                  super.onCancelled();\n-                  processNextEntry.execute();\n-               }\n-\n-               @Override\n-               public void onFailure(ServerError error)\n-               {\n-                  String message = error.getUserMessage();\n-                  \n-                  // see if a special message was provided\n-                  JSONValue errValue = error.getClientInfo();\n-                  if (errValue != null)\n-                  {\n-                     JSONString errMsg = errValue.isString();\n-                     if (errMsg != null)\n-                        message = errMsg.stringValue();\n-                  }\n-                  \n-                  globalDisplay_.showMessage(GlobalDisplay.MSG_ERROR,\n-                                             \"Error while opening file\",\n-                                             message);\n-\n-                  processNextEntry.execute();\n-               }\n-            });  \n-   }\n-   \n-   private void openNotebook(\n-         final FileSystemItem rmdFile, \n-         final SourceDocumentResult doc,\n-         final ResultCallback<EditingTarget, ServerError> resultCallback)\n-   {\n-      if (!StringUtil.isNullOrEmpty(doc.getDocPath()))\n-      {\n-         // this happens if we created the R Markdown file, or if the R Markdown\n-         // file on disk matched the one inside the notebook\n-         openFileFromServer(rmdFile, \n-               FileTypeRegistry.RMARKDOWN, resultCallback);\n-      }\n-      else if (!StringUtil.isNullOrEmpty(doc.getDocId()))\n-      {\n-         // this happens when we have to open an untitled buffer for the the\n-         // notebook (usually because the of a conflict between the Rmd on disk\n-         // and the one in the .nb.html file)\n-         server_.getSourceDocument(doc.getDocId(), \n-               new ServerRequestCallback<SourceDocument>()\n-         {\n-            @Override\n-            public void onResponseReceived(SourceDocument doc)\n-            {\n-               // create the editor\n-               EditingTarget target = \n-                     addTab(doc, OPEN_INTERACTIVE);\n-               \n-               // show a warning bar \n-               if (target instanceof TextEditingTarget)\n-               {\n-                  ((TextEditingTarget) target).showWarningMessage(\n-                        \"This notebook has the same name as an R Markdown \" +\n-                        \"file, but doesn't match it.\");\n-               }\n-               resultCallback.onSuccess(target);\n-            }\n-\n-            @Override\n-            public void onError(ServerError error)\n-            {\n-               \n-               globalDisplay_.showErrorMessage(\n-                  \"Notebook Open Failed\", \n-                  \"This notebook could not be opened. \" +\n-                  \"If the error persists, try removing the \" +\n-                  \"accompanying R Markdown file. \\n\\n\" +\n-                  error.getMessage());\n-               resultCallback.onFailure(error);\n-            }\n-         });\n-      }\n-   }\n-   \n-   private void openNotebook(final FileSystemItem rnbFile,\n-                             final TextFileType fileType,\n-                             final ResultCallback<EditingTarget, ServerError> resultCallback)\n-   {\n-      // construct path to .Rmd\n-      final String rnbPath = rnbFile.getPath();\n-      final String rmdPath = FilePathUtils.filePathSansExtension(rnbPath) + \".Rmd\";\n-      final FileSystemItem rmdFile = FileSystemItem.createFile(rmdPath);\n-      \n-      // if we already have associated .Rmd file open, then just edit it\n-      // TODO: should we perform conflict resolution here as well?\n-      if (openFileAlreadyOpen(rmdFile, resultCallback))\n-         return;\n-      \n-      // ask the server to extract the .Rmd, then open that\n-      Command extractRmdCommand = new Command()\n-      {\n-         @Override\n-         public void execute()\n-         {\n-            server_.extractRmdFromNotebook(\n-                  rnbPath,\n-                  new ServerRequestCallback<SourceDocumentResult>()\n-                  {\n-                     @Override\n-                     public void onResponseReceived(SourceDocumentResult doc)\n-                     {\n-                        openNotebook(rmdFile, doc, resultCallback);\n-                     }\n-\n-                     @Override\n-                     public void onError(ServerError error)\n-                     {\n-                        globalDisplay_.showErrorMessage(\"Notebook Open Failed\", \n-                              \"This notebook could not be opened. \\n\\n\" +\n-                              error.getMessage());\n-                        resultCallback.onFailure(error);\n-                     }\n-                  });\n-         }\n-      };\n-      \n-      dependencyManager_.withRMarkdown(\"R Notebook\", \"Using R Notebooks\", extractRmdCommand);\n-   }\n-   \n-   private boolean openFileAlreadyOpen(final FileSystemItem file,\n-                                       final ResultCallback<EditingTarget, ServerError> resultCallback)\n-   {\n-      // check to see if any local editors have the file open\n-      for (int i = 0; i < editors_.size(); i++)\n-      {\n-         EditingTarget target = editors_.get(i);\n-         String thisPath = target.getPath();\n-         if (thisPath != null\n-             && thisPath.equalsIgnoreCase(file.getPath()))\n-         {\n-            view_.selectTab(i);\n-            pMruList_.get().add(thisPath);\n-            if (resultCallback != null)\n-               resultCallback.onSuccess(target);\n-            return true;\n-         }\n-      }\n-      return false;\n-   }\n-\n-   // top-level wrapper for opening files. takes care of:\n-   //  - making sure the view is visible\n-   //  - checking whether it is already open and re-selecting its tab\n-   //  - prohibit opening very large files (>500KB)\n-   //  - confirmation of opening large files (>100KB)\n-   //  - finally, actually opening the file from the server\n-   //    via the call to the lower level openFile method\n-   private void openFile(final FileSystemItem file,\n-                         final TextFileType fileType,\n-                         final ResultCallback<EditingTarget, ServerError> resultCallback)\n-   {\n-      ensureVisible(true);\n-      \n-      if (fileType.isRNotebook())\n-      {\n-         openNotebook(file, fileType, resultCallback);\n-         return;\n-      }\n-\n-      if (file == null)\n-      {\n-         newDoc(fileType, resultCallback);\n-         return;\n-      }\n-\n-      if (openFileAlreadyOpen(file, resultCallback))\n-         return;\n-      \n-      EditingTarget target = editingTargetSource_.getEditingTarget(fileType);\n-\n-      if (file.getLength() > target.getFileSizeLimit())\n-      {\n-         if (resultCallback != null)\n-            resultCallback.onCancelled();\n-         showFileTooLargeWarning(file, target.getFileSizeLimit());\n-      }\n-      else if (file.getLength() > target.getLargeFileSize())\n-      {\n-         confirmOpenLargeFile(file, new Operation() {\n-            public void execute()\n-            {\n-               openFileFromServer(file, fileType, resultCallback);\n-            }\n-         }, new Operation() {\n-            public void execute()\n-            {\n-               // user (wisely) cancelled\n-               if (resultCallback != null)\n-                  resultCallback.onCancelled();\n-            }\n-         });\n-      }\n-      else\n-      {\n-         openFileFromServer(file, fileType, resultCallback);\n-      }\n-   }\n-  \n-   private void showFileTooLargeWarning(FileSystemItem file,\n-                                        long sizeLimit)\n-   {\n-      StringBuilder msg = new StringBuilder();\n-      msg.append(\"The file '\" + file.getName() + \"' is too \");\n-      msg.append(\"large to open in the source editor (the file is \");\n-      msg.append(StringUtil.formatFileSize(file.getLength()) + \" and the \");\n-      msg.append(\"maximum file size is \");\n-      msg.append(StringUtil.formatFileSize(sizeLimit) + \")\");\n-\n-      globalDisplay_.showMessage(GlobalDisplay.MSG_WARNING,\n-                                 \"Selected File Too Large\",\n-                                 msg.toString());\n-   }\n-\n-   private void confirmOpenLargeFile(FileSystemItem file,\n-                                     Operation openOperation,\n-                                     Operation noOperation)\n-   {\n-      StringBuilder msg = new StringBuilder();\n-      msg.append(\"The source file '\" + file.getName() + \"' is large (\");\n-      msg.append(StringUtil.formatFileSize(file.getLength()) + \") \");\n-      msg.append(\"and may take some time to open. \");\n-      msg.append(\"Are you sure you want to continue opening it?\");\n-      globalDisplay_.showYesNoMessage(GlobalDisplay.MSG_WARNING,\n-                                      \"Confirm Open\",\n-                                      msg.toString(),\n-                                      false, // Don't include cancel\n-                                      openOperation,\n-                                      noOperation,\n-                                      false);   // 'No' is default\n-   }\n-\n-   private void openFileFromServer(\n-         final FileSystemItem file,\n-         final TextFileType fileType,\n-         final ResultCallback<EditingTarget, ServerError> resultCallback)\n-   {\n-      final Command dismissProgress = globalDisplay_.showProgress(\n-                                                         \"Opening file...\");\n-\n-      server_.openDocument(\n-            file.getPath(),\n-            fileType.getTypeId(),\n-            userPrefs_.defaultEncoding().getValue(),\n-            new ServerRequestCallback<SourceDocument>()\n-            {\n-               @Override\n-               public void onError(ServerError error)\n-               {\n-                  dismissProgress.execute();\n-                  pMruList_.get().remove(file.getPath());\n-                  Debug.logError(error);\n-                  if (resultCallback != null)\n-                     resultCallback.onFailure(error);\n-               }\n-\n-               @Override\n-               public void onResponseReceived(SourceDocument document)\n-               {\n-                  // if we are opening for a source navigation then we \n-                  // need to force Rmds into source mode\n-                  if (openingForSourceNavigation_) \n-                  {\n-                     document.getProperties()._setBoolean(\n-                        TextEditingTarget.RMD_VISUAL_MODE, \n-                        false\n-                     );\n-                  }\n-                  \n-                  dismissProgress.execute();\n-                  pMruList_.get().add(document.getPath());\n-                  EditingTarget target = addTab(document, OPEN_INTERACTIVE);\n-                  if (resultCallback != null)\n-                     resultCallback.onSuccess(target);\n-               }\n-            });\n-   }\n-   \n-   Widget createWidget(EditingTarget target)\n-   {\n-      return target.asWidget();\n-   }\n-   \n-   private EditingTarget addTab(SourceDocument doc, int mode)\n-   {\n-      return addTab(doc, false, mode);\n-   }\n-   \n-   private EditingTarget addTab(SourceDocument doc, boolean atEnd, \n-         int mode)\n-   {\n-      // by default, add at the tab immediately after the current tab\n-      return addTab(doc, atEnd ? null : getPhysicalTabIndex() + 1,\n-            mode);\n-   }\n-\n-   private EditingTarget addTab(SourceDocument doc, Integer position, \n-         int mode)\n-   {\n-      final String defaultNamePrefix = editingTargetSource_.getDefaultNamePrefix(doc);\n-      final EditingTarget target = editingTargetSource_.getEditingTarget(\n-            doc, fileContext_, new Provider<String>()\n-            {\n-               public String get()\n-               {\n-                  return getNextDefaultName(defaultNamePrefix);\n-               }\n-            });\n-      \n-      final Widget widget = createWidget(target);\n-\n-      if (position == null)\n-      {\n-         editors_.add(target);\n-      }\n-      else\n-      {\n-         // we're inserting into an existing permuted tabset -- push aside \n-         // any tabs physically to the right of this tab\n-         editors_.add(position, target);\n-         for (int i = 0; i < tabOrder_.size(); i++)\n-         {\n-            int pos = tabOrder_.get(i);\n-            if (pos >= position)\n-               tabOrder_.set(i, pos + 1);\n-         }\n-\n-         // add this tab in its \"natural\" position\n-         tabOrder_.add(position, position);\n-      }\n-\n-      view_.addTab(widget,\n-                   target.getIcon(),\n-                   target.getId(),\n-                   target.getName().getValue(),\n-                   target.getTabTooltip(), // used as tooltip, if non-null\n-                   position,\n-                   true);\n-      fireDocTabsChanged();\n-\n-      target.getName().addValueChangeHandler(new ValueChangeHandler<String>()\n-      {\n-         public void onValueChange(ValueChangeEvent<String> event)\n-         {\n-            view_.renameTab(widget,\n-                            target.getIcon(),\n-                            event.getValue(),\n-                            target.getPath());\n-            fireDocTabsChanged();\n-         }\n-      });\n-\n-      view_.setDirty(widget, target.dirtyState().getValue());\n-      target.dirtyState().addValueChangeHandler(new ValueChangeHandler<Boolean>()\n-      {\n-         public void onValueChange(ValueChangeEvent<Boolean> event)\n-         {\n-            view_.setDirty(widget, event.getValue());\n-            manageCommands();\n-         }\n-      });\n-\n-      target.addEnsureVisibleHandler(new EnsureVisibleHandler()\n-      {\n-         public void onEnsureVisible(EnsureVisibleEvent event)\n-         {\n-            view_.selectTab(widget);\n-         }\n-      });\n-\n-      target.addCloseHandler(new CloseHandler<Void>()\n-      {\n-         public void onClose(CloseEvent<Void> voidCloseEvent)\n-         {\n-            view_.closeTab(widget, false);\n-         }\n-      });\n-      \n-      events_.fireEvent(new SourceDocAddedEvent(doc, mode));\n-      \n-      if (target instanceof TextEditingTarget && doc.isReadOnly())\n-      {\n-         ((TextEditingTarget) target).setIntendedAsReadOnly(\n-               JsUtil.toList(doc.getReadOnlyAlternatives()));\n-      }\n-      \n-      // adding a tab may enable commands that are only available when \n-      // multiple documents are open; if this is the second document, go check\n-      if (editors_.size() == 2)\n-         manageMultiTabCommands();\n-      \n-      // if the target had an editing session active, attempt to resume it\n-      if (doc.getCollabParams() != null)\n-         target.beginCollabSession(doc.getCollabParams());\n-      \n-      return target;\n-   }\n-\n-   private String getNextDefaultName(String defaultNamePrefix)\n-   {\n-      if (StringUtil.isNullOrEmpty(defaultNamePrefix))\n-      {\n-         defaultNamePrefix = \"Untitled\";\n-      }\n-      \n-      int max = 0;\n-      for (EditingTarget target : editors_)\n-      {\n-         String name = target.getName().getValue();\n-         max = Math.max(max, getUntitledNum(name, defaultNamePrefix));\n-      }\n-\n-      return defaultNamePrefix + (max + 1);\n-   }\n-\n-   private native final int getUntitledNum(String name, String prefix) /*-{\n-      var match = (new RegExp(\"^\" + prefix + \"([0-9]{1,5})$\")).exec(name);\n-      if (!match)\n-         return 0;\n-      return parseInt(match[1]);\n-   }-*/;\n-\n-   public void onInsertSource(final InsertSourceEvent event)\n-   {\n-      if (activeEditor_ != null\n-          && activeEditor_ instanceof TextEditingTarget\n-          && commands_.executeCode().isEnabled())\n-      {\n-         TextEditingTarget textEditor = (TextEditingTarget) activeEditor_;\n-         textEditor.insertCode(event.getCode(), event.isBlock());\n-      }\n-      else\n-      {\n-         newDoc(FileTypeRegistry.R,\n-                new ResultCallback<EditingTarget, ServerError>()\n-         {\n-            public void onSuccess(EditingTarget arg)\n-            {\n-               ((TextEditingTarget)arg).insertCode(event.getCode(),\n-                                                   event.isBlock());\n-            }\n-         });\n-      }\n-   }\n-\n-   public void onTabClosing(final TabClosingEvent event)\n-   {\n-      EditingTarget target = editors_.get(event.getTabIndex());\n-      if (!target.onBeforeDismiss())\n-         event.cancel();\n-   }\n-   \n-   @Override\n-   public void onTabClose(TabCloseEvent event)\n-   {\n-      // can't proceed if there is no active editor\n-      if (activeEditor_ == null)\n-         return;\n-\n-      if (event.getTabIndex() >= editors_.size())\n-         return; // Seems like this should never happen...?\n-\n-      final String activeEditorId = activeEditor_.getId();\n-\n-      if (editors_.get(event.getTabIndex()).getId() == activeEditorId)\n-      {\n-         // scan the source navigation history for an entry that can\n-         // be used as the next active tab (anything that doesn't have\n-         // the same document id as the currently active tab)\n-         SourceNavigation srcNav = sourceNavigationHistory_.scanBack(\n-               new SourceNavigationHistory.Filter()\n-               {\n-                  public boolean includeEntry(SourceNavigation navigation)\n-                  {\n-                     return navigation.getDocumentId() != activeEditorId;\n-                  }\n-               });\n-\n-         // see if the source navigation we found corresponds to an active\n-         // tab -- if it does then set this on the event\n-         if (srcNav != null)\n-         {\n-            for (int i=0; i<editors_.size(); i++)\n-            {\n-               if (srcNav.getDocumentId() == editors_.get(i).getId())\n-               {\n-                  view_.selectTab(i);\n-                  break;\n-               }\n-            }\n-         }\n-      }\n-   }\n-   \n-   private void closeTabIndex(int idx, boolean closeDocument)\n-   {\n-      EditingTarget target = editors_.remove(idx);\n-\n-      tabOrder_.remove(new Integer(idx));\n-      for (int i = 0; i < tabOrder_.size(); i++)\n-      {\n-         if (tabOrder_.get(i) > idx)\n-         {\n-            tabOrder_.set(i, tabOrder_.get(i) - 1);\n-         }\n-      }\n-\n-      target.onDismiss(closeDocument ? EditingTarget.DISMISS_TYPE_CLOSE :\n-         EditingTarget.DISMISS_TYPE_MOVE);\n-      if (activeEditor_ == target)\n-      {\n-         activeEditor_.onDeactivate();\n-         activeEditor_ = null;\n-      }\n-\n-      if (closeDocument)\n-      {\n-         events_.fireEvent(new DocTabClosedEvent(target.getId()));\n-         server_.closeDocument(target.getId(),\n-                               new VoidServerRequestCallback());\n-      }\n-\n-      manageCommands();\n-      fireDocTabsChanged();\n-\n-      if (view_.getTabCount() == 0)\n-      {\n-         sourceNavigationHistory_.clear();\n-         events_.fireEvent(new LastSourceDocClosedEvent());\n-      }\n-   }\n-\n-   public void onTabClosed(TabClosedEvent event)\n-   {\n-      closeTabIndex(event.getTabIndex(), !suspendDocumentClose_);\n-   }\n-\n-   \n-   @Override\n-   public void onTabReorder(TabReorderEvent event)\n-   {\n-      syncTabOrder();\n-      \n-      // sanity check: make sure we're moving from a valid location and to a\n-      // valid location\n-      if (event.getOldPos() < 0 || event.getOldPos() >= tabOrder_.size() ||\n-          event.getNewPos() < 0 || event.getNewPos() >= tabOrder_.size())\n-      {\n-         return;\n-      }\n-      \n-      // remove the tab from its old position\n-      int idx = tabOrder_.get(event.getOldPos());\n-      tabOrder_.remove(new Integer(idx));  // force type box \n-\n-      // add it to its new position \n-      tabOrder_.add(event.getNewPos(), idx);\n-      \n-      // sort the document IDs and send to the server\n-      ArrayList<String> ids = new ArrayList<String>();\n-      for (int i = 0; i < tabOrder_.size(); i++)\n-      {\n-         ids.add(editors_.get(tabOrder_.get(i)).getId());\n-      }\n-      server_.setDocOrder(ids, new VoidServerRequestCallback());\n-      \n-      // activate the tab \n-      setPhysicalTabIndex(event.getNewPos());\n-\n-      fireDocTabsChanged();\n-   }\n-\n-   private void syncTabOrder()\n-   {\n-      // ensure the tab order is synced to the list of editors\n-      for (int i = tabOrder_.size(); i < editors_.size(); i++)\n-      {\n-         tabOrder_.add(i);\n-      }\n-      for (int i = editors_.size(); i < tabOrder_.size(); i++)\n-      {\n-         tabOrder_.remove(i);\n-      }\n-   }\n-\n-   private void fireDocTabsChanged()\n-   {\n-      if (!initialized_)\n-         return;\n-      \n-      // ensure we have a tab order (we want the popup list to match the order\n-      // of the tabs)\n-      syncTabOrder();\n-\n-      String[] ids = new String[editors_.size()];\n-      FileIcon[] icons = new FileIcon[editors_.size()];\n-      String[] names = new String[editors_.size()];\n-      String[] paths = new String[editors_.size()];\n-      for (int i = 0; i < ids.length; i++)\n-      {\n-         EditingTarget target = editors_.get(tabOrder_.get(i));\n-         ids[i] = target.getId();\n-         icons[i] = target.getIcon();\n-         names[i] = target.getName().getValue();\n-         paths[i] = target.getPath();\n-      }\n-\n-      String activeId = (activeEditor_ != null)\n-            ? activeEditor_.getId()\n-            : null;\n-            \n-      events_.fireEvent(new DocTabsChangedEvent(activeId, ids, icons, names, paths));\n-\n-      view_.manageChevronVisibility();\n-   }\n-\n-   public void onSelection(SelectionEvent<Integer> event)\n-   {\n-      if (activeEditor_ != null)\n-         activeEditor_.onDeactivate();\n-\n-      activeEditor_ = null;\n-\n-      if (event.getSelectedItem() >= 0)\n-      {\n-         activeEditor_ = editors_.get(event.getSelectedItem());\n-         activeEditor_.onActivate();\n-         \n-         // let any listeners know this tab was activated\n-         events_.fireEvent(new DocTabActivatedEvent(\n-               activeEditor_.getPath(), \n-               activeEditor_.getId()));\n-\n-         // don't send focus to the tab if we're expecting a debug selection\n-         // event\n-         if (initialized_ && !isDebugSelectionPending())\n-         {\n-            Scheduler.get().scheduleDeferred(new ScheduledCommand()\n-            {\n-               public void execute()\n-               {\n-                  // presume that we will give focus to the tab\n-                  boolean focus = true;\n-                  \n-                  if (event instanceof DocTabSelectionEvent)\n+                  else\n                   {\n-                     // however, if this event was generated from a doc tab\n-                     // selection that did not have focus, don't steal focus\n-                     DocTabSelectionEvent tabEvent = (DocTabSelectionEvent) event;\n-                     focus = tabEvent.getFocus();\n-                  }\n-\n-                  if (focus && activeEditor_ != null)\n-                     activeEditor_.focus();\n-               }\n-            });\n-         }\n-         else if (isDebugSelectionPending())\n-         {\n-            // we're debugging, so send focus to the console instead of the \n-            // editor\n-            commands_.activateConsole().execute();\n-            clearPendingDebugSelection();\n-         }\n-      }\n-      \n-      if (initialized_)\n-         manageCommands();\n-   }\n-\n-   private void manageCommands()\n-   {\n-      manageCommands(false);\n-   }\n-   \n-   private void manageCommands(boolean forceSync)\n-   {\n-      boolean hasDocs = editors_.size() > 0;\n-\n-      commands_.newSourceDoc().setEnabled(true);\n-      commands_.closeSourceDoc().setEnabled(hasDocs);\n-      commands_.closeAllSourceDocs().setEnabled(hasDocs);\n-      commands_.nextTab().setEnabled(hasDocs);\n-      commands_.previousTab().setEnabled(hasDocs);\n-      commands_.firstTab().setEnabled(hasDocs);\n-      commands_.lastTab().setEnabled(hasDocs);\n-      commands_.switchToTab().setEnabled(hasDocs);\n-      commands_.setWorkingDirToActiveDoc().setEnabled(hasDocs);\n-\n-      HashSet<AppCommand> newCommands = activeEditor_ != null\n-            ? activeEditor_.getSupportedCommands()\n-            : new HashSet<AppCommand>();\n-      \n-      if (forceSync)\n-      {\n-         for (AppCommand command : activeCommands_)\n-         {\n-            command.setEnabled(false);\n-            command.setVisible(false);\n-         }\n-         \n-         for (AppCommand command : newCommands)\n-         {\n-            command.setEnabled(true);\n-            command.setVisible(true);\n-         }\n-      }\n-      else\n-      {\n-         HashSet<AppCommand> commandsToEnable = new HashSet<AppCommand>(newCommands);\n-         commandsToEnable.removeAll(activeCommands_);\n-\n-         HashSet<AppCommand> commandsToDisable = new HashSet<AppCommand>(activeCommands_);\n-         commandsToDisable.removeAll(newCommands);\n-\n-         for (AppCommand command : commandsToEnable)\n-         {\n-            command.setEnabled(true);\n-            command.setVisible(true);\n-         }\n-\n-         for (AppCommand command : commandsToDisable)\n-         {\n-            command.setEnabled(false);\n-            command.setVisible(false);\n-         }\n-      }\n-      \n-      // commands which should always be visible even when disabled\n-      commands_.saveSourceDoc().setVisible(true);\n-      commands_.saveSourceDocAs().setVisible(true);\n-      commands_.printSourceDoc().setVisible(true);\n-      commands_.setWorkingDirToActiveDoc().setVisible(true);\n-      commands_.debugBreakpoint().setVisible(true);\n-      \n-      // manage synctex commands\n-      manageSynctexCommands();\n-      \n-      // manage vcs commands\n-      manageVcsCommands();\n-      \n-      // manage save and save all\n-      manageSaveCommands();\n-      \n-      // manage source navigation\n-      manageSourceNavigationCommands();\n-      \n-      // manage RSConnect commands\n-      manageRSConnectCommands();\n-      \n-      // manage R Markdown commands\n-      manageRMarkdownCommands();\n-      \n-      // manage multi-tab commands\n-      manageMultiTabCommands();\n-      \n-      manageTerminalCommands();\n-      \n-      activeCommands_ = newCommands;\n-      \n-      // give the active editor a chance to manage commands\n-      if (activeEditor_ != null)\n-         activeEditor_.manageCommands();\n-\n-      assert verifyNoUnsupportedCommands(newCommands)\n-            : \"Unsupported commands detected (please add to Source.dynamicCommands_)\";\n-   }\n-   \n-   private void manageMultiTabCommands()\n-   {\n-      boolean hasMultipleDocs = editors_.size() > 1;\n-\n-      // special case--these editing targets always support popout, but it's\n-      // nonsensical to show it if it's the only tab in a satellite; hide it in\n-      // this case\n-      if (commands_.popoutDoc().isEnabled() &&\n-          activeEditor_ != null &&\n-          (activeEditor_ instanceof TextEditingTarget ||\n-           activeEditor_ instanceof CodeBrowserEditingTarget) &&\n-          !SourceWindowManager.isMainSourceWindow())\n-      {\n-         commands_.popoutDoc().setVisible(hasMultipleDocs);\n-      }\n-      \n-      commands_.closeOtherSourceDocs().setEnabled(hasMultipleDocs);\n-   }\n-   \n-   private void manageSynctexCommands()\n-   {\n-      // synctex commands are enabled if we have synctex for the active editor\n-      boolean synctexAvailable = synctex_.isSynctexAvailable();\n-      if (synctexAvailable)\n-      {\n-         if ((activeEditor_ != null) && \n-             (activeEditor_.getPath() != null) &&\n-             activeEditor_.canCompilePdf())\n-         {\n-            synctexAvailable = synctex_.isSynctexAvailable();\n-         }\n-         else\n-         {\n-            synctexAvailable = false;\n-         }\n-      }\n-     \n-      synctex_.enableCommands(synctexAvailable);\n-   }\n-   \n-   private void manageVcsCommands()\n-   {\n-      // manage availablity of vcs commands\n-      boolean vcsCommandsEnabled = \n-            session_.getSessionInfo().isVcsEnabled() &&\n-            (activeEditor_ != null) &&\n-            (activeEditor_.getPath() != null) &&\n-            activeEditor_.getPath().startsWith(\n-                  session_.getSessionInfo().getActiveProjectDir().getPath());\n-      \n-      commands_.vcsFileLog().setVisible(vcsCommandsEnabled);\n-      commands_.vcsFileLog().setEnabled(vcsCommandsEnabled);\n-      commands_.vcsFileDiff().setVisible(vcsCommandsEnabled);\n-      commands_.vcsFileDiff().setEnabled(vcsCommandsEnabled);\n-      commands_.vcsFileRevert().setVisible(vcsCommandsEnabled);\n-      commands_.vcsFileRevert().setEnabled(vcsCommandsEnabled);\n-          \n-      if (vcsCommandsEnabled)\n-      {\n-         String name = FileSystemItem.getNameFromPath(activeEditor_.getPath());\n-         commands_.vcsFileDiff().setMenuLabel(\"_Diff \\\"\" + name + \"\\\"\");\n-         commands_.vcsFileLog().setMenuLabel(\"_Log of \\\"\" + name +\"\\\"\");\n-         commands_.vcsFileRevert().setMenuLabel(\"_Revert \\\"\" + name + \"\\\"...\");\n-      }\n-      \n-      boolean isGithubRepo = session_.getSessionInfo().isGithubRepository();\n-      if (vcsCommandsEnabled && isGithubRepo)\n-      {\n-         String name = FileSystemItem.getNameFromPath(activeEditor_.getPath());\n-         \n-         commands_.vcsViewOnGitHub().setVisible(true);\n-         commands_.vcsViewOnGitHub().setEnabled(true);\n-         commands_.vcsViewOnGitHub().setMenuLabel(\n-                                  \"_View \\\"\" + name + \"\\\" on GitHub\");\n-         \n-         commands_.vcsBlameOnGitHub().setVisible(true);\n-         commands_.vcsBlameOnGitHub().setEnabled(true);\n-         commands_.vcsBlameOnGitHub().setMenuLabel(\n-                                  \"_Blame \\\"\" + name + \"\\\" on GitHub\");\n-      }\n-      else\n-      {\n-         commands_.vcsViewOnGitHub().setVisible(false);\n-         commands_.vcsViewOnGitHub().setEnabled(false);\n-         commands_.vcsBlameOnGitHub().setVisible(false);\n-         commands_.vcsBlameOnGitHub().setEnabled(false);\n-      }\n-   }\n-   \n-   private void manageRSConnectCommands()\n-   {\n-      boolean rsCommandsAvailable = \n-            SessionUtils.showPublishUi(session_, userState_) &&\n-            (activeEditor_ != null) &&\n-            (activeEditor_.getPath() != null) &&\n-            ((activeEditor_.getExtendedFileType() != null &&\n-              activeEditor_.getExtendedFileType() .startsWith(SourceDocument.XT_SHINY_PREFIX)) ||\n-              activeEditor_.getExtendedFileType() == SourceDocument.XT_RMARKDOWN ||\n-              activeEditor_.getExtendedFileType() == SourceDocument.XT_PLUMBER_API);\n-      commands_.rsconnectDeploy().setVisible(rsCommandsAvailable);\n-      if (activeEditor_ != null)\n-      {\n-         String deployLabel = null;\n-         if (activeEditor_.getExtendedFileType() != null)\n-         {\n-            if (activeEditor_.getExtendedFileType().startsWith(SourceDocument.XT_SHINY_PREFIX))\n-            {\n-               deployLabel = \"Publish Application...\";\n-            }\n-            else if (activeEditor_.getExtendedFileType() == SourceDocument.XT_PLUMBER_API)\n-            {\n-               deployLabel = \"Publish Plumber API...\"; \n-            }\n-         }\n-         if (deployLabel == null)\n-            deployLabel = \"Publish Document...\";\n-   \n-         commands_.rsconnectDeploy().setLabel(deployLabel);\n-      }\n-      commands_.rsconnectConfigure().setVisible(rsCommandsAvailable);\n-   }\n-   \n-   private void manageRMarkdownCommands()\n-   {\n-      boolean rmdCommandsAvailable = \n-            session_.getSessionInfo().getRMarkdownPackageAvailable() &&\n-            (activeEditor_ != null) &&\n-            activeEditor_.getExtendedFileType() == SourceDocument.XT_RMARKDOWN;\n-      commands_.editRmdFormatOptions().setVisible(rmdCommandsAvailable);\n-      commands_.editRmdFormatOptions().setEnabled(rmdCommandsAvailable);\n-   }\n-   \n-   private void manageSaveCommands()\n-   {\n-      boolean saveEnabled = (activeEditor_ != null) &&\n-            activeEditor_.isSaveCommandActive();\n-      commands_.saveSourceDoc().setEnabled(saveEnabled);\n-      manageSaveAllCommand();\n-   }\n-   \n-   \n-   private void manageSaveAllCommand()\n-   {\n-      // if source windows are open, managing state of the command becomes\n-      // complicated, so leave it enabled\n-      if (pWindowManager_.get().areSourceWindowsOpen())\n-      {\n-         commands_.saveAllSourceDocs().setEnabled(true);\n-         return;\n-      }\n-\n-      // if one document is dirty then we are enabled\n-      for (EditingTarget target : editors_)\n-      {\n-         if (target.isSaveCommandActive())\n-         {\n-            commands_.saveAllSourceDocs().setEnabled(true);\n-            return;\n+                     // force highlight mode if requested\n+                     if (forceHighlightMode)\n+                        target.forceLineHighlighting();\n+                     \n+                     // now navigate to the new position\n+                     boolean highlight = \n+                           navMethod == NavigationMethods.HIGHLIGHT_LINE &&\n+                           !userPrefs_.highlightSelectedLine().getValue();\n+                     target.navigateToPosition(srcPosition,\n+                                               false,\n+                                               highlight);\n+                  }\n+               }\n+            });\n          }\n-      }\n-      \n-      // not one was dirty, disabled\n-      commands_.saveAllSourceDocs().setEnabled(false);\n-   }\n-   \n-   private void manageTerminalCommands()\n-   {\n-      if (!session_.getSessionInfo().getAllowShell())\n-         commands_.sendToTerminal().setVisible(false);\n-   }\n-   \n-   private boolean verifyNoUnsupportedCommands(HashSet<AppCommand> commands)\n-   {\n-      HashSet<AppCommand> temp = new HashSet<AppCommand>(commands);\n-      temp.removeAll(dynamicCommands_);\n-      return temp.size() == 0;\n-   }\n-   \n-   private void pasteFileContentsAtCursor(final String path, final String encoding)\n-   {\n-      if (activeEditor_ != null && activeEditor_ instanceof TextEditingTarget)\n+      };\n+\n+      if (navResult.getType() == NavigationResult.RESULT_RELOCATE)\n       {\n-         final TextEditingTarget target = (TextEditingTarget) activeEditor_;\n-         server_.getFileContents(path, encoding, new ServerRequestCallback<String>()\n+         server_.getSourceDocument(navResult.getDocId(),\n+               new ServerRequestCallback<SourceDocument>()\n          {\n             @Override\n-            public void onResponseReceived(String content)\n+            public void onResponseReceived(final SourceDocument doc)\n             {\n-               target.insertCode(content, false);\n+               editingTargetAction.execute(columnManager_.addTab(doc, OPEN_REPLAY, null));\n             }\n \n             @Override\n             public void onError(ServerError error)\n             {\n-               Debug.logError(error);\n+               globalDisplay_.showErrorMessage(\"Document Tab Move Failed\", \n+                     \"Couldn't move the tab to this window: \\n\" + \n+                      error.getMessage());\n             }\n          });\n+         return;\n       }\n-   }\n-   \n-   private void pasteRCodeExecutionResult(final String code)\n-   {\n-      server_.executeRCode(code, new ServerRequestCallback<String>()\n+\n+      final CommandWithArg<FileSystemItem> action = new CommandWithArg<FileSystemItem>()\n       {\n          @Override\n-         public void onResponseReceived(String output)\n+         public void execute(FileSystemItem file)\n          {\n-            if (activeEditor_ != null && activeEditor_ instanceof TextEditingTarget)\n-            {\n-               TextEditingTarget editor = (TextEditingTarget) activeEditor_;\n-               editor.insertCode(output, false);\n-            }\n+            // set flag indicating we are opening for a source navigation\n+            columnManager_.setOpeningForSourceNavigation(position != null || pattern != null);\n+            \n+            columnManager_.openFile(file,\n+                     fileType,\n+                     (target) -> {\n+                        columnManager_.setOpeningForSourceNavigation(false);\n+                        editingTargetAction.execute(target);\n+                     });      \n          }\n+      };\n \n-         @Override\n-         public void onError(ServerError error)\n+      // If this is a debug navigation, we only want to treat this as a full\n+      // file open if the file isn't already open; otherwise, we can just\n+      // highlight in place.\n+      if (isDebugNavigation)\n+      {\n+         columnManager_.startDebug();\n+         \n+         EditingTarget target = columnManager_.findEditorByPath(file.getPath());\n+         if (target != null)\n          {\n-            Debug.logError(error);\n+            // the file's open; just update its highlighting\n+            if (navMethod == NavigationMethods.DEBUG_END)\n+            {\n+               target.endDebugHighlighting();\n+            }\n+            else\n+            {\n+               columnManager_.selectTab(target);\n+               editingTargetAction.execute(target);\n+            }\n+            return;\n          }\n-      });\n-   }\n-   \n-   private void reflowText()\n-   {\n-      if (activeEditor_ != null && activeEditor_ instanceof TextEditingTarget)\n+         \n+         // If we're here, the target file wasn't open in an editor. Don't\n+         // open a file just to turn off debug highlighting in the file!\n+         if (navMethod == NavigationMethods.DEBUG_END)\n+            return;\n+      }\n+\n+      // Warning: event.getFile() can be null (e.g. new Sweave document)\n+      if (file != null && file.getLength() < 0)\n       {\n-         TextEditingTarget editor = (TextEditingTarget) activeEditor_;\n-         editor.reflowText();\n+         statQueue_.add(new StatFileEntry(file, action));\n+         if (statQueue_.size() == 1)\n+            processStatQueue();\n       }\n-   }\n-   \n-   private void reindent()\n-   {\n-      if (activeEditor_ != null && activeEditor_ instanceof TextEditingTarget)\n+      else\n       {\n-         TextEditingTarget editor = (TextEditingTarget) activeEditor_;\n-         editor.getDocDisplay().reindent();\n+         action.execute(file);\n       }\n    }\n    \n-   private void editFile(final String path)\n+   private void processStatQueue()\n    {\n-      server_.ensureFileExists(\n-            path,\n-            new ServerRequestCallback<Boolean>()\n+      if (statQueue_.isEmpty())\n+         return;\n+      final StatFileEntry entry = statQueue_.peek();\n+      final Command processNextEntry = new Command()\n             {\n                @Override\n-               public void onResponseReceived(Boolean success)\n+               public void execute()\n                {\n-                  if (success)\n-                  {\n-                     FileSystemItem file = FileSystemItem.createFile(path);\n-                     openFile(file);\n-                  }\n+                  statQueue_.remove();\n+                  if (!statQueue_.isEmpty())\n+                     processStatQueue();\n                }\n+            };\n+       \n+       server_.stat(entry.file.getPath(), new ServerRequestCallback<FileSystemItem>()\n+       {\n+          @Override\n+          public void onResponseReceived(FileSystemItem response)\n+          {\n+             processNextEntry.execute();\n+             entry.action.execute(response);\n+          }\n \n-               @Override\n-               public void onError(ServerError error)\n-               {\n-                  Debug.logError(error);\n-               }\n-            });\n+          @Override\n+          public void onError(ServerError error)\n+          {\n+             processNextEntry.execute();\n+             // Couldn't stat the file? Proceed anyway. If the file doesn't\n+             // exist, we'll let the downstream code be the one to show the\n+             // error.\n+             entry.action.execute(entry.file);\n+          }\n+        });\n    }\n-   \n-   private void showHelpAtCursor()\n+\n+   Widget createWidget(EditingTarget target)\n    {\n-      if (activeEditor_ != null && activeEditor_ instanceof TextEditingTarget)\n+      return target.asWidget();\n+   }\n+\n+   public void onInsertSource(final InsertSourceEvent event)\n+   {\n+\n+      if (!columnManager_.insertSource(event.getCode(), event.isBlock()))\n       {\n-         TextEditingTarget editor = (TextEditingTarget) activeEditor_;\n-         editor.showHelpAtCursor();\n+         columnManager_.newDoc(FileTypeRegistry.R,\n+                        new ResultCallback<EditingTarget, ServerError>()\n+         {\n+            public void onSuccess(EditingTarget arg)\n+            {\n+               ((TextEditingTarget)arg).insertCode(event.getCode(),\n+                                                   event.isBlock());\n+            }\n+         });\n       }\n    }\n \n", "next_change": {"commit": "11ddddd72af34d3c7884fabce1b8a544d9dc86ac", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex c7e5ea0a19..8f40b7dd15 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -2031,7 +2195,9 @@ public class Source implements InsertSourceHandler,\n    {\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         fileTypeRegistry_.editFile(event.getFile());\n+         FileSystemItem file = event.getFile();\n+         file.setFocusOnNavigate(true);\n+         fileTypeRegistry_.editFile(file);\n       }\n    }\n \n", "next_change": {"commit": "e52ffa8383f512966ced592117a0897809e3fdb1", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 8f40b7dd15..c0dddba48e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -2197,7 +2220,7 @@ public class Source implements InsertSourceHandler,\n       {\n          FileSystemItem file = event.getFile();\n          file.setFocusOnNavigate(true);\n-         fileTypeRegistry_.editFile(file);\n+         fileTypeRegistry_.editFile(file, event.getFilePosition());\n       }\n    }\n \n", "next_change": {"commit": "7c65340b272ea0a917f61c71d2d7b9995ef1bc12", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex c0dddba48e..665eb1ca1b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -2221,6 +2281,12 @@ public class Source implements InsertSourceEvent.Handler,\n          FileSystemItem file = event.getFile();\n          file.setFocusOnNavigate(true);\n          fileTypeRegistry_.editFile(file, event.getFilePosition());\n+\n+         String callback = event.getCallback();\n+         if (callback.length() > 0)\n+         {\n+            server_.invokeFileEditCallback(callback, event.getFile().getPath(), new VoidServerRequestCallback());\n+         }\n       }\n    }\n \n", "next_change": {"commit": "018d0b22a49247a446af15ad1853de2183c46358", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 665eb1ca1b..50831946fb 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -2281,12 +2281,6 @@ public class Source implements InsertSourceEvent.Handler,\n          FileSystemItem file = event.getFile();\n          file.setFocusOnNavigate(true);\n          fileTypeRegistry_.editFile(file, event.getFilePosition());\n-\n-         String callback = event.getCallback();\n-         if (callback.length() > 0)\n-         {\n-            server_.invokeFileEditCallback(callback, event.getFile().getPath(), new VoidServerRequestCallback());\n-         }\n       }\n    }\n \n", "next_change": null}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwOTcwMQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424609701", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:28:58Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatellitePresenter.java", "diffHunk": "@@ -29,7 +29,7 @@\n    {}", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYwOTk1OA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424609958", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:29:26Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatelliteWindow.java", "diffHunk": "@@ -49,6 +49,7 @@ public SourceSatelliteWindow(Provider<EventBus> pEventBus,\n                                 Provider<SourceWindow> pSourceWindow,", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8775dde14959f79c9ffb2450f6d93b1e5342e6a4", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatelliteWindow.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatelliteWindow.java\nindex 3ec6f3a39b..14d46a02fa 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatelliteWindow.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceSatelliteWindow.java\n", "chunk": "@@ -43,7 +43,7 @@ public class SourceSatelliteWindow extends SatelliteWindow\n \n    @Inject\n    public SourceSatelliteWindow(Provider<EventBus> pEventBus,\n-                                Provider<FontSizeManager> pFSManager, \n+                                Provider<FontSizeManager> pFSManager,\n                                 Provider<SourceSatellitePresenter> pPresenter,\n                                 Provider<SourceWindowManager> pWindowManager,\n                                 Provider<SourceWindow> pSourceWindow,\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMTE1NQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424611155", "body": "update file copyright year", "bodyText": "update file copyright year", "bodyHTML": "<p dir=\"auto\">update file copyright year</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:31:18Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindow.java", "diffHunk": "@@ -69,12 +69,12 @@ public SourceWindow(\n          Provider<DesktopHooks> pDesktopHooks,", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b84d2f0e3aa32762ce8fcd842391f62c6b9d2e51", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindow.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindow.java\nindex 3ddc98d910..07e737f732 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindow.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindow.java\n", "chunk": "@@ -60,7 +59,7 @@ import com.google.inject.Provider;\n import com.google.inject.Singleton;\n \n @Singleton\n-public class SourceWindow implements LastSourceDocClosedHandler,\n+public class SourceWindow implements LastSourceDocClosedEvent.Handler,\n                                      PopoutDocEvent.Handler,\n                                      DocTabDragStartedEvent.Handler\n {\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMTgyNA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424611824", "body": "update file header year", "bodyText": "update file header year", "bodyHTML": "<p dir=\"auto\">update file header year</p>", "author": "gtritchie", "createdAt": "2020-05-13T17:32:24Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java", "diffHunk": "@@ -102,7 +102,7 @@ public SourceWindowManager(\n          EventBus events,", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f2b7d29fbd43ce1a1b3833d3705131212b8ec686", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java\nindex ba00d53bf5..33385aec40 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java\n", "chunk": "@@ -102,7 +101,7 @@ public class SourceWindowManager implements PopoutDocEvent.Handler,\n          EventBus events,\n          FileTypeRegistry registry,\n          GlobalDisplay display, \n-         Source source,\n+         Provider<Source> source,\n          Session session,\n          UserPrefs uiPrefs)\n    {\n", "next_change": {"commit": "6d140858c404293e7a612c5b86e3ddcf39fb11df", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java\nindex 33385aec40..9c10bcc581 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceWindowManager.java\n", "chunk": "@@ -90,17 +90,18 @@ public class SourceWindowManager implements PopoutDocEvent.Handler,\n                                             CollabEditEndedEvent.Handler,\n                                             DocFocusedEvent.Handler,\n                                             EditorCommandDispatchEvent.Handler,\n-                                            RestartStatusEvent.Handler\n+                                            RestartStatusEvent.Handler,\n+                                            ScrollToPositionEvent.Handler\n {\n    @Inject\n    public SourceWindowManager(\n-         Provider<SatelliteManager> pSatelliteManager, \n+         Provider<SatelliteManager> pSatelliteManager,\n          Provider<Satellite> pSatellite,\n          Provider<WorkbenchContext> pWorkbenchContext,\n          SourceServerOperations server,\n          EventBus events,\n          FileTypeRegistry registry,\n-         GlobalDisplay display, \n+         GlobalDisplay display,\n          Provider<Source> source,\n          Session session,\n          UserPrefs uiPrefs)\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMjczMA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424612730", "body": "labmda: `() -> {}`", "bodyText": "labmda: () -> {}", "bodyHTML": "<p dir=\"auto\">labmda: <code>() -&gt; {}</code></p>", "author": "gtritchie", "createdAt": "2020-05-13T17:33:55Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "diffHunk": "@@ -5574,24 +5574,36 @@ public void execute()\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      },\n+      new Command() {\n+         public void execute()\n+         {\n+         }", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 1f60ac243a..a97f15a626 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5580,13 +5580,7 @@ public class TextEditingTarget implements\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      },\n-      new Command() {\n-         public void execute()\n-         {\n-         }\n-      },\n-      \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n", "next_change": {"commit": "5e484a920b7a562731dd16e843dbcec18b4d99c0", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex a97f15a626..66d5f1f412 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5574,24 +5606,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      source_.withSaveFilesBeforeCommand(() ->\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, () -> {}, \"Run Shiny Application\");\n+      }, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, () -> {}, \"Run Plumber API\");\n+      }, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "3aef1e0d9cd22371d1863be0bd6da1d6199651c8", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 66d5f1f412..cf9094d361 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5606,24 +5574,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "a8f84cb9aa09cbb77caea7501fb3516f44813b6e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex cf9094d361..f0aa58d3df 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5574,24 +5549,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      source_.withSaveFilesBeforeCommand(() ->\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, () -> {}, \"Run Shiny Application\");\n+      }, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, () -> {}, \"Run Plumber API\");\n+      }, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "d5d6cfcbf0e3b5859c552f6997a5bd0715f0071f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex f0aa58d3df..d04562ddd1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5549,24 +5637,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "24812bc412a1e5ad03eff704859f98c37512e863", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex d04562ddd1..0a7de314e7 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5637,24 +5549,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      source_.withSaveFilesBeforeCommand(() ->\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, () -> {}, \"Run Shiny Application\");\n+      }, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, () -> {}, \"Run Plumber API\");\n+      }, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "8ad93ac44043cf7eabb65c49a8e143f30a793cdf", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 0a7de314e7..1c2b1cb76a 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5549,24 +5639,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "cb3f6128fdebcf64586cf425d6a6eb53242e9a2f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 1c2b1cb76a..ceddaade7b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5658,7 +5679,7 @@ public class TextEditingTarget implements\n          }\n       }, () -> {}, \"Run Plumber API\");\n    }\n-   \n+\n    private void sourcePython()\n    {\n       saveThenExecute(null, () -> {\n", "next_change": {"commit": "831096a7a0277c9b2006b9dbf94551c5bf863379", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex ceddaade7b..e202931b4c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5657,29 +5546,29 @@ public class TextEditingTarget implements\n          prefs_.writeUserPrefs();\n       }\n    }\n-\n+   \n    private void runShinyApp()\n    {\n-      source_.withSaveFilesBeforeCommand(() ->\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, () -> {}, \"Run Shiny Application\");\n+      }, \"Run Shiny Application\");\n    }\n-\n+   \n    private void runPlumberAPI()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, () -> {}, \"Run Plumber API\");\n+      }, \"Run Plumber API\");\n    }\n-\n+   \n    private void sourcePython()\n    {\n       saveThenExecute(null, () -> {\n", "next_change": {"commit": "d6cea202c0db3c0cf6510e64822ab7262bd6e165", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex e202931b4c..41069aceaf 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5546,29 +5714,29 @@ public class TextEditingTarget implements\n          prefs_.writeUserPrefs();\n       }\n    }\n-   \n+\n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n-   \n+\n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n-   \n+\n    private void sourcePython()\n    {\n       saveThenExecute(null, () -> {\n", "next_change": {"commit": "ececfe5b911202dda97384babc1205e46ca9ab7f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 41069aceaf..49e9a51256 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5739,7 +6157,7 @@ public class TextEditingTarget implements\n \n    private void sourcePython()\n    {\n-      saveThenExecute(null, () -> {\n+      saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n                \"Executing Python\",\n                \"Sourcing Python scripts\",\n", "next_change": {"commit": "9ff0544e1387a1e175a82f6c2dc928868c35bc77", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 49e9a51256..518c9d1079 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6157,7 +6138,7 @@ public class TextEditingTarget implements\n \n    private void sourcePython()\n    {\n-      saveThenExecute(null, true, () -> {\n+      saveThenExecute(null, () -> {\n          dependencyManager_.withReticulate(\n                \"Executing Python\",\n                \"Sourcing Python scripts\",\n", "next_change": {"commit": "7dc3138210711fc78ee925ccc59c9fe4a6c49af5", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 518c9d1079..6c64d688db 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6138,7 +6190,7 @@ public class TextEditingTarget implements\n \n    private void sourcePython()\n    {\n-      saveThenExecute(null, () -> {\n+      saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n                \"Executing Python\",\n                \"Sourcing Python scripts\",\n", "next_change": {"commit": "1cc3433fbde287105d3de5a9821e53b7b243c131", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 6c64d688db..c1dc5ff68e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6192,8 +6536,8 @@ public class TextEditingTarget implements\n    {\n       saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n-               \"Executing Python\",\n-               \"Sourcing Python scripts\",\n+               constants_.sourcePythonProgressCaption(),\n+               constants_.sourcePythonUserPrompt(),\n                () -> {\n                   String command = \"reticulate::source_python('\" + getPath() + \"')\";\n                   events_.fireEvent(new SendToConsoleEvent(command, true));\n", "next_change": {"commit": "f0e6f6aa35d1edad14b93225ecc488f195c0c13a", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex c1dc5ff68e..0c18fbb98e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6536,8 +6569,8 @@ public class TextEditingTarget implements\n    {\n       saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n-               constants_.sourcePythonProgressCaption(),\n-               constants_.sourcePythonUserPrompt(),\n+               \"Executing Python\",\n+               \"Sourcing Python scripts\",\n                () -> {\n                   String command = \"reticulate::source_python('\" + getPath() + \"')\";\n                   events_.fireEvent(new SendToConsoleEvent(command, true));\n", "next_change": {"commit": "ce0caa280d30ce48e44b479ab619ad25ca9446d7", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 0c18fbb98e..3535c0d30d 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6569,8 +6536,8 @@ public class TextEditingTarget implements\n    {\n       saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n-               \"Executing Python\",\n-               \"Sourcing Python scripts\",\n+               constants_.sourcePythonProgressCaption(),\n+               constants_.sourcePythonUserPrompt(),\n                () -> {\n                   String command = \"reticulate::source_python('\" + getPath() + \"')\";\n                   events_.fireEvent(new SendToConsoleEvent(command, true));\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMjg5Mg==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424612892", "body": "lambda: `() -> {}`", "bodyText": "lambda: () -> {}", "bodyHTML": "<p dir=\"auto\">lambda: <code>() -&gt; {}</code></p>", "author": "gtritchie", "createdAt": "2020-05-13T17:34:11Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java", "diffHunk": "@@ -5574,24 +5574,36 @@ public void execute()\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      },\n+      new Command() {\n+         public void execute()\n+         {\n+         }\n+      },\n+      \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      },\n+      new Command() {\n+         public void execute()\n+         {\n+         }", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 1f60ac243a..a97f15a626 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5597,13 +5591,7 @@ public class TextEditingTarget implements\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      },\n-      new Command() {\n-         public void execute()\n-         {\n-         }\n-      },\n-      \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "5e484a920b7a562731dd16e843dbcec18b4d99c0", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex a97f15a626..66d5f1f412 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5574,24 +5606,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      source_.withSaveFilesBeforeCommand(() ->\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, () -> {}, \"Run Shiny Application\");\n+      }, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, () -> {}, \"Run Plumber API\");\n+      }, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "3aef1e0d9cd22371d1863be0bd6da1d6199651c8", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 66d5f1f412..cf9094d361 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5606,24 +5574,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "a8f84cb9aa09cbb77caea7501fb3516f44813b6e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex cf9094d361..f0aa58d3df 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5574,24 +5549,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      source_.withSaveFilesBeforeCommand(() ->\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, () -> {}, \"Run Shiny Application\");\n+      }, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, () -> {}, \"Run Plumber API\");\n+      }, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "d5d6cfcbf0e3b5859c552f6997a5bd0715f0071f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex f0aa58d3df..d04562ddd1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5549,24 +5637,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "24812bc412a1e5ad03eff704859f98c37512e863", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex d04562ddd1..0a7de314e7 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5637,24 +5549,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      source_.withSaveFilesBeforeCommand(() ->\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, () -> {}, \"Run Shiny Application\");\n+      }, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, () -> {}, \"Run Plumber API\");\n+      }, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "8ad93ac44043cf7eabb65c49a8e143f30a793cdf", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 0a7de314e7..1c2b1cb76a 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5549,24 +5639,24 @@ public class TextEditingTarget implements\n    \n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n    \n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n    \n    private void sourcePython()\n", "next_change": {"commit": "cb3f6128fdebcf64586cf425d6a6eb53242e9a2f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 1c2b1cb76a..ceddaade7b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5658,7 +5679,7 @@ public class TextEditingTarget implements\n          }\n       }, () -> {}, \"Run Plumber API\");\n    }\n-   \n+\n    private void sourcePython()\n    {\n       saveThenExecute(null, () -> {\n", "next_change": {"commit": "831096a7a0277c9b2006b9dbf94551c5bf863379", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex ceddaade7b..e202931b4c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5657,29 +5546,29 @@ public class TextEditingTarget implements\n          prefs_.writeUserPrefs();\n       }\n    }\n-\n+   \n    private void runShinyApp()\n    {\n-      source_.withSaveFilesBeforeCommand(() ->\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, () -> {}, \"Run Shiny Application\");\n+      }, \"Run Shiny Application\");\n    }\n-\n+   \n    private void runPlumberAPI()\n    {\n-      source_.withSaveFilesBeforeCommand(new Command() {\n+      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, () -> {}, \"Run Plumber API\");\n+      }, \"Run Plumber API\");\n    }\n-\n+   \n    private void sourcePython()\n    {\n       saveThenExecute(null, () -> {\n", "next_change": {"commit": "d6cea202c0db3c0cf6510e64822ab7262bd6e165", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex e202931b4c..41069aceaf 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5546,29 +5714,29 @@ public class TextEditingTarget implements\n          prefs_.writeUserPrefs();\n       }\n    }\n-   \n+\n    private void runShinyApp()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(() ->\n+      source_.withSaveFilesBeforeCommand(() ->\n       {\n          events_.fireEvent(new LaunchShinyApplicationEvent(getPath(),\n                prefs_.shinyBackgroundJobs().getValue() ?\n                   ShinyApplication.BACKGROUND_APP :\n                   ShinyApplication.FOREGROUND_APP, getExtendedFileType()));\n-      }, \"Run Shiny Application\");\n+      }, () -> {}, \"Run Shiny Application\");\n    }\n-   \n+\n    private void runPlumberAPI()\n    {\n-      sourceBuildHelper_.withSaveFilesBeforeCommand(new Command() {\n+      source_.withSaveFilesBeforeCommand(new Command() {\n          @Override\n          public void execute()\n          {\n             events_.fireEvent(new LaunchPlumberAPIEvent(getPath()));\n          }\n-      }, \"Run Plumber API\");\n+      }, () -> {}, \"Run Plumber API\");\n    }\n-   \n+\n    private void sourcePython()\n    {\n       saveThenExecute(null, () -> {\n", "next_change": {"commit": "ececfe5b911202dda97384babc1205e46ca9ab7f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 41069aceaf..49e9a51256 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -5739,7 +6157,7 @@ public class TextEditingTarget implements\n \n    private void sourcePython()\n    {\n-      saveThenExecute(null, () -> {\n+      saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n                \"Executing Python\",\n                \"Sourcing Python scripts\",\n", "next_change": {"commit": "9ff0544e1387a1e175a82f6c2dc928868c35bc77", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 49e9a51256..518c9d1079 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6157,7 +6138,7 @@ public class TextEditingTarget implements\n \n    private void sourcePython()\n    {\n-      saveThenExecute(null, true, () -> {\n+      saveThenExecute(null, () -> {\n          dependencyManager_.withReticulate(\n                \"Executing Python\",\n                \"Sourcing Python scripts\",\n", "next_change": {"commit": "7dc3138210711fc78ee925ccc59c9fe4a6c49af5", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 518c9d1079..6c64d688db 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6138,7 +6190,7 @@ public class TextEditingTarget implements\n \n    private void sourcePython()\n    {\n-      saveThenExecute(null, () -> {\n+      saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n                \"Executing Python\",\n                \"Sourcing Python scripts\",\n", "next_change": {"commit": "1cc3433fbde287105d3de5a9821e53b7b243c131", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 6c64d688db..c1dc5ff68e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6192,8 +6536,8 @@ public class TextEditingTarget implements\n    {\n       saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n-               \"Executing Python\",\n-               \"Sourcing Python scripts\",\n+               constants_.sourcePythonProgressCaption(),\n+               constants_.sourcePythonUserPrompt(),\n                () -> {\n                   String command = \"reticulate::source_python('\" + getPath() + \"')\";\n                   events_.fireEvent(new SendToConsoleEvent(command, true));\n", "next_change": {"commit": "f0e6f6aa35d1edad14b93225ecc488f195c0c13a", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex c1dc5ff68e..0c18fbb98e 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6536,8 +6569,8 @@ public class TextEditingTarget implements\n    {\n       saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n-               constants_.sourcePythonProgressCaption(),\n-               constants_.sourcePythonUserPrompt(),\n+               \"Executing Python\",\n+               \"Sourcing Python scripts\",\n                () -> {\n                   String command = \"reticulate::source_python('\" + getPath() + \"')\";\n                   events_.fireEvent(new SendToConsoleEvent(command, true));\n", "next_change": {"commit": "ce0caa280d30ce48e44b479ab619ad25ca9446d7", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\nindex 0c18fbb98e..3535c0d30d 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/TextEditingTarget.java\n", "chunk": "@@ -6569,8 +6536,8 @@ public class TextEditingTarget implements\n    {\n       saveThenExecute(null, true, () -> {\n          dependencyManager_.withReticulate(\n-               \"Executing Python\",\n-               \"Sourcing Python scripts\",\n+               constants_.sourcePythonProgressCaption(),\n+               constants_.sourcePythonUserPrompt(),\n                () -> {\n                   String command = \"reticulate::source_python('\" + getPath() + \"')\";\n                   events_.fireEvent(new SendToConsoleEvent(command, true));\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzODI2Ng==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424638266", "body": "This might not be safe -- if I understand correctly, this call will load Ace concurrently, but it seems like since we're about to initialize tabs (which might require Ace to be available) we would want to ensure Ace has really been loaded.\r\n\r\n", "bodyText": "This might not be safe -- if I understand correctly, this call will load Ace concurrently, but it seems like since we're about to initialize tabs (which might require Ace to be available) we would want to ensure Ace has really been loaded.", "bodyHTML": "<p dir=\"auto\">This might not be safe -- if I understand correctly, this call will load Ace concurrently, but it seems like since we're about to initialize tabs (which might require Ace to be available) we would want to ensure Ace has really been loaded.</p>", "author": "kevinushey", "createdAt": "2020-05-13T18:16:37Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -586,17 +598,57 @@ public void onNewWorkingCopy(NewWorkingCopyEvent event)\n          }\n       });\n       \n-      events.addHandler(PopoutDocEvent.TYPE, this);\n-      events.addHandler(DocWindowChangedEvent.TYPE, this);\n-      events.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n-      events.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n-      events.addHandler(DebugModeChangedEvent.TYPE, this);\n-      events.addHandler(ReplaceRangesEvent.TYPE, this);\n-      events.addHandler(GetEditorContextEvent.TYPE, this);\n-      events.addHandler(SetSelectionRangesEvent.TYPE, this);\n-      events.addHandler(OpenProfileEvent.TYPE, this);\n-      events.addHandler(RequestDocumentSaveEvent.TYPE, this);\n-      events.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      events_.addHandler(PopoutDocEvent.TYPE, this);\n+      events_.addHandler(DocWindowChangedEvent.TYPE, this);\n+      events_.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n+      events_.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n+      events_.addHandler(DebugModeChangedEvent.TYPE, this);\n+      events_.addHandler(ReplaceRangesEvent.TYPE, this);\n+      events_.addHandler(GetEditorContextEvent.TYPE, this);\n+      events_.addHandler(SetSelectionRangesEvent.TYPE, this);\n+      events_.addHandler(OpenProfileEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentSaveEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      \n+      initialized_ = true;\n+   }\n+\n+   public void loadFullSource()\n+   {\n+      AceEditor.preload();", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc4MTMxNQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424781315", "bodyText": "Good catch. I updated the code with a new method that loads Ace and calls loadFullSource (now private) in its callback.", "author": "melissa-barca", "createdAt": "2020-05-13T23:08:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzODI2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "9217906b990746c6709b77851db7996797c9dd8f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..56a50b35f3 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -609,14 +599,19 @@ public class Source implements InsertSourceHandler,\n       events_.addHandler(OpenProfileEvent.TYPE, this);\n       events_.addHandler(RequestDocumentSaveEvent.TYPE, this);\n       events_.addHandler(RequestDocumentCloseEvent.TYPE, this);\n-      \n+\n       initialized_ = true;\n    }\n \n-   public void loadFullSource()\n+   public void load()\n    {\n-      AceEditor.preload();\n+      AceEditor.load(() -> {\n+         loadFullSource();\n+      });\n+   }\n \n+   private void loadFullSource()\n+   {\n       // sync UI prefs with shortcut manager\n       userPrefs_ = RStudioGinjector.INSTANCE.getUserPrefs();\n \n", "next_change": {"commit": "a5240b647de8e743f55a04aad93cac2b0d674c49", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 56a50b35f3..d21339a108 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -610,6 +734,11 @@ public class Source implements InsertSourceHandler,\n       });\n    }\n \n+   public void loadDisplay()\n+   {\n+      restoreDocuments(session_);\n+   }\n+\n    private void loadFullSource()\n    {\n       // sync UI prefs with shortcut manager\n", "next_change": {"commit": "e629c4aca34f28163d155271e65fcb829f127599", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex d21339a108..dcc3da84bb 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -737,6 +737,22 @@ public class Source implements InsertSourceHandler,\n    public void loadDisplay()\n    {\n       restoreDocuments(session_);\n+\n+      // As tabs were added before, manageCommands() was suppressed due to\n+      // initialized_ being false, so we need to run it explicitly\n+      manageCommands();\n+      // Same with this event\n+      fireDocTabsChanged();\n+      \n+      // open project or edit_published docs (only for main source window)\n+      if (SourceWindowManager.isMainSourceWindow())\n+      {\n+         openProjectDocs(session_);\n+         openEditPublishedDocs();\n+      }\n+      \n+      // add vim commands\n+      initVimCommands();\n    }\n \n    private void loadFullSource()\n", "next_change": {"commit": "3fdda38e9a78a984a25c44e1672cf0869fad19cd", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex dcc3da84bb..3daad397d3 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -734,27 +614,6 @@ public class Source implements InsertSourceHandler,\n       });\n    }\n \n-   public void loadDisplay()\n-   {\n-      restoreDocuments(session_);\n-\n-      // As tabs were added before, manageCommands() was suppressed due to\n-      // initialized_ being false, so we need to run it explicitly\n-      manageCommands();\n-      // Same with this event\n-      fireDocTabsChanged();\n-      \n-      // open project or edit_published docs (only for main source window)\n-      if (SourceWindowManager.isMainSourceWindow())\n-      {\n-         openProjectDocs(session_);\n-         openEditPublishedDocs();\n-      }\n-      \n-      // add vim commands\n-      initVimCommands();\n-   }\n-\n    private void loadFullSource()\n    {\n       // sync UI prefs with shortcut manager\n", "next_change": {"commit": "fcc85338d4567365a7461736d7350b9639fc8e00", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 3daad397d3..0141ba6497 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -614,6 +748,32 @@ public class Source implements InsertSourceHandler,\n       });\n    }\n \n+   public void loadDisplay()\n+   {\n+      restoreDocuments(session_);\n+      for (Display v : views_)\n+      {\n+         v.addBeforeShowHandler(this);\n+      }\n+\n+\n+      // As tabs were added before, manageCommands() was suppressed due to\n+      // initialized_ being false, so we need to run it explicitly\n+      manageCommands();\n+      // Same with this event\n+      fireDocTabsChanged();\n+      \n+      // open project or edit_published docs (only for main source window)\n+      if (SourceWindowManager.isMainSourceWindow())\n+      {\n+         openProjectDocs(session_);\n+         openEditPublishedDocs();\n+      }\n+      \n+      // add vim commands\n+      initVimCommands();\n+   }\n+\n    private void loadFullSource()\n    {\n       // sync UI prefs with shortcut manager\n", "next_change": {"commit": "d5d6cfcbf0e3b5859c552f6997a5bd0715f0071f", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 0141ba6497..901d7e14e1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -751,25 +430,21 @@ public class Source implements InsertSourceHandler,\n    public void loadDisplay()\n    {\n       restoreDocuments(session_);\n-      for (Display v : views_)\n-      {\n-         v.addBeforeShowHandler(this);\n-      }\n-\n+      columnManager_.beforeShow();\n \n       // As tabs were added before, manageCommands() was suppressed due to\n       // initialized_ being false, so we need to run it explicitly\n-      manageCommands();\n+      columnManager_.manageCommands(false);\n       // Same with this event\n-      fireDocTabsChanged();\n-      \n+      columnManager_.fireDocTabsChanged();\n+\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n          openProjectDocs(session_);\n          openEditPublishedDocs();\n       }\n-      \n+\n       // add vim commands\n       initVimCommands();\n    }\n", "next_change": {"commit": "29ab246060f23296d28e8e105be209c40205d867", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 901d7e14e1..242487f201 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -441,7 +431,7 @@ public class Source implements InsertSourceHandler,\n       // open project or edit_published docs (only for main source window)\n       if (SourceWindowManager.isMainSourceWindow())\n       {\n-         openProjectDocs(session_);\n+         columnManager_.openProjectDocs(session_, true);\n          openEditPublishedDocs();\n       }\n \n", "next_change": {"commit": "0f1748d525c17dbb9b4021d3cb65b3784e7e0c68", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 242487f201..c7e5ea0a19 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -436,7 +427,7 @@ public class Source implements InsertSourceHandler,\n       }\n \n       // add vim commands\n-      initVimCommands();\n+      columnManager_.initVimCommands();\n    }\n \n    private void loadFullSource()\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzOTE5NQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424639195", "body": "nit: method name should be camelCase?", "bodyText": "nit: method name should be camelCase?", "bodyHTML": "<p dir=\"auto\">nit: method name should be camelCase?</p>", "author": "kevinushey", "createdAt": "2020-05-13T18:18:05Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java", "diffHunk": "@@ -100,6 +100,7 @@ public void writeUserPrefs()\n \n    public void writeUserPrefs(CommandWithArg<Boolean> onCompleted)\n    {\n+      UpdatePrefs(session_.getSessionInfo().getPrefs());", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MTA1OQ==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424641059", "bodyText": "(realize this is a pre-existing method but maybe worth changing while you're working with this code)", "author": "kevinushey", "createdAt": "2020-05-13T18:21:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzOTE5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1Mzk5Mg==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424653992", "bodyText": "Done.", "author": "melissa-barca", "createdAt": "2020-05-13T18:42:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzOTE5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java\nindex c02a6220ce..4242b8886b 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java\n", "chunk": "@@ -100,7 +100,7 @@ public class UserPrefs extends UserPrefsComputed\n \n    public void writeUserPrefs(CommandWithArg<Boolean> onCompleted)\n    {\n-      UpdatePrefs(session_.getSessionInfo().getPrefs());\n+      updatePrefs(session_.getSessionInfo().getPrefs());\n       server_.setUserPrefs(\n          session_.getSessionInfo().getUserPrefs(),\n          new ServerRequestCallback<Void>() \n", "next_change": {"commit": "beb9af52195516721189d70fd8150d7b4494ad03", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java\nindex 4242b8886b..1dce50eb92 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/prefs/model/UserPrefs.java\n", "chunk": "@@ -103,7 +102,7 @@ public class UserPrefs extends UserPrefsComputed\n       updatePrefs(session_.getSessionInfo().getPrefs());\n       server_.setUserPrefs(\n          session_.getSessionInfo().getUserPrefs(),\n-         new ServerRequestCallback<Void>() \n+         new ServerRequestCallback<Void>()\n          {\n             @Override\n             public void onResponseReceived(Void v)\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MjM1NA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424642354", "body": "Can we document the intent here? (why do we need to fire this \"empty\" DocTabsChangedEvent?)", "bodyText": "Can we document the intent here? (why do we need to fire this \"empty\" DocTabsChangedEvent?)", "bodyHTML": "<p dir=\"auto\">Can we document the intent here? (why do we need to fire this \"empty\" DocTabsChangedEvent?)</p>", "author": "kevinushey", "createdAt": "2020-05-13T18:23:22Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java", "diffHunk": "@@ -586,17 +598,57 @@ public void onNewWorkingCopy(NewWorkingCopyEvent event)\n          }\n       });\n       \n-      events.addHandler(PopoutDocEvent.TYPE, this);\n-      events.addHandler(DocWindowChangedEvent.TYPE, this);\n-      events.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n-      events.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n-      events.addHandler(DebugModeChangedEvent.TYPE, this);\n-      events.addHandler(ReplaceRangesEvent.TYPE, this);\n-      events.addHandler(GetEditorContextEvent.TYPE, this);\n-      events.addHandler(SetSelectionRangesEvent.TYPE, this);\n-      events.addHandler(OpenProfileEvent.TYPE, this);\n-      events.addHandler(RequestDocumentSaveEvent.TYPE, this);\n-      events.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      events_.addHandler(PopoutDocEvent.TYPE, this);\n+      events_.addHandler(DocWindowChangedEvent.TYPE, this);\n+      events_.addHandler(DocTabDragInitiatedEvent.TYPE, this);\n+      events_.addHandler(PopoutDocInitiatedEvent.TYPE, this);\n+      events_.addHandler(DebugModeChangedEvent.TYPE, this);\n+      events_.addHandler(ReplaceRangesEvent.TYPE, this);\n+      events_.addHandler(GetEditorContextEvent.TYPE, this);\n+      events_.addHandler(SetSelectionRangesEvent.TYPE, this);\n+      events_.addHandler(OpenProfileEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentSaveEvent.TYPE, this);\n+      events_.addHandler(RequestDocumentCloseEvent.TYPE, this);\n+      \n+      initialized_ = true;\n+   }\n+\n+   public void loadFullSource()\n+   {\n+      AceEditor.preload();\n+\n+      // sync UI prefs with shortcut manager\n+      userPrefs_ = RStudioGinjector.INSTANCE.getUserPrefs();\n+\n+      if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_VIM)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_VIM);\n+      else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_EMACS)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_EMACS);\n+      else if (userPrefs_.editorKeybindings().getValue() == UserPrefs.EDITOR_KEYBINDINGS_SUBLIME)\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_SUBLIME);\n+      else\n+         ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n+   \n+      events_.fireEvent(new DocTabsChangedEvent(null,", "originalCommit": "6b0f1284217369ad95fe502f4c976aac4cbf4feb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczMDAzOA==", "url": "https://github.com/rstudio/rstudio/pull/6849#discussion_r424730038", "bodyText": "IIRC this code is needed for future work when we have multiple source columns. I've removed it from this branch and added a comment to the other to document it.", "author": "melissa-barca", "createdAt": "2020-05-13T21:04:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY0MjM1NA=="}], "type": "inlineReview", "revised_code": {"commit": "d05ce26ff1323507099b91cb0cdffdaf215a5ee6", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 6446365fc0..29e1b6b88c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -629,12 +628,6 @@ public class Source implements InsertSourceHandler,\n       else\n          ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n    \n-      events_.fireEvent(new DocTabsChangedEvent(null,\n-                                                new String[0],\n-                                                new FileIcon[0],\n-                                                new String[0],\n-                                                new String[0]));\n-\n       // fake shortcuts for commands_ which we handle at a lower level\n       commands_.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n       commands_.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n", "next_change": {"commit": "b8ac76404ea2a11ebc20e2561135ebdf197d6a54", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 29e1b6b88c..7149b489b7 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -628,6 +733,13 @@ public class Source implements InsertSourceHandler,\n       else\n          ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n    \n+      // !!! comment why this is needed\n+      events_.fireEvent(new DocTabsChangedEvent(null,\n+                                                new String[0],\n+                                                new FileIcon[0],\n+                                                new String[0],\n+                                                new String[0]));\n+\n       // fake shortcuts for commands_ which we handle at a lower level\n       commands_.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n       commands_.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n", "next_change": {"commit": "f80341e1290ec0ed7126347d255c59d685a460ab", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 7149b489b7..c2171003a1 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -733,13 +628,6 @@ public class Source implements InsertSourceHandler,\n       else\n          ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n    \n-      // !!! comment why this is needed\n-      events_.fireEvent(new DocTabsChangedEvent(null,\n-                                                new String[0],\n-                                                new FileIcon[0],\n-                                                new String[0],\n-                                                new String[0]));\n-\n       // fake shortcuts for commands_ which we handle at a lower level\n       commands_.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n       commands_.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n", "next_change": {"commit": "7e13afd3d15d3b84985f7deb0df7b80091f62c7e", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex c2171003a1..4719ec35fc 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -628,6 +748,13 @@ public class Source implements InsertSourceHandler,\n       else\n          ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n    \n+      // !!! comment why this is needed\n+      events_.fireEvent(new DocTabsChangedEvent(null,\n+                                                new String[0],\n+                                                new FileIcon[0],\n+                                                new String[0],\n+                                                new String[0]));\n+\n       // fake shortcuts for commands_ which we handle at a lower level\n       commands_.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n       commands_.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n", "next_change": {"commit": "3fdda38e9a78a984a25c44e1672cf0869fad19cd", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 4719ec35fc..3daad397d3 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -748,13 +628,6 @@ public class Source implements InsertSourceHandler,\n       else\n          ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n    \n-      // !!! comment why this is needed\n-      events_.fireEvent(new DocTabsChangedEvent(null,\n-                                                new String[0],\n-                                                new FileIcon[0],\n-                                                new String[0],\n-                                                new String[0]));\n-\n       // fake shortcuts for commands_ which we handle at a lower level\n       commands_.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n       commands_.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n", "next_change": {"commit": "fcc85338d4567365a7461736d7350b9639fc8e00", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 3daad397d3..0141ba6497 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -627,7 +787,16 @@ public class Source implements InsertSourceHandler,\n          ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_SUBLIME);\n       else\n          ShortcutManager.INSTANCE.setEditorMode(KeyboardShortcut.MODE_DEFAULT);\n-   \n+\n+      initialized_ = true;\n+\n+      // !!! comment why this is needed\n+      events_.fireEvent(new DocTabsChangedEvent(null,\n+                                                new String[0],\n+                                                new FileIcon[0],\n+                                                new String[0],\n+                                                new String[0]));\n+\n       // fake shortcuts for commands_ which we handle at a lower level\n       commands_.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n       commands_.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n", "next_change": {"commit": "55b1fabe5fd8169f4c361c796a36b6074506ce59", "changed_code": [{"header": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\nindex 0141ba6497..580427cec8 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/Source.java\n", "chunk": "@@ -790,13 +498,6 @@ public class Source implements InsertSourceHandler,\n \n       initialized_ = true;\n \n-      // !!! comment why this is needed\n-      events_.fireEvent(new DocTabsChangedEvent(null,\n-                                                new String[0],\n-                                                new FileIcon[0],\n-                                                new String[0],\n-                                                new String[0]));\n-\n       // fake shortcuts for commands_ which we handle at a lower level\n       commands_.goToHelp().setShortcut(new KeyboardShortcut(\"F1\", KeyCodes.KEY_F1, KeyboardShortcut.NONE));\n       commands_.goToDefinition().setShortcut(new KeyboardShortcut(\"F2\", KeyCodes.KEY_F2, KeyboardShortcut.NONE));\n", "next_change": null}]}}]}}]}}]}}]}}]}}]}}, {"oid": "90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "url": "https://github.com/rstudio/rstudio/commit/90c550ae2297497ebaa6a6cc5357f5e41c46c1a2", "message": "update copyright years, use lambdas when possible, remove white space", "committedDate": "2020-05-13T19:22:17Z", "type": "commit"}, {"oid": "2050408f950459d3e5c3f72ed9385da57a0e8b79", "url": "https://github.com/rstudio/rstudio/commit/2050408f950459d3e5c3f72ed9385da57a0e8b79", "message": "add javadoc, remove unneeded code", "committedDate": "2020-05-13T19:38:14Z", "type": "commit"}, {"oid": "d05ce26ff1323507099b91cb0cdffdaf215a5ee6", "url": "https://github.com/rstudio/rstudio/commit/d05ce26ff1323507099b91cb0cdffdaf215a5ee6", "message": "remove empty event", "committedDate": "2020-05-13T21:04:16Z", "type": "commit"}, {"oid": "b51a5a1abe6b8eaa54470b881a1cfff19f3ca658", "url": "https://github.com/rstudio/rstudio/commit/b51a5a1abe6b8eaa54470b881a1cfff19f3ca658", "message": "remove sourceshim code", "committedDate": "2020-05-13T21:22:05Z", "type": "commit"}, {"oid": "9217906b990746c6709b77851db7996797c9dd8f", "url": "https://github.com/rstudio/rstudio/commit/9217906b990746c6709b77851db7996797c9dd8f", "message": "ensure ace is loaded before initializing any tabs", "committedDate": "2020-05-13T22:43:18Z", "type": "commit"}]}