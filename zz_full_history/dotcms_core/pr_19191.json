{"pr_number": 19191, "pr_title": "#19189 : A list with an empty String representing an empty value in t\u2026", "pr_author": "jcastro-dotcms", "pr_createdAt": "2020-08-28T18:05:12Z", "pr_url": "https://github.com/dotCMS/core/pull/19191", "timeline": [{"oid": "444dfb7f70f681a0b4dc7d2840d6d433920d02a5", "url": "https://github.com/dotCMS/core/commit/444dfb7f70f681a0b4dc7d2840d6d433920d02a5", "message": "#19189 : A list with an empty String representing an empty value in the Tag field is being sent from the Edit Mode in Angular. This is causing problems in our current Java code, as passing down an empty String to the `CategoryAPI.find` method returns a null value, which causes a Null Pointer Exception during the checkin process.", "committedDate": "2020-08-28T18:04:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ1OTg0OA==", "url": "https://github.com/dotCMS/core/pull/19191#discussion_r479459848", "body": "Should the condition be:\r\n\r\n```\r\nif (UtilMethods.isSet(categoriesList) && categoriesList.size() > 0){\r\n```", "bodyText": "Should the condition be:\nif (UtilMethods.isSet(categoriesList) && categoriesList.size() > 0){", "bodyHTML": "<p dir=\"auto\">Should the condition be:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"if (UtilMethods.isSet(categoriesList) &amp;&amp; categoriesList.size() &gt; 0){\"><pre><code>if (UtilMethods.isSet(categoriesList) &amp;&amp; categoriesList.size() &gt; 0){\n</code></pre></div>", "author": "wezell", "createdAt": "2020-08-28T18:07:47Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java", "diffHunk": "@@ -423,11 +423,12 @@ private void saveWebAsset(Map<String, Object> contentletFormData,\n \t\t\t}\r\n \t\t }\r\n \r\n-\t\tif (categoriesList != null && categoriesList.size() > 0) {\r\n-\t\t\tfor (final Iterator iterator = categoriesList.iterator(); iterator.hasNext();) {\r\n-\r\n-\t\t\t\tfinal String tmpString = (String) iterator.next();\r\n-\t\t\t\tcategories.add(catAPI.find(tmpString, user, false));\r\n+\t\tif (UtilMethods.isSet(categoriesList)) {\r", "originalCommit": "444dfb7f70f681a0b4dc7d2840d6d433920d02a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2MzE2NA==", "url": "https://github.com/dotCMS/core/pull/19191#discussion_r479463164", "bodyText": "@wezell the isSet method already checks for both null and empty list scenarios:\npublic static final boolean isSet(final Collection<?> collection) {\n    return null != collection && !collection.isEmpty();\n}", "author": "jcastro-dotcms", "createdAt": "2020-08-28T18:14:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ1OTg0OA=="}], "type": "inlineReview", "revised_code": {"commit": "f4af01244b1a6b358190e153d958aa278524fe84", "changed_code": [{"header": "diff --git a/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java b/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\nindex e3d09392ec..15ff081edf 100644\n--- a/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\n+++ b/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\n", "chunk": "@@ -423,12 +425,11 @@ public class ContentletWebAPIImpl implements ContentletWebAPI {\n \t\t\t}\n \t\t }\n \n-\t\tif (UtilMethods.isSet(categoriesList)) {\n-\t\t\tfor (final Iterator<String> iterator = categoriesList.iterator(); iterator.hasNext();) {\n-\t\t\t\tfinal String categoryId = iterator.next();\n-\t\t\t\tif (UtilMethods.isSet(categoryId)) {\n-\t\t\t\t\tcategories.add(catAPI.find(categoryId, user, PageMode.get().respectAnonPerms));\n-\t\t\t\t}\n+\t\tif (categoriesList != null && categoriesList.size() > 0) {\n+\t\t\tfor (final Iterator iterator = categoriesList.iterator(); iterator.hasNext();) {\n+\n+\t\t\t\tfinal String tmpString = (String) iterator.next();\n+\t\t\t\tcategories.add(catAPI.find(tmpString, user, false));\n \t\t\t}\n \t\t}\n \n", "next_change": {"commit": "e383862f69fde011161c816cb73474b22b325287", "changed_code": [{"header": "diff --git a/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java b/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\nindex 15ff081edf..e3d09392ec 100644\n--- a/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\n+++ b/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\n", "chunk": "@@ -425,11 +423,12 @@ public class ContentletWebAPIImpl implements ContentletWebAPI {\n \t\t\t}\n \t\t }\n \n-\t\tif (categoriesList != null && categoriesList.size() > 0) {\n-\t\t\tfor (final Iterator iterator = categoriesList.iterator(); iterator.hasNext();) {\n-\n-\t\t\t\tfinal String tmpString = (String) iterator.next();\n-\t\t\t\tcategories.add(catAPI.find(tmpString, user, false));\n+\t\tif (UtilMethods.isSet(categoriesList)) {\n+\t\t\tfor (final Iterator<String> iterator = categoriesList.iterator(); iterator.hasNext();) {\n+\t\t\t\tfinal String categoryId = iterator.next();\n+\t\t\t\tif (UtilMethods.isSet(categoryId)) {\n+\t\t\t\t\tcategories.add(catAPI.find(categoryId, user, PageMode.get().respectAnonPerms));\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2NTcyMQ==", "url": "https://github.com/dotCMS/core/pull/19191#discussion_r479465721", "body": "I would replace the iterator with a normal `for` over `categoriesList` \r\n```for (final String categoryId : categoriesList)```", "bodyText": "I would replace the iterator with a normal for over categoriesList\nfor (final String categoryId : categoriesList)", "bodyHTML": "<p dir=\"auto\">I would replace the iterator with a normal <code>for</code> over <code>categoriesList</code><br>\n<code>for (final String categoryId : categoriesList)</code></p>", "author": "dsilvam", "createdAt": "2020-08-28T18:20:31Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java", "diffHunk": "@@ -423,11 +423,12 @@ private void saveWebAsset(Map<String, Object> contentletFormData,\n \t\t\t}\r\n \t\t }\r\n \r\n-\t\tif (categoriesList != null && categoriesList.size() > 0) {\r\n-\t\t\tfor (final Iterator iterator = categoriesList.iterator(); iterator.hasNext();) {\r\n-\r\n-\t\t\t\tfinal String tmpString = (String) iterator.next();\r\n-\t\t\t\tcategories.add(catAPI.find(tmpString, user, false));\r\n+\t\tif (UtilMethods.isSet(categoriesList)) {\r\n+\t\t\tfor (final Iterator<String> iterator = categoriesList.iterator(); iterator.hasNext();) {\r", "originalCommit": "444dfb7f70f681a0b4dc7d2840d6d433920d02a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ4MTIyMA==", "url": "https://github.com/dotCMS/core/pull/19191#discussion_r479481220", "bodyText": "Yes, I thought about it too. But didn't add many changes as this is very old code that will be moved over to a REST Endpoint, hopefully soon.", "author": "jcastro-dotcms", "createdAt": "2020-08-28T18:55:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2NTcyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "f4af01244b1a6b358190e153d958aa278524fe84", "changed_code": [{"header": "diff --git a/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java b/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\nindex e3d09392ec..15ff081edf 100644\n--- a/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\n+++ b/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\n", "chunk": "@@ -423,12 +425,11 @@ public class ContentletWebAPIImpl implements ContentletWebAPI {\n \t\t\t}\n \t\t }\n \n-\t\tif (UtilMethods.isSet(categoriesList)) {\n-\t\t\tfor (final Iterator<String> iterator = categoriesList.iterator(); iterator.hasNext();) {\n-\t\t\t\tfinal String categoryId = iterator.next();\n-\t\t\t\tif (UtilMethods.isSet(categoryId)) {\n-\t\t\t\t\tcategories.add(catAPI.find(categoryId, user, PageMode.get().respectAnonPerms));\n-\t\t\t\t}\n+\t\tif (categoriesList != null && categoriesList.size() > 0) {\n+\t\t\tfor (final Iterator iterator = categoriesList.iterator(); iterator.hasNext();) {\n+\n+\t\t\t\tfinal String tmpString = (String) iterator.next();\n+\t\t\t\tcategories.add(catAPI.find(tmpString, user, false));\n \t\t\t}\n \t\t}\n \n", "next_change": {"commit": "e383862f69fde011161c816cb73474b22b325287", "changed_code": [{"header": "diff --git a/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java b/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\nindex 15ff081edf..e3d09392ec 100644\n--- a/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\n+++ b/dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/business/web/ContentletWebAPIImpl.java\n", "chunk": "@@ -425,11 +423,12 @@ public class ContentletWebAPIImpl implements ContentletWebAPI {\n \t\t\t}\n \t\t }\n \n-\t\tif (categoriesList != null && categoriesList.size() > 0) {\n-\t\t\tfor (final Iterator iterator = categoriesList.iterator(); iterator.hasNext();) {\n-\n-\t\t\t\tfinal String tmpString = (String) iterator.next();\n-\t\t\t\tcategories.add(catAPI.find(tmpString, user, false));\n+\t\tif (UtilMethods.isSet(categoriesList)) {\n+\t\t\tfor (final Iterator<String> iterator = categoriesList.iterator(); iterator.hasNext();) {\n+\t\t\t\tfinal String categoryId = iterator.next();\n+\t\t\t\tif (UtilMethods.isSet(categoryId)) {\n+\t\t\t\t\tcategories.add(catAPI.find(categoryId, user, PageMode.get().respectAnonPerms));\n+\t\t\t\t}\n \t\t\t}\n \t\t}\n \n", "next_change": null}]}}]}}]}