{"pr_number": 2503, "pr_title": "Begin cleanup of core plugin entity mixins", "pr_author": "i509VCB", "pr_createdAt": "2020-02-14T02:53:53Z", "pr_url": "https://github.com/SpongePowered/Sponge/pull/2503", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMjEwMA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379232100", "body": "Could you maybe move these to the `Constants` class?", "bodyText": "Could you maybe move these to the Constants class?", "bodyHTML": "<p dir=\"auto\">Could you maybe move these to the <code>Constants</code> class?</p>", "author": "gabizou", "createdAt": "2020-02-14T03:12:30Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -203,7 +191,7 @@\n         final EntityTypeBridge entityTypeBridge = (EntityTypeBridge) entityType;\n         if (!entityTypeBridge.bridge$checkedDamageEntity()) {\n             try {\n-                final String mapping = SpongeImplHooks.isDeobfuscatedEnvironment() ? \"damageEntity\" : \"func_70665_d\";\n+                final String mapping = SpongeImplHooks.isDeobfuscatedEnvironment() ? \"attackEntityFrom\" : \"func_70097_a\";", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -191,7 +206,7 @@ public abstract class EntityMixin implements EntityBridge, TrackableBridge, Vani\n         final EntityTypeBridge entityTypeBridge = (EntityTypeBridge) entityType;\n         if (!entityTypeBridge.bridge$checkedDamageEntity()) {\n             try {\n-                final String mapping = SpongeImplHooks.isDeobfuscatedEnvironment() ? \"attackEntityFrom\" : \"func_70097_a\";\n+                final String mapping = SpongeImplHooks.isDeobfuscatedEnvironment() ? Constants.Entity.ATTACK_ENTITY_FROM_MAPPING : Constants.Entity.ATTACK_ENTITY_FROM_OBFUSCATED;\n                 final Class<?>[] argTypes = {DamageSource.class, float.class};\n                 final Class<?> clazz = this.getClass().getMethod(mapping, argTypes).getDeclaringClass();\n                 if (!(clazz.equals(LivingEntity.class) || clazz.equals(PlayerEntity.class) || clazz.equals(ServerPlayerEntity.class))) {\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..27c13c0d7 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -199,27 +194,6 @@ public abstract class EntityMixin implements EntityBridge, TrackableBridge, Vani\n \n     // @formatter:on\n \n-    @Inject(method = \"<init>\", at = @At(\"RETURN\"))\n-    private void impl$refreshTrackerStates(EntityType<?> entityType, net.minecraft.world.World world, CallbackInfo ci) {\n-        this.bridge$refreshTrackerStates();\n-\n-        final EntityTypeBridge entityTypeBridge = (EntityTypeBridge) entityType;\n-        if (!entityTypeBridge.bridge$checkedDamageEntity()) {\n-            try {\n-                final String mapping = SpongeImplHooks.isDeobfuscatedEnvironment() ? Constants.Entity.ATTACK_ENTITY_FROM_MAPPING : Constants.Entity.ATTACK_ENTITY_FROM_OBFUSCATED;\n-                final Class<?>[] argTypes = {DamageSource.class, float.class};\n-                final Class<?> clazz = this.getClass().getMethod(mapping, argTypes).getDeclaringClass();\n-                if (!(clazz.equals(LivingEntity.class) || clazz.equals(PlayerEntity.class) || clazz.equals(ServerPlayerEntity.class))) {\n-                    entityTypeBridge.bridge$setOverridesDamageEntity(true);\n-                }\n-            } catch (Throwable ex) {\n-                // ignore\n-            } finally {\n-                entityTypeBridge.bridge$setCheckedDamageEntity(true);\n-            }\n-        }\n-    }\n-\n     @Override\n     public boolean bridge$isConstructing() {\n         return this.impl$isConstructing;\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMjI0MQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379232241", "body": "`final Vec3d vec3d`", "bodyText": "final Vec3d vec3d", "bodyHTML": "<p dir=\"auto\"><code>final Vec3d vec3d</code></p>", "author": "gabizou", "createdAt": "2020-02-14T03:13:13Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -301,15 +289,15 @@ public void dismountRidingEntity() {\n     @Override\n     public boolean bridge$removePassengers(final DismountType type) {\n         boolean dismount = false;\n-        for (int i = this.riddenByEntities.size() - 1; i >= 0; --i) {\n-            dismount = ((EntityMixin) (Object) this.riddenByEntities.get(i)).spongeImpl$dismountRidingEntity(type) || dismount;\n+        for (int i = this.passengers.size() - 1; i >= 0; --i) {\n+            dismount = ((EntityMixin) (Object) this.passengers.get(i)).spongeImpl$dismountRidingEntity(type) || dismount;\n         }\n         return dismount;\n     }\n \n     @Inject(method = \"move\", at = @At(\"HEAD\"), cancellable = true)\n-    private void spongeImpl$onSpongeMoveEntity(final MoverType type, final double x, final double y, final double z, final CallbackInfo ci) {\n-        if (!this.world.isRemote && !SpongeHooks.checkEntitySpeed(((Entity) (Object) this), x, y, z)) {\n+    private void spongeImpl$onSpongeMoveEntity(final MoverType type, Vec3d vec3d, final CallbackInfo ci) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -290,13 +305,13 @@ public void stopRiding() {\n     public boolean bridge$removePassengers(final DismountType type) {\n         boolean dismount = false;\n         for (int i = this.passengers.size() - 1; i >= 0; --i) {\n-            dismount = ((EntityMixin) (Object) this.passengers.get(i)).spongeImpl$dismountRidingEntity(type) || dismount;\n+            dismount = ((EntityMixin) (Object) this.passengers.get(i)).impl$dismountRidingEntity(type) || dismount;\n         }\n         return dismount;\n     }\n \n     @Inject(method = \"move\", at = @At(\"HEAD\"), cancellable = true)\n-    private void spongeImpl$onSpongeMoveEntity(final MoverType type, Vec3d vec3d, final CallbackInfo ci) {\n+    private void impl$onSpongeMoveEntity(final MoverType type, final Vec3d vec3d, final CallbackInfo ci) {\n         if (!this.world.isRemote && !SpongeHooks.checkEntitySpeed(((Entity) (Object) this), vec3d.getX(), vec3d.getY(), vec3d.getZ())) {\n             ci.cancel();\n         }\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..e28ccb642 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -310,7 +272,9 @@ public void stopRiding() {\n         return dismount;\n     }\n \n-    @Inject(method = \"move\", at = @At(\"HEAD\"), cancellable = true)\n+    @Inject(method = \"move\",\n+        at = @At(\"HEAD\"),\n+        cancellable = true)\n     private void impl$onSpongeMoveEntity(final MoverType type, final Vec3d vec3d, final CallbackInfo ci) {\n         if (!this.world.isRemote && !SpongeHooks.checkEntitySpeed(((Entity) (Object) this), vec3d.getX(), vec3d.getY(), vec3d.getZ())) {\n             ci.cancel();\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMjU5NA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379232594", "body": "If you're moving this to a new line, change the `at = @At` to new line, so like:\r\n```java\r\n@Redirect(method = \"doBlockCollisions,\r\n    at = @At(value = \"INVOKE\",\r\n        target = \"Lnet/n....\"\r\n    )\r\n)\r\n```\r\nThis way it's clearer, at least it's the format I'm trying to migrate the codebase to.", "bodyText": "If you're moving this to a new line, change the at = @At to new line, so like:\n@Redirect(method = \"doBlockCollisions,\n    at = @At(value = \"INVOKE\",\n        target = \"Lnet/n....\"\n    )\n)\nThis way it's clearer, at least it's the format I'm trying to migrate the codebase to.", "bodyHTML": "<p dir=\"auto\">If you're moving this to a new line, change the <code>at = @At</code> to new line, so like:</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@Redirect(method = &quot;doBlockCollisions,\n    at = @At(value = &quot;INVOKE&quot;,\n        target = &quot;Lnet/n....&quot;\n    )\n)\"><pre><span class=\"pl-k\">@Redirect</span>(<span class=\"pl-c1\">method</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>doBlockCollisions,</span>\n<span class=\"pl-s\">    at = @At(value = <span class=\"pl-pds\">\"</span></span><span class=\"pl-c1\">INVOKE</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>,</span>\n<span class=\"pl-s\">        target = <span class=\"pl-pds\">\"</span></span><span class=\"pl-smi\">Lnet</span><span class=\"pl-k\">/</span>n<span class=\"pl-k\">.</span><span class=\"pl-c1\">...</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span></span>\n<span class=\"pl-s\">    )</span>\n<span class=\"pl-s\">)</span></pre></div>\n<p dir=\"auto\">This way it's clearer, at least it's the format I'm trying to migrate the codebase to.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:15:19Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -558,21 +544,22 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n \n     }\n \n-    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/Block;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/state/IBlockState;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n-    private void spongeImpl$onEntityCollideWithBlockState(\n-        final Block block, final net.minecraft.world.World world, final BlockPos pos, final BlockState state, final Entity entity) {\n+    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\",\n+        target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -539,34 +553,36 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n         final BlockState state = world.getBlockState(pos);\n         if (!SpongeCommonEventFactory.handleCollideBlockEvent(block, world, pos, state, entity, Direction.NONE)) {\n             block.onEntityWalk(world, pos, entity);\n-            this.lastCollidedBlockPos = pos;\n+            this.impl$lastCollidedBlockPos = pos;\n         }\n \n     }\n \n-    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\",\n-        target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n-    private void spongeImpl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n+    @Redirect(method = \"doBlockCollisions\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\"\n+        )\n+    ) // doBlockCollisions\n+    private void impl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n         // if block can't collide, return\n         if (!((BlockBridge) blockState.getBlock()).bridge$hasCollideWithStateLogic()) {\n             return;\n         }\n \n         if (world.isRemote) {\n-            // In 1.14, why are we calling the state instead? You will notice these methods are deprecated on block since you are supposed to call the state method instead, the methods aren't actually deprecated.\n             blockState.onEntityCollision(world, pos, entityIn);\n             return;\n         }\n \n         if (!SpongeCommonEventFactory.handleCollideBlockEvent(blockState.getBlock(), world, pos, blockState, entityIn, Direction.NONE)) {\n             blockState.onEntityCollision(world, pos, entityIn);\n-            this.lastCollidedBlockPos = pos;\n+            this.impl$lastCollidedBlockPos = pos;\n         }\n \n     }\n \n     @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n-    private void spongeImpl$onBlockFallenUpon(\n+    private void impl$onBlockFallenUpon(\n         final Block block, final net.minecraft.world.World world, final BlockPos pos, final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..27c13c0d7 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -581,9 +543,11 @@ public Vector3d getPosition() {\n \n     }\n \n-    @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n-    private void impl$onBlockFallenUpon(\n-        final Block block, final net.minecraft.world.World world, final BlockPos pos, final Entity entity, final float fallDistance) {\n+    @Redirect(method = \"updateFallState\",\n+            at = @At(value = \"INVOKE\",\n+                    target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n+    private void impl$onBlockFallenUpon(final Block block, final net.minecraft.world.World world, final BlockPos pos,\n+            final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n             return;\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex 27c13c0d7..e28ccb642 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -544,10 +529,10 @@ public void stopRiding() {\n     }\n \n     @Redirect(method = \"updateFallState\",\n-            at = @At(value = \"INVOKE\",\n-                    target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n     private void impl$onBlockFallenUpon(final Block block, final net.minecraft.world.World world, final BlockPos pos,\n-            final Entity entity, final float fallDistance) {\n+        final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n             return;\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMjYzMA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379232630", "body": "s/`spongeImpl`/`impl`", "bodyText": "s/spongeImpl/impl", "bodyHTML": "<p dir=\"auto\">s/<code>spongeImpl</code>/<code>impl</code></p>", "author": "gabizou", "createdAt": "2020-02-14T03:15:32Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -558,21 +544,22 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n \n     }\n \n-    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/Block;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/state/IBlockState;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n-    private void spongeImpl$onEntityCollideWithBlockState(\n-        final Block block, final net.minecraft.world.World world, final BlockPos pos, final BlockState state, final Entity entity) {\n+    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\",\n+        target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n+    private void spongeImpl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -539,34 +553,36 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n         final BlockState state = world.getBlockState(pos);\n         if (!SpongeCommonEventFactory.handleCollideBlockEvent(block, world, pos, state, entity, Direction.NONE)) {\n             block.onEntityWalk(world, pos, entity);\n-            this.lastCollidedBlockPos = pos;\n+            this.impl$lastCollidedBlockPos = pos;\n         }\n \n     }\n \n-    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\",\n-        target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n-    private void spongeImpl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n+    @Redirect(method = \"doBlockCollisions\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\"\n+        )\n+    ) // doBlockCollisions\n+    private void impl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n         // if block can't collide, return\n         if (!((BlockBridge) blockState.getBlock()).bridge$hasCollideWithStateLogic()) {\n             return;\n         }\n \n         if (world.isRemote) {\n-            // In 1.14, why are we calling the state instead? You will notice these methods are deprecated on block since you are supposed to call the state method instead, the methods aren't actually deprecated.\n             blockState.onEntityCollision(world, pos, entityIn);\n             return;\n         }\n \n         if (!SpongeCommonEventFactory.handleCollideBlockEvent(blockState.getBlock(), world, pos, blockState, entityIn, Direction.NONE)) {\n             blockState.onEntityCollision(world, pos, entityIn);\n-            this.lastCollidedBlockPos = pos;\n+            this.impl$lastCollidedBlockPos = pos;\n         }\n \n     }\n \n     @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n-    private void spongeImpl$onBlockFallenUpon(\n+    private void impl$onBlockFallenUpon(\n         final Block block, final net.minecraft.world.World world, final BlockPos pos, final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..27c13c0d7 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -581,9 +543,11 @@ public Vector3d getPosition() {\n \n     }\n \n-    @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n-    private void impl$onBlockFallenUpon(\n-        final Block block, final net.minecraft.world.World world, final BlockPos pos, final Entity entity, final float fallDistance) {\n+    @Redirect(method = \"updateFallState\",\n+            at = @At(value = \"INVOKE\",\n+                    target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n+    private void impl$onBlockFallenUpon(final Block block, final net.minecraft.world.World world, final BlockPos pos,\n+            final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n             return;\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex 27c13c0d7..e28ccb642 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -544,10 +529,10 @@ public void stopRiding() {\n     }\n \n     @Redirect(method = \"updateFallState\",\n-            at = @At(value = \"INVOKE\",\n-                    target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n     private void impl$onBlockFallenUpon(final Block block, final net.minecraft.world.World world, final BlockPos pos,\n-            final Entity entity, final float fallDistance) {\n+        final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n             return;\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMjgzMQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379232831", "body": "Leave out the comment. It's a recognized 1.14 change to call the methods on `BlockState` instead of the parent `Block`.", "bodyText": "Leave out the comment. It's a recognized 1.14 change to call the methods on BlockState instead of the parent Block.", "bodyHTML": "<p dir=\"auto\">Leave out the comment. It's a recognized 1.14 change to call the methods on <code>BlockState</code> instead of the parent <code>Block</code>.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:16:29Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -558,21 +544,22 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n \n     }\n \n-    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/Block;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/state/IBlockState;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n-    private void spongeImpl$onEntityCollideWithBlockState(\n-        final Block block, final net.minecraft.world.World world, final BlockPos pos, final BlockState state, final Entity entity) {\n+    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\",\n+        target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n+    private void spongeImpl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n         // if block can't collide, return\n-        if (!((BlockBridge) block).bridge$hasCollideWithStateLogic()) {\n+        if (!((BlockBridge) blockState.getBlock()).bridge$hasCollideWithStateLogic()) {\n             return;\n         }\n \n         if (world.isRemote) {\n-            block.onEntityCollision(world, pos, state, entity);\n+            // In 1.14, why are we calling the state instead? You will notice these methods are deprecated on block since you are supposed to call the state method instead, the methods aren't actually deprecated.", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -539,34 +553,36 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n         final BlockState state = world.getBlockState(pos);\n         if (!SpongeCommonEventFactory.handleCollideBlockEvent(block, world, pos, state, entity, Direction.NONE)) {\n             block.onEntityWalk(world, pos, entity);\n-            this.lastCollidedBlockPos = pos;\n+            this.impl$lastCollidedBlockPos = pos;\n         }\n \n     }\n \n-    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\",\n-        target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n-    private void spongeImpl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n+    @Redirect(method = \"doBlockCollisions\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\"\n+        )\n+    ) // doBlockCollisions\n+    private void impl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n         // if block can't collide, return\n         if (!((BlockBridge) blockState.getBlock()).bridge$hasCollideWithStateLogic()) {\n             return;\n         }\n \n         if (world.isRemote) {\n-            // In 1.14, why are we calling the state instead? You will notice these methods are deprecated on block since you are supposed to call the state method instead, the methods aren't actually deprecated.\n             blockState.onEntityCollision(world, pos, entityIn);\n             return;\n         }\n \n         if (!SpongeCommonEventFactory.handleCollideBlockEvent(blockState.getBlock(), world, pos, blockState, entityIn, Direction.NONE)) {\n             blockState.onEntityCollision(world, pos, entityIn);\n-            this.lastCollidedBlockPos = pos;\n+            this.impl$lastCollidedBlockPos = pos;\n         }\n \n     }\n \n     @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n-    private void spongeImpl$onBlockFallenUpon(\n+    private void impl$onBlockFallenUpon(\n         final Block block, final net.minecraft.world.World world, final BlockPos pos, final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..27c13c0d7 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -581,9 +543,11 @@ public Vector3d getPosition() {\n \n     }\n \n-    @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n-    private void impl$onBlockFallenUpon(\n-        final Block block, final net.minecraft.world.World world, final BlockPos pos, final Entity entity, final float fallDistance) {\n+    @Redirect(method = \"updateFallState\",\n+            at = @At(value = \"INVOKE\",\n+                    target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n+    private void impl$onBlockFallenUpon(final Block block, final net.minecraft.world.World world, final BlockPos pos,\n+            final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n             return;\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex 27c13c0d7..e28ccb642 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -544,10 +529,10 @@ public void stopRiding() {\n     }\n \n     @Redirect(method = \"updateFallState\",\n-            at = @At(value = \"INVOKE\",\n-                    target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n     private void impl$onBlockFallenUpon(final Block block, final net.minecraft.world.World world, final BlockPos pos,\n-            final Entity entity, final float fallDistance) {\n+        final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n             return;\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMjkxNQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379232915", "body": "Do we need to pass in the block anymore?", "bodyText": "Do we need to pass in the block anymore?", "bodyHTML": "<p dir=\"auto\">Do we need to pass in the block anymore?</p>", "author": "gabizou", "createdAt": "2020-02-14T03:16:51Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -558,21 +544,22 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n \n     }\n \n-    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/Block;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/state/IBlockState;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n-    private void spongeImpl$onEntityCollideWithBlockState(\n-        final Block block, final net.minecraft.world.World world, final BlockPos pos, final BlockState state, final Entity entity) {\n+    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\",\n+        target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n+    private void spongeImpl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n         // if block can't collide, return\n-        if (!((BlockBridge) block).bridge$hasCollideWithStateLogic()) {\n+        if (!((BlockBridge) blockState.getBlock()).bridge$hasCollideWithStateLogic()) {\n             return;\n         }\n \n         if (world.isRemote) {\n-            block.onEntityCollision(world, pos, state, entity);\n+            // In 1.14, why are we calling the state instead? You will notice these methods are deprecated on block since you are supposed to call the state method instead, the methods aren't actually deprecated.\n+            blockState.onEntityCollision(world, pos, entityIn);\n             return;\n         }\n \n-        if (!SpongeCommonEventFactory.handleCollideBlockEvent(block, world, pos, state, entity, Direction.NONE)) {\n-            block.onEntityCollision(world, pos, state, entity);\n+        if (!SpongeCommonEventFactory.handleCollideBlockEvent(blockState.getBlock(), world, pos, blockState, entityIn, Direction.NONE)) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTcxMTg2Nw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379711867", "bodyText": "The SpongeCommonEventFactory method it calls is with that block param is bridge$addTrackedBlockPosition, so I don't wholey know if It needs to stay.", "author": "i509VCB", "createdAt": "2020-02-15T02:38:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMjkxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -539,34 +553,36 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n         final BlockState state = world.getBlockState(pos);\n         if (!SpongeCommonEventFactory.handleCollideBlockEvent(block, world, pos, state, entity, Direction.NONE)) {\n             block.onEntityWalk(world, pos, entity);\n-            this.lastCollidedBlockPos = pos;\n+            this.impl$lastCollidedBlockPos = pos;\n         }\n \n     }\n \n-    @Redirect(method = \"doBlockCollisions\", at = @At(value = \"INVOKE\",\n-        target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\")) // doBlockCollisions\n-    private void spongeImpl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n+    @Redirect(method = \"doBlockCollisions\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/BlockState;onEntityCollision(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;)V\"\n+        )\n+    ) // doBlockCollisions\n+    private void impl$onEntityCollideWithBlockState(BlockState blockState, net.minecraft.world.World worldIn, BlockPos pos, Entity entityIn) {\n         // if block can't collide, return\n         if (!((BlockBridge) blockState.getBlock()).bridge$hasCollideWithStateLogic()) {\n             return;\n         }\n \n         if (world.isRemote) {\n-            // In 1.14, why are we calling the state instead? You will notice these methods are deprecated on block since you are supposed to call the state method instead, the methods aren't actually deprecated.\n             blockState.onEntityCollision(world, pos, entityIn);\n             return;\n         }\n \n         if (!SpongeCommonEventFactory.handleCollideBlockEvent(blockState.getBlock(), world, pos, blockState, entityIn, Direction.NONE)) {\n             blockState.onEntityCollision(world, pos, entityIn);\n-            this.lastCollidedBlockPos = pos;\n+            this.impl$lastCollidedBlockPos = pos;\n         }\n \n     }\n \n     @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n-    private void spongeImpl$onBlockFallenUpon(\n+    private void impl$onBlockFallenUpon(\n         final Block block, final net.minecraft.world.World world, final BlockPos pos, final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..27c13c0d7 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -581,9 +543,11 @@ public Vector3d getPosition() {\n \n     }\n \n-    @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n-    private void impl$onBlockFallenUpon(\n-        final Block block, final net.minecraft.world.World world, final BlockPos pos, final Entity entity, final float fallDistance) {\n+    @Redirect(method = \"updateFallState\",\n+            at = @At(value = \"INVOKE\",\n+                    target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n+    private void impl$onBlockFallenUpon(final Block block, final net.minecraft.world.World world, final BlockPos pos,\n+            final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n             return;\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex 27c13c0d7..e28ccb642 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -544,10 +529,10 @@ public void stopRiding() {\n     }\n \n     @Redirect(method = \"updateFallState\",\n-            at = @At(value = \"INVOKE\",\n-                    target=\"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/Block;onFallenUpon(Lnet/minecraft/world/World;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/entity/Entity;F)V\"))\n     private void impl$onBlockFallenUpon(final Block block, final net.minecraft.world.World world, final BlockPos pos,\n-            final Entity entity, final float fallDistance) {\n+        final Entity entity, final float fallDistance) {\n         if (world.isRemote) {\n             block.onFallenUpon(world, pos, entity, fallDistance);\n             return;\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMjk5Mg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379232992", "body": "Fix the method name with `impl$` prefix.", "bodyText": "Fix the method name with impl$ prefix.", "bodyHTML": "<p dir=\"auto\">Fix the method name with <code>impl$</code> prefix.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:17:14Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -672,48 +659,48 @@ private boolean spongeApplyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n-    @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;spawnParticle(Lnet/minecraft/util/EnumParticleTypes;DDDDDD[I)V\"))\n-    private void spawnParticle(final net.minecraft.world.World world, final EnumParticleTypes particleTypes, final double xCoord, final double yCoord, final double zCoord,\n-        final double xOffset, final double yOffset, final double zOffset, final int... p_175688_14_) {\n+    @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -650,17 +666,17 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n      * This prevents sounds from being sent to the server by entities that are vanished\n      */\n     @Redirect(method = \"playSound\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/Entity;isSilent()Z\"))\n-    private boolean spongeImpl$checkIsSilentOrInvis(final Entity entity) {\n+    private boolean impl$checkIsSilentOrInvis(final Entity entity) {\n         return entity.isSilent() || this.vanish$isVanished;\n     }\n \n     @Redirect(method = \"applyEntityCollision\", at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n-    private boolean spongeApplyEntityCollisionCheckVanish(final Entity entity) {\n+    private boolean impl$applyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n     @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n                                final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..27c13c0d7 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -670,21 +634,28 @@ public Vector3d getPosition() {\n         return entity.isSilent() || this.vanish$isVanished;\n     }\n \n-    @Redirect(method = \"applyEntityCollision\", at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n+    @Redirect(method = \"applyEntityCollision\",\n+            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n     private boolean impl$applyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n-    @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    @Redirect(method = \"doWaterSplashEffect\",\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n+            final double xCoord, final double yCoord, final double zCoord,\n                                final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n         }\n     }\n \n-    @Redirect(method = \"createRunningParticles\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    @Redirect(method = \"createRunningParticles\",\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n+            final double xCoord, final double yCoord, final double zCoord,\n         final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex 27c13c0d7..e28ccb642 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -625,37 +610,41 @@ public void stopRiding() {\n \n     /**\n      * @author gabizou - January 4th, 2016\n-     * @reason  gabizou - January 27th, 2016 - Rewrite to a redirect\n-     *\n-     * This prevents sounds from being sent to the server by entities that are vanished\n+     * @reason gabizou - January 27th, 2016 - Rewrite to a redirect\n+     *     <p>\n+     *     This prevents sounds from being sent to the server by entities that are vanished\n      */\n-    @Redirect(method = \"playSound\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/Entity;isSilent()Z\"))\n+    @Redirect(method = \"playSound\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/Entity;isSilent()Z\"))\n     private boolean impl$checkIsSilentOrInvis(final Entity entity) {\n         return entity.isSilent() || this.vanish$isVanished;\n     }\n \n     @Redirect(method = \"applyEntityCollision\",\n-            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n+        at = @At(value = \"FIELD\",\n+            target = \"Lnet/minecraft/entity/Entity;noClip:Z\",\n+            opcode = Opcodes.GETFIELD))\n     private boolean impl$applyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n     @Redirect(method = \"doWaterSplashEffect\",\n-            at = @At(value = \"INVOKE\",\n-                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n     private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n-            final double xCoord, final double yCoord, final double zCoord,\n-                               final double xOffset, final double yOffset, final double zOffset) {\n+        final double xCoord, final double yCoord, final double zCoord,\n+        final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n         }\n     }\n \n     @Redirect(method = \"createRunningParticles\",\n-            at = @At(value = \"INVOKE\",\n-                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n     private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n-            final double xCoord, final double yCoord, final double zCoord,\n+        final double xCoord, final double yCoord, final double zCoord,\n         final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMzAzMA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379233030", "body": "Same here, fix the prefixing.", "bodyText": "Same here, fix the prefixing.", "bodyHTML": "<p dir=\"auto\">Same here, fix the prefixing.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:17:25Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -672,48 +659,48 @@ private boolean spongeApplyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n-    @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;spawnParticle(Lnet/minecraft/util/EnumParticleTypes;DDDDDD[I)V\"))\n-    private void spawnParticle(final net.minecraft.world.World world, final EnumParticleTypes particleTypes, final double xCoord, final double yCoord, final double zCoord,\n-        final double xOffset, final double yOffset, final double zOffset, final int... p_175688_14_) {\n+    @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+                               final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n-            this.world.spawnParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset, p_175688_14_);\n+            this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n         }\n     }\n \n-    @Redirect(method = \"createRunningParticles\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;spawnParticle(Lnet/minecraft/util/EnumParticleTypes;DDDDDD[I)V\"))\n-    private void runningSpawnParticle(final net.minecraft.world.World world, final EnumParticleTypes particleTypes, final double xCoord, final double yCoord, final double zCoord,\n-        final double xOffset, final double yOffset, final double zOffset, final int... p_175688_14_) {\n+    @Redirect(method = \"createRunningParticles\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -650,17 +666,17 @@ private void onSpongeReadFromNBT(final CompoundNBT compound, final CallbackInfo\n      * This prevents sounds from being sent to the server by entities that are vanished\n      */\n     @Redirect(method = \"playSound\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/Entity;isSilent()Z\"))\n-    private boolean spongeImpl$checkIsSilentOrInvis(final Entity entity) {\n+    private boolean impl$checkIsSilentOrInvis(final Entity entity) {\n         return entity.isSilent() || this.vanish$isVanished;\n     }\n \n     @Redirect(method = \"applyEntityCollision\", at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n-    private boolean spongeApplyEntityCollisionCheckVanish(final Entity entity) {\n+    private boolean impl$applyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n     @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n                                final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..27c13c0d7 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -670,21 +634,28 @@ public Vector3d getPosition() {\n         return entity.isSilent() || this.vanish$isVanished;\n     }\n \n-    @Redirect(method = \"applyEntityCollision\", at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n+    @Redirect(method = \"applyEntityCollision\",\n+            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n     private boolean impl$applyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n-    @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    @Redirect(method = \"doWaterSplashEffect\",\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n+            final double xCoord, final double yCoord, final double zCoord,\n                                final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n         }\n     }\n \n-    @Redirect(method = \"createRunningParticles\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    @Redirect(method = \"createRunningParticles\",\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n+            final double xCoord, final double yCoord, final double zCoord,\n         final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex 27c13c0d7..e28ccb642 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -625,37 +610,41 @@ public void stopRiding() {\n \n     /**\n      * @author gabizou - January 4th, 2016\n-     * @reason  gabizou - January 27th, 2016 - Rewrite to a redirect\n-     *\n-     * This prevents sounds from being sent to the server by entities that are vanished\n+     * @reason gabizou - January 27th, 2016 - Rewrite to a redirect\n+     *     <p>\n+     *     This prevents sounds from being sent to the server by entities that are vanished\n      */\n-    @Redirect(method = \"playSound\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/Entity;isSilent()Z\"))\n+    @Redirect(method = \"playSound\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/Entity;isSilent()Z\"))\n     private boolean impl$checkIsSilentOrInvis(final Entity entity) {\n         return entity.isSilent() || this.vanish$isVanished;\n     }\n \n     @Redirect(method = \"applyEntityCollision\",\n-            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n+        at = @At(value = \"FIELD\",\n+            target = \"Lnet/minecraft/entity/Entity;noClip:Z\",\n+            opcode = Opcodes.GETFIELD))\n     private boolean impl$applyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n     @Redirect(method = \"doWaterSplashEffect\",\n-            at = @At(value = \"INVOKE\",\n-                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n     private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n-            final double xCoord, final double yCoord, final double zCoord,\n-                               final double xOffset, final double yOffset, final double zOffset) {\n+        final double xCoord, final double yCoord, final double zCoord,\n+        final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n         }\n     }\n \n     @Redirect(method = \"createRunningParticles\",\n-            at = @At(value = \"INVOKE\",\n-                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n     private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n-            final double xCoord, final double yCoord, final double zCoord,\n+        final double xCoord, final double yCoord, final double zCoord,\n         final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": null}]}}]}}, {"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex af34a1b71..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -668,7 +684,7 @@ private void spawnParticle(final net.minecraft.world.World world, final IParticl\n     }\n \n     @Redirect(method = \"createRunningParticles\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n         final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..27c13c0d7 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -670,21 +634,28 @@ public Vector3d getPosition() {\n         return entity.isSilent() || this.vanish$isVanished;\n     }\n \n-    @Redirect(method = \"applyEntityCollision\", at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n+    @Redirect(method = \"applyEntityCollision\",\n+            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n     private boolean impl$applyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n-    @Redirect(method = \"doWaterSplashEffect\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    @Redirect(method = \"doWaterSplashEffect\",\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n+            final double xCoord, final double yCoord, final double zCoord,\n                                final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n         }\n     }\n \n-    @Redirect(method = \"createRunningParticles\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n-    private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes, final double xCoord, final double yCoord, final double zCoord,\n+    @Redirect(method = \"createRunningParticles\",\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+    private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n+            final double xCoord, final double yCoord, final double zCoord,\n         final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex 27c13c0d7..e28ccb642 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -625,37 +610,41 @@ public void stopRiding() {\n \n     /**\n      * @author gabizou - January 4th, 2016\n-     * @reason  gabizou - January 27th, 2016 - Rewrite to a redirect\n-     *\n-     * This prevents sounds from being sent to the server by entities that are vanished\n+     * @reason gabizou - January 27th, 2016 - Rewrite to a redirect\n+     *     <p>\n+     *     This prevents sounds from being sent to the server by entities that are vanished\n      */\n-    @Redirect(method = \"playSound\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/Entity;isSilent()Z\"))\n+    @Redirect(method = \"playSound\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/Entity;isSilent()Z\"))\n     private boolean impl$checkIsSilentOrInvis(final Entity entity) {\n         return entity.isSilent() || this.vanish$isVanished;\n     }\n \n     @Redirect(method = \"applyEntityCollision\",\n-            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/Entity;noClip:Z\", opcode = Opcodes.GETFIELD))\n+        at = @At(value = \"FIELD\",\n+            target = \"Lnet/minecraft/entity/Entity;noClip:Z\",\n+            opcode = Opcodes.GETFIELD))\n     private boolean impl$applyEntityCollisionCheckVanish(final Entity entity) {\n         return entity.noClip || ((VanishableBridge) entity).bridge$isVanished();\n     }\n \n     @Redirect(method = \"doWaterSplashEffect\",\n-            at = @At(value = \"INVOKE\",\n-                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n     private void impl$spawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n-            final double xCoord, final double yCoord, final double zCoord,\n-                               final double xOffset, final double yOffset, final double zOffset) {\n+        final double xCoord, final double yCoord, final double zCoord,\n+        final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n         }\n     }\n \n     @Redirect(method = \"createRunningParticles\",\n-            at = @At(value = \"INVOKE\",\n-                    target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;addParticle(Lnet/minecraft/particles/IParticleData;DDDDDD)V\"))\n     private void impl$runningSpawnParticle(final net.minecraft.world.World world, final IParticleData particleTypes,\n-            final double xCoord, final double yCoord, final double zCoord,\n+        final double xCoord, final double yCoord, final double zCoord,\n         final double xOffset, final double yOffset, final double zOffset) {\n         if (!this.vanish$isVanished) {\n             this.world.addParticle(particleTypes, xCoord, yCoord, zCoord, xOffset, yOffset, zOffset);\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMzQ1OA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379233458", "body": "Add a `TODO` for me to review this bit of code, it might be refactored into oblivion later when entity capturing is reviewed.", "bodyText": "Add a TODO for me to review this bit of code, it might be refactored into oblivion later when entity capturing is reviewed.", "bodyHTML": "<p dir=\"auto\">Add a <code>TODO</code> for me to review this bit of code, it might be refactored into oblivion later when entity capturing is reviewed.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:19:32Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -743,7 +730,7 @@ public ItemEntity entityDropItem(final ItemStack stack, final float offsetY) {\n             } else {\n                 final ItemEntity entityitem = new ItemEntity(this.world, this.posX, this.posY + (double) offsetY, this.posZ, stack);\n                 entityitem.setDefaultPickupDelay();\n-                this.world.addEntity0(entityitem);", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMzU5Nw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379233597", "body": "Is it on `EntityTypeBridge`? Did you add that or is that being inherited from `TimingsHolder` (or whatever the interface is)?", "bodyText": "Is it on EntityTypeBridge? Did you add that or is that being inherited from TimingsHolder (or whatever the interface is)?", "bodyHTML": "<p dir=\"auto\">Is it on <code>EntityTypeBridge</code>? Did you add that or is that being inherited from <code>TimingsHolder</code> (or whatever the interface is)?</p>", "author": "gabizou", "createdAt": "2020-02-14T03:20:22Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -754,12 +741,12 @@ public ItemEntity entityDropItem(final ItemStack stack, final float offsetY) {\n     @Nullable\n     @Override\n     public BlockPos bridge$getLastCollidedBlockPos() {\n-        return this.lastCollidedBlockPos;\n+        return this.impl$lastCollidedBlockPos;\n     }\n \n     @Override\n     public Timing bridge$getTimingsHandler() {\n-        return this.entityType.getTimingsHandler();\n+        return ((EntityTypeBridge) this.shadow$getType()).bridge$getTimings();", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTcxMjA0NA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379712044", "bodyText": "There isn't a TimingsHolder interface but there is a timings instance inside of EntityTypeMixin which is what this bridge refers to.", "author": "i509VCB", "createdAt": "2020-02-15T02:42:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMzU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5OTc3NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382399775", "bodyText": "I see, I stand corrected. I was vaguely remembering timings to be instanced based on the bridge interface separate from the targeted bridges, but that's a separate story", "author": "gabizou", "createdAt": "2020-02-21T05:07:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMzU5Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzMzc1NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379233755", "body": "Fix the method name here please.", "bodyText": "Fix the method name here please.", "bodyHTML": "<p dir=\"auto\">Fix the method name here please.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:21:05Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java", "diffHunk": "@@ -330,7 +333,7 @@ private EntityDeathContext createOrNullDeathPhase(final boolean isMainThread, fi\n         return null;\n     }\n \n-    @Redirect(method = \"applyPotionDamageCalculations\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityLivingBase;isPotionActive(Lnet/minecraft/potion/Potion;)Z\") )\n+    @Redirect(method = \"applyPotionDamageCalculations\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;isPotionActive(Lnet/minecraft/potion/Effect;)Z\") )\n     private boolean onIsPotionActive(final LivingEntity entityIn, final Effect potion) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex c276511ea..342cc2a25 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -334,7 +336,7 @@ private EntityDeathContext createOrNullDeathPhase(final boolean isMainThread, fi\n     }\n \n     @Redirect(method = \"applyPotionDamageCalculations\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;isPotionActive(Lnet/minecraft/potion/Effect;)Z\") )\n-    private boolean onIsPotionActive(final LivingEntity entityIn, final Effect potion) {\n+    private boolean impl$onIsPotionActive(final LivingEntity entityIn, final Effect potion) {\n         return false; // handled in our bridge$damageEntityHook\n     }\n \n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex 342cc2a25..e8a1afcc9 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -335,19 +248,20 @@ private EntityDeathContext createOrNullDeathPhase(final boolean isMainThread, fi\n         return null;\n     }\n \n-    @Redirect(method = \"applyPotionDamageCalculations\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;isPotionActive(Lnet/minecraft/potion/Effect;)Z\") )\n+    @Redirect(method = \"applyPotionDamageCalculations\", at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/LivingEntity;isPotionActive(Lnet/minecraft/potion/Effect;)Z\"))\n     private boolean impl$onIsPotionActive(final LivingEntity entityIn, final Effect potion) {\n         return false; // handled in our bridge$damageEntityHook\n     }\n \n     /**\n-     * @author blood - Some time ago in 2015?\n-     * @reason Our damage hook handles armor modifiers and \"replaying\" damage to armor.\n-     *\n      * @param entityIn The entity being damaged\n      * @param damage The damage to deal\n+     * @author blood - Some time ago in 2015?\n+     * @reason Our damage hook handles armor modifiers and \"replaying\" damage to armor.\n      */\n-    @Redirect(method = \"applyArmorCalculations\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;damageArmor(F)V\") )\n+    @Redirect(method = \"applyArmorCalculations\",\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;damageArmor(F)V\"))\n     private void onDamageArmor(final LivingEntity entityIn, final float damage) {\n         // do nothing as this is handled in our bridge$damageEntityHook\n     }\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex e8a1afcc9..2156974a8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -261,7 +218,8 @@ private EntityDeathContext createOrNullDeathPhase(final boolean isMainThread, fi\n      * @reason Our damage hook handles armor modifiers and \"replaying\" damage to armor.\n      */\n     @Redirect(method = \"applyArmorCalculations\",\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;damageArmor(F)V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/LivingEntity;damageArmor(F)V\"))\n     private void onDamageArmor(final LivingEntity entityIn, final float damage) {\n         // do nothing as this is handled in our bridge$damageEntityHook\n     }\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDAzMw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234033", "body": "Should be `shadow$` prefixed if it's calling a shadow method (Yes, I know this is an overwrite).", "bodyText": "Should be shadow$ prefixed if it's calling a shadow method (Yes, I know this is an overwrite).", "bodyHTML": "<p dir=\"auto\">Should be <code>shadow$</code> prefixed if it's calling a shadow method (Yes, I know this is an overwrite).</p>", "author": "gabizou", "createdAt": "2020-02-14T03:22:28Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java", "diffHunk": "@@ -385,7 +388,7 @@ public boolean attackEntityFrom(final DamageSource source, final float amount) {\n             return false;\n         }\n         // Sponge end\n-        if (this.isEntityInvulnerable(source)) {\n+        if (this.isInvulnerableTo(source)) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex c276511ea..342cc2a25 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -388,7 +390,7 @@ public boolean attackEntityFrom(final DamageSource source, final float amount) {\n             return false;\n         }\n         // Sponge end\n-        if (this.isInvulnerableTo(source)) {\n+        if (this.shadow$isInvulnerableTo(source)) {\n             return false;\n         } else if (this.world.isRemote) {\n             return false;\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex 342cc2a25..2156974a8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -394,35 +265,36 @@ public boolean attackEntityFrom(final DamageSource source, final float amount) {\n             return false;\n         } else if (this.world.isRemote) {\n             return false;\n+        } else if (this.shadow$getHealth() <= 0.0F && source != DamageTypeStreamGenerator.IGNORED_DAMAGE_SOURCE) {\n+            return false;\n+        } else if (source.isFireDamage() && this.shadow$isPotionActive(Effects.FIRE_RESISTANCE)) {\n+            return false;\n         } else {\n+            if (this.shadow$isSleeping() && !this.world.isRemote) {\n+                this.shadow$wakeUp();\n+            }\n+\n             this.idleTime = 0;\n \n-            // Sponge - if the damage source is ignored, then do not return false here, as the health\n-            // has already been set to zero if Keys#HEALTH or SpongeHealthData is set to zero.\n-            if (this.getHealth() <= 0.0F && source != DamageSourceRegistryModule.IGNORED_DAMAGE_SOURCE) {\n-                return false;\n-            } else if (source.isFireDamage() && this.isPotionActive(Effects.FIRE_RESISTANCE)) {\n-                return false;\n-            } else {\n \n-                final float f = amount;\n+            final float f = amount;\n \n-                // Sponge - ignore as this is handled in our damageEntityHookge\n+            // Sponge - ignore as this is handled in our damageEntityHookge\n //                if ((source == DamageSource.ANVIL || source == DamageSource.FALLING_BLOCK) && !this.getItemStackFromSlot(EntityEquipmentSlot.HEAD).isEmpty())\n //                {\n //                    this.getItemStackFromSlot(EntityEquipmentSlot.HEAD).damageItem((int)(amount * 4.0F + this.rand.nextFloat() * amount * 2.0F), this);\n //                    amount *= 0.75F;\n //                }\n-                // Sponge End\n+            // Sponge End\n \n-                // Sponge - set the 'shield blocking ran' flag to the proper value, since\n-                // we comment out the logic below\n-                final boolean flag = amount > 0.0F && this.canBlockDamageSource(source);\n+            // Sponge - set the 'shield blocking ran' flag to the proper value, since\n+            // we comment out the logic below\n+            final boolean flag = amount > 0.0F && this.shadow$canBlockDamageSource(source);\n \n-                // Sponge start - this is handled in our bridge$damageEntityHook\n+            // Sponge start - this is handled in our bridge$damageEntityHook\n //                boolean flag = false;\n //\n-//                if (amount > 0.0F && this.canBlockDamageSource(source))\n+//                if (amount > 0.0F && this.shadow$canBlockDamageSource(source))\n //                {\n //                    this.damageShield(amount);\n //                    amount = 0.0F;\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDA1OA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234058", "body": "Same here", "bodyText": "Same here", "bodyHTML": "<p dir=\"auto\">Same here</p>", "author": "gabizou", "createdAt": "2020-02-14T03:22:36Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java", "diffHunk": "@@ -590,7 +593,7 @@ private void spawnItemParticle(final World world, final EnumParticleTypes partic\n     @SuppressWarnings(\"ConstantConditions\")\n     @Override\n     public boolean bridge$damageEntityHook(final DamageSource damageSource, float damage) {\n-        if (!this.isEntityInvulnerable(damageSource)) {\n+        if (!this.isInvulnerableTo(damageSource)) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex c276511ea..342cc2a25 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -593,7 +595,7 @@ private void spawnItemParticle(final World world, final EnumParticleTypes partic\n     @SuppressWarnings(\"ConstantConditions\")\n     @Override\n     public boolean bridge$damageEntityHook(final DamageSource damageSource, float damage) {\n-        if (!this.isInvulnerableTo(damageSource)) {\n+        if (!this.shadow$isInvulnerableTo(damageSource)) {\n             final boolean human = (LivingEntity) (Object) this instanceof PlayerEntity;\n             // apply forge damage hook\n             damage = this.bridge$applyModDamage((LivingEntity) (Object) this, damageSource, damage);\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex 342cc2a25..2156974a8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -601,14 +474,14 @@ private void spawnItemParticle(final World world, final EnumParticleTypes partic\n             damage = this.bridge$applyModDamage((LivingEntity) (Object) this, damageSource, damage);\n             final float originalDamage = damage; // set after forge hook.\n             if (damage <= 0) {\n-                damage = 0;\n+                return false;\n             }\n \n             final List<DamageFunction> originalFunctions = new ArrayList<>();\n             final Optional<DamageFunction> hardHatFunction =\n                 DamageEventHandler.createHardHatModifier((LivingEntity) (Object) this, damageSource);\n             final Optional<List<DamageFunction>> armorFunction =\n-                    this.bridge$provideArmorModifiers((LivingEntity) (Object) this, damageSource, damage);\n+                this.bridge$provideArmorModifiers((LivingEntity) (Object) this, damageSource, damage);\n             final Optional<DamageFunction> resistanceFunction =\n                 DamageEventHandler.createResistanceModifier((LivingEntity) (Object) this, damageSource);\n             final Optional<List<DamageFunction>> armorEnchantments =\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDE5MQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234191", "body": "Fix the method name for this, don't keep it same named with the added prefix.", "bodyText": "Fix the method name for this, don't keep it same named with the added prefix.", "bodyHTML": "<p dir=\"auto\">Fix the method name for this, don't keep it same named with the added prefix.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:23:13Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java", "diffHunk": "@@ -872,7 +875,7 @@ private void causeTrackDeathUpdate(final LivingEntity entityLivingBase) {\n         }\n     }\n \n-    @Redirect(method = \"onDeathUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityLivingBase;getExperiencePoints(Lnet/minecraft/entity/player/EntityPlayer;)I\"))\n+    @Redirect(method = \"onDeathUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;getExperiencePoints(Lnet/minecraft/entity/player/PlayerEntity;)I\"))\n     private int onGetExperiencePoints(final LivingEntity entity, final PlayerEntity attackingPlayer) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex c276511ea..342cc2a25 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -851,32 +831,19 @@ public boolean canBeCollidedWith() {\n         return !(this.bridge$isVanished() && this.bridge$isUncollideable()) && !this.isDead;\n     }\n \n-    @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/WorldServer;spawnParticle(Lnet/minecraft/util/EnumParticleTypes;DDDIDDDD[I)V\"))\n-    private void spongeSpawnParticleForFallState(\n-        final ServerWorld worldServer, final EnumParticleTypes particleTypes, final double xCoord, final double yCoord,\n-            final double zCoord, final int numberOfParticles, final double xOffset, final double yOffset, final double zOffset, final double particleSpeed, final int... extraArgs) {\n+    @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/server/ServerWorld;spawnParticle(Lnet/minecraft/particles/IParticleData;DDDIDDDD)I\"))\n+    private int impl$vanishSpawnParticleForFallState(\n+        final ServerWorld serverWorld, final IParticleData particleTypes, final double xCoord, final double yCoord,\n+        final double zCoord, final int numberOfParticles, final double xOffset, final double yOffset, final double zOffset, final double particleSpeed) {\n         if (!this.bridge$isVanished()) {\n-            worldServer.spawnParticle(particleTypes, xCoord, yCoord, zCoord, numberOfParticles, xOffset, yOffset, zOffset, particleSpeed, extraArgs);\n+            serverWorld.spawnParticle(particleTypes, xCoord, yCoord, zCoord, numberOfParticles, xOffset, yOffset, zOffset, particleSpeed);\n         }\n \n-    }\n-\n-    @Redirect(method = \"onEntityUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityLivingBase;onDeathUpdate()V\"))\n-    private void causeTrackDeathUpdate(final LivingEntity entityLivingBase) {\n-        if (!this.world.isRemote) {\n-            try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame();\n-                 final PhaseContext<?> context = EntityPhase.State.DEATH_UPDATE.createPhaseContext(PhaseTracker.SERVER).source(entityLivingBase)) {\n-                context.buildAndSwitch();\n-                frame.pushCause(this);\n-                this.onDeathUpdate();\n-            }\n-        } else {\n-            this.onDeathUpdate();\n-        }\n+        return 0; // TODO: Is this correct to return 0?\n     }\n \n     @Redirect(method = \"onDeathUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;getExperiencePoints(Lnet/minecraft/entity/player/PlayerEntity;)I\"))\n-    private int onGetExperiencePoints(final LivingEntity entity, final PlayerEntity attackingPlayer) {\n+    private int impl$modifyExperiencePointsOnDeath(final LivingEntity entity, final PlayerEntity attackingPlayer) {\n         if (entity instanceof PlayerEntityBridge) {\n             if (((PlayerEntityBridge) entity).bridge$keepInventory()) {\n                 return 0;\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex 342cc2a25..e8a1afcc9 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -842,16 +758,6 @@ public boolean canBeCollidedWith() {\n         return 0; // TODO: Is this correct to return 0?\n     }\n \n-    @Redirect(method = \"onDeathUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;getExperiencePoints(Lnet/minecraft/entity/player/PlayerEntity;)I\"))\n-    private int impl$modifyExperiencePointsOnDeath(final LivingEntity entity, final PlayerEntity attackingPlayer) {\n-        if (entity instanceof PlayerEntityBridge) {\n-            if (((PlayerEntityBridge) entity).bridge$keepInventory()) {\n-                return 0;\n-            }\n-        }\n-        return this.getExperiencePoints(attackingPlayer);\n-    }\n-\n     @Inject(method = \"onItemPickup\", at = @At(\"HEAD\"))\n     public void impl$onEntityItemPickup(final Entity entityItem, final int unused, final CallbackInfo ci) {\n         if (!this.world.isRemote) {\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex e8a1afcc9..2156974a8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -743,30 +704,25 @@ public boolean attemptTeleport(final double x, final double y, final double z, f\n      */\n     @Overwrite\n     public boolean canBeCollidedWith() {\n-        return !(this.bridge$isVanished() && this.bridge$isUncollideable()) && !this.isDead;\n+        return !(this.bridge$isVanished() && this.bridge$isUncollideable()) && !this.removed;\n     }\n \n-    @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\",\n+    @Redirect(method = \"updateFallState\",\n+        at = @At(value = \"INVOKE\",\n             target = \"Lnet/minecraft/world/server/ServerWorld;spawnParticle(Lnet/minecraft/particles/IParticleData;DDDIDDDD)I\"))\n     private int impl$vanishSpawnParticleForFallState(\n-            final ServerWorld serverWorld, final IParticleData particleTypes, final double xCoord, final double yCoord,\n-            final double zCoord, final int numberOfParticles, final double xOffset, final double yOffset, final double zOffset, final double particleSpeed) {\n+        final ServerWorld serverWorld, final IParticleData particleTypes, final double xCoord, final double yCoord,\n+        final double zCoord, final int numberOfParticles, final double xOffset, final double yOffset,\n+        final double zOffset, final double particleSpeed) {\n         if (!this.bridge$isVanished()) {\n-            serverWorld.spawnParticle(particleTypes, xCoord, yCoord, zCoord, numberOfParticles, xOffset, yOffset, zOffset, particleSpeed);\n+            return serverWorld.spawnParticle(particleTypes, xCoord, yCoord, zCoord, numberOfParticles, xOffset, yOffset, zOffset, particleSpeed);\n         }\n-\n         return 0; // TODO: Is this correct to return 0?\n     }\n \n-    @Inject(method = \"onItemPickup\", at = @At(\"HEAD\"))\n-    public void impl$onEntityItemPickup(final Entity entityItem, final int unused, final CallbackInfo ci) {\n-        if (!this.world.isRemote) {\n-//            EntityUtil.toMixin(entityItem).setDestructCause(Cause.of(NamedCause.of(\"PickedUp\", this)));\n-        }\n-    }\n-\n     @Inject(method = \"onItemUseFinish\",\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;resetActiveHand()V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/LivingEntity;resetActiveHand()V\"))\n     private void impl$updateHealthForUseFinish(final CallbackInfo ci) {\n         if (this instanceof ServerPlayerEntityBridge) {\n             ((ServerPlayerEntityBridge) this).bridge$refreshScaledHealth();\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDIwOA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234208", "body": "Prefix the method name.", "bodyText": "Prefix the method name.", "bodyHTML": "<p dir=\"auto\">Prefix the method name.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:23:21Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java", "diffHunk": "@@ -889,7 +892,7 @@ public void onEntityItemPickup(final Entity entityItem, final int unused, final\n         }\n     }\n \n-    @Inject(method = \"onItemUseFinish\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityLivingBase;resetActiveHand()V\"))\n+    @Inject(method = \"onItemUseFinish\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;resetActiveHand()V\"))\n     private void updateHealthForUseFinish(final CallbackInfo ci) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex c276511ea..342cc2a25 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -886,14 +853,14 @@ private int onGetExperiencePoints(final LivingEntity entity, final PlayerEntity\n     }\n \n     @Inject(method = \"onItemPickup\", at = @At(\"HEAD\"))\n-    public void onEntityItemPickup(final Entity entityItem, final int unused, final CallbackInfo ci) {\n+    public void impl$onEntityItemPickup(final Entity entityItem, final int unused, final CallbackInfo ci) {\n         if (!this.world.isRemote) {\n //            EntityUtil.toMixin(entityItem).setDestructCause(Cause.of(NamedCause.of(\"PickedUp\", this)));\n         }\n     }\n \n     @Inject(method = \"onItemUseFinish\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;resetActiveHand()V\"))\n-    private void updateHealthForUseFinish(final CallbackInfo ci) {\n+    private void impl$updateHealthForUseFinish(final CallbackInfo ci) {\n         if (this instanceof ServerPlayerEntityBridge) {\n             ((ServerPlayerEntityBridge) this).bridge$refreshScaledHealth();\n         }\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex 342cc2a25..e8a1afcc9 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -859,7 +765,8 @@ public boolean canBeCollidedWith() {\n         }\n     }\n \n-    @Inject(method = \"onItemUseFinish\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;resetActiveHand()V\"))\n+    @Inject(method = \"onItemUseFinish\",\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;resetActiveHand()V\"))\n     private void impl$updateHealthForUseFinish(final CallbackInfo ci) {\n         if (this instanceof ServerPlayerEntityBridge) {\n             ((ServerPlayerEntityBridge) this).bridge$refreshScaledHealth();\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex e8a1afcc9..2156974a8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -743,30 +704,25 @@ public boolean attemptTeleport(final double x, final double y, final double z, f\n      */\n     @Overwrite\n     public boolean canBeCollidedWith() {\n-        return !(this.bridge$isVanished() && this.bridge$isUncollideable()) && !this.isDead;\n+        return !(this.bridge$isVanished() && this.bridge$isUncollideable()) && !this.removed;\n     }\n \n-    @Redirect(method = \"updateFallState\", at = @At(value = \"INVOKE\",\n+    @Redirect(method = \"updateFallState\",\n+        at = @At(value = \"INVOKE\",\n             target = \"Lnet/minecraft/world/server/ServerWorld;spawnParticle(Lnet/minecraft/particles/IParticleData;DDDIDDDD)I\"))\n     private int impl$vanishSpawnParticleForFallState(\n-            final ServerWorld serverWorld, final IParticleData particleTypes, final double xCoord, final double yCoord,\n-            final double zCoord, final int numberOfParticles, final double xOffset, final double yOffset, final double zOffset, final double particleSpeed) {\n+        final ServerWorld serverWorld, final IParticleData particleTypes, final double xCoord, final double yCoord,\n+        final double zCoord, final int numberOfParticles, final double xOffset, final double yOffset,\n+        final double zOffset, final double particleSpeed) {\n         if (!this.bridge$isVanished()) {\n-            serverWorld.spawnParticle(particleTypes, xCoord, yCoord, zCoord, numberOfParticles, xOffset, yOffset, zOffset, particleSpeed);\n+            return serverWorld.spawnParticle(particleTypes, xCoord, yCoord, zCoord, numberOfParticles, xOffset, yOffset, zOffset, particleSpeed);\n         }\n-\n         return 0; // TODO: Is this correct to return 0?\n     }\n \n-    @Inject(method = \"onItemPickup\", at = @At(\"HEAD\"))\n-    public void impl$onEntityItemPickup(final Entity entityItem, final int unused, final CallbackInfo ci) {\n-        if (!this.world.isRemote) {\n-//            EntityUtil.toMixin(entityItem).setDestructCause(Cause.of(NamedCause.of(\"PickedUp\", this)));\n-        }\n-    }\n-\n     @Inject(method = \"onItemUseFinish\",\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;resetActiveHand()V\"))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/LivingEntity;resetActiveHand()V\"))\n     private void impl$updateHealthForUseFinish(final CallbackInfo ci) {\n         if (this instanceof ServerPlayerEntityBridge) {\n             ((ServerPlayerEntityBridge) this).bridge$refreshScaledHealth();\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDI1Mg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234252", "body": "Same here.", "bodyText": "Same here.", "bodyHTML": "<p dir=\"auto\">Same here.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:23:32Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java", "diffHunk": "@@ -901,7 +904,7 @@ private void updateHealthForUseFinish(final CallbackInfo ci) {\n     // Start implementation of UseItemstackEvent\n \n     @Inject(method = \"setActiveHand\", cancellable = true, locals = LocalCapture.CAPTURE_FAILHARD,\n-            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/EntityLivingBase;activeItemStack:Lnet/minecraft/item/ItemStack;\"))\n+            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/LivingEntity;activeItemStack:Lnet/minecraft/item/ItemStack;\"))\n     private void onSetActiveItemStack(final Hand hand, final CallbackInfo ci, final ItemStack stack) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex c276511ea..342cc2a25 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -905,7 +872,7 @@ private void updateHealthForUseFinish(final CallbackInfo ci) {\n \n     @Inject(method = \"setActiveHand\", cancellable = true, locals = LocalCapture.CAPTURE_FAILHARD,\n             at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/LivingEntity;activeItemStack:Lnet/minecraft/item/ItemStack;\"))\n-    private void onSetActiveItemStack(final Hand hand, final CallbackInfo ci, final ItemStack stack) {\n+    private void impl$onSetActiveItemStack(final Hand hand, final CallbackInfo ci, final ItemStack stack) {\n         if (this.world.isRemote) {\n             return;\n         }\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex 342cc2a25..e8a1afcc9 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -871,7 +778,8 @@ public boolean canBeCollidedWith() {\n     // Start implementation of UseItemstackEvent\n \n     @Inject(method = \"setActiveHand\", cancellable = true, locals = LocalCapture.CAPTURE_FAILHARD,\n-            at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/LivingEntity;activeItemStack:Lnet/minecraft/item/ItemStack;\"))\n+            at = @At(value = \"FIELD\",\n+                    target = \"Lnet/minecraft/entity/LivingEntity;activeItemStack:Lnet/minecraft/item/ItemStack;\"))\n     private void impl$onSetActiveItemStack(final Hand hand, final CallbackInfo ci, final ItemStack stack) {\n         if (this.world.isRemote) {\n             return;\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex e8a1afcc9..2156974a8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -777,9 +733,11 @@ public boolean canBeCollidedWith() {\n \n     // Start implementation of UseItemstackEvent\n \n-    @Inject(method = \"setActiveHand\", cancellable = true, locals = LocalCapture.CAPTURE_FAILHARD,\n-            at = @At(value = \"FIELD\",\n-                    target = \"Lnet/minecraft/entity/LivingEntity;activeItemStack:Lnet/minecraft/item/ItemStack;\"))\n+    @Inject(method = \"setActiveHand\",\n+        cancellable = true,\n+        locals = LocalCapture.CAPTURE_FAILHARD,\n+        at = @At(value = \"FIELD\",\n+            target = \"Lnet/minecraft/entity/LivingEntity;activeItemStack:Lnet/minecraft/item/ItemStack;\"))\n     private void impl$onSetActiveItemStack(final Hand hand, final CallbackInfo ci, final ItemStack stack) {\n         if (this.world.isRemote) {\n             return;\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDI4MQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234281", "body": "Same here.", "bodyText": "Same here.", "bodyHTML": "<p dir=\"auto\">Same here.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:23:42Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java", "diffHunk": "@@ -950,7 +953,7 @@ private void addSelfToFrame(final CauseStackManager.StackFrame frame, final Item\n     }\n \n     @Redirect(method = \"updateActiveHand\",\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityLivingBase;getItemInUseCount()I\", ordinal = 0))\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;getItemInUseCount()I\", ordinal = 0))\n     private int onGetRemainingItemDuration(final LivingEntity self) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex c276511ea..342cc2a25 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -954,7 +921,7 @@ private void addSelfToFrame(final CauseStackManager.StackFrame frame, final Item\n \n     @Redirect(method = \"updateActiveHand\",\n             at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;getItemInUseCount()I\", ordinal = 0))\n-    private int onGetRemainingItemDuration(final LivingEntity self) {\n+    private int impl$onGetRemainingItemDuration(final LivingEntity self) {\n         if (this.world.isRemote) {\n             return self.getItemInUseCount();\n         }\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex 342cc2a25..2156974a8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -920,7 +788,9 @@ public boolean canBeCollidedWith() {\n     }\n \n     @Redirect(method = \"updateActiveHand\",\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;getItemInUseCount()I\", ordinal = 0))\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/LivingEntity;getItemInUseCount()I\",\n+            ordinal = 0))\n     private int impl$onGetRemainingItemDuration(final LivingEntity self) {\n         if (this.world.isRemote) {\n             return self.getItemInUseCount();\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDMwNA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234304", "body": "Same here.", "bodyText": "Same here.", "bodyHTML": "<p dir=\"auto\">Same here.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:23:50Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java", "diffHunk": "@@ -982,7 +985,7 @@ private int onGetRemainingItemDuration(final LivingEntity self) {\n \n     @SuppressWarnings(\"ConstantConditions\")\n     @Inject(method = \"onItemUseFinish\", cancellable = true,\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityLivingBase;updateItemUse(Lnet/minecraft/item/ItemStack;I)V\"))\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;updateItemUse(Lnet/minecraft/item/ItemStack;I)V\"))\n     private void onUpdateItemUse(final CallbackInfo ci) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex c276511ea..342cc2a25 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -986,7 +953,7 @@ private int onGetRemainingItemDuration(final LivingEntity self) {\n     @SuppressWarnings(\"ConstantConditions\")\n     @Inject(method = \"onItemUseFinish\", cancellable = true,\n             at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;updateItemUse(Lnet/minecraft/item/ItemStack;I)V\"))\n-    private void onUpdateItemUse(final CallbackInfo ci) {\n+    private void impl$onUpdateItemUse(final CallbackInfo ci) {\n         if (this.world.isRemote) {\n             return;\n         }\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex 342cc2a25..e8a1afcc9 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -952,7 +861,8 @@ public boolean canBeCollidedWith() {\n \n     @SuppressWarnings(\"ConstantConditions\")\n     @Inject(method = \"onItemUseFinish\", cancellable = true,\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;updateItemUse(Lnet/minecraft/item/ItemStack;I)V\"))\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/entity/LivingEntity;updateItemUse(Lnet/minecraft/item/ItemStack;I)V\"))\n     private void impl$onUpdateItemUse(final CallbackInfo ci) {\n         if (this.world.isRemote) {\n             return;\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\nindex e8a1afcc9..2156974a8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/LivingEntityMixin.java\n", "chunk": "@@ -860,9 +821,10 @@ public boolean canBeCollidedWith() {\n     }\n \n     @SuppressWarnings(\"ConstantConditions\")\n-    @Inject(method = \"onItemUseFinish\", cancellable = true,\n-            at = @At(value = \"INVOKE\",\n-                    target = \"Lnet/minecraft/entity/LivingEntity;updateItemUse(Lnet/minecraft/item/ItemStack;I)V\"))\n+    @Inject(method = \"onItemUseFinish\",\n+        cancellable = true,\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/LivingEntity;updateItemUse(Lnet/minecraft/item/ItemStack;I)V\"))\n     private void impl$onUpdateItemUse(final CallbackInfo ci) {\n         if (this.world.isRemote) {\n             return;\n", "next_change": null}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDM1MQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234351", "body": "Fix the prefix, should be `impl$`.", "bodyText": "Fix the prefix, should be impl$.", "bodyHTML": "<p dir=\"auto\">Fix the prefix, should be <code>impl$</code>.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:24:03Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java", "diffHunk": "@@ -72,39 +72,39 @@\n @Mixin(MobEntity.class)\n public abstract class MobEntityMixin extends LivingEntityMixin {\n \n-    @Shadow @Final protected GoalSelector tasks;\n-    @Shadow @Final protected GoalSelector targetTasks;\n+    @Shadow @Final protected GoalSelector goalSelector;\n+    @Shadow @Final protected GoalSelector targetSelector;\n     @Shadow @Nullable private LivingEntity attackTarget;\n \n     @Shadow public abstract boolean isAIDisabled();\n-    @Shadow @Nullable public abstract net.minecraft.entity.Entity getLeashHolder();\n-    @Shadow protected abstract void initEntityAI();\n+    @Shadow @Nullable public abstract net.minecraft.entity.Entity shadow$getLeashHolder();\n+    @Shadow protected abstract void shadow$registerGoals();\n \n-    @Redirect(method = \"<init>\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityLiving;initEntityAI()V\"))\n-    private void spongeImpl$initializeAI(final MobEntity this$0) {\n+    @Redirect(method = \"<init>\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/MobEntity;registerGoals()V\"))\n+    private void spongeImpl$registerGoals(final MobEntity this$0) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\nindex a9ead8c95..fab0d98a1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\n", "chunk": "@@ -81,7 +81,7 @@ public abstract class MobEntityMixin extends LivingEntityMixin {\n     @Shadow protected abstract void shadow$registerGoals();\n \n     @Redirect(method = \"<init>\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/MobEntity;registerGoals()V\"))\n-    private void spongeImpl$registerGoals(final MobEntity this$0) {\n+    private void impl$registerGoals(final MobEntity this$0) {\n         this.initSpongeAI();\n         this.shadow$registerGoals();\n     }\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDQ5MA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234490", "body": "Split out the `target` and `opcode` to new lines for shorter line lengths.", "bodyText": "Split out the target and opcode to new lines for shorter line lengths.", "bodyHTML": "<p dir=\"auto\">Split out the <code>target</code> and <code>opcode</code> to new lines for shorter line lengths.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:24:44Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java", "diffHunk": "@@ -138,10 +138,10 @@ private void callLeashEvent(final PlayerEntity playerIn, final Hand hand, final\n     }\n \n     @Inject(method = \"clearLeashed\",\n-        at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/EntityLiving;isLeashed:Z\", opcode = Opcodes.PUTFIELD),\n+        at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/MobEntity;leashHolder:Lnet/minecraft/entity/Entity;\", opcode = Opcodes.PUTFIELD),", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\nindex a9ead8c95..fab0d98a1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\n", "chunk": "@@ -138,7 +138,10 @@ private void callLeashEvent(final PlayerEntity playerIn, final Hand hand, final\n     }\n \n     @Inject(method = \"clearLeashed\",\n-        at = @At(value = \"FIELD\", target = \"Lnet/minecraft/entity/MobEntity;leashHolder:Lnet/minecraft/entity/Entity;\", opcode = Opcodes.PUTFIELD),\n+        at = @At(value = \"FIELD\",\n+            target = \"Lnet/minecraft/entity/MobEntity;leashHolder:Lnet/minecraft/entity/Entity;\",\n+            opcode = Opcodes.PUTFIELD\n+        ),\n         cancellable = true)\n     private void impl$ThrowUnleashEvent(final boolean sendPacket, final boolean dropLead, final CallbackInfo ci) {\n         final net.minecraft.entity.Entity entity = this.shadow$getLeashHolder();\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDUzMQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234531", "body": "Fix method prefixing..", "bodyText": "Fix method prefixing..", "bodyHTML": "<p dir=\"auto\">Fix method prefixing..</p>", "author": "gabizou", "createdAt": "2020-02-14T03:24:57Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java", "diffHunk": "@@ -267,7 +267,7 @@ public LivingEntity getAttackTarget() {\n      * @param thisEntity\n      * @return\n      */\n-    @Redirect(method = \"onLivingUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityLiving;canPickUpLoot()Z\"))\n+    @Redirect(method = \"livingTick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/MobEntity;canPickUpLoot()Z\"))\n     private boolean onCanGrief(final MobEntity thisEntity) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\nindex a9ead8c95..fab0d98a1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/MobEntityMixin.java\n", "chunk": "@@ -268,7 +271,7 @@ public LivingEntity getAttackTarget() {\n      * @return\n      */\n     @Redirect(method = \"livingTick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/MobEntity;canPickUpLoot()Z\"))\n-    private boolean onCanGrief(final MobEntity thisEntity) {\n+    private boolean impl$onCanGrief(final MobEntity thisEntity) {\n         return thisEntity.canPickUpLoot() && ((GrieferBridge) this).bridge$canGrief();\n     }\n \n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDYyMw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234623", "body": "Fix the prefix to `impl`", "bodyText": "Fix the prefix to impl", "bodyHTML": "<p dir=\"auto\">Fix the prefix to <code>impl</code></p>", "author": "gabizou", "createdAt": "2020-02-14T03:25:26Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java", "diffHunk": "@@ -63,8 +63,8 @@\n         return this.spongeImpl$strikeBlockAndAddSnapshot(world, pos, blockState);\n     }\n \n-    @Redirect(method = \"onUpdate()V\", at = @At(value = \"INVOKE\",\n-            target = \"Lnet/minecraft/world/World;setBlockState(Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/state/IBlockState;)Z\"))\n+    @Redirect(method = \"igniteBlocks(I)V\", at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;setBlockState(Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/BlockState;)Z\"))\n     private boolean spongeImpl$throwEventForChangingBlockDuringUpdate(final net.minecraft.world.World world, final BlockPos pos, final BlockState blockState) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java\nindex b0cdbce0e..792b71cb2 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java\n", "chunk": "@@ -59,17 +59,17 @@ public abstract class LightningBoltEntityMixin extends EntityMixin {\n \n     @Redirect(method = \"<init>\", at = @At(value = \"INVOKE\",\n             target = \"Lnet/minecraft/world/World;setBlockState(Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/state/IBlockState;)Z\"))\n-    private boolean spongeImpl$throwEventForChangingBlocks(final net.minecraft.world.World world, final BlockPos pos, final BlockState blockState) {\n-        return this.spongeImpl$strikeBlockAndAddSnapshot(world, pos, blockState);\n+    private boolean impl$throwEventForChangingBlocks(final net.minecraft.world.World world, final BlockPos pos, final BlockState blockState) {\n+        return this.impl$strikeBlockAndAddSnapshot(world, pos, blockState);\n     }\n \n     @Redirect(method = \"igniteBlocks(I)V\", at = @At(value = \"INVOKE\",\n             target = \"Lnet/minecraft/world/World;setBlockState(Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/BlockState;)Z\"))\n-    private boolean spongeImpl$throwEventForChangingBlockDuringUpdate(final net.minecraft.world.World world, final BlockPos pos, final BlockState blockState) {\n-        return this.spongeImpl$strikeBlockAndAddSnapshot(world, pos, blockState);\n+    private boolean impl$throwEventForChangingBlockDuringUpdate(final net.minecraft.world.World world, final BlockPos pos, final BlockState blockState) {\n+        return this.impl$strikeBlockAndAddSnapshot(world, pos, blockState);\n     }\n \n-    private boolean spongeImpl$strikeBlockAndAddSnapshot(final net.minecraft.world.World world, final BlockPos pos, final BlockState blockState) {\n+    private boolean impl$strikeBlockAndAddSnapshot(final net.minecraft.world.World world, final BlockPos pos, final BlockState blockState) {\n         if (!this.effect && ((World) world).containsBlock(pos.getX(), pos.getY(), pos.getZ())) {\n             final Vector3i pos3i = VecHelper.toVector3i(pos);\n             final Transaction<BlockSnapshot> transaction = new Transaction<>(\n", "next_change": {"commit": "d54e74d7e323bdd8673afe7d2e963fe72976a4d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java\nindex 792b71cb2..5fff98280 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/effect/LightningBoltEntityMixin.java\n", "chunk": "@@ -70,7 +71,7 @@ public abstract class LightningBoltEntityMixin extends EntityMixin {\n     }\n \n     private boolean impl$strikeBlockAndAddSnapshot(final net.minecraft.world.World world, final BlockPos pos, final BlockState blockState) {\n-        if (!this.effect && ((World) world).containsBlock(pos.getX(), pos.getY(), pos.getZ())) {\n+        if (!this.impl$effect && ((World) world).containsBlock(pos.getX(), pos.getY(), pos.getZ())) {\n             final Vector3i pos3i = VecHelper.toVector3i(pos);\n             final Transaction<BlockSnapshot> transaction = new Transaction<>(\n                 SpongeBlockSnapshotBuilder.pooled()\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDc5OA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234798", "body": "Just leave a comment at the end what the func should be called..", "bodyText": "Just leave a comment at the end what the func should be called..", "bodyHTML": "<p dir=\"auto\">Just leave a comment at the end what the func should be called..</p>", "author": "gabizou", "createdAt": "2020-02-14T03:26:12Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java", "diffHunk": "@@ -49,7 +49,7 @@\n @Mixin(ArmorStandEntity.class)\n public abstract class ArmorStandEntityMixin extends LivingEntityMixin {\n \n-    @Shadow protected abstract void damageArmorStand(float damage);\n+    @Shadow protected abstract void shadow$func_213817_e(DamageSource damageSource, float damage);", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 4297bdd07..6a2133652 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -49,7 +49,7 @@\n @Mixin(ArmorStandEntity.class)\n public abstract class ArmorStandEntityMixin extends LivingEntityMixin {\n \n-    @Shadow protected abstract void shadow$func_213817_e(DamageSource damageSource, float damage);\n+    @Shadow protected abstract void shadow$func_213817_e(DamageSource damageSource, float damage); // damageArmorStand\n \n     /**\n      * The return value is set to false if the entity should not be completely\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 6a2133652..844649d2e 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -58,12 +58,12 @@ public abstract class ArmorStandEntityMixin extends LivingEntityMixin {\n     private void fireDestroyDamageEvent(final DamageSource source, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n-            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(Sponge.getCauseStackManager().getCurrentCause(), new ArrayList<>(),\n-                (Entity) this, Math.max(1000, this.getHealth()));\n+            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(),\n+                (Entity) this, new ArrayList<>(), Math.max(1000, this.shadow$getHealth()));\n             if (SpongeImpl.postEvent(event)) {\n                 cir.setReturnValue(false);\n             }\n-            if (event.getFinalDamage() < this.getHealth()) {\n+            if (event.getFinalDamage() < this.shadow$getHealth()) {\n                 this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n                 cir.setReturnValue(false);\n             }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDkzOQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234939", "body": "Don't change from `Lclass/path;method()return`, keep it prefixed with `L` and split the method with `;`", "bodyText": "Don't change from Lclass/path;method()return, keep it prefixed with L and split the method with ;", "bodyHTML": "<p dir=\"auto\">Don't change from <code>Lclass/path;method()return</code>, keep it prefixed with <code>L</code> and split the method with <code>;</code></p>", "author": "gabizou", "createdAt": "2020-02-14T03:26:48Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java", "diffHunk": "@@ -64,49 +64,49 @@ private void fireDestroyDamageEvent(final DamageSource source, final CallbackInf\n                 cir.setReturnValue(false);\n             }\n             if (event.getFinalDamage() < this.getHealth()) {\n-                this.damageArmorStand((float) event.getFinalDamage());\n+                this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n                 cir.setReturnValue(false);\n             }\n         }\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"FIELD\", target = \"Lnet/minecraft/util/DamageSource;OUT_OF_WORLD:Lnet/minecraft/util/DamageSource;\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;setDead()V\", ordinal = 0),\n+            at = @At(value = \"INVOKE\", target = \"net/minecraft/entity/item/ArmorStandEntity.remove()V\", ordinal = 0),", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzOTAxMA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379239010", "bodyText": "Well that atleast explains why MC dev was confused. Copying from bytecode a little too liberally", "author": "i509VCB", "createdAt": "2020-02-14T03:49:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDkzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzOTUyMA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379239520", "bodyText": "It's supported to use non L prefixed syntax, but you would need to change / to . from what I remember.", "author": "gabizou", "createdAt": "2020-02-14T03:51:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDkzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzOTY0MA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379239640", "bodyText": "It's also why we chose to stick with L format, because it's abundantly clear where the class definition ends and method/field name begin.", "author": "gabizou", "createdAt": "2020-02-14T03:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDkzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 4297bdd07..6a2133652 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -72,22 +72,25 @@ private void fireDestroyDamageEvent(final DamageSource source, final CallbackInf\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"FIELD\", target = \"Lnet/minecraft/util/DamageSource;OUT_OF_WORLD:Lnet/minecraft/util/DamageSource;\")),\n-            at = @At(value = \"INVOKE\", target = \"net/minecraft/entity/item/ArmorStandEntity.remove()V\", ordinal = 0),\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;remove()V\", ordinal = 0),\n             cancellable = true)\n     private void fireDamageEventOutOfWorld(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n-            slice = @Slice(from = @At(value = \"INVOKE\", target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n+            slice = @Slice(from = @At(value = \"INVOKE\",\n+                target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")\n+            ),\n+            at = @At(value = \"INVOKE\",\n+                target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n             cancellable = true)\n-    private void fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    private void impl$fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Redirect(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213817_e(Lnet/minecraft/util/DamageSource;F)V\"))\n-    private void fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n+    private void impl$fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n             final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 6a2133652..844649d2e 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -93,8 +93,8 @@ private void fireDamageEventOutOfWorld(final DamageSource source, final float am\n     private void impl$fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n-            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n-                (Entity) this, amount);\n+            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(),\n+                (Entity) this, new ArrayList<>(), amount);\n             if (!SpongeImpl.postEvent(event)) {\n                 this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n             }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNDk4NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379234985", "body": "Fix this method with the prefix.", "bodyText": "Fix this method with the prefix.", "bodyHTML": "<p dir=\"auto\">Fix this method with the prefix.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:27:03Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java", "diffHunk": "@@ -64,49 +64,49 @@ private void fireDestroyDamageEvent(final DamageSource source, final CallbackInf\n                 cir.setReturnValue(false);\n             }\n             if (event.getFinalDamage() < this.getHealth()) {\n-                this.damageArmorStand((float) event.getFinalDamage());\n+                this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n                 cir.setReturnValue(false);\n             }\n         }\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"FIELD\", target = \"Lnet/minecraft/util/DamageSource;OUT_OF_WORLD:Lnet/minecraft/util/DamageSource;\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;setDead()V\", ordinal = 0),\n+            at = @At(value = \"INVOKE\", target = \"net/minecraft/entity/item/ArmorStandEntity.remove()V\", ordinal = 0),\n             cancellable = true)\n     private void fireDamageEventOutOfWorld(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"INVOKE\", target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;dropContents()V\"),\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n             cancellable = true)\n     private void fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 4297bdd07..6a2133652 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -72,22 +72,25 @@ private void fireDestroyDamageEvent(final DamageSource source, final CallbackInf\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"FIELD\", target = \"Lnet/minecraft/util/DamageSource;OUT_OF_WORLD:Lnet/minecraft/util/DamageSource;\")),\n-            at = @At(value = \"INVOKE\", target = \"net/minecraft/entity/item/ArmorStandEntity.remove()V\", ordinal = 0),\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;remove()V\", ordinal = 0),\n             cancellable = true)\n     private void fireDamageEventOutOfWorld(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n-            slice = @Slice(from = @At(value = \"INVOKE\", target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n+            slice = @Slice(from = @At(value = \"INVOKE\",\n+                target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")\n+            ),\n+            at = @At(value = \"INVOKE\",\n+                target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n             cancellable = true)\n-    private void fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    private void impl$fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Redirect(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213817_e(Lnet/minecraft/util/DamageSource;F)V\"))\n-    private void fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n+    private void impl$fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n             final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 6a2133652..844649d2e 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -93,8 +93,8 @@ private void fireDamageEventOutOfWorld(final DamageSource source, final float am\n     private void impl$fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n-            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n-                (Entity) this, amount);\n+            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(),\n+                (Entity) this, new ArrayList<>(), amount);\n             if (!SpongeImpl.postEvent(event)) {\n                 this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n             }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTAyNg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235026", "body": "Multiline this annotation, it's too long now.", "bodyText": "Multiline this annotation, it's too long now.", "bodyHTML": "<p dir=\"auto\">Multiline this annotation, it's too long now.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:27:18Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java", "diffHunk": "@@ -64,49 +64,49 @@ private void fireDestroyDamageEvent(final DamageSource source, final CallbackInf\n                 cir.setReturnValue(false);\n             }\n             if (event.getFinalDamage() < this.getHealth()) {\n-                this.damageArmorStand((float) event.getFinalDamage());\n+                this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n                 cir.setReturnValue(false);\n             }\n         }\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"FIELD\", target = \"Lnet/minecraft/util/DamageSource;OUT_OF_WORLD:Lnet/minecraft/util/DamageSource;\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;setDead()V\", ordinal = 0),\n+            at = @At(value = \"INVOKE\", target = \"net/minecraft/entity/item/ArmorStandEntity.remove()V\", ordinal = 0),\n             cancellable = true)\n     private void fireDamageEventOutOfWorld(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"INVOKE\", target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;dropContents()V\"),\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n             cancellable = true)\n     private void fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n-    @Redirect(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;damageArmorStand(F)V\"))\n-    private void fireDamageEventDamage(final ArmorStandEntity self, final float effectiveAmount, final DamageSource source, final float originalAmount) {\n+    @Redirect(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213817_e(Lnet/minecraft/util/DamageSource;F)V\"))", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 4297bdd07..6a2133652 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -72,22 +72,25 @@ private void fireDestroyDamageEvent(final DamageSource source, final CallbackInf\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"FIELD\", target = \"Lnet/minecraft/util/DamageSource;OUT_OF_WORLD:Lnet/minecraft/util/DamageSource;\")),\n-            at = @At(value = \"INVOKE\", target = \"net/minecraft/entity/item/ArmorStandEntity.remove()V\", ordinal = 0),\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;remove()V\", ordinal = 0),\n             cancellable = true)\n     private void fireDamageEventOutOfWorld(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n-            slice = @Slice(from = @At(value = \"INVOKE\", target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n+            slice = @Slice(from = @At(value = \"INVOKE\",\n+                target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")\n+            ),\n+            at = @At(value = \"INVOKE\",\n+                target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n             cancellable = true)\n-    private void fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    private void impl$fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Redirect(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213817_e(Lnet/minecraft/util/DamageSource;F)V\"))\n-    private void fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n+    private void impl$fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n             final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 6a2133652..844649d2e 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -93,8 +93,8 @@ private void fireDamageEventOutOfWorld(final DamageSource source, final float am\n     private void impl$fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n-            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n-                (Entity) this, amount);\n+            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(),\n+                (Entity) this, new ArrayList<>(), amount);\n             if (!SpongeImpl.postEvent(event)) {\n                 this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n             }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTA1OQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235059", "body": "Change the prefix with `impl$`.", "bodyText": "Change the prefix with impl$.", "bodyHTML": "<p dir=\"auto\">Change the prefix with <code>impl$</code>.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:27:31Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java", "diffHunk": "@@ -64,49 +64,49 @@ private void fireDestroyDamageEvent(final DamageSource source, final CallbackInf\n                 cir.setReturnValue(false);\n             }\n             if (event.getFinalDamage() < this.getHealth()) {\n-                this.damageArmorStand((float) event.getFinalDamage());\n+                this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n                 cir.setReturnValue(false);\n             }\n         }\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"FIELD\", target = \"Lnet/minecraft/util/DamageSource;OUT_OF_WORLD:Lnet/minecraft/util/DamageSource;\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;setDead()V\", ordinal = 0),\n+            at = @At(value = \"INVOKE\", target = \"net/minecraft/entity/item/ArmorStandEntity.remove()V\", ordinal = 0),\n             cancellable = true)\n     private void fireDamageEventOutOfWorld(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"INVOKE\", target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;dropContents()V\"),\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n             cancellable = true)\n     private void fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n-    @Redirect(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;damageArmorStand(F)V\"))\n-    private void fireDamageEventDamage(final ArmorStandEntity self, final float effectiveAmount, final DamageSource source, final float originalAmount) {\n+    @Redirect(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213817_e(Lnet/minecraft/util/DamageSource;F)V\"))\n+    private void fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 4297bdd07..6a2133652 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -72,22 +72,25 @@ private void fireDestroyDamageEvent(final DamageSource source, final CallbackInf\n \n     @Inject(method = \"attackEntityFrom\",\n             slice = @Slice(from = @At(value = \"FIELD\", target = \"Lnet/minecraft/util/DamageSource;OUT_OF_WORLD:Lnet/minecraft/util/DamageSource;\")),\n-            at = @At(value = \"INVOKE\", target = \"net/minecraft/entity/item/ArmorStandEntity.remove()V\", ordinal = 0),\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;remove()V\", ordinal = 0),\n             cancellable = true)\n     private void fireDamageEventOutOfWorld(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Inject(method = \"attackEntityFrom\",\n-            slice = @Slice(from = @At(value = \"INVOKE\", target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")),\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n+            slice = @Slice(from = @At(value = \"INVOKE\",\n+                target = \"Lnet/minecraft/util/DamageSource;isExplosion()Z\")\n+            ),\n+            at = @At(value = \"INVOKE\",\n+                target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213816_g(Lnet/minecraft/util/DamageSource;)V\"),\n             cancellable = true)\n-    private void fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    private void impl$fireDamageEventExplosion(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n \n     @Redirect(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213817_e(Lnet/minecraft/util/DamageSource;F)V\"))\n-    private void fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n+    private void impl$fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n             final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 6a2133652..844649d2e 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -93,8 +93,8 @@ private void fireDamageEventOutOfWorld(final DamageSource source, final float am\n     private void impl$fireDamageEventDamage(final ArmorStandEntity self, final DamageSource source, final float amount) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             DamageEventHandler.generateCauseFor(source, frame);\n-            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n-                (Entity) this, amount);\n+            final DamageEntityEvent event = SpongeEventFactory.createDamageEntityEvent(frame.getCurrentCause(),\n+                (Entity) this, new ArrayList<>(), amount);\n             if (!SpongeImpl.postEvent(event)) {\n                 this.shadow$func_213817_e(source, (float) event.getFinalDamage());\n             }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTEwNw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235107", "body": "Too long, multi-line the annotation.", "bodyText": "Too long, multi-line the annotation.", "bodyHTML": "<p dir=\"auto\">Too long, multi-line the annotation.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:27:45Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java", "diffHunk": "@@ -122,7 +122,7 @@ private void fireDamageEventFirstPunch(final DamageSource source, final float am\n         }\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityArmorStand;dropBlock()V\"),\n+    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213815_f(Lnet/minecraft/util/DamageSource;)V\"),", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 4297bdd07..6a2133652 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -122,8 +125,11 @@ private void fireDamageEventFirstPunch(final DamageSource source, final float am\n         }\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213815_f(Lnet/minecraft/util/DamageSource;)V\"),\n-            cancellable = true)\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/ArmorStandEntity;func_213815_f(Lnet/minecraft/util/DamageSource;)V\"\n+        ),\n+        cancellable = true)\n     private void fireDamageEventSecondPunch(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         this.fireDestroyDamageEvent(source, cir);\n     }\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\nindex 6a2133652..844649d2e 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ArmorStandEntityMixin.java\n", "chunk": "@@ -138,8 +138,7 @@ private void fireDamageEventSecondPunch(final DamageSource source, final float a\n      * @author JBYoshi\n      * @reason EntityArmorStand \"simplifies\" this method to simply call {@link\n      * #shadow$remove()}. However, this ignores our custom event. Instead, delegate\n-     * to the superclass and use {@link\n-     * EntityArmorStand#attackEntityFrom(DamageSource, float)}.\n+     * to the superclass and use {@link ArmorStandEntity#attackEntityFrom(DamageSource, float)}.\n      */\n     @Overwrite\n     @Override\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTMwMA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235300", "body": "It's returning an `Entity`, not `DimensionType`. ", "bodyText": "It's returning an Entity, not DimensionType.", "bodyHTML": "<p dir=\"auto\">It's returning an <code>Entity</code>, not <code>DimensionType</code>.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:28:32Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java", "diffHunk": "@@ -96,11 +97,13 @@ private boolean onEnderPearlImpact(final ServerPlayerEntity player) {\n \n     /**\n      * @author Zidane - June 2019 - 1.12.2\n+     * @author i509VCB - Feb 2020 - 1.14.4\n      * @reason Only have this ender pearl remove the thrower references if we actually changed dimension\n+     * @return Change to use DimensionType", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java\nindex c362081ad..2526cdd87 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java\n", "chunk": "@@ -82,34 +82,33 @@ private boolean onEnderPearlImpact(final ServerPlayerEntity player) {\n     }\n \n     @Override\n-    public void spongeImpl$readFromSpongeCompound(final CompoundNBT compound) {\n-        super.spongeImpl$readFromSpongeCompound(compound);\n+    public void impl$readFromSpongeCompound(final CompoundNBT compound) {\n+        super.impl$readFromSpongeCompound(compound);\n         if (compound.contains(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT)) {\n-            this.damageAmount = compound.getDouble(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT);\n+            this.impl$damageAmount = compound.getDouble(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT);\n         }\n     }\n \n     @Override\n-    public void spongeImpl$writeToSpongeCompound(final CompoundNBT compound) {\n-        super.spongeImpl$writeToSpongeCompound(compound);\n-        compound.putDouble(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT, this.damageAmount);\n+    public void impl$writeToSpongeCompound(final CompoundNBT compound) {\n+        super.impl$writeToSpongeCompound(compound);\n+        compound.putDouble(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT, this.impl$damageAmount);\n     }\n \n     /**\n      * @author Zidane - June 2019 - 1.12.2\n      * @author i509VCB - Feb 2020 - 1.14.4\n      * @reason Only have this ender pearl remove the thrower references if we actually changed dimension\n-     * @return Change to use DimensionType\n      */\n     @Override\n     @Nullable\n-    public Entity changeDimension(DimensionType dimensionIn) {\n-        final Entity entity = super.changeDimension(dimensionIn);\n+    public Entity shadow$changeDimension(DimensionType dimensionIn) {\n+        final Entity entity = super.shadow$changeDimension(dimensionIn);\n \n         if (entity instanceof EnderPearlEntity) {\n             // We actually teleported so...\n             this.perlThrower = null;\n-            this.thrower = null;\n+            this.owner = null;\n         }\n \n         return entity;\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTQwMg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235402", "body": "Is this a vanilla method, or sponge-added method? If it's a vanilla method, and it's overriding a `@Shadow`'ed method, it should be prefixed appropriately", "bodyText": "Is this a vanilla method, or sponge-added method? If it's a vanilla method, and it's overriding a @Shadow'ed method, it should be prefixed appropriately", "bodyHTML": "<p dir=\"auto\">Is this a vanilla method, or sponge-added method? If it's a vanilla method, and it's overriding a <code>@Shadow</code>'ed method, it should be prefixed appropriately</p>", "author": "gabizou", "createdAt": "2020-02-14T03:29:12Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java", "diffHunk": "@@ -96,11 +97,13 @@ private boolean onEnderPearlImpact(final ServerPlayerEntity player) {\n \n     /**\n      * @author Zidane - June 2019 - 1.12.2\n+     * @author i509VCB - Feb 2020 - 1.14.4\n      * @reason Only have this ender pearl remove the thrower references if we actually changed dimension\n+     * @return Change to use DimensionType\n      */\n     @Override\n     @Nullable\n-    public Entity changeDimension(final int dimensionIn) {\n+    public Entity changeDimension(DimensionType dimensionIn) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java\nindex c362081ad..2526cdd87 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/EnderPearlEntityMixin.java\n", "chunk": "@@ -82,34 +82,33 @@ private boolean onEnderPearlImpact(final ServerPlayerEntity player) {\n     }\n \n     @Override\n-    public void spongeImpl$readFromSpongeCompound(final CompoundNBT compound) {\n-        super.spongeImpl$readFromSpongeCompound(compound);\n+    public void impl$readFromSpongeCompound(final CompoundNBT compound) {\n+        super.impl$readFromSpongeCompound(compound);\n         if (compound.contains(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT)) {\n-            this.damageAmount = compound.getDouble(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT);\n+            this.impl$damageAmount = compound.getDouble(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT);\n         }\n     }\n \n     @Override\n-    public void spongeImpl$writeToSpongeCompound(final CompoundNBT compound) {\n-        super.spongeImpl$writeToSpongeCompound(compound);\n-        compound.putDouble(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT, this.damageAmount);\n+    public void impl$writeToSpongeCompound(final CompoundNBT compound) {\n+        super.impl$writeToSpongeCompound(compound);\n+        compound.putDouble(Constants.Sponge.Entity.Projectile.PROJECTILE_DAMAGE_AMOUNT, this.impl$damageAmount);\n     }\n \n     /**\n      * @author Zidane - June 2019 - 1.12.2\n      * @author i509VCB - Feb 2020 - 1.14.4\n      * @reason Only have this ender pearl remove the thrower references if we actually changed dimension\n-     * @return Change to use DimensionType\n      */\n     @Override\n     @Nullable\n-    public Entity changeDimension(DimensionType dimensionIn) {\n-        final Entity entity = super.changeDimension(dimensionIn);\n+    public Entity shadow$changeDimension(DimensionType dimensionIn) {\n+        final Entity entity = super.shadow$changeDimension(dimensionIn);\n \n         if (entity instanceof EnderPearlEntity) {\n             // We actually teleported so...\n             this.perlThrower = null;\n-            this.thrower = null;\n+            this.owner = null;\n         }\n \n         return entity;\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTQ4NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235485", "body": "Fix the method prefix and method name, `onExplode` makes little to no sense of what it's doing.", "bodyText": "Fix the method prefix and method name, onExplode makes little to no sense of what it's doing.", "bodyHTML": "<p dir=\"auto\">Fix the method prefix and method name, <code>onExplode</code> makes little to no sense of what it's doing.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:29:45Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java", "diffHunk": "@@ -111,7 +111,7 @@\n     }\n \n     @SuppressWarnings(\"deprecation\")\n-    @Redirect(method = \"onUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;setEntityState\"\n+    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;setEntityState\"\n                                                                        + \"(Lnet/minecraft/entity/Entity;B)V\"))\n     private void onExplode(final World world, final Entity self, final byte state) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\nindex 9797caa6f..3c5d77aa4 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n", "chunk": "@@ -111,9 +111,11 @@ public abstract class FireworkRocketEntityMixin extends EntityMixin implements F\n     }\n \n     @SuppressWarnings(\"deprecation\")\n-    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;setEntityState\"\n-                                                                       + \"(Lnet/minecraft/entity/Entity;B)V\"))\n-    private void onExplode(final World world, final Entity self, final byte state) {\n+    @Redirect(method = \"func_213893_k()V\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;setEntityState(Lnet/minecraft/entity/Entity;B)V\")\n+    )\n+    private void impl$onExplosionDamage(final World world, final Entity self, final byte state) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             // Fireworks don't typically explode like other explosives, but we'll\n             // post an event regardless and if the radius is zero the explosion\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\nindex 3c5d77aa4..4380172c1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n", "chunk": "@@ -121,8 +122,7 @@ public abstract class FireworkRocketEntityMixin extends EntityMixin implements F\n             // post an event regardless and if the radius is zero the explosion\n             // won't be triggered (the default behavior).\n             frame.pushCause(this);\n-            frame.addContext(EventContextKeys.THROWER, ((FireworkRocket) this).getShooter()); // TODO - Remove in 1.13/API 8\n-            frame.addContext(EventContextKeys.PROJECTILE_SOURCE, ((FireworkRocket) this).getShooter());\n+            frame.addContext(EventContextKeys.PROJECTILE_SOURCE, this.impl$projectileSource);\n             SpongeCommonEventFactory.detonateExplosive(this, Explosion.builder()\n                 .sourceExplosive(((FireworkRocket) this))\n                 .location(((FireworkRocket) this).getLocation())\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTU0Mg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235542", "body": "Unify the string target value and multi-line the annotation instead.", "bodyText": "Unify the string target value and multi-line the annotation instead.", "bodyHTML": "<p dir=\"auto\">Unify the string target value and multi-line the annotation instead.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:30:08Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java", "diffHunk": "@@ -111,7 +111,7 @@\n     }\n \n     @SuppressWarnings(\"deprecation\")\n-    @Redirect(method = \"onUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;setEntityState\"\n+    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;setEntityState\"", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\nindex 9797caa6f..3c5d77aa4 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n", "chunk": "@@ -111,9 +111,11 @@ public abstract class FireworkRocketEntityMixin extends EntityMixin implements F\n     }\n \n     @SuppressWarnings(\"deprecation\")\n-    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;setEntityState\"\n-                                                                       + \"(Lnet/minecraft/entity/Entity;B)V\"))\n-    private void onExplode(final World world, final Entity self, final byte state) {\n+    @Redirect(method = \"func_213893_k()V\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/world/World;setEntityState(Lnet/minecraft/entity/Entity;B)V\")\n+    )\n+    private void impl$onExplosionDamage(final World world, final Entity self, final byte state) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             // Fireworks don't typically explode like other explosives, but we'll\n             // post an event regardless and if the radius is zero the explosion\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\nindex 3c5d77aa4..4380172c1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n", "chunk": "@@ -121,8 +122,7 @@ public abstract class FireworkRocketEntityMixin extends EntityMixin implements F\n             // post an event regardless and if the radius is zero the explosion\n             // won't be triggered (the default behavior).\n             frame.pushCause(this);\n-            frame.addContext(EventContextKeys.THROWER, ((FireworkRocket) this).getShooter()); // TODO - Remove in 1.13/API 8\n-            frame.addContext(EventContextKeys.PROJECTILE_SOURCE, ((FireworkRocket) this).getShooter());\n+            frame.addContext(EventContextKeys.PROJECTILE_SOURCE, this.impl$projectileSource);\n             SpongeCommonEventFactory.detonateExplosive(this, Explosion.builder()\n                 .sourceExplosive(((FireworkRocket) this))\n                 .location(((FireworkRocket) this).getLocation())\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTU3MA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235570", "body": "Fix the method prefix and name.", "bodyText": "Fix the method prefix and name.", "bodyHTML": "<p dir=\"auto\">Fix the method prefix and name.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:30:18Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java", "diffHunk": "@@ -130,7 +130,7 @@ private void onExplode(final World world, final Entity self, final byte state) {\n     }\n \n     @SuppressWarnings(\"deprecation\")\n-    @Inject(method = \"onUpdate\", at = @At(\"RETURN\"))\n+    @Inject(method = \"tick()V\", at = @At(\"RETURN\"))\n     private void onUpdate(final CallbackInfo ci) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\nindex 9797caa6f..3c5d77aa4 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n", "chunk": "@@ -131,7 +133,7 @@ private void onExplode(final World world, final Entity self, final byte state) {\n \n     @SuppressWarnings(\"deprecation\")\n     @Inject(method = \"tick()V\", at = @At(\"RETURN\"))\n-    private void onUpdate(final CallbackInfo ci) {\n+    private void impl$postPrimeEvent(final CallbackInfo ci) {\n         if (this.fireworkAge == 1 && !this.world.isRemote) {\n             try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n                 frame.pushCause(this);\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\nindex 3c5d77aa4..4380172c1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/FireworkRocketEntityMixin.java\n", "chunk": "@@ -137,8 +137,7 @@ public abstract class FireworkRocketEntityMixin extends EntityMixin implements F\n         if (this.fireworkAge == 1 && !this.world.isRemote) {\n             try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n                 frame.pushCause(this);\n-                frame.addContext(EventContextKeys.THROWER, ((FireworkRocket) this).getShooter()); // TODO - Remove in 1.13/API 8\n-                frame.addContext(EventContextKeys.PROJECTILE_SOURCE, ((FireworkRocket) this).getShooter());\n+                frame.addContext(EventContextKeys.PROJECTILE_SOURCE, this.impl$projectileSource);\n                 this.bridge$postPrime();\n             }\n         }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTYyNw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235627", "body": "Prefix with `impl$`.", "bodyText": "Prefix with impl$.", "bodyHTML": "<p dir=\"auto\">Prefix with <code>impl$</code>.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:30:34Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java", "diffHunk": "@@ -55,33 +55,33 @@\n public abstract class HangingEntityMixin extends EntityMixin {\n \n     @Shadow @Nullable public Direction facingDirection;\n-    @Shadow public abstract boolean onValidSurface();\n+    @Shadow public abstract boolean shadow$onValidSurface();\n \n-    private boolean ignorePhysics = false;\n+    private boolean impl$ignorePhysics = false;\n \n     /**\n      * Called to update the entity's position/logic.\n      */\n-    @Redirect(method = \"onUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityHanging;onValidSurface()Z\"))\n+    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;onValidSurface()Z\"))\n     private boolean checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\nindex d801ac935..e99ad292a 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n", "chunk": "@@ -63,26 +63,31 @@ public abstract class HangingEntityMixin extends EntityMixin {\n      * Called to update the entity's position/logic.\n      */\n     @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;onValidSurface()Z\"))\n-    private boolean checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {\n+    private boolean impl$checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {\n         return this.shadow$onValidSurface() && !this.impl$ignorePhysics;\n     }\n \n     @Override\n-    public void spongeImpl$writeToSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$writeToSpongeCompound(compound);\n+    public void impl$writeToSpongeCompound(CompoundNBT compound) {\n+        super.impl$writeToSpongeCompound(compound);\n         compound.putBoolean(\"ignorePhysics\", this.impl$ignorePhysics);\n     }\n \n     @Override\n-    public void spongeImpl$readFromSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$readFromSpongeCompound(compound);\n+    public void impl$readFromSpongeCompound(CompoundNBT compound) {\n+        super.impl$readFromSpongeCompound(compound);\n         if (compound.contains(\"ignorePhysics\")) {\n             this.impl$ignorePhysics = compound.getBoolean(\"ignorePhysics\");\n         }\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;remove()V\"), cancellable = true)\n-    private void onAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/HangingEntity;remove()V\"\n+        ),\n+        cancellable = true\n+    )\n+    private void impl$postEventOnAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n         try (CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n             AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Entity) this, 0, amount);\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\nindex e99ad292a..60021926d 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n", "chunk": "@@ -87,10 +89,12 @@ public abstract class HangingEntityMixin extends EntityMixin {\n         ),\n         cancellable = true\n     )\n-    private void impl$postEventOnAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n-        try (CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+    private void impl$postEventOnAttackEntityFrom(final DamageSource source, final float amount,\n+        final CallbackInfoReturnable<Boolean> cir) {\n+        try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n-            AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Entity) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(),\n+                (Entity) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTY4Mg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235682", "body": "s/`spongeImpl`/`impl`", "bodyText": "s/spongeImpl/impl", "bodyHTML": "<p dir=\"auto\">s/<code>spongeImpl</code>/<code>impl</code></p>", "author": "gabizou", "createdAt": "2020-02-14T03:30:50Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java", "diffHunk": "@@ -55,33 +55,33 @@\n public abstract class HangingEntityMixin extends EntityMixin {\n \n     @Shadow @Nullable public Direction facingDirection;\n-    @Shadow public abstract boolean onValidSurface();\n+    @Shadow public abstract boolean shadow$onValidSurface();\n \n-    private boolean ignorePhysics = false;\n+    private boolean impl$ignorePhysics = false;\n \n     /**\n      * Called to update the entity's position/logic.\n      */\n-    @Redirect(method = \"onUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityHanging;onValidSurface()Z\"))\n+    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;onValidSurface()Z\"))\n     private boolean checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {\n-        return this.onValidSurface() && !this.ignorePhysics;\n+        return this.shadow$onValidSurface() && !this.impl$ignorePhysics;\n     }\n \n     @Override\n     public void spongeImpl$writeToSpongeCompound(CompoundNBT compound) {\n         super.spongeImpl$writeToSpongeCompound(compound);\n-        compound.putBoolean(\"ignorePhysics\", this.ignorePhysics);\n+        compound.putBoolean(\"ignorePhysics\", this.impl$ignorePhysics);\n     }\n \n     @Override\n     public void spongeImpl$readFromSpongeCompound(CompoundNBT compound) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\nindex d801ac935..e99ad292a 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n", "chunk": "@@ -63,26 +63,31 @@ public abstract class HangingEntityMixin extends EntityMixin {\n      * Called to update the entity's position/logic.\n      */\n     @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;onValidSurface()Z\"))\n-    private boolean checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {\n+    private boolean impl$checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {\n         return this.shadow$onValidSurface() && !this.impl$ignorePhysics;\n     }\n \n     @Override\n-    public void spongeImpl$writeToSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$writeToSpongeCompound(compound);\n+    public void impl$writeToSpongeCompound(CompoundNBT compound) {\n+        super.impl$writeToSpongeCompound(compound);\n         compound.putBoolean(\"ignorePhysics\", this.impl$ignorePhysics);\n     }\n \n     @Override\n-    public void spongeImpl$readFromSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$readFromSpongeCompound(compound);\n+    public void impl$readFromSpongeCompound(CompoundNBT compound) {\n+        super.impl$readFromSpongeCompound(compound);\n         if (compound.contains(\"ignorePhysics\")) {\n             this.impl$ignorePhysics = compound.getBoolean(\"ignorePhysics\");\n         }\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;remove()V\"), cancellable = true)\n-    private void onAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/HangingEntity;remove()V\"\n+        ),\n+        cancellable = true\n+    )\n+    private void impl$postEventOnAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n         try (CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n             AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Entity) this, 0, amount);\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\nindex e99ad292a..60021926d 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n", "chunk": "@@ -87,10 +89,12 @@ public abstract class HangingEntityMixin extends EntityMixin {\n         ),\n         cancellable = true\n     )\n-    private void impl$postEventOnAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n-        try (CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+    private void impl$postEventOnAttackEntityFrom(final DamageSource source, final float amount,\n+        final CallbackInfoReturnable<Boolean> cir) {\n+        try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n-            AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Entity) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(),\n+                (Entity) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTcxMA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235710", "body": "Same here. Fix prefix.", "bodyText": "Same here. Fix prefix.", "bodyHTML": "<p dir=\"auto\">Same here. Fix prefix.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:30:59Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java", "diffHunk": "@@ -55,33 +55,33 @@\n public abstract class HangingEntityMixin extends EntityMixin {\n \n     @Shadow @Nullable public Direction facingDirection;\n-    @Shadow public abstract boolean onValidSurface();\n+    @Shadow public abstract boolean shadow$onValidSurface();\n \n-    private boolean ignorePhysics = false;\n+    private boolean impl$ignorePhysics = false;\n \n     /**\n      * Called to update the entity's position/logic.\n      */\n-    @Redirect(method = \"onUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityHanging;onValidSurface()Z\"))\n+    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;onValidSurface()Z\"))\n     private boolean checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {\n-        return this.onValidSurface() && !this.ignorePhysics;\n+        return this.shadow$onValidSurface() && !this.impl$ignorePhysics;\n     }\n \n     @Override\n     public void spongeImpl$writeToSpongeCompound(CompoundNBT compound) {\n         super.spongeImpl$writeToSpongeCompound(compound);\n-        compound.putBoolean(\"ignorePhysics\", this.ignorePhysics);\n+        compound.putBoolean(\"ignorePhysics\", this.impl$ignorePhysics);\n     }\n \n     @Override\n     public void spongeImpl$readFromSpongeCompound(CompoundNBT compound) {\n         super.spongeImpl$readFromSpongeCompound(compound);\n         if (compound.contains(\"ignorePhysics\")) {\n-            this.ignorePhysics = compound.getBoolean(\"ignorePhysics\");\n+            this.impl$ignorePhysics = compound.getBoolean(\"ignorePhysics\");\n         }\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/EntityHanging;setDead()V\"), cancellable = true)\n+    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;remove()V\"), cancellable = true)\n     private void onAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\nindex d801ac935..e99ad292a 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n", "chunk": "@@ -63,26 +63,31 @@ public abstract class HangingEntityMixin extends EntityMixin {\n      * Called to update the entity's position/logic.\n      */\n     @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;onValidSurface()Z\"))\n-    private boolean checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {\n+    private boolean impl$checkIfOnValidSurfaceAndIgnoresPhysics(HangingEntity entityHanging) {\n         return this.shadow$onValidSurface() && !this.impl$ignorePhysics;\n     }\n \n     @Override\n-    public void spongeImpl$writeToSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$writeToSpongeCompound(compound);\n+    public void impl$writeToSpongeCompound(CompoundNBT compound) {\n+        super.impl$writeToSpongeCompound(compound);\n         compound.putBoolean(\"ignorePhysics\", this.impl$ignorePhysics);\n     }\n \n     @Override\n-    public void spongeImpl$readFromSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$readFromSpongeCompound(compound);\n+    public void impl$readFromSpongeCompound(CompoundNBT compound) {\n+        super.impl$readFromSpongeCompound(compound);\n         if (compound.contains(\"ignorePhysics\")) {\n             this.impl$ignorePhysics = compound.getBoolean(\"ignorePhysics\");\n         }\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/HangingEntity;remove()V\"), cancellable = true)\n-    private void onAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/HangingEntity;remove()V\"\n+        ),\n+        cancellable = true\n+    )\n+    private void impl$postEventOnAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n         try (CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n             AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Entity) this, 0, amount);\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\nindex e99ad292a..60021926d 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/HangingEntityMixin.java\n", "chunk": "@@ -87,10 +89,12 @@ public abstract class HangingEntityMixin extends EntityMixin {\n         ),\n         cancellable = true\n     )\n-    private void impl$postEventOnAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n-        try (CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+    private void impl$postEventOnAttackEntityFrom(final DamageSource source, final float amount,\n+        final CallbackInfoReturnable<Boolean> cir) {\n+        try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n-            AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Entity) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(),\n+                (Entity) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTg1Nw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235857", "body": "Fix the method name.", "bodyText": "Fix the method name.", "bodyHTML": "<p dir=\"auto\">Fix the method name.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:31:42Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java", "diffHunk": "@@ -46,10 +46,9 @@\n @Mixin(ItemFrameEntity.class)\n public abstract class ItemFrameEntityMixin extends HangingEntityMixin {\n \n-    @Shadow public abstract void setDisplayedItem(@Nullable net.minecraft.item.ItemStack p_82334_1_);\n+    @Shadow public abstract void shadow$setDisplayedItem(@Nullable net.minecraft.item.ItemStack p_82334_1_);\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityItemFrame;dropItemOrSelf\"\n-      + \"(Lnet/minecraft/entity/Entity;Z)V\"), cancellable = true)\n+    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ItemFrameEntity;dropItemOrSelf(Lnet/minecraft/entity/Entity;Z)V\"), cancellable = true)\n     private void onAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java\nindex f3990d04b..193c4f039 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java\n", "chunk": "@@ -48,11 +48,18 @@ public abstract class ItemFrameEntityMixin extends HangingEntityMixin {\n \n     @Shadow public abstract void shadow$setDisplayedItem(@Nullable net.minecraft.item.ItemStack p_82334_1_);\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ItemFrameEntity;dropItemOrSelf(Lnet/minecraft/entity/Entity;Z)V\"), cancellable = true)\n-    private void onAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n-        try (CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(\n+            value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/ItemFrameEntity;dropItemOrSelf(Lnet/minecraft/entity/Entity;Z)V\"\n+        ),\n+        cancellable = true)\n+    private void onAttackEntityFrom(final DamageSource source, final float amount,\n+        final CallbackInfoReturnable<Boolean> cir) {\n+        try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n-            AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (ItemFrame) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(),\n+                (ItemFrame) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTg4OQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235889", "body": "Multi-line the annotation..", "bodyText": "Multi-line the annotation..", "bodyHTML": "<p dir=\"auto\">Multi-line the annotation..</p>", "author": "gabizou", "createdAt": "2020-02-14T03:31:51Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java", "diffHunk": "@@ -46,10 +46,9 @@\n @Mixin(ItemFrameEntity.class)\n public abstract class ItemFrameEntityMixin extends HangingEntityMixin {\n \n-    @Shadow public abstract void setDisplayedItem(@Nullable net.minecraft.item.ItemStack p_82334_1_);\n+    @Shadow public abstract void shadow$setDisplayedItem(@Nullable net.minecraft.item.ItemStack p_82334_1_);\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityItemFrame;dropItemOrSelf\"\n-      + \"(Lnet/minecraft/entity/Entity;Z)V\"), cancellable = true)\n+    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ItemFrameEntity;dropItemOrSelf(Lnet/minecraft/entity/Entity;Z)V\"), cancellable = true)", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java\nindex f3990d04b..193c4f039 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/ItemFrameEntityMixin.java\n", "chunk": "@@ -48,11 +48,18 @@ public abstract class ItemFrameEntityMixin extends HangingEntityMixin {\n \n     @Shadow public abstract void shadow$setDisplayedItem(@Nullable net.minecraft.item.ItemStack p_82334_1_);\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/ItemFrameEntity;dropItemOrSelf(Lnet/minecraft/entity/Entity;Z)V\"), cancellable = true)\n-    private void onAttackEntityFrom(DamageSource source, float amount, CallbackInfoReturnable<Boolean> cir) {\n-        try (CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(\n+            value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/ItemFrameEntity;dropItemOrSelf(Lnet/minecraft/entity/Entity;Z)V\"\n+        ),\n+        cancellable = true)\n+    private void onAttackEntityFrom(final DamageSource source, final float amount,\n+        final CallbackInfoReturnable<Boolean> cir) {\n+        try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n-            AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (ItemFrame) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(),\n+                (ItemFrame) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTk1OA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235958", "body": "Change method name.", "bodyText": "Change method name.", "bodyHTML": "<p dir=\"auto\">Change method name.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:32:11Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/TNTEntityMixin.java", "diffHunk": "@@ -123,7 +123,7 @@\n     }\n \n \n-    @Inject(method = \"onUpdate\", at = @At(\"RETURN\"))\n+    @Inject(method = \"tick()V\", at = @At(\"RETURN\"))\n     private void onSpongeUpdateTNTPushPrime(final CallbackInfo ci) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/TNTEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/TNTEntityMixin.java\nindex 3e3eb8de6..24103d237 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/TNTEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/TNTEntityMixin.java\n", "chunk": "@@ -124,7 +124,7 @@ public abstract class TNTEntityMixin extends EntityMixin implements EntityTNTPri\n \n \n     @Inject(method = \"tick()V\", at = @At(\"RETURN\"))\n-    private void onSpongeUpdateTNTPushPrime(final CallbackInfo ci) {\n+    private void impl$updateTNTPushPrime(final CallbackInfo ci) {\n         if (this.fuse == this.bridge$fuseDuration - 1 && !this.world.isRemote) {\n             try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n                 if (this.impl$detonator != null) {\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNTk5Mw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379235993", "body": "Multi-line annotation.", "bodyText": "Multi-line annotation.", "bodyHTML": "<p dir=\"auto\">Multi-line annotation.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:32:23Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java", "diffHunk": "@@ -85,12 +85,12 @@ private double onDecelerateZ(final double defaultValue) {\n         return this.impl$derailedMod.getZ();\n     }\n \n-    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityMinecart;isBeingRidden()Z\"))\n+    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;isBeingRidden()Z\"))", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\nindex 924cf900f..aa4112581 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n", "chunk": "@@ -85,14 +85,21 @@ private double onDecelerateZ(final double defaultValue) {\n         return this.impl$derailedMod.getZ();\n     }\n \n-    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;isBeingRidden()Z\"))\n-    private boolean onIsRidden(final AbstractMinecartEntity self) {\n+    @Redirect(method = \"applyDrag\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;isBeingRidden()Z\"\n+        )\n+    )\n+    private boolean impl$applyDragIfEmpty(final AbstractMinecartEntity self) {\n         return !this.impl$slowWhenEmpty || this.shadow$isBeingRidden();\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;removePassengers()V\"),\n-      cancellable = true)\n-    private void onAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;removePassengers()V\"\n+        ),\n+        cancellable = true)\n+    private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n             final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Minecart) this, 0, amount);\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\nindex aa4112581..aab01f420 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n", "chunk": "@@ -96,13 +114,14 @@ private double onDecelerateZ(final double defaultValue) {\n \n     @Inject(method = \"attackEntityFrom\",\n         at = @At(value = \"INVOKE\",\n-            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;removePassengers()V\"\n+            target = \"Lnet/minecraft/entity/item/minecart/AbstractMinecartEntity;removePassengers()V\"\n         ),\n         cancellable = true)\n     private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+            frame.pushCause(this);\n             frame.pushCause(source);\n-            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Minecart) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), (Minecart) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjAwOQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236009", "body": "Change method name with prefix.", "bodyText": "Change method name with prefix.", "bodyHTML": "<p dir=\"auto\">Change method name with prefix.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:32:32Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java", "diffHunk": "@@ -85,12 +85,12 @@ private double onDecelerateZ(final double defaultValue) {\n         return this.impl$derailedMod.getZ();\n     }\n \n-    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityMinecart;isBeingRidden()Z\"))\n+    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;isBeingRidden()Z\"))\n     private boolean onIsRidden(final AbstractMinecartEntity self) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\nindex 924cf900f..aa4112581 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n", "chunk": "@@ -85,14 +85,21 @@ private double onDecelerateZ(final double defaultValue) {\n         return this.impl$derailedMod.getZ();\n     }\n \n-    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;isBeingRidden()Z\"))\n-    private boolean onIsRidden(final AbstractMinecartEntity self) {\n+    @Redirect(method = \"applyDrag\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;isBeingRidden()Z\"\n+        )\n+    )\n+    private boolean impl$applyDragIfEmpty(final AbstractMinecartEntity self) {\n         return !this.impl$slowWhenEmpty || this.shadow$isBeingRidden();\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;removePassengers()V\"),\n-      cancellable = true)\n-    private void onAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;removePassengers()V\"\n+        ),\n+        cancellable = true)\n+    private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n             final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Minecart) this, 0, amount);\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\nindex aa4112581..aab01f420 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n", "chunk": "@@ -96,13 +114,14 @@ private double onDecelerateZ(final double defaultValue) {\n \n     @Inject(method = \"attackEntityFrom\",\n         at = @At(value = \"INVOKE\",\n-            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;removePassengers()V\"\n+            target = \"Lnet/minecraft/entity/item/minecart/AbstractMinecartEntity;removePassengers()V\"\n         ),\n         cancellable = true)\n     private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+            frame.pushCause(this);\n             frame.pushCause(source);\n-            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Minecart) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), (Minecart) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjAzNw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236037", "body": "Multi-line appropriately.", "bodyText": "Multi-line appropriately.", "bodyHTML": "<p dir=\"auto\">Multi-line appropriately.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:32:44Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java", "diffHunk": "@@ -85,12 +85,12 @@ private double onDecelerateZ(final double defaultValue) {\n         return this.impl$derailedMod.getZ();\n     }\n \n-    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityMinecart;isBeingRidden()Z\"))\n+    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;isBeingRidden()Z\"))\n     private boolean onIsRidden(final AbstractMinecartEntity self) {\n-        return !this.impl$slowWhenEmpty || this.isBeingRidden();\n+        return !this.impl$slowWhenEmpty || this.shadow$isBeingRidden();\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityMinecart;removePassengers()V\"),\n+    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;removePassengers()V\"),", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\nindex 924cf900f..aa4112581 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n", "chunk": "@@ -85,14 +85,21 @@ private double onDecelerateZ(final double defaultValue) {\n         return this.impl$derailedMod.getZ();\n     }\n \n-    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;isBeingRidden()Z\"))\n-    private boolean onIsRidden(final AbstractMinecartEntity self) {\n+    @Redirect(method = \"applyDrag\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;isBeingRidden()Z\"\n+        )\n+    )\n+    private boolean impl$applyDragIfEmpty(final AbstractMinecartEntity self) {\n         return !this.impl$slowWhenEmpty || this.shadow$isBeingRidden();\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;removePassengers()V\"),\n-      cancellable = true)\n-    private void onAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;removePassengers()V\"\n+        ),\n+        cancellable = true)\n+    private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n             final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Minecart) this, 0, amount);\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\nindex aa4112581..aab01f420 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n", "chunk": "@@ -96,13 +114,14 @@ private double onDecelerateZ(final double defaultValue) {\n \n     @Inject(method = \"attackEntityFrom\",\n         at = @At(value = \"INVOKE\",\n-            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;removePassengers()V\"\n+            target = \"Lnet/minecraft/entity/item/minecart/AbstractMinecartEntity;removePassengers()V\"\n         ),\n         cancellable = true)\n     private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+            frame.pushCause(this);\n             frame.pushCause(source);\n-            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Minecart) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), (Minecart) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjA3NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236075", "body": "Change prefix and method name..", "bodyText": "Change prefix and method name..", "bodyHTML": "<p dir=\"auto\">Change prefix and method name..</p>", "author": "gabizou", "createdAt": "2020-02-14T03:32:55Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java", "diffHunk": "@@ -85,12 +85,12 @@ private double onDecelerateZ(final double defaultValue) {\n         return this.impl$derailedMod.getZ();\n     }\n \n-    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityMinecart;isBeingRidden()Z\"))\n+    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;isBeingRidden()Z\"))\n     private boolean onIsRidden(final AbstractMinecartEntity self) {\n-        return !this.impl$slowWhenEmpty || this.isBeingRidden();\n+        return !this.impl$slowWhenEmpty || this.shadow$isBeingRidden();\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityMinecart;removePassengers()V\"),\n+    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;removePassengers()V\"),\n       cancellable = true)\n     private void onAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\nindex 924cf900f..aa4112581 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n", "chunk": "@@ -85,14 +85,21 @@ private double onDecelerateZ(final double defaultValue) {\n         return this.impl$derailedMod.getZ();\n     }\n \n-    @Redirect(method = \"applyDrag\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;isBeingRidden()Z\"))\n-    private boolean onIsRidden(final AbstractMinecartEntity self) {\n+    @Redirect(method = \"applyDrag\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;isBeingRidden()Z\"\n+        )\n+    )\n+    private boolean impl$applyDragIfEmpty(final AbstractMinecartEntity self) {\n         return !this.impl$slowWhenEmpty || this.shadow$isBeingRidden();\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/AbstractEntityMinecart;removePassengers()V\"),\n-      cancellable = true)\n-    private void onAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;removePassengers()V\"\n+        ),\n+        cancellable = true)\n+    private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n             final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Minecart) this, 0, amount);\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\nindex aa4112581..aab01f420 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/AbstractMinecartEntityMixin.java\n", "chunk": "@@ -96,13 +114,14 @@ private double onDecelerateZ(final double defaultValue) {\n \n     @Inject(method = \"attackEntityFrom\",\n         at = @At(value = \"INVOKE\",\n-            target = \"Lnet/minecraft/entity/item/AbstractMinecartEntity;removePassengers()V\"\n+            target = \"Lnet/minecraft/entity/item/minecart/AbstractMinecartEntity;removePassengers()V\"\n         ),\n         cancellable = true)\n     private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n+            frame.pushCause(this);\n             frame.pushCause(source);\n-            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(), (Minecart) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), (Minecart) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjEyMw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236123", "body": "Same as the other instance comment, you're not returning a `DimensionType`.", "bodyText": "Same as the other instance comment, you're not returning a DimensionType.", "bodyHTML": "<p dir=\"auto\">Same as the other instance comment, you're not returning a <code>DimensionType</code>.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:33:19Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/ContainerMinecartEntityMixin.java", "diffHunk": "@@ -38,11 +39,13 @@\n \n     /**\n      * @author Zidane - June 2019 - 1.12.2\n+     * @author i509VCB - Feb 2020 - 1.14.4\n      * @reason Only have this Minecart not drop contents if we actually changed dimension\n+     * @return Change to use DimensionType", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/ContainerMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/ContainerMinecartEntityMixin.java\nindex 35526129b..d46bd28b1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/ContainerMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/ContainerMinecartEntityMixin.java\n", "chunk": "@@ -41,12 +41,11 @@ public abstract class ContainerMinecartEntityMixin extends AbstractMinecartEntit\n      * @author Zidane - June 2019 - 1.12.2\n      * @author i509VCB - Feb 2020 - 1.14.4\n      * @reason Only have this Minecart not drop contents if we actually changed dimension\n-     * @return Change to use DimensionType\n      */\n     @Override\n     @Nullable\n-    public Entity changeDimension(DimensionType dimensionIn) {\n-        final Entity entity = super.changeDimension(dimensionIn);\n+    public Entity shadow$changeDimension(DimensionType dimensionIn) {\n+        final Entity entity = super.shadow$changeDimension(dimensionIn);\n \n         if (entity instanceof ContainerMinecartEntity) {\n             // We actually teleported so...\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjE2Nw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236167", "body": "Fix method name.", "bodyText": "Fix method name.", "bodyHTML": "<p dir=\"auto\">Fix method name.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:33:33Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java", "diffHunk": "@@ -157,7 +157,7 @@ private void postExplode(final CallbackInfo ci) {\n         }\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/EntityMinecartTNT;explodeCart(D)V\"))\n+    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/minecart/TNTMinecartEntity;explodeCart(D)V\"))\n     private void onAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java\nindex 818d10717..ed64f5c58 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java\n", "chunk": "@@ -151,14 +151,14 @@ private net.minecraft.world.Explosion onSpongeExplode(final net.minecraft.world.\n     }\n \n     @Inject(method = \"explodeCart\", at = @At(\"RETURN\"))\n-    private void postExplode(final CallbackInfo ci) {\n+    private void impL$postExplode(final CallbackInfo ci) {\n         if (this.impl$detonationCancelled) {\n             this.impl$detonationCancelled = this.isDead = false;\n         }\n     }\n \n     @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/minecart/TNTMinecartEntity;explodeCart(D)V\"))\n-    private void onAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n+    private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n             final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java\nindex ed64f5c58..d58833872 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/item/minecart/TNTMinecartEntityMixin.java\n", "chunk": "@@ -136,33 +141,39 @@ public abstract class TNTMinecartEntityMixin extends AbstractMinecartEntityMixin\n         method = \"explodeCart\",\n         at = @At(\n             value = \"INVOKE\",\n-            target = \"Lnet/minecraft/world/World;createExplosion(Lnet/minecraft/entity/Entity;DDDFZ)Lnet/minecraft/world/Explosion;\"\n+            target = \"Lnet/minecraft/world/World;createExplosion(Lnet/minecraft/entity/Entity;DDDFLnet/minecraft/world/Explosion$Mode;)Lnet/minecraft/world/Explosion;\"\n         )\n     )\n     @Nullable\n-    private net.minecraft.world.Explosion onSpongeExplode(final net.minecraft.world.World worldObj, final Entity self, final double x, final double y, final double z,\n-        final float strength, final boolean smoking) {\n-        return SpongeCommonEventFactory.detonateExplosive(this, Explosion.builder().location(new Location<>((World) worldObj, new Vector3d(x, y, z))).sourceExplosive((TNTMinecart) this)\n-                .radius(this.impl$explosionRadius != null ? this.impl$explosionRadius : strength).shouldPlaySmoke(smoking).shouldBreakBlocks(smoking))\n-                        .orElseGet(() -> {\n-                            this.impl$detonationCancelled = true;\n-                            return null;\n-                        });\n+    private net.minecraft.world.Explosion onSpongeExplode(final net.minecraft.world.World world, final Entity entityIn,\n+        final double xIn, final double yIn, final double zIn, final float explosionRadius, final net.minecraft.world.Explosion.Mode modeIn) {\n+        return SpongeCommonEventFactory.detonateExplosive(this, Explosion.builder()\n+            .location(Location.of((World) world, new Vector3d(xIn, yIn, zIn))).sourceExplosive((TNTMinecart) this)\n+            .radius(this.impl$explosionRadius != null ? this.impl$explosionRadius : explosionRadius)\n+            .shouldPlaySmoke(modeIn.ordinal() > net.minecraft.world.Explosion.Mode.NONE.ordinal())\n+            .shouldBreakBlocks(modeIn.ordinal() > net.minecraft.world.Explosion.Mode.NONE.ordinal()))\n+            .orElseGet(() -> {\n+                this.impl$detonationCancelled = true;\n+                return null;\n+            });\n     }\n \n-    @Inject(method = \"explodeCart\", at = @At(\"RETURN\"))\n+    @Inject(method = \"explodeCart\",\n+        at = @At(\"RETURN\"))\n     private void impL$postExplode(final CallbackInfo ci) {\n         if (this.impl$detonationCancelled) {\n-            this.impl$detonationCancelled = this.isDead = false;\n+            this.impl$detonationCancelled = this.removed = false;\n         }\n     }\n \n-    @Inject(method = \"attackEntityFrom\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/item/minecart/TNTMinecartEntity;explodeCart(D)V\"))\n+    @Inject(method = \"attackEntityFrom\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/item/minecart/TNTMinecartEntity;explodeCart(D)V\"))\n     private void impl$postOnAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n         try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n             frame.pushCause(source);\n-            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(), new ArrayList<>(),\n-                (TNTMinecart) this, 0, amount);\n+            final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(frame.getCurrentCause(),\n+                (TNTMinecart) this, new ArrayList<>(), 0, amount);\n             SpongeImpl.postEvent(event);\n             if (event.isCancelled()) {\n                 cir.setReturnValue(true);\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjI3MA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236270", "body": "Your change should be after mine since yours came after.", "bodyText": "Your change should be after mine since yours came after.", "bodyHTML": "<p dir=\"auto\">Your change should be after mine since yours came after.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:34:09Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java", "diffHunk": "@@ -24,121 +24,74 @@\n  */\n package org.spongepowered.common.mixin.core.entity.merchant.villager;\n \n-import static com.google.common.base.Preconditions.checkNotNull;\n-import static com.google.common.base.Preconditions.checkState;\n-\n+import com.google.common.collect.Sets;\n+import net.minecraft.entity.merchant.villager.AbstractVillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerData;\n import net.minecraft.entity.merchant.villager.VillagerEntity;\n-import net.minecraft.entity.player.PlayerEntity;\n-import net.minecraft.inventory.Inventory;\n-import net.minecraft.village.MerchantRecipeList;\n-import org.spongepowered.api.data.type.Career;\n+import net.minecraft.entity.merchant.villager.VillagerTrades;\n+import net.minecraft.item.MerchantOffer;\n+import net.minecraft.item.MerchantOffers;\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n import org.spongepowered.api.item.merchant.VillagerRegistry;\n-import org.spongepowered.asm.mixin.Final;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Overwrite;\n import org.spongepowered.asm.mixin.Shadow;\n-import org.spongepowered.asm.mixin.injection.At;\n-import org.spongepowered.asm.mixin.injection.Inject;\n-import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n-import org.spongepowered.common.SpongeImplHooks;\n-import org.spongepowered.common.bridge.entity.merchant.villager.VillagerEntityBridge;\n-import org.spongepowered.common.data.type.SpongeEntityMetadataType;\n-import org.spongepowered.common.inventory.lens.impl.collections.SlotLensCollection;\n-import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n+import java.util.ArrayList;\n import java.util.List;\n-import java.util.Optional;\n-import java.util.Random;\n-\n-import javax.annotation.Nullable;\n+import java.util.Set;\n \n @SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AgeableEntityMixin implements VillagerEntityBridge {\n-\n-    @Shadow private int careerId; // careerId\n-    @Shadow private int careerLevel; // careerLevel\n-    @Shadow @Nullable private MerchantRecipeList buyingList; // buyingList\n-    @Shadow @Final private Inventory villagerInventory; // villagerInventory\n-\n-    @Shadow public abstract void setProfession(int professionId); // setProfession\n-    @Shadow public abstract MerchantRecipeList getRecipes(PlayerEntity player);\n-\n-    @Nullable private Profession impl$profession;\n-\n-    @Inject(method = \"setProfession(I)V\", at = @At(\"RETURN\"))\n-    private void onSetProfession(final int professionId, final CallbackInfo ci) {\n-        this.impl$profession = SpongeImplHooks.validateProfession(professionId);\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n+    public VillagerEntityMixin() {\n+        super(null, null);\n     }\n \n-    @Override\n-    public Career bridge$getCareer() {\n-        final List<Career> careers = (List<Career>) this.impl$profession.getCareers();\n-        if (this.careerId == 0 || this.careerId > careers.size()) {\n-            this.careerId = new Random().nextInt(careers.size()) + 1;\n-        }\n-        this.getRecipes(null);\n-        return careers.get(this.careerId - 1);\n-    }\n-\n-    @Override\n-    public Optional<Profession> bridge$getProfessionOptional() {\n-        return Optional.ofNullable(this.impl$profession);\n-    }\n-\n-    @Override\n-    public void bridge$setProfession(final Profession profession) {\n-        this.impl$profession = checkNotNull(profession, \"VillagerProfession cannot be null!\");\n-    }\n-\n-    @Override\n-    public void bridge$setCareer(final Career career) {\n-        this.setProfession(((SpongeEntityMetadataType) career.getProfession()).type);\n-        this.buyingList = null;\n-        this.careerId = ((SpongeCareer) career).type + 1;\n-        this.careerLevel = 1;\n-        this.getRecipes(null);\n-    }\n+    @Shadow public abstract VillagerData shadow$getVillagerData();\n \n     /**\n+     * @author i509VCB - Feb 12, 2020 - 1.14.4\n+     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     *", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex d7c04303e..1595dc4de 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -34,64 +31,46 @@\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n-import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n-import org.spongepowered.api.item.merchant.VillagerRegistry;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n import java.util.ArrayList;\n import java.util.List;\n-import java.util.Set;\n \n-@SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n-    public VillagerEntityMixin() {\n-        super(null, null);\n-    }\n-\n-    @Shadow public abstract VillagerData shadow$getVillagerData();\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n+    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n \n     /**\n-     * @author i509VCB - Feb 12, 2020 - 1.14.4\n-     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Here we apply the Trade Mutators to the villager's new merchant offers and then add them to the entity.\n      *\n-     * @author gabizou - January 13th, 2016\n-     * @reason This overwrites the current method using the multi-dimension array with\n-     * our {@link VillagerRegistry} to handle career levels and registrations\n-     * for {@link TradeOfferGenerator}s. Note that this takes over entirely\n-     * whatever vanilla does, but this allows for maximum customization for\n-     * plugins to handle gracefully.\n+     * @param givenMerchantOffers The merchant's current merchant offers.\n+     * @param newTrades The trade factories representing the new trades this villager will receive.\n+     * @param maxNumbers The maximum amount of trades for this villager to receive.\n+     * @param ci CallbackInfo.\n      */\n     @Override\n-    public void addTrades(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers) {\n-        Set<Integer> set = Sets.newHashSet();\n-        if (newTrades.length > maxNumbers) {\n-            while(set.size() < maxNumbers) {\n-                set.add(this.rand.nextInt(newTrades.length));\n-            }\n-        } else {\n-            for(int i = 0; i < newTrades.length; ++i) {\n-                set.add(i);\n-            }\n-        }\n-\n-        List<MerchantOffer> newOffers = new ArrayList<>(); // Sponge - Create temporary list to store the new offers\n-\n-        for(Integer integer : set) {\n-            VillagerTrades.ITrade villagertrades$itrade = newTrades[integer];\n-            MerchantOffer merchantoffer = villagertrades$itrade.getOffer(this, this.rand); // Sponge - cast \"this\" to Abstract Villager Entity\n-            if (merchantoffer != null) {\n-                // Sponge - Add to newOffers list instead\n-                //givenMerchantOffers.add(merchantoffer);\n-                newOffers.add(merchantoffer);\n-            }\n-        }\n+    protected void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+        VillagerEntity villager = (VillagerEntity) (Object) this;\n+        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) impl$newOffers, (Profession) villager.getVillagerData().getProfession(), villager.getVillagerData().getLevel(), this.rand);\n+        givenMerchantOffers.addAll(this.impl$newOffers); // Finally add the mutated offers to the trade offer map.\n+        this.impl$newOffers.clear(); // And clean up our temp values\n+    }\n \n-        // Sponge - start - fire off the trade offer mutators for the new trades\n-        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) newOffers, (Profession) this.shadow$getVillagerData().getProfession(), this.shadow$getVillagerData().getLevel(), this.rand);\n-        givenMerchantOffers.addAll(newOffers); // Finally add the mutated offers to the trade offer map.\n-        // Sponge - end\n+    /**\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Override the redirect call in AbstractVillagerEntityMixin to capture merchant offers to be mutated.\n+     *\n+     * @param merchantOffers The current offers the villager has.\n+     * @param offer The merchant offer to add.\n+     * @return true\n+     */\n+    @Override\n+    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+        return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex 1595dc4de..4d689c0be 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -70,7 +76,7 @@ public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n      * @return true\n      */\n     @Override\n-    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+    protected boolean impl$addNewOfferToTempMap(final MerchantOffers merchantOffers, final MerchantOffer offer) {\n         return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjMwNw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236307", "body": "This is no longer an overwrite, or is it?", "bodyText": "This is no longer an overwrite, or is it?", "bodyHTML": "<p dir=\"auto\">This is no longer an overwrite, or is it?</p>", "author": "gabizou", "createdAt": "2020-02-14T03:34:23Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java", "diffHunk": "@@ -24,121 +24,74 @@\n  */\n package org.spongepowered.common.mixin.core.entity.merchant.villager;\n \n-import static com.google.common.base.Preconditions.checkNotNull;\n-import static com.google.common.base.Preconditions.checkState;\n-\n+import com.google.common.collect.Sets;\n+import net.minecraft.entity.merchant.villager.AbstractVillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerData;\n import net.minecraft.entity.merchant.villager.VillagerEntity;\n-import net.minecraft.entity.player.PlayerEntity;\n-import net.minecraft.inventory.Inventory;\n-import net.minecraft.village.MerchantRecipeList;\n-import org.spongepowered.api.data.type.Career;\n+import net.minecraft.entity.merchant.villager.VillagerTrades;\n+import net.minecraft.item.MerchantOffer;\n+import net.minecraft.item.MerchantOffers;\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n import org.spongepowered.api.item.merchant.VillagerRegistry;\n-import org.spongepowered.asm.mixin.Final;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Overwrite;\n import org.spongepowered.asm.mixin.Shadow;\n-import org.spongepowered.asm.mixin.injection.At;\n-import org.spongepowered.asm.mixin.injection.Inject;\n-import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n-import org.spongepowered.common.SpongeImplHooks;\n-import org.spongepowered.common.bridge.entity.merchant.villager.VillagerEntityBridge;\n-import org.spongepowered.common.data.type.SpongeEntityMetadataType;\n-import org.spongepowered.common.inventory.lens.impl.collections.SlotLensCollection;\n-import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n+import java.util.ArrayList;\n import java.util.List;\n-import java.util.Optional;\n-import java.util.Random;\n-\n-import javax.annotation.Nullable;\n+import java.util.Set;\n \n @SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AgeableEntityMixin implements VillagerEntityBridge {\n-\n-    @Shadow private int careerId; // careerId\n-    @Shadow private int careerLevel; // careerLevel\n-    @Shadow @Nullable private MerchantRecipeList buyingList; // buyingList\n-    @Shadow @Final private Inventory villagerInventory; // villagerInventory\n-\n-    @Shadow public abstract void setProfession(int professionId); // setProfession\n-    @Shadow public abstract MerchantRecipeList getRecipes(PlayerEntity player);\n-\n-    @Nullable private Profession impl$profession;\n-\n-    @Inject(method = \"setProfession(I)V\", at = @At(\"RETURN\"))\n-    private void onSetProfession(final int professionId, final CallbackInfo ci) {\n-        this.impl$profession = SpongeImplHooks.validateProfession(professionId);\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n+    public VillagerEntityMixin() {\n+        super(null, null);\n     }\n \n-    @Override\n-    public Career bridge$getCareer() {\n-        final List<Career> careers = (List<Career>) this.impl$profession.getCareers();\n-        if (this.careerId == 0 || this.careerId > careers.size()) {\n-            this.careerId = new Random().nextInt(careers.size()) + 1;\n-        }\n-        this.getRecipes(null);\n-        return careers.get(this.careerId - 1);\n-    }\n-\n-    @Override\n-    public Optional<Profession> bridge$getProfessionOptional() {\n-        return Optional.ofNullable(this.impl$profession);\n-    }\n-\n-    @Override\n-    public void bridge$setProfession(final Profession profession) {\n-        this.impl$profession = checkNotNull(profession, \"VillagerProfession cannot be null!\");\n-    }\n-\n-    @Override\n-    public void bridge$setCareer(final Career career) {\n-        this.setProfession(((SpongeEntityMetadataType) career.getProfession()).type);\n-        this.buyingList = null;\n-        this.careerId = ((SpongeCareer) career).type + 1;\n-        this.careerLevel = 1;\n-        this.getRecipes(null);\n-    }\n+    @Shadow public abstract VillagerData shadow$getVillagerData();\n \n     /**\n+     * @author i509VCB - Feb 12, 2020 - 1.14.4\n+     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     *\n      * @author gabizou - January 13th, 2016\n      * @reason This overwrites the current method using the multi-dimension array with", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex d7c04303e..1595dc4de 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -34,64 +31,46 @@\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n-import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n-import org.spongepowered.api.item.merchant.VillagerRegistry;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n import java.util.ArrayList;\n import java.util.List;\n-import java.util.Set;\n \n-@SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n-    public VillagerEntityMixin() {\n-        super(null, null);\n-    }\n-\n-    @Shadow public abstract VillagerData shadow$getVillagerData();\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n+    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n \n     /**\n-     * @author i509VCB - Feb 12, 2020 - 1.14.4\n-     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Here we apply the Trade Mutators to the villager's new merchant offers and then add them to the entity.\n      *\n-     * @author gabizou - January 13th, 2016\n-     * @reason This overwrites the current method using the multi-dimension array with\n-     * our {@link VillagerRegistry} to handle career levels and registrations\n-     * for {@link TradeOfferGenerator}s. Note that this takes over entirely\n-     * whatever vanilla does, but this allows for maximum customization for\n-     * plugins to handle gracefully.\n+     * @param givenMerchantOffers The merchant's current merchant offers.\n+     * @param newTrades The trade factories representing the new trades this villager will receive.\n+     * @param maxNumbers The maximum amount of trades for this villager to receive.\n+     * @param ci CallbackInfo.\n      */\n     @Override\n-    public void addTrades(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers) {\n-        Set<Integer> set = Sets.newHashSet();\n-        if (newTrades.length > maxNumbers) {\n-            while(set.size() < maxNumbers) {\n-                set.add(this.rand.nextInt(newTrades.length));\n-            }\n-        } else {\n-            for(int i = 0; i < newTrades.length; ++i) {\n-                set.add(i);\n-            }\n-        }\n-\n-        List<MerchantOffer> newOffers = new ArrayList<>(); // Sponge - Create temporary list to store the new offers\n-\n-        for(Integer integer : set) {\n-            VillagerTrades.ITrade villagertrades$itrade = newTrades[integer];\n-            MerchantOffer merchantoffer = villagertrades$itrade.getOffer(this, this.rand); // Sponge - cast \"this\" to Abstract Villager Entity\n-            if (merchantoffer != null) {\n-                // Sponge - Add to newOffers list instead\n-                //givenMerchantOffers.add(merchantoffer);\n-                newOffers.add(merchantoffer);\n-            }\n-        }\n+    protected void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+        VillagerEntity villager = (VillagerEntity) (Object) this;\n+        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) impl$newOffers, (Profession) villager.getVillagerData().getProfession(), villager.getVillagerData().getLevel(), this.rand);\n+        givenMerchantOffers.addAll(this.impl$newOffers); // Finally add the mutated offers to the trade offer map.\n+        this.impl$newOffers.clear(); // And clean up our temp values\n+    }\n \n-        // Sponge - start - fire off the trade offer mutators for the new trades\n-        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) newOffers, (Profession) this.shadow$getVillagerData().getProfession(), this.shadow$getVillagerData().getLevel(), this.rand);\n-        givenMerchantOffers.addAll(newOffers); // Finally add the mutated offers to the trade offer map.\n-        // Sponge - end\n+    /**\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Override the redirect call in AbstractVillagerEntityMixin to capture merchant offers to be mutated.\n+     *\n+     * @param merchantOffers The current offers the villager has.\n+     * @param offer The merchant offer to add.\n+     * @return true\n+     */\n+    @Override\n+    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+        return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex 1595dc4de..4d689c0be 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -70,7 +76,7 @@ public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n      * @return true\n      */\n     @Override\n-    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+    protected boolean impl$addNewOfferToTempMap(final MerchantOffers merchantOffers, final MerchantOffer offer) {\n         return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjQxNg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236416", "body": "There's no casting going on? What's the comment doing?", "bodyText": "There's no casting going on? What's the comment doing?", "bodyHTML": "<p dir=\"auto\">There's no casting going on? What's the comment doing?</p>", "author": "gabizou", "createdAt": "2020-02-14T03:35:07Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java", "diffHunk": "@@ -24,121 +24,74 @@\n  */\n package org.spongepowered.common.mixin.core.entity.merchant.villager;\n \n-import static com.google.common.base.Preconditions.checkNotNull;\n-import static com.google.common.base.Preconditions.checkState;\n-\n+import com.google.common.collect.Sets;\n+import net.minecraft.entity.merchant.villager.AbstractVillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerData;\n import net.minecraft.entity.merchant.villager.VillagerEntity;\n-import net.minecraft.entity.player.PlayerEntity;\n-import net.minecraft.inventory.Inventory;\n-import net.minecraft.village.MerchantRecipeList;\n-import org.spongepowered.api.data.type.Career;\n+import net.minecraft.entity.merchant.villager.VillagerTrades;\n+import net.minecraft.item.MerchantOffer;\n+import net.minecraft.item.MerchantOffers;\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n import org.spongepowered.api.item.merchant.VillagerRegistry;\n-import org.spongepowered.asm.mixin.Final;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Overwrite;\n import org.spongepowered.asm.mixin.Shadow;\n-import org.spongepowered.asm.mixin.injection.At;\n-import org.spongepowered.asm.mixin.injection.Inject;\n-import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n-import org.spongepowered.common.SpongeImplHooks;\n-import org.spongepowered.common.bridge.entity.merchant.villager.VillagerEntityBridge;\n-import org.spongepowered.common.data.type.SpongeEntityMetadataType;\n-import org.spongepowered.common.inventory.lens.impl.collections.SlotLensCollection;\n-import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n+import java.util.ArrayList;\n import java.util.List;\n-import java.util.Optional;\n-import java.util.Random;\n-\n-import javax.annotation.Nullable;\n+import java.util.Set;\n \n @SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AgeableEntityMixin implements VillagerEntityBridge {\n-\n-    @Shadow private int careerId; // careerId\n-    @Shadow private int careerLevel; // careerLevel\n-    @Shadow @Nullable private MerchantRecipeList buyingList; // buyingList\n-    @Shadow @Final private Inventory villagerInventory; // villagerInventory\n-\n-    @Shadow public abstract void setProfession(int professionId); // setProfession\n-    @Shadow public abstract MerchantRecipeList getRecipes(PlayerEntity player);\n-\n-    @Nullable private Profession impl$profession;\n-\n-    @Inject(method = \"setProfession(I)V\", at = @At(\"RETURN\"))\n-    private void onSetProfession(final int professionId, final CallbackInfo ci) {\n-        this.impl$profession = SpongeImplHooks.validateProfession(professionId);\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n+    public VillagerEntityMixin() {\n+        super(null, null);\n     }\n \n-    @Override\n-    public Career bridge$getCareer() {\n-        final List<Career> careers = (List<Career>) this.impl$profession.getCareers();\n-        if (this.careerId == 0 || this.careerId > careers.size()) {\n-            this.careerId = new Random().nextInt(careers.size()) + 1;\n-        }\n-        this.getRecipes(null);\n-        return careers.get(this.careerId - 1);\n-    }\n-\n-    @Override\n-    public Optional<Profession> bridge$getProfessionOptional() {\n-        return Optional.ofNullable(this.impl$profession);\n-    }\n-\n-    @Override\n-    public void bridge$setProfession(final Profession profession) {\n-        this.impl$profession = checkNotNull(profession, \"VillagerProfession cannot be null!\");\n-    }\n-\n-    @Override\n-    public void bridge$setCareer(final Career career) {\n-        this.setProfession(((SpongeEntityMetadataType) career.getProfession()).type);\n-        this.buyingList = null;\n-        this.careerId = ((SpongeCareer) career).type + 1;\n-        this.careerLevel = 1;\n-        this.getRecipes(null);\n-    }\n+    @Shadow public abstract VillagerData shadow$getVillagerData();\n \n     /**\n+     * @author i509VCB - Feb 12, 2020 - 1.14.4\n+     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     *\n      * @author gabizou - January 13th, 2016\n      * @reason This overwrites the current method using the multi-dimension array with\n      * our {@link VillagerRegistry} to handle career levels and registrations\n      * for {@link TradeOfferGenerator}s. Note that this takes over entirely\n      * whatever vanilla does, but this allows for maximum customization for\n      * plugins to handle gracefully.\n      */\n-    @SuppressWarnings(\"unchecked\")\n-    @Overwrite\n-    private void populateBuyingList() { // populateBuyingList\n-        // Sponge\n-        final List<Career> careers = (List<Career>) this.impl$profession.getCareers();\n-\n-        // EntityVillager.ITradeList[][][] aentityvillager$itradelist = DEFAULT_TRADE_LIST_MAP[this.getProfession()];\n-\n-        if (this.careerId != 0 && this.careerLevel != 0) {\n-            ++this.careerLevel;\n+    @Override\n+    public void addTrades(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers) {\n+        Set<Integer> set = Sets.newHashSet();\n+        if (newTrades.length > maxNumbers) {\n+            while(set.size() < maxNumbers) {\n+                set.add(this.rand.nextInt(newTrades.length));\n+            }\n         } else {\n-            // Sponge change aentityvillager$itradelist to use this.profession.getCareers()\n-            this.careerId = this.rand.nextInt(careers.size()) + 1;\n-            this.careerLevel = 1;\n+            for(int i = 0; i < newTrades.length; ++i) {\n+                set.add(i);\n+            }\n         }\n \n-        if (this.buyingList == null) {\n-            this.buyingList = new MerchantRecipeList();\n+        List<MerchantOffer> newOffers = new ArrayList<>(); // Sponge - Create temporary list to store the new offers\n+\n+        for(Integer integer : set) {\n+            VillagerTrades.ITrade villagertrades$itrade = newTrades[integer];\n+            MerchantOffer merchantoffer = villagertrades$itrade.getOffer(this, this.rand); // Sponge - cast \"this\" to Abstract Villager Entity", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex d7c04303e..1595dc4de 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -34,64 +31,46 @@\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n-import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n-import org.spongepowered.api.item.merchant.VillagerRegistry;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n import java.util.ArrayList;\n import java.util.List;\n-import java.util.Set;\n \n-@SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n-    public VillagerEntityMixin() {\n-        super(null, null);\n-    }\n-\n-    @Shadow public abstract VillagerData shadow$getVillagerData();\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n+    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n \n     /**\n-     * @author i509VCB - Feb 12, 2020 - 1.14.4\n-     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Here we apply the Trade Mutators to the villager's new merchant offers and then add them to the entity.\n      *\n-     * @author gabizou - January 13th, 2016\n-     * @reason This overwrites the current method using the multi-dimension array with\n-     * our {@link VillagerRegistry} to handle career levels and registrations\n-     * for {@link TradeOfferGenerator}s. Note that this takes over entirely\n-     * whatever vanilla does, but this allows for maximum customization for\n-     * plugins to handle gracefully.\n+     * @param givenMerchantOffers The merchant's current merchant offers.\n+     * @param newTrades The trade factories representing the new trades this villager will receive.\n+     * @param maxNumbers The maximum amount of trades for this villager to receive.\n+     * @param ci CallbackInfo.\n      */\n     @Override\n-    public void addTrades(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers) {\n-        Set<Integer> set = Sets.newHashSet();\n-        if (newTrades.length > maxNumbers) {\n-            while(set.size() < maxNumbers) {\n-                set.add(this.rand.nextInt(newTrades.length));\n-            }\n-        } else {\n-            for(int i = 0; i < newTrades.length; ++i) {\n-                set.add(i);\n-            }\n-        }\n-\n-        List<MerchantOffer> newOffers = new ArrayList<>(); // Sponge - Create temporary list to store the new offers\n-\n-        for(Integer integer : set) {\n-            VillagerTrades.ITrade villagertrades$itrade = newTrades[integer];\n-            MerchantOffer merchantoffer = villagertrades$itrade.getOffer(this, this.rand); // Sponge - cast \"this\" to Abstract Villager Entity\n-            if (merchantoffer != null) {\n-                // Sponge - Add to newOffers list instead\n-                //givenMerchantOffers.add(merchantoffer);\n-                newOffers.add(merchantoffer);\n-            }\n-        }\n+    protected void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+        VillagerEntity villager = (VillagerEntity) (Object) this;\n+        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) impl$newOffers, (Profession) villager.getVillagerData().getProfession(), villager.getVillagerData().getLevel(), this.rand);\n+        givenMerchantOffers.addAll(this.impl$newOffers); // Finally add the mutated offers to the trade offer map.\n+        this.impl$newOffers.clear(); // And clean up our temp values\n+    }\n \n-        // Sponge - start - fire off the trade offer mutators for the new trades\n-        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) newOffers, (Profession) this.shadow$getVillagerData().getProfession(), this.shadow$getVillagerData().getLevel(), this.rand);\n-        givenMerchantOffers.addAll(newOffers); // Finally add the mutated offers to the trade offer map.\n-        // Sponge - end\n+    /**\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Override the redirect call in AbstractVillagerEntityMixin to capture merchant offers to be mutated.\n+     *\n+     * @param merchantOffers The current offers the villager has.\n+     * @param offer The merchant offer to add.\n+     * @return true\n+     */\n+    @Override\n+    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+        return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex 1595dc4de..4d689c0be 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -70,7 +76,7 @@ public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n      * @return true\n      */\n     @Override\n-    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+    protected boolean impl$addNewOfferToTempMap(final MerchantOffers merchantOffers, final MerchantOffer offer) {\n         return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjUyMw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236523", "body": "Could this have been replaced with a `Redirect` on the `addAll`?", "bodyText": "Could this have been replaced with a Redirect on the addAll?", "bodyHTML": "<p dir=\"auto\">Could this have been replaced with a <code>Redirect</code> on the <code>addAll</code>?</p>", "author": "gabizou", "createdAt": "2020-02-14T03:35:46Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java", "diffHunk": "@@ -24,121 +24,74 @@\n  */\n package org.spongepowered.common.mixin.core.entity.merchant.villager;\n \n-import static com.google.common.base.Preconditions.checkNotNull;\n-import static com.google.common.base.Preconditions.checkState;\n-\n+import com.google.common.collect.Sets;\n+import net.minecraft.entity.merchant.villager.AbstractVillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerData;\n import net.minecraft.entity.merchant.villager.VillagerEntity;\n-import net.minecraft.entity.player.PlayerEntity;\n-import net.minecraft.inventory.Inventory;\n-import net.minecraft.village.MerchantRecipeList;\n-import org.spongepowered.api.data.type.Career;\n+import net.minecraft.entity.merchant.villager.VillagerTrades;\n+import net.minecraft.item.MerchantOffer;\n+import net.minecraft.item.MerchantOffers;\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n import org.spongepowered.api.item.merchant.VillagerRegistry;\n-import org.spongepowered.asm.mixin.Final;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Overwrite;\n import org.spongepowered.asm.mixin.Shadow;\n-import org.spongepowered.asm.mixin.injection.At;\n-import org.spongepowered.asm.mixin.injection.Inject;\n-import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n-import org.spongepowered.common.SpongeImplHooks;\n-import org.spongepowered.common.bridge.entity.merchant.villager.VillagerEntityBridge;\n-import org.spongepowered.common.data.type.SpongeEntityMetadataType;\n-import org.spongepowered.common.inventory.lens.impl.collections.SlotLensCollection;\n-import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n+import java.util.ArrayList;\n import java.util.List;\n-import java.util.Optional;\n-import java.util.Random;\n-\n-import javax.annotation.Nullable;\n+import java.util.Set;\n \n @SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AgeableEntityMixin implements VillagerEntityBridge {\n-\n-    @Shadow private int careerId; // careerId\n-    @Shadow private int careerLevel; // careerLevel\n-    @Shadow @Nullable private MerchantRecipeList buyingList; // buyingList\n-    @Shadow @Final private Inventory villagerInventory; // villagerInventory\n-\n-    @Shadow public abstract void setProfession(int professionId); // setProfession\n-    @Shadow public abstract MerchantRecipeList getRecipes(PlayerEntity player);\n-\n-    @Nullable private Profession impl$profession;\n-\n-    @Inject(method = \"setProfession(I)V\", at = @At(\"RETURN\"))\n-    private void onSetProfession(final int professionId, final CallbackInfo ci) {\n-        this.impl$profession = SpongeImplHooks.validateProfession(professionId);\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n+    public VillagerEntityMixin() {\n+        super(null, null);\n     }\n \n-    @Override\n-    public Career bridge$getCareer() {\n-        final List<Career> careers = (List<Career>) this.impl$profession.getCareers();\n-        if (this.careerId == 0 || this.careerId > careers.size()) {\n-            this.careerId = new Random().nextInt(careers.size()) + 1;\n-        }\n-        this.getRecipes(null);\n-        return careers.get(this.careerId - 1);\n-    }\n-\n-    @Override\n-    public Optional<Profession> bridge$getProfessionOptional() {\n-        return Optional.ofNullable(this.impl$profession);\n-    }\n-\n-    @Override\n-    public void bridge$setProfession(final Profession profession) {\n-        this.impl$profession = checkNotNull(profession, \"VillagerProfession cannot be null!\");\n-    }\n-\n-    @Override\n-    public void bridge$setCareer(final Career career) {\n-        this.setProfession(((SpongeEntityMetadataType) career.getProfession()).type);\n-        this.buyingList = null;\n-        this.careerId = ((SpongeCareer) career).type + 1;\n-        this.careerLevel = 1;\n-        this.getRecipes(null);\n-    }\n+    @Shadow public abstract VillagerData shadow$getVillagerData();\n \n     /**\n+     * @author i509VCB - Feb 12, 2020 - 1.14.4\n+     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     *\n      * @author gabizou - January 13th, 2016\n      * @reason This overwrites the current method using the multi-dimension array with\n      * our {@link VillagerRegistry} to handle career levels and registrations\n      * for {@link TradeOfferGenerator}s. Note that this takes over entirely\n      * whatever vanilla does, but this allows for maximum customization for\n      * plugins to handle gracefully.\n      */\n-    @SuppressWarnings(\"unchecked\")\n-    @Overwrite\n-    private void populateBuyingList() { // populateBuyingList\n-        // Sponge\n-        final List<Career> careers = (List<Career>) this.impl$profession.getCareers();\n-\n-        // EntityVillager.ITradeList[][][] aentityvillager$itradelist = DEFAULT_TRADE_LIST_MAP[this.getProfession()];\n-\n-        if (this.careerId != 0 && this.careerLevel != 0) {\n-            ++this.careerLevel;\n+    @Override\n+    public void addTrades(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers) {\n+        Set<Integer> set = Sets.newHashSet();\n+        if (newTrades.length > maxNumbers) {\n+            while(set.size() < maxNumbers) {\n+                set.add(this.rand.nextInt(newTrades.length));\n+            }\n         } else {\n-            // Sponge change aentityvillager$itradelist to use this.profession.getCareers()\n-            this.careerId = this.rand.nextInt(careers.size()) + 1;\n-            this.careerLevel = 1;\n+            for(int i = 0; i < newTrades.length; ++i) {\n+                set.add(i);\n+            }\n         }\n \n-        if (this.buyingList == null) {\n-            this.buyingList = new MerchantRecipeList();\n+        List<MerchantOffer> newOffers = new ArrayList<>(); // Sponge - Create temporary list to store the new offers\n+\n+        for(Integer integer : set) {\n+            VillagerTrades.ITrade villagertrades$itrade = newTrades[integer];\n+            MerchantOffer merchantoffer = villagertrades$itrade.getOffer(this, this.rand); // Sponge - cast \"this\" to Abstract Villager Entity\n+            if (merchantoffer != null) {\n+                // Sponge - Add to newOffers list instead\n+                //givenMerchantOffers.add(merchantoffer);\n+                newOffers.add(merchantoffer);\n+            }\n         }\n \n-        // Sponge start - use our own registry stuffs\n-        checkState(this.careerId <= careers.size(), \"The villager career id is out of bounds fo the available Careers! Found: \" + this.careerId\n-                                                    + \" when the current maximum is: \" + careers.size());\n-        final Career careerLevel = careers.get(this.careerId - 1);\n-        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) this.buyingList, careerLevel, this.careerLevel, this.rand);\n-        // Sponge end\n+        // Sponge - start - fire off the trade offer mutators for the new trades\n+        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) newOffers, (Profession) this.shadow$getVillagerData().getProfession(), this.shadow$getVillagerData().getLevel(), this.rand);\n+        givenMerchantOffers.addAll(newOffers); // Finally add the mutated offers to the trade offer map.", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex d7c04303e..1595dc4de 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -34,64 +31,46 @@\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n-import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n-import org.spongepowered.api.item.merchant.VillagerRegistry;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n import java.util.ArrayList;\n import java.util.List;\n-import java.util.Set;\n \n-@SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n-    public VillagerEntityMixin() {\n-        super(null, null);\n-    }\n-\n-    @Shadow public abstract VillagerData shadow$getVillagerData();\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n+    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n \n     /**\n-     * @author i509VCB - Feb 12, 2020 - 1.14.4\n-     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Here we apply the Trade Mutators to the villager's new merchant offers and then add them to the entity.\n      *\n-     * @author gabizou - January 13th, 2016\n-     * @reason This overwrites the current method using the multi-dimension array with\n-     * our {@link VillagerRegistry} to handle career levels and registrations\n-     * for {@link TradeOfferGenerator}s. Note that this takes over entirely\n-     * whatever vanilla does, but this allows for maximum customization for\n-     * plugins to handle gracefully.\n+     * @param givenMerchantOffers The merchant's current merchant offers.\n+     * @param newTrades The trade factories representing the new trades this villager will receive.\n+     * @param maxNumbers The maximum amount of trades for this villager to receive.\n+     * @param ci CallbackInfo.\n      */\n     @Override\n-    public void addTrades(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers) {\n-        Set<Integer> set = Sets.newHashSet();\n-        if (newTrades.length > maxNumbers) {\n-            while(set.size() < maxNumbers) {\n-                set.add(this.rand.nextInt(newTrades.length));\n-            }\n-        } else {\n-            for(int i = 0; i < newTrades.length; ++i) {\n-                set.add(i);\n-            }\n-        }\n-\n-        List<MerchantOffer> newOffers = new ArrayList<>(); // Sponge - Create temporary list to store the new offers\n-\n-        for(Integer integer : set) {\n-            VillagerTrades.ITrade villagertrades$itrade = newTrades[integer];\n-            MerchantOffer merchantoffer = villagertrades$itrade.getOffer(this, this.rand); // Sponge - cast \"this\" to Abstract Villager Entity\n-            if (merchantoffer != null) {\n-                // Sponge - Add to newOffers list instead\n-                //givenMerchantOffers.add(merchantoffer);\n-                newOffers.add(merchantoffer);\n-            }\n-        }\n+    protected void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+        VillagerEntity villager = (VillagerEntity) (Object) this;\n+        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) impl$newOffers, (Profession) villager.getVillagerData().getProfession(), villager.getVillagerData().getLevel(), this.rand);\n+        givenMerchantOffers.addAll(this.impl$newOffers); // Finally add the mutated offers to the trade offer map.\n+        this.impl$newOffers.clear(); // And clean up our temp values\n+    }\n \n-        // Sponge - start - fire off the trade offer mutators for the new trades\n-        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) newOffers, (Profession) this.shadow$getVillagerData().getProfession(), this.shadow$getVillagerData().getLevel(), this.rand);\n-        givenMerchantOffers.addAll(newOffers); // Finally add the mutated offers to the trade offer map.\n-        // Sponge - end\n+    /**\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Override the redirect call in AbstractVillagerEntityMixin to capture merchant offers to be mutated.\n+     *\n+     * @param merchantOffers The current offers the villager has.\n+     * @param offer The merchant offer to add.\n+     * @return true\n+     */\n+    @Override\n+    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+        return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex 1595dc4de..4d689c0be 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -70,7 +76,7 @@ public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n      * @return true\n      */\n     @Override\n-    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+    protected boolean impl$addNewOfferToTempMap(final MerchantOffers merchantOffers, final MerchantOffer offer) {\n         return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjk3Nw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379236977", "body": "Let me think about this change, because it might be possible to pass in a copy of the `MerchantOffers` at the head of the method (by using a `@ModifyVariable` and doing an injection at the end of the method, allowing us to throw a \"here's a copy of the changes\", or even redirecting the `add()` to add to our own list, and then at the tail, doing the event processing.", "bodyText": "Let me think about this change, because it might be possible to pass in a copy of the MerchantOffers at the head of the method (by using a @ModifyVariable and doing an injection at the end of the method, allowing us to throw a \"here's a copy of the changes\", or even redirecting the add() to add to our own list, and then at the tail, doing the event processing.", "bodyHTML": "<p dir=\"auto\">Let me think about this change, because it might be possible to pass in a copy of the <code>MerchantOffers</code> at the head of the method (by using a <code>@ModifyVariable</code> and doing an injection at the end of the method, allowing us to throw a \"here's a copy of the changes\", or even redirecting the <code>add()</code> to add to our own list, and then at the tail, doing the event processing.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:38:17Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java", "diffHunk": "@@ -24,121 +24,74 @@\n  */\n package org.spongepowered.common.mixin.core.entity.merchant.villager;\n \n-import static com.google.common.base.Preconditions.checkNotNull;\n-import static com.google.common.base.Preconditions.checkState;\n-\n+import com.google.common.collect.Sets;\n+import net.minecraft.entity.merchant.villager.AbstractVillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerData;\n import net.minecraft.entity.merchant.villager.VillagerEntity;\n-import net.minecraft.entity.player.PlayerEntity;\n-import net.minecraft.inventory.Inventory;\n-import net.minecraft.village.MerchantRecipeList;\n-import org.spongepowered.api.data.type.Career;\n+import net.minecraft.entity.merchant.villager.VillagerTrades;\n+import net.minecraft.item.MerchantOffer;\n+import net.minecraft.item.MerchantOffers;\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n import org.spongepowered.api.item.merchant.VillagerRegistry;\n-import org.spongepowered.asm.mixin.Final;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Overwrite;\n import org.spongepowered.asm.mixin.Shadow;\n-import org.spongepowered.asm.mixin.injection.At;\n-import org.spongepowered.asm.mixin.injection.Inject;\n-import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n-import org.spongepowered.common.SpongeImplHooks;\n-import org.spongepowered.common.bridge.entity.merchant.villager.VillagerEntityBridge;\n-import org.spongepowered.common.data.type.SpongeEntityMetadataType;\n-import org.spongepowered.common.inventory.lens.impl.collections.SlotLensCollection;\n-import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n+import java.util.ArrayList;\n import java.util.List;\n-import java.util.Optional;\n-import java.util.Random;\n-\n-import javax.annotation.Nullable;\n+import java.util.Set;\n \n @SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AgeableEntityMixin implements VillagerEntityBridge {\n-\n-    @Shadow private int careerId; // careerId\n-    @Shadow private int careerLevel; // careerLevel\n-    @Shadow @Nullable private MerchantRecipeList buyingList; // buyingList\n-    @Shadow @Final private Inventory villagerInventory; // villagerInventory\n-\n-    @Shadow public abstract void setProfession(int professionId); // setProfession\n-    @Shadow public abstract MerchantRecipeList getRecipes(PlayerEntity player);\n-\n-    @Nullable private Profession impl$profession;\n-\n-    @Inject(method = \"setProfession(I)V\", at = @At(\"RETURN\"))\n-    private void onSetProfession(final int professionId, final CallbackInfo ci) {\n-        this.impl$profession = SpongeImplHooks.validateProfession(professionId);\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n+    public VillagerEntityMixin() {\n+        super(null, null);\n     }\n \n-    @Override\n-    public Career bridge$getCareer() {\n-        final List<Career> careers = (List<Career>) this.impl$profession.getCareers();\n-        if (this.careerId == 0 || this.careerId > careers.size()) {\n-            this.careerId = new Random().nextInt(careers.size()) + 1;\n-        }\n-        this.getRecipes(null);\n-        return careers.get(this.careerId - 1);\n-    }\n-\n-    @Override\n-    public Optional<Profession> bridge$getProfessionOptional() {\n-        return Optional.ofNullable(this.impl$profession);\n-    }\n-\n-    @Override\n-    public void bridge$setProfession(final Profession profession) {\n-        this.impl$profession = checkNotNull(profession, \"VillagerProfession cannot be null!\");\n-    }\n-\n-    @Override\n-    public void bridge$setCareer(final Career career) {\n-        this.setProfession(((SpongeEntityMetadataType) career.getProfession()).type);\n-        this.buyingList = null;\n-        this.careerId = ((SpongeCareer) career).type + 1;\n-        this.careerLevel = 1;\n-        this.getRecipes(null);\n-    }\n+    @Shadow public abstract VillagerData shadow$getVillagerData();\n \n     /**\n+     * @author i509VCB - Feb 12, 2020 - 1.14.4\n+     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     *\n      * @author gabizou - January 13th, 2016\n      * @reason This overwrites the current method using the multi-dimension array with\n      * our {@link VillagerRegistry} to handle career levels and registrations\n      * for {@link TradeOfferGenerator}s. Note that this takes over entirely\n      * whatever vanilla does, but this allows for maximum customization for\n      * plugins to handle gracefully.\n      */\n-    @SuppressWarnings(\"unchecked\")\n-    @Overwrite\n-    private void populateBuyingList() { // populateBuyingList\n-        // Sponge\n-        final List<Career> careers = (List<Career>) this.impl$profession.getCareers();\n-\n-        // EntityVillager.ITradeList[][][] aentityvillager$itradelist = DEFAULT_TRADE_LIST_MAP[this.getProfession()];\n-\n-        if (this.careerId != 0 && this.careerLevel != 0) {\n-            ++this.careerLevel;\n+    @Override\n+    public void addTrades(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers) {\n+        Set<Integer> set = Sets.newHashSet();\n+        if (newTrades.length > maxNumbers) {\n+            while(set.size() < maxNumbers) {\n+                set.add(this.rand.nextInt(newTrades.length));\n+            }\n         } else {\n-            // Sponge change aentityvillager$itradelist to use this.profession.getCareers()\n-            this.careerId = this.rand.nextInt(careers.size()) + 1;\n-            this.careerLevel = 1;\n+            for(int i = 0; i < newTrades.length; ++i) {\n+                set.add(i);\n+            }\n         }\n \n-        if (this.buyingList == null) {\n-            this.buyingList = new MerchantRecipeList();\n+        List<MerchantOffer> newOffers = new ArrayList<>(); // Sponge - Create temporary list to store the new offers\n+\n+        for(Integer integer : set) {\n+            VillagerTrades.ITrade villagertrades$itrade = newTrades[integer];\n+            MerchantOffer merchantoffer = villagertrades$itrade.getOffer(this, this.rand); // Sponge - cast \"this\" to Abstract Villager Entity\n+            if (merchantoffer != null) {\n+                // Sponge - Add to newOffers list instead\n+                //givenMerchantOffers.add(merchantoffer);", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ0NjYwNA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r380446604", "bodyText": "I did the latter option in this case for simplicity's sake. It's 1 redirect and tail injection now.", "author": "i509VCB", "createdAt": "2020-02-18T04:09:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNjk3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex d7c04303e..1595dc4de 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -34,64 +31,46 @@\n import org.spongepowered.api.data.type.Profession;\n import org.spongepowered.api.entity.living.trader.Villager;\n import org.spongepowered.api.item.merchant.TradeOffer;\n-import org.spongepowered.api.item.merchant.TradeOfferGenerator;\n-import org.spongepowered.api.item.merchant.VillagerRegistry;\n import org.spongepowered.asm.mixin.Mixin;\n-import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n import java.util.ArrayList;\n import java.util.List;\n-import java.util.Set;\n \n-@SuppressWarnings(\"rawtypes\")\n @Mixin(VillagerEntity.class)\n-public abstract class VillagerEntityMixin extends AbstractVillagerEntity {\n-    public VillagerEntityMixin() {\n-        super(null, null);\n-    }\n-\n-    @Shadow public abstract VillagerData shadow$getVillagerData();\n+public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n+    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n \n     /**\n-     * @author i509VCB - Feb 12, 2020 - 1.14.4\n-     * @reason Call trade mutators when adding offers. This covers both Wandering Traders and Villagers.\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Here we apply the Trade Mutators to the villager's new merchant offers and then add them to the entity.\n      *\n-     * @author gabizou - January 13th, 2016\n-     * @reason This overwrites the current method using the multi-dimension array with\n-     * our {@link VillagerRegistry} to handle career levels and registrations\n-     * for {@link TradeOfferGenerator}s. Note that this takes over entirely\n-     * whatever vanilla does, but this allows for maximum customization for\n-     * plugins to handle gracefully.\n+     * @param givenMerchantOffers The merchant's current merchant offers.\n+     * @param newTrades The trade factories representing the new trades this villager will receive.\n+     * @param maxNumbers The maximum amount of trades for this villager to receive.\n+     * @param ci CallbackInfo.\n      */\n     @Override\n-    public void addTrades(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers) {\n-        Set<Integer> set = Sets.newHashSet();\n-        if (newTrades.length > maxNumbers) {\n-            while(set.size() < maxNumbers) {\n-                set.add(this.rand.nextInt(newTrades.length));\n-            }\n-        } else {\n-            for(int i = 0; i < newTrades.length; ++i) {\n-                set.add(i);\n-            }\n-        }\n-\n-        List<MerchantOffer> newOffers = new ArrayList<>(); // Sponge - Create temporary list to store the new offers\n-\n-        for(Integer integer : set) {\n-            VillagerTrades.ITrade villagertrades$itrade = newTrades[integer];\n-            MerchantOffer merchantoffer = villagertrades$itrade.getOffer(this, this.rand); // Sponge - cast \"this\" to Abstract Villager Entity\n-            if (merchantoffer != null) {\n-                // Sponge - Add to newOffers list instead\n-                //givenMerchantOffers.add(merchantoffer);\n-                newOffers.add(merchantoffer);\n-            }\n-        }\n+    protected void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+        VillagerEntity villager = (VillagerEntity) (Object) this;\n+        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) impl$newOffers, (Profession) villager.getVillagerData().getProfession(), villager.getVillagerData().getLevel(), this.rand);\n+        givenMerchantOffers.addAll(this.impl$newOffers); // Finally add the mutated offers to the trade offer map.\n+        this.impl$newOffers.clear(); // And clean up our temp values\n+    }\n \n-        // Sponge - start - fire off the trade offer mutators for the new trades\n-        SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) newOffers, (Profession) this.shadow$getVillagerData().getProfession(), this.shadow$getVillagerData().getLevel(), this.rand);\n-        givenMerchantOffers.addAll(newOffers); // Finally add the mutated offers to the trade offer map.\n-        // Sponge - end\n+    /**\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason Override the redirect call in AbstractVillagerEntityMixin to capture merchant offers to be mutated.\n+     *\n+     * @param merchantOffers The current offers the villager has.\n+     * @param offer The merchant offer to add.\n+     * @return true\n+     */\n+    @Override\n+    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+        return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\nindex 1595dc4de..4d689c0be 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/VillagerEntityMixin.java\n", "chunk": "@@ -70,7 +76,7 @@ public abstract class VillagerEntityMixin extends AbstractVillagerEntityMixin {\n      * @return true\n      */\n     @Override\n-    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+    protected boolean impl$addNewOfferToTempMap(final MerchantOffers merchantOffers, final MerchantOffer offer) {\n         return this.impl$newOffers.add(offer);\n     }\n }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNzAyNg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379237026", "body": "Change method name with prefix.", "bodyText": "Change method name with prefix.", "bodyHTML": "<p dir=\"auto\">Change method name with prefix.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:38:33Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java", "diffHunk": "@@ -63,24 +63,25 @@\n      * @author gabizou - July 26th, 2018\n      * @reason Adds sanity check for calling a change block event pre\n      *\n-     * @param entityEnderman The enderman doing griefing\n+     * @param endermanEntity The enderman doing griefing\n      * @return The block state that can be placed, or null if the enderman can't grief\n      */\n     @Redirect(\n         method = \"shouldExecute\",\n         at = @At(\n             value = \"INVOKE\",\n-            target = \"Lnet/minecraft/entity/monster/EntityEnderman;getHeldBlockState()Lnet/minecraft/block/state/IBlockState;\"\n+            target = \"Lnet/minecraft/entity/monster/EndermanEntity;getHeldBlockState()Lnet/minecraft/block/BlockState;\"\n         )\n     )\n     @Nullable\n-    private BlockState onCanGrief(final EndermanEntity entityEnderman) {\n-        final BlockState heldBlockState = entityEnderman.getHeldBlockState();\n+    private BlockState onCanGrief(final EndermanEntity endermanEntity) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java\nindex 6e622e3bd..ddb1930a0 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java\n", "chunk": "@@ -74,14 +74,14 @@ public abstract class EndermanEntity_PlaceBlockGoalMixin extends Goal {\n         )\n     )\n     @Nullable\n-    private BlockState onCanGrief(final EndermanEntity endermanEntity) {\n+    private BlockState impl$onCanGrief(final EndermanEntity endermanEntity) {\n         final BlockState heldBlockState = endermanEntity.getHeldBlockState();\n         return ((GrieferBridge) this.enderman).bridge$canGrief() ? heldBlockState : null;\n     }\n \n     /**\n      * @author gabizou - July 26th, 2018\\\n-     * @author i509VCB - February 11th, 2020 - 1.14.4\n+     * @author i509VCB - February 11th, 2020 - 1.14.4 TODO: This needs to be looked at with another eye to make sure this injection isn't stupidly made\n      * @reason Makes enderman check for block changes before they can place their blocks.\n      * This allows plugins to cancel the event regardless without issue.\n      *\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNzEwOQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379237109", "body": "Multiline this annotation. Also, is it required to have all the parameters?", "bodyText": "Multiline this annotation. Also, is it required to have all the parameters?", "bodyHTML": "<p dir=\"auto\">Multiline this annotation. Also, is it required to have all the parameters?</p>", "author": "gabizou", "createdAt": "2020-02-14T03:38:59Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java", "diffHunk": "@@ -92,10 +93,10 @@ private BlockState onCanGrief(final EndermanEntity entityEnderman) {\n      * @param state The new state\n      * @return True if the state is a full cube, and the event didnt get cancelled\n      */\n-    @Redirect(method = \"canPlaceBlock\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/state/IBlockState;isFullCube()Z\"))\n+    @Redirect(method = \"func_220836_a(Lnet/minecraft/world/IWorldReader;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/BlockState;Lnet/minecraft/block/BlockState;Lnet/minecraft/block/BlockState;Lnet/minecraft/util/math/BlockPos;)Z\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/state/IBlockState;isFullCube()Z\"))", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java\nindex 6e622e3bd..ddb1930a0 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/EndermanEntity_PlaceBlockGoalMixin.java\n", "chunk": "@@ -93,9 +93,13 @@ private BlockState onCanGrief(final EndermanEntity endermanEntity) {\n      * @param state The new state\n      * @return True if the state is a full cube, and the event didnt get cancelled\n      */\n-    @Redirect(method = \"func_220836_a(Lnet/minecraft/world/IWorldReader;Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/BlockState;Lnet/minecraft/block/BlockState;Lnet/minecraft/block/BlockState;Lnet/minecraft/util/math/BlockPos;)Z\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/state/IBlockState;isFullCube()Z\"))\n-    private boolean onUpdateCancel(final BlockState blockState, final World world, final BlockPos pos, final Block toPlace,\n-        final BlockState old, final BlockState state) {\n+    @Redirect(method = \"func_220836_a\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/block/BlockState;isNormalCube(Lnet/minecraft/world/IBlockReader;Lnet/minecraft/util/math/BlockPos;)Z\"\n+        )\n+    )\n+    private boolean impl$onPlaceBlockCancel(final BlockState blockState, final World world, final BlockPos pos, final Block toPlace,\n+            final BlockState old, final BlockState state) {\n         if (state.isNormalCube(world, pos)) {\n             if (ShouldFire.CHANGE_BLOCK_EVENT_PRE) {\n                 final Location<org.spongepowered.api.world.World> location =\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNzIzMQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379237231", "body": "Fix method name with prefix..", "bodyText": "Fix method name with prefix..", "bodyHTML": "<p dir=\"auto\">Fix method name with prefix..</p>", "author": "gabizou", "createdAt": "2020-02-14T03:39:41Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/monster/SilverfishEntity_HideInStoneGoalMixin.java", "diffHunk": "@@ -42,7 +42,7 @@ public SilverfishEntity_HideInStoneGoalMixin(CreatureEntity creatureIn, double s\n     }\n \n     @Redirect(method = \"shouldExecute\",\n-        at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/BlockSilverfish;canContainSilverfish(Lnet/minecraft/block/state/IBlockState;)Z\"))\n+        at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/SilverfishBlock;canContainSilverfish(Lnet/minecraft/block/BlockState;)Z\"))\n     private boolean onCanGrief(final BlockState blockState) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/SilverfishEntity_HideInStoneGoalMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/SilverfishEntity_HideInStoneGoalMixin.java\nindex a7eaae55f..cc2118b7c 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/SilverfishEntity_HideInStoneGoalMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/SilverfishEntity_HideInStoneGoalMixin.java\n", "chunk": "@@ -43,7 +43,7 @@ public SilverfishEntity_HideInStoneGoalMixin(CreatureEntity creatureIn, double s\n \n     @Redirect(method = \"shouldExecute\",\n         at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/block/SilverfishBlock;canContainSilverfish(Lnet/minecraft/block/BlockState;)Z\"))\n-    private boolean onCanGrief(final BlockState blockState) {\n+    private boolean impl$onCanGrief(final BlockState blockState) {\n         return SilverfishBlock.canContainSilverfish(blockState) && ((GrieferBridge) this.creature).bridge$canGrief();\n     }\n }\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNzMyNA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379237324", "body": "Might want to multi-line.", "bodyText": "Might want to multi-line.", "bodyHTML": "<p dir=\"auto\">Might want to multi-line.</p>", "author": "gabizou", "createdAt": "2020-02-14T03:40:20Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java", "diffHunk": "@@ -61,9 +61,9 @@\n         ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.thrower);\n     }\n \n-    @Redirect(method = \"onUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/EntityThrowable;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))\n+    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\nindex cf395c835..6b8786164 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n", "chunk": "@@ -43,27 +44,31 @@\n @Mixin(ThrowableEntity.class)\n public abstract class ThrowableEntityMixin extends EntityMixin {\n \n-    @Shadow protected LivingEntity thrower;\n+    @Shadow protected LivingEntity owner;\n     @Shadow protected abstract void onImpact(RayTraceResult movingObjectPosition);\n \n     @Nullable\n     public ProjectileSource projectileSource;\n \n     @Override\n-    public void spongeImpl$readFromSpongeCompound(final CompoundNBT compound) {\n-        super.spongeImpl$readFromSpongeCompound(compound);\n+    public void impl$readFromSpongeCompound(final CompoundNBT compound) {\n+        super.impl$readFromSpongeCompound(compound);\n         ProjectileSourceSerializer.readSourceFromNbt(compound, ((Projectile) this));\n     }\n \n     @Override\n-    public void spongeImpl$writeToSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$writeToSpongeCompound(compound);\n-        ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.thrower);\n+    public void impl$writeToSpongeCompound(CompoundNBT compound) {\n+        super.impl$writeToSpongeCompound(compound);\n+        ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.owner);\n     }\n \n-    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))\n-    public void onProjectileImpact(ThrowableEntity projectile, RayTraceResult movingObjectPosition) {\n-        if (this.world.isRemote || movingObjectPosition.getType() == RayTraceResult.Type.MISS) {\n+    @Redirect(method = \"tick()V\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"\n+        )\n+    )\n+    private void impl$handleProjectileImpact(ThrowableEntity projectile, RayTraceResult movingObjectPosition) {\n+        if (((WorldBridge) this.world).bridge$isFake() || movingObjectPosition.getType() == RayTraceResult.Type.MISS) {\n             this.onImpact(movingObjectPosition);\n             return;\n         }\n", "next_change": {"commit": "d54e74d7e323bdd8673afe7d2e963fe72976a4d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\nindex 6b8786164..d6d268afd 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n", "chunk": "@@ -73,7 +72,7 @@ public abstract class ThrowableEntityMixin extends EntityMixin {\n             return;\n         }\n \n-        if (!SpongeCommonEventFactory.handleCollideImpactEvent(projectile, ((Projectile) this).getShooter(), movingObjectPosition)) {\n+        if (!SpongeCommonEventFactory.handleCollideImpactEvent(projectile, ((Projectile) this).shooter().get(), movingObjectPosition)) {\n             this.onImpact(movingObjectPosition);\n         }\n     }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNzM0NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379237345", "body": "Change method name and prefix..", "bodyText": "Change method name and prefix..", "bodyHTML": "<p dir=\"auto\">Change method name and prefix..</p>", "author": "gabizou", "createdAt": "2020-02-14T03:40:27Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java", "diffHunk": "@@ -61,9 +61,9 @@\n         ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.thrower);\n     }\n \n-    @Redirect(method = \"onUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/EntityThrowable;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))\n+    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))\n     public void onProjectileImpact(ThrowableEntity projectile, RayTraceResult movingObjectPosition) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\nindex cf395c835..6b8786164 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n", "chunk": "@@ -43,27 +44,31 @@\n @Mixin(ThrowableEntity.class)\n public abstract class ThrowableEntityMixin extends EntityMixin {\n \n-    @Shadow protected LivingEntity thrower;\n+    @Shadow protected LivingEntity owner;\n     @Shadow protected abstract void onImpact(RayTraceResult movingObjectPosition);\n \n     @Nullable\n     public ProjectileSource projectileSource;\n \n     @Override\n-    public void spongeImpl$readFromSpongeCompound(final CompoundNBT compound) {\n-        super.spongeImpl$readFromSpongeCompound(compound);\n+    public void impl$readFromSpongeCompound(final CompoundNBT compound) {\n+        super.impl$readFromSpongeCompound(compound);\n         ProjectileSourceSerializer.readSourceFromNbt(compound, ((Projectile) this));\n     }\n \n     @Override\n-    public void spongeImpl$writeToSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$writeToSpongeCompound(compound);\n-        ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.thrower);\n+    public void impl$writeToSpongeCompound(CompoundNBT compound) {\n+        super.impl$writeToSpongeCompound(compound);\n+        ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.owner);\n     }\n \n-    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))\n-    public void onProjectileImpact(ThrowableEntity projectile, RayTraceResult movingObjectPosition) {\n-        if (this.world.isRemote || movingObjectPosition.getType() == RayTraceResult.Type.MISS) {\n+    @Redirect(method = \"tick()V\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"\n+        )\n+    )\n+    private void impl$handleProjectileImpact(ThrowableEntity projectile, RayTraceResult movingObjectPosition) {\n+        if (((WorldBridge) this.world).bridge$isFake() || movingObjectPosition.getType() == RayTraceResult.Type.MISS) {\n             this.onImpact(movingObjectPosition);\n             return;\n         }\n", "next_change": {"commit": "d54e74d7e323bdd8673afe7d2e963fe72976a4d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\nindex 6b8786164..d6d268afd 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n", "chunk": "@@ -73,7 +72,7 @@ public abstract class ThrowableEntityMixin extends EntityMixin {\n             return;\n         }\n \n-        if (!SpongeCommonEventFactory.handleCollideImpactEvent(projectile, ((Projectile) this).getShooter(), movingObjectPosition)) {\n+        if (!SpongeCommonEventFactory.handleCollideImpactEvent(projectile, ((Projectile) this).shooter().get(), movingObjectPosition)) {\n             this.onImpact(movingObjectPosition);\n         }\n     }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIzNzQ5NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r379237495", "body": "TODO will need to change to a `SpongeImplHooks.isMainThread` or `WorldBridge.bridge$isFake()` for the `world.isRemote.`", "bodyText": "TODO will need to change to a SpongeImplHooks.isMainThread or WorldBridge.bridge$isFake() for the world.isRemote.", "bodyHTML": "<p dir=\"auto\">TODO will need to change to a <code>SpongeImplHooks.isMainThread</code> or <code>WorldBridge.bridge$isFake()</code> for the <code>world.isRemote.</code></p>", "author": "gabizou", "createdAt": "2020-02-14T03:41:14Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java", "diffHunk": "@@ -61,9 +61,9 @@\n         ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.thrower);\n     }\n \n-    @Redirect(method = \"onUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/EntityThrowable;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))\n+    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))\n     public void onProjectileImpact(ThrowableEntity projectile, RayTraceResult movingObjectPosition) {\n-        if (this.world.isRemote || movingObjectPosition.typeOfHit == RayTraceResult.Type.MISS) {\n+        if (this.world.isRemote || movingObjectPosition.getType() == RayTraceResult.Type.MISS) {", "originalCommit": "28e7257e4dae66eaae78d8cae681fc70e99a5ef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\nindex cf395c835..6b8786164 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n", "chunk": "@@ -43,27 +44,31 @@\n @Mixin(ThrowableEntity.class)\n public abstract class ThrowableEntityMixin extends EntityMixin {\n \n-    @Shadow protected LivingEntity thrower;\n+    @Shadow protected LivingEntity owner;\n     @Shadow protected abstract void onImpact(RayTraceResult movingObjectPosition);\n \n     @Nullable\n     public ProjectileSource projectileSource;\n \n     @Override\n-    public void spongeImpl$readFromSpongeCompound(final CompoundNBT compound) {\n-        super.spongeImpl$readFromSpongeCompound(compound);\n+    public void impl$readFromSpongeCompound(final CompoundNBT compound) {\n+        super.impl$readFromSpongeCompound(compound);\n         ProjectileSourceSerializer.readSourceFromNbt(compound, ((Projectile) this));\n     }\n \n     @Override\n-    public void spongeImpl$writeToSpongeCompound(CompoundNBT compound) {\n-        super.spongeImpl$writeToSpongeCompound(compound);\n-        ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.thrower);\n+    public void impl$writeToSpongeCompound(CompoundNBT compound) {\n+        super.impl$writeToSpongeCompound(compound);\n+        ProjectileSourceSerializer.writeSourceToNbt(compound, ((Projectile) this).getShooter(), this.owner);\n     }\n \n-    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"))\n-    public void onProjectileImpact(ThrowableEntity projectile, RayTraceResult movingObjectPosition) {\n-        if (this.world.isRemote || movingObjectPosition.getType() == RayTraceResult.Type.MISS) {\n+    @Redirect(method = \"tick()V\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/entity/projectile/ThrowableEntity;onImpact(Lnet/minecraft/util/math/RayTraceResult;)V\"\n+        )\n+    )\n+    private void impl$handleProjectileImpact(ThrowableEntity projectile, RayTraceResult movingObjectPosition) {\n+        if (((WorldBridge) this.world).bridge$isFake() || movingObjectPosition.getType() == RayTraceResult.Type.MISS) {\n             this.onImpact(movingObjectPosition);\n             return;\n         }\n", "next_change": {"commit": "d54e74d7e323bdd8673afe7d2e963fe72976a4d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\nindex 6b8786164..d6d268afd 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/projectile/ThrowableEntityMixin.java\n", "chunk": "@@ -73,7 +72,7 @@ public abstract class ThrowableEntityMixin extends EntityMixin {\n             return;\n         }\n \n-        if (!SpongeCommonEventFactory.handleCollideImpactEvent(projectile, ((Projectile) this).getShooter(), movingObjectPosition)) {\n+        if (!SpongeCommonEventFactory.handleCollideImpactEvent(projectile, ((Projectile) this).shooter().get(), movingObjectPosition)) {\n             this.onImpact(movingObjectPosition);\n         }\n     }\n", "next_change": null}]}}]}}, {"oid": "a9896ac8e37b1b0f38a79fbb4d01272c7767ab1d", "url": "https://github.com/SpongePowered/Sponge/commit/a9896ac8e37b1b0f38a79fbb4d01272c7767ab1d", "message": "Make references to GameRules refer to actual RuleKey rather than string constant, clean up and make most of core entity mixins compile", "committedDate": "2020-02-18T04:04:11Z", "type": "forcePushed"}, {"oid": "735f108ed788a97a7a8309ee70453e48fdcf0594", "url": "https://github.com/SpongePowered/Sponge/commit/735f108ed788a97a7a8309ee70453e48fdcf0594", "message": "Make references to GameRules refer to actual RuleKey rather than string constant, clean up and make most of core entity mixins compile", "committedDate": "2020-02-18T04:05:28Z", "type": "forcePushed"}, {"oid": "92a4e950408beab4785ef89b99ea8115af0e1d54", "url": "https://github.com/SpongePowered/Sponge/commit/92a4e950408beab4785ef89b99ea8115af0e1d54", "message": "Make references to GameRules refer to actual RuleKey rather than string constant, clean up and make most of core entity mixins compile", "committedDate": "2020-02-19T01:07:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5OTE0OA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382399148", "body": "extra spaces unnecessary", "bodyText": "extra spaces unnecessary", "bodyHTML": "<p dir=\"auto\">extra spaces unnecessary</p>", "author": "gabizou", "createdAt": "2020-02-21T05:04:04Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java", "diffHunk": "@@ -152,47 +143,61 @@\n     @Shadow public int fire;\n     @Shadow public int hurtResistantTime;\n     @Shadow protected EntityDataManager dataManager;\n-    @Shadow public int dimension;\n+    @Shadow public DimensionType dimension;\n     @Shadow private boolean invulnerable;\n-\n-    @Shadow public abstract void setPosition(double x, double y, double z);\n-    @Shadow public abstract void setDead();\n-    @Shadow public abstract int getAir();\n-    @Shadow public abstract void setAir(int air);\n-    @Shadow public abstract float getEyeHeight();\n-    @Shadow public abstract void setCustomNameTag(String name);\n-    @Shadow public abstract UUID getUniqueID();\n-    @Shadow public abstract AxisAlignedBB getEntityBoundingBox();\n-    @Shadow public abstract void setFire(int seconds);\n-    @Shadow public abstract CompoundNBT writeToNBT(CompoundNBT compound);\n+    @Shadow @Final private EntityType<?> type;\n+\n+    @Shadow public abstract void shadow$remove();\n+    @Shadow public abstract int shadow$getAir();\n+    @Shadow public abstract void shadow$setAir(int air);\n+    @Shadow public abstract void shadow$setCustomName(@Nullable ITextComponent name);\n+    @Shadow public abstract UUID shadow$getUniqueID();\n+    @Shadow public abstract AxisAlignedBB shadow$getBoundingBox();\n+    @Shadow public abstract void shadow$setFire(int seconds);\n     @Shadow public abstract boolean attackEntityFrom(DamageSource source, float amount);\n-    @Shadow public abstract int getEntityId();\n-    @Shadow public abstract boolean isBeingRidden();\n-    @Shadow public abstract SoundCategory getSoundCategory();\n-    @Shadow public abstract List<Entity> shadow$getPassengers();\n+    @Shadow public abstract int shadow$getEntityId();\n+    @Shadow public abstract boolean shadow$isBeingRidden();\n     @Shadow public abstract Entity getRidingEntity();\n-    @Shadow public abstract void setItemStackToSlot(EquipmentSlotType slotIn, ItemStack stack);\n-    @Shadow public abstract void playSound(SoundEvent soundIn, float volume, float pitch);\n-    @Shadow public abstract boolean isEntityInvulnerable(DamageSource source);\n-    @Shadow public abstract boolean isSprinting();\n-    @Shadow public abstract boolean shadow$isInWater();\n-    @Shadow public abstract boolean isRiding();\n-    @Shadow public abstract boolean isOnSameTeam(Entity entityIn);\n-    @Shadow public abstract double getDistanceSq(Entity entityIn);\n+    @Shadow public abstract void shadow$playSound(SoundEvent soundIn, float volume, float pitch);\n     @Shadow public abstract void setLocationAndAngles(double x, double y, double z, float yaw, float pitch);\n-    @Shadow public abstract void setPositionAndUpdate(double x, double y, double z);\n-    @Shadow protected abstract void removePassenger(Entity passenger);\n-    @Shadow protected abstract void setSize(float width, float height);\n-    @Shadow protected abstract void applyEnchantments(LivingEntity entityLivingBaseIn, Entity entityIn);\n-    @Shadow public abstract void extinguish();\n-    @Shadow protected abstract void setFlag(int flag, boolean set);\n-    @Shadow @Nullable public Entity changeDimension(final int dimension) { return null; } // Shadow\n-    @Shadow public abstract boolean isInvisible();\n-    @Shadow public abstract void setInvisible(boolean invisible);\n-    @Shadow public abstract int getMaxAir();\n-    @Shadow protected abstract int getFireImmuneTicks();\n-\n-    private int customFireImmuneTicks = this.getFireImmuneTicks();\n+    @Shadow protected abstract void shadow$removePassenger(Entity passenger);\n+    @Shadow @Nullable public Entity shadow$changeDimension(DimensionType dimension) { return null; } // Shadow\n+    @Shadow public abstract boolean shadow$isInvisible();\n+    @Shadow public abstract void shadow$setInvisible(boolean invisible);\n+    @Shadow protected abstract int shadow$getFireImmuneTicks();\n+    @Shadow public abstract EntityType<?> shadow$getType();\n+    @Shadow public abstract boolean shadow$isInvulnerableTo(DamageSource source);\n+    @Shadow public abstract float shadow$getEyeHeight();\n+    @Shadow protected abstract void shadow$setFlag(int flag, boolean set);\n+    @Shadow public abstract void shadow$extinguish();\n+    @Shadow public abstract void shadow$setPosition(double x, double y, double z);\n+    @Shadow public abstract void shadow$setMotion(Vec3d motionIn);\n+    @Shadow public abstract void shadow$setMotion(double x, double y, double z);\n+    @Shadow public abstract boolean shadow$isSprinting();\n+    @Shadow public abstract Vec3d shadow$getMotion();\n+    @Shadow public abstract boolean shadow$isOnSameTeam(Entity entityIn);\n+    @Shadow public abstract double shadow$getDistanceSq(Entity entityIn);\n+    @Shadow @Nullable public abstract ItemEntity shadow$entityDropItem(IItemProvider itemIn, int offset);\n+    @Shadow public abstract boolean shadow$isInWater();\n+    @Shadow public abstract boolean shadow$isPassenger();\n+    @Shadow @Nullable public abstract Team shadow$getTeam();\n+\n+    @Shadow public abstract void shadow$setPositionAndUpdate(double x, double y, double z);\n+", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex 19b244838..dc624d132 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -181,9 +181,7 @@ public abstract class EntityMixin implements EntityBridge, TrackableBridge, Vani\n     @Shadow public abstract boolean shadow$isInWater();\n     @Shadow public abstract boolean shadow$isPassenger();\n     @Shadow @Nullable public abstract Team shadow$getTeam();\n-\n     @Shadow public abstract void shadow$setPositionAndUpdate(double x, double y, double z);\n-\n     @Shadow public abstract int shadow$getMaxAir();\n \n     private boolean impl$isConstructing = true;\n", "next_change": {"commit": "754f7a91afb38a784d596834bd9304955becb9a2", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\nindex dc624d132..23bafcf98 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/EntityMixin.java\n", "chunk": "@@ -132,55 +125,39 @@ public abstract class EntityMixin implements EntityBridge, TrackableBridge, Vani\n     @Shadow public float rotationPitch;\n     @Shadow public boolean velocityChanged;\n     @Shadow public boolean onGround;\n-    @Shadow public boolean isDead;\n-    @Shadow public float width;\n-    @Shadow public float height;\n+    @Shadow public boolean removed;\n     @Shadow public float prevDistanceWalkedModified;\n     @Shadow public float distanceWalkedModified;\n     @Shadow public float fallDistance;\n-    @Shadow protected Random rand;\n-    @Shadow public int ticksExisted;\n-    @Shadow public int fire;\n+    @Shadow @Final protected Random rand;\n+    @Shadow private int fire;\n     @Shadow public int hurtResistantTime;\n-    @Shadow protected EntityDataManager dataManager;\n+    @Shadow @Final protected EntityDataManager dataManager;\n     @Shadow public DimensionType dimension;\n     @Shadow private boolean invulnerable;\n-    @Shadow @Final private EntityType<?> type;\n \n     @Shadow public abstract void shadow$remove();\n-    @Shadow public abstract int shadow$getAir();\n-    @Shadow public abstract void shadow$setAir(int air);\n     @Shadow public abstract void shadow$setCustomName(@Nullable ITextComponent name);\n-    @Shadow public abstract UUID shadow$getUniqueID();\n     @Shadow public abstract AxisAlignedBB shadow$getBoundingBox();\n-    @Shadow public abstract void shadow$setFire(int seconds);\n     @Shadow public abstract boolean attackEntityFrom(DamageSource source, float amount);\n     @Shadow public abstract int shadow$getEntityId();\n     @Shadow public abstract boolean shadow$isBeingRidden();\n     @Shadow public abstract Entity getRidingEntity();\n     @Shadow public abstract void shadow$playSound(SoundEvent soundIn, float volume, float pitch);\n-    @Shadow public abstract void setLocationAndAngles(double x, double y, double z, float yaw, float pitch);\n     @Shadow protected abstract void shadow$removePassenger(Entity passenger);\n-    @Shadow @Nullable public Entity shadow$changeDimension(DimensionType dimension) { return null; } // Shadow\n+    @Shadow @Nullable public Entity shadow$changeDimension(final DimensionType dimension) { return null; } // Shadow\n     @Shadow public abstract boolean shadow$isInvisible();\n     @Shadow public abstract void shadow$setInvisible(boolean invisible);\n     @Shadow protected abstract int shadow$getFireImmuneTicks();\n     @Shadow public abstract EntityType<?> shadow$getType();\n     @Shadow public abstract boolean shadow$isInvulnerableTo(DamageSource source);\n-    @Shadow public abstract float shadow$getEyeHeight();\n-    @Shadow protected abstract void shadow$setFlag(int flag, boolean set);\n-    @Shadow public abstract void shadow$extinguish();\n-    @Shadow public abstract void shadow$setPosition(double x, double y, double z);\n     @Shadow public abstract void shadow$setMotion(Vec3d motionIn);\n-    @Shadow public abstract void shadow$setMotion(double x, double y, double z);\n     @Shadow public abstract boolean shadow$isSprinting();\n     @Shadow public abstract Vec3d shadow$getMotion();\n     @Shadow public abstract boolean shadow$isOnSameTeam(Entity entityIn);\n     @Shadow public abstract double shadow$getDistanceSq(Entity entityIn);\n-    @Shadow @Nullable public abstract ItemEntity shadow$entityDropItem(IItemProvider itemIn, int offset);\n     @Shadow public abstract boolean shadow$isInWater();\n     @Shadow public abstract boolean shadow$isPassenger();\n-    @Shadow @Nullable public abstract Team shadow$getTeam();\n     @Shadow public abstract void shadow$setPositionAndUpdate(double x, double y, double z);\n     @Shadow public abstract int shadow$getMaxAir();\n \n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMDE4OA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382400188", "body": "Yes, but that can be put up as an issue to remind us later.", "bodyText": "Yes, but that can be put up as an issue to remind us later.", "bodyHTML": "<p dir=\"auto\">Yes, but that can be put up as an issue to remind us later.</p>", "author": "gabizou", "createdAt": "2020-02-21T05:10:09Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * This file is part of Sponge, licensed under the MIT License (MIT).\n+ *\n+ * Copyright (c) SpongePowered <https://www.spongepowered.org>\n+ * Copyright (c) contributors\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.spongepowered.common.mixin.core.entity.merchant.villager;\n+\n+import net.minecraft.entity.merchant.villager.AbstractVillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerTrades;\n+import net.minecraft.item.MerchantOffer;\n+import net.minecraft.item.MerchantOffers;\n+import org.spongepowered.api.data.type.Profession;\n+import org.spongepowered.api.entity.living.trader.Villager;\n+import org.spongepowered.api.item.merchant.TradeOffer;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n+import org.spongepowered.common.registry.SpongeVillagerRegistry;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@Mixin(AbstractVillagerEntity.class)\n+public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n+    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n+\n+    /**\n+     * @author i509VCB - February 17th, 2020 - 1.14.4\n+     *\n+     * @reason Here we apply the Trade Mutators. For a villager we will apply our mutators and then add them to the villager's merchant offers.\n+     * If a wandering trader is the subject here, we do nothing since that merchant would already have it's new merchant offers.\n+     *\n+     * @todo: Do we want to support Trade Mutators on Wandering Trader's TradeOffers?", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU3NDYxNw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382574617", "bodyText": "Made an api issue about it", "author": "i509VCB", "createdAt": "2020-02-21T13:15:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMDE4OA=="}], "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\nindex 37df6c14c..12e4deff1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n", "chunk": "@@ -40,40 +40,15 @@\n import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n-import java.util.ArrayList;\n import java.util.List;\n \n @Mixin(AbstractVillagerEntity.class)\n public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n-    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n-\n-    /**\n-     * @author i509VCB - February 17th, 2020 - 1.14.4\n-     *\n-     * @reason Here we apply the Trade Mutators. For a villager we will apply our mutators and then add them to the villager's merchant offers.\n-     * If a wandering trader is the subject here, we do nothing since that merchant would already have it's new merchant offers.\n-     *\n-     * @todo: Do we want to support Trade Mutators on Wandering Trader's TradeOffers?\n-     *\n-     * @param givenMerchantOffers The merchant's current merchant offers.\n-     * @param newTrades The trade factories representing the new trades this villager will receive.\n-     * @param maxNumbers The maximum amount of trades for this villager to receive.\n-     * @param ci CallbackInfo.\n-     */\n-    @Inject(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\", at = @At(\"TAIL\"))\n-    private void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n-        if ((Object) this instanceof VillagerEntity) {\n-            VillagerEntity villager = (VillagerEntity) (Object) this;\n-            SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) impl$newOffers, (Profession) villager.getVillagerData().getProfession(), villager.getVillagerData().getLevel(), this.rand);\n-            givenMerchantOffers.addAll(this.impl$newOffers); // Finally add the mutated offers to the trade offer map.\n-            this.impl$newOffers.clear(); // And clean up our temp values\n-        }\n-    }\n-\n     /**\n-     * @author i509VCB - February 17th, 2020 - 1.14.4\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason In order to apply the Trade mutators, we need a way to intercept the merchant offers. In VillagerEntityMixin we override this redirect to capture all the merchant offers being added to the merchant.\n+     * This does the exact same as vanilla but the VillagerEntity and WanderingTraderEntity would override this to implement their own logic.\n      *\n-     * @reason In order to apply the Trade mutators, we need to redirect addition to the MerchantOffers till the all offers have been \"created\".\n      * @param merchantOffers The current offers the villager has.\n      * @param offer The merchant offer to add.\n      * @return true.\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\nindex 12e4deff1..7022eec7b 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n", "chunk": "@@ -53,10 +46,14 @@ public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n      * @param offer The merchant offer to add.\n      * @return true.\n      */\n-    @Redirect(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n-        at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/MerchantOffers;add(Lnet/minecraft/item/MerchantOffer;)Z\")\n+    @Redirect(\n+        method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n+        at = @At(\n+            value = \"INVOKE\",\n+            target = \"Lnet/minecraft/item/MerchantOffers;add(Lnet/minecraft/item/MerchantOffer;)Z\"\n+        )\n     )\n-    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+    protected boolean impl$addNewOfferToTempMap(final MerchantOffers merchantOffers, final MerchantOffer offer) {\n         return merchantOffers.add(offer);\n     }\n \n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMDU1Ng==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382400556", "body": "So there's a bit of a elegant hack to doing this:\r\nYou can redirect to do the same as the original method, and then override this injection method in `VillagerEntityMixin` to do all this logic that otherwise you'd be doing.\r\n\r\nI do this with WorldMixin_Tracker and ServerWorldMixin_Tracker to do extra logic only on server worlds for injections that are in the subclass.", "bodyText": "So there's a bit of a elegant hack to doing this:\nYou can redirect to do the same as the original method, and then override this injection method in VillagerEntityMixin to do all this logic that otherwise you'd be doing.\nI do this with WorldMixin_Tracker and ServerWorldMixin_Tracker to do extra logic only on server worlds for injections that are in the subclass.", "bodyHTML": "<p dir=\"auto\">So there's a bit of a elegant hack to doing this:<br>\nYou can redirect to do the same as the original method, and then override this injection method in <code>VillagerEntityMixin</code> to do all this logic that otherwise you'd be doing.</p>\n<p dir=\"auto\">I do this with WorldMixin_Tracker and ServerWorldMixin_Tracker to do extra logic only on server worlds for injections that are in the subclass.</p>", "author": "gabizou", "createdAt": "2020-02-21T05:12:04Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * This file is part of Sponge, licensed under the MIT License (MIT).\n+ *\n+ * Copyright (c) SpongePowered <https://www.spongepowered.org>\n+ * Copyright (c) contributors\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.spongepowered.common.mixin.core.entity.merchant.villager;\n+\n+import net.minecraft.entity.merchant.villager.AbstractVillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerTrades;\n+import net.minecraft.item.MerchantOffer;\n+import net.minecraft.item.MerchantOffers;\n+import org.spongepowered.api.data.type.Profession;\n+import org.spongepowered.api.entity.living.trader.Villager;\n+import org.spongepowered.api.item.merchant.TradeOffer;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n+import org.spongepowered.common.registry.SpongeVillagerRegistry;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@Mixin(AbstractVillagerEntity.class)\n+public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n+    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n+\n+    /**\n+     * @author i509VCB - February 17th, 2020 - 1.14.4\n+     *\n+     * @reason Here we apply the Trade Mutators. For a villager we will apply our mutators and then add them to the villager's merchant offers.\n+     * If a wandering trader is the subject here, we do nothing since that merchant would already have it's new merchant offers.\n+     *\n+     * @todo: Do we want to support Trade Mutators on Wandering Trader's TradeOffers?\n+     *\n+     * @param givenMerchantOffers The merchant's current merchant offers.\n+     * @param newTrades The trade factories representing the new trades this villager will receive.\n+     * @param maxNumbers The maximum amount of trades for this villager to receive.\n+     * @param ci CallbackInfo.\n+     */\n+    @Inject(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\", at = @At(\"TAIL\"))\n+    private void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+        if ((Object) this instanceof VillagerEntity) {", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY5Mzg5MA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382693890", "bodyText": "So something similar to how you did impl$wrapTileEntityTick in WorldMixin_Tracker and then override it in ServerWorldMixin_Tracker", "author": "i509VCB", "createdAt": "2020-02-21T16:55:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMDU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjg3Nzg2NA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382877864", "bodyText": "Yep, precisely", "author": "gabizou", "createdAt": "2020-02-22T02:22:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMDU1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\nindex 37df6c14c..12e4deff1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n", "chunk": "@@ -40,40 +40,15 @@\n import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n import org.spongepowered.common.registry.SpongeVillagerRegistry;\n \n-import java.util.ArrayList;\n import java.util.List;\n \n @Mixin(AbstractVillagerEntity.class)\n public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n-    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n-\n-    /**\n-     * @author i509VCB - February 17th, 2020 - 1.14.4\n-     *\n-     * @reason Here we apply the Trade Mutators. For a villager we will apply our mutators and then add them to the villager's merchant offers.\n-     * If a wandering trader is the subject here, we do nothing since that merchant would already have it's new merchant offers.\n-     *\n-     * @todo: Do we want to support Trade Mutators on Wandering Trader's TradeOffers?\n-     *\n-     * @param givenMerchantOffers The merchant's current merchant offers.\n-     * @param newTrades The trade factories representing the new trades this villager will receive.\n-     * @param maxNumbers The maximum amount of trades for this villager to receive.\n-     * @param ci CallbackInfo.\n-     */\n-    @Inject(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\", at = @At(\"TAIL\"))\n-    private void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n-        if ((Object) this instanceof VillagerEntity) {\n-            VillagerEntity villager = (VillagerEntity) (Object) this;\n-            SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) impl$newOffers, (Profession) villager.getVillagerData().getProfession(), villager.getVillagerData().getLevel(), this.rand);\n-            givenMerchantOffers.addAll(this.impl$newOffers); // Finally add the mutated offers to the trade offer map.\n-            this.impl$newOffers.clear(); // And clean up our temp values\n-        }\n-    }\n-\n     /**\n-     * @author i509VCB - February 17th, 2020 - 1.14.4\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason In order to apply the Trade mutators, we need a way to intercept the merchant offers. In VillagerEntityMixin we override this redirect to capture all the merchant offers being added to the merchant.\n+     * This does the exact same as vanilla but the VillagerEntity and WanderingTraderEntity would override this to implement their own logic.\n      *\n-     * @reason In order to apply the Trade mutators, we need to redirect addition to the MerchantOffers till the all offers have been \"created\".\n      * @param merchantOffers The current offers the villager has.\n      * @param offer The merchant offer to add.\n      * @return true.\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\nindex 12e4deff1..7022eec7b 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n", "chunk": "@@ -53,10 +46,14 @@ public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n      * @param offer The merchant offer to add.\n      * @return true.\n      */\n-    @Redirect(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n-        at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/MerchantOffers;add(Lnet/minecraft/item/MerchantOffer;)Z\")\n+    @Redirect(\n+        method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n+        at = @At(\n+            value = \"INVOKE\",\n+            target = \"Lnet/minecraft/item/MerchantOffers;add(Lnet/minecraft/item/MerchantOffer;)Z\"\n+        )\n     )\n-    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+    protected boolean impl$addNewOfferToTempMap(final MerchantOffers merchantOffers, final MerchantOffer offer) {\n         return merchantOffers.add(offer);\n     }\n \n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMDYzNA==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382400634", "body": "Same with this, if the logic is specific to `VillagerEntity`, it can be overridden in the mixin", "bodyText": "Same with this, if the logic is specific to VillagerEntity, it can be overridden in the mixin", "bodyHTML": "<p dir=\"auto\">Same with this, if the logic is specific to <code>VillagerEntity</code>, it can be overridden in the mixin</p>", "author": "gabizou", "createdAt": "2020-02-21T05:12:29Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * This file is part of Sponge, licensed under the MIT License (MIT).\n+ *\n+ * Copyright (c) SpongePowered <https://www.spongepowered.org>\n+ * Copyright (c) contributors\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.spongepowered.common.mixin.core.entity.merchant.villager;\n+\n+import net.minecraft.entity.merchant.villager.AbstractVillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerEntity;\n+import net.minecraft.entity.merchant.villager.VillagerTrades;\n+import net.minecraft.item.MerchantOffer;\n+import net.minecraft.item.MerchantOffers;\n+import org.spongepowered.api.data.type.Profession;\n+import org.spongepowered.api.entity.living.trader.Villager;\n+import org.spongepowered.api.item.merchant.TradeOffer;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.common.mixin.core.entity.AgeableEntityMixin;\n+import org.spongepowered.common.registry.SpongeVillagerRegistry;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+@Mixin(AbstractVillagerEntity.class)\n+public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n+    private List<MerchantOffer> impl$newOffers = new ArrayList<>();\n+\n+    /**\n+     * @author i509VCB - February 17th, 2020 - 1.14.4\n+     *\n+     * @reason Here we apply the Trade Mutators. For a villager we will apply our mutators and then add them to the villager's merchant offers.\n+     * If a wandering trader is the subject here, we do nothing since that merchant would already have it's new merchant offers.\n+     *\n+     * @todo: Do we want to support Trade Mutators on Wandering Trader's TradeOffers?\n+     *\n+     * @param givenMerchantOffers The merchant's current merchant offers.\n+     * @param newTrades The trade factories representing the new trades this villager will receive.\n+     * @param maxNumbers The maximum amount of trades for this villager to receive.\n+     * @param ci CallbackInfo.\n+     */\n+    @Inject(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\", at = @At(\"TAIL\"))\n+    private void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+        if ((Object) this instanceof VillagerEntity) {\n+            VillagerEntity villager = (VillagerEntity) (Object) this;\n+            SpongeVillagerRegistry.getInstance().populateOffers((Villager) this, (List<TradeOffer>) (List<?>) impl$newOffers, (Profession) villager.getVillagerData().getProfession(), villager.getVillagerData().getLevel(), this.rand);\n+            givenMerchantOffers.addAll(this.impl$newOffers); // Finally add the mutated offers to the trade offer map.\n+            this.impl$newOffers.clear(); // And clean up our temp values\n+        }\n+    }\n+\n+    /**\n+     * @author i509VCB - February 17th, 2020 - 1.14.4\n+     *\n+     * @reason In order to apply the Trade mutators, we need to redirect addition to the MerchantOffers till the all offers have been \"created\".\n+     * @param merchantOffers The current offers the villager has.\n+     * @param offer The merchant offer to add.\n+     * @return true.\n+     */\n+    @Redirect(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n+        at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/MerchantOffers;add(Lnet/minecraft/item/MerchantOffer;)Z\")\n+    )\n+    private boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n+        if ((Object) this instanceof VillagerEntity) { // Currently only villagers support trade mutators.\n+            return this.impl$newOffers.add(offer);", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\nindex 37df6c14c..12e4deff1 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n", "chunk": "@@ -81,12 +56,23 @@ public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n     @Redirect(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n         at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/MerchantOffers;add(Lnet/minecraft/item/MerchantOffer;)Z\")\n     )\n-    private boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n-        if ((Object) this instanceof VillagerEntity) { // Currently only villagers support trade mutators.\n-            return this.impl$newOffers.add(offer);\n-        }\n-\n+    protected boolean impl$addNewOfferToTempMap(MerchantOffers merchantOffers, MerchantOffer offer) {\n         return merchantOffers.add(offer);\n     }\n \n+    /**\n+     * @author i509VCB - February 21st, 2020 - 1.14.4\n+     * @reason At TAIL, all merchant offers have been selected. Implementations of this method would process trade mutators and then add to the givenMerchantOffers.\n+     *\n+     * @param givenMerchantOffers\n+     * @param newTrades\n+     * @param maxNumbers\n+     * @param ci\n+     */\n+    @Inject(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n+        at = @At(\"TAIL\"))\n+    protected void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+        // Do nothing, this is overriden by the Villager/WanderingTraderEntity\n+    }\n+\n }\n", "next_change": {"commit": "f4d95f1a15addb941f7a5e9d2e094057decd5701", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\nindex 12e4deff1..7022eec7b 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/merchant/villager/AbstractVillagerEntityMixin.java\n", "chunk": "@@ -69,9 +66,11 @@ public abstract class AbstractVillagerEntityMixin extends AgeableEntityMixin {\n      * @param maxNumbers\n      * @param ci\n      */\n-    @Inject(method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n+    @Inject(\n+        method = \"addTrades(Lnet/minecraft/item/MerchantOffers;[Lnet/minecraft/entity/merchant/villager/VillagerTrades$ITrade;I)V\",\n         at = @At(\"TAIL\"))\n-    protected void impl$addAndApplyTradeMutators(MerchantOffers givenMerchantOffers, VillagerTrades.ITrade[] newTrades, int maxNumbers, CallbackInfo ci) {\n+    protected void impl$addAndApplyTradeMutators(final MerchantOffers givenMerchantOffers,\n+        final VillagerTrades.ITrade[] newTrades, final int maxNumbers, final CallbackInfo ci) {\n         // Do nothing, this is overriden by the Villager/WanderingTraderEntity\n     }\n \n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMDc2NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382400765", "body": "The constant here should be shoved into the related (or new) `Constants` nested class.", "bodyText": "The constant here should be shoved into the related (or new) Constants nested class.", "bodyHTML": "<p dir=\"auto\">The constant here should be shoved into the related (or new) <code>Constants</code> nested class.</p>", "author": "gabizou", "createdAt": "2020-02-21T05:13:18Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java", "diffHunk": "@@ -55,15 +57,15 @@\n     @Shadow private int fuseTime;\n     @Shadow private int explosionRadius;\n \n-    @Shadow public abstract void ignite();\n-    @Shadow public abstract int getCreeperState();\n-    @Shadow public abstract void setCreeperState(int state);\n-    @Shadow private void explode() { } // explode\n+    @Shadow public abstract void shadow$ignite();\n+    @Shadow public abstract int shadow$getCreeperState();\n+    @Shadow public abstract void shadow$setCreeperState(int state);\n+    @Shadow private void shadow$explode() { } // explode\n \n-    private int fuseDuration = 30;\n-    private boolean interactPrimeCancelled;\n-    private boolean stateDirty;\n-    private boolean detonationCancelled;\n+    private int impl$fuseDuration = 30;", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java\nindex d19cff1f2..a2e4c1152 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java\n", "chunk": "@@ -62,7 +62,7 @@ public abstract class CreeperEntityMixin extends MonsterEntityMixin implements F\n     @Shadow public abstract void shadow$setCreeperState(int state);\n     @Shadow private void shadow$explode() { } // explode\n \n-    private int impl$fuseDuration = 30;\n+    private int impl$fuseDuration = Constants.Entity.Creeper.FUSE_DURATION;\n     private boolean impl$interactPrimeCancelled;\n     private boolean impl$stateDirty;\n     private boolean impl$detonationCancelled;\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMDgxNw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382400817", "body": "Fix the method name/prefixing here please", "bodyText": "Fix the method name/prefixing here please", "bodyHTML": "<p dir=\"auto\">Fix the method name/prefixing here please</p>", "author": "gabizou", "createdAt": "2020-02-21T05:13:42Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java", "diffHunk": "@@ -147,36 +149,39 @@ private void postStateChange(final int state, final CallbackInfo ci) {\n                 .shouldPlaySmoke(smoking)\n                 .shouldBreakBlocks(smoking && ((GrieferBridge) this).bridge$canGrief()))\n                 .orElseGet(() -> {\n-                    this.detonationCancelled = true;\n+                    this.impl$detonationCancelled = true;\n                     return null;\n                 });\n     }\n \n     @Inject(method = \"explode\", at = @At(\"RETURN\"))\n     private void postExplode(final CallbackInfo ci) {\n-        if (this.detonationCancelled) {\n-            this.detonationCancelled = this.isDead = false;\n+        if (this.impl$detonationCancelled) {\n+            this.impl$detonationCancelled = this.isDead = false;\n         }\n     }\n \n-    @Redirect(method = \"processInteract\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/monster/EntityCreeper;ignite()V\"))\n+    @Redirect(method = \"processInteract\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/monster/CreeperEntity;ignite()V\"))\n     private void onInteractIgnite(final CreeperEntity self) {", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java\nindex d19cff1f2..a2e4c1152 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/monster/CreeperEntityMixin.java\n", "chunk": "@@ -162,7 +162,7 @@ private void postExplode(final CallbackInfo ci) {\n     }\n \n     @Redirect(method = \"processInteract\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/monster/CreeperEntity;ignite()V\"))\n-    private void onInteractIgnite(final CreeperEntity self) {\n+    private void impl$onProcessIgnition(final CreeperEntity self) {\n         this.impl$interactPrimeCancelled = !this.bridge$shouldPrime();\n         if (!this.impl$interactPrimeCancelled) {\n             this.shadow$ignite();\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMTMyMg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382401322", "body": "Space between shadow and non-shadow fields please", "bodyText": "Space between shadow and non-shadow fields please", "bodyHTML": "<p dir=\"auto\">Space between shadow and non-shadow fields please</p>", "author": "gabizou", "createdAt": "2020-02-21T05:16:17Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java", "diffHunk": "@@ -130,46 +129,47 @@\n     @Shadow public int experienceLevel;\n     @Shadow public int experienceTotal;\n     @Shadow public float experience;\n-    @Shadow public PlayerAbilities capabilities;\n+    @Shadow public PlayerAbilities abilities;\n     @Shadow public net.minecraft.entity.player.PlayerInventory inventory;\n-    @Shadow public BlockPos bedLocation;\n-\n-    @Shadow public abstract boolean isPlayerSleeping();\n-    @Shadow public abstract boolean isSpectator();\n-    @Shadow public abstract int xpBarCap();\n-    @Shadow public abstract float getCooledAttackStrength(float adjustTicks);\n-    @Shadow public abstract float getAIMoveSpeed();\n-    @Shadow public abstract void onCriticalHit(net.minecraft.entity.Entity entityHit);\n-    @Shadow public abstract void onEnchantmentCritical(net.minecraft.entity.Entity entityHit); // onEnchantmentCritical\n-    @Shadow public abstract void addExhaustion(float p_71020_1_);\n-    @Shadow public abstract void addStat(@Nullable Stat stat, int amount);\n-    @Shadow public abstract void addStat(Stat stat);\n-    @Shadow public abstract void resetCooldown();\n-    @Shadow public abstract void spawnSweepParticles(); //spawnSweepParticles()\n-    @Shadow public abstract void takeStat(Stat stat);\n-    @Shadow protected abstract void destroyVanishingCursedItems(); // Filter vanishing curse enchanted items\n-    @Shadow public void wakeUpPlayer(final boolean immediately, final boolean updateWorldFlag, final boolean setSpawn) {};\n-    @Shadow @Nullable public abstract ItemEntity dropItem(boolean dropAll); // Overridden in EntityPlayerMPMixin for tracking\n-    @Shadow public abstract FoodStats getFoodStats();\n-    @Shadow public abstract GameProfile getGameProfile();\n-    @Shadow public abstract Scoreboard getWorldScoreboard();\n-    @Shadow public abstract String shadow$getName();\n-    @Shadow @Nullable public abstract Team getTeam();\n-    @Shadow public abstract void addExperienceLevel(int levels);\n-    @Shadow public abstract void addScore(int scoreIn);\n-\n-    @Shadow protected abstract void spawnShoulderEntities();\n-    @Shadow public abstract boolean isCreative();\n-\n-    @Shadow public boolean canAttackPlayer(final PlayerEntity other) {\n+    @Shadow public BlockPos spawnPos;\n+\n+    @Shadow public abstract boolean shadow$isSpectator();\n+    @Shadow public abstract int shadow$xpBarCap();\n+    @Shadow public abstract float shadow$getCooledAttackStrength(float adjustTicks);\n+    @Shadow public abstract float shadow$getAIMoveSpeed();\n+    @Shadow public abstract void shadow$onCriticalHit(net.minecraft.entity.Entity entityHit);\n+    @Shadow public abstract void shadow$onEnchantmentCritical(net.minecraft.entity.Entity entityHit); // onEnchantmentCritical\n+    @Shadow public abstract void shadow$addExhaustion(float p_71020_1_);\n+    @Shadow public abstract void shadow$addStat(ResourceLocation stat, int amount);\n+    @Shadow public abstract void shadow$addStat(@Nullable Stat stat, int amount);\n+    @Shadow public abstract void shadow$addStat(ResourceLocation stat);\n+    @Shadow public abstract void shadow$resetCooldown();\n+    @Shadow public abstract void shadow$spawnSweepParticles(); //spawnSweepParticles()\n+    @Shadow public abstract void shadow$takeStat(Stat stat);\n+    @Shadow protected abstract void shadow$destroyVanishingCursedItems(); // Filter vanishing curse enchanted items\n+    @Shadow public void shadow$wakeUpPlayer(final boolean immediately, final boolean updateWorldFlag, final boolean setSpawn) {};\n+    @Shadow @Nullable public abstract ItemEntity shadow$dropItem(boolean dropAll); // Overridden in EntityPlayerMPMixin for tracking\n+    @Shadow @Nullable public abstract ItemEntity shadow$dropItem(final ItemStack droppedItem, final boolean dropAround, final boolean traceItem);\n+    @Shadow public abstract FoodStats shadow$getFoodStats();\n+    @Shadow public abstract GameProfile shadow$getGameProfile();\n+    @Shadow public abstract Scoreboard shadow$getWorldScoreboard();\n+    @Shadow public abstract void shadow$addExperienceLevel(int levels);\n+    @Shadow public abstract void shadow$addScore(int scoreIn);\n+    @Shadow protected abstract void shadow$spawnShoulderEntities();\n+    @Shadow public abstract boolean shadow$isCreative();\n+    @Shadow public boolean shadow$canAttackPlayer(final PlayerEntity other) {\n         return false;\n     }\n+    @Shadow public abstract SoundCategory shadow$getSoundCategory();\n \n-    private boolean affectsSpawning = true;\n-    private Vector3d targetedLocation = VecHelper.toVector3d(this.world.getSpawnPoint());\n-    private boolean dontRecalculateExperience;\n-    private boolean shouldRestoreInventory = false;\n-    protected final boolean isFake = SpongeImplHooks.isFakePlayer((PlayerEntity) (Object) this);\n+    @Shadow public abstract String shadow$getScoreboardName();\n+\n+    @Shadow public Container openContainer;", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\nindex 77f125cd8..d910b9071 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n", "chunk": "@@ -161,18 +162,14 @@ public abstract class PlayerEntityMixin extends LivingEntityMixin implements Pla\n         return false;\n     }\n     @Shadow public abstract SoundCategory shadow$getSoundCategory();\n-\n     @Shadow public abstract String shadow$getScoreboardName();\n \n-    @Shadow public Container openContainer;\n     private boolean impl$affectsSpawning = true;\n     private Vector3d impl$targetedLocation = VecHelper.toVector3d(this.world.getSpawnPoint());\n     private boolean impl$dontRecalculateExperience;\n     private boolean impl$shouldRestoreInventory = false;\n     protected final boolean impl$isFake = SpongeImplHooks.isFakePlayer((PlayerEntity) (Object) this);\n \n-\n-\n     @Inject(method = \"getDisplayName\", at = @At(\"RETURN\"), cancellable = true)\n     private void impl$getDisplayNameWithParsing(final CallbackInfoReturnable<ITextComponent> ci) {\n         ci.setReturnValue(LegacyTexts.parseComponent((StringTextComponent) ci.getReturnValue(), SpongeTexts.COLOR_CHAR));\n", "next_change": {"commit": "74ea9174d3b37b356b1d3fb64e1a5cbe5ad3ad0e", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java b/invalid/main/java/org/spongepowered/common/mixin/invalid/core/entity/player/PlayerEntityMixin.java\nsimilarity index 57%\nrename from src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\nrename to invalid/main/java/org/spongepowered/common/mixin/invalid/core/entity/player/PlayerEntityMixin.java\nindex d910b9071..c682a973b 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n+++ b/invalid/main/java/org/spongepowered/common/mixin/invalid/core/entity/player/PlayerEntityMixin.java\n", "chunk": "@@ -92,142 +72,45 @@\n import org.spongepowered.asm.mixin.Shadow;\n import org.spongepowered.asm.mixin.injection.At;\n import org.spongepowered.asm.mixin.injection.Inject;\n-import org.spongepowered.asm.mixin.injection.Redirect;\n-import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n import org.spongepowered.common.SpongeImpl;\n import org.spongepowered.common.SpongeImplHooks;\n import org.spongepowered.common.bridge.LocationTargetingBridge;\n import org.spongepowered.common.bridge.entity.player.PlayerEntityBridge;\n-import org.spongepowered.common.bridge.world.ServerWorldBridge;\n import org.spongepowered.common.bridge.world.WorldBridge;\n-import org.spongepowered.common.data.processor.common.ExperienceHolderUtils;\n-import org.spongepowered.common.event.ShouldFire;\n-import org.spongepowered.common.event.SpongeCommonEventFactory;\n+import org.spongepowered.common.data.provider.entity.player.ExperienceHolderUtils;\n import org.spongepowered.common.event.damage.DamageEventHandler;\n-import org.spongepowered.common.event.tracking.IPhaseState;\n-import org.spongepowered.common.event.tracking.PhaseContext;\n-import org.spongepowered.common.event.tracking.PhaseTracker;\n import org.spongepowered.common.item.util.ItemStackUtil;\n import org.spongepowered.common.mixin.core.entity.LivingEntityMixin;\n-import org.spongepowered.common.text.SpongeTexts;\n-import org.spongepowered.common.text.serializer.LegacyTexts;\n-import org.spongepowered.common.util.VecHelper;\n-import org.spongepowered.math.vector.Vector3d;\n \n+import javax.annotation.Nullable;\n import java.util.ArrayList;\n import java.util.List;\n-import java.util.Optional;\n-import java.util.Random;\n import java.util.stream.Collectors;\n \n-import javax.annotation.Nullable;\n-\n @Mixin(PlayerEntity.class)\n public abstract class PlayerEntityMixin extends LivingEntityMixin implements PlayerEntityBridge, LocationTargetingBridge {\n \n     @Shadow public int experienceLevel;\n     @Shadow public int experienceTotal;\n     @Shadow public float experience;\n-    @Shadow public PlayerAbilities abilities;\n     @Shadow public net.minecraft.entity.player.PlayerInventory inventory;\n-    @Shadow public BlockPos spawnPos;\n-    @Shadow public Container openContainer;\n \n-    @Shadow public abstract boolean shadow$isSpectator();\n     @Shadow public abstract int shadow$xpBarCap();\n     @Shadow public abstract float shadow$getCooledAttackStrength(float adjustTicks);\n     @Shadow public abstract float shadow$getAIMoveSpeed();\n-    @Shadow public abstract void shadow$onCriticalHit(net.minecraft.entity.Entity entityHit);\n-    @Shadow public abstract void shadow$onEnchantmentCritical(net.minecraft.entity.Entity entityHit); // onEnchantmentCritical\n+    @Shadow public abstract void shadow$onCriticalHit(Entity entityHit);\n+    @Shadow public abstract void shadow$onEnchantmentCritical(Entity entityHit);\n     @Shadow public abstract void shadow$addExhaustion(float p_71020_1_);\n     @Shadow public abstract void shadow$addStat(ResourceLocation stat, int amount);\n-    @Shadow public abstract void shadow$addStat(@Nullable Stat stat, int amount);\n-    @Shadow public abstract void shadow$addStat(ResourceLocation stat);\n     @Shadow public abstract void shadow$resetCooldown();\n-    @Shadow public abstract void shadow$spawnSweepParticles(); //spawnSweepParticles()\n-    @Shadow public abstract void shadow$takeStat(Stat stat);\n-    @Shadow protected abstract void shadow$destroyVanishingCursedItems(); // Filter vanishing curse enchanted items\n+    @Shadow public abstract void shadow$spawnSweepParticles();\n     @Shadow public void shadow$wakeUpPlayer(final boolean immediately, final boolean updateWorldFlag, final boolean setSpawn) {};\n-    @Shadow @Nullable public abstract ItemEntity shadow$dropItem(boolean dropAll); // Overridden in EntityPlayerMPMixin for tracking\n-    @Shadow @Nullable public abstract ItemEntity shadow$dropItem(final ItemStack droppedItem, final boolean dropAround, final boolean traceItem);\n-    @Shadow public abstract FoodStats shadow$getFoodStats();\n-    @Shadow public abstract GameProfile shadow$getGameProfile();\n-    @Shadow public abstract Scoreboard shadow$getWorldScoreboard();\n     @Shadow public abstract void shadow$addExperienceLevel(int levels);\n     @Shadow public abstract void shadow$addScore(int scoreIn);\n-    @Shadow protected abstract void shadow$spawnShoulderEntities();\n-    @Shadow public abstract boolean shadow$isCreative();\n-    @Shadow public boolean shadow$canAttackPlayer(final PlayerEntity other) {\n-        return false;\n-    }\n     @Shadow public abstract SoundCategory shadow$getSoundCategory();\n-    @Shadow public abstract String shadow$getScoreboardName();\n \n-    private boolean impl$affectsSpawning = true;\n-    private Vector3d impl$targetedLocation = VecHelper.toVector3d(this.world.getSpawnPoint());\n     private boolean impl$dontRecalculateExperience;\n-    private boolean impl$shouldRestoreInventory = false;\n-    protected final boolean impl$isFake = SpongeImplHooks.isFakePlayer((PlayerEntity) (Object) this);\n-\n-    @Inject(method = \"getDisplayName\", at = @At(\"RETURN\"), cancellable = true)\n-    private void impl$getDisplayNameWithParsing(final CallbackInfoReturnable<ITextComponent> ci) {\n-        ci.setReturnValue(LegacyTexts.parseComponent((StringTextComponent) ci.getReturnValue(), SpongeTexts.COLOR_CHAR));\n-    }\n-\n-    @Override\n-    public int bridge$getExperienceSinceLevel() {\n-        return this.experienceTotal - ExperienceHolderUtils.xpAtLevel(this.experienceLevel);\n-    }\n-\n-    @Override\n-    public void bridge$setExperienceSinceLevel(final int experience) {\n-        this.experienceTotal = ExperienceHolderUtils.xpAtLevel(this.experienceLevel) + experience;\n-        this.experience = (float) experience / this.shadow$xpBarCap();\n-    }\n-\n-\n-    @Override\n-    public void bridge$recalculateTotalExperience() {\n-        if (!this.impl$dontRecalculateExperience) {\n-            boolean isInaccurate = ExperienceHolderUtils.getLevelForExp(this.experienceTotal) != this.experienceLevel;\n-            if (!isInaccurate) {\n-                final float experienceLess = (this.bridge$getExperienceSinceLevel() - 0.5f) / this.shadow$xpBarCap();\n-                final float experienceMore = (this.bridge$getExperienceSinceLevel() + 0.5f) / this.shadow$xpBarCap();\n-                isInaccurate = this.experience < experienceLess || this.experience > experienceMore;\n-            }\n-            if (isInaccurate) {\n-                final int newExperienceInLevel = (int) (this.experience * this.shadow$xpBarCap());\n-                this.experienceTotal = ExperienceHolderUtils.xpAtLevel(this.experienceLevel) + newExperienceInLevel;\n-                this.experience = (float) newExperienceInLevel / this.shadow$xpBarCap();\n-            }\n-        }\n-    }\n-\n-    /**\n-     * @author JBYoshi - October 11, 2017\n-     * @reason This makes the experience updating more accurate by using\n-     * integer-based calculations instead of floating-point calculations, which\n-     * are known to cause <a href=\"https://github.com/SpongePowered/SpongeVanilla/issues/340\">\n-     * rounding errors.</a>\n-     */\n-    @Inject(method = \"addExperienceLevel\", at = @At(\"HEAD\"), cancellable = true)\n-    private void onAddExperienceLevels(final int levels, final CallbackInfo ci) {\n-        if (((WorldBridge) this.world).bridge$isFake()) {\n-            return;\n-        }\n-        if (!this.impl$dontRecalculateExperience) {\n-            final int newLevel = Math.max(this.experienceLevel + levels, 0);\n-            this.postEventAndUpdateExperience(ExperienceHolderUtils.xpAtLevel(newLevel)\n-                    + (int) (this.experience * ExperienceHolderUtils.getExpBetweenLevels(newLevel)));\n-            ci.cancel();\n-        }\n-    }\n-\n-    @Inject(method = \"onEnchant\", at = @At(\"RETURN\"))\n-    private void onEnchantChangeExperienceLevels(final ItemStack item, final int levels, final CallbackInfo ci) {\n-        this.bridge$recalculateTotalExperience();\n-    }\n \n     /**\n      * @author JBYoshi - May 17, 2017\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMTkwNg==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382401906", "body": "```suggestion\r\n    @Redirect(method = \"canPlayerEdit\",\r\n        at = @At(value = \"INVOKE\", \r\n            target = \"Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z\"))\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Redirect(method = \"canPlayerEdit\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z\"))\n          \n          \n            \n                @Redirect(method = \"canPlayerEdit\",\n          \n          \n            \n                    at = @At(value = \"INVOKE\", \n          \n          \n            \n                        target = \"Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z\"))", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">@Redirect</span>(<span class=\"pl-c1\">method</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>canPlayerEdit<span class=\"pl-pds\">\"</span></span>,<span class=\"x x-first\"> </span><span class=\"pl-c1 x\">at</span><span class=\"x\"> </span><span class=\"pl-k x\">=</span><span class=\"x\"> </span><span class=\"pl-k x\">@At</span><span class=\"x\">(</span><span class=\"pl-c1 x\">value</span><span class=\"x\"> </span><span class=\"pl-k x\">=</span><span class=\"x\"> </span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">INVOKE</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">, </span><span class=\"pl-c1 x\">target</span><span class=\"x\"> </span><span class=\"pl-k x\">=</span><span class=\"x\"> </span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z</span><span class=\"pl-pds x\">\"</span></span><span class=\"x x-last\">))</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">@Redirect</span>(<span class=\"pl-c1\">method</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>canPlayerEdit<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        at <span class=\"pl-k\">=</span> <span class=\"pl-k\">@At</span>(<span class=\"pl-c1\">value</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>INVOKE<span class=\"pl-pds\">\"</span></span>, </td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            target <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z<span class=\"pl-pds\">\"</span></span>))</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "gabizou", "createdAt": "2020-02-21T05:19:00Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java", "diffHunk": "@@ -407,20 +406,21 @@ private void spongePlaySound(final World world, final PlayerEntity player, final\n      * however, sometimes that isn't enough.\n      *\n      * @param stack The item stack in use\n-     * @param block The target block\n+     * @param tagManager The tag manager\n+     * @param cachedBlockInfo The cached block info.\n      * @param pos The target position\n      * @param facing The facing direction of the player\n      * @param sameStack The very same stack as the first parameter\n      * @return Check if the player is a fake player, if it is, then just do\n      *  the same return, otherwise, throw an event first and then return if the\n      *  event is cancelled, or the stack.canPlaceOn\n      */\n-    @Redirect(method = \"canPlayerEdit\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/block/Block;)Z\"))\n-    private boolean canEditSpongeThrowChangePreEvent(\n-        final ItemStack stack, final Block block, final BlockPos pos, final Direction facing, final ItemStack sameStack) {\n+    @Redirect(method = \"canPlayerEdit\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z\"))", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\nindex 77f125cd8..d910b9071 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n", "chunk": "@@ -415,7 +412,9 @@ public void onDeath(final DamageSource cause) {\n      *  the same return, otherwise, throw an event first and then return if the\n      *  event is cancelled, or the stack.canPlaceOn\n      */\n-    @Redirect(method = \"canPlayerEdit\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z\"))\n+    @Redirect(method = \"canPlayerEdit\",\n+        at = @At(value = \"INVOKE\",\n+            target = \"Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z\"))\n     private boolean impl$canEditSpongeThrowChangePreEvent(\n         final ItemStack stack, final NetworkTagManager tagManager, final CachedBlockInfo cachedBlockInfo, final BlockPos pos, final Direction facing, final ItemStack sameStack) {\n         // Lazy evaluation, if the stack isn't placeable anyways, might as well not\n", "next_change": {"commit": "74ea9174d3b37b356b1d3fb64e1a5cbe5ad3ad0e", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java b/invalid/main/java/org/spongepowered/common/mixin/invalid/core/entity/player/PlayerEntityMixin.java\nsimilarity index 57%\nrename from src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\nrename to invalid/main/java/org/spongepowered/common/mixin/invalid/core/entity/player/PlayerEntityMixin.java\nindex d910b9071..c682a973b 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n+++ b/invalid/main/java/org/spongepowered/common/mixin/invalid/core/entity/player/PlayerEntityMixin.java\n", "chunk": "@@ -296,293 +179,6 @@ private void postEventAndUpdateExperience(final int finalExperience) {\n         this.experienceLevel = finalLevel;\n     }\n \n-    @Inject(method = \"readAdditional\", at = @At(\"RETURN\"))\n-    private void recalculateXpOnLoad(final CompoundNBT compound, final CallbackInfo ci) {\n-        // Fix the mistakes of /xp commands past.\n-        this.bridge$recalculateTotalExperience();\n-    }\n-\n-    /**\n-     * @author blood - May 12th, 2016\n-     * @author i509VCB - February 17th, 2020 - Update to 1.14.4\n-     *\n-     * @reason SpongeForge requires an overwrite so we do it here instead. This handles player death events.\n-     */\n-    @Overwrite\n-    @Override\n-    public void onDeath(final DamageSource cause) {\n-        // Sponge start - Fire DestructEntityEvent.Death\n-        final boolean isMainThread = Sponge.isServerAvailable() && Sponge.getServer().onMainThread();\n-        final Optional<DestructEntityEvent.Death>\n-                event = SpongeCommonEventFactory.callDestructEntityEventDeath((PlayerEntity) (Object) this, cause, isMainThread);\n-        if (event.map(Cancellable::isCancelled).orElse(true)) {\n-            return;\n-        }\n-        // Sponge end\n-        super.onDeath(cause);\n-\n-        this.shadow$setPosition(this.posX, this.posY, this.posZ);\n-        if (!this.shadow$isSpectator()) {\n-            this.shadow$spawnDrops(cause);\n-        }\n-\n-        if (cause != null) {\n-            this.shadow$setMotion((-MathHelper.cos((this.attackedAtYaw + this.rotationYaw) * ((float)Math.PI / 180F)) * 0.1F), 0.1F, (-MathHelper.sin((this.attackedAtYaw + this.rotationYaw) * ((float) Math.PI / 180F)) * 0.1F));\n-        } else {\n-            this.shadow$setMotion(0.0D, 0.1D, 0.0D);\n-        }\n-\n-        this.shadow$addStat(Stats.DEATHS);\n-        this.shadow$takeStat(Stats.CUSTOM.get(Stats.TIME_SINCE_DEATH));\n-        this.shadow$takeStat(Stats.CUSTOM.get(Stats.TIME_SINCE_REST));\n-        this.shadow$extinguish();\n-        this.shadow$setFlag(0, false);\n-    }\n-\n-    @Redirect(method = \"tick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/player/PlayerEntity;isSleeping()Z\"))\n-    private boolean impl$postSleepingEvent(final PlayerEntity self) {\n-        if (self.isSleeping()) {\n-            if (!((WorldBridge) this.world).bridge$isFake()) {\n-                final CauseStackManager csm = Sponge.getCauseStackManager();\n-                csm.pushCause(this);\n-                final BlockPos bedLocation = this.spawnPos;\n-                final BlockSnapshot snapshot = ((org.spongepowered.api.world.World) this.world).createSnapshot(bedLocation.getX(), bedLocation.getY(), bedLocation.getZ());\n-                SpongeImpl.postEvent(SpongeEventFactory.createSleepingEventTick(csm.getCurrentCause(), snapshot, (Humanoid) this));\n-                csm.popCause();\n-            }\n-            return true;\n-        }\n-        return false;\n-    }\n-\n-    /**\n-     * @author gabizou - January 4th, 2016\n-     * @author i509VCB - January 17th, 2020 - 1.14.4\n-     *\n-     * This prevents sounds from being sent to the server by players who are vanish.\n-     */\n-    @Redirect(method = \"playSound\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;playSound(Lnet/minecraft/entity/player/PlayerEntity;DDDLnet/minecraft/util/SoundEvent;Lnet/minecraft/util/SoundCategory;FF)V\"))\n-    private void impl$vanishPlaySound(final World world, final PlayerEntity player, final double x, final double y, final double z, final SoundEvent sound, final SoundCategory category, final float volume, final float pitch) {\n-        if (!this.bridge$isVanished()) {\n-            this.world.playSound(player, x, y, z, sound, category, volume, pitch);\n-        }\n-    }\n-\n-    @Override\n-    public boolean bridge$affectsSpawning() {\n-        return this.impl$affectsSpawning && !this.shadow$isSpectator();\n-    }\n-\n-    @Override\n-    public void bridge$setAffectsSpawning(final boolean affectsSpawning) {\n-        this.impl$affectsSpawning = affectsSpawning;\n-    }\n-\n-    @Override\n-    public Vector3d bridge$getTargetedLocation() {\n-        return this.impl$targetedLocation;\n-    }\n-\n-    @Override\n-    public void bridge$setTargetedLocation(@Nullable final Vector3d vec) {\n-        this.impl$targetedLocation = vec != null ? vec : VecHelper.toVector3d(this.world.getSpawnPoint());\n-        //noinspection ConstantConditions\n-        if (!((PlayerEntity) (Object) this instanceof ServerPlayerEntity)) {\n-            this.world.setSpawnPoint(VecHelper.toBlockPos(this.impl$targetedLocation));\n-        }\n-    }\n-\n-    /**\n-     * @author gabizou - September 4th, 2018\n-     * @author i509VCB - February 17th, 2020 - 1.14.4\n-     * @reason Bucket placement and other placements can be \"detected\"\n-     * for pre change events prior to them actually processing their logic,\n-     * this in effect can prevent item duplication issues when the block\n-     * changes are cancelled, but inventory is already modified. It would\n-     * be considered that during interaction packets, inventory is monitored,\n-     * however, sometimes that isn't enough.\n-     *\n-     * @param stack The item stack in use\n-     * @param tagManager The tag manager\n-     * @param cachedBlockInfo The cached block info.\n-     * @param pos The target position\n-     * @param facing The facing direction of the player\n-     * @param sameStack The very same stack as the first parameter\n-     * @return Check if the player is a fake player, if it is, then just do\n-     *  the same return, otherwise, throw an event first and then return if the\n-     *  event is cancelled, or the stack.canPlaceOn\n-     */\n-    @Redirect(method = \"canPlayerEdit\",\n-        at = @At(value = \"INVOKE\",\n-            target = \"Lnet/minecraft/item/ItemStack;canPlaceOn(Lnet/minecraft/tags/NetworkTagManager;Lnet/minecraft/util/CachedBlockInfo;)Z\"))\n-    private boolean impl$canEditSpongeThrowChangePreEvent(\n-        final ItemStack stack, final NetworkTagManager tagManager, final CachedBlockInfo cachedBlockInfo, final BlockPos pos, final Direction facing, final ItemStack sameStack) {\n-        // Lazy evaluation, if the stack isn't placeable anyways, might as well not\n-        // call the logic.\n-        if (!stack.canPlaceOn(tagManager, cachedBlockInfo)) {\n-            return false;\n-        }\n-        // If we're going to throw an event, then do it.\n-        // Just sanity checks, if the player is not in a managed world, then don't bother either.\n-        // some fake players may exist in pseudo worlds as well, which means we don't want to\n-        // process on them since the world is not a valid world to plugins.\n-        if (this.world instanceof WorldBridge && !((WorldBridge) this.world).bridge$isFake() && ShouldFire.CHANGE_BLOCK_EVENT_PRE) {\n-            // Note that this can potentially cause phase contexts to auto populate frames\n-            // we shouldn't rely so much on them, but sometimes the extra information is provided\n-            // through this method.\n-            try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n-                // Go ahead and add the item stack in use, just in the event the current phase contexts don't provide\n-                // that information.\n-                frame.addContext(EventContextKeys.USED_ITEM, ItemStackUtil.snapshotOf(stack));\n-                // Then go ahead and call the event and return if it was cancelled\n-                // if it was cancelled, then there should be no changes needed to roll back\n-                return !SpongeCommonEventFactory.callChangeBlockEventPre((ServerWorldBridge) this.world, pos, this).isCancelled();\n-            }\n-        }\n-        // Otherwise, if all else is ignored, or we're not throwing events, we're just going to return the\n-        // default value: true.\n-        return true;\n-    }\n-\n-    /**\n-     * @author gabizou - June 13th, 2016\n-     * @reason Reverts the method to flow through our systems, Forge patches\n-     * this to throw an ItemTossEvent, but we'll be throwing it regardless in\n-     * SpongeForge's handling.\n-     *\n-     * @param itemStackIn\n-     * @param unused\n-     * @return\n-     */\n-    @Overwrite\n-    @Nullable\n-    public ItemEntity dropItem(final ItemStack itemStackIn, final boolean unused) {\n-        return this.shadow$dropItem(itemStackIn, false, false);\n-    }\n-\n-    /**\n-     * @author gabizou - June 4th, 2016\n-     * @author i509VCB - February 17th, 2020 - 1.14.4\n-     *\n-     * @reason When a player drops an item, all methods flow through here instead of {@link Entity#entityDropItem(IItemProvider, int)}\n-     * because of the idea of {@code dropAround} and {@code traceItem}.\n-     *\n-     * @param droppedItem The item to drop\n-     * @param dropAround If true, the item is dropped around the player, otherwise thrown in front of the player\n-     * @param traceItem If true, the item is thrown as the player\n-     * @return The entity, if spawned correctly and not captured in any way\n-     */\n-    @Nullable\n-    @Overwrite\n-    public ItemEntity dropItem(final ItemStack droppedItem, final boolean dropAround, final boolean traceItem) {\n-        if (droppedItem.isEmpty()) {\n-            return null;\n-        }\n-        // Sponge Start - redirect to our handling to capture and throw events.\n-        if (!((WorldBridge) this.world).bridge$isFake()) {\n-            ((PlayerEntityBridge) this).bridge$shouldRestoreInventory(false);\n-            final PlayerEntity player = (PlayerEntity) (PlayerEntityBridge) this;\n-\n-            final double posX1 = player.posX;\n-            final double posY1 = player.posY - 0.3 + player.getEyeHeight();\n-            final double posZ1 = player.posZ;\n-            // Now the real fun begins.\n-            final ItemStack item;\n-            final ItemStackSnapshot snapshot = ItemStackUtil.snapshotOf(droppedItem);\n-            final List<ItemStackSnapshot> original = new ArrayList<>();\n-            original.add(snapshot);\n-\n-            final PhaseContext<?> phaseContext = PhaseTracker.getInstance().getCurrentContext();\n-            @SuppressWarnings(\"RawTypeCanBeGeneric\") final IPhaseState currentState = phaseContext.state;\n-\n-            try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n-\n-                item = SpongeCommonEventFactory.throwDropItemAndConstructEvent((PlayerEntity) (PlayerEntityBridge) this, posX1, posY1, posZ1, snapshot, original, frame);\n-\n-                if (item == null || item.isEmpty()) {\n-                    return null;\n-                }\n-\n-\n-                // Here is where we would potentially perform item pre-merging (merge the item stacks with previously captured item stacks\n-                // and only if those stacks can be stacked (count increased). Otherwise, we'll just continue to throw the entity item.\n-                // For now, due to refactoring a majority of all of this code, pre-merging is disabled entirely.\n-\n-                final ItemEntity itemEntity = new ItemEntity(player.world, posX1, posY1, posZ1, droppedItem);\n-                itemEntity.setPickupDelay(40);\n-\n-                if (traceItem) {\n-                    itemEntity.setThrowerId(player.getUniqueID());\n-                }\n-\n-                final Random random = player.getRNG();\n-                if (dropAround) {\n-                    final float f = random.nextFloat() * 0.5F;\n-                    final float f1 = random.nextFloat() * ((float) Math.PI * 2F);\n-                    itemEntity.setMotion(-MathHelper.sin(f1) * f, 0.2F, MathHelper.cos(f1) * f);\n-                } else {\n-                    float f8 = MathHelper.sin(this.rotationPitch * ((float)Math.PI / 180F));\n-                    float f2 = MathHelper.cos(this.rotationPitch * ((float)Math.PI / 180F));\n-                    float f3 = MathHelper.sin(this.rotationYaw * ((float)Math.PI / 180F));\n-                    float f4 = MathHelper.cos(this.rotationYaw * ((float)Math.PI / 180F));\n-                    float f5 = this.rand.nextFloat() * ((float)Math.PI * 2F);\n-                    float f6 = 0.02F * this.rand.nextFloat();\n-                    itemEntity.setMotion((double)(-f3 * f2 * 0.3F) + Math.cos(f5) * (double)f6, (-f8 * 0.3F + 0.1F + (this.rand.nextFloat() - this.rand.nextFloat()) * 0.1F), (double)(f4 * f2 * 0.3F) + Math.sin(f5) * (double)f6);\n-                }\n-                // FIFTH - Capture the entity maybe?\n-                if (currentState.spawnItemOrCapture(phaseContext, (PlayerEntity) (PlayerEntityBridge) this, itemEntity)) {\n-                    return itemEntity;\n-                }\n-                // TODO - Investigate whether player drops are adding to the stat list in captures.\n-                final ItemStack stack = itemEntity.getItem();\n-                player.world.addEntity(itemEntity);\n-\n-                if (traceItem) {\n-                    if (!stack.isEmpty()) {\n-                        player.addStat(Stats.ITEM_DROPPED.get(stack.getItem()), droppedItem.getCount());\n-                    }\n-\n-                    player.addStat(Stats.DROP);\n-                }\n-\n-                return itemEntity;\n-            }\n-        }\n-        // Sponge end\n-        final double d0 = this.posY - 0.30000001192092896D + (double) this.shadow$getEyeHeight();\n-        final ItemEntity itemEntity = new ItemEntity(this.world, this.posX, d0, this.posZ, droppedItem);\n-        itemEntity.setPickupDelay(40);\n-\n-        if (traceItem) {\n-            itemEntity.setThrowerId(this.shadow$getUniqueID());\n-        }\n-\n-        if (dropAround) {\n-            final float f = this.rand.nextFloat() * 0.5F;\n-            final float f1 = this.rand.nextFloat() * ((float) Math.PI * 2F);\n-            itemEntity.setMotion(-MathHelper.sin(f1) * f, 0.2F, MathHelper.cos(f1) * f);\n-        } else {\n-            float f8 = MathHelper.sin(this.rotationPitch * ((float)Math.PI / 180F));\n-            float f2 = MathHelper.cos(this.rotationPitch * ((float)Math.PI / 180F));\n-            float f3 = MathHelper.sin(this.rotationYaw * ((float)Math.PI / 180F));\n-            float f4 = MathHelper.cos(this.rotationYaw * ((float)Math.PI / 180F));\n-            float f5 = this.rand.nextFloat() * ((float)Math.PI * 2F);\n-            float f6 = 0.02F * this.rand.nextFloat();\n-            itemEntity.setMotion((double)(-f3 * f2 * 0.3F) + Math.cos(f5) * (double)f6, (-f8 * 0.3F + 0.1F + (this.rand.nextFloat() - this.rand.nextFloat()) * 0.1F), (double)(f4 * f2 * 0.3F) + Math.sin(f5) * (double)f6);\n-        }\n-\n-        final ItemStack itemstack = this.dropItemAndGetStack(itemEntity);\n-\n-        if (traceItem) {\n-            if (itemstack != null && !itemstack.isEmpty()) { // Sponge - add null check\n-                this.shadow$addStat(Stats.ITEM_DROPPED.get(itemstack.getItem()), droppedItem.getCount());\n-            }\n-\n-            this.shadow$addStat(Stats.DROP);\n-        }\n-\n-        return itemEntity;\n-    }\n \n     /**\n      * @author gabizou - June 4th, 2016\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMjE3NQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382402175", "body": "```suggestion\r\n                    final Vec3d targetMotion = targetEntity.getMotion();\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                Vec3d targetMotion = targetEntity.getMotion();\n          \n          \n            \n                                final Vec3d targetMotion = targetEntity.getMotion();", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                    <span class=\"pl-smi\">Vec3d</span> targetMotion <span class=\"pl-k\">=</span> targetEntity<span class=\"pl-k\">.</span>getMotion();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                    <span class=\"pl-k x x-first\">final</span><span class=\"x x-last\"> </span><span class=\"pl-smi\">Vec3d</span> targetMotion <span class=\"pl-k\">=</span> targetEntity<span class=\"pl-k\">.</span>getMotion();</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "gabizou", "createdAt": "2020-02-21T05:20:38Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java", "diffHunk": "@@ -788,9 +774,7 @@ public void attackTargetEntityWithCurrentItem(final Entity targetEntity) {\n                         }\n                     }\n \n-                    final double targetMotionX = targetEntity.motionX;\n-                    final double targetMotionY = targetEntity.motionY;\n-                    final double targetMotionZ = targetEntity.motionZ;\n+                    Vec3d targetMotion = targetEntity.getMotion();", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\nindex 77f125cd8..d910b9071 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n", "chunk": "@@ -774,7 +773,7 @@ public void attackTargetEntityWithCurrentItem(final Entity targetEntity) {\n                         }\n                     }\n \n-                    Vec3d targetMotion = targetEntity.getMotion();\n+                    final Vec3d targetMotion = targetEntity.getMotion();\n                     final boolean attackSucceeded = targetEntity.attackEntityFrom(DamageSource.causePlayerDamage((PlayerEntity) (Object) this), damage);\n \n                     if (attackSucceeded) {\n", "next_change": {"commit": "806b781be3b537add79c2bc84a727ee6f3e809a0", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\nindex d910b9071..f89c55c91 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/player/PlayerEntityMixin.java\n", "chunk": "@@ -460,449 +272,6 @@ public ItemEntity dropItem(final ItemStack itemStackIn, final boolean unused) {\n         return this.shadow$dropItem(itemStackIn, false, false);\n     }\n \n-    /**\n-     * @author gabizou - June 4th, 2016\n-     * @author i509VCB - February 17th, 2020 - 1.14.4\n-     *\n-     * @reason When a player drops an item, all methods flow through here instead of {@link Entity#entityDropItem(IItemProvider, int)}\n-     * because of the idea of {@code dropAround} and {@code traceItem}.\n-     *\n-     * @param droppedItem The item to drop\n-     * @param dropAround If true, the item is dropped around the player, otherwise thrown in front of the player\n-     * @param traceItem If true, the item is thrown as the player\n-     * @return The entity, if spawned correctly and not captured in any way\n-     */\n-    @Nullable\n-    @Overwrite\n-    public ItemEntity dropItem(final ItemStack droppedItem, final boolean dropAround, final boolean traceItem) {\n-        if (droppedItem.isEmpty()) {\n-            return null;\n-        }\n-        // Sponge Start - redirect to our handling to capture and throw events.\n-        if (!((WorldBridge) this.world).bridge$isFake()) {\n-            ((PlayerEntityBridge) this).bridge$shouldRestoreInventory(false);\n-            final PlayerEntity player = (PlayerEntity) (PlayerEntityBridge) this;\n-\n-            final double posX1 = player.posX;\n-            final double posY1 = player.posY - 0.3 + player.getEyeHeight();\n-            final double posZ1 = player.posZ;\n-            // Now the real fun begins.\n-            final ItemStack item;\n-            final ItemStackSnapshot snapshot = ItemStackUtil.snapshotOf(droppedItem);\n-            final List<ItemStackSnapshot> original = new ArrayList<>();\n-            original.add(snapshot);\n-\n-            final PhaseContext<?> phaseContext = PhaseTracker.getInstance().getCurrentContext();\n-            @SuppressWarnings(\"RawTypeCanBeGeneric\") final IPhaseState currentState = phaseContext.state;\n-\n-            try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame()) {\n-\n-                item = SpongeCommonEventFactory.throwDropItemAndConstructEvent((PlayerEntity) (PlayerEntityBridge) this, posX1, posY1, posZ1, snapshot, original, frame);\n-\n-                if (item == null || item.isEmpty()) {\n-                    return null;\n-                }\n-\n-\n-                // Here is where we would potentially perform item pre-merging (merge the item stacks with previously captured item stacks\n-                // and only if those stacks can be stacked (count increased). Otherwise, we'll just continue to throw the entity item.\n-                // For now, due to refactoring a majority of all of this code, pre-merging is disabled entirely.\n-\n-                final ItemEntity itemEntity = new ItemEntity(player.world, posX1, posY1, posZ1, droppedItem);\n-                itemEntity.setPickupDelay(40);\n-\n-                if (traceItem) {\n-                    itemEntity.setThrowerId(player.getUniqueID());\n-                }\n-\n-                final Random random = player.getRNG();\n-                if (dropAround) {\n-                    final float f = random.nextFloat() * 0.5F;\n-                    final float f1 = random.nextFloat() * ((float) Math.PI * 2F);\n-                    itemEntity.setMotion(-MathHelper.sin(f1) * f, 0.2F, MathHelper.cos(f1) * f);\n-                } else {\n-                    float f8 = MathHelper.sin(this.rotationPitch * ((float)Math.PI / 180F));\n-                    float f2 = MathHelper.cos(this.rotationPitch * ((float)Math.PI / 180F));\n-                    float f3 = MathHelper.sin(this.rotationYaw * ((float)Math.PI / 180F));\n-                    float f4 = MathHelper.cos(this.rotationYaw * ((float)Math.PI / 180F));\n-                    float f5 = this.rand.nextFloat() * ((float)Math.PI * 2F);\n-                    float f6 = 0.02F * this.rand.nextFloat();\n-                    itemEntity.setMotion((double)(-f3 * f2 * 0.3F) + Math.cos(f5) * (double)f6, (-f8 * 0.3F + 0.1F + (this.rand.nextFloat() - this.rand.nextFloat()) * 0.1F), (double)(f4 * f2 * 0.3F) + Math.sin(f5) * (double)f6);\n-                }\n-                // FIFTH - Capture the entity maybe?\n-                if (currentState.spawnItemOrCapture(phaseContext, (PlayerEntity) (PlayerEntityBridge) this, itemEntity)) {\n-                    return itemEntity;\n-                }\n-                // TODO - Investigate whether player drops are adding to the stat list in captures.\n-                final ItemStack stack = itemEntity.getItem();\n-                player.world.addEntity(itemEntity);\n-\n-                if (traceItem) {\n-                    if (!stack.isEmpty()) {\n-                        player.addStat(Stats.ITEM_DROPPED.get(stack.getItem()), droppedItem.getCount());\n-                    }\n-\n-                    player.addStat(Stats.DROP);\n-                }\n-\n-                return itemEntity;\n-            }\n-        }\n-        // Sponge end\n-        final double d0 = this.posY - 0.30000001192092896D + (double) this.shadow$getEyeHeight();\n-        final ItemEntity itemEntity = new ItemEntity(this.world, this.posX, d0, this.posZ, droppedItem);\n-        itemEntity.setPickupDelay(40);\n-\n-        if (traceItem) {\n-            itemEntity.setThrowerId(this.shadow$getUniqueID());\n-        }\n-\n-        if (dropAround) {\n-            final float f = this.rand.nextFloat() * 0.5F;\n-            final float f1 = this.rand.nextFloat() * ((float) Math.PI * 2F);\n-            itemEntity.setMotion(-MathHelper.sin(f1) * f, 0.2F, MathHelper.cos(f1) * f);\n-        } else {\n-            float f8 = MathHelper.sin(this.rotationPitch * ((float)Math.PI / 180F));\n-            float f2 = MathHelper.cos(this.rotationPitch * ((float)Math.PI / 180F));\n-            float f3 = MathHelper.sin(this.rotationYaw * ((float)Math.PI / 180F));\n-            float f4 = MathHelper.cos(this.rotationYaw * ((float)Math.PI / 180F));\n-            float f5 = this.rand.nextFloat() * ((float)Math.PI * 2F);\n-            float f6 = 0.02F * this.rand.nextFloat();\n-            itemEntity.setMotion((double)(-f3 * f2 * 0.3F) + Math.cos(f5) * (double)f6, (-f8 * 0.3F + 0.1F + (this.rand.nextFloat() - this.rand.nextFloat()) * 0.1F), (double)(f4 * f2 * 0.3F) + Math.sin(f5) * (double)f6);\n-        }\n-\n-        final ItemStack itemstack = this.dropItemAndGetStack(itemEntity);\n-\n-        if (traceItem) {\n-            if (itemstack != null && !itemstack.isEmpty()) { // Sponge - add null check\n-                this.shadow$addStat(Stats.ITEM_DROPPED.get(itemstack.getItem()), droppedItem.getCount());\n-            }\n-\n-            this.shadow$addStat(Stats.DROP);\n-        }\n-\n-        return itemEntity;\n-    }\n-\n-    /**\n-     * @author gabizou - June 4th, 2016\n-     * @reason Overwrites the original logic to simply pass through to the\n-     * PhaseTracker.\n-     *\n-     * @param entity The entity item to spawn\n-     * @return The itemstack\n-     */\n-    @SuppressWarnings(\"OverwriteModifiers\") // This is a MinecraftDev thing, since forge elevates the modifier to public\n-    @Overwrite\n-    @Nullable\n-    public ItemStack dropItemAndGetStack(final ItemEntity entity) {\n-        this.world.addEntity0(entity);\n-        return entity.getItem();\n-    }\n-\n-    /**\n-     * @author dualspiral - October 7th, 2016\n-     *\n-     * @reason When setting {@link SpongeHealthData#setHealth(double)} to 0, {@link #onDeath(DamageSource)} was\n-     * not being called. This check bypasses some of the checks that prevent the superclass method being called\n-     * when the {@link DamageSourceRegistryModule#IGNORED_DAMAGE_SOURCE} is being used.\n-     */\n-    @Inject(method = \"attackEntityFrom\", cancellable = true, at = @At(value = \"HEAD\"))\n-    private void onAttackEntityFrom(final DamageSource source, final float amount, final CallbackInfoReturnable<Boolean> cir) {\n-        if (source == DamageSourceRegistryModule.IGNORED_DAMAGE_SOURCE) {\n-            // Taken from the original method, wake the player up if they are about to die.\n-            if (this.shadow$isSleeping() && !this.world.isRemote) {\n-                this.shadow$wakeUpPlayer(true, true, false);\n-            }\n-\n-            // We just throw it to the superclass method so that we can potentially get the\n-            // onDeath method.\n-            cir.setReturnValue(super.attackEntityFrom(source, amount));\n-        }\n-    }\n-\n-    /**\n-     * @author gabizou - April 8th, 2016\n-     * @author gabizou - April 11th, 2016 - Update for 1.9 - This enitre method was rewritten\n-     * @author i509VCB - February 15th, 2020 - Update for 1.14.4\n-     *\n-     * @reason Rewrites the attackTargetEntityWithCurrentItem to throw an {@link AttackEntityEvent} prior\n-     * to the ensuing {@link DamageEntityEvent}. This should cover all cases where players are\n-     * attacking entities and those entities override {@link LivingEntity#attackEntityFrom(DamageSource, float)}\n-     * and effectively bypass our damage event hooks.\n-     *\n-     * LVT Rename Table:\n-     * float f        | damage               |\n-     * float f1       | enchantmentDamage    |\n-     * float f2       | attackStrength       |\n-     * boolean flag   | isStrongAttack       |\n-     * boolean flag1  | isSprintingAttack    |\n-     * boolean flag2  | isCriticalAttack     | Whether critical particles will spawn and of course, multiply the output damage\n-     * boolean flag3  | isSweapingAttack     | Whether the player is sweaping an attack and will deal AoE damage\n-     * int i          | knockbackModifier    | The knockback modifier, must be set from the event after it has been thrown\n-     * float f4       | targetOriginalHealth | This is initially set as the entity original health\n-     * boolean flag4  | litEntityOnFire      | This is an internal flag to where if the attack failed, the entity is no longer set on fire\n-     * int j          | fireAspectModifier   | Literally just to check that the weapon used has fire aspect enchantments\n-     * double d0      | distanceWalkedDelta  | This checks that the distance walked delta is more than the normal walking speed to evaluate if you're making a sweaping attack\n-     * double d1      | targetMotionX        | Current target entity motion x vector\n-     * double d2      | targetMotionY        | Current target entity motion y vector\n-     * double d3      | targetMotionZ        | Current target entity motion z vector\n-     * boolean flag5  | attackSucceeded      | Whether the attack event succeeded\n-     *\n-     * @param targetEntity The target entity\n-     */\n-    @Overwrite\n-    @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n-    public void attackTargetEntityWithCurrentItem(final Entity targetEntity) {\n-        // Sponge Start - Add SpongeImpl hook to override in forge as necessary\n-        if (!SpongeImplHooks.checkAttackEntity((PlayerEntity) (Object) this, targetEntity)) {\n-            return;\n-        }\n-        // Sponge End\n-        if (targetEntity.canBeAttackedWithItem()) {\n-            if (!targetEntity.hitByEntity((PlayerEntity) (Object) this)) {\n-                // Sponge Start - Prepare our event values\n-                // float damage = (float) this.getEntityAttribute(SharedMonsterAttributes.ATTACK_DAMAGE).getAttributeValue();\n-                final double originalBaseDamage = this.getEntityAttribute(SharedMonsterAttributes.ATTACK_DAMAGE).getValue();\n-                float damage = (float) originalBaseDamage;\n-                // Sponge End\n-                float enchantmentDamage = 0.0F;\n-\n-                // Sponge Start - Redirect getting enchantments for our damage event handlers\n-                // if (targetEntity instanceof LivingEntity) {\n-                //     enchantmentDamage = EnchantmentHelper.getModifierForCreature(this.getHeldItemMainhand(), ((LivingEntity) targetEntity).getCreatureAttribute());\n-                // } else {\n-                //     enchantmentDamage = EnchantmentHelper.getModifierForCreature(this.getHeldItemMainhand(), CreatureAttribute.UNDEFINED);\n-                // }\n-                final float attackStrength = this.shadow$getCooledAttackStrength(0.5F);\n-\n-                final List<ModifierFunction<DamageModifier>> originalFunctions = new ArrayList<>();\n-\n-                final CreatureAttribute creatureAttribute = targetEntity instanceof LivingEntity\n-                                                                ? ((LivingEntity) targetEntity).getCreatureAttribute()\n-                                                                : CreatureAttribute.UNDEFINED;\n-                final List<DamageFunction> enchantmentModifierFunctions = DamageEventHandler.createAttackEnchantmentFunction(this.shadow$getHeldItemMainhand(), creatureAttribute, attackStrength);\n-                // This is kept for the post-damage event handling\n-                final List<DamageModifier> enchantmentModifiers = enchantmentModifierFunctions.stream().map(ModifierFunction::getModifier).collect(Collectors.toList());\n-\n-                enchantmentDamage = (float) enchantmentModifierFunctions.stream()\n-                        .map(ModifierFunction::getFunction)\n-                        .mapToDouble(function -> function.applyAsDouble(originalBaseDamage))\n-                        .sum();\n-                originalFunctions.addAll(enchantmentModifierFunctions);\n-                // Sponge End\n-\n-                originalFunctions.add(DamageEventHandler.provideCooldownAttackStrengthFunction((PlayerEntity) (Object) this, attackStrength));\n-                damage = damage * (0.2F + attackStrength * attackStrength * 0.8F);\n-                enchantmentDamage = enchantmentDamage * attackStrength;\n-                this.shadow$resetCooldown();\n-\n-                if (damage > 0.0F || enchantmentDamage > 0.0F) {\n-                    final boolean isStrongAttack = attackStrength > 0.9F;\n-                    boolean isSprintingAttack = false;\n-                    boolean isCriticalAttack = false;\n-                    boolean isSweapingAttack = false;\n-                    int knockbackModifier = 0;\n-                    knockbackModifier = knockbackModifier + EnchantmentHelper.getKnockbackModifier((PlayerEntity) (Object) this);\n-\n-                    if (this.shadow$isSprinting() && isStrongAttack) {\n-                        // Sponge - Only play sound after the event has be thrown and not cancelled.\n-                        // this.world.playSound((EntityPlayer) null, this.posX, this.posY, this.posZ, SoundEvents.entity_player_attack_knockback, this.getSoundCategory(), 1.0F, 1.0F);\n-                        ++knockbackModifier;\n-                        isSprintingAttack = true;\n-                    }\n-\n-                    isCriticalAttack = isStrongAttack && this.fallDistance > 0.0F && !this.onGround && !this.isOnLadder() && !this.shadow$isInWater() && !this.isPotionActive(Effects.BLINDNESS) && !this.shadow$isPassenger() && targetEntity instanceof LivingEntity;\n-                    isCriticalAttack = isCriticalAttack && !this.shadow$isSprinting();\n-\n-                    if (isCriticalAttack) {\n-                        // Sponge Start - add critical attack tuple\n-                        // damage *= 1.5F; // Sponge - This is handled in the event\n-                        originalFunctions.add(DamageEventHandler.provideCriticalAttackTuple((PlayerEntity) (Object) this));\n-                        // Sponge End\n-                    }\n-\n-                    // damage = damage + enchantmentDamage; // Sponge - We don't need this since our event will re-assign the damage to deal\n-                    final double distanceWalkedDelta = (double) (this.distanceWalkedModified - this.prevDistanceWalkedModified);\n-\n-                    final ItemStack heldItem = this.getHeldItem(Hand.MAIN_HAND);\n-                    if (isStrongAttack && !isCriticalAttack && !isSprintingAttack && this.onGround && distanceWalkedDelta < (double) this.shadow$getAIMoveSpeed()) {\n-                        final ItemStack itemstack = heldItem;\n-\n-                        if (itemstack.getItem() instanceof SwordItem) {\n-                            isSweapingAttack = true;\n-                        }\n-                    }\n-\n-                    // Sponge Start - Create the event and throw it\n-                    final DamageSource damageSource = DamageSource.causePlayerDamage((PlayerEntity) (Object) this);\n-                    final boolean isMainthread = !this.world.isRemote;\n-                    if (isMainthread) {\n-                        Sponge.getCauseStackManager().pushCause(damageSource);\n-                    }\n-                    final Cause currentCause = isMainthread ? Sponge.getCauseStackManager().getCurrentCause() : Cause.of(EventContext.empty(), damageSource);\n-                    final AttackEntityEvent event = SpongeEventFactory.createAttackEntityEvent(currentCause, (org.spongepowered.api.entity.Entity) targetEntity,\n-                        originalFunctions, knockbackModifier, originalBaseDamage);\n-                    SpongeImpl.postEvent(event);\n-                    if (isMainthread) {\n-                        Sponge.getCauseStackManager().popCause();\n-                    }\n-                    if (event.isCancelled()) {\n-                        return;\n-                    }\n-\n-                    damage = (float) event.getFinalOutputDamage();\n-                    // sponge - need final for later events\n-                    final double attackDamage = damage;\n-                    knockbackModifier = event.getKnockbackModifier();\n-                    enchantmentDamage = (float) enchantmentModifiers.stream()\n-                            .mapToDouble(event::getOutputDamage)\n-                            .sum();\n-                    // Sponge End\n-\n-                    float targetOriginalHealth = 0.0F;\n-                    boolean litEntityOnFire = false;\n-                    final int fireAspectModifier = EnchantmentHelper.getFireAspectModifier((PlayerEntity) (Object) this);\n-\n-                    if (targetEntity instanceof LivingEntity) {\n-                        targetOriginalHealth = ((LivingEntity) targetEntity).getHealth();\n-\n-                        if (fireAspectModifier > 0 && !targetEntity.isBurning()) {\n-                            litEntityOnFire = true;\n-                            targetEntity.setFire(1);\n-                        }\n-                    }\n-\n-                    final Vec3d targetMotion = targetEntity.getMotion();\n-                    final boolean attackSucceeded = targetEntity.attackEntityFrom(DamageSource.causePlayerDamage((PlayerEntity) (Object) this), damage);\n-\n-                    if (attackSucceeded) {\n-                        if (knockbackModifier > 0) {\n-                            if (targetEntity instanceof LivingEntity) {\n-                                ((LivingEntity) targetEntity).knockBack((PlayerEntity) (Object) this, (float) knockbackModifier * 0.5F, (double) MathHelper.sin(this.rotationYaw * 0.017453292F), (double) (-MathHelper.cos(this.rotationYaw * 0.017453292F)));\n-                            } else {\n-                                targetEntity.addVelocity((double) (-MathHelper.sin(this.rotationYaw * 0.017453292F) * (float) knockbackModifier * 0.5F), 0.1D, (double) (MathHelper.cos(this.rotationYaw * 0.017453292F) * (float) knockbackModifier * 0.5F));\n-                            }\n-\n-                            this.shadow$setMotion(this.shadow$getMotion().mul(0.6D, 1.0D, 0.6D));\n-                            this.shadow$setSprinting(false);\n-                        }\n-\n-                        if (isSweapingAttack) {\n-                            for (final LivingEntity livingEntity : this.world.getEntitiesWithinAABB(LivingEntity.class, targetEntity.getBoundingBox().grow(1.0D, 0.25D, 1.0D))) {\n-                                if (livingEntity != (PlayerEntity) (Object) this && livingEntity != targetEntity && !this.shadow$isOnSameTeam(livingEntity) && (!(livingEntity instanceof ArmorStandEntity) || !((ArmorStandEntity)livingEntity).hasMarker()) && this.shadow$getDistanceSq(livingEntity) < 9.0D) {\n-                                    // Sponge Start - Do a small event for these entities\n-                                    // livingEntity.knockBack(this, 0.4F, (double)MathHelper.sin(this.rotationYaw * 0.017453292F), (double)(-MathHelper.cos(this.rotationYaw * 0.017453292F)));\n-                                    // livingEntity.attackEntityFrom(DamageSource.causePlayerDamage(this), 1.0F);\n-                                    final EntityDamageSource sweepingAttackSource = EntityDamageSource.builder().entity((Player) this).type(DamageTypes.SWEEPING_ATTACK.get()).build();\n-                                    try (final CauseStackManager.StackFrame frame = isMainthread ? Sponge.getCauseStackManager().pushCauseFrame() : null) {\n-                                        if (isMainthread) {\n-                                            frame.pushCause(sweepingAttackSource);\n-                                        }\n-                                        final ItemStackSnapshot heldSnapshot = ItemStackUtil.snapshotOf(heldItem);\n-                                        if (isMainthread) {\n-                                            frame.addContext(EventContextKeys.WEAPON, heldSnapshot);\n-                                        }\n-                                        final DamageFunction sweapingFunction = DamageFunction.of(DamageModifier.builder()\n-                                                .cause(Cause.of(EventContext.empty(), heldSnapshot))\n-                                                .item(heldSnapshot)\n-                                                .type(DamageModifierTypes.SWEEPING.get())\n-                                                .build(),\n-                                            incoming -> EnchantmentHelper.getSweepingDamageRatio((PlayerEntity) (Object) this) * attackDamage);\n-                                        final List<DamageFunction> sweapingFunctions = new ArrayList<>();\n-                                        sweapingFunctions.add(sweapingFunction);\n-                                        final AttackEntityEvent sweepingAttackEvent = SpongeEventFactory.createAttackEntityEvent(\n-                                            currentCause, (org.spongepowered.api.entity.Entity) livingEntity,\n-                                            sweapingFunctions, 1, 1.0D);\n-                                        SpongeImpl.postEvent(sweepingAttackEvent);\n-                                        if (!sweepingAttackEvent.isCancelled()) {\n-                                            livingEntity\n-                                                .knockBack((PlayerEntity) (Object) this, sweepingAttackEvent.getKnockbackModifier() * 0.4F,\n-                                                    (double) MathHelper.sin(this.rotationYaw * ((float)Math.PI / 180F)),\n-                                                    (double) -MathHelper.cos(this.rotationYaw * ((float)Math.PI / 180F)));\n-\n-                                            livingEntity.attackEntityFrom(DamageSource.causePlayerDamage((PlayerEntity) (Object) this),\n-                                                (float) sweepingAttackEvent.getFinalOutputDamage());\n-                                        }\n-                                    }\n-                                    // Sponge End\n-                                }\n-                            }\n-\n-                            this.world.playSound(null, this.posX, this.posY, this.posZ, SoundEvents.ENTITY_PLAYER_ATTACK_SWEEP, this.shadow$getSoundCategory(), 1.0F, 1.0F);\n-                            this.shadow$spawnSweepParticles();\n-                        }\n-\n-                        if (targetEntity instanceof ServerPlayerEntity && targetEntity.velocityChanged) {\n-                            ((ServerPlayerEntity) targetEntity).connection.sendPacket(new SEntityVelocityPacket(targetEntity));\n-                            targetEntity.velocityChanged = false;\n-                            targetEntity.setMotion(targetMotion);\n-                        }\n-\n-                        if (isCriticalAttack) {\n-                            this.world.playSound(null, this.posX, this.posY, this.posZ, SoundEvents.ENTITY_PLAYER_ATTACK_CRIT, this.shadow$getSoundCategory(), 1.0F, 1.0F);\n-                            this.shadow$onCriticalHit(targetEntity);\n-                        }\n-\n-                        if (!isCriticalAttack && !isSweapingAttack) {\n-                            if (isStrongAttack) {\n-                                this.world.playSound(null, this.posX, this.posY, this.posZ, SoundEvents.ENTITY_PLAYER_ATTACK_STRONG, this.shadow$getSoundCategory(), 1.0F, 1.0F);\n-                            } else {\n-                                this.world.playSound(null, this.posX, this.posY, this.posZ, SoundEvents.ENTITY_PLAYER_ATTACK_WEAK , this.shadow$getSoundCategory(), 1.0F, 1.0F);\n-                            }\n-                        }\n-\n-                        if (enchantmentDamage > 0.0F) {\n-                            this.shadow$onEnchantmentCritical(targetEntity);\n-                        }\n-\n-                        this.shadow$setLastAttackedEntity(targetEntity);\n-\n-                        if (targetEntity instanceof LivingEntity) {\n-                            EnchantmentHelper.applyThornEnchantments((LivingEntity) targetEntity, (PlayerEntity) (Object) this);\n-                        }\n-\n-                        EnchantmentHelper.applyArthropodEnchantments((PlayerEntity) (Object) this, targetEntity);\n-                        final ItemStack itemstack1 = this.shadow$getHeldItemMainhand();\n-                        Entity entity = targetEntity;\n-\n-                        if (targetEntity instanceof EnderDragonPartEntity) {\n-                            entity = ((EnderDragonPartEntity) targetEntity).dragon;\n-                        }\n-\n-                        if(!this.world.isRemote && !itemstack1.isEmpty() && entity instanceof LivingEntity) {\n-                            itemstack1.hitEntity((LivingEntity) entity, (PlayerEntity) (Object) this);\n-                            if(itemstack1.isEmpty()) {\n-                                this.setHeldItem(Hand.MAIN_HAND, ItemStack.EMPTY);\n-                            }\n-                        }\n-\n-                        if (targetEntity instanceof LivingEntity) {\n-                            final float f5 = targetOriginalHealth - ((LivingEntity) targetEntity).getHealth();\n-                            this.shadow$addStat(Stats.DAMAGE_DEALT, Math.round(f5 * 10.0F));\n-\n-                            if (fireAspectModifier > 0) {\n-                                targetEntity.setFire(fireAspectModifier * 4);\n-                            }\n-\n-                            if (this.world instanceof ServerWorld && f5 > 2.0F) {\n-                                final int k = (int) ((double) f5 * 0.5D);\n-                                ((ServerWorld) this.world).spawnParticle(ParticleTypes.DAMAGE_INDICATOR, targetEntity.posX, targetEntity.posY + (double) (targetEntity.getHeight() * 0.5F), targetEntity.posZ, k, 0.1D, 0.0D, 0.1D, 0.2D);\n-                            }\n-                        }\n-\n-                        this.shadow$addExhaustion(0.1F);\n-                    } else {\n-                        this.world.playSound(null, this.posX, this.posY, this.posZ, SoundEvents.ENTITY_PLAYER_ATTACK_NODAMAGE, this.shadow$getSoundCategory(), 1.0F, 1.0F);\n-\n-                        if (litEntityOnFire) {\n-                            targetEntity.extinguish();\n-                        }\n-                    }\n-                }\n-            }\n-        }\n-    }\n \n     @Override\n     public void bridge$shouldRestoreInventory(final boolean restore) {\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMjQ4Nw==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382402487", "body": "don't just check if the world is remote, we have a better check: `!((WorldBridge) this.world).bridge$isFake()`", "bodyText": "don't just check if the world is remote, we have a better check: !((WorldBridge) this.world).bridge$isFake()", "bodyHTML": "<p dir=\"auto\">don't just check if the world is remote, we have a better check: <code>!((WorldBridge) this.world).bridge$isFake()</code></p>", "author": "gabizou", "createdAt": "2020-02-21T05:22:09Z", "path": "src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * This file is part of Sponge, licensed under the MIT License (MIT).\n+ *\n+ * Copyright (c) SpongePowered <https://www.spongepowered.org>\n+ * Copyright (c) contributors\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.spongepowered.common.mixin.tracker.entity;\n+\n+import net.minecraft.entity.Entity;\n+import net.minecraft.entity.LivingEntity;\n+import org.spongepowered.api.Sponge;\n+import org.spongepowered.api.event.CauseStackManager;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.common.event.tracking.PhaseContext;\n+import org.spongepowered.common.event.tracking.PhaseTracker;\n+import org.spongepowered.common.event.tracking.phase.entity.EntityPhase;\n+\n+@Mixin(LivingEntity.class)\n+public abstract class LivingEntityMixin_Tracker extends Entity {\n+    @Shadow protected abstract void shadow$onDeathUpdate();\n+\n+    public LivingEntityMixin_Tracker() {\n+        super(null, null);\n+    }\n+\n+    /**\n+     * @author i509VCB - February 17th, 2020 - 1.14.4\n+     *\n+     * @reason Enter phase state on entity death.\n+     * @param livingEntity The entity which is dying.\n+     */\n+    @Redirect(method = \"baseTick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;onDeathUpdate()V\"))\n+    private void tracker$enterPhaseOnDeath(final LivingEntity livingEntity) {\n+        if (!this.world.isRemote) {", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\nindex 889d17a7e..49a2c297c 100644\n--- a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n+++ b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n", "chunk": "@@ -52,7 +49,7 @@ public LivingEntityMixin_Tracker() {\n      */\n     @Redirect(method = \"baseTick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;onDeathUpdate()V\"))\n     private void tracker$enterPhaseOnDeath(final LivingEntity livingEntity) {\n-        if (!this.world.isRemote) {\n+        if (!((WorldBridge) this.world).bridge$isFake()) {\n             try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame();\n                  final PhaseContext<?> context = EntityPhase.State.DEATH_UPDATE.createPhaseContext(PhaseTracker.SERVER).source(livingEntity)) {\n                 context.buildAndSwitch();\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\nindex 49a2c297c..53e5d4bfb 100644\n--- a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n+++ b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n", "chunk": "@@ -47,7 +76,9 @@ public abstract class LivingEntityMixin_Tracker extends EntityMixin {\n      * @reason Enter phase state on entity death.\n      * @param livingEntity The entity which is dying.\n      */\n-    @Redirect(method = \"baseTick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;onDeathUpdate()V\"))\n+    @Redirect(method = \"baseTick()V\",\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/entity/LivingEntity;onDeathUpdate()V\"))\n     private void tracker$enterPhaseOnDeath(final LivingEntity livingEntity) {\n         if (!((WorldBridge) this.world).bridge$isFake()) {\n             try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame();\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQwMjYwOQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2503#discussion_r382402609", "body": "Can extend `EntityMixin` from core, or if there's one in the tracker package.", "bodyText": "Can extend EntityMixin from core, or if there's one in the tracker package.", "bodyHTML": "<p dir=\"auto\">Can extend <code>EntityMixin</code> from core, or if there's one in the tracker package.</p>", "author": "gabizou", "createdAt": "2020-02-21T05:22:52Z", "path": "src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * This file is part of Sponge, licensed under the MIT License (MIT).\n+ *\n+ * Copyright (c) SpongePowered <https://www.spongepowered.org>\n+ * Copyright (c) contributors\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+package org.spongepowered.common.mixin.tracker.entity;\n+\n+import net.minecraft.entity.Entity;\n+import net.minecraft.entity.LivingEntity;\n+import org.spongepowered.api.Sponge;\n+import org.spongepowered.api.event.CauseStackManager;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.common.event.tracking.PhaseContext;\n+import org.spongepowered.common.event.tracking.PhaseTracker;\n+import org.spongepowered.common.event.tracking.phase.entity.EntityPhase;\n+\n+@Mixin(LivingEntity.class)\n+public abstract class LivingEntityMixin_Tracker extends Entity {", "originalCommit": "92a4e950408beab4785ef89b99ea8115af0e1d54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\nindex 889d17a7e..49a2c297c 100644\n--- a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n+++ b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n", "chunk": "@@ -32,18 +31,16 @@\n import org.spongepowered.asm.mixin.Shadow;\n import org.spongepowered.asm.mixin.injection.At;\n import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.common.bridge.world.WorldBridge;\n import org.spongepowered.common.event.tracking.PhaseContext;\n import org.spongepowered.common.event.tracking.PhaseTracker;\n import org.spongepowered.common.event.tracking.phase.entity.EntityPhase;\n+import org.spongepowered.common.mixin.core.entity.EntityMixin;\n \n @Mixin(LivingEntity.class)\n-public abstract class LivingEntityMixin_Tracker extends Entity {\n+public abstract class LivingEntityMixin_Tracker extends EntityMixin {\n     @Shadow protected abstract void shadow$onDeathUpdate();\n \n-    public LivingEntityMixin_Tracker() {\n-        super(null, null);\n-    }\n-\n     /**\n      * @author i509VCB - February 17th, 2020 - 1.14.4\n      *\n", "next_change": {"commit": "8c1a47fd80c4a35d2d03e688e3ed3c66d10d30d3", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\nindex 49a2c297c..53e5d4bfb 100644\n--- a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n+++ b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n", "chunk": "@@ -24,22 +24,51 @@\n  */\n package org.spongepowered.common.mixin.tracker.entity;\n \n+import net.minecraft.entity.Entity;\n import net.minecraft.entity.LivingEntity;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.util.CombatTracker;\n+import net.minecraft.util.DamageSource;\n+import net.minecraft.world.GameRules;\n import org.spongepowered.api.Sponge;\n+import org.spongepowered.api.event.Cancellable;\n import org.spongepowered.api.event.CauseStackManager;\n import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Overwrite;\n import org.spongepowered.asm.mixin.Shadow;\n import org.spongepowered.asm.mixin.injection.At;\n import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.common.SpongeImplHooks;\n+import org.spongepowered.common.bridge.OwnershipTrackedBridge;\n+import org.spongepowered.common.bridge.entity.LivingEntityBridge;\n import org.spongepowered.common.bridge.world.WorldBridge;\n+import org.spongepowered.common.entity.living.human.HumanEntity;\n+import org.spongepowered.common.event.SpongeCommonEventFactory;\n+import org.spongepowered.common.event.tracking.IPhaseState;\n import org.spongepowered.common.event.tracking.PhaseContext;\n import org.spongepowered.common.event.tracking.PhaseTracker;\n+import org.spongepowered.common.event.tracking.phase.entity.EntityDeathContext;\n import org.spongepowered.common.event.tracking.phase.entity.EntityPhase;\n-import org.spongepowered.common.mixin.core.entity.EntityMixin;\n+import org.spongepowered.common.util.Constants;\n+\n+import javax.annotation.Nullable;\n \n @Mixin(LivingEntity.class)\n-public abstract class LivingEntityMixin_Tracker extends EntityMixin {\n+public abstract class LivingEntityMixin_Tracker extends EntityMixin_Tracker implements LivingEntityBridge {\n+    // @formatter:off\n+    @Shadow protected boolean dead;\n+    @Shadow protected int scoreValue;\n+    @Shadow protected int recentlyHit;\n+\n     @Shadow protected abstract void shadow$onDeathUpdate();\n+    @Shadow protected abstract int shadow$getExperiencePoints(PlayerEntity player);\n+    @Shadow protected abstract boolean shadow$canDropLoot();\n+    @Shadow protected abstract void shadow$dropLoot(DamageSource damageSourceIn, boolean p_213354_2_);\n+    @Shadow public abstract CombatTracker shadow$getCombatTracker();\n+    @Shadow @Nullable public abstract LivingEntity shadow$getAttackingEntity();\n+    // @formatter:on\n+    private int tracker$deathEventsPosted;\n+\n \n     /**\n      * @author i509VCB - February 17th, 2020 - 1.14.4\n", "next_change": {"commit": "2a1461509832637afca63d7e98101a5a4a2f98a6", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\nindex 53e5d4bfb..01bfc0e61 100644\n--- a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n+++ b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n", "chunk": "@@ -66,6 +66,7 @@ public abstract class LivingEntityMixin_Tracker extends EntityMixin_Tracker impl\n     @Shadow protected abstract void shadow$dropLoot(DamageSource damageSourceIn, boolean p_213354_2_);\n     @Shadow public abstract CombatTracker shadow$getCombatTracker();\n     @Shadow @Nullable public abstract LivingEntity shadow$getAttackingEntity();\n+    @Shadow public abstract void shadow$onDeath(DamageSource cause);\n     // @formatter:on\n     private int tracker$deathEventsPosted;\n \n", "next_change": {"commit": "806b781be3b537add79c2bc84a727ee6f3e809a0", "changed_code": [{"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\nindex 01bfc0e61..9a0a1eee3 100644\n--- a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n+++ b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n", "chunk": "@@ -67,6 +67,11 @@ public abstract class LivingEntityMixin_Tracker extends EntityMixin_Tracker impl\n     @Shadow public abstract CombatTracker shadow$getCombatTracker();\n     @Shadow @Nullable public abstract LivingEntity shadow$getAttackingEntity();\n     @Shadow public abstract void shadow$onDeath(DamageSource cause);\n+    @Shadow public abstract boolean shadow$isSleeping();\n+\n+    @Shadow protected abstract void shadow$spawnDrops(DamageSource damageSourceIn);\n+\n+    @Shadow public float attackedAtYaw;\n     // @formatter:on\n     private int tracker$deathEventsPosted;\n \n", "next_change": null}]}}]}}, {"header": "diff --git a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\nindex 49a2c297c..53e5d4bfb 100644\n--- a/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n+++ b/src/main/java/org/spongepowered/common/mixin/tracker/entity/LivingEntityMixin_Tracker.java\n", "chunk": "@@ -47,7 +76,9 @@ public abstract class LivingEntityMixin_Tracker extends EntityMixin {\n      * @reason Enter phase state on entity death.\n      * @param livingEntity The entity which is dying.\n      */\n-    @Redirect(method = \"baseTick()V\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/entity/LivingEntity;onDeathUpdate()V\"))\n+    @Redirect(method = \"baseTick()V\",\n+            at = @At(value = \"INVOKE\",\n+                    target = \"Lnet/minecraft/entity/LivingEntity;onDeathUpdate()V\"))\n     private void tracker$enterPhaseOnDeath(final LivingEntity livingEntity) {\n         if (!((WorldBridge) this.world).bridge$isFake()) {\n             try (final CauseStackManager.StackFrame frame = Sponge.getCauseStackManager().pushCauseFrame();\n", "next_change": null}]}}]}}, {"oid": "1538ebb199ccc72b37f95778fa8e39d58f50dbc2", "url": "https://github.com/SpongePowered/Sponge/commit/1538ebb199ccc72b37f95778fa8e39d58f50dbc2", "message": "Make references to GameRules refer to actual RuleKey rather than string constant, clean up and make most of core entity mixins compile", "committedDate": "2020-02-22T04:46:01Z", "type": "forcePushed"}, {"oid": "70b13023b87c95bd8f6e7065655947903a035a21", "url": "https://github.com/SpongePowered/Sponge/commit/70b13023b87c95bd8f6e7065655947903a035a21", "message": "Make references to GameRules refer to actual RuleKey rather than string constant, clean up and make most of core entity mixins compile", "committedDate": "2020-02-22T16:27:12Z", "type": "forcePushed"}, {"oid": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "url": "https://github.com/SpongePowered/Sponge/commit/7e5938cf08afd45082efeec2b8c29d8ea8a52125", "message": "Make references to GameRules refer to actual RuleKey rather than string constant, clean up and make most of core entity mixins compile", "committedDate": "2020-02-22T16:30:09Z", "type": "commit"}, {"oid": "7e5938cf08afd45082efeec2b8c29d8ea8a52125", "url": "https://github.com/SpongePowered/Sponge/commit/7e5938cf08afd45082efeec2b8c29d8ea8a52125", "message": "Make references to GameRules refer to actual RuleKey rather than string constant, clean up and make most of core entity mixins compile", "committedDate": "2020-02-22T16:30:09Z", "type": "forcePushed"}]}