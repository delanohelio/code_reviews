{"pr_number": 5943, "pr_title": "Uses classes to sort deck names and deck objects", "pr_author": "Arthur-Milchior", "pr_createdAt": "2020-04-06T22:39:16Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/5943", "timeline": [{"oid": "4fb20ee5bcb79d943313a62432b31f1b96e0847f", "url": "https://github.com/ankidroid/Anki-Android/commit/4fb20ee5bcb79d943313a62432b31f1b96e0847f", "message": "Uses classes to sort deck names and deck objects\n\nThere were a lot of duplicate and almost duplicate code in\nAnkiDroid. Often the comparator class was put in some random place,\nwhere it could not easily be found to be used again when needed. So I\ntried to make this slightly more consistent by creating three\ncomparators. One for name of deck. One for json objects representing\ndecks. One for json objects with a name.\n\nI am also correcting a small bug relating to sorting of decks. The\nsorting in allSorted was wrong because A::A should appear before A9,\nwhile it sorted it after. (This is because it considered \":\" as a\ncharacter, and not a separator).\n\nLuckily, this did not cause real trouble since this method is not even\nused to sort decks in the deck picker interface.", "committedDate": "2020-04-06T22:45:50Z", "type": "forcePushed"}, {"oid": "2d00cba208b2d65e42ddddd3060dce6b62f4bbfa", "url": "https://github.com/ankidroid/Anki-Android/commit/2d00cba208b2d65e42ddddd3060dce6b62f4bbfa", "message": "Uses classes to sort deck names and deck objects\n\nThere were a lot of duplicate and almost duplicate code in\nAnkiDroid. Often the comparator class was put in some random place,\nwhere it could not easily be found to be used again when needed. So I\ntried to make this slightly more consistent by creating three\ncomparators. One for name of deck. One for json objects representing\ndecks. One for json objects with a name.\n\nI am also correcting a small bug relating to sorting of decks. The\nsorting in allSorted was wrong because A::A should appear before A9,\nwhile it sorted it after. (This is because it considered \":\" as a\ncharacter, and not a separator).\n\nLuckily, this did not cause real trouble since this method is not even\nused to sort decks in the deck picker interface.", "committedDate": "2020-04-09T12:35:56Z", "type": "commit"}, {"oid": "2d00cba208b2d65e42ddddd3060dce6b62f4bbfa", "url": "https://github.com/ankidroid/Anki-Android/commit/2d00cba208b2d65e42ddddd3060dce6b62f4bbfa", "message": "Uses classes to sort deck names and deck objects\n\nThere were a lot of duplicate and almost duplicate code in\nAnkiDroid. Often the comparator class was put in some random place,\nwhere it could not easily be found to be used again when needed. So I\ntried to make this slightly more consistent by creating three\ncomparators. One for name of deck. One for json objects representing\ndecks. One for json objects with a name.\n\nI am also correcting a small bug relating to sorting of decks. The\nsorting in allSorted was wrong because A::A should appear before A9,\nwhile it sorted it after. (This is because it considered \":\" as a\ncharacter, and not a separator).\n\nLuckily, this did not cause real trouble since this method is not even\nused to sort decks in the deck picker interface.", "committedDate": "2020-04-09T12:35:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM1NzczMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/5943#discussion_r406357730", "body": "This is replaced by the wrong comparator I think, this should be \r\n```suggestion\r\n        Collections.sort(decks, DeckNameComparator.instance);\r\n```", "bodyText": "This is replaced by the wrong comparator I think, this should be\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Collections.sort(decks, DeckComparator.instance);\n          \n          \n            \n                    Collections.sort(decks, DeckNameComparator.instance);", "bodyHTML": "<p dir=\"auto\">This is replaced by the wrong comparator I think, this should be</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"451\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-smi\">Collections</span><span class=\"pl-k\">.</span>sort(decks, <span class=\"pl-smi x x-first x-last\">DeckComparator</span><span class=\"pl-k\">.</span>instance);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"451\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-smi\">Collections</span><span class=\"pl-k\">.</span>sort(decks, <span class=\"pl-smi x x-first x-last\">DeckNameComparator</span><span class=\"pl-k\">.</span>instance);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "mikehardy", "createdAt": "2020-04-09T17:21:12Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/NoteEditor.java", "diffHunk": "@@ -446,7 +448,7 @@ public void onClick(View v) {\n         final ArrayList<String> deckNames = new ArrayList<>();\n \n         ArrayList<JSONObject> decks = getCol().getDecks().all();\n-        Collections.sort(decks, new JSONNameComparator());\n+        Collections.sort(decks, DeckComparator.instance);", "originalCommit": "2d00cba208b2d65e42ddddd3060dce6b62f4bbfa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM2NTM5MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5943#discussion_r406365391", "bodyText": "If it were the case, the build would fail with a type error.\nHowever, i may be more than happy if you can suggest better names.\nDeckNameComparator is a comparator for strings, assuming that those strings are deck's names.\nDeckComparator are comparator for decks according to their name.\nBoth are required, because you have some instances of list of names, and some instances of list of decks.", "author": "Arthur-Milchior", "createdAt": "2020-04-09T17:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM1NzczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM5ODA2Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/5943#discussion_r406398062", "bodyText": "By my read, you extracted comparators (good), and then  you called the extracted comparators, just that for this one you chose the wrong extracted comparator. I just re-checked it. I still believe my read is correct. The one you are calling now is a different implementation than was used before, the implementation used before was extracted to the one I suggest.", "author": "mikehardy", "createdAt": "2020-04-09T18:31:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM1NzczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQyNDgwMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/5943#discussion_r406424802", "bodyText": "I did a rebase on master and didn't change anything else, so I am surprised that you find something so important changed.\nIt is however possible that I did already corrected it on my computer and just forgot to push it. I'd be surprised, because emacs warns me when I've got commit not pushed, but that's not impossible", "author": "Arthur-Milchior", "createdAt": "2020-04-09T19:22:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjM1NzczMA=="}], "type": "inlineReview"}]}