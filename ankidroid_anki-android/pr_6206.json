{"pr_number": 6206, "pr_title": "Introduce night mode compatibility with desktop Anki", "pr_author": "Kubo2", "pr_createdAt": "2020-05-17T21:10:11Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6206", "timeline": [{"oid": "2e350b513e0228ff5dbd9890a448e00dfc25dd5b", "url": "https://github.com/ankidroid/Anki-Android/commit/2e350b513e0228ff5dbd9890a448e00dfc25dd5b", "message": "Introduce night mode compatibility with desktop\n\nNight mode in Anki for Desktop introduces a new CSS class for styling cards incompatible with AnkiDroid. This in turn neccessitates very hacky and verbose CSS for consistent styling of night mode (sometimes impossible), instead of styling for night mode in Anki or for night mode in AnkiDroid.\r\n\r\nThis change introduces such compatibility (BC/FC) and only potentially breaks things if users have already tried to hack around the incompatibility for both night modes; nonetheless, in virtually all cases, the resulting CSS should be a lot simpler.", "committedDate": "2020-05-17T21:02:35Z", "type": "commit"}, {"oid": "7f7b95fc3a2d7d19895420bc7106f99d72879d83", "url": "https://github.com/ankidroid/Anki-Android/commit/7f7b95fc3a2d7d19895420bc7106f99d72879d83", "message": "CardAppearence check for custom night mode stylesheet", "committedDate": "2020-05-24T14:00:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0MTAwNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6206#discussion_r429641006", "body": "Possible improvement: rename to `hasUserDefinedNightMode`", "bodyText": "Possible improvement: rename to hasUserDefinedNightMode", "bodyHTML": "<p dir=\"auto\">Possible improvement: rename to <code>hasUserDefinedNightMode</code></p>", "author": "david-allison-1", "createdAt": "2020-05-24T14:13:02Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/cardviewer/CardAppearance.java", "diffHunk": "@@ -45,6 +46,15 @@ public boolean isNightMode() {\n         return mNightMode;\n     }\n \n+\n+    /**\n+     * customNightMode finds out if the user has included class .night_mode in card's stylesheet\n+     */\n+    public boolean customNightMode(Card card) {", "originalCommit": "7f7b95fc3a2d7d19895420bc7106f99d72879d83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0MTcxNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6206#discussion_r429641717", "bodyText": "If you think the name better fits in the project, I will rename it", "author": "Kubo2", "createdAt": "2020-05-24T14:20:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0MTAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0MjkwMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6206#discussion_r429642902", "bodyText": "Reviews are two-way conversations, feel free to disagree! But thanks :)", "author": "david-allison-1", "createdAt": "2020-05-24T14:34:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0MTAwNg=="}], "type": "inlineReview"}, {"oid": "ff53cd79a643d647086d674b17d537484b905f77", "url": "https://github.com/ankidroid/Anki-Android/commit/ff53cd79a643d647086d674b17d537484b905f77", "message": "Rename CardAppearance.customNightMode() -> hasUserDefinedNightMode()", "committedDate": "2020-05-24T14:31:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0Mjk3NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6206#discussion_r429642975", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [These nested if statements could be combined](https://app.codacy.com/manual/timrae/Anki-Android/pullRequest?prid=5538599)", "bodyText": "Issue found: These nested if statements could be combined", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/timrae/Anki-Android/pullRequest?prid=5538599\" rel=\"nofollow\">These nested if statements could be combined</a></p>", "author": "timrae", "createdAt": "2020-05-24T14:34:52Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -2062,9 +2062,7 @@ private void updateCard(final String newContent) {\n         }\n \n         if (isInNightMode()) {\n-            // If card styling doesn't contain any mention of the night_mode class then do color inversion as fallback\n-            // TODO: find more robust solution that won't match unrelated classes like \"night_mode_old\"\n-            if (!mCurrentCard.css().contains(\".night_mode\")) {\n+            if (!mCardAppearance.hasUserDefinedNightMode(mCurrentCard)) {", "originalCommit": "ff53cd79a643d647086d674b17d537484b905f77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}