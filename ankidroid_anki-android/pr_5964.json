{"pr_number": 5964, "pr_title": "only call Sched.reset() once on scheduler opening", "pr_author": "Arthur-Milchior", "pr_createdAt": "2020-04-10T08:01:26Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/5964", "timeline": [{"oid": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "url": "https://github.com/ankidroid/Anki-Android/commit/e14315c6cecab8c3799f1be9492aaef0fb132e4c", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done.", "committedDate": "2020-04-10T08:38:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTg1NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406875855", "body": "If we do this, it's a member variable so it should be mSomething\r\n```suggestion\r\n    private boolean mSchedResetDone = false;\r\n```", "bodyText": "If we do this, it's a member variable so it should be mSomething\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private boolean reset_done = false;\n          \n          \n            \n                private boolean mSchedResetDone = false;", "bodyHTML": "<p dir=\"auto\">If we do this, it's a member variable so it should be mSomething</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">boolean</span> <span class=\"x x-first x-last\">reset_done</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">boolean</span> <span class=\"x x-first x-last\">mSchedResetDone</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "mikehardy", "createdAt": "2020-04-10T18:07:04Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -61,6 +61,9 @@\n     private boolean mBlackWhiteboard = true;\n     private boolean mPrefFullscreenReview = false;\n     private static final int ADD_NOTE = 12;\n+    // Deck picker reset scheduler before opening the reviewer. So\n+    // first reset is useless.\n+    private boolean reset_done = false;", "originalCommit": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg5ODE0MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406898141", "bodyText": "Sorry. Tim just told me a few day ago about m variables. I really need to get my head around the fact that my PR to anki and akindroid needs to follow different rules. That's extremely unintuitive to be honest, since in my headspace, anki and ankidroid are really related", "author": "Arthur-Milchior", "createdAt": "2020-04-10T19:02:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTg1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTk4Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406875982", "body": "```suggestion\r\n            mSchedResetDone = true;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        reset_done = true;\n          \n          \n            \n                        mSchedResetDone = true;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"x x-first x-last\">reset_done</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"x x-first x-last\">mSchedResetDone</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "mikehardy", "createdAt": "2020-04-10T18:07:26Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -96,6 +99,10 @@ protected void onCreate(Bundle savedInstanceState) {\n         Timber.d(\"onCreate()\");\n         super.onCreate(savedInstanceState);\n \n+        if (getIntent().hasExtra(\"com.ichi2.anki.reset_done\")) {\n+            Timber.d(\"reset done\");\n+            reset_done = true;", "originalCommit": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NjE4Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406876183", "body": "```suggestion\r\n        if (!mSchedResetDone) {\r\n            col.getSched().reset();     // Reset schedule in case card was previously loaded\r\n            mSchedReset = false;\r\n        }\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!reset_done) {\n          \n          \n            \n                        col.getSched().reset();     // Reset schedule in case card had previous been loaded\n          \n          \n            \n                        reset_done = false;\n          \n          \n            \n                    }\n          \n          \n            \n                    if (!mSchedResetDone) {\n          \n          \n            \n                        col.getSched().reset();     // Reset schedule in case card was previously loaded\n          \n          \n            \n                        mSchedReset = false;\n          \n          \n            \n                    }", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"183\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (<span class=\"pl-k\">!</span><span class=\"x x-first x-last\">reset_done</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"184\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            col<span class=\"pl-k\">.</span>getSched()<span class=\"pl-k\">.</span>reset();     <span class=\"pl-c\"><span class=\"pl-c\">//</span> Reset schedule in case card <span class=\"x x-first x-last\">had previous been</span> loaded</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"185\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"x x-first x-last\">reset_done</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"186\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"183\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">if</span> (<span class=\"pl-k\">!</span><span class=\"x x-first x-last\">mSchedResetDone</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"184\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            col<span class=\"pl-k\">.</span>getSched()<span class=\"pl-k\">.</span>reset();     <span class=\"pl-c\"><span class=\"pl-c\">//</span> Reset schedule in case card <span class=\"x x-first x-last\">was previously</span> loaded</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"185\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"x x-first x-last\">mSchedReset</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"186\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "mikehardy", "createdAt": "2020-04-10T18:07:47Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Reviewer.java", "diffHunk": "@@ -171,7 +178,10 @@ protected void onCollectionLoaded(Collection col) {\n             setWhiteboardVisibility(whiteboardVisibility);\n         }\n \n-        col.getSched().reset();     // Reset schedule incase card had previous been loaded\n+        if (!reset_done) {\n+            col.getSched().reset();     // Reset schedule in case card had previous been loaded\n+            reset_done = false;\n+        }", "originalCommit": "e14315c6cecab8c3799f1be9492aaef0fb132e4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg5OTM0OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/5964#discussion_r406899348", "bodyText": "The comment error was already here before this PR. I'm okay to correct it, but it's unrelated to this commit", "author": "Arthur-Milchior", "createdAt": "2020-04-10T19:05:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NjE4Mw=="}], "type": "inlineReview"}, {"oid": "9de9db89da4164924fdcfb50da4df1cd620d1f6a", "url": "https://github.com/ankidroid/Anki-Android/commit/9de9db89da4164924fdcfb50da4df1cd620d1f6a", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done.", "committedDate": "2020-04-10T19:05:45Z", "type": "commit"}, {"oid": "9de9db89da4164924fdcfb50da4df1cd620d1f6a", "url": "https://github.com/ankidroid/Anki-Android/commit/9de9db89da4164924fdcfb50da4df1cd620d1f6a", "message": "Reset done a single time on scheduler openinig\n\nOn my collection and my phone, scheduler's reset take 4 seconds. It's\ndone twice when reviewer is opened from deck picker. This is because:\n* to check whether the deck can be reviewer, reset is done to see the\n  correct number of card\n* when reviewer starts, it calls reset to check whether there are\n  actually cards to review/create the queue\n\nBoth actions are useful, but in this case it's a duplicate. Since\nstarting to review a deck from the list of deck is actually an action\nperformed often, it's important that it gets optimized, and thus I add\na notion of \"reset done\" to the intent, to state that reset does not\nhave to be done immediately by reviewer. I also ensure that future\nresets are actually done.", "committedDate": "2020-04-10T19:05:45Z", "type": "forcePushed"}]}