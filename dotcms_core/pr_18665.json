{"pr_number": 18665, "pr_title": "Issue 18051", "pr_author": "erickgonzalez", "pr_createdAt": "2020-06-15T21:16:51Z", "pr_url": "https://github.com/dotCMS/core/pull/18665", "timeline": [{"oid": "024e515d0448a96ef9058baff56c1f19af26988e", "url": "https://github.com/dotCMS/core/commit/024e515d0448a96ef9058baff56c1f19af26988e", "message": "#18051 IT", "committedDate": "2020-06-15T21:04:51Z", "type": "commit"}, {"oid": "6bef9e4475f1867221c1c58c0b0f57556802a753", "url": "https://github.com/dotCMS/core/commit/6bef9e4475f1867221c1c58c0b0f57556802a753", "message": "#18051 set content allow zero length files ship as true", "committedDate": "2020-06-15T21:07:51Z", "type": "commit"}, {"oid": "fd381f7a4569dcf7bb1e8c33e6ac15f2c2ceda26", "url": "https://github.com/dotCMS/core/commit/fd381f7a4569dcf7bb1e8c33e6ac15f2c2ceda26", "message": "Merge branch 'master' into issue-18051", "committedDate": "2020-06-16T15:34:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk1MjUwMQ==", "url": "https://github.com/dotCMS/core/pull/18665#discussion_r440952501", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [A method/constructor should not explicitly throw java.lang.Exception](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5701517)", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5701517\" rel=\"nofollow\">A method/constructor should not explicitly throw java.lang.Exception</a></p>", "author": "dev-dotcms", "createdAt": "2020-06-16T15:42:05Z", "path": "dotCMS/src/integration-test/java/com/dotcms/enterprise/publishing/remote/PushPublishBundleGeneratorTest.java", "diffHunk": "@@ -597,5 +605,80 @@ public void Test_GenerateBundle_PageWithTemplateDeleted_PageSuccessfullyAddedToB\n \n     }\n \n+    /**\n+     * Given Scenario: If a file asset has zero files and CONTENT_ALLOW_ZERO_LENGTH_FILES set to true,\n+     *                  we should be able to generate the bundle without issues.\n+     * ExpectedResult: The bundle should be generated without issues and the page added to the bundle.\n+     */\n+    @Test\n+    public void Test_GenerateBundle_FileAssetZeroBytes_ContentAllowZeroLengthFilesSetToTrue_Success() throws Exception {\n+        final boolean allowZeroLengthFilesDefault = Config.getBooleanProperty(\"CONTENT_ALLOW_ZERO_LENGTH_FILES\", true);\n+        try {\n+            //Set Property to True\n+            Config.setProperty(\"CONTENT_ALLOW_ZERO_LENGTH_FILES\", true);\n+            //Create Folder\n+            final Folder folder = new FolderDataGen().nextPersisted();\n+            // Create File with zero length\n+            final File file = File.createTempFile(\"testing-file\", \".vtl\");\n+            FileUtil.write(file, \"\");\n+            // Create File Asset with that file\n+            final Contentlet fileAssetShown = new FileAssetDataGen(folder, file).nextPersisted();\n+            ContentletDataGen.publish(fileAssetShown);\n+\n+            //Create bundle\n+            final Bundle bundle = createBundle(\"TestBundle\" + System.currentTimeMillis(), false,\n+                    \"\");\n+            //Add assets to the bundle\n+            PublisherAPI.getInstance()\n+                    .saveBundleAssets(Arrays.asList(fileAssetShown.getIdentifier()), bundle.getId(),\n+                            systemUser);\n+            //Generate Bundle, will return several dependencySet with the assets that will be added to the bundle\n+            final PushPublisherConfig listOfAssetsInBundle = generateBundle(bundle.getId(),\n+                    Operation.PUBLISH);\n+            Assert.assertNotNull(listOfAssetsInBundle);\n+            Assert.assertTrue(\n+                    listOfAssetsInBundle.getContentlets().contains(fileAssetShown.getIdentifier()));\n+        } finally {\n+            //Set Property to Default Value\n+            Config.setProperty(\"CONTENT_ALLOW_ZERO_LENGTH_FILES\", allowZeroLengthFilesDefault);\n+        }\n+\n+    }\n+\n+    /**\n+     * Given Scenario: If a file asset has zero bytes and CONTENT_ALLOW_ZERO_LENGTH_FILES set to false,\n+     *                    when you try to generate a bundle with that file asset it fails.\n+     * ExpectedResult: DotBundleException should be thrown when trying to generate the bundle with a file with zero bytes.\n+     */\n+    @Test (expected = DotBundleException.class)\n+    public void Test_GenerateBundle_FileAssetZeroBytes_ContentAllowZeroLengthFilesSetToFalse_DotBundleException() throws Exception {", "originalCommit": "fd381f7a4569dcf7bb1e8c33e6ac15f2c2ceda26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk1MjUxNw==", "url": "https://github.com/dotCMS/core/pull/18665#discussion_r440952517", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [A method/constructor should not explicitly throw java.lang.Exception](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5701517)", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5701517\" rel=\"nofollow\">A method/constructor should not explicitly throw java.lang.Exception</a></p>", "author": "dev-dotcms", "createdAt": "2020-06-16T15:42:06Z", "path": "dotCMS/src/integration-test/java/com/dotcms/enterprise/publishing/remote/PushPublishBundleGeneratorTest.java", "diffHunk": "@@ -597,5 +605,80 @@ public void Test_GenerateBundle_PageWithTemplateDeleted_PageSuccessfullyAddedToB\n \n     }\n \n+    /**\n+     * Given Scenario: If a file asset has zero files and CONTENT_ALLOW_ZERO_LENGTH_FILES set to true,\n+     *                  we should be able to generate the bundle without issues.\n+     * ExpectedResult: The bundle should be generated without issues and the page added to the bundle.\n+     */\n+    @Test\n+    public void Test_GenerateBundle_FileAssetZeroBytes_ContentAllowZeroLengthFilesSetToTrue_Success() throws Exception {", "originalCommit": "fd381f7a4569dcf7bb1e8c33e6ac15f2c2ceda26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk1MjUzNw==", "url": "https://github.com/dotCMS/core/pull/18665#discussion_r440952537", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [The String literal \"CONTENT_ALLOW_ZERO_LENGTH_FILES\" appears 6 times in this file; the first occurrence is on line 615](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5701517)", "bodyText": "Issue found: The String literal \"CONTENT_ALLOW_ZERO_LENGTH_FILES\" appears 6 times in this file; the first occurrence is on line 615", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5701517\" rel=\"nofollow\">The String literal \"CONTENT_ALLOW_ZERO_LENGTH_FILES\" appears 6 times in this file; the first occurrence is on line 615</a></p>", "author": "dev-dotcms", "createdAt": "2020-06-16T15:42:07Z", "path": "dotCMS/src/integration-test/java/com/dotcms/enterprise/publishing/remote/PushPublishBundleGeneratorTest.java", "diffHunk": "@@ -597,5 +605,80 @@ public void Test_GenerateBundle_PageWithTemplateDeleted_PageSuccessfullyAddedToB\n \n     }\n \n+    /**\n+     * Given Scenario: If a file asset has zero files and CONTENT_ALLOW_ZERO_LENGTH_FILES set to true,\n+     *                  we should be able to generate the bundle without issues.\n+     * ExpectedResult: The bundle should be generated without issues and the page added to the bundle.\n+     */\n+    @Test\n+    public void Test_GenerateBundle_FileAssetZeroBytes_ContentAllowZeroLengthFilesSetToTrue_Success() throws Exception {\n+        final boolean allowZeroLengthFilesDefault = Config.getBooleanProperty(\"CONTENT_ALLOW_ZERO_LENGTH_FILES\", true);", "originalCommit": "fd381f7a4569dcf7bb1e8c33e6ac15f2c2ceda26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}