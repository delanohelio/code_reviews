{"pr_number": 18568, "pr_title": "Issue 18567 add cors to graphql servlet", "pr_author": "wezell", "pr_createdAt": "2020-05-29T18:16:29Z", "pr_url": "https://github.com/dotCMS/core/pull/18568", "timeline": [{"oid": "600374e0cd22e1af9f51459f481fc659f785a383", "url": "https://github.com/dotCMS/core/commit/600374e0cd22e1af9f51459f481fc659f785a383", "message": "#18567 support cors in graphql", "committedDate": "2020-05-29T17:48:57Z", "type": "commit"}, {"oid": "610d45c62f6a59c679311239e61c421aafa9d64e", "url": "https://github.com/dotCMS/core/commit/610d45c62f6a59c679311239e61c421aafa9d64e", "message": "#18567 removing test.jsp", "committedDate": "2020-05-29T17:50:07Z", "type": "commit"}, {"oid": "1dd1972002981f07b9620bfcc3f8f84d7f34f9c6", "url": "https://github.com/dotCMS/core/commit/1dd1972002981f07b9620bfcc3f8f84d7f34f9c6", "message": "#18567 adding test", "committedDate": "2020-05-29T18:12:03Z", "type": "commit"}, {"oid": "2896f57caa9b639873d6c570eef04da237523bc8", "url": "https://github.com/dotCMS/core/commit/2896f57caa9b639873d6c570eef04da237523bc8", "message": "#18567 test doGet and doPost", "committedDate": "2020-05-29T20:10:10Z", "type": "commit"}, {"oid": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "url": "https://github.com/dotCMS/core/commit/e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "message": "#18567 fix failing test", "committedDate": "2020-05-29T22:24:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU0Mg==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767542", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Parameter 'response' is not assigned and could be declared final](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Parameter 'response' is not assigned and could be declared final", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Parameter 'response' is not assigned and could be declared final</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:33Z", "path": "dotCMS/src/main/java/com/dotcms/mock/response/MockHeaderResponse.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.dotcms.mock.response;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpServletResponseWrapper;\n+\n+/**\n+ * Mock {@link HttpServletRequest} with a {@link Map} as part of the class that will contain the\n+ * Headers.\n+ *\n+ * See an example here: {@link MockHttpRequest#MockHttpRequest(String, String)}\n+ */\n+public class MockHeaderResponse extends HttpServletResponseWrapper implements MockResponse {\n+  final Map<String, String> headers = new HashMap<String, String>();\n+\n+  public MockHeaderResponse(HttpServletResponse response) {", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU1MA==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767550", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Local variable 'request' could be declared final](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Local variable 'request' could be declared final", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Local variable 'request' could be declared final</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:35Z", "path": "dotCMS/src/integration-test/java/com/dotcms/graphql/DotGraphQLHttpServletTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.dotcms.graphql;\n+\n+import static org.junit.Assert.*;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.response.MockHeaderResponse;\n+import com.dotcms.mock.response.MockHttpResponse;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import com.dotcms.util.IntegrationTestInitService;\n+\n+public class DotGraphQLHttpServletTest {\n+\n+    \n+    @BeforeClass\n+    public static void prepare() throws Exception{\n+\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    @Test\n+    public void testing_cors_headers() {\n+        \n+        HashMap<String,String> headers = new DotGraphQLHttpServlet().corsHeaders.apply();\n+        \n+        assertEquals(headers.get(\"access-control-allow-origin\"), \"*\");\n+        assertEquals(headers.get(\"access-control-allow-credentials\"), \"true\");\n+        assertEquals(headers.get(\"access-control-allow-headers\"), \"*\");\n+        assertEquals(headers.get(\"access-control-allow-methods\"), \"GET,PUT,POST,DELETE,HEAD,OPTIONS,PATCH\");\n+        \n+        // this property is specifically overriden for graphql\n+        assertEquals(headers.get(\"access-control-expose-headers\"), \"Content-Type,Cache-Control\");\n+    }\n+\n+    @Test\n+    public void testing_GETRequestToGraphQLServer_returnResponseWithExpectedHeaders()\n+            throws ServletException, IOException {\n+\n+        MockHttpRequest request = new MockHttpRequest(\"localhost\", \"/\");", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU1Nw==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767557", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Parameter 'name' is not assigned and could be declared final](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Parameter 'name' is not assigned and could be declared final", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Parameter 'name' is not assigned and could be declared final</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:36Z", "path": "dotCMS/src/main/java/com/dotcms/mock/response/MockHeaderResponse.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.dotcms.mock.response;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpServletResponseWrapper;\n+\n+/**\n+ * Mock {@link HttpServletRequest} with a {@link Map} as part of the class that will contain the\n+ * Headers.\n+ *\n+ * See an example here: {@link MockHttpRequest#MockHttpRequest(String, String)}\n+ */\n+public class MockHeaderResponse extends HttpServletResponseWrapper implements MockResponse {\n+  final Map<String, String> headers = new HashMap<String, String>();\n+\n+  public MockHeaderResponse(HttpServletResponse response) {\n+    super(response);\n+    if (response.getHeaderNames() != null) {\n+      Collection<String> oldHeaders = response.getHeaderNames();\n+      oldHeaders.forEach(header->{\n+        this.headers.put(header, response.getHeader(header));\n+      });\n+    }\n+  }\n+\n+  public MockHeaderResponse(HttpServletResponse response, final String key, final String value) {\n+    this(response);\n+    headers.put(key, value);\n+  }\n+\n+  public HttpServletResponse response() {\n+    return this;\n+  }\n+\n+  @Override\n+  public String getHeader(String name) {", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU2Mw==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767563", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Parameter 'response' is not assigned and could be declared final](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Parameter 'response' is not assigned and could be declared final", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Parameter 'response' is not assigned and could be declared final</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:37Z", "path": "dotCMS/src/main/java/com/dotcms/mock/response/MockHeaderResponse.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.dotcms.mock.response;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpServletResponseWrapper;\n+\n+/**\n+ * Mock {@link HttpServletRequest} with a {@link Map} as part of the class that will contain the\n+ * Headers.\n+ *\n+ * See an example here: {@link MockHttpRequest#MockHttpRequest(String, String)}\n+ */\n+public class MockHeaderResponse extends HttpServletResponseWrapper implements MockResponse {\n+  final Map<String, String> headers = new HashMap<String, String>();\n+\n+  public MockHeaderResponse(HttpServletResponse response) {\n+    super(response);\n+    if (response.getHeaderNames() != null) {\n+      Collection<String> oldHeaders = response.getHeaderNames();\n+      oldHeaders.forEach(header->{\n+        this.headers.put(header, response.getHeader(header));\n+      });\n+    }\n+  }\n+\n+  public MockHeaderResponse(HttpServletResponse response, final String key, final String value) {", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU2OA==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767568", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Avoid unused imports such as 'org.junit.Assert'](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Avoid unused imports such as 'org.junit.Assert'", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Avoid unused imports such as 'org.junit.Assert'</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:38Z", "path": "dotCMS/src/integration-test/java/com/dotcms/graphql/DotGraphQLHttpServletTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.dotcms.graphql;\n+\n+import static org.junit.Assert.*;", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU3NQ==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767575", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Avoid variables with short names like o](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Avoid variables with short names like o", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Avoid variables with short names like o</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:39Z", "path": "dotCMS/src/main/java/com/dotcms/mock/response/MockHeaderResponse.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.dotcms.mock.response;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpServletResponseWrapper;\n+\n+/**\n+ * Mock {@link HttpServletRequest} with a {@link Map} as part of the class that will contain the\n+ * Headers.\n+ *\n+ * See an example here: {@link MockHttpRequest#MockHttpRequest(String, String)}\n+ */\n+public class MockHeaderResponse extends HttpServletResponseWrapper implements MockResponse {\n+  final Map<String, String> headers = new HashMap<String, String>();\n+\n+  public MockHeaderResponse(HttpServletResponse response) {\n+    super(response);\n+    if (response.getHeaderNames() != null) {\n+      Collection<String> oldHeaders = response.getHeaderNames();\n+      oldHeaders.forEach(header->{\n+        this.headers.put(header, response.getHeader(header));\n+      });\n+    }\n+  }\n+\n+  public MockHeaderResponse(HttpServletResponse response, final String key, final String value) {\n+    this(response);\n+    headers.put(key, value);\n+  }\n+\n+  public HttpServletResponse response() {\n+    return this;\n+  }\n+\n+  @Override\n+  public String getHeader(String name) {\n+    return headers.get(name);\n+  }\n+\n+  @Override\n+  public Collection<String> getHeaderNames() {\n+    return headers.keySet();\n+  }\n+\n+  public void setHeader(final String name, final String o) {\n+    headers.put(name, o);\n+  }\n+\n+  public void addHeader(final String name, final String o) {", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU4Mg==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767582", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Local variable 'headers' could be declared final](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Local variable 'headers' could be declared final", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Local variable 'headers' could be declared final</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:40Z", "path": "dotCMS/src/integration-test/java/com/dotcms/graphql/DotGraphQLHttpServletTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.dotcms.graphql;\n+\n+import static org.junit.Assert.*;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.response.MockHeaderResponse;\n+import com.dotcms.mock.response.MockHttpResponse;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import com.dotcms.util.IntegrationTestInitService;\n+\n+public class DotGraphQLHttpServletTest {\n+\n+    \n+    @BeforeClass\n+    public static void prepare() throws Exception{\n+\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    @Test\n+    public void testing_cors_headers() {\n+        \n+        HashMap<String,String> headers = new DotGraphQLHttpServlet().corsHeaders.apply();", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU5MQ==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767591", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Local variable 'graphQLHttpServlet' could be declared final](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Local variable 'graphQLHttpServlet' could be declared final", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Local variable 'graphQLHttpServlet' could be declared final</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:42Z", "path": "dotCMS/src/integration-test/java/com/dotcms/graphql/DotGraphQLHttpServletTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.dotcms.graphql;\n+\n+import static org.junit.Assert.*;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.response.MockHeaderResponse;\n+import com.dotcms.mock.response.MockHttpResponse;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import com.dotcms.util.IntegrationTestInitService;\n+\n+public class DotGraphQLHttpServletTest {\n+\n+    \n+    @BeforeClass\n+    public static void prepare() throws Exception{\n+\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    @Test\n+    public void testing_cors_headers() {\n+        \n+        HashMap<String,String> headers = new DotGraphQLHttpServlet().corsHeaders.apply();\n+        \n+        assertEquals(headers.get(\"access-control-allow-origin\"), \"*\");\n+        assertEquals(headers.get(\"access-control-allow-credentials\"), \"true\");\n+        assertEquals(headers.get(\"access-control-allow-headers\"), \"*\");\n+        assertEquals(headers.get(\"access-control-allow-methods\"), \"GET,PUT,POST,DELETE,HEAD,OPTIONS,PATCH\");\n+        \n+        // this property is specifically overriden for graphql\n+        assertEquals(headers.get(\"access-control-expose-headers\"), \"Content-Type,Cache-Control\");\n+    }\n+\n+    @Test\n+    public void testing_GETRequestToGraphQLServer_returnResponseWithExpectedHeaders()\n+            throws ServletException, IOException {\n+\n+        MockHttpRequest request = new MockHttpRequest(\"localhost\", \"/\");\n+        MockHeaderResponse response = new MockHeaderResponse(new MockHttpResponse());\n+        DotGraphQLHttpServlet graphQLHttpServlet = new DotGraphQLHttpServlet();", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzU5Nw==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767597", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Local variable 'response' could be declared final](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Local variable 'response' could be declared final", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Local variable 'response' could be declared final</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:42Z", "path": "dotCMS/src/integration-test/java/com/dotcms/graphql/DotGraphQLHttpServletTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.dotcms.graphql;\n+\n+import static org.junit.Assert.*;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.response.MockHeaderResponse;\n+import com.dotcms.mock.response.MockHttpResponse;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import com.dotcms.util.IntegrationTestInitService;\n+\n+public class DotGraphQLHttpServletTest {\n+\n+    \n+    @BeforeClass\n+    public static void prepare() throws Exception{\n+\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    @Test\n+    public void testing_cors_headers() {\n+        \n+        HashMap<String,String> headers = new DotGraphQLHttpServlet().corsHeaders.apply();\n+        \n+        assertEquals(headers.get(\"access-control-allow-origin\"), \"*\");\n+        assertEquals(headers.get(\"access-control-allow-credentials\"), \"true\");\n+        assertEquals(headers.get(\"access-control-allow-headers\"), \"*\");\n+        assertEquals(headers.get(\"access-control-allow-methods\"), \"GET,PUT,POST,DELETE,HEAD,OPTIONS,PATCH\");\n+        \n+        // this property is specifically overriden for graphql\n+        assertEquals(headers.get(\"access-control-expose-headers\"), \"Content-Type,Cache-Control\");\n+    }\n+\n+    @Test\n+    public void testing_GETRequestToGraphQLServer_returnResponseWithExpectedHeaders()\n+            throws ServletException, IOException {\n+\n+        MockHttpRequest request = new MockHttpRequest(\"localhost\", \"/\");\n+        MockHeaderResponse response = new MockHeaderResponse(new MockHttpResponse());", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzYwNA==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767604", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Avoid unused imports such as 'javax.servlet.http.HttpServletResponse'](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Avoid unused imports such as 'javax.servlet.http.HttpServletResponse'", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Avoid unused imports such as 'javax.servlet.http.HttpServletResponse'</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:44Z", "path": "dotCMS/src/integration-test/java/com/dotcms/graphql/DotGraphQLHttpServletTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.dotcms.graphql;\n+\n+import static org.junit.Assert.*;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.response.MockHeaderResponse;\n+import com.dotcms.mock.response.MockHttpResponse;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzYxMg==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767612", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Local variable 'oldHeaders' could be declared final](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Local variable 'oldHeaders' could be declared final", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Local variable 'oldHeaders' could be declared final</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:45Z", "path": "dotCMS/src/main/java/com/dotcms/mock/response/MockHeaderResponse.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.dotcms.mock.response;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpServletResponseWrapper;\n+\n+/**\n+ * Mock {@link HttpServletRequest} with a {@link Map} as part of the class that will contain the\n+ * Headers.\n+ *\n+ * See an example here: {@link MockHttpRequest#MockHttpRequest(String, String)}\n+ */\n+public class MockHeaderResponse extends HttpServletResponseWrapper implements MockResponse {\n+  final Map<String, String> headers = new HashMap<String, String>();\n+\n+  public MockHeaderResponse(HttpServletResponse response) {\n+    super(response);\n+    if (response.getHeaderNames() != null) {\n+      Collection<String> oldHeaders = response.getHeaderNames();", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzYyMQ==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767621", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Overriding method merely calls super](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Overriding method merely calls super", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Overriding method merely calls super</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:46Z", "path": "dotCMS/src/main/java/com/dotcms/mock/response/MockHeaderResponse.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.dotcms.mock.response;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpServletResponseWrapper;\n+\n+/**\n+ * Mock {@link HttpServletRequest} with a {@link Map} as part of the class that will contain the\n+ * Headers.\n+ *\n+ * See an example here: {@link MockHttpRequest#MockHttpRequest(String, String)}\n+ */\n+public class MockHeaderResponse extends HttpServletResponseWrapper implements MockResponse {\n+  final Map<String, String> headers = new HashMap<String, String>();\n+\n+  public MockHeaderResponse(HttpServletResponse response) {\n+    super(response);\n+    if (response.getHeaderNames() != null) {\n+      Collection<String> oldHeaders = response.getHeaderNames();\n+      oldHeaders.forEach(header->{\n+        this.headers.put(header, response.getHeader(header));\n+      });\n+    }\n+  }\n+\n+  public MockHeaderResponse(HttpServletResponse response, final String key, final String value) {\n+    this(response);\n+    headers.put(key, value);\n+  }\n+\n+  public HttpServletResponse response() {\n+    return this;\n+  }\n+\n+  @Override\n+  public String getHeader(String name) {\n+    return headers.get(name);\n+  }\n+\n+  @Override\n+  public Collection<String> getHeaderNames() {\n+    return headers.keySet();\n+  }\n+\n+  public void setHeader(final String name, final String o) {\n+    headers.put(name, o);\n+  }\n+\n+  public void addHeader(final String name, final String o) {\n+    headers.put(name, o);\n+  }\n+\n+  @Override\n+  public Collection<String> getHeaders(final String name) {", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzYyOQ==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767629", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Avoid unused imports such as 'javax.servlet.http.HttpServletRequest'](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Avoid unused imports such as 'javax.servlet.http.HttpServletRequest'", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Avoid unused imports such as 'javax.servlet.http.HttpServletRequest'</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:47Z", "path": "dotCMS/src/integration-test/java/com/dotcms/graphql/DotGraphQLHttpServletTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.dotcms.graphql;\n+\n+import static org.junit.Assert.*;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.response.MockHeaderResponse;\n+import com.dotcms.mock.response.MockHttpResponse;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzYzMw==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767633", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [A method/constructor should not explicitly throw java.lang.Exception](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">A method/constructor should not explicitly throw java.lang.Exception</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:47Z", "path": "dotCMS/src/integration-test/java/com/dotcms/graphql/DotGraphQLHttpServletTest.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.dotcms.graphql;\n+\n+import static org.junit.Assert.*;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.response.MockHeaderResponse;\n+import com.dotcms.mock.response.MockHttpResponse;\n+import java.io.IOException;\n+import java.util.HashMap;\n+import javax.servlet.ServletException;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import com.dotcms.util.IntegrationTestInitService;\n+\n+public class DotGraphQLHttpServletTest {\n+\n+    \n+    @BeforeClass\n+    public static void prepare() throws Exception{", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc2NzYzNg==", "url": "https://github.com/dotCMS/core/pull/18568#discussion_r432767636", "body": "![Codacy](https://app.codacy.com/assets/images/favicon.png) Issue found: [Avoid variables with short names like o](https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581)", "bodyText": "Issue found: Avoid variables with short names like o", "bodyHTML": "<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\"><img src=\"https://camo.githubusercontent.com/ddf013cbb1295b347431f8757e505fb295e9c7dd5043d9a3a0bf610dd0bb0da7/68747470733a2f2f6170702e636f646163792e636f6d2f6173736574732f696d616765732f66617669636f6e2e706e67\" alt=\"Codacy\" data-canonical-src=\"https://app.codacy.com/assets/images/favicon.png\" style=\"max-width: 100%;\"></a> Issue found: <a href=\"https://app.codacy.com/manual/dotCMS/core/pullRequest?prid=5609581\" rel=\"nofollow\">Avoid variables with short names like o</a></p>", "author": "dev-dotcms", "createdAt": "2020-05-29T22:30:48Z", "path": "dotCMS/src/main/java/com/dotcms/mock/response/MockHeaderResponse.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package com.dotcms.mock.response;\n+\n+import com.dotcms.mock.request.MockHttpRequest;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpServletResponseWrapper;\n+\n+/**\n+ * Mock {@link HttpServletRequest} with a {@link Map} as part of the class that will contain the\n+ * Headers.\n+ *\n+ * See an example here: {@link MockHttpRequest#MockHttpRequest(String, String)}\n+ */\n+public class MockHeaderResponse extends HttpServletResponseWrapper implements MockResponse {\n+  final Map<String, String> headers = new HashMap<String, String>();\n+\n+  public MockHeaderResponse(HttpServletResponse response) {\n+    super(response);\n+    if (response.getHeaderNames() != null) {\n+      Collection<String> oldHeaders = response.getHeaderNames();\n+      oldHeaders.forEach(header->{\n+        this.headers.put(header, response.getHeader(header));\n+      });\n+    }\n+  }\n+\n+  public MockHeaderResponse(HttpServletResponse response, final String key, final String value) {\n+    this(response);\n+    headers.put(key, value);\n+  }\n+\n+  public HttpServletResponse response() {\n+    return this;\n+  }\n+\n+  @Override\n+  public String getHeader(String name) {\n+    return headers.get(name);\n+  }\n+\n+  @Override\n+  public Collection<String> getHeaderNames() {\n+    return headers.keySet();\n+  }\n+\n+  public void setHeader(final String name, final String o) {", "originalCommit": "e1953a9f7be0d2f85dd7d49147bad519dc73f7e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}