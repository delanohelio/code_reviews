{"pr_number": 1579, "pr_title": "Closes #1576: Update importTable with directory list as Set<String>", "pr_author": "drewfarris", "pr_createdAt": "2020-04-07T01:48:15Z", "pr_url": "https://github.com/apache/accumulo/pull/1579", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ5NTY1Ng==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404495656", "body": "This is public API and cannot change without a deprecation cycle.\r\nA new API is needed, which should co-exist with this one, until this one is removed.\r\nI didn't look at the rest of this PR, since this is a blocker right away.", "bodyText": "This is public API and cannot change without a deprecation cycle.\nA new API is needed, which should co-exist with this one, until this one is removed.\nI didn't look at the rest of this PR, since this is a blocker right away.", "bodyHTML": "<p dir=\"auto\">This is public API and cannot change without a deprecation cycle.<br>\nA new API is needed, which should co-exist with this one, until this one is removed.<br>\nI didn't look at the rest of this PR, since this is a blocker right away.</p>", "author": "ctubbsii", "createdAt": "2020-04-07T02:12:36Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/TableOperations.java", "diffHunk": "@@ -176,11 +176,11 @@ void create(String tableName, NewTableConfiguration ntc)\n    *\n    * @param tableName\n    *          Name of a table to create and import into.\n-   * @param importDir\n-   *          Directory that contains the files copied by distcp from exportTable\n+   * @param importDirs\n+   *          A set of directories containing the files copied by distcp from exportTable\n    * @since 1.5.0\n    */\n-  void importTable(String tableName, String importDir)\n+  void importTable(String tableName, Set<String> importDirs)", "originalCommit": "87601f2f93dbd8d1fe510f5c5aa7528ea4e7e58d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg3MDc1OA==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404870758", "bodyText": "I took a crack at this in 7f241a7 - let me know if this is sufficient.", "author": "drewfarris", "createdAt": "2020-04-07T14:50:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ5NTY1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkxNTIwMw==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404915203", "body": "Maybe the existing API should maintain its current behavior and only support a single dir. This avoids any surprises for existing code.  If someone wants to use the new functionality, they need to use the new API.\r\n```suggestion\r\n    importTable(tableName, Set.of(importDir));\r\n```", "bodyText": "Maybe the existing API should maintain its current behavior and only support a single dir. This avoids any surprises for existing code.  If someone wants to use the new functionality, they need to use the new API.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                importTable(tableName, Set.of(importDir.split(\",\")));\n          \n          \n            \n                importTable(tableName, Set.of(importDir));", "bodyHTML": "<p dir=\"auto\">Maybe the existing API should maintain its current behavior and only support a single dir. This avoids any surprises for existing code.  If someone wants to use the new functionality, they need to use the new API.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    importTable(tableName, <span class=\"pl-smi\">Set</span><span class=\"pl-k\">.</span>of(importDir<span class=\"pl-k x x-first\">.</span><span class=\"x\">split(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">,</span><span class=\"pl-pds x\">\"</span></span><span class=\"x x-last\">)</span>));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    importTable(tableName, <span class=\"pl-smi\">Set</span><span class=\"pl-k\">.</span>of(importDir));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "keith-turner", "createdAt": "2020-04-07T15:46:41Z", "path": "core/src/main/java/org/apache/accumulo/core/clientImpl/TableOperationsImpl.java", "diffHunk": "@@ -1544,22 +1544,29 @@ public static Path findExportFile(ClientContext context, List<String> importDirs\n   @Override\n   public void importTable(String tableName, String importDir)\n       throws TableExistsException, AccumuloException, AccumuloSecurityException {\n+    importTable(tableName, Set.of(importDir.split(\",\")));", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkzNDk4Ng==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404934986", "bodyText": "\ud83d\udc4d I had the same thought.", "author": "ctubbsii", "createdAt": "2020-04-07T16:13:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkxNTIwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkyNjYzNA==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404926634", "body": "This does not have to be deprecated because a new method was added.  Also, do you want the method to be removed in the future?  Starting with Java 9, two parameters were added to the deprecated annotation `since` and `forRemoval`.  The default for `forRemoval` is false.  If deprecating, it may also be good explicitly set these.  Not sure if my syntax is correct below, I have not used these yet.\r\n\r\n```suggestion\r\n  @Deprecated(since=\"2.1.0\",forRemoval=false)\r\n```\r\n\r\nPersonally, I don't think the method needs to be deprecated.", "bodyText": "This does not have to be deprecated because a new method was added.  Also, do you want the method to be removed in the future?  Starting with Java 9, two parameters were added to the deprecated annotation since and forRemoval.  The default for forRemoval is false.  If deprecating, it may also be good explicitly set these.  Not sure if my syntax is correct below, I have not used these yet.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              @Deprecated\n          \n          \n            \n              @Deprecated(since=\"2.1.0\",forRemoval=false)\n          \n      \n    \n    \n  \n\nPersonally, I don't think the method needs to be deprecated.", "bodyHTML": "<p dir=\"auto\">This does not have to be deprecated because a new method was added.  Also, do you want the method to be removed in the future?  Starting with Java 9, two parameters were added to the deprecated annotation <code>since</code> and <code>forRemoval</code>.  The default for <code>forRemoval</code> is false.  If deprecating, it may also be good explicitly set these.  Not sure if my syntax is correct below, I have not used these yet.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">@Deprecated</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">@Deprecated</span><span class=\"x x-first\">(</span><span class=\"pl-c1 x\">since</span><span class=\"pl-k x\">=</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">2.1.0</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">,</span><span class=\"pl-c1 x\">forRemoval</span><span class=\"pl-k x\">=</span><span class=\"pl-c1 x\">false</span><span class=\"x x-last\">)</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">Personally, I don't think the method needs to be deprecated.</p>", "author": "keith-turner", "createdAt": "2020-04-07T16:01:29Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/TableOperations.java", "diffHunk": "@@ -176,11 +176,27 @@ void create(String tableName, NewTableConfiguration ntc)\n    *\n    * @param tableName\n    *          Name of a table to create and import into.\n-   * @param importDir\n-   *          Directory that contains the files copied by distcp from exportTable\n+   * @param importDirs\n+   *          A comma-delimited list of directories containing the files copied by distcp from\n+   *          exportTable\n    * @since 1.5.0\n+   *\n+   * @deprecated since 2.1.0 use {@link #importTable(String, Set)} instead.\n+   */\n+  @Deprecated", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkzNTYxMA==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404935610", "bodyText": "I don't care whether it is deprecated or not, but would prefer the original method keep the behavior from before #1060 ; I think it's fine if not.", "author": "ctubbsii", "createdAt": "2020-04-07T16:13:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkyNjYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MDM3OA==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404990378", "bodyText": "This does not have to be deprecated because a new method was added.\n\nHmm, I don't understand why adding a new method eliminates the need for deprecation. The idea here would be to remove the original importTable(String, String) at some point when it is safe to do so.\nThanks for mentioning the Java 9 parameters. As such, I suspect the right annotation would be:\n@Deprecated(since=\"2.1.0\",forRemoval=true)", "author": "drewfarris", "createdAt": "2020-04-07T17:34:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkyNjYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAwODQ1OQ==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405008459", "bodyText": "Hmm, I don't understand why adding a new method eliminates the need for deprecation.\n\nThe deprecation has nothing to do with the addition of the new method. It pertains to the removal of the old method.\n\nThe idea here would be to remove the original importTable(String, String) at some point when it is safe to do so.\n\nIf you think it's better to remove the old method, that's fine and it should be deprecated. It's just not a requirement to remove it.\n\n@Deprecated(since=\"2.1.0\",forRemoval=true)\n\nIf it is going to be deprecated, I agree it should be marked this way. I don't think we ever want to deprecate something and still retain it forever. The reason we deprecate stuff is so we can purge it (eventually). I wish forRemoval=true were default when they added this, because that's how I've always interpreted @Deprecated, but I recognize others may interpret it differently.", "author": "ctubbsii", "createdAt": "2020-04-07T18:03:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkyNjYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA0NzkwMA==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405047900", "bodyText": "Hmm, I don't understand why adding a new method eliminates the need for deprecation.\n\nI was just thinking that adding the new method does not necessitate deprecating the existing one.  The existing method is not broken in any way, it still satisfies its original functionality for anyone who invested the time to write code against it in the past.", "author": "keith-turner", "createdAt": "2020-04-07T19:09:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkyNjYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA2MzUwNg==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405063506", "bodyText": "I was just thinking that adding the new method does not necessitate deprecating the existing one. The existing method is not broken in any way, it still satisfies its original functionality for anyone who invested the time to write code against it in the past.\n\nI'm happy to go either way. I suppose I'm in favor of keeping the number of public api methods to a minimum, but I don't feel strongly about leaving the existing method around if that's a better fit for the project.", "author": "drewfarris", "createdAt": "2020-04-07T19:37:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkyNjYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA4OTQ0Nw==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405089447", "bodyText": "I suppose I'm in favor of keeping the number of public api methods to a minimum\n\nThat is a good goal, not sure whats best in the big scheme of things.   In my experience removing methods is most painful for indirect users of Accumulo (like someone using Accumulo via something like Rya).  Can get into a situation where you can not use the latest version of Accumulo w/o patching and rebuilding Rya.\nCould minimize clutter in the Accumulo source using a default method in the interface for the existing method (that calls the new method) and have it nowhere else.", "author": "keith-turner", "createdAt": "2020-04-07T20:24:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkyNjYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU1OTM4Mw==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405559383", "bodyText": "That is a good goal, not sure whats best in the big scheme of things.\n\nOk, thanks for explaining your perspective. The makes a great deal of sense. Based on this, I'm going to avoid deprecating the original method. It looks like theres precedent for default implementations in the TableOperations interface, so I'll proceed in that way.", "author": "drewfarris", "createdAt": "2020-04-08T14:16:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkyNjYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkzODA4NQ==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404938085", "body": "This isn't used.", "bodyText": "This isn't used.", "bodyHTML": "<p dir=\"auto\">This isn't used.</p>", "author": "ctubbsii", "createdAt": "2020-04-07T16:17:18Z", "path": "core/src/main/java/org/apache/accumulo/core/clientImpl/TableOperationsImpl.java", "diffHunk": "@@ -1544,22 +1544,29 @@ public static Path findExportFile(ClientContext context, List<String> importDirs\n   @Override\n   public void importTable(String tableName, String importDir)\n       throws TableExistsException, AccumuloException, AccumuloSecurityException {\n+    importTable(tableName, Set.of(importDir.split(\",\")));\n+  }\n+\n+  @Override\n+  public void importTable(String tableName, Set<String> importDirs)\n+      throws TableExistsException, AccumuloException, AccumuloSecurityException {\n     checkArgument(tableName != null, \"tableName is null\");\n-    checkArgument(importDir != null, \"importDir is null\");\n+    checkArgument(importDirs != null, \"importDir is null\");\n     checkArgument(tableName.length() <= MAX_TABLE_NAME_LEN,\n         \"Table name is longer than \" + MAX_TABLE_NAME_LEN + \" characters\");\n \n-    List<String> importDirs = new ArrayList<>();\n-    for (String dir : importDir.split(\",\")) {\n-      try {\n-        importDirs.add(checkPath(dir, \"Table\", \"\").toString());\n-      } catch (IOException e) {\n-        throw new AccumuloException(e);\n+    Set<String> checkedImportDirs = new HashSet<String>();\n+    try {\n+      for (String s : importDirs) {\n+        checkedImportDirs.add(checkPath(s, \"Table\", \"\").toString());\n       }\n+    } catch (IOException e) {\n+      throw new AccumuloException(e);\n     }\n+    String normedImportDir = StringUtils.join(checkedImportDirs, \",\");", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDkzOTU2Mw==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404939563", "body": "Since the variable was renamed, there are other places below that need to be changed from `importDirs` to `checkedImportDirs` as well.", "bodyText": "Since the variable was renamed, there are other places below that need to be changed from importDirs to checkedImportDirs as well.", "bodyHTML": "<p dir=\"auto\">Since the variable was renamed, there are other places below that need to be changed from <code>importDirs</code> to <code>checkedImportDirs</code> as well.</p>", "author": "ctubbsii", "createdAt": "2020-04-07T16:19:26Z", "path": "core/src/main/java/org/apache/accumulo/core/clientImpl/TableOperationsImpl.java", "diffHunk": "@@ -1544,22 +1544,29 @@ public static Path findExportFile(ClientContext context, List<String> importDirs\n   @Override\n   public void importTable(String tableName, String importDir)\n       throws TableExistsException, AccumuloException, AccumuloSecurityException {\n+    importTable(tableName, Set.of(importDir.split(\",\")));\n+  }\n+\n+  @Override\n+  public void importTable(String tableName, Set<String> importDirs)\n+      throws TableExistsException, AccumuloException, AccumuloSecurityException {\n     checkArgument(tableName != null, \"tableName is null\");\n-    checkArgument(importDir != null, \"importDir is null\");\n+    checkArgument(importDirs != null, \"importDir is null\");\n     checkArgument(tableName.length() <= MAX_TABLE_NAME_LEN,\n         \"Table name is longer than \" + MAX_TABLE_NAME_LEN + \" characters\");\n \n-    List<String> importDirs = new ArrayList<>();\n-    for (String dir : importDir.split(\",\")) {\n-      try {\n-        importDirs.add(checkPath(dir, \"Table\", \"\").toString());\n-      } catch (IOException e) {\n-        throw new AccumuloException(e);\n+    Set<String> checkedImportDirs = new HashSet<String>();\n+    try {\n+      for (String s : importDirs) {\n+        checkedImportDirs.add(checkPath(s, \"Table\", \"\").toString());\n       }\n+    } catch (IOException e) {\n+      throw new AccumuloException(e);\n     }\n+    String normedImportDir = StringUtils.join(checkedImportDirs, \",\");\n \n     try {\n-      Path exportFilePath = findExportFile(context, importDirs);\n+      Path exportFilePath = findExportFile(context, checkedImportDirs);", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk0NTMxOQ==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404945319", "body": "Since the Fate serialization has changed, it will be very important that there are no outstanding import table fate operations outstanding before upgrading. I suspect this is unlikely for most people, but may be something to call out in the release notes.", "bodyText": "Since the Fate serialization has changed, it will be very important that there are no outstanding import table fate operations outstanding before upgrading. I suspect this is unlikely for most people, but may be something to call out in the release notes.", "bodyHTML": "<p dir=\"auto\">Since the Fate serialization has changed, it will be very important that there are no outstanding import table fate operations outstanding before upgrading. I suspect this is unlikely for most people, but may be something to call out in the release notes.</p>", "author": "ctubbsii", "createdAt": "2020-04-07T16:27:19Z", "path": "server/master/src/main/java/org/apache/accumulo/master/tableOps/tableImport/ImportTable.java", "diffHunk": "@@ -53,16 +54,17 @@\n public class ImportTable extends MasterRepo {\n   private static final Logger log = LoggerFactory.getLogger(ImportTable.class);\n \n-  private static final long serialVersionUID = 1L;\n+  private static final long serialVersionUID = 2L;", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc3NTUxMg==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405775512", "bodyText": "I think we check before upgrade if there are any outstanding FATE ops and if so upgrade will not proceed.  So usually do not need to worry about FATE persistence across versions.", "author": "keith-turner", "createdAt": "2020-04-08T19:54:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk0NTMxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk0ODUzNw==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404948537", "body": "Since the `exportDir` is set in the constructor, can we now make the field `final`?", "bodyText": "Since the exportDir is set in the constructor, can we now make the field final?", "bodyHTML": "<p dir=\"auto\">Since the <code>exportDir</code> is set in the constructor, can we now make the field <code>final</code>?</p>", "author": "ctubbsii", "createdAt": "2020-04-07T16:31:42Z", "path": "server/master/src/main/java/org/apache/accumulo/master/tableOps/tableImport/ImportedTableInfo.java", "diffHunk": "@@ -38,6 +38,10 @@\n   static class DirectoryMapping implements Serializable {\n     private static final long serialVersionUID = 1L;\n \n+    public DirectoryMapping(String exportDir) {\n+      this.exportDir = exportDir;", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk1MTMwNg==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404951306", "body": "If you define this set earlier, you wouldn't need to manually concatenate them for the log message, because you could just rely on `Set.toString()`.", "bodyText": "If you define this set earlier, you wouldn't need to manually concatenate them for the log message, because you could just rely on Set.toString().", "bodyHTML": "<p dir=\"auto\">If you define this set earlier, you wouldn't need to manually concatenate them for the log message, because you could just rely on <code>Set.toString()</code>.</p>", "author": "ctubbsii", "createdAt": "2020-04-07T16:35:50Z", "path": "test/src/main/java/org/apache/accumulo/test/ImportExportIT.java", "diffHunk": "@@ -151,7 +151,8 @@ public void testExportImportThenScan() throws Exception {\n       log.info(\"Import dir B: {}\", Arrays.toString(fs.listStatus(importDirB)));\n \n       // Import the exported data into a new table\n-      client.tableOperations().importTable(destTable, importDirDlm);\n+      client.tableOperations().importTable(destTable,\n+          Set.of(importDirA.toString(), importDirB.toString()));", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk1MjUxMQ==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404952511", "body": "`Set.of(X)` is shorter than `Collections.singleton(X)`.", "bodyText": "Set.of(X) is shorter than Collections.singleton(X).", "bodyHTML": "<p dir=\"auto\"><code>Set.of(X)</code> is shorter than <code>Collections.singleton(X)</code>.</p>", "author": "ctubbsii", "createdAt": "2020-04-07T16:37:39Z", "path": "test/src/main/java/org/apache/accumulo/test/NamespacesIT.java", "diffHunk": "@@ -980,8 +980,8 @@ public void verifyTableOperationsExceptions() throws Exception {\n         () -> ops.clone(\"a\", tableName, true, Collections.emptyMap(), Collections.emptySet()));\n     ops.offline(\"a\", true);\n     ops.exportTable(\"a\", System.getProperty(\"user.dir\") + \"/target\");\n-    assertAccumuloExceptionNoNamespace(\n-        () -> ops.importTable(tableName, System.getProperty(\"user.dir\") + \"/target\"));\n+    assertAccumuloExceptionNoNamespace(() -> ops.importTable(tableName,\n+        Collections.singleton(System.getProperty(\"user.dir\") + \"/target\")));", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk3NjQwNQ==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r404976405", "body": "@ctubbsii @keith-turner - `Predicate.not` was added in Java 11 and I expected the build to fail when I used it, but it didn't. What runtimes are we supporting for 2.1.x?", "bodyText": "@ctubbsii @keith-turner - Predicate.not was added in Java 11 and I expected the build to fail when I used it, but it didn't. What runtimes are we supporting for 2.1.x?", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ctubbsii/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ctubbsii\">@ctubbsii</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/keith-turner/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/keith-turner\">@keith-turner</a> - <code>Predicate.not</code> was added in Java 11 and I expected the build to fail when I used it, but it didn't. What runtimes are we supporting for 2.1.x?</p>", "author": "drewfarris", "createdAt": "2020-04-07T17:13:00Z", "path": "server/master/src/main/java/org/apache/accumulo/master/tableOps/tableImport/ImportTable.java", "diffHunk": "@@ -19,13 +19,14 @@\n package org.apache.accumulo.master.tableOps.tableImport;\n \n import static java.nio.charset.StandardCharsets.UTF_8;\n+import static java.util.function.Predicate.not;", "originalCommit": "7f241a70c3be2d0d5c5b4159684fc5d6646bdcc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAwOTc2NQ==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405009765", "bodyText": "2.1 is targeting Java 11.", "author": "ctubbsii", "createdAt": "2020-04-07T18:05:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk3NjQwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyOTQ5Ng==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405129496", "body": "This javadoc is no longer true.", "bodyText": "This javadoc is no longer true.", "bodyHTML": "<p dir=\"auto\">This javadoc is no longer true.</p>", "author": "ctubbsii", "createdAt": "2020-04-07T21:39:33Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/TableOperations.java", "diffHunk": "@@ -176,11 +176,27 @@ void create(String tableName, NewTableConfiguration ntc)\n    *\n    * @param tableName\n    *          Name of a table to create and import into.\n-   * @param importDir\n-   *          Directory that contains the files copied by distcp from exportTable\n+   * @param importDirs\n+   *          A comma-delimited list of directories containing the files copied by distcp from\n+   *          exportTable", "originalCommit": "4537bfe340dde0e3bed5d6aec9249ce331be6ab2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTEyOTc2OQ==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405129769", "body": "I think this should be singular \"importDir\" now (or whatever it was called before the changes in #1060 )", "bodyText": "I think this should be singular \"importDir\" now (or whatever it was called before the changes in #1060 )", "bodyHTML": "<p dir=\"auto\">I think this should be singular \"importDir\" now (or whatever it was called before the changes in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"426490981\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/accumulo/issues/1060\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/accumulo/pull/1060/hovercard\" href=\"https://github.com/apache/accumulo/pull/1060\">#1060</a> )</p>", "author": "ctubbsii", "createdAt": "2020-04-07T21:40:05Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/TableOperations.java", "diffHunk": "@@ -176,11 +176,27 @@ void create(String tableName, NewTableConfiguration ntc)\n    *\n    * @param tableName\n    *          Name of a table to create and import into.\n-   * @param importDir\n-   *          Directory that contains the files copied by distcp from exportTable\n+   * @param importDirs\n+   *          A comma-delimited list of directories containing the files copied by distcp from\n+   *          exportTable\n    * @since 1.5.0\n+   *\n+   * @deprecated since 2.1.0 use {@link #importTable(String, Set)} instead.\n+   */\n+  @Deprecated(since = \"2.1.0\", forRemoval = true)\n+  void importTable(String tableName, String importDirs)", "originalCommit": "4537bfe340dde0e3bed5d6aec9249ce331be6ab2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU5MTQ5Ng==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405591496", "body": "If you're using a default method in the interface, the corresponding methods can be deleted from the implementing classes. I would check all subclasses and remove any that aren't needed.", "bodyText": "If you're using a default method in the interface, the corresponding methods can be deleted from the implementing classes. I would check all subclasses and remove any that aren't needed.", "bodyHTML": "<p dir=\"auto\">If you're using a default method in the interface, the corresponding methods can be deleted from the implementing classes. I would check all subclasses and remove any that aren't needed.</p>", "author": "ctubbsii", "createdAt": "2020-04-08T14:59:56Z", "path": "core/src/test/java/org/apache/accumulo/core/clientImpl/TableOperationsHelperTest.java", "diffHunk": "@@ -199,6 +199,9 @@ public void clearLocatorCache(String tableName) {}\n     @Override\n     public void importTable(String tableName, String exportDir) {}", "originalCommit": "756acaab4a41f15a68e9d2dbdbbe8c610d129905", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aedf445cfaa5bf1484d88b2477c87e181bfd34fa", "url": "https://github.com/apache/accumulo/commit/aedf445cfaa5bf1484d88b2477c87e181bfd34fa", "message": "Closes #1576: Add importTable with directory list as Set<String> (#1579)", "committedDate": "2020-04-08T18:22:45Z", "type": "commit"}, {"oid": "aedf445cfaa5bf1484d88b2477c87e181bfd34fa", "url": "https://github.com/apache/accumulo/commit/aedf445cfaa5bf1484d88b2477c87e181bfd34fa", "message": "Closes #1576: Add importTable with directory list as Set<String> (#1579)", "committedDate": "2020-04-08T18:22:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc3NDM5OQ==", "url": "https://github.com/apache/accumulo/pull/1579#discussion_r405774399", "body": "Is there anything that would be worth mentioning about the metadata zip file and multiple dirs here?", "bodyText": "Is there anything that would be worth mentioning about the metadata zip file and multiple dirs here?", "bodyHTML": "<p dir=\"auto\">Is there anything that would be worth mentioning about the metadata zip file and multiple dirs here?</p>", "author": "keith-turner", "createdAt": "2020-04-08T19:52:12Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/TableOperations.java", "diffHunk": "@@ -177,10 +177,25 @@ void create(String tableName, NewTableConfiguration ntc)\n    * @param tableName\n    *          Name of a table to create and import into.\n    * @param importDir\n-   *          Directory that contains the files copied by distcp from exportTable\n+   *          A directory containing the files copied by distcp from exportTable\n    * @since 1.5.0\n+   *\n+   */\n+  default void importTable(String tableName, String importDir)\n+      throws TableExistsException, AccumuloException, AccumuloSecurityException {\n+    importTable(tableName, Set.of(importDir));\n+  }\n+\n+  /**\n+   * Imports a table exported via exportTable and copied via hadoop distcp.\n+   *\n+   * @param tableName\n+   *          Name of a table to create and import into.\n+   * @param importDirs\n+   *          A set of directories containing the files copied by distcp from exportTable", "originalCommit": "aedf445cfaa5bf1484d88b2477c87e181bfd34fa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}