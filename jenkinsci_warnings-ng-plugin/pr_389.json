{"pr_number": 389, "pr_title": "[JENKINS-59791] Added remote API for blames info", "pr_author": "XiongKezhi", "pr_createdAt": "2020-02-21T06:23:52Z", "pr_url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389", "timeline": [{"oid": "c95d216c67dd62586a30a3cd5dee2d62f4839380", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/c95d216c67dd62586a30a3cd5dee2d62f4839380", "message": "added BlameApi", "committedDate": "2020-02-21T06:08:13Z", "type": "commit"}, {"oid": "58b21630e7729fa7b3394e56bf4d4604aa6fe2b1", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/58b21630e7729fa7b3394e56bf4d4604aa6fe2b1", "message": "resolved some quality issues", "committedDate": "2020-02-21T06:37:12Z", "type": "commit"}, {"oid": "57603ba43b63369a513eba8f8a9ae9a8407ecf1c", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/57603ba43b63369a513eba8f8a9ae9a8407ecf1c", "message": "refactored IssueApi's constructor to allow nullable param", "committedDate": "2020-02-21T07:07:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0MDQyOA==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382440428", "body": "Wouldn't it be much simpler if we denormalize the `Blames` and add 3 additional getters to IssueApi? Then `BlameApi` is not required at all?", "bodyText": "Wouldn't it be much simpler if we denormalize the Blames and add 3 additional getters to IssueApi? Then BlameApi is not required at all?", "bodyHTML": "<p dir=\"auto\">Wouldn't it be much simpler if we denormalize the <code>Blames</code> and add 3 additional getters to IssueApi? Then <code>BlameApi</code> is not required at all?</p>", "author": "uhafner", "createdAt": "2020-02-21T07:55:36Z", "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/BlameApi.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package io.jenkins.plugins.analysis.core.restapi;\n+\n+import org.kohsuke.stapler.export.Exported;\n+import org.kohsuke.stapler.export.ExportedBean;\n+\n+import io.jenkins.plugins.forensics.blame.FileBlame;\n+\n+/**\n+ * Remote API for a {@link FileBlame}. Simple Java Bean that exposes several methods of an {@link FileBlame} instance.\n+ *\n+ * @author Kezhi Xiong\n+ */\n+@ExportedBean\n+public class BlameApi {", "originalCommit": "57603ba43b63369a513eba8f8a9ae9a8407ecf1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ3MTg4Ng==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382471886", "bodyText": "The reason I add the BlameApi and to take the blame information as object list in each issue in json/xml is that because I saw the getLineStart/End method, so I thought it could be possible that we have multiple blames for an issue which contains multiple lines. Does that situation exist? And about your suggestion, what about if I add some getters like getAuthor(filename, line) in Blames, or just simply access them in IssueApi?", "author": "XiongKezhi", "createdAt": "2020-02-21T09:15:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0MDQyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ3Njc4Ng==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382476786", "bodyText": "The reason I add the BlameApi and to make the blame infomations as object list in each issue in json/xml is that because I saw the getLineStart/End method, so I thought it could be possible that we have multiple blames for a issue which contains multiple line. Does that situation really exists? And about your suggestion, what about if I add some getters like getAuthor(filename, line) in Blames, or just simplely access them in IssueApi?\n\nNo, this situation cannot happen since the blames are computed from the issue startLine attribute, so each issue has a 1:1 mapping to the blames currently. It is already denormalized in the model. So it makes sense to just have 3 additional attributes in IssueApi that delegate to the corresponding blame, see https://github.com/jenkinsci/warnings-ng-plugin/blob/master/src/main/java/io/jenkins/plugins/analysis/core/model/BlamesModel.java#L78 for details.", "author": "uhafner", "createdAt": "2020-02-21T09:25:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0MDQyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ3NzE2OQ==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382477169", "bodyText": "BlameApi is not required at all", "author": "uhafner", "createdAt": "2020-02-21T09:26:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0MDQyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUzOTI0MQ==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382539241", "bodyText": "Thanks for pointing out, I got it.", "author": "XiongKezhi", "createdAt": "2020-02-21T11:45:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ0MDQyOA=="}], "type": "inlineReview"}, {"oid": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "message": "refactored code and deleted the BlameApi for simplicity", "committedDate": "2020-02-21T11:43:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxMzkxOA==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382913918", "body": "Use `Blame` from https://github.com/jenkinsci/warnings-ng-plugin/pull/391. ", "bodyText": "Use Blame from #391.", "bodyHTML": "<p dir=\"auto\">Use <code>Blame</code> from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"569321322\" data-permission-text=\"Title is private\" data-url=\"https://github.com/jenkinsci/warnings-ng-plugin/issues/391\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/jenkinsci/warnings-ng-plugin/pull/391/hovercard\" href=\"https://github.com/jenkinsci/warnings-ng-plugin/pull/391\">#391</a>.</p>", "author": "uhafner", "createdAt": "2020-02-22T13:49:09Z", "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/IssueApi.java", "diffHunk": "@@ -13,15 +16,19 @@\n @ExportedBean\n public class IssueApi {\n     private final Issue issue;\n+    private final FileBlame fileBlame;", "originalCommit": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxMzkyNg==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382913926", "body": "see above", "bodyText": "see above", "bodyHTML": "<p dir=\"auto\">see above</p>", "author": "uhafner", "createdAt": "2020-02-22T13:49:23Z", "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/IssueApi.java", "diffHunk": "@@ -13,15 +16,19 @@\n @ExportedBean\n public class IssueApi {\n     private final Issue issue;\n+    private final FileBlame fileBlame;\n \n     /**\n      * Creates a new {@link IssueApi}.\n      *\n      * @param issue\n      *         the issue to expose the properties from\n+     * @param fileBlame\n+     *          the blame of the issue file\n      */\n-    public IssueApi(final Issue issue) {\n+    public IssueApi(final Issue issue, @Nullable final FileBlame fileBlame) {", "originalCommit": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxMzk4MA==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382913980", "body": "Using `Blame` introduced in https://github.com/jenkinsci/warnings-ng-plugin/pull/391 makes this call much simpler: \r\n```\r\nreturn blame.getAuthor();\r\n```", "bodyText": "Using Blame introduced in #391 makes this call much simpler:\nreturn blame.getAuthor();", "bodyHTML": "<p dir=\"auto\">Using <code>Blame</code> introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"569321322\" data-permission-text=\"Title is private\" data-url=\"https://github.com/jenkinsci/warnings-ng-plugin/issues/391\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/jenkinsci/warnings-ng-plugin/pull/391/hovercard\" href=\"https://github.com/jenkinsci/warnings-ng-plugin/pull/391\">#391</a> makes this call much simpler:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"return blame.getAuthor();\"><pre><code>return blame.getAuthor();\n</code></pre></div>", "author": "uhafner", "createdAt": "2020-02-22T13:50:25Z", "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/IssueApi.java", "diffHunk": "@@ -103,4 +110,43 @@ public String getReference() {\n     public String getFingerprint() {\n         return issue.getFingerprint();\n     }\n+\n+    /**\n+     * Returns the author's name of the blame.\n+     *\n+     * @return the name of the author\n+     */\n+    @Exported\n+    public String getAuthor() {\n+        if (fileBlame != null) {", "originalCommit": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxNDA0Nw==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382914047", "body": "I think it makes sense to add an `addedAt` property as well.", "bodyText": "I think it makes sense to add an addedAt property as well.", "bodyHTML": "<p dir=\"auto\">I think it makes sense to add an <code>addedAt</code> property as well.</p>", "author": "uhafner", "createdAt": "2020-02-22T13:51:11Z", "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/IssueApi.java", "diffHunk": "@@ -103,4 +110,43 @@ public String getReference() {\n     public String getFingerprint() {\n         return issue.getFingerprint();\n     }\n+\n+    /**\n+     * Returns the author's name of the blame.\n+     *\n+     * @return the name of the author\n+     */\n+    @Exported\n+    public String getAuthor() {\n+        if (fileBlame != null) {\n+            return fileBlame.getName(getLineStart());\n+        }\n+        return \"\";\n+    }\n+\n+    /**\n+     * Returns the author's email of the blame.\n+     *\n+     * @return the email of the author\n+     */\n+    @Exported\n+    public String getEmail() {\n+        if (fileBlame != null) {\n+            return fileBlame.getEmail(getLineStart());\n+        }\n+        return \"\";\n+    }\n+\n+    /**\n+     * Returns the commit's sha1 of the blame.\n+     *\n+     * @return the commit's sha1 of the blame\n+     */\n+    @Exported\n+    public String getCommit() {\n+        if (fileBlame != null) {\n+            return fileBlame.getCommit(getLineStart());\n+        }\n+        return \"\";\n+    }", "originalCommit": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxNDQ2Mg==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/389#discussion_r382914462", "body": "```suggestion\r\nreturn new IssueApi(issue, new Blame(issue, blames));\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (blames.contains(issue.getFileName())) {\n          \n          \n            \n                        return new IssueApi(issue, blames.getBlame(issue.getFileName()));\n          \n          \n            \n                    }\n          \n          \n            \n                    return new IssueApi(issue, null);\n          \n          \n            \n            return new IssueApi(issue, new Blame(issue, blames));", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (blames<span class=\"pl-k\">.</span>contains(issue<span class=\"pl-k\">.</span>getFileName())) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">IssueApi</span>(issue, blames<span class=\"pl-k\">.</span>getBlame(issue<span class=\"pl-k\">.</span>getFileName()));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">IssueApi</span>(issue, <span class=\"pl-c1\">null</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">IssueApi</span>(issue, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">Blame</span>(issue, blames));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "uhafner", "createdAt": "2020-02-22T13:57:34Z", "path": "src/main/java/io/jenkins/plugins/analysis/core/restapi/ReportApi.java", "diffHunk": "@@ -33,7 +40,14 @@ public ReportApi(final Report report) {\n     }\n \n     private List<IssueApi> map() {\n-        return report.stream().map(IssueApi::new).collect(Collectors.toList());\n+        return report.stream().map(this::createIssueApi).collect(Collectors.toList());\n+    }\n+\n+    private IssueApi createIssueApi(final Issue issue) {\n+        if (blames.contains(issue.getFileName())) {\n+            return new IssueApi(issue, blames.getBlame(issue.getFileName()));\n+        }\n+        return new IssueApi(issue, null);", "originalCommit": "91da2e5e3e634d94f6b01022aad24ee4c75d2c2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc12d1e64790c0457439e94c0e0ad185a0ce1956", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/bc12d1e64790c0457439e94c0e0ad185a0ce1956", "message": "Merge remote-tracking branch 'upstream/master' into JENKINS-59791", "committedDate": "2020-02-22T15:48:31Z", "type": "commit"}, {"oid": "aef2f6c72df915a99829f9c98bb43db234092378", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/aef2f6c72df915a99829f9c98bb43db234092378", "message": "refactored to use Blame in IssueApi", "committedDate": "2020-02-22T17:53:54Z", "type": "commit"}]}