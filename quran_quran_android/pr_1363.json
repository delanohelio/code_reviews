{"pr_number": 1363, "pr_title": "#1361 show the translated names of the sura in the sura list fragment.", "pr_author": "AhmedGarhy", "pr_createdAt": "2020-05-20T22:16:00Z", "pr_url": "https://github.com/quran/quran_android/pull/1363", "merge_commit": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "timeline": [{"oid": "35296173820de955683fe046284ca4c0cfb4b83c", "url": "https://github.com/quran/quran_android/commit/35296173820de955683fe046284ca4c0cfb4b83c", "message": "#1361 show the translated names of the sura in the sura list fragment.", "committedDate": "2020-05-20T22:13:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTE5Mg==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341192", "body": "replace with:\r\n\r\n```\r\n  @Inject\r\n  QuranSettings quranSettings;\r\n```\r\n\r\nfield at the top.", "bodyText": "replace with:\n  @Inject\n  QuranSettings quranSettings;\n\nfield at the top.", "bodyHTML": "<p dir=\"auto\">replace with:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  @Inject\n  QuranSettings quranSettings;\"><pre><code>  @Inject\n  QuranSettings quranSettings;\n</code></pre></div>\n<p dir=\"auto\">field at the top.</p>", "author": "ahmedre", "createdAt": "2020-05-20T22:22:01Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java", "diffHunk": "@@ -128,7 +129,8 @@ private void updateScrollBarPositionHoneycomb() {\n \n     Activity activity = getActivity();\n     boolean wantPrefix = activity.getResources().getBoolean(R.bool.show_surat_prefix);\n-    boolean wantTranslation = activity.getResources().getBoolean(R.bool.show_sura_names_translation);\n+    QuranSettings settings = QuranSettings.getInstance(activity);", "originalCommit": "35296173820de955683fe046284ca4c0cfb4b83c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eb52558fd25306fc1afc1967f37fff814619ddd9", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\nindex 31b70d49..ceb9d6cf 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n", "chunk": "@@ -129,8 +136,7 @@ public class SuraListFragment extends Fragment {\n \n     Activity activity = getActivity();\n     boolean wantPrefix = activity.getResources().getBoolean(R.bool.show_surat_prefix);\n-    QuranSettings settings = QuranSettings.getInstance(activity);\n-    boolean wantTranslation = settings.isShowSuraTranslatedName();\n+    boolean wantTranslation = quranSettings.isShowSuraTranslatedName();\n     for (int juz = 1; juz <= JUZ2_COUNT; juz++) {\n       final String headerTitle = activity.getString(R.string.juz2_description,\n           QuranUtils.getLocalizedNumber(activity, juz));\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\nindex 31b70d49..16c59add 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n", "chunk": "@@ -129,8 +136,7 @@ public class SuraListFragment extends Fragment {\n \n     Activity activity = getActivity();\n     boolean wantPrefix = activity.getResources().getBoolean(R.bool.show_surat_prefix);\n-    QuranSettings settings = QuranSettings.getInstance(activity);\n-    boolean wantTranslation = settings.isShowSuraTranslatedName();\n+    boolean wantTranslation = quranSettings.isShowSuraTranslatedName();\n     for (int juz = 1; juz <= JUZ2_COUNT; juz++) {\n       final String headerTitle = activity.getString(R.string.juz2_description,\n           QuranUtils.getLocalizedNumber(activity, juz));\n", "next_change": {"commit": "ef58c2ffcc682c4807d9c0984f9700eabbfefb46", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\ndeleted file mode 100644\nindex 16c59add..00000000\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n+++ /dev/null\n", "chunk": "@@ -1,170 +0,0 @@\n-package com.quran.labs.androidquran.ui.fragment;\n-\n-import android.app.Activity;\n-import android.content.Context;\n-import android.os.Bundle;\n-import androidx.annotation.NonNull;\n-import androidx.fragment.app.Fragment;\n-import androidx.recyclerview.widget.DefaultItemAnimator;\n-import androidx.recyclerview.widget.LinearLayoutManager;\n-import androidx.recyclerview.widget.RecyclerView;\n-import android.text.TextUtils;\n-import android.view.LayoutInflater;\n-import android.view.View;\n-import android.view.ViewGroup;\n-\n-import com.quran.data.core.QuranInfo;\n-import com.quran.labs.androidquran.QuranApplication;\n-import com.quran.labs.androidquran.R;\n-import com.quran.labs.androidquran.data.Constants;\n-import com.quran.labs.androidquran.data.QuranDisplayData;\n-import com.quran.labs.androidquran.ui.QuranActivity;\n-import com.quran.labs.androidquran.ui.helpers.QuranListAdapter;\n-import com.quran.labs.androidquran.ui.helpers.QuranRow;\n-import com.quran.labs.androidquran.util.QuranSettings;\n-import com.quran.labs.androidquran.util.QuranUtils;\n-\n-import javax.inject.Inject;\n-\n-import io.reactivex.android.schedulers.AndroidSchedulers;\n-import io.reactivex.disposables.Disposable;\n-import io.reactivex.observers.DisposableSingleObserver;\n-\n-import org.jetbrains.annotations.NotNull;\n-\n-import static com.quran.labs.androidquran.data.Constants.JUZ2_COUNT;\n-import static com.quran.labs.androidquran.data.Constants.SURAS_COUNT;\n-\n-/**\n- * Fragment that displays a list of all Surahs (using {@link QuranListAdapter}, with headings\n- * indicating which Juz a Sura starts in.\n- * When a Sura is selected (or a Juz heading), {@link QuranActivity#jumpTo(int)} is called to jump\n- * to that page.\n- */\n-public class SuraListFragment extends Fragment {\n-\n-  private RecyclerView mRecyclerView;\n-  private Disposable disposable;\n-\n-  @Inject QuranInfo quranInfo;\n-  @Inject QuranDisplayData quranDisplayData;\n-  @Inject QuranSettings quranSettings;\n-  boolean showSuraTranslatedName = false;\n-  private int numberOfPages;\n-\n-  public static SuraListFragment newInstance() {\n-    return new SuraListFragment();\n-  }\n-\n-  @Override\n-  public View onCreateView(@NonNull LayoutInflater inflater,\n-                           ViewGroup container, Bundle savedInstanceState) {\n-    final View view = inflater.inflate(R.layout.quran_list, container, false);\n-\n-    final Context context = getActivity();\n-    mRecyclerView = view.findViewById(R.id.recycler_view);\n-    mRecyclerView.setHasFixedSize(true);\n-    mRecyclerView.setLayoutManager(new LinearLayoutManager(context));\n-    mRecyclerView.setItemAnimator(new DefaultItemAnimator());\n-\n-    final QuranListAdapter adapter =\n-        new QuranListAdapter(context, mRecyclerView, getSuraList(), false);\n-    mRecyclerView.setAdapter(adapter);\n-    return view;\n-  }\n-\n-  @Override\n-  public void onAttach(@NotNull Context context) {\n-    super.onAttach(context);\n-    ((QuranApplication) context.getApplicationContext()).getApplicationComponent().inject(this);\n-    numberOfPages = quranInfo.getNumberOfPages();\n-  }\n-\n-  @Override\n-  public void onPause() {\n-    if (disposable != null) {\n-      disposable.dispose();\n-    }\n-    super.onPause();\n-  }\n-\n-  @Override\n-  public void onResume() {\n-    final Activity activity = getActivity();\n-    if (activity instanceof QuranActivity) {\n-      boolean newValueOfShowSuraTranslatedName = quranSettings.isShowSuraTranslatedName();\n-      if (this.showSuraTranslatedName != newValueOfShowSuraTranslatedName) {\n-        showHideSuraTranslatedName();\n-        this.showSuraTranslatedName = newValueOfShowSuraTranslatedName;\n-      }\n-      disposable = ((QuranActivity) activity).getLatestPageObservable()\n-          .first(Constants.NO_PAGE)\n-          .observeOn(AndroidSchedulers.mainThread())\n-          .subscribeWith(new DisposableSingleObserver<Integer>() {\n-            @Override\n-            public void onSuccess(Integer recentPage) {\n-              if (recentPage != Constants.NO_PAGE) {\n-                int sura = quranDisplayData.safelyGetSuraOnPage(recentPage);\n-                int juz = quranInfo.getJuzFromPage(recentPage);\n-                int position = sura + juz - 1;\n-                mRecyclerView.scrollToPosition(position);\n-              }\n-            }\n-\n-            @Override\n-            public void onError(Throwable e) {\n-            }\n-          });\n-\n-      if (quranSettings.isArabicNames()) {\n-        updateScrollBarPositionHoneycomb();\n-      }\n-    }\n-\n-    super.onResume();\n-  }\n-\n-  private void updateScrollBarPositionHoneycomb() {\n-    mRecyclerView.setVerticalScrollbarPosition(View.SCROLLBAR_POSITION_LEFT);\n-  }\n-\n-  private QuranRow[] getSuraList() {\n-    int next;\n-    int pos = 0;\n-    int sura = 1;\n-    QuranRow[] elements = new QuranRow[SURAS_COUNT + JUZ2_COUNT];\n-\n-    Activity activity = getActivity();\n-    boolean wantPrefix = activity.getResources().getBoolean(R.bool.show_surat_prefix);\n-    boolean wantTranslation = quranSettings.isShowSuraTranslatedName();\n-    for (int juz = 1; juz <= JUZ2_COUNT; juz++) {\n-      final String headerTitle = activity.getString(R.string.juz2_description,\n-          QuranUtils.getLocalizedNumber(activity, juz));\n-      final QuranRow.Builder headerBuilder = new QuranRow.Builder()\n-          .withType(QuranRow.HEADER)\n-          .withText(headerTitle)\n-          .withPage(quranInfo.getStartingPageForJuz(juz));\n-      elements[pos++] = headerBuilder.build();\n-      next = (juz == JUZ2_COUNT) ? numberOfPages + 1 :\n-          quranInfo.getStartingPageForJuz(juz + 1);\n-\n-      while ((sura <= SURAS_COUNT) && (quranInfo.getPageNumberForSura(sura) < next)) {\n-        final QuranRow.Builder builder = new QuranRow.Builder()\n-            .withText(quranDisplayData.getSuraName(activity, sura, wantPrefix, wantTranslation))\n-            .withMetadata(quranDisplayData.getSuraListMetaString(activity, sura))\n-            .withSura(sura)\n-            .withPage(quranInfo.getPageNumberForSura(sura));\n-        elements[pos++] = builder.build();\n-        sura++;\n-      }\n-    }\n-\n-    return elements;\n-  }\n-\n-  public void showHideSuraTranslatedName() {\n-    QuranRow[] elements = getSuraList();\n-    ((QuranListAdapter) mRecyclerView.getAdapter()).setElements(elements);\n-    mRecyclerView.getAdapter().notifyDataSetChanged();\n-  }\n-}\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "message": "Merge commit", "committedDate": null}, {"oid": "9e255a11855a37c29b0cc5681f6dd7161e0b7cd7", "committedDate": "2021-06-29 22:58:45 +0400", "message": "Set minSdk to 21 and update lots of dependencies (#1617)"}, {"oid": "1fd6cebc520b7fe13962d7b8d32cf248a883a0a9", "committedDate": "2021-07-19 15:59:51 +0400", "message": "Optimize unused imports (#1632)"}, {"oid": "e7494d88e14b85f56179410dba9c222d28acea53", "committedDate": "2021-08-19 20:22:52 +0400", "message": "upgrade Rx to version 3 (#1684)"}, {"oid": "ef58c2ffcc682c4807d9c0984f9700eabbfefb46", "committedDate": "2022-02-06 20:56:03 +0700", "message": "migrate `SuraListFragment` to Kotlin"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341770", "body": "suggestion - instead of doing it this way, i would remove this code and let changing the variable cause `SuraListFragment` instead to recompute with the updated flag and `notifyDataSetChanged`. ", "bodyText": "suggestion - instead of doing it this way, i would remove this code and let changing the variable cause SuraListFragment instead to recompute with the updated flag and notifyDataSetChanged.", "bodyHTML": "<p dir=\"auto\">suggestion - instead of doing it this way, i would remove this code and let changing the variable cause <code>SuraListFragment</code> instead to recompute with the updated flag and <code>notifyDataSetChanged</code>.</p>", "author": "ahmedre", "createdAt": "2020-05-20T22:23:31Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java", "diffHunk": "@@ -248,6 +249,35 @@ public boolean onLongClick(View v) {\n     return false;\n   }\n \n+  public void showHideSuraTranslatedName(boolean showSuraTranslatedName) {\n+    if (showSuraTranslatedName && elements[1].text.indexOf(\"(\") != -1) return;\n+    if (!showSuraTranslatedName && elements[1].text.indexOf(\"(\") == -1) return;\n+    for (QuranRow row : elements) {\n+      if (row.sura != 0) {\n+        if (showSuraTranslatedName) {\n+          addTranslatedNameToSuraName(row);\n+        } else {\n+          removeSuraTranslatedName(row);\n+        }\n+      }\n+    }\n+    notifyDataSetChanged();\n+  }\n+\n+  private void removeSuraTranslatedName(QuranRow row) {\n+    if (row.text.indexOf(\"(\") != -1)\n+      row.text = row.text.substring(0, row.text.indexOf(\"(\") - 1);\n+  }\n+\n+  private void addTranslatedNameToSuraName(QuranRow row) {\n+    StringBuilder builder = new StringBuilder(row.text);\n+    String translation = context.getResources().getStringArray(R.array.sura_names_translation)[row.sura - 1];\n+    if (!TextUtils.isEmpty(translation)) {\n+      builder.append(\" (\" + translation + \")\");\n+    }\n+    row.text = builder.toString();\n+  }\n+", "originalCommit": "35296173820de955683fe046284ca4c0cfb4b83c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0Mjc0MQ==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428342741", "bodyText": "so you could replace that code with a check in onResume - if the value of the checkbox changed, then re-compute and notifyDataSetChanged, otherwise do nothing.", "author": "ahmedre", "createdAt": "2020-05-20T22:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0OTI5OA==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428349298", "bodyText": "okay, I will move this code [three methods] to the SuraListFragment, but I track if the value changed or not using the below-stopping conditions before re-compute.\nif (showSuraTranslatedName && elements[1].text.indexOf(\"(\") != -1) return;\nif (!showSuraTranslatedName && elements[1].text.indexOf(\"(\") == -1) return;\n\ndo you know how to track the value after being changed ?", "author": "AhmedGarhy", "createdAt": "2020-05-20T22:44:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2NDgwNA==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428364804", "bodyText": "no need to move this code - remove it altogether. in onCreate of the SuraListFragment, read the value of wantTranslations into a variable. in onResume, check if the actual value differs, and if so, just re-call getSuraList() - pass the updated value to the adapter (you might have to expose a setter).", "author": "ahmedre", "createdAt": "2020-05-20T23:31:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA=="}], "type": "inlineReview", "revised_code": {"commit": "eb52558fd25306fc1afc1967f37fff814619ddd9", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\nindex ea298fb8..f01014ed 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n", "chunk": "@@ -249,33 +249,8 @@ public class QuranListAdapter extends\n     return false;\n   }\n \n-  public void showHideSuraTranslatedName(boolean showSuraTranslatedName) {\n-    if (showSuraTranslatedName && elements[1].text.indexOf(\"(\") != -1) return;\n-    if (!showSuraTranslatedName && elements[1].text.indexOf(\"(\") == -1) return;\n-    for (QuranRow row : elements) {\n-      if (row.sura != 0) {\n-        if (showSuraTranslatedName) {\n-          addTranslatedNameToSuraName(row);\n-        } else {\n-          removeSuraTranslatedName(row);\n-        }\n-      }\n-    }\n-    notifyDataSetChanged();\n-  }\n-\n-  private void removeSuraTranslatedName(QuranRow row) {\n-    if (row.text.indexOf(\"(\") != -1)\n-      row.text = row.text.substring(0, row.text.indexOf(\"(\") - 1);\n-  }\n-\n-  private void addTranslatedNameToSuraName(QuranRow row) {\n-    StringBuilder builder = new StringBuilder(row.text);\n-    String translation = context.getResources().getStringArray(R.array.sura_names_translation)[row.sura - 1];\n-    if (!TextUtils.isEmpty(translation)) {\n-      builder.append(\" (\" + translation + \")\");\n-    }\n-    row.text = builder.toString();\n+  public QuranRow[] getElements() {\n+    return elements;\n   }\n \n   class HeaderHolder extends RecyclerView.ViewHolder {\n", "next_change": {"commit": "edd451a1188f9f84994a17e267d237fc00152c8b", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\nindex f01014ed..e1f5f62c 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n", "chunk": "@@ -248,9 +248,8 @@ public class QuranListAdapter extends\n     }\n     return false;\n   }\n-\n-  public QuranRow[] getElements() {\n-    return elements;\n+  public void setElements(QuranRow[] elements) {\n+    this.elements = elements;\n   }\n \n   class HeaderHolder extends RecyclerView.ViewHolder {\n", "next_change": null}]}}]}, "revised_code_in_main": {"commit": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\nindex ea298fb8..e1f5f62c 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n", "chunk": "@@ -248,34 +248,8 @@ public class QuranListAdapter extends\n     }\n     return false;\n   }\n-\n-  public void showHideSuraTranslatedName(boolean showSuraTranslatedName) {\n-    if (showSuraTranslatedName && elements[1].text.indexOf(\"(\") != -1) return;\n-    if (!showSuraTranslatedName && elements[1].text.indexOf(\"(\") == -1) return;\n-    for (QuranRow row : elements) {\n-      if (row.sura != 0) {\n-        if (showSuraTranslatedName) {\n-          addTranslatedNameToSuraName(row);\n-        } else {\n-          removeSuraTranslatedName(row);\n-        }\n-      }\n-    }\n-    notifyDataSetChanged();\n-  }\n-\n-  private void removeSuraTranslatedName(QuranRow row) {\n-    if (row.text.indexOf(\"(\") != -1)\n-      row.text = row.text.substring(0, row.text.indexOf(\"(\") - 1);\n-  }\n-\n-  private void addTranslatedNameToSuraName(QuranRow row) {\n-    StringBuilder builder = new StringBuilder(row.text);\n-    String translation = context.getResources().getStringArray(R.array.sura_names_translation)[row.sura - 1];\n-    if (!TextUtils.isEmpty(translation)) {\n-      builder.append(\" (\" + translation + \")\");\n-    }\n-    row.text = builder.toString();\n+  public void setElements(QuranRow[] elements) {\n+    this.elements = elements;\n   }\n \n   class HeaderHolder extends RecyclerView.ViewHolder {\n", "next_change": {"commit": "b6d18f09ac4931a91d3d4573f47b1ffc988b1f27", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\nindex e1f5f62c..7f25c726 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n", "chunk": "@@ -248,8 +247,10 @@ public class QuranListAdapter extends\n     }\n     return false;\n   }\n+\n   public void setElements(QuranRow[] elements) {\n     this.elements = elements;\n+    notifyDataSetChanged();\n   }\n \n   class HeaderHolder extends RecyclerView.ViewHolder {\n", "next_change": {"commit": "2f206a6a9677cbbc1cc9fde1d770a7596256a364", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java b/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\ndeleted file mode 100644\nindex 7f25c726..00000000\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java\n+++ /dev/null\n", "chunk": "@@ -1,304 +0,0 @@\n-package com.quran.labs.androidquran.ui.helpers;\n-\n-import android.content.Context;\n-import android.graphics.PorterDuff;\n-import androidx.recyclerview.widget.RecyclerView;\n-\n-import android.util.SparseBooleanArray;\n-import android.view.LayoutInflater;\n-import android.view.View;\n-import android.view.ViewGroup;\n-import android.widget.ImageView;\n-import android.widget.TextView;\n-\n-import com.quran.labs.androidquran.R;\n-import com.quran.data.model.bookmark.Bookmark;\n-import com.quran.data.model.bookmark.Tag;\n-import com.quran.labs.androidquran.ui.QuranActivity;\n-import com.quran.labs.androidquran.util.LocaleUtil;\n-import com.quran.labs.androidquran.util.QuranUtils;\n-import com.quran.labs.androidquran.view.JuzView;\n-import com.quran.labs.androidquran.view.TagsViewGroup;\n-\n-import java.text.SimpleDateFormat;\n-import java.util.ArrayList;\n-import java.util.Date;\n-import java.util.List;\n-import java.util.Locale;\n-import java.util.Map;\n-import org.jetbrains.annotations.NotNull;\n-\n-public class QuranListAdapter extends\n-    RecyclerView.Adapter<QuranListAdapter.HeaderHolder>\n-    implements View.OnClickListener, View.OnLongClickListener {\n-\n-  private Context context;\n-  private LayoutInflater inflater;\n-  private QuranRow[] elements;\n-  private RecyclerView recyclerView;\n-  private SparseBooleanArray checkedState;\n-  private QuranTouchListener touchListener;\n-  private Map<Long, Tag> tagMap;\n-  private boolean showTags;\n-  private boolean showDate;\n-  private boolean isEditable;\n-  private Locale locale;\n-\n-  public QuranListAdapter(Context context, RecyclerView recyclerView,\n-                          QuranRow[] items, boolean isEditable) {\n-    inflater = LayoutInflater.from(context);\n-    this.recyclerView = recyclerView;\n-    elements = items;\n-    this.context = context;\n-    checkedState = new SparseBooleanArray();\n-    this.isEditable = isEditable;\n-    this.locale = LocaleUtil.INSTANCE.getLocale(context);\n-  }\n-\n-  @Override\n-  public long getItemId(int position) {\n-    return position;\n-  }\n-\n-  @Override\n-  public int getItemCount() {\n-    return elements.length;\n-  }\n-\n-  private QuranRow getQuranRow(int position) {\n-    return elements[position];\n-  }\n-\n-  public boolean isItemChecked(int position) {\n-    return checkedState.get(position);\n-  }\n-\n-  public void setItemChecked(int position, boolean checked) {\n-    checkedState.put(position, checked);\n-    notifyItemChanged(position);\n-  }\n-\n-  public List<QuranRow> getCheckedItems() {\n-    final List<QuranRow> result = new ArrayList<>();\n-    final int count = checkedState.size();\n-    final int elements = getItemCount();\n-    for (int i = 0; i < count; i++) {\n-      final int key = checkedState.keyAt(i);\n-      // TODO: figure out why sometimes elements > key\n-      if (checkedState.get(key) && elements > key) {\n-        result.add(getQuranRow(key));\n-      }\n-    }\n-    return result;\n-  }\n-\n-  public void uncheckAll() {\n-    checkedState.clear();\n-    notifyDataSetChanged();\n-  }\n-\n-  public void setElements(QuranRow[] elements, Map<Long, Tag> tagMap) {\n-    this.elements = elements;\n-    this.tagMap = tagMap;\n-  }\n-\n-  public void setShowTags(boolean showTags) {\n-    this.showTags = showTags;\n-  }\n-\n-  public void setShowDate(boolean showDate) {\n-    this.showDate = showDate;\n-  }\n-\n-  private void bindRow(HeaderHolder vh, int position) {\n-    ViewHolder holder = (ViewHolder) vh;\n-\n-    final QuranRow item = elements[position];\n-    bindHeader(vh, position);\n-    holder.number.setText(\n-        QuranUtils.getLocalizedNumber(context, item.sura));\n-\n-    holder.metadata.setVisibility(View.VISIBLE);\n-    holder.metadata.setText(item.metadata);\n-    holder.tags.setVisibility(View.GONE);\n-\n-    if (item.juzType != null) {\n-      holder.image.setImageDrawable(\n-          new JuzView(context, item.juzType, item.juzOverlayText));\n-      holder.image.setVisibility(View.VISIBLE);\n-      holder.number.setVisibility(View.GONE);\n-    } else if (item.imageResource == null) {\n-      holder.number.setVisibility(View.VISIBLE);\n-      holder.image.setVisibility(View.GONE);\n-    } else {\n-      holder.image.setImageResource(item.imageResource);\n-      if (item.imageFilterColor == null) {\n-        holder.image.setColorFilter(null);\n-      } else {\n-        holder.image.setColorFilter(\n-            item.imageFilterColor, PorterDuff.Mode.SRC_ATOP);\n-      }\n-\n-      if (showDate) {\n-        final String date = new SimpleDateFormat(\"MMM dd, HH:mm\", locale)\n-            .format(new Date(item.dateAddedInMillis));\n-        holder.metadata.setText(item.metadata + \" - \" + date);\n-      }\n-\n-      holder.image.setVisibility(View.VISIBLE);\n-      holder.number.setVisibility(View.GONE);\n-\n-      List<Tag> tags = new ArrayList<>();\n-      Bookmark bookmark = item.bookmark;\n-      if (bookmark != null && !bookmark.getTags().isEmpty() && showTags) {\n-        for (int i = 0, bookmarkTags = bookmark.getTags().size(); i < bookmarkTags; i++) {\n-          Long tagId = bookmark.getTags().get(i);\n-          Tag tag = tagMap.get(tagId);\n-          if (tag != null) {\n-            tags.add(tag);\n-          }\n-        }\n-      }\n-\n-      if (tags.isEmpty()) {\n-        holder.tags.setVisibility(View.GONE);\n-      } else {\n-        holder.tags.setTags(tags);\n-        holder.tags.setVisibility(View.VISIBLE);\n-      }\n-    }\n-  }\n-\n-  private void bindHeader(HeaderHolder holder, int pos) {\n-    final QuranRow item = elements[pos];\n-    holder.title.setText(item.text);\n-    if (item.page == 0) {\n-      holder.pageNumber.setVisibility(View.GONE);\n-    } else {\n-      holder.pageNumber.setVisibility(View.VISIBLE);\n-      holder.pageNumber.setText(\n-          QuranUtils.getLocalizedNumber(context, item.page));\n-    }\n-    holder.setChecked(isItemChecked(pos));\n-\n-    final boolean enabled = isEnabled(pos);\n-    holder.setEnabled(enabled);\n-  }\n-\n-  @NotNull\n-  @Override\n-  public HeaderHolder onCreateViewHolder(@NotNull ViewGroup parent, int viewType) {\n-    if (viewType == 0) {\n-      final View view = inflater.inflate(R.layout.index_header_row, parent, false);\n-      return new HeaderHolder(view);\n-    } else {\n-      final View view = inflater.inflate(R.layout.index_sura_row, parent, false);\n-      return new ViewHolder(view);\n-    }\n-  }\n-\n-  @Override\n-  public void onBindViewHolder(@NotNull HeaderHolder viewHolder, int position) {\n-    final int type = getItemViewType(position);\n-    if (type == 0) {\n-      bindHeader(viewHolder, position);\n-    } else {\n-      bindRow(viewHolder, position);\n-    }\n-  }\n-\n-  @Override\n-  public int getItemViewType(int position) {\n-    return elements[position].isHeader() ? 0 : 1;\n-  }\n-\n-  private boolean isEnabled(int position) {\n-    final QuranRow selected = elements[position];\n-    return !isEditable ||                     // anything in surahs or juzs\n-        selected.isBookmark() ||              // actual bookmarks\n-        selected.rowType == QuranRow.NONE ||  // the actual \"current page\"\n-        selected.isBookmarkHeader();          // tags\n-  }\n-\n-  public void setQuranTouchListener(QuranTouchListener listener) {\n-    touchListener = listener;\n-  }\n-\n-  @Override\n-  public void onClick(View v) {\n-    final int position = recyclerView.getChildAdapterPosition(v);\n-    if (position != RecyclerView.NO_POSITION) {\n-      final QuranRow element = elements[position];\n-      if (touchListener == null) {\n-        ((QuranActivity) context).jumpTo(element.page);\n-      } else {\n-        touchListener.onClick(element, position);\n-      }\n-    }\n-  }\n-\n-  @Override\n-  public boolean onLongClick(View v) {\n-    if (touchListener != null) {\n-      final int position = recyclerView.getChildAdapterPosition(v);\n-      if (position != RecyclerView.NO_POSITION) {\n-        return touchListener.onLongClick(elements[position], position);\n-      }\n-    }\n-    return false;\n-  }\n-\n-  public void setElements(QuranRow[] elements) {\n-    this.elements = elements;\n-    notifyDataSetChanged();\n-  }\n-\n-  class HeaderHolder extends RecyclerView.ViewHolder {\n-\n-    TextView title;\n-    TextView pageNumber;\n-    View view;\n-\n-    HeaderHolder(View itemView) {\n-      super(itemView);\n-      view = itemView;\n-      title = itemView.findViewById(R.id.title);\n-      pageNumber = itemView.findViewById(R.id.pageNumber);\n-    }\n-\n-    void setEnabled(boolean enabled) {\n-      view.setEnabled(enabled);\n-      itemView.setOnClickListener(enabled ? QuranListAdapter.this : null);\n-      itemView.setOnLongClickListener(isEditable && enabled ? QuranListAdapter.this : null);\n-    }\n-\n-    void setChecked(boolean checked) {\n-      view.setActivated(checked);\n-    }\n-  }\n-\n-  private class ViewHolder extends HeaderHolder {\n-\n-    TextView number;\n-    TextView metadata;\n-    ImageView image;\n-    TagsViewGroup tags;\n-    TextView date;\n-\n-    ViewHolder(View itemView) {\n-      super(itemView);\n-      metadata = itemView.findViewById(R.id.metadata);\n-      number = itemView.findViewById(R.id.suraNumber);\n-      image = itemView.findViewById(R.id.rowIcon);\n-      tags = itemView.findViewById(R.id.tags);\n-      date = itemView.findViewById(R.id.show_date);\n-    }\n-  }\n-\n-  public interface QuranTouchListener {\n-\n-    void onClick(QuranRow row, int position);\n-\n-    boolean onLongClick(QuranRow row, int position);\n-  }\n-}\n", "next_change": null}]}}]}}]}, "commits_in_main": [{"oid": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "message": "Merge commit", "committedDate": null}, {"oid": "5da21d43682b2eb552474c9985cea7733546f3a5", "committedDate": "2020-09-26 00:17:20 +0400", "message": "Rename widgets package to view (#1445)"}, {"oid": "c7b42aee0c92e076dfb3dc02b410a02c4be7c280", "committedDate": "2021-03-25 00:25:49 +0400", "message": "Move bookmark models to common/data (#1573)"}, {"oid": "b6d18f09ac4931a91d3d4573f47b1ffc988b1f27", "committedDate": "2021-04-13 01:19:47 +0400", "message": "Support fetching quarters from the database (#1586)"}, {"oid": "2f206a6a9677cbbc1cc9fde1d770a7596256a364", "committedDate": "2022-01-30 10:25:24 +0700", "message": "rewrite `QuranListAdapter` in Kotlin"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTg5Mw==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341893", "body": "can you default to the value in `R.bool.show_sura_names_translation`", "bodyText": "can you default to the value in R.bool.show_sura_names_translation", "bodyHTML": "<p dir=\"auto\">can you default to the value in <code>R.bool.show_sura_names_translation</code></p>", "author": "ahmedre", "createdAt": "2020-05-20T22:23:53Z", "path": "app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java", "diffHunk": "@@ -167,6 +167,9 @@ public void setShowDate(boolean isDateShown) {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_DATE, isDateShown).apply();\n   }\n \n+  public boolean isShowSuraTranslatedName() {\n+    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, false);", "originalCommit": "35296173820de955683fe046284ca4c0cfb4b83c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eb52558fd25306fc1afc1967f37fff814619ddd9", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\nindex 884a4f2b..b089aeec 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n", "chunk": "@@ -168,7 +168,7 @@ public class QuranSettings {\n   }\n \n   public boolean isShowSuraTranslatedName() {\n-    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, false);\n+    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, appContext.getResources().getBoolean(R.bool.show_sura_names_translation));\n   }\n   // probably should eventually move this to Application.onCreate..\n   public void upgradePreferences() {\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\nindex 884a4f2b..b089aeec 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n", "chunk": "@@ -168,7 +168,7 @@ public class QuranSettings {\n   }\n \n   public boolean isShowSuraTranslatedName() {\n-    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, false);\n+    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, appContext.getResources().getBoolean(R.bool.show_sura_names_translation));\n   }\n   // probably should eventually move this to Application.onCreate..\n   public void upgradePreferences() {\n", "next_change": {"commit": "3b515716d8d4ac48edb53a1b504ec7cd48fed1c7", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\nindex b089aeec..f8bc5ff1 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n", "chunk": "@@ -161,15 +161,27 @@ public class QuranSettings {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_RECENTS, minimizeRecents).apply();\n   }\n \n-  public boolean getShowDate() { return prefs.getBoolean(Constants.PREF_SHOW_DATE, false);  }\n+  public boolean getShowDate() {\n+    return prefs.getBoolean(Constants.PREF_SHOW_DATE, false);\n+  }\n \n   public void setShowDate(boolean isDateShown) {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_DATE, isDateShown).apply();\n   }\n \n+  public boolean isQuranSplitWithTranslation() {\n+    return prefs.getBoolean(Constants.PREF_SPLIT_PAGE_AND_TRANSLATION, false);\n+  }\n+\n+  public boolean isQuranOnRight() {\n+    return prefs.getBoolean(Constants.PREF_QURAN_ON_RIGHT, true);\n+  }\n+\n   public boolean isShowSuraTranslatedName() {\n-    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, appContext.getResources().getBoolean(R.bool.show_sura_names_translation));\n+    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME,\n+        appContext.getResources().getBoolean(R.bool.show_sura_names_translation));\n   }\n+\n   // probably should eventually move this to Application.onCreate..\n   public void upgradePreferences() {\n     int version = getVersion();\n", "next_change": {"commit": "3e3de46414411b99c355a35777ca8e11676cb3a9", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\nindex f8bc5ff1..2174378f 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n", "chunk": "@@ -161,27 +156,15 @@ public class QuranSettings {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_RECENTS, minimizeRecents).apply();\n   }\n \n-  public boolean getShowDate() {\n-    return prefs.getBoolean(Constants.PREF_SHOW_DATE, false);\n-  }\n+  public boolean getShowDate() { return prefs.getBoolean(Constants.PREF_SHOW_DATE, false);  }\n \n   public void setShowDate(boolean isDateShown) {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_DATE, isDateShown).apply();\n   }\n \n-  public boolean isQuranSplitWithTranslation() {\n-    return prefs.getBoolean(Constants.PREF_SPLIT_PAGE_AND_TRANSLATION, false);\n-  }\n-\n-  public boolean isQuranOnRight() {\n-    return prefs.getBoolean(Constants.PREF_QURAN_ON_RIGHT, true);\n-  }\n-\n   public boolean isShowSuraTranslatedName() {\n-    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME,\n-        appContext.getResources().getBoolean(R.bool.show_sura_names_translation));\n+    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, appContext.getResources().getBoolean(R.bool.show_sura_names_translation));\n   }\n-\n   // probably should eventually move this to Application.onCreate..\n   public void upgradePreferences() {\n     int version = getVersion();\n", "next_change": {"commit": "890f1b70dc4b0d28f683605c6e491bf0810a9148", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\nindex 2174378f..3ba75387 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n", "chunk": "@@ -156,15 +156,27 @@ public class QuranSettings {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_RECENTS, minimizeRecents).apply();\n   }\n \n-  public boolean getShowDate() { return prefs.getBoolean(Constants.PREF_SHOW_DATE, false);  }\n+  public boolean getShowDate() {\n+    return prefs.getBoolean(Constants.PREF_SHOW_DATE, false);\n+  }\n \n   public void setShowDate(boolean isDateShown) {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_DATE, isDateShown).apply();\n   }\n \n+  public boolean isQuranSplitWithTranslation() {\n+    return prefs.getBoolean(Constants.PREF_SPLIT_PAGE_AND_TRANSLATION, false);\n+  }\n+\n+  public boolean isQuranOnRight() {\n+    return prefs.getBoolean(Constants.PREF_QURAN_ON_RIGHT, true);\n+  }\n+\n   public boolean isShowSuraTranslatedName() {\n-    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, appContext.getResources().getBoolean(R.bool.show_sura_names_translation));\n+    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME,\n+        appContext.getResources().getBoolean(R.bool.show_sura_names_translation));\n   }\n+\n   // probably should eventually move this to Application.onCreate..\n   public void upgradePreferences() {\n     int version = getVersion();\n", "next_change": {"commit": "4f096168f8db615fa61d35c80a98d46bed58c42f", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\nindex 3ba75387..3938e29e 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n", "chunk": "@@ -185,63 +185,6 @@ public class QuranSettings {\n         version = prefs.getInt(Constants.PREF_VERSION, 0);\n       }\n \n-      if (version != 0) {\n-        if (version < 2672) {\n-          // migrate preferences\n-          setAppCustomLocation(prefs.getString(Constants.PREF_APP_LOCATION, null));\n-\n-          if (prefs.contains(Constants.PREF_SHOULD_FETCH_PAGES)) {\n-            setShouldFetchPages(prefs.getBoolean(Constants.PREF_SHOULD_FETCH_PAGES, false));\n-          }\n-\n-          if (prefs.contains(QuranDownloadService.PREF_LAST_DOWNLOAD_ERROR)) {\n-            setLastDownloadError(\n-                prefs.getString(QuranDownloadService.PREF_LAST_DOWNLOAD_ITEM, null),\n-                prefs.getInt(QuranDownloadService.PREF_LAST_DOWNLOAD_ERROR, 0));\n-          }\n-\n-          prefs.edit()\n-              .remove(Constants.PREF_VERSION)\n-              .remove(Constants.PREF_APP_LOCATION)\n-              .remove(Constants.PREF_SHOULD_FETCH_PAGES)\n-              .remove(QuranDownloadService.PREF_LAST_DOWNLOAD_ERROR)\n-              .remove(QuranDownloadService.PREF_LAST_DOWNLOAD_ITEM)\n-              .remove(Constants.PREF_ACTIVE_TRANSLATION)\n-              // these aren't migrated since they can be derived pretty easily\n-              .remove(\"didPresentPermissionsRationale\") // was renamed, removing old one\n-              .remove(Constants.PREF_DEFAULT_IMAGES_DIR)\n-              .remove(Constants.PREF_HAVE_UPDATED_TRANSLATIONS)\n-              .remove(Constants.PREF_LAST_UPDATED_TRANSLATIONS)\n-              .apply();\n-        } else if (version < 2674) {\n-          // explicitly an else - if we migrated via the above, we're okay. otherwise, we are in\n-          // a bad state due to not crashing in 2.6.7-p2 (thus getting its incorrect behavior),\n-          // and thus crashing on 2.6.7-p3 and above (where the bug was fixed). this works around\n-          // this issue.\n-          try {\n-            getLastDownloadItemWithError();\n-            getLastDownloadErrorCode();\n-          } catch (Exception e) {\n-            clearLastDownloadError();\n-          }\n-        } else if (version == 2800) {\n-          // upgrading from 2800, need to remove notification channels\n-          if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n-            deleteOldNotificationChannels();\n-          }\n-        }\n-\n-        if (version < 2943) {\n-          prefs.edit().remove(\"didDownloadPages\").apply();\n-        }\n-\n-        if (version < 2961) {\n-          // on 2.9.6 and below, remove the partial checked flag so we can\n-          // check them again.\n-          perInstallationPrefs.edit().remove(Constants.PREF_CHECKED_PARTIAL_IMAGES).apply();\n-        }\n-      }\n-\n       // no matter which version we're upgrading from, make sure the app location is set\n       if (!isAppLocationSet()) {\n         setAppCustomLocation(getAppCustomLocation());\n", "next_change": {"commit": "6c4d2ae35f6833eab24edbe1d7147adb464c188c", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\nindex 3938e29e..65846619 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java\n", "chunk": "@@ -190,8 +191,14 @@ public class QuranSettings {\n         setAppCustomLocation(getAppCustomLocation());\n       }\n \n-      // make sure that the version code now says that we're up to date.\n-      setVersion(BuildConfig.VERSION_CODE);\n+      // allow specific flavors of the app to handle their own upgrade logic.\n+      // this is important because different flavors have different version codes, so\n+      // common code here would likely be wrong for other flavors (unless it depends on\n+      // relative offsets to the version code instead of the actual version code).\n+      if (preferencesUpgrade.upgrade(appContext, version, BuildConfig.VERSION_CODE)) {\n+        // make sure that the version code now says that we're up to date.\n+        setVersion(BuildConfig.VERSION_CODE);\n+      }\n     }\n   }\n \n", "next_change": null}]}}]}}]}}]}}]}}]}, "commits_in_main": [{"oid": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "message": "Merge commit", "committedDate": null}, {"oid": "3b515716d8d4ac48edb53a1b504ec7cd48fed1c7", "committedDate": "2020-07-05 14:37:27 +0200", "message": "add preferences to enable/disable quran-translation split screen view"}, {"oid": "3e3de46414411b99c355a35777ca8e11676cb3a9", "committedDate": "2020-08-16 00:02:39 +0400", "message": "Improve full screen mode (#1418)"}, {"oid": "890f1b70dc4b0d28f683605c6e491bf0810a9148", "committedDate": "2020-08-29 15:50:04 +0200", "message": "Merge remote-tracking branch 'upstream/master' into 759-support-split-screen-page-and-translation-on-tablet"}, {"oid": "d6eba674e4132532b71b56be53ad63874798fbc8", "committedDate": "2020-10-08 02:10:23 +0400", "message": "Target api 29 and migrate for scoped storage (#1452)"}, {"oid": "973985a17914ce608f16164358d2e79c5ac48fc6", "committedDate": "2020-10-18 00:48:08 +0400", "message": "Put page in its place in split translation view (#1461)"}, {"oid": "e307beafdda122dd69ecf90a75d18e27ef9a36de", "committedDate": "2020-10-29 04:49:58 +0400", "message": "Track analytics for a few important events (#1472)"}, {"oid": "ba625426f448a269954a2c993b7b77912339cdbc", "committedDate": "2020-12-20 18:28:59 +0400", "message": "Make internal storage the default directory (#1511)"}, {"oid": "4f096168f8db615fa61d35c80a98d46bed58c42f", "committedDate": "2020-12-31 01:35:54 +0400", "message": "Remove old upgrades (#1520)"}, {"oid": "6c4d2ae35f6833eab24edbe1d7147adb464c188c", "committedDate": "2021-03-24 02:32:13 +0400", "message": "Add infra for per flavor preference upgrades (#1570)"}, {"oid": "31340d8bed41a457276e2e690c25900ce298858f", "committedDate": "2021-03-26 16:35:57 +0400", "message": "Allow updating bookmarks during prefs update (#1574)"}, {"oid": "8701b3e7a22ed0d06bd49ca1d22500b997286dc9", "committedDate": "2021-08-02 13:58:21 +0700", "message": "minor refactor"}, {"oid": "81469ad286d36c662c1003cf3cdfdff11daaf72c", "committedDate": "2021-10-29 21:41:44 +0400", "message": "Expose more methods in Settings"}, {"oid": "c84fddfc02430b16640d87e1879c105273660fe8", "committedDate": "2022-03-07 22:46:31 +0300", "message": "adjust background of night mode"}, {"oid": "dffc1c991c8dbbbb777f1847243762df58f0da2d", "committedDate": "2022-06-14 13:25:54 +0300", "message": "dyslexia friendly font for translation"}]}, {"oid": "eb52558fd25306fc1afc1967f37fff814619ddd9", "url": "https://github.com/quran/quran_android/commit/eb52558fd25306fc1afc1967f37fff814619ddd9", "message": "- use R.bool.show_sura_names_translation as default value instead of hardcoded.\n- move the showing translated name from the adapter to the fragment.", "committedDate": "2020-05-20T22:57:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r432690769", "body": "what i meant is replace these 2 lines with something like:\r\n\r\n```java\r\nfinal QuranRow[] updatedElements = getSuraList();\r\nadapter.setElements(updatedElements);\r\n```\r\n\r\nand in `onCreate`, make the adapter in a variable so you can call this setter on it. expose the setter on the adapter also. then you can just remove the show/add methods that you added below.", "bodyText": "what i meant is replace these 2 lines with something like:\nfinal QuranRow[] updatedElements = getSuraList();\nadapter.setElements(updatedElements);\nand in onCreate, make the adapter in a variable so you can call this setter on it. expose the setter on the adapter also. then you can just remove the show/add methods that you added below.", "bodyHTML": "<p dir=\"auto\">what i meant is replace these 2 lines with something like:</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"final QuranRow[] updatedElements = getSuraList();\nadapter.setElements(updatedElements);\"><pre><span class=\"pl-k\">final</span> <span class=\"pl-k\">QuranRow</span>[] updatedElements <span class=\"pl-k\">=</span> getSuraList();\nadapter<span class=\"pl-k\">.</span>setElements(updatedElements);</pre></div>\n<p dir=\"auto\">and in <code>onCreate</code>, make the adapter in a variable so you can call this setter on it. expose the setter on the adapter also. then you can just remove the show/add methods that you added below.</p>", "author": "ahmedre", "createdAt": "2020-05-29T19:29:05Z", "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java", "diffHunk": "@@ -88,7 +92,11 @@ public void onPause() {\n   public void onResume() {\n     final Activity activity = getActivity();\n     if (activity instanceof QuranActivity) {\n-      QuranSettings settings = QuranSettings.getInstance(activity);\n+      boolean newValueOfShowSuraTranslatedName = quranSettings.isShowSuraTranslatedName();\n+      if (this.showSuraTranslatedName != newValueOfShowSuraTranslatedName) {\n+        showHideSuraTranslatedName(newValueOfShowSuraTranslatedName);\n+        this.showSuraTranslatedName = newValueOfShowSuraTranslatedName;", "originalCommit": "eb52558fd25306fc1afc1967f37fff814619ddd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE5NTA3OA==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r433195078", "bodyText": "Hi @ahmedre\nI got what do you want to say, but I believe that we don't have to repeat the construction of the SuraList by Calling getSuraList() again, instead of that, we can just modify the text of each Sura in the list by appending or removing the translated part.\nI believe this implementation is more optimal than calling the getSuraList again and again.", "author": "AhmedGarhy", "createdAt": "2020-06-01T12:04:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI1MDk3NQ==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r433250975", "bodyText": "i agree that it's more optimal your way, but considering:\n\nwe can avoid adding extra code - so tradeoff for code readability\nthe extra price is only called when the person goes into the menu and chooses the option to show translation names - the number of people doing this is very small and will likely only do it once or twice at most.\nthe extra code means that in the future, if we change the way we're adding the translations (i.e. today, i guess we're manually making the string, which is not ideal and honestly we should fix this), then we'd have to modify this code - it also means other languages can't choose to something different - ex one language can use () one can use <>, one can do nothing at all.\n\nso for those reasons, was suggesting to do it this way despite being slightly less optimal.", "author": "ahmedre", "createdAt": "2020-06-01T14:00:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4Njc2Mg==", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r433286762", "bodyText": "got it, thanks for the clarification.", "author": "AhmedGarhy", "createdAt": "2020-06-01T15:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "edd451a1188f9f84994a17e267d237fc00152c8b", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\nindex ceb9d6cf..16c59add 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n", "chunk": "@@ -94,7 +94,7 @@ public class SuraListFragment extends Fragment {\n     if (activity instanceof QuranActivity) {\n       boolean newValueOfShowSuraTranslatedName = quranSettings.isShowSuraTranslatedName();\n       if (this.showSuraTranslatedName != newValueOfShowSuraTranslatedName) {\n-        showHideSuraTranslatedName(newValueOfShowSuraTranslatedName);\n+        showHideSuraTranslatedName();\n         this.showSuraTranslatedName = newValueOfShowSuraTranslatedName;\n       }\n       disposable = ((QuranActivity) activity).getLatestPageObservable()\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\nindex ceb9d6cf..16c59add 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n", "chunk": "@@ -94,7 +94,7 @@ public class SuraListFragment extends Fragment {\n     if (activity instanceof QuranActivity) {\n       boolean newValueOfShowSuraTranslatedName = quranSettings.isShowSuraTranslatedName();\n       if (this.showSuraTranslatedName != newValueOfShowSuraTranslatedName) {\n-        showHideSuraTranslatedName(newValueOfShowSuraTranslatedName);\n+        showHideSuraTranslatedName();\n         this.showSuraTranslatedName = newValueOfShowSuraTranslatedName;\n       }\n       disposable = ((QuranActivity) activity).getLatestPageObservable()\n", "next_change": {"commit": "ef58c2ffcc682c4807d9c0984f9700eabbfefb46", "changed_code": [{"header": "diff --git a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java b/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\ndeleted file mode 100644\nindex 16c59add..00000000\n--- a/app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java\n+++ /dev/null\n", "chunk": "@@ -1,170 +0,0 @@\n-package com.quran.labs.androidquran.ui.fragment;\n-\n-import android.app.Activity;\n-import android.content.Context;\n-import android.os.Bundle;\n-import androidx.annotation.NonNull;\n-import androidx.fragment.app.Fragment;\n-import androidx.recyclerview.widget.DefaultItemAnimator;\n-import androidx.recyclerview.widget.LinearLayoutManager;\n-import androidx.recyclerview.widget.RecyclerView;\n-import android.text.TextUtils;\n-import android.view.LayoutInflater;\n-import android.view.View;\n-import android.view.ViewGroup;\n-\n-import com.quran.data.core.QuranInfo;\n-import com.quran.labs.androidquran.QuranApplication;\n-import com.quran.labs.androidquran.R;\n-import com.quran.labs.androidquran.data.Constants;\n-import com.quran.labs.androidquran.data.QuranDisplayData;\n-import com.quran.labs.androidquran.ui.QuranActivity;\n-import com.quran.labs.androidquran.ui.helpers.QuranListAdapter;\n-import com.quran.labs.androidquran.ui.helpers.QuranRow;\n-import com.quran.labs.androidquran.util.QuranSettings;\n-import com.quran.labs.androidquran.util.QuranUtils;\n-\n-import javax.inject.Inject;\n-\n-import io.reactivex.android.schedulers.AndroidSchedulers;\n-import io.reactivex.disposables.Disposable;\n-import io.reactivex.observers.DisposableSingleObserver;\n-\n-import org.jetbrains.annotations.NotNull;\n-\n-import static com.quran.labs.androidquran.data.Constants.JUZ2_COUNT;\n-import static com.quran.labs.androidquran.data.Constants.SURAS_COUNT;\n-\n-/**\n- * Fragment that displays a list of all Surahs (using {@link QuranListAdapter}, with headings\n- * indicating which Juz a Sura starts in.\n- * When a Sura is selected (or a Juz heading), {@link QuranActivity#jumpTo(int)} is called to jump\n- * to that page.\n- */\n-public class SuraListFragment extends Fragment {\n-\n-  private RecyclerView mRecyclerView;\n-  private Disposable disposable;\n-\n-  @Inject QuranInfo quranInfo;\n-  @Inject QuranDisplayData quranDisplayData;\n-  @Inject QuranSettings quranSettings;\n-  boolean showSuraTranslatedName = false;\n-  private int numberOfPages;\n-\n-  public static SuraListFragment newInstance() {\n-    return new SuraListFragment();\n-  }\n-\n-  @Override\n-  public View onCreateView(@NonNull LayoutInflater inflater,\n-                           ViewGroup container, Bundle savedInstanceState) {\n-    final View view = inflater.inflate(R.layout.quran_list, container, false);\n-\n-    final Context context = getActivity();\n-    mRecyclerView = view.findViewById(R.id.recycler_view);\n-    mRecyclerView.setHasFixedSize(true);\n-    mRecyclerView.setLayoutManager(new LinearLayoutManager(context));\n-    mRecyclerView.setItemAnimator(new DefaultItemAnimator());\n-\n-    final QuranListAdapter adapter =\n-        new QuranListAdapter(context, mRecyclerView, getSuraList(), false);\n-    mRecyclerView.setAdapter(adapter);\n-    return view;\n-  }\n-\n-  @Override\n-  public void onAttach(@NotNull Context context) {\n-    super.onAttach(context);\n-    ((QuranApplication) context.getApplicationContext()).getApplicationComponent().inject(this);\n-    numberOfPages = quranInfo.getNumberOfPages();\n-  }\n-\n-  @Override\n-  public void onPause() {\n-    if (disposable != null) {\n-      disposable.dispose();\n-    }\n-    super.onPause();\n-  }\n-\n-  @Override\n-  public void onResume() {\n-    final Activity activity = getActivity();\n-    if (activity instanceof QuranActivity) {\n-      boolean newValueOfShowSuraTranslatedName = quranSettings.isShowSuraTranslatedName();\n-      if (this.showSuraTranslatedName != newValueOfShowSuraTranslatedName) {\n-        showHideSuraTranslatedName();\n-        this.showSuraTranslatedName = newValueOfShowSuraTranslatedName;\n-      }\n-      disposable = ((QuranActivity) activity).getLatestPageObservable()\n-          .first(Constants.NO_PAGE)\n-          .observeOn(AndroidSchedulers.mainThread())\n-          .subscribeWith(new DisposableSingleObserver<Integer>() {\n-            @Override\n-            public void onSuccess(Integer recentPage) {\n-              if (recentPage != Constants.NO_PAGE) {\n-                int sura = quranDisplayData.safelyGetSuraOnPage(recentPage);\n-                int juz = quranInfo.getJuzFromPage(recentPage);\n-                int position = sura + juz - 1;\n-                mRecyclerView.scrollToPosition(position);\n-              }\n-            }\n-\n-            @Override\n-            public void onError(Throwable e) {\n-            }\n-          });\n-\n-      if (quranSettings.isArabicNames()) {\n-        updateScrollBarPositionHoneycomb();\n-      }\n-    }\n-\n-    super.onResume();\n-  }\n-\n-  private void updateScrollBarPositionHoneycomb() {\n-    mRecyclerView.setVerticalScrollbarPosition(View.SCROLLBAR_POSITION_LEFT);\n-  }\n-\n-  private QuranRow[] getSuraList() {\n-    int next;\n-    int pos = 0;\n-    int sura = 1;\n-    QuranRow[] elements = new QuranRow[SURAS_COUNT + JUZ2_COUNT];\n-\n-    Activity activity = getActivity();\n-    boolean wantPrefix = activity.getResources().getBoolean(R.bool.show_surat_prefix);\n-    boolean wantTranslation = quranSettings.isShowSuraTranslatedName();\n-    for (int juz = 1; juz <= JUZ2_COUNT; juz++) {\n-      final String headerTitle = activity.getString(R.string.juz2_description,\n-          QuranUtils.getLocalizedNumber(activity, juz));\n-      final QuranRow.Builder headerBuilder = new QuranRow.Builder()\n-          .withType(QuranRow.HEADER)\n-          .withText(headerTitle)\n-          .withPage(quranInfo.getStartingPageForJuz(juz));\n-      elements[pos++] = headerBuilder.build();\n-      next = (juz == JUZ2_COUNT) ? numberOfPages + 1 :\n-          quranInfo.getStartingPageForJuz(juz + 1);\n-\n-      while ((sura <= SURAS_COUNT) && (quranInfo.getPageNumberForSura(sura) < next)) {\n-        final QuranRow.Builder builder = new QuranRow.Builder()\n-            .withText(quranDisplayData.getSuraName(activity, sura, wantPrefix, wantTranslation))\n-            .withMetadata(quranDisplayData.getSuraListMetaString(activity, sura))\n-            .withSura(sura)\n-            .withPage(quranInfo.getPageNumberForSura(sura));\n-        elements[pos++] = builder.build();\n-        sura++;\n-      }\n-    }\n-\n-    return elements;\n-  }\n-\n-  public void showHideSuraTranslatedName() {\n-    QuranRow[] elements = getSuraList();\n-    ((QuranListAdapter) mRecyclerView.getAdapter()).setElements(elements);\n-    mRecyclerView.getAdapter().notifyDataSetChanged();\n-  }\n-}\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492", "message": "Merge commit", "committedDate": null}, {"oid": "9e255a11855a37c29b0cc5681f6dd7161e0b7cd7", "committedDate": "2021-06-29 22:58:45 +0400", "message": "Set minSdk to 21 and update lots of dependencies (#1617)"}, {"oid": "1fd6cebc520b7fe13962d7b8d32cf248a883a0a9", "committedDate": "2021-07-19 15:59:51 +0400", "message": "Optimize unused imports (#1632)"}, {"oid": "e7494d88e14b85f56179410dba9c222d28acea53", "committedDate": "2021-08-19 20:22:52 +0400", "message": "upgrade Rx to version 3 (#1684)"}, {"oid": "ef58c2ffcc682c4807d9c0984f9700eabbfefb46", "committedDate": "2022-02-06 20:56:03 +0700", "message": "migrate `SuraListFragment` to Kotlin"}]}, {"oid": "edd451a1188f9f84994a17e267d237fc00152c8b", "url": "https://github.com/quran/quran_android/commit/edd451a1188f9f84994a17e267d237fc00152c8b", "message": "- recall getSuraList method.", "committedDate": "2020-06-01T14:59:32Z", "type": "commit"}]}