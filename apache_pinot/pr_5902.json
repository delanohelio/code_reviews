{"pr_number": 5902, "pr_title": "Instance API to directly updateTags", "pr_author": "npawar", "pr_createdAt": "2020-08-19T23:27:50Z", "pr_url": "https://github.com/apache/pinot/pull/5902", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ1OTI3NA==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r473459274", "body": "Also log the tags", "bodyText": "Also log the tags", "bodyHTML": "<p dir=\"auto\">Also log the tags</p>", "author": "Jackie-Jiang", "createdAt": "2020-08-20T00:08:36Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/api/resources/PinotInstanceRestletResource.java", "diffHunk": "@@ -196,4 +197,25 @@ public SuccessResponse updateInstance(\n     }\n     return new SuccessResponse(\"Instance successfully updated\");\n   }\n+\n+  @PUT\n+  @Path(\"/instances/{instanceName}/updateTags\")\n+  @Consumes(MediaType.APPLICATION_JSON)\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @ApiOperation(value = \"Update the tags of the specified instance\", consumes = MediaType.APPLICATION_JSON, notes = \"Update the tags of the specified instance\")\n+  @ApiResponses(value = {@ApiResponse(code = 200, message = \"Success\"), @ApiResponse(code = 500, message = \"Internal error\")})\n+  public SuccessResponse updateInstanceTags(\n+      @ApiParam(value = \"Instance name\", required = true, example = \"Server_a.b.com_20000 | Broker_my.broker.com_30000\") @PathParam(\"instanceName\") String instanceName,\n+      @ApiParam(value = \"Comma separated tags list\", required = true) @QueryParam(\"tags\") String tags) {\n+    LOGGER.info(\"Instance update request received for instance: {}\", instanceName);", "originalCommit": "e1b04f8c617f86767632e366f2487d6890a9131a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ2MDQyMg==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r473460422", "body": "If the instance does not exist, we should return `BAD_REQUEST`", "bodyText": "If the instance does not exist, we should return BAD_REQUEST", "bodyHTML": "<p dir=\"auto\">If the instance does not exist, we should return <code>BAD_REQUEST</code></p>", "author": "Jackie-Jiang", "createdAt": "2020-08-20T00:10:14Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/api/resources/PinotInstanceRestletResource.java", "diffHunk": "@@ -196,4 +197,25 @@ public SuccessResponse updateInstance(\n     }\n     return new SuccessResponse(\"Instance successfully updated\");\n   }\n+\n+  @PUT\n+  @Path(\"/instances/{instanceName}/updateTags\")\n+  @Consumes(MediaType.APPLICATION_JSON)\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @ApiOperation(value = \"Update the tags of the specified instance\", consumes = MediaType.APPLICATION_JSON, notes = \"Update the tags of the specified instance\")\n+  @ApiResponses(value = {@ApiResponse(code = 200, message = \"Success\"), @ApiResponse(code = 500, message = \"Internal error\")})\n+  public SuccessResponse updateInstanceTags(\n+      @ApiParam(value = \"Instance name\", required = true, example = \"Server_a.b.com_20000 | Broker_my.broker.com_30000\") @PathParam(\"instanceName\") String instanceName,\n+      @ApiParam(value = \"Comma separated tags list\", required = true) @QueryParam(\"tags\") String tags) {\n+    LOGGER.info(\"Instance update request received for instance: {}\", instanceName);\n+    if (tags == null) {\n+      throw new ControllerApplicationException(LOGGER, \"Must provide tags to update\", Response.Status.BAD_REQUEST);\n+    }\n+    PinotResourceManagerResponse response = pinotHelixResourceManager.updateInstanceTags(instanceName, tags);\n+    if (!response.isSuccessful()) {\n+      throw new ControllerApplicationException(LOGGER,\n+          \"Failure to update instance tags. Reason: \" + response.getMessage(), Response.Status.INTERNAL_SERVER_ERROR);", "originalCommit": "e1b04f8c617f86767632e366f2487d6890a9131a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDExMjQ4Mw==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r474112483", "bodyText": "Instance check is happening in PinotHelixResourceManager. How do i return BAD_REQUEST from PinotHelixResourceManager? I want that instance check to remain in PinotHelixResourceManager, because that method is synchronized and will protect against race condition with delete.", "author": "npawar", "createdAt": "2020-08-20T16:26:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ2MDQyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDIwODk4NQ==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r474208985", "bodyText": "Seems the updateInstance has the same behavior. We should probably provide more status info in the PinotResourceManagerResponse besides success/failure. Not a blocker for this PR", "author": "Jackie-Jiang", "createdAt": "2020-08-20T19:08:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ2MDQyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ2MTM1Nw==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r473461357", "body": "Pass in a `List<String>` so that it is easier to use?", "bodyText": "Pass in a List<String> so that it is easier to use?", "bodyHTML": "<p dir=\"auto\">Pass in a <code>List&lt;String&gt;</code> so that it is easier to use?</p>", "author": "Jackie-Jiang", "createdAt": "2020-08-20T00:11:36Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/ControllerRequestURLBuilder.java", "diffHunk": "@@ -53,6 +53,10 @@ public String forInstance(String instanceName) {\n     return StringUtil.join(\"/\", _baseUrl, \"instances\", instanceName);\n   }\n \n+  public String forInstanceUpdateTags(String instanceName, String tagsList) {", "originalCommit": "e1b04f8c617f86767632e366f2487d6890a9131a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ2ODUwOQ==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r473468509", "body": "Can be simplified as following (not sure why Helix does not provide `setTags()`), also `StringUtils.split()` has better performance than `String.split()` which takes a regex\r\n```suggestion\r\n    List<String> tagList = Arrays.asList(StringUtils.split(tags, ','));\r\n    instanceConfig.getRecord().setListField(InstanceConfig.InstanceConfigProperty.TAG_LIST.name(), tagList);\r\n```", "bodyText": "Can be simplified as following (not sure why Helix does not provide setTags()), also StringUtils.split() has better performance than String.split() which takes a regex\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String[] newTags = tags.split(\",\");\n          \n          \n            \n                List<String> existingTags = Lists.newArrayList(instanceConfig.getTags());\n          \n          \n            \n                for (String tag : existingTags) {\n          \n          \n            \n                  instanceConfig.removeTag(tag);\n          \n          \n            \n                }\n          \n          \n            \n                for (String tag : newTags) {\n          \n          \n            \n                  instanceConfig.addTag(tag);\n          \n          \n            \n                }\n          \n          \n            \n                List<String> tagList = Arrays.asList(StringUtils.split(tags, ','));\n          \n          \n            \n                instanceConfig.getRecord().setListField(InstanceConfig.InstanceConfigProperty.TAG_LIST.name(), tagList);", "bodyHTML": "<p dir=\"auto\">Can be simplified as following (not sure why Helix does not provide <code>setTags()</code>), also <code>StringUtils.split()</code> has better performance than <code>String.split()</code> which takes a regex</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">String</span>[] newTags <span class=\"pl-k\">=</span> tags<span class=\"pl-k\">.</span>split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>,<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">String</span>&gt;</span> existingTags <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Lists</span><span class=\"pl-k\">.</span>newArrayList(instanceConfig<span class=\"pl-k\">.</span>getTags());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">String</span> tag <span class=\"pl-k\">:</span> existingTags) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      instanceConfig<span class=\"pl-k\">.</span>removeTag(tag);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">String</span> tag <span class=\"pl-k\">:</span> newTags) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      instanceConfig<span class=\"pl-k\">.</span>addTag(tag);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">String</span>&gt;</span> tagList <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Arrays</span><span class=\"pl-k\">.</span>asList(<span class=\"pl-smi\">StringUtils</span><span class=\"pl-k\">.</span>split(tags, <span class=\"pl-s\"><span class=\"pl-pds\">'</span>,<span class=\"pl-pds\">'</span></span>));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    instanceConfig<span class=\"pl-k\">.</span>getRecord()<span class=\"pl-k\">.</span>setListField(<span class=\"pl-smi\">InstanceConfig</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">InstanceConfigProperty</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>TAG_LIST</span><span class=\"pl-k\">.</span>name(), tagList);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Jackie-Jiang", "createdAt": "2020-08-20T00:22:36Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/PinotHelixResourceManager.java", "diffHunk": "@@ -399,6 +400,28 @@ public synchronized PinotResourceManagerResponse updateInstance(String instanceI\n     }\n   }\n \n+  /**\n+   * Updates the tags of the specified instance ID\n+   */\n+  public synchronized PinotResourceManagerResponse updateInstanceTags(String instanceIdToUpdate, String tags) {\n+    InstanceConfig instanceConfig = getHelixInstanceConfig(instanceIdToUpdate);\n+    if (instanceConfig == null) {\n+      return PinotResourceManagerResponse.failure(\"Instance \" + instanceIdToUpdate + \" does not exists\");\n+    }\n+    String[] newTags = tags.split(\",\");\n+    List<String> existingTags = Lists.newArrayList(instanceConfig.getTags());\n+    for (String tag : existingTags) {\n+      instanceConfig.removeTag(tag);\n+    }\n+    for (String tag : newTags) {\n+      instanceConfig.addTag(tag);\n+    }", "originalCommit": "e1b04f8c617f86767632e366f2487d6890a9131a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMwNzc0Mw==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r480307743", "bodyText": "Ah thanks for this", "author": "npawar", "createdAt": "2020-08-31T18:24:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzQ2ODUwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzczMzAxNw==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r473733017", "body": "run this in a compare and set loop to handle race conditions. we can wrap this function in updater", "bodyText": "run this in a compare and set loop to handle race conditions. we can wrap this function in updater", "bodyHTML": "<p dir=\"auto\">run this in a compare and set loop to handle race conditions. we can wrap this function in updater</p>", "author": "kishoreg", "createdAt": "2020-08-20T08:00:38Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/core/PinotHelixResourceManager.java", "diffHunk": "@@ -399,6 +400,28 @@ public synchronized PinotResourceManagerResponse updateInstance(String instanceI\n     }\n   }\n \n+  /**\n+   * Updates the tags of the specified instance ID\n+   */\n+  public synchronized PinotResourceManagerResponse updateInstanceTags(String instanceIdToUpdate, String tags) {\n+    InstanceConfig instanceConfig = getHelixInstanceConfig(instanceIdToUpdate);", "originalCommit": "e1b04f8c617f86767632e366f2487d6890a9131a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDExMDUzMQ==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r474110531", "bodyText": "what kind of race conditions are you thinking about? All of the methods which update this config are synchronized methods.\nAre you thinking about race conditions across controllers? (we haven't really handled that for any of our APIs)", "author": "npawar", "createdAt": "2020-08-20T16:23:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzczMzAxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTYxOTYwNg==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r479619606", "bodyText": "ok, we can handle that in another PR", "author": "kishoreg", "createdAt": "2020-08-29T07:25:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzczMzAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzczNDkwMA==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r473734900", "body": "print the new tags. Instance tags successfully updated from:{old tags} to: {new tags}", "bodyText": "print the new tags. Instance tags successfully updated from:{old tags} to: {new tags}", "bodyHTML": "<p dir=\"auto\">print the new tags. Instance tags successfully updated from:{old tags} to: {new tags}</p>", "author": "kishoreg", "createdAt": "2020-08-20T08:02:15Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/api/resources/PinotInstanceRestletResource.java", "diffHunk": "@@ -196,4 +197,25 @@ public SuccessResponse updateInstance(\n     }\n     return new SuccessResponse(\"Instance successfully updated\");\n   }\n+\n+  @PUT\n+  @Path(\"/instances/{instanceName}/updateTags\")\n+  @Consumes(MediaType.APPLICATION_JSON)\n+  @Produces(MediaType.APPLICATION_JSON)\n+  @ApiOperation(value = \"Update the tags of the specified instance\", consumes = MediaType.APPLICATION_JSON, notes = \"Update the tags of the specified instance\")\n+  @ApiResponses(value = {@ApiResponse(code = 200, message = \"Success\"), @ApiResponse(code = 500, message = \"Internal error\")})\n+  public SuccessResponse updateInstanceTags(\n+      @ApiParam(value = \"Instance name\", required = true, example = \"Server_a.b.com_20000 | Broker_my.broker.com_30000\") @PathParam(\"instanceName\") String instanceName,\n+      @ApiParam(value = \"Comma separated tags list\", required = true) @QueryParam(\"tags\") String tags) {\n+    LOGGER.info(\"Instance update request received for instance: {}\", instanceName);\n+    if (tags == null) {\n+      throw new ControllerApplicationException(LOGGER, \"Must provide tags to update\", Response.Status.BAD_REQUEST);\n+    }\n+    PinotResourceManagerResponse response = pinotHelixResourceManager.updateInstanceTags(instanceName, tags);\n+    if (!response.isSuccessful()) {\n+      throw new ControllerApplicationException(LOGGER,\n+          \"Failure to update instance tags. Reason: \" + response.getMessage(), Response.Status.INTERNAL_SERVER_ERROR);\n+    }\n+    return new SuccessResponse(\"Instance successfully updated\");", "originalCommit": "e1b04f8c617f86767632e366f2487d6890a9131a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5d65ebecfe0d568163ae90ab29c2ee630b724014", "url": "https://github.com/apache/pinot/commit/5d65ebecfe0d568163ae90ab29c2ee630b724014", "message": "Instance API to directly updateTags", "committedDate": "2020-08-31T17:17:12Z", "type": "commit"}, {"oid": "5481ad5cd6f1c6820b12e6c0a9ab178739a36d10", "url": "https://github.com/apache/pinot/commit/5481ad5cd6f1c6820b12e6c0a9ab178739a36d10", "message": "Review comments", "committedDate": "2020-08-31T18:23:41Z", "type": "commit"}, {"oid": "5481ad5cd6f1c6820b12e6c0a9ab178739a36d10", "url": "https://github.com/apache/pinot/commit/5481ad5cd6f1c6820b12e6c0a9ab178739a36d10", "message": "Review comments", "committedDate": "2020-08-31T18:23:41Z", "type": "forcePushed"}, {"oid": "773f80a154885427b7ca03be1e23631f02163166", "url": "https://github.com/apache/pinot/commit/773f80a154885427b7ca03be1e23631f02163166", "message": "List in param instead of string", "committedDate": "2020-08-31T18:28:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIxMTcwMw==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r483211703", "body": "Suggest using StringUtils to join\r\n```suggestion\r\n    return StringUtil.join(\"/\", _baseUrl, \"instances\", instanceName, \"updateTags?tags=\" + StringUtils.join(tags, ',');\r\n```", "bodyText": "Suggest using StringUtils to join\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return StringUtil.join(\"/\", _baseUrl, \"instances\", instanceName, \"updateTags?tags=\" + Joiner.on(\",\").join(tags));\n          \n          \n            \n                return StringUtil.join(\"/\", _baseUrl, \"instances\", instanceName, \"updateTags?tags=\" + StringUtils.join(tags, ',');", "bodyHTML": "<p dir=\"auto\">Suggest using StringUtils to join</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">return</span> <span class=\"pl-smi\">StringUtil</span><span class=\"pl-k\">.</span>join(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/<span class=\"pl-pds\">\"</span></span>, _baseUrl, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>instances<span class=\"pl-pds\">\"</span></span>, instanceName, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>updateTags?tags=<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> <span class=\"pl-smi x x-first\">Joiner</span><span class=\"pl-k x\">.</span><span class=\"x\">on(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">,</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">)</span><span class=\"pl-k x x-last\">.</span>join(tags<span class=\"x x-first x-last\">)</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">return</span> <span class=\"pl-smi\">StringUtil</span><span class=\"pl-k\">.</span>join(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/<span class=\"pl-pds\">\"</span></span>, _baseUrl, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>instances<span class=\"pl-pds\">\"</span></span>, instanceName, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>updateTags?tags=<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> <span class=\"pl-smi x x-first\">StringUtils</span><span class=\"pl-k x x-last\">.</span>join(tags<span class=\"x x-first\">, </span><span class=\"pl-s\"><span class=\"pl-pds x\">'</span><span class=\"x\">,</span><span class=\"pl-pds x x-last\">'</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Jackie-Jiang", "createdAt": "2020-09-03T19:39:37Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/ControllerRequestURLBuilder.java", "diffHunk": "@@ -53,6 +55,10 @@ public String forInstance(String instanceName) {\n     return StringUtil.join(\"/\", _baseUrl, \"instances\", instanceName);\n   }\n \n+  public String forInstanceUpdateTags(String instanceName, List<String> tags) {\n+    return StringUtil.join(\"/\", _baseUrl, \"instances\", instanceName, \"updateTags?tags=\" + Joiner.on(\",\").join(tags));", "originalCommit": "773f80a154885427b7ca03be1e23631f02163166", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIxMjA0Mw==", "url": "https://github.com/apache/pinot/pull/5902#discussion_r483212043", "body": "Not from this PR, but let's change it to `lang3` for consistency\r\n```suggestion\r\nimport org.apache.commons.lang3.StringUtils;\r\n```", "bodyText": "Not from this PR, but let's change it to lang3 for consistency\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import org.apache.commons.lang.StringUtils;\n          \n          \n            \n            import org.apache.commons.lang3.StringUtils;", "bodyHTML": "<p dir=\"auto\">Not from this PR, but let's change it to <code>lang3</code> for consistency</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.commons.<span class=\"x x-first x-last\">lang</span>.StringUtils</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.commons.<span class=\"x x-first x-last\">lang3</span>.StringUtils</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Jackie-Jiang", "createdAt": "2020-09-03T19:40:17Z", "path": "pinot-controller/src/main/java/org/apache/pinot/controller/helix/ControllerRequestURLBuilder.java", "diffHunk": "@@ -18,6 +18,8 @@\n  */\n package org.apache.pinot.controller.helix;\n \n+import com.google.common.base.Joiner;\n+import java.util.List;\n import javax.annotation.Nullable;\n import org.apache.commons.lang.StringUtils;", "originalCommit": "773f80a154885427b7ca03be1e23631f02163166", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f9ce0a20a32f7da387d8d7d8ac54595e8157957d", "url": "https://github.com/apache/pinot/commit/f9ce0a20a32f7da387d8d7d8ac54595e8157957d", "message": "Review comments", "committedDate": "2020-09-03T20:13:27Z", "type": "commit"}, {"oid": "f9ce0a20a32f7da387d8d7d8ac54595e8157957d", "url": "https://github.com/apache/pinot/commit/f9ce0a20a32f7da387d8d7d8ac54595e8157957d", "message": "Review comments", "committedDate": "2020-09-03T20:13:27Z", "type": "forcePushed"}]}