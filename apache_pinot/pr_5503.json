{"pr_number": 5503, "pr_title": "Config for raw index writer version", "pr_author": "siddharthteotia", "pr_createdAt": "2020-06-05T21:10:22Z", "pr_url": "https://github.com/apache/pinot/pull/5503", "timeline": [{"oid": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843", "url": "https://github.com/apache/pinot/commit/e51d7e3e74b7cabd0b0c27df9692e3ee75554843", "message": "In PR https://github.com/apache/incubator-pinot/pull/5285,\nthe raw index writer format was changed to use 8 byte offset\nfor each chunk in the file header. The writer version\nwas bumped to 3. This was done to support > 2GB indexes.\nThe change was backward compatible to continue the support\nfor reading existing/old segments using 4-byte offsets\n\nWhile there is no problem with the change, it prevents rollback.\nSo if there is any orthogonal issue while rolling out a release,\nwe can't rollback to older Pinot release since segments already\ngenerated with 8-byte offsets can't be read by old code.\n\nThis config option is temporary to help with internal roll-out\nby keeping the 8-byte format disabled by default thus allowing\nrollback due to any issues. In the next couple of weeks after\ninternal rollout, we plan to remove this option.", "committedDate": "2020-06-05T20:38:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4MTk3OA==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436181978", "body": "Why are we changing this? This is backward-incompatible change right?", "bodyText": "Why are we changing this? This is backward-incompatible change right?", "bodyHTML": "<p dir=\"auto\">Why are we changing this? This is backward-incompatible change right?</p>", "author": "Jackie-Jiang", "createdAt": "2020-06-05T21:57:32Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/config/table/FieldConfig.java", "diffHunk": "@@ -33,15 +33,16 @@\n   private final IndexType _indexType;\n   private final Map<String, String> _properties;\n \n-  public static String BLOOM_FILTER_COLUMN_KEY = \"bloom.filter\";", "originalCommit": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5NzYwMQ==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436197601", "bodyText": "I haven't yet done the migration from IndexingConfig to FieldConfig. It is only being used for text. So this change doesn't affect anyone. Just wanted to clean up names and remove the dotted notation. Going to migrate to FieldConfig soon", "author": "siddharthteotia", "createdAt": "2020-06-05T22:50:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE4MTk3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2Njc3MA==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436166770", "body": "```suggestion\r\n  public static final int DEFAULT_WRITER_VERSION = 2;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static final int DEFAULT_VERSION = 2;\n          \n          \n            \n              public static final int DEFAULT_WRITER_VERSION = 2;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"41\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">int</span> <span class=\"pl-c1 x x-first x-last\">DEFAULT_VERSION</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">2</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"41\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-k\">int</span> <span class=\"pl-c1 x x-first x-last\">DEFAULT_WRITER_VERSION</span> <span class=\"pl-k\">=</span> <span class=\"pl-c1\">2</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "mcvsubbu", "createdAt": "2020-06-05T21:13:11Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/io/writer/impl/v1/BaseChunkSingleValueWriter.java", "diffHunk": "@@ -36,6 +37,9 @@\n  * Base class for fixed and variable byte writer implementations.\n  */\n public abstract class BaseChunkSingleValueWriter implements SingleColumnSingleValueWriter {\n+  public static final int DEFAULT_VERSION = 2;", "originalCommit": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MjkzNA==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436192934", "bodyText": "Maybe add a TODO or create an issue to remove this before 0.5.0 and put a pointer here to the issue?", "author": "mcvsubbu", "createdAt": "2020-06-05T22:31:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2Njc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwMDc2Mg==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436200762", "bodyText": "done", "author": "siddharthteotia", "createdAt": "2020-06-05T23:05:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2Njc3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MzA1NA==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436193054", "body": "this comment may not hold in the long term, so just leave it as is", "bodyText": "this comment may not hold in the long term, so just leave it as is", "bodyHTML": "<p dir=\"auto\">this comment may not hold in the long term, so just leave it as is</p>", "author": "mcvsubbu", "createdAt": "2020-06-05T22:32:28Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/io/writer/impl/v1/BaseChunkSingleValueWriter.java", "diffHunk": "@@ -60,12 +64,13 @@\n    * @param numDocsPerChunk Number of docs per data chunk\n    * @param chunkSize Size of chunk\n    * @param sizeOfEntry Size of entry (in bytes), max size for variable byte implementation.\n-   * @param version Version of file\n+   * @param version format version used to determine whether to use 8 or 4 byte chunk offsets", "originalCommit": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwMDcxOQ==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436200719", "bodyText": "done", "author": "siddharthteotia", "createdAt": "2020-06-05T23:05:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MzA1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MzA5NQ==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436193095", "body": "same", "bodyText": "same", "bodyHTML": "<p dir=\"auto\">same</p>", "author": "mcvsubbu", "createdAt": "2020-06-05T22:32:39Z", "path": "pinot-core/src/main/java/org/apache/pinot/core/io/writer/impl/v1/FixedByteChunkSingleValueWriter.java", "diffHunk": "@@ -64,15 +62,15 @@\n    * @param compressionType Type of compression to use.\n    * @param totalDocs Total number of docs to write.\n    * @param numDocsPerChunk Number of documents per chunk.\n-   * @param sizeOfEntry Size of entry (in bytes).\n+   * @param sizeOfEntry Size of entry (in bytes)\n+   * @param writerVersion writer version used to determine whether to use 8 or 4 byte chunk offsets", "originalCommit": "e51d7e3e74b7cabd0b0c27df9692e3ee75554843", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjIwMDcyNQ==", "url": "https://github.com/apache/pinot/pull/5503#discussion_r436200725", "bodyText": "done", "author": "siddharthteotia", "createdAt": "2020-06-05T23:05:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE5MzA5NQ=="}], "type": "inlineReview"}, {"oid": "45402fd75b84fc4a9017805fdc435cef634d9804", "url": "https://github.com/apache/pinot/commit/45402fd75b84fc4a9017805fdc435cef634d9804", "message": "address review comments", "committedDate": "2020-06-06T07:22:05Z", "type": "commit"}]}