{"pr_number": 6102, "pr_title": "Add the primary key reading from the GenericRow", "pr_author": "yupeng9", "pr_createdAt": "2020-10-03T05:10:22Z", "pr_url": "https://github.com/apache/pinot/pull/6102", "timeline": [{"oid": "f62b35167679a70e59ec4686db1f88a3a8e6b19c", "url": "https://github.com/apache/pinot/commit/f62b35167679a70e59ec4686db1f88a3a8e6b19c", "message": "Add the primary key reading from the GenericRow", "committedDate": "2020-10-03T05:07:08Z", "type": "commit"}, {"oid": "463b4085efde3dadc7b94ec43475bc6a11de65f4", "url": "https://github.com/apache/pinot/commit/463b4085efde3dadc7b94ec43475bc6a11de65f4", "message": "cleanup", "committedDate": "2020-10-03T05:09:44Z", "type": "commit"}, {"oid": "169b88121b2f8cc542ebbb3622897836bb109615", "url": "https://github.com/apache/pinot/commit/169b88121b2f8cc542ebbb3622897836bb109615", "message": "add license", "committedDate": "2020-10-04T03:27:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTEyNg==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499901126", "body": "Cache `primaryKeyColumns.size()` into a local variable", "bodyText": "Cache primaryKeyColumns.size() into a local variable", "bodyHTML": "<p dir=\"auto\">Cache <code>primaryKeyColumns.size()</code> into a local variable</p>", "author": "Jackie-Jiang", "createdAt": "2020-10-05T22:13:01Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java", "diffHunk": "@@ -123,6 +124,14 @@ public void putValue(String fieldName, @Nullable Object value) {\n     _fieldToValueMap.put(fieldName, value);\n   }\n \n+  public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n+    Object[] fields = new Object[primaryKeyColumns.size()];", "originalCommit": "169b88121b2f8cc542ebbb3622897836bb109615", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTQ5NQ==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499901495", "body": "Suggest renaming it to `values`", "bodyText": "Suggest renaming it to values", "bodyHTML": "<p dir=\"auto\">Suggest renaming it to <code>values</code></p>", "author": "Jackie-Jiang", "createdAt": "2020-10-05T22:14:02Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java", "diffHunk": "@@ -123,6 +124,14 @@ public void putValue(String fieldName, @Nullable Object value) {\n     _fieldToValueMap.put(fieldName, value);\n   }\n \n+  public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n+    Object[] fields = new Object[primaryKeyColumns.size()];", "originalCommit": "169b88121b2f8cc542ebbb3622897836bb109615", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTU2OA==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499901568", "body": "Suggest renaming it to `_values`", "bodyText": "Suggest renaming it to _values", "bodyHTML": "<p dir=\"auto\">Suggest renaming it to <code>_values</code></p>", "author": "Jackie-Jiang", "createdAt": "2020-10-05T22:14:13Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.data.readers;\n+\n+import java.util.Arrays;\n+\n+\n+/**\n+ * The primary key of a record.\n+ */\n+public class PrimaryKey {\n+  private final Object[] _fields;", "originalCommit": "169b88121b2f8cc542ebbb3622897836bb109615", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTk2MA==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499901960", "body": "Add some javadoc stating that the values should be SV (MV values won't work for equals and hashcode)", "bodyText": "Add some javadoc stating that the values should be SV (MV values won't work for equals and hashcode)", "bodyHTML": "<p dir=\"auto\">Add some javadoc stating that the values should be SV (MV values won't work for equals and hashcode)</p>", "author": "Jackie-Jiang", "createdAt": "2020-10-05T22:15:18Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.data.readers;\n+\n+import java.util.Arrays;\n+\n+\n+/**\n+ * The primary key of a record.", "originalCommit": "169b88121b2f8cc542ebbb3622897836bb109615", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkyMzc4MA==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499923780", "bodyText": "Yes. Table config shall validate this.", "author": "yupeng9", "createdAt": "2020-10-05T23:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkwMTk2MA=="}], "type": "inlineReview"}, {"oid": "d2ce718388009aa1431d126df8f38b92cf65fab9", "url": "https://github.com/apache/pinot/commit/d2ce718388009aa1431d126df8f38b92cf65fab9", "message": "addressed comments", "committedDate": "2020-10-05T23:29:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzNTc4MQ==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499935781", "body": "(nit)\r\n```suggestion\r\n    int numPrimaryKeyColumns = primaryKeyColumns.size();\r\n    Object[] values = new Object[numPrimaryKeyColumns];\r\n    for (int i = 0; i < numPrimaryKeyColumns; i++) {\r\n```", "bodyText": "(nit)\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Object[] values = new Object[primaryKeyColumns.size()];\n          \n          \n            \n                int size = primaryKeyColumns.size();\n          \n          \n            \n                for (int i = 0; i < size; i++) {\n          \n          \n            \n                int numPrimaryKeyColumns = primaryKeyColumns.size();\n          \n          \n            \n                Object[] values = new Object[numPrimaryKeyColumns];\n          \n          \n            \n                for (int i = 0; i < numPrimaryKeyColumns; i++) {", "bodyHTML": "<p dir=\"auto\">(nit)</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k x x-first\">Object</span><span class=\"x x-last\">[] values</span> <span class=\"pl-k\">=</span> <span class=\"pl-k x x-first\">new</span><span class=\"x\"> </span><span class=\"pl-smi x\">Object</span><span class=\"x x-last\">[</span>primaryKeyColumns<span class=\"pl-k\">.</span>size()<span class=\"x x-first x-last\">]</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k x x-first\">int</span><span class=\"x x-last\"> size</span> <span class=\"pl-k\">=</span> <span class=\"x x-first\">primaryKeyColumns</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">size()</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">for</span> (<span class=\"pl-k\">int</span> i <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>; i <span class=\"pl-k\">&lt;</span> <span class=\"x x-first x-last\">size</span>; i<span class=\"pl-k\">++</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k x x-first\">int</span><span class=\"x x-last\"> numPrimaryKeyColumns</span> <span class=\"pl-k\">=</span> primaryKeyColumns<span class=\"pl-k\">.</span>size();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k x x-first\">Object</span><span class=\"x x-last\">[] values</span> <span class=\"pl-k\">=</span> <span class=\"pl-k x x-first\">new</span><span class=\"x\"> </span><span class=\"pl-smi x\">Object</span><span class=\"x x-last\">[numPrimaryKeyColumns]</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">for</span> (<span class=\"pl-k\">int</span> i <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>; i <span class=\"pl-k\">&lt;</span> <span class=\"x x-first x-last\">numPrimaryKeyColumns</span>; i<span class=\"pl-k\">++</span>) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Jackie-Jiang", "createdAt": "2020-10-06T00:03:14Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/GenericRow.java", "diffHunk": "@@ -123,6 +124,15 @@ public void putValue(String fieldName, @Nullable Object value) {\n     _fieldToValueMap.put(fieldName, value);\n   }\n \n+  public PrimaryKey getPrimaryKey(List<String> primaryKeyColumns) {\n+    Object[] values = new Object[primaryKeyColumns.size()];\n+    int size = primaryKeyColumns.size();\n+    for (int i = 0; i < size; i++) {", "originalCommit": "d2ce718388009aa1431d126df8f38b92cf65fab9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkzNTkwMQ==", "url": "https://github.com/apache/pinot/pull/6102#discussion_r499935901", "body": "(nit)\r\n```suggestion\r\n  public PrimaryKey(Object[] values) {\r\n    _values = values;\r\n```", "bodyText": "(nit)\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public PrimaryKey(Object[] fields) {\n          \n          \n            \n                _values = fields;\n          \n          \n            \n              public PrimaryKey(Object[] values) {\n          \n          \n            \n                _values = values;", "bodyHTML": "<p dir=\"auto\">(nit)</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">public</span> PrimaryKey(<span class=\"pl-k\">Object</span>[] <span class=\"x x-first x-last\">fields</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    _values <span class=\"pl-k\">=</span> <span class=\"x x-first x-last\">fields</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">public</span> PrimaryKey(<span class=\"pl-k\">Object</span>[] <span class=\"x x-first x-last\">values</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    _values <span class=\"pl-k\">=</span> <span class=\"x x-first x-last\">values</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Jackie-Jiang", "createdAt": "2020-10-06T00:03:41Z", "path": "pinot-spi/src/main/java/org/apache/pinot/spi/data/readers/PrimaryKey.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.pinot.spi.data.readers;\n+\n+import java.util.Arrays;\n+\n+\n+/**\n+ * The primary key of a record. Note that the value used in the primary key must be single-value.\n+ */\n+public class PrimaryKey {\n+  private final Object[] _values;\n+\n+  public PrimaryKey(Object[] fields) {\n+    _values = fields;", "originalCommit": "d2ce718388009aa1431d126df8f38b92cf65fab9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "457b078cae861a4bfe428e057b03972552497b53", "url": "https://github.com/apache/pinot/commit/457b078cae861a4bfe428e057b03972552497b53", "message": "more comments", "committedDate": "2020-10-06T00:18:26Z", "type": "commit"}]}