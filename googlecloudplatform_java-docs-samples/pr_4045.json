{"pr_number": 4045, "pr_title": "feat: eventarc generic and eventarc other brushup", "pr_author": "grant", "pr_createdAt": "2020-10-21T04:59:22Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045", "timeline": [{"oid": "5b1d1ea1b8b0c15c0179d6c120adc69f1f520384", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/5b1d1ea1b8b0c15c0179d6c120adc69f1f520384", "message": "feat: eventarc generic and eventarc other brushup\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T04:56:42Z", "type": "commit"}, {"oid": "b955c1bd31c94cd2ae2ec119a7e770ff9d935c98", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b955c1bd31c94cd2ae2ec119a7e770ff9d935c98", "message": "lint: fix lint issue\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T14:01:26Z", "type": "commit"}, {"oid": "6a9997b4fb479dc14ce9c644f49867c03b1592fa", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/6a9997b4fb479dc14ce9c644f49867c03b1592fa", "message": "lint: fix lint issue\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T14:14:39Z", "type": "commit"}, {"oid": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "message": "lint: fix lint issue\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T14:42:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NDU4NQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509394585", "body": "```suggestion\r\n    String msg = \"Detected change in GCS bucket: \" + ceSubject;\r\n```\r\nString.format has poor performance", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                String msg = String.format(\"Detected change in GCS bucket: %s.\", ceSubject);\n          \n          \n            \n                String msg = \"Detected change in GCS bucket: \" + ceSubject;\n          \n      \n    \n    \n  \n\nString.format has poor performance", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-smi\">String</span> msg <span class=\"pl-k\">=</span> <span class=\"pl-smi x x-first\">String</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">format(</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Detected change in GCS bucket: <span class=\"x x-first\">%s.</span><span class=\"pl-pds x\">\"</span></span><span class=\"x x-last\">, </span>ceSubject<span class=\"x x-first x-last\">)</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-smi\">String</span> msg <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Detected change in GCS bucket: <span class=\"pl-pds x x-first\">\"</span></span><span class=\"x\"> </span><span class=\"pl-k x\">+</span><span class=\"x x-last\"> </span>ceSubject;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">String.format has poor performance</p>", "author": "averikitsch", "createdAt": "2020-10-21T15:39:31Z", "path": "eventarc/audit-storage/src/main/java/com/example/cloudrun/EventController.java", "diffHunk": "@@ -53,7 +52,7 @@\n     }\n \n     String ceSubject = headers.get(\"ce-subject\");\n-    String msg = String.format(\"GCS CloudEvent type: %s.\", ceSubject);\n+    String msg = String.format(\"Detected change in GCS bucket: %s.\", ceSubject);", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU5NjM0Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509596347", "bodyText": "Fixed, thanks.", "author": "grant", "createdAt": "2020-10-21T19:07:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NDU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTI5Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509395297", "body": "Even though this isn't the point of the sample, removing PubSubBody feels like it makes this sample not useful for continued learning and building.", "bodyText": "Even though this isn't the point of the sample, removing PubSubBody feels like it makes this sample not useful for continued learning and building.", "bodyHTML": "<p dir=\"auto\">Even though this isn't the point of the sample, removing PubSubBody feels like it makes this sample not useful for continued learning and building.</p>", "author": "averikitsch", "createdAt": "2020-10-21T15:40:26Z", "path": "eventarc/audit-storage/src/main/java/com/example/cloudrun/EventController.java", "diffHunk": "@@ -37,7 +36,7 @@\n \n   @RequestMapping(value = \"/\", method = RequestMethod.POST)\n   public ResponseEntity<String> receiveMessage(\n-      @RequestBody PubSubBody body, @RequestHeader Map<String, String> headers) {\n+      @RequestBody Object body, @RequestHeader Map<String, String> headers) {", "originalCommit": "7336d434cc2b50459dff1a60f2bf3bd15e076a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU5NjExMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r509596113", "bodyText": "This sample literally does not receive Pub/Sub requests. It receives Cloud Audit Log requests. In this case, the audit log is for a Cloud Storage event.\nThus, it's incorrect to have Pub/Sub in this sample. The sample does not use this body, so the tests have always passed. If we wanted a different POJO, we cannot include a LogEntryData POJO until that library is finished and published.\nWe have a Pub/Sub sample for Pub/Sub events.", "author": "grant", "createdAt": "2020-10-21T19:07:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwMDAzNA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r510400034", "bodyText": "You could build your own POJO for the time being like Pub/Sub.  From this code, I have no idea what it accepts so if possible at least add a content type. We shouldn't use \"Object\", Map<String, String> would at least be useable.", "author": "averikitsch", "createdAt": "2020-10-22T19:19:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY1NDQ4NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r510654484", "bodyText": "I've changed the type to a Map per suggestion.\n\nThe JSON payload is large for an Audit Log. The POJO would have 14 classes (see link above), unless we construct a custom POJO for this type.\nThe actual contents of an Audit Log is very strange, hard to use, and is not useful for this sample of an audit log for a Cloud Storage event.\nI don't think there's value in adding/maintaining a POJO in Java for this specific event type during public preview and would rather have a generic type until we publish https://github.com/googleapis/google-cloudevents-java/tree/master/google-cloudevent-types/src/main/java/com/google/events/cloud/audit/v1", "author": "grant", "createdAt": "2020-10-23T06:13:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5NTI5Nw=="}], "type": "inlineReview"}, {"oid": "b6b54d5aae55ca3ef497a3d6c0ead4eca3795700", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/b6b54d5aae55ca3ef497a3d6c0ead4eca3795700", "message": "fix: eventarc generic review comments\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-21T19:18:42Z", "type": "commit"}, {"oid": "42d20305c29366eda8986286042f3725330a188c", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/42d20305c29366eda8986286042f3725330a188c", "message": "fix: use map for request body type\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-23T06:04:45Z", "type": "commit"}, {"oid": "65372044b5db7a247af2954ace3f824118af795d", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/65372044b5db7a247af2954ace3f824118af795d", "message": "fix: use map for request body type\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-23T06:05:14Z", "type": "commit"}, {"oid": "65372044b5db7a247af2954ace3f824118af795d", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/65372044b5db7a247af2954ace3f824118af795d", "message": "fix: use map for request body type\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-23T06:05:14Z", "type": "forcePushed"}, {"oid": "8ff57f9dacfeb51268d85b361f1b0092b2cac0a5", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/8ff57f9dacfeb51268d85b361f1b0092b2cac0a5", "message": "Merge branch 'master' into grant_eventarc_generic", "committedDate": "2020-10-23T06:16:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxMzI3OA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r511013278", "body": "I forgot the fields aren't necessary strings, so this should be <String, Object> for the unmarshalling. Will approve for this simple change.", "bodyText": "I forgot the fields aren't necessary strings, so this should be <String, Object> for the unmarshalling. Will approve for this simple change.", "bodyHTML": "<p dir=\"auto\">I forgot the fields aren't necessary strings, so this should be &lt;String, Object&gt; for the unmarshalling. Will approve for this simple change.</p>", "author": "averikitsch", "createdAt": "2020-10-23T16:50:34Z", "path": "eventarc/audit-storage/src/main/java/com/example/cloudrun/EventController.java", "diffHunk": "@@ -37,7 +36,7 @@\n \n   @RequestMapping(value = \"/\", method = RequestMethod.POST)\n   public ResponseEntity<String> receiveMessage(\n-      @RequestBody PubSubBody body, @RequestHeader Map<String, String> headers) {\n+      @RequestBody Map<String, String> body, @RequestHeader Map<String, String> headers) {", "originalCommit": "8ff57f9dacfeb51268d85b361f1b0092b2cac0a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxNzc4Mw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4045#discussion_r511017783", "bodyText": "Changed to Object.", "author": "grant", "createdAt": "2020-10-23T16:59:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAxMzI3OA=="}], "type": "inlineReview"}, {"oid": "94124e10d318d614df0660d69702ae0a3987628b", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/94124e10d318d614df0660d69702ae0a3987628b", "message": "fix: eventarc audit map from string to object\n\nSigned-off-by: Grant Timmerman <timmerman+devrel@google.com>", "committedDate": "2020-10-23T16:58:37Z", "type": "commit"}]}