{"pr_number": 3784, "pr_title": "Add Cloud SQL R2DBC sample", "pr_author": "dmitry-s", "pr_createdAt": "2020-09-22T17:49:50Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784", "timeline": [{"oid": "964cabd4d410250aba1363592d4c49dc2d1ad289", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/964cabd4d410250aba1363592d4c49dc2d1ad289", "message": "add r2dbc sample", "committedDate": "2020-09-22T17:44:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5Njk0MA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r492996940", "body": "All of the source files need to be formatted to use 2-space tabs; there is some inconsistent tab usage.", "bodyText": "All of the source files need to be formatted to use 2-space tabs; there is some inconsistent tab usage.", "bodyHTML": "<p dir=\"auto\">All of the source files need to be formatted to use 2-space tabs; there is some inconsistent tab usage.</p>", "author": "dzou", "createdAt": "2020-09-22T19:56:58Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/CommanLineRunnerSchemaCreator.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*", "originalCommit": "964cabd4d410250aba1363592d4c49dc2d1ad289", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk5NzUxMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r492997513", "body": "```suggestion\r\npublic class CommandLineRunnerSchemaCreator implements CommandLineRunner {\r\n```\r\n\r\nAlso will need to rename the file.", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class CommanLineRunnerSchemaCreator implements CommandLineRunner {\n          \n          \n            \n            public class CommandLineRunnerSchemaCreator implements CommandLineRunner {\n          \n      \n    \n    \n  \n\nAlso will need to rename the file.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en x x-first x-last\">CommanLineRunnerSchemaCreator</span> <span class=\"pl-k\">implements</span> <span class=\"pl-e\">CommandLineRunner</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en x x-first x-last\">CommandLineRunnerSchemaCreator</span> <span class=\"pl-k\">implements</span> <span class=\"pl-e\">CommandLineRunner</span> {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">Also will need to rename the file.</p>", "author": "dzou", "createdAt": "2020-09-22T19:58:08Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/CommanLineRunnerSchemaCreator.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.cloudsql.r2dbcsample;\n+\n+import io.r2dbc.spi.ConnectionFactory;\n+import java.util.Arrays;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.CommandLineRunner;\n+import org.springframework.data.r2dbc.core.DatabaseClient;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class CommanLineRunnerSchemaCreator implements CommandLineRunner {", "originalCommit": "964cabd4d410250aba1363592d4c49dc2d1ad289", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwNjk1NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r493006954", "body": "I think it'd be simpler if you left the `.map` unnested from the `.flatmap`, like this:\r\n\r\n```\r\nreturn serverWebExchange.getFormData()\r\n        .flatMap(formData -> voteRepository.save(new Vote(formData.getFirst(\"team\"))))\r\n        .map(vote -> String.format(\r\n            \"Vote successfully cast for '%s' at time %s!%n\", vote.candidate, vote.timeCast));\r\n```", "bodyText": "I think it'd be simpler if you left the .map unnested from the .flatmap, like this:\nreturn serverWebExchange.getFormData()\n        .flatMap(formData -> voteRepository.save(new Vote(formData.getFirst(\"team\"))))\n        .map(vote -> String.format(\n            \"Vote successfully cast for '%s' at time %s!%n\", vote.candidate, vote.timeCast));", "bodyHTML": "<p dir=\"auto\">I think it'd be simpler if you left the <code>.map</code> unnested from the <code>.flatmap</code>, like this:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"return serverWebExchange.getFormData()\n        .flatMap(formData -&gt; voteRepository.save(new Vote(formData.getFirst(&quot;team&quot;))))\n        .map(vote -&gt; String.format(\n            &quot;Vote successfully cast for '%s' at time %s!%n&quot;, vote.candidate, vote.timeCast));\"><pre><code>return serverWebExchange.getFormData()\n        .flatMap(formData -&gt; voteRepository.save(new Vote(formData.getFirst(\"team\"))))\n        .map(vote -&gt; String.format(\n            \"Vote successfully cast for '%s' at time %s!%n\", vote.candidate, vote.timeCast));\n</code></pre></div>", "author": "dzou", "createdAt": "2020-09-22T20:16:27Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/VoteController.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.cloudsql.r2dbcsample;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import org.springframework.web.server.ServerWebExchange;\n+import reactor.core.publisher.Mono;\n+\n+@RestController\n+public class VoteController {\n+  @Autowired\n+  VoteRepository voteRepository;\n+\n+  @PostMapping(\"/vote\")\n+  public Mono<String> vote(ServerWebExchange serverWebExchange) {\n+    return serverWebExchange.getFormData()\n+        .flatMap(formData ->", "originalCommit": "964cabd4d410250aba1363592d4c49dc2d1ad289", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcyNDYwMg==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r493724602", "bodyText": "addressed", "author": "dmitry-s", "createdAt": "2020-09-23T16:21:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAwNjk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE0OTc0Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r493149747", "body": "Does this class need to be mentioned in the README?\r\nYou don't talk about creating the schema there.", "bodyText": "Does this class need to be mentioned in the README?\nYou don't talk about creating the schema there.", "bodyHTML": "<p dir=\"auto\">Does this class need to be mentioned in the README?<br>\nYou don't talk about creating the schema there.</p>", "author": "meltsufin", "createdAt": "2020-09-23T02:07:44Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/CommanLineRunnerSchemaCreator.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.cloudsql.r2dbcsample;\n+\n+import io.r2dbc.spi.ConnectionFactory;\n+import java.util.Arrays;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.CommandLineRunner;\n+import org.springframework.data.r2dbc.core.DatabaseClient;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class CommanLineRunnerSchemaCreator implements CommandLineRunner {", "originalCommit": "964cabd4d410250aba1363592d4c49dc2d1ad289", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzMDA5OA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r493630098", "bodyText": "@meltsufin It creates schema automatically when the app starts. Could you clarify why you think it should be mentioned in the readme?", "author": "dmitry-s", "createdAt": "2020-09-23T14:17:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE0OTc0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4NjAyOA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r493686028", "bodyText": "I see. I guess you can mention that the schema for the vote table will be automatically created the first time you run the sample.", "author": "meltsufin", "createdAt": "2020-09-23T15:27:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzE0OTc0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4Nzk4MA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r493687980", "body": "```suggestion\r\n    logger.info(\"Executed DDL: \" + schema);\r\n```\r\nAt this point it would have run. I actually thought it was hanging because that was the last message in the log when I ran it.", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                logger.info(\"Running DDL: \" + schema);\n          \n          \n            \n                logger.info(\"Executed DDL: \" + schema);\n          \n      \n    \n    \n  \n\nAt this point it would have run. I actually thought it was hanging because that was the last message in the log when I ran it.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    logger<span class=\"pl-k\">.</span>info(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">Running</span> DDL: <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> schema);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    logger<span class=\"pl-k\">.</span>info(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">Executed</span> DDL: <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> schema);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">At this point it would have run. I actually thought it was hanging because that was the last message in the log when I ran it.</p>", "author": "meltsufin", "createdAt": "2020-09-23T15:30:11Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/CommanLineRunnerSchemaCreator.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.cloudsql.r2dbcsample;\n+\n+import io.r2dbc.spi.ConnectionFactory;\n+import java.util.Arrays;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.CommandLineRunner;\n+import org.springframework.data.r2dbc.core.DatabaseClient;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class CommanLineRunnerSchemaCreator implements CommandLineRunner {\n+  private static final Logger logger = LoggerFactory.getLogger(CommanLineRunnerSchemaCreator.class);\n+\n+  @Autowired\n+  ConnectionFactory connectionFactory;\n+\n+  @Override\n+  public void run(String...args) {\n+    runDdl(\"CREATE TABLE IF NOT EXISTS vote ( \"\n+        + \"vote_id SERIAL NOT NULL, \"\n+        + \"time_cast timestamp NOT NULL, \"\n+        + \"candidate CHAR(6) NOT NULL, \"\n+        + \"PRIMARY KEY (vote_id) );\");\n+  }\n+\n+  private void runDdl(String schema) {\n+    DatabaseClient client = DatabaseClient.create(connectionFactory);\n+\n+    client.execute(schema)\n+\t\t\t\t.fetch()\n+\t\t\t\t.rowsUpdated()\n+\t\t\t\t.block();\n+\n+    logger.info(\"Running DDL: \" + schema);", "originalCommit": "964cabd4d410250aba1363592d4c49dc2d1ad289", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "38061e198bde262bc70b1e6b1bd3f91f4c8f7071", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/38061e198bde262bc70b1e6b1bd3f91f4c8f7071", "message": "Apply suggestions from code review\n\nCo-authored-by: Daniel Zou <dzou@users.noreply.github.com>\nCo-authored-by: Mike Eltsufin <meltsufin@google.com>", "committedDate": "2020-09-23T16:15:50Z", "type": "commit"}, {"oid": "9163deb814f1c599c46e9b1f0ed43207f3f56b2a", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/9163deb814f1c599c46e9b1f0ed43207f3f56b2a", "message": "PR comments", "committedDate": "2020-09-23T21:02:12Z", "type": "commit"}, {"oid": "de9785cde09c97194581d91f441f7392e735bd71", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/de9785cde09c97194581d91f441f7392e735bd71", "message": "PR comments", "committedDate": "2020-09-23T21:06:04Z", "type": "commit"}, {"oid": "6c0e7d25394efde4934070e63f192f7f75fec28f", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/6c0e7d25394efde4934070e63f192f7f75fec28f", "message": "checkstyle", "committedDate": "2020-09-23T22:20:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxMTI3MQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r495311271", "body": "We've been doing separate samples for each DB engine  because the SQL syntax can vary. This might not matter much between MySQL/Postgres, but for SQL Server, this command wouldn't work. We might want to split into separate samples for Postgres/MySQL for that reason.", "bodyText": "We've been doing separate samples for each DB engine  because the SQL syntax can vary. This might not matter much between MySQL/Postgres, but for SQL Server, this command wouldn't work. We might want to split into separate samples for Postgres/MySQL for that reason.", "bodyHTML": "<p dir=\"auto\">We've been doing separate samples for each DB engine  because the SQL syntax can vary. This might not matter much between MySQL/Postgres, but for SQL Server, this command wouldn't work. We might want to split into separate samples for Postgres/MySQL for that reason.</p>", "author": "shubha-rajan", "createdAt": "2020-09-25T23:17:15Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/CommandLineRunnerSchemaCreator.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.cloudsql.r2dbcsample;\n+\n+import io.r2dbc.spi.ConnectionFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.CommandLineRunner;\n+import org.springframework.data.r2dbc.core.DatabaseClient;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class CommandLineRunnerSchemaCreator implements CommandLineRunner {\n+\n+  private static final Logger LOGGER =\n+      LoggerFactory.getLogger(CommandLineRunnerSchemaCreator.class);\n+\n+  @Autowired\n+  private ConnectionFactory connectionFactory;\n+\n+  @Override\n+  public void run(String... args) {\n+    runDdl(\"CREATE TABLE IF NOT EXISTS vote ( \"\n+        + \"vote_id SERIAL NOT NULL, \"\n+        + \"time_cast timestamp NOT NULL, \"\n+        + \"candidate CHAR(6) NOT NULL, \"\n+        + \"PRIMARY KEY (vote_id) );\");\n+  }", "originalCommit": "6c0e7d25394efde4934070e63f192f7f75fec28f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU0MjgxMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r498542813", "bodyText": "@shubha-rajan\nI would prefer to avoid code duplication, since this is the only thing that would be different. I think we could make it a variable and let users pass it to the application or put it into a config. What do you think?", "author": "dmitry-s", "createdAt": "2020-10-01T22:27:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxMTI3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU3NTUxNA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r503575514", "bodyText": "We can handle this on our end, but the samples will need to be separated out at some point if we want to link to these from Cloud Docs.", "author": "kurtisvg", "createdAt": "2020-10-12T22:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxMTI3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxNjIxMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r495316213", "body": "Can we configure the application to use a connection pool when creating the connection factory? We recommend connection pooling as a best practice in our docs. The [spring-data docs](https://docs.spring.io/spring-data/r2dbc/docs/current-SNAPSHOT/reference/html/#r2dbc.connections.connectionfactory) call out [`r2dbc-pool`](https://github.com/r2dbc/r2dbc-pool) as a popular option", "bodyText": "Can we configure the application to use a connection pool when creating the connection factory? We recommend connection pooling as a best practice in our docs. The spring-data docs call out r2dbc-pool as a popular option", "bodyHTML": "<p dir=\"auto\">Can we configure the application to use a connection pool when creating the connection factory? We recommend connection pooling as a best practice in our docs. The <a href=\"https://docs.spring.io/spring-data/r2dbc/docs/current-SNAPSHOT/reference/html/#r2dbc.connections.connectionfactory\" rel=\"nofollow\">spring-data docs</a> call out <a href=\"https://github.com/r2dbc/r2dbc-pool\"><code>r2dbc-pool</code></a> as a popular option</p>", "author": "shubha-rajan", "createdAt": "2020-09-25T23:29:22Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/R2dbcSampleApplication.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.cloudsql.r2dbcsample;\n+\n+import io.r2dbc.spi.ConnectionFactories;\n+import io.r2dbc.spi.ConnectionFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.SpringApplication;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.data.r2dbc.config.AbstractR2dbcConfiguration;\n+import org.springframework.data.r2dbc.repository.config.EnableR2dbcRepositories;\n+\n+@SpringBootApplication\n+@Configuration\n+@EnableR2dbcRepositories\n+public class R2dbcSampleApplication extends AbstractR2dbcConfiguration {\n+\n+  @Value(\"${connectionString}\")\n+  private String connectionString;\n+\n+  public static void main(String[] args) {\n+    SpringApplication.run(R2dbcSampleApplication.class, args);\n+  }\n+\n+  @Override\n+  @Bean\n+  public ConnectionFactory connectionFactory() {\n+    return ConnectionFactories.get(connectionString);", "originalCommit": "6c0e7d25394efde4934070e63f192f7f75fec28f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzODgzNA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r498938834", "bodyText": "done", "author": "dmitry-s", "createdAt": "2020-10-02T16:56:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTMxNjIxMw=="}], "type": "inlineReview"}, {"oid": "34cdb908e5683fa00d12005ba26e33f84a99dbd3", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/34cdb908e5683fa00d12005ba26e33f84a99dbd3", "message": "Apply suggestions from code review\n\nCo-authored-by: Shubha Rajan <shubhadayini@google.com>\nCo-authored-by: Kurtis Van Gent <31518063+kurtisvg@users.noreply.github.com>", "committedDate": "2020-09-28T22:30:40Z", "type": "commit"}, {"oid": "c7220351bd51e0a6041f4e1b5b32d99b923bd567", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/c7220351bd51e0a6041f4e1b5b32d99b923bd567", "message": "PR comments", "committedDate": "2020-10-01T22:23:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyNzAxNw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r499827017", "body": "Can you include an example of what the connection string format would look like in a comment here? That way, users looking at this code snippet through a cloud documentation page would be able to see it without having to look at the code on GitHub.", "bodyText": "Can you include an example of what the connection string format would look like in a comment here? That way, users looking at this code snippet through a cloud documentation page would be able to see it without having to look at the code on GitHub.", "bodyHTML": "<p dir=\"auto\">Can you include an example of what the connection string format would look like in a comment here? That way, users looking at this code snippet through a cloud documentation page would be able to see it without having to look at the code on GitHub.</p>", "author": "shubha-rajan", "createdAt": "2020-10-05T19:37:24Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/R2dbcSampleApplication.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.cloudsql.r2dbcsample;\n+\n+import io.r2dbc.spi.ConnectionFactories;\n+import io.r2dbc.spi.ConnectionFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.SpringApplication;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.data.r2dbc.config.AbstractR2dbcConfiguration;\n+import org.springframework.data.r2dbc.repository.config.EnableR2dbcRepositories;\n+\n+@SpringBootApplication\n+@Configuration\n+@EnableR2dbcRepositories\n+public class R2dbcSampleApplication extends AbstractR2dbcConfiguration {\n+\n+  @Value(\"${connectionString}\")\n+  private String connectionString;\n+\n+  public static void main(String[] args) {\n+    SpringApplication.run(R2dbcSampleApplication.class, args);\n+  }\n+\n+  @Override\n+  @Bean\n+  public ConnectionFactory connectionFactory() {\n+    return ConnectionFactories.get(connectionString);", "originalCommit": "c7220351bd51e0a6041f4e1b5b32d99b923bd567", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk0OTA3Ng==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r499949076", "bodyText": "added an example", "author": "dmitry-s", "createdAt": "2020-10-06T00:55:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyNzAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyODM5OQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r499828399", "body": "Can you also include examples of how to configure attributes like size, timeouts, and number of idle connections for the pool?", "bodyText": "Can you also include examples of how to configure attributes like size, timeouts, and number of idle connections for the pool?", "bodyHTML": "<p dir=\"auto\">Can you also include examples of how to configure attributes like size, timeouts, and number of idle connections for the pool?</p>", "author": "shubha-rajan", "createdAt": "2020-10-05T19:40:12Z", "path": "cloud-sql/r2dbc/src/main/java/com/example/cloudsql/r2dbcsample/R2dbcSampleApplication.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.cloudsql.r2dbcsample;\n+\n+import io.r2dbc.spi.ConnectionFactories;\n+import io.r2dbc.spi.ConnectionFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.SpringApplication;\n+import org.springframework.boot.autoconfigure.SpringBootApplication;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.data.r2dbc.config.AbstractR2dbcConfiguration;\n+import org.springframework.data.r2dbc.repository.config.EnableR2dbcRepositories;\n+\n+@SpringBootApplication\n+@Configuration\n+@EnableR2dbcRepositories\n+public class R2dbcSampleApplication extends AbstractR2dbcConfiguration {\n+\n+  @Value(\"${connectionString}\")\n+  private String connectionString;\n+\n+  public static void main(String[] args) {\n+    SpringApplication.run(R2dbcSampleApplication.class, args);\n+  }\n+\n+  @Override\n+  @Bean\n+  public ConnectionFactory connectionFactory() {\n+    return ConnectionFactories.get(connectionString);", "originalCommit": "c7220351bd51e0a6041f4e1b5b32d99b923bd567", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk0ODk2Ng==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/3784#discussion_r499948966", "bodyText": "added a paragraph to the README", "author": "dmitry-s", "createdAt": "2020-10-06T00:54:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyODM5OQ=="}], "type": "inlineReview"}, {"oid": "0057767bf95bb30d08c5487ba650b02d2d81a18a", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/0057767bf95bb30d08c5487ba650b02d2d81a18a", "message": "PR comments", "committedDate": "2020-10-06T00:44:25Z", "type": "commit"}, {"oid": "38e6a1e975ae8fd4c69cb3ebeb4525c25d1f00c9", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/38e6a1e975ae8fd4c69cb3ebeb4525c25d1f00c9", "message": "PR comments", "committedDate": "2020-10-06T00:52:29Z", "type": "commit"}, {"oid": "7acc26a0c3936d8cef973d233fe762ba8d1bbde1", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7acc26a0c3936d8cef973d233fe762ba8d1bbde1", "message": "PR comments", "committedDate": "2020-10-06T14:15:34Z", "type": "commit"}, {"oid": "a6afce3b9492d33408ae94a8062c308c9a866e20", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/a6afce3b9492d33408ae94a8062c308c9a866e20", "message": "PR comments", "committedDate": "2020-10-19T14:24:58Z", "type": "commit"}]}