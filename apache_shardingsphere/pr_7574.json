{"pr_number": 7574, "pr_title": "Refactor change YamlRuleSchemaMetaData same with  RuleSchemaMetaData", "pr_author": "xbkaishui", "pr_createdAt": "2020-09-23T05:30:55Z", "pr_url": "https://github.com/apache/shardingsphere/pull/7574", "timeline": [{"oid": "dccb7e49142cf85dbe1cdc4655c397a8604e58fd", "url": "https://github.com/apache/shardingsphere/commit/dccb7e49142cf85dbe1cdc4655c397a8604e58fd", "message": "refactor change YamlRuleSchemaMetaData same with  RuleSchemaMetaData", "committedDate": "2020-09-23T05:29:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzMjc5Nw==", "url": "https://github.com/apache/shardingsphere/pull/7574#discussion_r493332797", "body": "This PR looks great. However, I found another issue relevant to what you modified. \r\n\r\n```java\r\n// CreateTableStatementMetaDataRefreshStrategy\r\n\r\nprivate void refreshUnconfiguredMetaData(final ShardingSphereMetaData metaData, \r\n                                             final DatabaseType databaseType, final Map<String, DataSource> dataSourceMap, final String tableName) throws SQLException {\r\n        for (Entry<String, DataSource> entry : dataSourceMap.entrySet()) {\r\n            Optional<TableMetaData> tableMetaData = TableMetaDataLoader.loadWithoutColumnMetaData(entry.getValue(), tableName, databaseType.getName());\r\n            if (tableMetaData.isPresent()) {\r\n                refreshUnconfiguredMetaData(metaData, tableName, entry.getKey());\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n```\r\n`loadWithoutColumnMetaData` is supposed to be simplified, IMO. What do you think?", "bodyText": "This PR looks great. However, I found another issue relevant to what you modified.\n// CreateTableStatementMetaDataRefreshStrategy\n\nprivate void refreshUnconfiguredMetaData(final ShardingSphereMetaData metaData, \n                                             final DatabaseType databaseType, final Map<String, DataSource> dataSourceMap, final String tableName) throws SQLException {\n        for (Entry<String, DataSource> entry : dataSourceMap.entrySet()) {\n            Optional<TableMetaData> tableMetaData = TableMetaDataLoader.loadWithoutColumnMetaData(entry.getValue(), tableName, databaseType.getName());\n            if (tableMetaData.isPresent()) {\n                refreshUnconfiguredMetaData(metaData, tableName, entry.getKey());\n                return;\n            }\n        }\n    }\n\nloadWithoutColumnMetaData is supposed to be simplified, IMO. What do you think?", "bodyHTML": "<p dir=\"auto\">This PR looks great. However, I found another issue relevant to what you modified.</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"// CreateTableStatementMetaDataRefreshStrategy\n\nprivate void refreshUnconfiguredMetaData(final ShardingSphereMetaData metaData, \n                                             final DatabaseType databaseType, final Map&lt;String, DataSource&gt; dataSourceMap, final String tableName) throws SQLException {\n        for (Entry&lt;String, DataSource&gt; entry : dataSourceMap.entrySet()) {\n            Optional&lt;TableMetaData&gt; tableMetaData = TableMetaDataLoader.loadWithoutColumnMetaData(entry.getValue(), tableName, databaseType.getName());\n            if (tableMetaData.isPresent()) {\n                refreshUnconfiguredMetaData(metaData, tableName, entry.getKey());\n                return;\n            }\n        }\n    }\n\n\"><pre><span class=\"pl-c\"><span class=\"pl-c\">//</span> CreateTableStatementMetaDataRefreshStrategy</span>\n\n<span class=\"pl-k\">private</span> <span class=\"pl-k\">void</span> refreshUnconfiguredMetaData(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">ShardingSphereMetaData</span> metaData, \n                                             <span class=\"pl-k\">final</span> <span class=\"pl-smi\">DatabaseType</span> databaseType, <span class=\"pl-k\">final</span> <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">DataSource</span>&gt;</span> dataSourceMap, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> tableName) throws <span class=\"pl-smi\">SQLException</span> {\n        <span class=\"pl-k\">for</span> (<span class=\"pl-k\">Entry&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">DataSource</span>&gt;</span> entry <span class=\"pl-k\">:</span> dataSourceMap<span class=\"pl-k\">.</span>entrySet()) {\n            <span class=\"pl-k\">Optional&lt;<span class=\"pl-smi\">TableMetaData</span>&gt;</span> tableMetaData <span class=\"pl-k\">=</span> <span class=\"pl-smi\">TableMetaDataLoader</span><span class=\"pl-k\">.</span>loadWithoutColumnMetaData(entry<span class=\"pl-k\">.</span>getValue(), tableName, databaseType<span class=\"pl-k\">.</span>getName());\n            <span class=\"pl-k\">if</span> (tableMetaData<span class=\"pl-k\">.</span>isPresent()) {\n                refreshUnconfiguredMetaData(metaData, tableName, entry<span class=\"pl-k\">.</span>getKey());\n                <span class=\"pl-k\">return</span>;\n            }\n        }\n    }\n</pre></div>\n<p dir=\"auto\"><code>loadWithoutColumnMetaData</code> is supposed to be simplified, IMO. What do you think?</p>", "author": "tristaZero", "createdAt": "2020-09-23T08:54:16Z", "path": "shardingsphere-governance/shardingsphere-governance-core/shardingsphere-governance-core-common/src/main/java/org/apache/shardingsphere/governance/core/yaml/config/metadata/YamlRuleSchemaMetaData.java", "diffHunk": "@@ -32,5 +33,5 @@\n \n     private YamlSchemaMetaData configuredSchemaMetaData;\n \n-    private Map<String, YamlSchemaMetaData> unconfiguredSchemaMetaDataMap;\n+    private Map<String, Collection<String>> unconfiguredSchemaMetaDataMap;", "originalCommit": "dccb7e49142cf85dbe1cdc4655c397a8604e58fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM3NDcxMQ==", "url": "https://github.com/apache/shardingsphere/pull/7574#discussion_r493374711", "bodyText": "done", "author": "xbkaishui", "createdAt": "2020-09-23T09:36:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzMjc5Nw=="}], "type": "inlineReview"}, {"oid": "539ba4095af1e26ff9433427f1846248909a7ec9", "url": "https://github.com/apache/shardingsphere/commit/539ba4095af1e26ff9433427f1846248909a7ec9", "message": "change for cr", "committedDate": "2020-09-23T09:36:01Z", "type": "commit"}, {"oid": "2a458b17a8a23cf8ce1c1231edecccd0fff64bc9", "url": "https://github.com/apache/shardingsphere/commit/2a458b17a8a23cf8ce1c1231edecccd0fff64bc9", "message": "add test of default constructor", "committedDate": "2020-09-24T00:09:50Z", "type": "commit"}, {"oid": "948480d16c0f78e9557a0247ff51f3adaa39260f", "url": "https://github.com/apache/shardingsphere/commit/948480d16c0f78e9557a0247ff51f3adaa39260f", "message": "Merge branch 'master' into dev", "committedDate": "2020-09-24T02:58:56Z", "type": "commit"}]}