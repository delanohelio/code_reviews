{"pr_number": 2647, "pr_title": "[ISSUE #2618]modify config service md5 generation method", "pr_author": "wangweizZZ", "pr_createdAt": "2020-04-18T09:05:06Z", "pr_url": "https://github.com/alibaba/nacos/pull/2647", "timeline": [{"oid": "bb70dcba98aa034fb130ef7542fc6f31d6fc47d0", "url": "https://github.com/alibaba/nacos/commit/bb70dcba98aa034fb130ef7542fc6f31d6fc47d0", "message": "[ISSUE#2618]modify server md5 generation method", "committedDate": "2020-04-18T08:37:48Z", "type": "commit"}, {"oid": "aeb14910e753a9ebe0e5124b417d1d0443817120", "url": "https://github.com/alibaba/nacos/commit/aeb14910e753a9ebe0e5124b417d1d0443817120", "message": "unify the MD5 generation on both sides by MD5 utility classes in the common module", "committedDate": "2020-04-19T10:42:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxNDU0MA==", "url": "https://github.com/alibaba/nacos/pull/2647#discussion_r410914540", "body": "The utility class is already at the end of Utils", "bodyText": "The utility class is already at the end of Utils", "bodyHTML": "<p dir=\"auto\">The utility class is already at the end of Utils</p>", "author": "chuntaojun", "createdAt": "2020-04-19T14:11:20Z", "path": "common/src/main/java/com/alibaba/nacos/common/utils/MD5.java", "diffHunk": "@@ -13,7 +13,7 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package com.alibaba.nacos.client.config.utils;", "originalCommit": "aeb14910e753a9ebe0e5124b417d1d0443817120", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkyNDgwOQ==", "url": "https://github.com/alibaba/nacos/pull/2647#discussion_r410924809", "bodyText": "sorry,I don't understand what you mean. the utility class is move from client module to common module. do you mean  name  should like MD5Utils  end with Utils?", "author": "wangweizZZ", "createdAt": "2020-04-19T15:06:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxNDU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkzNjc0NQ==", "url": "https://github.com/alibaba/nacos/pull/2647#discussion_r410936745", "bodyText": "yes", "author": "chuntaojun", "createdAt": "2020-04-19T16:05:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxNDU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAyOTQzNw==", "url": "https://github.com/alibaba/nacos/pull/2647#discussion_r411029437", "body": "I think the MD5 implementation will not be as good as the MD5Utils you delete because of the locking mechanism, you can only modify the string method of MD5Utils\r\n\r\nold\r\n\r\n```\r\nreturn new BigInteger(1, messageDigest.digest(bytes)).toString(HEX_VALUE_COUNT);\r\n```\r\n\r\nnew\r\n\r\n```java\r\npublic String bytes2string(byte[] bt) {\r\n        int l = bt.length;\r\n\r\n        char[] out = new char[l << 1];\r\n\r\n        for (int i = 0, j = 0; i < l; i++) {\r\n            out[j++] = digits[(0xF0 & bt[i]) >>> 4];\r\n            out[j++] = digits[0x0F & bt[i]];\r\n        }\r\n\r\n        return new String(out);\r\n    }\r\n```", "bodyText": "I think the MD5 implementation will not be as good as the MD5Utils you delete because of the locking mechanism, you can only modify the string method of MD5Utils\nold\nreturn new BigInteger(1, messageDigest.digest(bytes)).toString(HEX_VALUE_COUNT);\n\nnew\npublic String bytes2string(byte[] bt) {\n        int l = bt.length;\n\n        char[] out = new char[l << 1];\n\n        for (int i = 0, j = 0; i < l; i++) {\n            out[j++] = digits[(0xF0 & bt[i]) >>> 4];\n            out[j++] = digits[0x0F & bt[i]];\n        }\n\n        return new String(out);\n    }", "bodyHTML": "<p dir=\"auto\">I think the MD5 implementation will not be as good as the MD5Utils you delete because of the locking mechanism, you can only modify the string method of MD5Utils</p>\n<p dir=\"auto\">old</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"return new BigInteger(1, messageDigest.digest(bytes)).toString(HEX_VALUE_COUNT);\n\"><pre><code>return new BigInteger(1, messageDigest.digest(bytes)).toString(HEX_VALUE_COUNT);\n</code></pre></div>\n<p dir=\"auto\">new</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"public String bytes2string(byte[] bt) {\n        int l = bt.length;\n\n        char[] out = new char[l &lt;&lt; 1];\n\n        for (int i = 0, j = 0; i &lt; l; i++) {\n            out[j++] = digits[(0xF0 &amp; bt[i]) &gt;&gt;&gt; 4];\n            out[j++] = digits[0x0F &amp; bt[i]];\n        }\n\n        return new String(out);\n    }\n\"><pre><span class=\"pl-k\">public</span> <span class=\"pl-smi\">String</span> bytes2string(<span class=\"pl-k\">byte</span>[] bt) {\n        <span class=\"pl-k\">int</span> l <span class=\"pl-k\">=</span> bt<span class=\"pl-k\">.</span>length;\n\n        <span class=\"pl-k\">char</span>[] out <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">char</span>[l <span class=\"pl-k\">&lt;&lt;</span> <span class=\"pl-c1\">1</span>];\n\n        <span class=\"pl-k\">for</span> (<span class=\"pl-k\">int</span> i <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>, j <span class=\"pl-k\">=</span> <span class=\"pl-c1\">0</span>; i <span class=\"pl-k\">&lt;</span> l; i<span class=\"pl-k\">++</span>) {\n            out[j<span class=\"pl-k\">++</span>] <span class=\"pl-k\">=</span> digits[(<span class=\"pl-c1\">0xF0</span> <span class=\"pl-k\">&amp;</span> bt[i]) <span class=\"pl-k\">&gt;&gt;&gt;</span> <span class=\"pl-c1\">4</span>];\n            out[j<span class=\"pl-k\">++</span>] <span class=\"pl-k\">=</span> digits[<span class=\"pl-c1\">0x0F</span> <span class=\"pl-k\">&amp;</span> bt[i]];\n        }\n\n        <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">String</span>(out);\n    }</pre></div>", "author": "chuntaojun", "createdAt": "2020-04-20T00:41:44Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/aspect/RequestLogAspect.java", "diffHunk": "@@ -67,7 +66,7 @@\n     public Object interfacePublishSingle(ProceedingJoinPoint pjp, HttpServletRequest request,\n                                          HttpServletResponse response, String dataId, String group, String tenant,\n                                          String content) throws Throwable {\n-        final String md5 = content == null ? null : Md5Utils.getMD5(content, Constants.ENCODE);\n+        final String md5 = content == null ? null : MD5.getInstance().getMD5String(content);", "originalCommit": "aeb14910e753a9ebe0e5124b417d1d0443817120", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA0MDc4Mg==", "url": "https://github.com/alibaba/nacos/pull/2647#discussion_r411040782", "bodyText": "Thanks for your patient.I choose this one ,consider MessageDigest classes  is instantiated only once.", "author": "wangweizZZ", "createdAt": "2020-04-20T01:35:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAyOTQzNw=="}], "type": "inlineReview"}, {"oid": "dcdbaf50eab21eefd603e2ac2507b4a3c2d21fdb", "url": "https://github.com/alibaba/nacos/commit/dcdbaf50eab21eefd603e2ac2507b4a3c2d21fdb", "message": "use MD5Utils replace MD5", "committedDate": "2020-04-20T06:18:23Z", "type": "commit"}]}