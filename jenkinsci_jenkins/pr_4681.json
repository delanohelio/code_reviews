{"pr_number": 4681, "pr_title": "[JENKINS-62006] Move getChannelToMaster to a separate class", "pr_author": "Vlatombe", "pr_createdAt": "2020-04-22T10:59:59Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4681", "timeline": [{"oid": "85974f3ec5f22522861fe504e36dcd93e185c2dd", "url": "https://github.com/jenkinsci/jenkins/commit/85974f3ec5f22522861fe504e36dcd93e185c2dd", "message": "[JENKINS-62006] Move getChannelToMaster to a separate class\n\nThis should avoid classloading issues I've seen, such as\n\nCaused by: java.lang.NoClassDefFoundError:\njavax/servlet/ServletException\n  at hudson.util.ProcessTree.get(ProcessTree.java:432)\n...", "committedDate": "2020-04-22T10:58:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NDExOQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412884119", "body": "No new classes in `hudson.*` please.\r\n\r\nPlease also use `agent` instead of `slave` (both package and class name).", "bodyText": "No new classes in hudson.* please.\nPlease also use agent instead of slave (both package and class name).", "bodyHTML": "<p dir=\"auto\">No new classes in <code>hudson.*</code> please.</p>\n<p dir=\"auto\">Please also use <code>agent</code> instead of <code>slave</code> (both package and class name).</p>", "author": "daniel-beck", "createdAt": "2020-04-22T11:01:47Z", "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;", "originalCommit": "85974f3ec5f22522861fe504e36dcd93e185c2dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NDQzMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412884430", "body": "```suggestion\r\n     * @since TODO\r\n```\r\n\r\nper https://github.com/jenkinsci/jenkins/blob/3b85c0a877d97c4c8b5b24605974cce52223a4b0/update-since-todo.sh#L13", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @since XXX\n          \n          \n            \n                 * @since TODO\n          \n      \n    \n    \n  \n\nper \n  \n    \n      jenkins/update-since-todo.sh\n    \n    \n         Line 13\n      in\n      3b85c0a\n    \n    \n    \n    \n\n        \n          \n           for todo in $( git grep --line-number '@since TODO' | grep -v \"$me\" )", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@since</span> <span class=\"pl-c1 x x-first x-last\">XXX</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@since</span> <span class=\"pl-c1 x x-first x-last\">TODO</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">per <div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/jenkinsci/jenkins/blob/3b85c0a877d97c4c8b5b24605974cce52223a4b0/update-since-todo.sh#L13\">jenkins/update-since-todo.sh</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 13\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/jenkinsci/jenkins/commit/3b85c0a877d97c4c8b5b24605974cce52223a4b0\">3b85c0a</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L13\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"13\"></td>\n          <td id=\"LC13\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">for</span> <span class=\"pl-smi\">todo</span> <span class=\"pl-k\">in</span> <span class=\"pl-s\"><span class=\"pl-pds\">$(</span> git grep --line-number <span class=\"pl-s\"><span class=\"pl-pds\">'</span>@since TODO<span class=\"pl-pds\">'</span></span> <span class=\"pl-k\">|</span> grep -v <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-smi\">$me</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-pds\">)</span></span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "author": "daniel-beck", "createdAt": "2020-04-22T11:02:20Z", "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;\n+\n+import hudson.FilePath;\n+import hudson.remoting.Channel;\n+import hudson.remoting.VirtualChannel;\n+import jenkins.model.Jenkins;\n+\n+public final class SlaveComputerUtil {\n+    private SlaveComputerUtil() {}\n+    /**\n+     * Obtains a {@link VirtualChannel} that allows some computation to be performed on the master.\n+     * This method can be called from any thread on the master, or from agent (more precisely,\n+     * it only works from the remoting request-handling thread in agents, which means if you've started\n+     * separate thread on agents, that'll fail.)\n+     *\n+     * @return null if the calling thread doesn't have any trace of where its master is.\n+     * @since XXX", "originalCommit": "85974f3ec5f22522861fe504e36dcd93e185c2dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NTE1Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412885156", "body": "```suggestion\r\n        if (Jenkins.getInstanceOrNull() != null) { // check if calling thread is on master or on slave\r\n            return FilePath.localChannel;\r\n        }\r\n        // if this method is called from within the agent computation thread, this should work\r\n        Channel c = Channel.current();\r\n        if (c != null && Boolean.TRUE.equals(c.getProperty(\"slave\"))) {\r\n            return c;\r\n        }\r\n```\r\n\r\nFix the code formatting if you touch it.", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (Jenkins.getInstanceOrNull()!=null) // check if calling thread is on master or on slave\n          \n          \n            \n                        return FilePath.localChannel;\n          \n          \n            \n            \n          \n          \n            \n                    // if this method is called from within the agent computation thread, this should work\n          \n          \n            \n                    Channel c = Channel.current();\n          \n          \n            \n                    if (c!=null && Boolean.TRUE.equals(c.getProperty(\"slave\")))\n          \n          \n            \n                        return c;\n          \n          \n            \n                    if (Jenkins.getInstanceOrNull() != null) { // check if calling thread is on master or on slave\n          \n          \n            \n                        return FilePath.localChannel;\n          \n          \n            \n                    }\n          \n          \n            \n                    // if this method is called from within the agent computation thread, this should work\n          \n          \n            \n                    Channel c = Channel.current();\n          \n          \n            \n                    if (c != null && Boolean.TRUE.equals(c.getProperty(\"slave\"))) {\n          \n          \n            \n                        return c;\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nFix the code formatting if you touch it.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">Jenkins</span><span class=\"pl-k\">.</span>getInstanceOrNull()<span class=\"pl-k\">!=</span><span class=\"pl-c1\">null</span>) <span class=\"pl-c\"><span class=\"pl-c\">//</span> check if calling thread is on master or on slave</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">return</span> <span class=\"pl-smi\">FilePath</span><span class=\"pl-k\">.</span>localChannel;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> if this method is called from within the agent computation thread, this should work</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-smi\">Channel</span> c <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Channel</span><span class=\"pl-k\">.</span>current();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (c<span class=\"pl-k\">!=</span><span class=\"pl-c1\">null</span> <span class=\"pl-k\">&amp;&amp;</span> <span class=\"pl-smi\">Boolean</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>TRUE</span><span class=\"pl-k\">.</span>equals(c<span class=\"pl-k\">.</span>getProperty(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>slave<span class=\"pl-pds\">\"</span></span>)))</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">return</span> c;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">Jenkins</span><span class=\"pl-k\">.</span>getInstanceOrNull() <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">null</span>) { <span class=\"pl-c\"><span class=\"pl-c\">//</span> check if calling thread is on master or on slave</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">return</span> <span class=\"pl-smi\">FilePath</span><span class=\"pl-k\">.</span>localChannel;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> if this method is called from within the agent computation thread, this should work</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-smi\">Channel</span> c <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Channel</span><span class=\"pl-k\">.</span>current();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">if</span> (c <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">null</span> <span class=\"pl-k\">&amp;&amp;</span> <span class=\"pl-smi\">Boolean</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>TRUE</span><span class=\"pl-k\">.</span>equals(c<span class=\"pl-k\">.</span>getProperty(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>slave<span class=\"pl-pds\">\"</span></span>))) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">return</span> c;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">Fix the code formatting if you touch it.</p>", "author": "daniel-beck", "createdAt": "2020-04-22T11:03:34Z", "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;\n+\n+import hudson.FilePath;\n+import hudson.remoting.Channel;\n+import hudson.remoting.VirtualChannel;\n+import jenkins.model.Jenkins;\n+\n+public final class SlaveComputerUtil {\n+    private SlaveComputerUtil() {}\n+    /**\n+     * Obtains a {@link VirtualChannel} that allows some computation to be performed on the master.\n+     * This method can be called from any thread on the master, or from agent (more precisely,\n+     * it only works from the remoting request-handling thread in agents, which means if you've started\n+     * separate thread on agents, that'll fail.)\n+     *\n+     * @return null if the calling thread doesn't have any trace of where its master is.\n+     * @since XXX\n+     */\n+    public static VirtualChannel getChannelToMaster() {\n+        if (Jenkins.getInstanceOrNull()!=null) // check if calling thread is on master or on slave\n+            return FilePath.localChannel;\n+\n+        // if this method is called from within the agent computation thread, this should work\n+        Channel c = Channel.current();\n+        if (c!=null && Boolean.TRUE.equals(c.getProperty(\"slave\")))\n+            return c;\n+", "originalCommit": "85974f3ec5f22522861fe504e36dcd93e185c2dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4NTcwMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412885700", "body": "Also lacks license header.", "bodyText": "Also lacks license header.", "bodyHTML": "<p dir=\"auto\">Also lacks license header.</p>", "author": "daniel-beck", "createdAt": "2020-04-22T11:04:27Z", "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;", "originalCommit": "85974f3ec5f22522861fe504e36dcd93e185c2dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg5OTAxOA==", "url": "https://github.com/jenkinsci/jenkins/pull/4681#discussion_r412899018", "body": "```suggestion\r\n    @CheckForNull\r\n    public static VirtualChannel getChannelToMaster() {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static VirtualChannel getChannelToMaster() {\n          \n          \n            \n                @CheckForNull\n          \n          \n            \n                public static VirtualChannel getChannelToMaster() {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k x x-first\">public</span><span class=\"x\"> </span><span class=\"pl-k x\">static</span><span class=\"x\"> </span><span class=\"pl-smi x\">VirtualChannel</span><span class=\"x x-last\"> getChannelToMaster() {</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k x x-first x-last\">@CheckForNull</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">VirtualChannel</span> getChannelToMaster() {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "res0nance", "createdAt": "2020-04-22T11:27:28Z", "path": "core/src/main/java/hudson/slaves/SlaveComputerUtil.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package hudson.slaves;\n+\n+import hudson.FilePath;\n+import hudson.remoting.Channel;\n+import hudson.remoting.VirtualChannel;\n+import jenkins.model.Jenkins;\n+\n+public final class SlaveComputerUtil {\n+    private SlaveComputerUtil() {}\n+    /**\n+     * Obtains a {@link VirtualChannel} that allows some computation to be performed on the master.\n+     * This method can be called from any thread on the master, or from agent (more precisely,\n+     * it only works from the remoting request-handling thread in agents, which means if you've started\n+     * separate thread on agents, that'll fail.)\n+     *\n+     * @return null if the calling thread doesn't have any trace of where its master is.\n+     * @since XXX\n+     */\n+    public static VirtualChannel getChannelToMaster() {", "originalCommit": "85974f3ec5f22522861fe504e36dcd93e185c2dd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "25c8cb6be5f2c14082c0b5619c4136b3d0023816", "url": "https://github.com/jenkinsci/jenkins/commit/25c8cb6be5f2c14082c0b5619c4136b3d0023816", "message": "Fix reviews", "committedDate": "2020-04-22T11:51:20Z", "type": "commit"}]}