{"pr_number": 4673, "pr_title": "Add support for bearer tokens in Jenkins CLI", "pr_author": "sorend", "pr_createdAt": "2020-04-19T21:25:52Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4673", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMTU2Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413721566", "body": "Is it possible that the bearer token here is empty ? ", "bodyText": "Is it possible that the bearer token here is empty ?", "bodyHTML": "<p dir=\"auto\">Is it possible that the bearer token here is empty ?</p>", "author": "sladyn98", "createdAt": "2020-04-23T11:03:06Z", "path": "cli/src/main/java/hudson/cli/CLIConnectionFactory.java", "diffHunk": "@@ -36,4 +36,19 @@ public CLIConnectionFactory basicAuth(String userInfo) {\n         return authorization(\"Basic \" + Base64.getEncoder().encodeToString(userInfo.getBytes()));\n     }\n \n+    /**\n+     * Convenience method to call {@link #authorization} with the HTTP bearer authentication.\n+     * Cf. {@code BasicHeaderApiTokenAuthenticator}.\n+     */\n+    public CLIConnectionFactory bearerAuth(String bearerToken) {\n+        return authorization(\"Bearer \" + bearerToken);", "originalCommit": "df34c19eac41125ee65b7976cd4f496f7e2b39d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1MTQ3OA==", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413951478", "bodyText": "From my understanding of CLI class, it can be an empty string but not null -- follows the semantics of basicAuth", "author": "sorend", "createdAt": "2020-04-23T16:38:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMTU2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjIxNg==", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413722216", "body": "```suggestion\r\n    CLIConnectionFactory cliFactory;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                CLIConnectionFactory sut;\n          \n          \n            \n                CLIConnectionFactory cliFactory;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-smi\">CLIConnectionFactory</span> <span class=\"x x-first x-last\">sut</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-smi\">CLIConnectionFactory</span> <span class=\"x x-first x-last\">cliFactory</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "sladyn98", "createdAt": "2020-04-23T11:04:17Z", "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;", "originalCommit": "df34c19eac41125ee65b7976cd4f496f7e2b39d6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjUwMA==", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413722500", "body": "Would it be better if we also include  an Empty Bearer Token test ? ", "bodyText": "Would it be better if we also include  an Empty Bearer Token test ?", "bodyHTML": "<p dir=\"auto\">Would it be better if we also include  an Empty Bearer Token test ?</p>", "author": "sladyn98", "createdAt": "2020-04-23T11:04:50Z", "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory sut;\n+\n+    @BeforeEach\n+    void setUp() {\n+        sut = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", sut.of(\"some-token\").authorization);\n+    }\n+", "originalCommit": "df34c19eac41125ee65b7976cd4f496f7e2b39d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk1MjM2NA==", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r413952364", "bodyText": "I can add the test, but the cli will behave in the same was as if empty auth is passed to basicAuth, semantics are the same. Suggest not to implement test, but open to your suggestion :-)", "author": "sorend", "createdAt": "2020-04-23T16:39:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkyNjk0OA==", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418926948", "bodyText": "Okay, I do not have a deep understanding of basicAuth here, if I understand correctly if empty token is passed it will be handled normally and therefore we do not need to test it. Might need some additional review\nCC @daniel-beck", "author": "sladyn98", "createdAt": "2020-05-02T07:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyMjUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg4MDM2Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r417880367", "body": "This is not empty when the test name suggests so?", "bodyText": "This is not empty when the test name suggests so?", "bodyHTML": "<p dir=\"auto\">This is not empty when the test name suggests so?</p>", "author": "varyvol", "createdAt": "2020-04-30T09:32:45Z", "path": "cli/src/test/java/hudson/cli/CLIConnectionFactoryTest.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package hudson.cli;\n+\n+import org.junit.Assert;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+class CLIConnectionFactoryTest {\n+\n+    CLIConnectionFactory cliFactory;\n+\n+    @BeforeEach\n+    void setUp() {\n+        cliFactory = new CLIConnectionFactory();\n+    }\n+\n+    @Test\n+    void testBearerFromToken() {\n+        Assert.assertEquals(\"Bearer some-token\", cliFactory.of(\"some-token\").authorization);\n+    }\n+\n+    @Test\n+    void testBearerFromEmptyToken() {\n+        Assert.assertEquals(\"Bearer some-token\", cliFactory.of(\"some-token\").authorization);", "originalCommit": "1ecafd520a7df7c7b0e0cd8c2f5fa0faaf08c42a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyOTIzMw==", "url": "https://github.com/jenkinsci/jenkins/pull/4673#discussion_r418529233", "bodyText": "Sorry a missing cleanup.", "author": "sorend", "createdAt": "2020-05-01T12:55:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzg4MDM2Nw=="}], "type": "inlineReview"}, {"oid": "eef34bb1e99cbc48551c1ff7a620e9a0836d1490", "url": "https://github.com/jenkinsci/jenkins/commit/eef34bb1e99cbc48551c1ff7a620e9a0836d1490", "message": "added -bearer argument to jenkins-cli", "committedDate": "2020-05-21T18:11:39Z", "type": "commit"}, {"oid": "eef34bb1e99cbc48551c1ff7a620e9a0836d1490", "url": "https://github.com/jenkinsci/jenkins/commit/eef34bb1e99cbc48551c1ff7a620e9a0836d1490", "message": "added -bearer argument to jenkins-cli", "committedDate": "2020-05-21T18:11:39Z", "type": "forcePushed"}, {"oid": "81412e2c648d9c6eaa5a5be2ae845d1b1ba728cb", "url": "https://github.com/jenkinsci/jenkins/commit/81412e2c648d9c6eaa5a5be2ae845d1b1ba728cb", "message": "updated message related to bearer/auth. added warning when both are used anyway.", "committedDate": "2020-05-22T06:04:06Z", "type": "commit"}]}