{"pr_number": 4546, "pr_title": "Manage Jenkins with flow layout and categories", "pr_author": "daniel-beck", "pr_createdAt": "2020-03-05T18:33:13Z", "pr_url": "https://github.com/jenkinsci/jenkins/pull/4546", "timeline": [{"oid": "61dfeaf113eaa3c8d475f2d90b2263f650f32eaa", "url": "https://github.com/jenkinsci/jenkins/commit/61dfeaf113eaa3c8d475f2d90b2263f650f32eaa", "message": "Manage Jenkins with flow layout and categories\n\nCo-authored-by: F\u00e9lix Queiruga <fqueiruga@cloudbees.com>", "committedDate": "2020-03-05T18:31:26Z", "type": "commit"}, {"oid": "5c8165285ec0fe352da6c71acda1321e8d9f08b8", "url": "https://github.com/jenkinsci/jenkins/commit/5c8165285ec0fe352da6c71acda1321e8d9f08b8", "message": "Adapt XPath to handle additional classes in HTML", "committedDate": "2020-03-05T21:18:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1NjAyOQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388556029", "body": "allowing older plugins to do this means we loose the possibility of using an enum for ever.\r\n\r\nhow about a protected method getCategoryString() that subclasses can implement that returns the string and this method calls that, or document some reflection in this javadoc that they can use?\r\n\r\n```java\r\n/**\r\n * @deprecated only use this if you want to defined a category for a managementLink and not depend on a newer core.\r\n */\r\nprotected String getCategoryString() {\r\n  return Category.UNCATEGORIZED.toString();\r\n}\r\n\r\npublic @nonnull String getCategory() {\r\n   try { \r\n       return Category.valueOf(getCategoryString());\r\n    } catch (IllegalArgumentException | NullPointerExcepton ex) {\r\n        Logger.log(Level.WARNING, \"invalid category {0} for class {1}\", new Object[]{getCategoryString() , this.getClass().getName()});\r\n    }\r\n        return Category.UNCATEGORIZED;\r\n}\r\n```\r\n\r\nor\r\n\r\n```java\r\n/**\r\n * Category for management link.\r\n * to define a category without depending on a newer core version use the following code.\r\n * {@code  /* left as an excersize if deemed this is a useful way forward */ }\r\n */\r\npublic @nonnull String getCategory() {\r\n   return Category.UNCATEGORIZED;;\r\n}\r\n```", "bodyText": "allowing older plugins to do this means we loose the possibility of using an enum for ever.\nhow about a protected method getCategoryString() that subclasses can implement that returns the string and this method calls that, or document some reflection in this javadoc that they can use?\n/**\n * @deprecated only use this if you want to defined a category for a managementLink and not depend on a newer core.\n */\nprotected String getCategoryString() {\n  return Category.UNCATEGORIZED.toString();\n}\n\npublic @nonnull String getCategory() {\n   try { \n       return Category.valueOf(getCategoryString());\n    } catch (IllegalArgumentException | NullPointerExcepton ex) {\n        Logger.log(Level.WARNING, \"invalid category {0} for class {1}\", new Object[]{getCategoryString() , this.getClass().getName()});\n    }\n        return Category.UNCATEGORIZED;\n}\nor\n/**\n * Category for management link.\n * to define a category without depending on a newer core version use the following code.\n * {@code  /* left as an excersize if deemed this is a useful way forward */ }\n */\npublic @nonnull String getCategory() {\n   return Category.UNCATEGORIZED;;\n}", "bodyHTML": "<p dir=\"auto\">allowing older plugins to do this means we loose the possibility of using an enum for ever.</p>\n<p dir=\"auto\">how about a protected method getCategoryString() that subclasses can implement that returns the string and this method calls that, or document some reflection in this javadoc that they can use?</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/**\n * @deprecated only use this if you want to defined a category for a managementLink and not depend on a newer core.\n */\nprotected String getCategoryString() {\n  return Category.UNCATEGORIZED.toString();\n}\n\npublic @nonnull String getCategory() {\n   try { \n       return Category.valueOf(getCategoryString());\n    } catch (IllegalArgumentException | NullPointerExcepton ex) {\n        Logger.log(Level.WARNING, &quot;invalid category {0} for class {1}&quot;, new Object[]{getCategoryString() , this.getClass().getName()});\n    }\n        return Category.UNCATEGORIZED;\n}\"><pre><span class=\"pl-c\"><span class=\"pl-c\">/**</span></span>\n<span class=\"pl-c\"> * <span class=\"pl-k\">@deprecated</span> only use this if you want to defined a category for a managementLink and not depend on a newer core.</span>\n<span class=\"pl-c\"> <span class=\"pl-c\">*/</span></span>\n<span class=\"pl-k\">protected</span> <span class=\"pl-smi\">String</span> getCategoryString() {\n  <span class=\"pl-k\">return</span> <span class=\"pl-smi\">Category</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>UNCATEGORIZED</span><span class=\"pl-k\">.</span>toString();\n}\n\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">@nonnull</span> <span class=\"pl-smi\">String</span> getCategory() {\n   <span class=\"pl-k\">try</span> { \n       <span class=\"pl-k\">return</span> <span class=\"pl-smi\">Category</span><span class=\"pl-k\">.</span>valueOf(getCategoryString());\n    } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">IllegalArgumentException</span> <span class=\"pl-k\">|</span> <span class=\"pl-smi\">NullPointerExcepton</span> ex) {\n        <span class=\"pl-smi\">Logger</span><span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>WARNING</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>invalid category {0} for class {1}<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">Object</span>[]{getCategoryString() , <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>getClass()<span class=\"pl-k\">.</span>getName()});\n    }\n        <span class=\"pl-k\">return</span> <span class=\"pl-smi\">Category</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>UNCATEGORIZED</span>;\n}</pre></div>\n<p dir=\"auto\">or</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/**\n * Category for management link.\n * to define a category without depending on a newer core version use the following code.\n * {@code  /* left as an excersize if deemed this is a useful way forward */ }\n */\npublic @nonnull String getCategory() {\n   return Category.UNCATEGORIZED;;\n}\"><pre><span class=\"pl-c\"><span class=\"pl-c\">/**</span></span>\n<span class=\"pl-c\"> * Category for management link.</span>\n<span class=\"pl-c\"> * to define a category without depending on a newer core version use the following code.</span>\n<span class=\"pl-c\"> * {<span class=\"pl-k\">@code</span><span class=\"pl-c1\">  /* left as an excersize if deemed this is a useful way forward */ </span>}</span>\n<span class=\"pl-c\"> <span class=\"pl-c\">*/</span></span>\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">@nonnull</span> <span class=\"pl-smi\">String</span> getCategory() {\n   <span class=\"pl-k\">return</span> <span class=\"pl-smi\">Category</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>UNCATEGORIZED</span>;;\n}</pre></div>", "author": "jtnord", "createdAt": "2020-03-05T20:47:31Z", "path": "core/src/main/java/hudson/model/ManagementLink.java", "diffHunk": "@@ -131,4 +133,37 @@ public boolean getRequiresConfirmation() {\n     public boolean getRequiresPOST() {\n         return false;\n     }\n+\n+    /**\n+     * Category for management link, uses {@code String} so it can be done with core dependency pre-dating the version this feature was added.", "originalCommit": "61dfeaf113eaa3c8d475f2d90b2263f650f32eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4MDQyNA==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388580424", "bodyText": "I like this. We can even @Restricted(NoExternalUse.class) the getCategoryName() to ensure migration when updating core dependencies.", "author": "daniel-beck", "createdAt": "2020-03-05T21:37:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1NjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU5ODI5Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388598293", "bodyText": "\u2026 except it doesn't seem to work for overrides.", "author": "daniel-beck", "createdAt": "2020-03-05T22:13:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1NjAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYwOTg1MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388609850", "bodyText": "well it is better than not having anything....", "author": "jtnord", "createdAt": "2020-03-05T22:43:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1NjAyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1NjI2Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388556266", "body": "implying you can add more - which means the string return above may return something that is not even in the enum from a \"bad\" plugin..", "bodyText": "implying you can add more - which means the string return above may return something that is not even in the enum from a \"bad\" plugin..", "bodyHTML": "<p dir=\"auto\">implying you can add more - which means the string return above may return something that is not even in the enum from a \"bad\" plugin..</p>", "author": "jtnord", "createdAt": "2020-03-05T20:48:00Z", "path": "core/src/main/java/hudson/model/ManagementLink.java", "diffHunk": "@@ -131,4 +133,37 @@ public boolean getRequiresConfirmation() {\n     public boolean getRequiresPOST() {\n         return false;\n     }\n+\n+    /**\n+     * Category for management link, uses {@code String} so it can be done with core dependency pre-dating the version this feature was added.\n+     *\n+     * @return An enum value of {@link Category}.\n+     * @since TODO\n+     */\n+    public @Nonnull String getCategory() {\n+        return Category.UNCATEGORIZED.toString();\n+    }\n+\n+    /**\n+     * Categories supported by this version of core.", "originalCommit": "61dfeaf113eaa3c8d475f2d90b2263f650f32eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3NTcxMw==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388575713", "bodyText": "may return something that is not even in the enum from a \"bad\" plugin..\n\nHence https://github.com/jenkinsci/jenkins/pull/4546/files#diff-9e24c3bccc9e921f1a5cc216abc25d03R4722-R4725", "author": "daniel-beck", "createdAt": "2020-03-05T21:27:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1NjI2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1ODkxNA==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388558914", "body": "just inline this in the enum?\r\n\r\n```java\r\n    public enum Category {\r\n        CONFIGURATION(Messages._ManagementLink_Category_CONFIGURATION()),\r\n        SECURITY(Messages._ManagementLink_Category_SECURITY());\r\n        //.....\r\n        \r\n        private Localizable label;\r\n\r\n        Category(Localizable label) {\r\n           this.label = label);\r\n        }\r\n        public Sting getLabel() {\r\n            return label.toString();\r\n        }\r\n}\r\n```", "bodyText": "just inline this in the enum?\n    public enum Category {\n        CONFIGURATION(Messages._ManagementLink_Category_CONFIGURATION()),\n        SECURITY(Messages._ManagementLink_Category_SECURITY());\n        //.....\n        \n        private Localizable label;\n\n        Category(Localizable label) {\n           this.label = label);\n        }\n        public Sting getLabel() {\n            return label.toString();\n        }\n}", "bodyHTML": "<p dir=\"auto\">just inline this in the enum?</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    public enum Category {\n        CONFIGURATION(Messages._ManagementLink_Category_CONFIGURATION()),\n        SECURITY(Messages._ManagementLink_Category_SECURITY());\n        //.....\n        \n        private Localizable label;\n\n        Category(Localizable label) {\n           this.label = label);\n        }\n        public Sting getLabel() {\n            return label.toString();\n        }\n}\n\"><pre>    <span class=\"pl-k\">public</span> <span class=\"pl-k\">enum</span> <span class=\"pl-en\">Category</span> {\n        <span class=\"pl-c1\">CONFIGURATION</span>(<span class=\"pl-smi\">Messages</span><span class=\"pl-k\">.</span>_ManagementLink_Category_CONFIGURATION()),\n        <span class=\"pl-c1\">SECURITY</span>(<span class=\"pl-smi\">Messages</span><span class=\"pl-k\">.</span>_ManagementLink_Category_SECURITY());\n        <span class=\"pl-c\"><span class=\"pl-c\">//</span>.....</span>\n        \n        <span class=\"pl-k\">private</span> <span class=\"pl-smi\">Localizable</span> label;\n\n        <span class=\"pl-en\">Category</span>(<span class=\"pl-smi\">Localizable</span> <span class=\"pl-v\">label</span>) {\n           <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>label <span class=\"pl-k\">=</span> label);\n        }\n        <span class=\"pl-k\">public</span> <span class=\"pl-smi\">Sting</span> <span class=\"pl-en\">getLabel</span>() {\n            <span class=\"pl-k\">return</span> label<span class=\"pl-k\">.</span>toString();\n        }\n}</pre></div>", "author": "jtnord", "createdAt": "2020-03-05T20:52:54Z", "path": "core/src/main/java/hudson/model/ManagementLink.java", "diffHunk": "@@ -131,4 +133,37 @@ public boolean getRequiresConfirmation() {\n     public boolean getRequiresPOST() {\n         return false;\n     }\n+\n+    /**\n+     * Category for management link, uses {@code String} so it can be done with core dependency pre-dating the version this feature was added.\n+     *\n+     * @return An enum value of {@link Category}.\n+     * @since TODO\n+     */\n+    public @Nonnull String getCategory() {\n+        return Category.UNCATEGORIZED.toString();\n+    }\n+\n+    /**\n+     * Categories supported by this version of core.\n+     *\n+     * @since TODO\n+     */\n+    public enum Category {\n+        CONFIGURATION,\n+        SECURITY,\n+        STATUS,\n+        TROUBLESHOOTING,\n+        TOOLS,\n+        MISC,\n+        UNCATEGORIZED;\n+\n+        public @Nonnull String getLabel() {", "originalCommit": "61dfeaf113eaa3c8d475f2d90b2263f650f32eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3NTU0Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388575546", "bodyText": "Seemed redundant. OTOH, benefit of not using reflection\u2026", "author": "daniel-beck", "createdAt": "2020-03-05T21:27:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1ODkxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3OTUzMQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388579531", "bodyText": "benefit of not using reflection\n\nthat was what I was trying to avoid :-)", "author": "jtnord", "createdAt": "2020-03-05T21:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU1ODkxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU2NTM3Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388565377", "body": "```suggestion\r\n        MISCELLANEOUS,\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    MISC,\n          \n          \n            \n                    MISCELLANEOUS,", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-c1 x x-first x-last\">MISC</span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-c1 x x-first x-last\">MISCELLANEOUS</span>,</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "jtnord", "createdAt": "2020-03-05T21:06:12Z", "path": "core/src/main/java/hudson/model/ManagementLink.java", "diffHunk": "@@ -131,4 +133,37 @@ public boolean getRequiresConfirmation() {\n     public boolean getRequiresPOST() {\n         return false;\n     }\n+\n+    /**\n+     * Category for management link, uses {@code String} so it can be done with core dependency pre-dating the version this feature was added.\n+     *\n+     * @return An enum value of {@link Category}.\n+     * @since TODO\n+     */\n+    public @Nonnull String getCategory() {\n+        return Category.UNCATEGORIZED.toString();\n+    }\n+\n+    /**\n+     * Categories supported by this version of core.\n+     *\n+     * @since TODO\n+     */\n+    public enum Category {\n+        CONFIGURATION,\n+        SECURITY,\n+        STATUS,\n+        TROUBLESHOOTING,\n+        TOOLS,\n+        MISC,", "originalCommit": "61dfeaf113eaa3c8d475f2d90b2263f650f32eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3NTg2NA==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388575864", "bodyText": "Invites typos in plugins.", "author": "daniel-beck", "createdAt": "2020-03-05T21:27:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU2NTM3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3OTE2MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388579160", "bodyText": "you an argue the same for CONFIGURATION vs CONFIG?", "author": "jtnord", "createdAt": "2020-03-05T21:34:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU2NTM3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4MTg0MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388581841", "bodyText": "No, much more common term, especially in the group I expect to type this in successfully.", "author": "daniel-beck", "createdAt": "2020-03-05T21:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU2NTM3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU3NzY3MQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388577671", "body": "need to catch nullPointerException unless you switch to my proposed way (as there are no annotations for plugins not upgrading core and they could heaven forbid return null without any compiler warnng)", "bodyText": "need to catch nullPointerException unless you switch to my proposed way (as there are no annotations for plugins not upgrading core and they could heaven forbid return null without any compiler warnng)", "bodyHTML": "<p dir=\"auto\">need to catch nullPointerException unless you switch to my proposed way (as there are no annotations for plugins not upgrading core and they could heaven forbid return null without any compiler warnng)</p>", "author": "jtnord", "createdAt": "2020-03-05T21:31:24Z", "path": "core/src/main/java/jenkins/model/Jenkins.java", "diffHunk": "@@ -4705,6 +4705,29 @@ public DependencyGraph getDependencyGraph() {\n     public List<ManagementLink> getManagementLinks() {\n         return ManagementLink.all();\n     }\n+\n+    // for Jelly\n+    @Restricted(NoExternalUse.class)\n+    public Map<ManagementLink.Category, List<ManagementLink>> getCategorizedManagementLinks() {\n+        Map<ManagementLink.Category, List<ManagementLink>> byCategory = new TreeMap<>();\n+        for (ManagementLink link : ManagementLink.all()) {\n+            if (link.getIconFileName() == null) {\n+                continue;\n+            }\n+            if (!Jenkins.get().hasPermission(link.getRequiredPermission())) {\n+                continue;\n+            }\n+            String categoryName = link.getCategory();\n+            ManagementLink.Category category;\n+            try {\n+                category = ManagementLink.Category.valueOf(categoryName);\n+            } catch (IllegalArgumentException ex) {", "originalCommit": "5c8165285ec0fe352da6c71acda1321e8d9f08b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1fd7decd0d0cfa34731dcfa6d52ae18cb8da13f9", "url": "https://github.com/jenkinsci/jenkins/commit/1fd7decd0d0cfa34731dcfa6d52ae18cb8da13f9", "message": "Make this less stringy\n\nCo-authored-by: James Nord <jtnord@users.noreply.github.com>", "committedDate": "2020-03-05T22:13:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYwMTU0Ng==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388601546", "body": "```suggestion\r\n        } catch (RuntimeException | NullPointerException e) {\r\n```\r\ngiven the plugins are not overriding `getCategoryName` as far as javac is concerned at compile time. (better than blowing up...)", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (RuntimeException e) {\n          \n          \n            \n                    } catch (RuntimeException | NullPointerException e) {\n          \n      \n    \n    \n  \n\ngiven the plugins are not overriding getCategoryName as far as javac is concerned at compile time. (better than blowing up...)", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"162\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">RuntimeException</span> e) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"162\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">RuntimeException</span> <span class=\"pl-k x x-first\">|</span><span class=\"x\"> </span><span class=\"pl-smi x\">NullPointerException</span><span class=\"x x-last\"> </span>e) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">given the plugins are not overriding <code>getCategoryName</code> as far as javac is concerned at compile time. (better than blowing up...)</p>", "author": "jtnord", "createdAt": "2020-03-05T22:21:30Z", "path": "core/src/main/java/hudson/model/ManagementLink.java", "diffHunk": "@@ -131,4 +137,58 @@ public boolean getRequiresConfirmation() {\n     public boolean getRequiresPOST() {\n         return false;\n     }\n+\n+    /**\n+     * Name of the category for this management link. Exists so that plugins with core dependency pre-dating the version\n+     * when this was introduced can define a category. Plugins with newer core dependency override {@link #getCategory()} instead.\n+     *\n+     * @return name of the desired category, one of the enum values of {@link Category}, e.g. {@code STATUS}.\n+     * @since TODO\n+     */\n+    @Restricted(NoExternalUse.class) // TODO I don't think this works\n+    protected @Nonnull String getCategoryName() {\n+        return \"UNCATEGORIZED\";\n+    }\n+\n+    /**\n+     * Category for management link, uses {@code String} so it can be done with core dependency pre-dating the version this feature was added.\n+     *\n+     * @return An enum value of {@link Category}.\n+     * @since TODO\n+     */\n+    public @Nonnull Category getCategory() {\n+        try {\n+            return Category.valueOf(getCategoryName());\n+        } catch (RuntimeException e) {", "originalCommit": "1fd7decd0d0cfa34731dcfa6d52ae18cb8da13f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYxNzA4NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388617085", "bodyText": "NullPointerException extends RuntimeException", "author": "daniel-beck", "createdAt": "2020-03-05T23:02:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYwMTU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYxNzg1Mw==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388617853", "bodyText": "urg yeah.. thought you where catching IllegalArgumentException \ud83e\udd26\u200d\u2642", "author": "jtnord", "createdAt": "2020-03-05T23:04:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYwMTU0Ng=="}], "type": "inlineReview"}, {"oid": "d112c015de1663b31dd602631fa67547d3469d8d", "url": "https://github.com/jenkinsci/jenkins/commit/d112c015de1663b31dd602631fa67547d3469d8d", "message": "Remove unnecessary TODOs\n\nCo-authored-by: F\u00e9lix Queiruga <fqueiruga@cloudbees.com>", "committedDate": "2020-03-06T12:18:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3ODEyMw==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388978123", "body": "does it work or not? \ud83d\ude04 ", "bodyText": "does it work or not? \ud83d\ude04", "bodyHTML": "<p dir=\"auto\">does it work or not? <g-emoji class=\"g-emoji\" alias=\"smile\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f604.png\">\ud83d\ude04</g-emoji></p>", "author": "timja", "createdAt": "2020-03-06T15:44:10Z", "path": "core/src/main/java/hudson/model/ManagementLink.java", "diffHunk": "@@ -131,4 +137,58 @@ public boolean getRequiresConfirmation() {\n     public boolean getRequiresPOST() {\n         return false;\n     }\n+\n+    /**\n+     * Name of the category for this management link. Exists so that plugins with core dependency pre-dating the version\n+     * when this was introduced can define a category. Plugins with newer core dependency override {@link #getCategory()} instead.\n+     *\n+     * @return name of the desired category, one of the enum values of {@link Category}, e.g. {@code STATUS}.\n+     * @since TODO\n+     */\n+    @Restricted(NoExternalUse.class) // TODO I don't think this works", "originalCommit": "d112c015de1663b31dd602631fa67547d3469d8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3OTg1MA==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388979850", "bodyText": "It doesn't, but since it's a client-side bug in access-checker, it still makes sense to leave the annotation in. Perhaps this?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Restricted(NoExternalUse.class) // TODO I don't think this works\n          \n          \n            \n                @Restricted(NoExternalUse.class) // Doesn't work as of 2020-03 due to https://github.com/kohsuke/access-modifier/issues/21 but annotate anyway", "author": "daniel-beck", "createdAt": "2020-03-06T15:47:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3ODEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk4MDc4Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r388980787", "bodyText": "ah ok, yeah perfect", "author": "timja", "createdAt": "2020-03-06T15:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk3ODEyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI4OTA0Nw==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r438289047", "body": "Now that I think about this, it seems like an oversight as GlobalConfiguration already had a category: \r\nhttps://github.com/jenkinsci/jenkins/blob/449c5aced523a6e66fe3d6a804e5dbfd5c5c67c6/core/src/main/java/jenkins/model/GlobalConfigurationCategory.java\r\n\r\ncc @basil ", "bodyText": "Now that I think about this, it seems like an oversight as GlobalConfiguration already had a category:\nhttps://github.com/jenkinsci/jenkins/blob/449c5aced523a6e66fe3d6a804e5dbfd5c5c67c6/core/src/main/java/jenkins/model/GlobalConfigurationCategory.java\ncc @basil", "bodyHTML": "<p dir=\"auto\">Now that I think about this, it seems like an oversight as GlobalConfiguration already had a category:<br>\n<a href=\"https://github.com/jenkinsci/jenkins/blob/449c5aced523a6e66fe3d6a804e5dbfd5c5c67c6/core/src/main/java/jenkins/model/GlobalConfigurationCategory.java\">https://github.com/jenkinsci/jenkins/blob/449c5aced523a6e66fe3d6a804e5dbfd5c5c67c6/core/src/main/java/jenkins/model/GlobalConfigurationCategory.java</a></p>\n<p dir=\"auto\">cc <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/basil/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/basil\">@basil</a></p>", "author": "jetersen", "createdAt": "2020-06-10T17:23:19Z", "path": "core/src/main/java/hudson/model/ManagementLink.java", "diffHunk": "@@ -131,4 +137,58 @@ public boolean getRequiresConfirmation() {\n     public boolean getRequiresPOST() {\n         return false;\n     }\n+\n+    /**\n+     * Name of the category for this management link. Exists so that plugins with core dependency pre-dating the version\n+     * when this was introduced can define a category. Plugins with newer core dependency override {@link #getCategory()} instead.\n+     *\n+     * @return name of the desired category, one of the enum values of {@link Category}, e.g. {@code STATUS}.\n+     * @since TODO\n+     */\n+    @Restricted(NoExternalUse.class) // TODO I don't think this works\n+    protected @Nonnull String getCategoryName() {\n+        return \"UNCATEGORIZED\";\n+    }\n+\n+    /**\n+     * Category for management link, uses {@code String} so it can be done with core dependency pre-dating the version this feature was added.\n+     *\n+     * @return An enum value of {@link Category}.\n+     * @since TODO\n+     */\n+    public @Nonnull Category getCategory() {\n+        try {\n+            return Category.valueOf(getCategoryName());\n+        } catch (RuntimeException e) {\n+            LOGGER.log(Level.WARNING, \"invalid category {0} for class {1}\", new Object[]{getCategoryName() , this.getClass().getName()});\n+            return Category.UNCATEGORIZED;\n+        }\n+    }\n+\n+    /**\n+     * Categories supported by this version of core.\n+     *\n+     * @since TODO\n+     */\n+    public enum Category {\n+        CONFIGURATION(Messages._ManagementLink_Category_CONFIGURATION()),\n+        SECURITY(Messages._ManagementLink_Category_SECURITY()),\n+        STATUS(Messages._ManagementLink_Category_STATUS()),\n+        TROUBLESHOOTING(Messages._ManagementLink_Category_TROUBLESHOOTING()),\n+        TOOLS(Messages._ManagementLink_Category_TOOLS()),\n+        MISC(Messages._ManagementLink_Category_MISC()),\n+        UNCATEGORIZED(Messages._ManagementLink_Category_UNCATEGORIZED());", "originalCommit": "d112c015de1663b31dd602631fa67547d3469d8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI5MzAyMg==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r438293022", "bodyText": "Great! It looks like these categories are relatively new (appearing first in Jenkins 2.226) and have not yet made it to an LTS release. Once my plugin's minimum required Jenkins version contains these new categories, I will start using them.", "author": "basil", "createdAt": "2020-06-10T17:29:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI4OTA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI5NTM4NQ==", "url": "https://github.com/jenkinsci/jenkins/pull/4546#discussion_r438295385", "bodyText": "Sorry, I misunderstood. Indeed, I now see that I cannot use these categories because they are of type ManagementLink.Category rather than GlobalConfigurationCategory. Anyway, seems outside the scope of JENKINS-62445. If and when there is a working solution for plugin developers to follow regarding CasC categories, I will adopt it.", "author": "basil", "createdAt": "2020-06-10T17:33:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI4OTA0Nw=="}], "type": "inlineReview"}]}