{"pr_number": 4027, "pr_title": "Audience check", "pr_author": "mstruk", "pr_createdAt": "2020-12-01T14:11:34Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4027", "timeline": [{"oid": "6be16e049b71b4388c09b5faa14a4a25559fcc8b", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6be16e049b71b4388c09b5faa14a4a25559fcc8b", "message": "Use strimzi-kafka-oauth 0.7.0 RC1 rather than a nightly SNAPSHOT build\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2020-12-05T15:53:56Z", "type": "forcePushed"}, {"oid": "4299b173381d52465d3880e207c575a36c9eeb4e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/4299b173381d52465d3880e207c575a36c9eeb4e", "message": "Fix docs issues found during ./azure/scripts/checs-dock.sh\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-01-17T09:22:06Z", "type": "forcePushed"}, {"oid": "676e71b4483ccf7a77ba834a21b429231a3f9523", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/676e71b4483ccf7a77ba834a21b429231a3f9523", "message": "Add audience check support to `oauth` authentication\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate CRDs\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix docs issues found during ./azure/scripts/checs-dock.sh\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-04T09:55:19Z", "type": "forcePushed"}, {"oid": "0027f102e9e010b0dc83c2c0d537ed864d12df42", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0027f102e9e010b0dc83c2c0d537ed864d12df42", "message": "Add audience check support to `oauth` authentication\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate CRDs\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix docs issues found during ./azure/scripts/checs-dock.sh\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-09T06:21:24Z", "type": "commit"}, {"oid": "0027f102e9e010b0dc83c2c0d537ed864d12df42", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/0027f102e9e010b0dc83c2c0d537ed864d12df42", "message": "Add audience check support to `oauth` authentication\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nUpdate CRDs\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>\n\nFix docs issues found during ./azure/scripts/checs-dock.sh\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-09T06:21:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjkzODU0MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4027#discussion_r572938540", "body": "So, this checks that the `aud == clientID`? If so, should we make it clear here in the description? For me this is a bit cryptic right now ... I know audience is in the token. But it is not clear what is it checked for. \r\n\r\nI noticed this is explained in one of the other sections. Bu might be worth adding it here as well?", "bodyText": "So, this checks that the aud == clientID? If so, should we make it clear here in the description? For me this is a bit cryptic right now ... I know audience is in the token. But it is not clear what is it checked for.\nI noticed this is explained in one of the other sections. Bu might be worth adding it here as well?", "bodyHTML": "<p dir=\"auto\">So, this checks that the <code>aud == clientID</code>? If so, should we make it clear here in the description? For me this is a bit cryptic right now ... I know audience is in the token. But it is not clear what is it checked for.</p>\n<p dir=\"auto\">I noticed this is explained in one of the other sections. Bu might be worth adding it here as well?</p>", "author": "scholzj", "createdAt": "2021-02-09T14:39:34Z", "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -105,6 +106,17 @@ public void setCheckIssuer(boolean checkIssuer) {\n         this.checkIssuer = checkIssuer;\n     }\n \n+    @Description(\"Enable or disable audience checking. If audience checking is enabled the `clientId` also has to be configured. \" +", "originalCommit": "0027f102e9e010b0dc83c2c0d537ed864d12df42", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3Mjk2MzYwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4027#discussion_r572963600", "bodyText": "If audience checking is enabled the clientId also has to be configured.\n\nConfigured where? The documentation should be explicit.", "author": "tombentley", "createdAt": "2021-02-09T15:06:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjkzODU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzUzNDg1OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4027#discussion_r573534859", "bodyText": "Enable or disable audience checking. Audience checks identify the recipients of tokens. If audience checking is enabled, the Kafka broker will reject tokens that do not have its clientId in their aud (audience) claim. Default value is false.", "author": "PaulRMellor", "createdAt": "2021-02-10T08:32:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjkzODU0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzU4MTY0NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4027#discussion_r573581645", "bodyText": "If audience checking is enabled the clientId also has to be configured.\n\nConfigured where? The documentation should be explicit.\n\nIt's a config attribute of 'oauth' authentication called clientId at the same level as validIssuerId, userNameClaim, and checkAudience. Not sure how to make it more clear since the generated docs have these in the same set of config attributes, alphabetically sorted. When you read this description in the generated KafkaCR documentation under checkAudience attribute, you can just scroll a bit further to read about clientId config attribute. Is there a way to create links from the description to the attribute entry in the docs?", "author": "mstruk", "createdAt": "2021-02-10T09:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MjkzODU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzU4NjM4Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4027#discussion_r573586387", "body": "Ah, so I was confused because I thought this must be a _Kafka_ client id. It makes more sense now. \r\n\r\n```suggestion\r\n    @Description(\"Enable or disable audience checking. If audience checking is enabled the OAuth Client ID also has to be configured via the `clientId` property. \" +\r\n```", "bodyText": "Ah, so I was confused because I thought this must be a Kafka client id. It makes more sense now.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Description(\"Enable or disable audience checking. If audience checking is enabled the `clientId` also has to be configured. \" +\n          \n          \n            \n                @Description(\"Enable or disable audience checking. If audience checking is enabled the OAuth Client ID also has to be configured via the `clientId` property. \" +", "bodyHTML": "<p dir=\"auto\">Ah, so I was confused because I thought this must be a <em>Kafka</em> client id. It makes more sense now.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">@Description</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Enable or disable audience checking. If audience checking is enabled the <span class=\"x x-first x-last\">`clientId` </span>also has to be configured. <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">@Description</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Enable or disable audience checking. If audience checking is enabled the <span class=\"x x-first x-last\">OAuth Client ID </span>also has to be configured<span class=\"x x-first x-last\"> via the `clientId` property</span>. <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "tombentley", "createdAt": "2021-02-10T09:49:22Z", "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -105,6 +106,17 @@ public void setCheckIssuer(boolean checkIssuer) {\n         this.checkIssuer = checkIssuer;\n     }\n \n+    @Description(\"Enable or disable audience checking. If audience checking is enabled the `clientId` also has to be configured. \" +", "originalCommit": "0027f102e9e010b0dc83c2c0d537ed864d12df42", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "da7edee94173f5ff7d982c9e7cf29e1aa9cf98a8", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/da7edee94173f5ff7d982c9e7cf29e1aa9cf98a8", "message": "Update api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java\n\nCo-authored-by: Tom Bentley <tombentley@users.noreply.github.com>\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-10T10:02:08Z", "type": "commit"}, {"oid": "2bf6d9f1f2e770ed34bfdd4fda407ac003ded91e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2bf6d9f1f2e770ed34bfdd4fda407ac003ded91e", "message": "Address PR comments - clarify the docs\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-10T10:24:57Z", "type": "commit"}, {"oid": "2bf6d9f1f2e770ed34bfdd4fda407ac003ded91e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2bf6d9f1f2e770ed34bfdd4fda407ac003ded91e", "message": "Address PR comments - clarify the docs\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-10T10:24:57Z", "type": "forcePushed"}, {"oid": "d5c42ca4c61222c03335590cf49708efcf3f55b2", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/d5c42ca4c61222c03335590cf49708efcf3f55b2", "message": "Fix forgotten files generated by the build\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-10T14:30:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NDM3MDI5OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/4027#discussion_r574370298", "body": "```suggestion\r\n            \"If audience checking is enabled, the OAuth Client ID also has to be configured using the `clientId` property. \" +\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"If audience checking is enabled the OAuth Client ID also has to be configured via the `clientId` property. \" +\n          \n          \n            \n                        \"If audience checking is enabled, the OAuth Client ID also has to be configured using the `clientId` property. \" +", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>If audience checking is enabled the OAuth Client ID also has to be configured <span class=\"x x-first x-last\">via</span> the `clientId` property. <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>If audience checking is enabled<span class=\"x x-first x-last\">,</span> the OAuth Client ID also has to be configured <span class=\"x x-first x-last\">using</span> the `clientId` property. <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "PaulRMellor", "createdAt": "2021-02-11T09:55:07Z", "path": "api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java", "diffHunk": "@@ -105,6 +106,19 @@ public void setCheckIssuer(boolean checkIssuer) {\n         this.checkIssuer = checkIssuer;\n     }\n \n+    @Description(\"Enable or disable audience checking. Audience checks identify the recipients of tokens. \" +\n+            \"If audience checking is enabled the OAuth Client ID also has to be configured via the `clientId` property. \" +", "originalCommit": "d5c42ca4c61222c03335590cf49708efcf3f55b2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6b42acf521728bd346033103c0cbe4c90cbc76b5", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6b42acf521728bd346033103c0cbe4c90cbc76b5", "message": "Update api/src/main/java/io/strimzi/api/kafka/model/listener/KafkaListenerAuthenticationOAuth.java\n\nCo-authored-by: PaulRMellor <47596553+PaulRMellor@users.noreply.github.com>\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-12T10:43:58Z", "type": "commit"}, {"oid": "eba13862772c7428d64c81a2b2a485209d92ae88", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/eba13862772c7428d64c81a2b2a485209d92ae88", "message": "Fix the files generated by the build\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-12T10:43:58Z", "type": "commit"}, {"oid": "eba13862772c7428d64c81a2b2a485209d92ae88", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/eba13862772c7428d64c81a2b2a485209d92ae88", "message": "Fix the files generated by the build\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-12T10:43:58Z", "type": "forcePushed"}, {"oid": "b0e67d1fcb23faac7a28477687242a61274986e0", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/b0e67d1fcb23faac7a28477687242a61274986e0", "message": "Add missing helm file\n\nSigned-off-by: Marko Strukelj <marko.strukelj@gmail.com>", "committedDate": "2021-02-12T12:24:37Z", "type": "commit"}]}