{"pr_number": 2563, "pr_title": "Print a warning when single ZK replica with ephemeral storage is used", "pr_author": "sknot-rh", "pr_createdAt": "2020-02-17T11:08:43Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2563", "timeline": [{"oid": "fc78a0040ce3064e3faf65c09c2b6f64ba97c7e1", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fc78a0040ce3064e3faf65c09c2b6f64ba97c7e1", "message": "Print a warning when single ZK replica with ephemeral storage is used\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-17T11:04:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE4Nzg3MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2563#discussion_r380187871", "body": "Isn't `\"ephemeral\".equals(...)` better? Smaller chance for NPE.", "bodyText": "Isn't \"ephemeral\".equals(...) better? Smaller chance for NPE.", "bodyHTML": "<p dir=\"auto\">Isn't <code>\"ephemeral\".equals(...)</code> better? Smaller chance for NPE.</p>", "author": "scholzj", "createdAt": "2020-02-17T13:41:50Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java", "diffHunk": "@@ -181,6 +181,11 @@ public static ZookeeperCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup\n         if (replicas <= 0) {\n             replicas = ZookeeperClusterSpec.DEFAULT_REPLICAS;\n         }\n+\n+        if (replicas == 1 && zookeeperClusterSpec.getStorage() != null && zookeeperClusterSpec.getStorage().getType().equals(\"ephemeral\")) {", "originalCommit": "ffc00759b7df44f2f5b040e1d4282061de5b4aa5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE4OTIxMQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2563#discussion_r380189211", "body": "@laidan6000 @PaulRMellor Could one of you review the message please?", "bodyText": "@laidan6000 @PaulRMellor Could one of you review the message please?", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/laidan6000/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/laidan6000\">@laidan6000</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/PaulRMellor/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/PaulRMellor\">@PaulRMellor</a> Could one of you review the message please?</p>", "author": "scholzj", "createdAt": "2020-02-17T13:44:32Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java", "diffHunk": "@@ -181,6 +181,11 @@ public static ZookeeperCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup\n         if (replicas <= 0) {\n             replicas = ZookeeperClusterSpec.DEFAULT_REPLICAS;\n         }\n+\n+        if (replicas == 1 && zookeeperClusterSpec.getStorage() != null && zookeeperClusterSpec.getStorage().getType().equals(\"ephemeral\")) {\n+            log.warn(\"Zookeeper cluster with single replica and ephemeral storage will be in defective state after any restart or rolling update. It is recommended to use at least three replicas.\");", "originalCommit": "ffc00759b7df44f2f5b040e1d4282061de5b4aa5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fcb198aa7f4824510c574c8493fc598f29890d1d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fcb198aa7f4824510c574c8493fc598f29890d1d", "message": "jbod\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-17T14:29:26Z", "type": "commit"}, {"oid": "fcb198aa7f4824510c574c8493fc598f29890d1d", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/fcb198aa7f4824510c574c8493fc598f29890d1d", "message": "jbod\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-17T14:29:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIzNzY5Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2563#discussion_r380237697", "body": "```suggestion\r\n            log.warn(\"A ZooKeeper cluster with a single replica and ephemeral storage will be in a defective state after any restart or rolling update. It is recommended that a minimum of three replicas are used.\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.warn(\"Zookeeper cluster with single replica and ephemeral storage will be in defective state after any restart or rolling update. It is recommended to use at least three replicas.\");\n          \n          \n            \n                        log.warn(\"A ZooKeeper cluster with a single replica and ephemeral storage will be in a defective state after any restart or rolling update. It is recommended that a minimum of three replicas are used.\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            log<span class=\"pl-k\">.</span>warn(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">Zookeeper </span>cluster with single replica and ephemeral storage will be in defective state after any restart or rolling update. It is recommended <span class=\"x x-first x-last\">to use at least</span> three replicas.<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            log<span class=\"pl-k\">.</span>warn(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">A ZooKeeper </span>cluster with <span class=\"x x-first x-last\">a </span>single replica and ephemeral storage will be in <span class=\"x x-first x-last\">a </span>defective state after any restart or rolling update. It is recommended <span class=\"x x-first x-last\">that a minimum of</span> three replicas<span class=\"x x-first x-last\"> are used</span>.<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "PaulRMellor", "createdAt": "2020-02-17T15:14:27Z", "path": "cluster-operator/src/main/java/io/strimzi/operator/cluster/model/ZookeeperCluster.java", "diffHunk": "@@ -181,6 +181,11 @@ public static ZookeeperCluster fromCrd(Kafka kafkaAssembly, KafkaVersion.Lookup\n         if (replicas <= 0) {\n             replicas = ZookeeperClusterSpec.DEFAULT_REPLICAS;\n         }\n+\n+        if (replicas == 1 && zookeeperClusterSpec.getStorage() != null && \"ephemeral\".equals(zookeeperClusterSpec.getStorage().getType())) {\n+            log.warn(\"Zookeeper cluster with single replica and ephemeral storage will be in defective state after any restart or rolling update. It is recommended to use at least three replicas.\");", "originalCommit": "fcb198aa7f4824510c574c8493fc598f29890d1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6acbdc64e72645954a9adf495f2e6823c4aef549", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6acbdc64e72645954a9adf495f2e6823c4aef549", "message": "message suggestion\n\nSigned-off-by: Stanislav Knot <sknot@redhat.com>", "committedDate": "2020-02-17T15:18:58Z", "type": "commit"}]}