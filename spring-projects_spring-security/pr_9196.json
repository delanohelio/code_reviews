{"pr_number": 9196, "pr_title": "Allow maximum age of csrf cookie to be configured", "pr_author": "sedran", "pr_createdAt": "2020-11-08T17:22:51Z", "pr_url": "https://github.com/spring-projects/spring-security/pull/9196", "timeline": [{"oid": "c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "url": "https://github.com/spring-projects/spring-security/commit/c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "message": "Allow maximum age of csrf cookie to be configured\n\nAllows maxAge of the generated cookie by CookieCsrfTokenRepository\nto be configurable.\n\nPrior to this commit, maximum age was set with a value of -1.\n\nAfter this commit, it will be configured by the user with an either\npositive or negative value. If the user does not provide a value,\nit will be set -1.\n\nAn IllegalArgumentException will be thrown when\nthis value is set to zero.\n\nCloses gh-9195", "committedDate": "2020-11-08T18:08:47Z", "type": "commit"}, {"oid": "c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "url": "https://github.com/spring-projects/spring-security/commit/c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "message": "Allow maximum age of csrf cookie to be configured\n\nAllows maxAge of the generated cookie by CookieCsrfTokenRepository\nto be configurable.\n\nPrior to this commit, maximum age was set with a value of -1.\n\nAfter this commit, it will be configured by the user with an either\npositive or negative value. If the user does not provide a value,\nit will be set -1.\n\nAn IllegalArgumentException will be thrown when\nthis value is set to zero.\n\nCloses gh-9195", "committedDate": "2020-11-08T18:08:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNjY2NA==", "url": "https://github.com/spring-projects/spring-security/pull/9196#discussion_r523236664", "body": "Can you please change this to be cookieMaxAge cannot be zero? As it is, the error the user will see if it is `0` would state it is not zero which would be confusing.\r\n\r\n```suggestion\r\n\t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge cannot be zero\");\r\n```", "bodyText": "Can you please change this to be cookieMaxAge cannot be zero? As it is, the error the user will see if it is 0 would state it is not zero which would be confusing.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge is not zero\");\n          \n          \n            \n            \t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge cannot be zero\");", "bodyHTML": "<p dir=\"auto\">Can you please change this to be cookieMaxAge cannot be zero? As it is, the error the user will see if it is <code>0</code> would state it is not zero which would be confusing.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t<span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>isTrue(cookieMaxAge <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">0</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>cookieMaxAge <span class=\"x x-first x-last\">is not</span> zero<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t<span class=\"pl-smi\">Assert</span><span class=\"pl-k\">.</span>isTrue(cookieMaxAge <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">0</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>cookieMaxAge <span class=\"x x-first x-last\">cannot be</span> zero<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "rwinch", "createdAt": "2020-11-13T21:16:46Z", "path": "web/src/main/java/org/springframework/security/web/csrf/CookieCsrfTokenRepository.java", "diffHunk": "@@ -192,4 +194,30 @@ public void setSecure(Boolean secure) {\n \t\tthis.secure = secure;\n \t}\n \n+\t/**\n+\t * Sets maximum age in seconds for the cookie that the expected CSRF token is saved to\n+\t * and read from. By default maximum age value is -1.\n+\t *\n+\t * <p>\n+\t * A positive value indicates that the cookie will expire after that many seconds have\n+\t * passed. Note that the value is the <i>maximum</i> age when the cookie will expire,\n+\t * not the cookie's current age.\n+\t *\n+\t * <p>\n+\t * A negative value means that the cookie is not stored persistently and will be\n+\t * deleted when the Web browser exits.\n+\t *\n+\t * <p>\n+\t * A zero value causes the cookie to be deleted immediately therefore it is not a\n+\t * valid value and in that case an {@link IllegalArgumentException} will be thrown.\n+\t * @param cookieMaxAge an integer specifying the maximum age of the cookie in seconds;\n+\t * if negative, means the cookie is not stored; if zero, the method throws an\n+\t * {@link IllegalArgumentException}\n+\t * @since 5.5\n+\t */\n+\tpublic void setCookieMaxAge(int cookieMaxAge) {\n+\t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge is not zero\");", "originalCommit": "c5713ec11b2ac5c55f6f7cce2c30e3682131c6e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzM5NzEwNw==", "url": "https://github.com/spring-projects/spring-security/pull/9196#discussion_r523397107", "bodyText": "Thank you for your feedback. In this class there are other assertions written in this way. I've tried to follow the convention in the class. Can I change the other assertions in the same file in order to be consistent?", "author": "sedran", "createdAt": "2020-11-14T09:06:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNjY2NA=="}], "type": "inlineReview", "revised_code": {"commit": "75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "changed_code": [{"header": "diff --git a/web/src/main/java/org/springframework/security/web/csrf/CookieCsrfTokenRepository.java b/web/src/main/java/org/springframework/security/web/csrf/CookieCsrfTokenRepository.java\nindex d04a62ce89..80f036e7d8 100644\n--- a/web/src/main/java/org/springframework/security/web/csrf/CookieCsrfTokenRepository.java\n+++ b/web/src/main/java/org/springframework/security/web/csrf/CookieCsrfTokenRepository.java\n", "chunk": "@@ -216,7 +216,7 @@ public final class CookieCsrfTokenRepository implements CsrfTokenRepository {\n \t * @since 5.5\n \t */\n \tpublic void setCookieMaxAge(int cookieMaxAge) {\n-\t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge is not zero\");\n+\t\tAssert.isTrue(cookieMaxAge != 0, \"cookieMaxAge cannot be zero\");\n \t\tthis.cookieMaxAge = cookieMaxAge;\n \t}\n \n", "next_change": null}]}}, {"oid": "75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "url": "https://github.com/spring-projects/spring-security/commit/75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "message": "Make assertion messages in CookieCsrfTokenRepository clearer\n\nChanges assertion message format from 'X is not null' to\n'X cannot be null' since this is more meaningful when the error\noccurs and the message is printed in the logs.\n\nCloses gh-9195", "committedDate": "2020-11-17T20:13:35Z", "type": "commit"}, {"oid": "75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "url": "https://github.com/spring-projects/spring-security/commit/75ea7224bd4a08cf9bfa27a7eb065e4eb6323730", "message": "Make assertion messages in CookieCsrfTokenRepository clearer\n\nChanges assertion message format from 'X is not null' to\n'X cannot be null' since this is more meaningful when the error\noccurs and the message is printed in the logs.\n\nCloses gh-9195", "committedDate": "2020-11-17T20:13:35Z", "type": "forcePushed"}]}