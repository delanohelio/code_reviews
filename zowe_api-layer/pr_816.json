{"pr_number": 816, "pr_title": "Protectors - Support HTTP only in ZAAS client", "pr_author": "plavjanik", "pr_createdAt": "2020-09-01T21:07:23Z", "pr_url": "https://github.com/zowe/api-layer/pull/816", "timeline": [{"oid": "364d0b6dc05b839a4561bbc8175ac07a53838186", "url": "https://github.com/zowe/api-layer/commit/364d0b6dc05b839a4561bbc8175ac07a53838186", "message": "Support HTTP only in ZAAS client", "committedDate": "2020-09-01T14:37:29Z", "type": "commit"}, {"oid": "993e633df4f5490c9582c731236bffa53eb32fe8", "url": "https://github.com/zowe/api-layer/commit/993e633df4f5490c9582c731236bffa53eb32fe8", "message": "Merge branch 'master' into protectors/zaas-client-http", "committedDate": "2020-09-01T21:09:21Z", "type": "commit"}, {"oid": "dee991de9e0bf36cea8854fcf089a9ddb226a0bf", "url": "https://github.com/zowe/api-layer/commit/dee991de9e0bf36cea8854fcf089a9ddb226a0bf", "message": "ZaasHttpClientProviderTests", "committedDate": "2020-09-03T11:41:31Z", "type": "commit"}, {"oid": "f55c12be300239b0064bc04bdd5b1743568a96df", "url": "https://github.com/zowe/api-layer/commit/f55c12be300239b0064bc04bdd5b1743568a96df", "message": "HttpOnly ZaasClientTests", "committedDate": "2020-09-03T11:50:59Z", "type": "commit"}, {"oid": "841c028e8d10915144dfad4e52e2aa12334ba06f", "url": "https://github.com/zowe/api-layer/commit/841c028e8d10915144dfad4e52e2aa12334ba06f", "message": "SonarQube", "committedDate": "2020-09-03T13:08:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA1MjYyNA==", "url": "https://github.com/zowe/api-layer/pull/816#discussion_r483052624", "body": "```suggestion\r\nimport java.io.IOException;\r\nimport org.apache.http.HttpHeaders;\r\nimport org.apache.http.cookie.SM;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import java.io.IOException;\n          \n          \n            \n            import java.io.IOException;\n          \n          \n            \n            import org.apache.http.HttpHeaders;\n          \n          \n            \n            import org.apache.http.cookie.SM;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"25\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">java.io.IOException</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"25\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">java.io.IOException</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"26\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.http.HttpHeaders</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"27\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.http.cookie.SM</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pj892031", "createdAt": "2020-09-03T15:09:20Z", "path": "zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/PassTicketServiceImpl.java", "diffHunk": "@@ -25,41 +25,35 @@\n import java.io.IOException;", "originalCommit": "841c028e8d10915144dfad4e52e2aa12334ba06f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA1MjY3OA==", "url": "https://github.com/zowe/api-layer/pull/816#discussion_r483052678", "body": "```suggestion\r\n            httpPost.setHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\r\n            httpPost.setHeader(SM.COOKIE, TOKEN_PREFIX + \"=\" + jwtToken);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        httpPost.setHeader(\"Content-Type\", \"application/json\");\n          \n          \n            \n                        httpPost.setHeader(\"Cookie\", TOKEN_PREFIX + \"=\" + jwtToken);\n          \n          \n            \n                        httpPost.setHeader(HttpHeaders.CONTENT_TYPE, \"application/json\");\n          \n          \n            \n                        httpPost.setHeader(SM.COOKIE, TOKEN_PREFIX + \"=\" + jwtToken);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            httpPost<span class=\"pl-k\">.</span>setHeader(<span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">Content-Type</span><span class=\"pl-pds x x-last\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>application/json<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            httpPost<span class=\"pl-k\">.</span>setHeader(<span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">Cookie</span><span class=\"pl-pds x x-last\">\"</span></span>, <span class=\"pl-c1\">TOKEN_PREFIX</span> <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>=<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> jwtToken);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            httpPost<span class=\"pl-k\">.</span>setHeader(<span class=\"pl-smi x x-first\">HttpHeaders</span><span class=\"pl-c1\"><span class=\"pl-k x\">.</span><span class=\"x x-last\">CONTENT_TYPE</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>application/json<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            httpPost<span class=\"pl-k\">.</span>setHeader(<span class=\"pl-c1\"><span class=\"x x-first\">SM</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">COOKIE</span></span>, <span class=\"pl-c1\">TOKEN_PREFIX</span> <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>=<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> jwtToken);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pj892031", "createdAt": "2020-09-03T15:09:25Z", "path": "zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/PassTicketServiceImpl.java", "diffHunk": "@@ -25,41 +25,35 @@\n import java.io.IOException;\n \n @Slf4j\n-class PassTicketServiceHttps implements PassTicketService {\n+class PassTicketServiceImpl implements PassTicketService {\n     private static final String TOKEN_PREFIX = \"apimlAuthenticationToken\";\n \n-    private HttpsClientProvider httpsClientProvider;\n+    private final CloseableClientProvider httpClientProvider;\n     private final String ticketUrl;\n \n-    public PassTicketServiceHttps(HttpsClientProvider client, String baseUrl) {\n-        this.httpsClientProvider = client;\n-\n+    public PassTicketServiceImpl(CloseableClientProvider client, String baseUrl) {\n+        httpClientProvider = client;\n         ticketUrl = baseUrl + \"/ticket\";\n     }\n \n     @Override\n     public String passTicket(String jwtToken, String applicationId) throws ZaasClientException, ZaasConfigurationException {\n-        CloseableHttpResponse response = null;\n-        CloseableHttpClient closeableHttpsClient = null;\n-        try {\n-            closeableHttpsClient = httpsClientProvider.getHttpsClientWithKeyStoreAndTrustStore();\n+        try (CloseableHttpClient closeableHttpsClient = httpClientProvider.getHttpClient()) {\n             ZaasClientTicketRequest zaasClientTicketRequest = new ZaasClientTicketRequest();\n             ObjectMapper mapper = new ObjectMapper();\n             zaasClientTicketRequest.setApplicationName(applicationId);\n \n             HttpPost httpPost = new HttpPost(ticketUrl);\n             httpPost.setEntity(new StringEntity(mapper.writeValueAsString(zaasClientTicketRequest)));\n-            httpPost.setHeader(\"Content-type\", \"application/json\");\n+            httpPost.setHeader(\"Content-Type\", \"application/json\");\n             httpPost.setHeader(\"Cookie\", TOKEN_PREFIX + \"=\" + jwtToken);", "originalCommit": "841c028e8d10915144dfad4e52e2aa12334ba06f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA2MjE4OQ==", "url": "https://github.com/zowe/api-layer/pull/816#discussion_r483062189", "bodyText": "Thanks :)", "author": "plavjanik", "createdAt": "2020-09-03T15:22:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA1MjY3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA1NjA3NQ==", "url": "https://github.com/zowe/api-layer/pull/816#discussion_r483056075", "body": "```suggestion\r\nimport org.apache.http.impl.client.HttpClientBuilder;\r\nimport lombok.Getter;\r\n\r\npublic class ZaasHttpClientProvider implements CloseableClientProvider {\r\n\r\n    @Getter\r\n    private final CloseableHttpClient httpClient;\r\n\r\n    public ZaasHttpClientProvider() {\r\n        httpClient = HttpClientBuilder.create().disableCookieManagement().disableAuthCaching().build();\r\n    }\r\n    \r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import org.apache.http.impl.client.HttpClientBuilder;\n          \n          \n            \n            \n          \n          \n            \n            public class ZaasHttpClientProvider implements CloseableClientProvider {\n          \n          \n            \n                private final CloseableHttpClient httpClient;\n          \n          \n            \n            \n          \n          \n            \n                public ZaasHttpClientProvider() {\n          \n          \n            \n                    httpClient = HttpClientBuilder.create().disableCookieManagement().disableAuthCaching().build();\n          \n          \n            \n                }\n          \n          \n            \n            \n          \n          \n            \n                @Override\n          \n          \n            \n                public CloseableHttpClient getHttpClient() {\n          \n          \n            \n                    return httpClient;\n          \n          \n            \n                }\n          \n          \n            \n            import org.apache.http.impl.client.HttpClientBuilder;\n          \n          \n            \n            import lombok.Getter;\n          \n          \n            \n            \n          \n          \n            \n            public class ZaasHttpClientProvider implements CloseableClientProvider {\n          \n          \n            \n            \n          \n          \n            \n                @Getter\n          \n          \n            \n                private final CloseableHttpClient httpClient;\n          \n          \n            \n            \n          \n          \n            \n                public ZaasHttpClientProvider() {\n          \n          \n            \n                    httpClient = HttpClientBuilder.create().disableCookieManagement().disableAuthCaching().build();\n          \n          \n            \n                }", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.http.impl.client.HttpClientBuilder</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">ZaasHttpClientProvider</span> <span class=\"pl-k\">implements</span> <span class=\"pl-e\">CloseableClientProvider</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">CloseableHttpClient</span> httpClient;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> ZaasHttpClientProvider() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        httpClient <span class=\"pl-k\">=</span> <span class=\"pl-smi\">HttpClientBuilder</span><span class=\"pl-k\">.</span>create()<span class=\"pl-k\">.</span>disableCookieManagement()<span class=\"pl-k\">.</span>disableAuthCaching()<span class=\"pl-k\">.</span>build();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">@Override</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">CloseableHttpClient</span> getHttpClient() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">return</span> httpClient;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.http.impl.client.HttpClientBuilder</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">lombok.Getter</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">ZaasHttpClientProvider</span> <span class=\"pl-k\">implements</span> <span class=\"pl-e\">CloseableClientProvider</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">@Getter</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">CloseableHttpClient</span> httpClient;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> ZaasHttpClientProvider() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        httpClient <span class=\"pl-k\">=</span> <span class=\"pl-smi\">HttpClientBuilder</span><span class=\"pl-k\">.</span>create()<span class=\"pl-k\">.</span>disableCookieManagement()<span class=\"pl-k\">.</span>disableAuthCaching()<span class=\"pl-k\">.</span>build();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    </td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pj892031", "createdAt": "2020-09-03T15:14:18Z", "path": "zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/ZaasHttpClientProvider.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * This program and the accompanying materials are made available under the terms of the\n+ * Eclipse Public License v2.0 which accompanies this distribution, and is available at\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Copyright Contributors to the Zowe Project.\n+ */\n+package org.zowe.apiml.zaasclient.service.internal;\n+\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClientBuilder;\n+\n+public class ZaasHttpClientProvider implements CloseableClientProvider {\n+    private final CloseableHttpClient httpClient;\n+\n+    public ZaasHttpClientProvider() {\n+        httpClient = HttpClientBuilder.create().disableCookieManagement().disableAuthCaching().build();\n+    }\n+\n+    @Override\n+    public CloseableHttpClient getHttpClient() {\n+        return httpClient;\n+    }", "originalCommit": "841c028e8d10915144dfad4e52e2aa12334ba06f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA1NzkxNg==", "url": "https://github.com/zowe/api-layer/pull/816#discussion_r483057916", "body": "```suggestion\r\n        httpGet.addHeader(SM.COOKIE, TOKEN_PREFIX + \"=\" + jwtToken);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    httpGet.addHeader(\"Cookie\", TOKEN_PREFIX + \"=\" + jwtToken);\n          \n          \n            \n                    httpGet.addHeader(SM.COOKIE, TOKEN_PREFIX + \"=\" + jwtToken);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        httpGet<span class=\"pl-k\">.</span>addHeader(<span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">Cookie</span><span class=\"pl-pds x x-last\">\"</span></span>, <span class=\"pl-c1\">TOKEN_PREFIX</span> <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>=<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> jwtToken);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        httpGet<span class=\"pl-k\">.</span>addHeader(<span class=\"pl-c1\"><span class=\"x x-first\">SM</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">COOKIE</span></span>, <span class=\"pl-c1\">TOKEN_PREFIX</span> <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>=<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> jwtToken);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pj892031", "createdAt": "2020-09-03T15:16:53Z", "path": "zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/ZaasJwtService.java", "diffHunk": "@@ -86,7 +86,7 @@ public ZaasToken query(String jwtToken) throws ZaasClientException {\n     }\n \n     private ClientWithResponse queryWithJwtToken(String jwtToken) throws ZaasConfigurationException, IOException {\n-        CloseableHttpClient client = httpsClientProvider.getHttpsClientWithTrustStore();\n+        CloseableHttpClient client = httpClientProvider.getHttpClient();\n         HttpGet httpGet = new HttpGet(queryEndpoint);\n         httpGet.addHeader(\"Cookie\", TOKEN_PREFIX + \"=\" + jwtToken);", "originalCommit": "841c028e8d10915144dfad4e52e2aa12334ba06f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA1OTM0MQ==", "url": "https://github.com/zowe/api-layer/pull/816#discussion_r483059341", "body": "```suggestion\r\nimport java.util.stream.Stream;\r\nimport org.apache.http.cookie.SM;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import java.util.stream.Stream;\n          \n          \n            \n            import java.util.stream.Stream;\n          \n          \n            \n            import org.apache.http.cookie.SM;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"32\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">java.util.stream.Stream</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"32\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">java.util.stream.Stream</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"33\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.http.cookie.SM</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "pj892031", "createdAt": "2020-09-03T15:18:45Z", "path": "zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/ZaasJwtService.java", "diffHunk": "@@ -32,15 +32,15 @@\n import java.util.stream.Stream;", "originalCommit": "841c028e8d10915144dfad4e52e2aa12334ba06f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA1OTc1Nw==", "url": "https://github.com/zowe/api-layer/pull/816#discussion_r483059757", "body": "Also possible to replace \"Set-cookie\" with SM.SET_COOKIE (line 118)", "bodyText": "Also possible to replace \"Set-cookie\" with SM.SET_COOKIE (line 118)", "bodyHTML": "<p dir=\"auto\">Also possible to replace \"Set-cookie\" with SM.SET_COOKIE (line 118)</p>", "author": "pj892031", "createdAt": "2020-09-03T15:19:13Z", "path": "zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/ZaasJwtService.java", "diffHunk": "@@ -32,15 +32,15 @@\n import java.util.stream.Stream;", "originalCommit": "841c028e8d10915144dfad4e52e2aa12334ba06f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3MzgzNg==", "url": "https://github.com/zowe/api-layer/pull/816#discussion_r483073836", "bodyText": "Done", "author": "plavjanik", "createdAt": "2020-09-03T15:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA1OTc1Nw=="}], "type": "inlineReview"}, {"oid": "dafc76fbf33b08b4d64756672929afdaa7a99058", "url": "https://github.com/zowe/api-layer/commit/dafc76fbf33b08b4d64756672929afdaa7a99058", "message": "Update zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/PassTicketServiceImpl.java\n\nCo-authored-by: Pavel Jare\u0161 <58428711+pj892031@users.noreply.github.com>", "committedDate": "2020-09-03T15:23:25Z", "type": "commit"}, {"oid": "19432be684a069d4b24e3d48693e5f785e7e8ce4", "url": "https://github.com/zowe/api-layer/commit/19432be684a069d4b24e3d48693e5f785e7e8ce4", "message": "Update zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/PassTicketServiceImpl.java\n\nCo-authored-by: Pavel Jare\u0161 <58428711+pj892031@users.noreply.github.com>", "committedDate": "2020-09-03T15:23:32Z", "type": "commit"}, {"oid": "198e9972aa004241e0232c4ec7b9a5a294274e18", "url": "https://github.com/zowe/api-layer/commit/198e9972aa004241e0232c4ec7b9a5a294274e18", "message": "Update zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/ZaasHttpClientProvider.java\n\nCo-authored-by: Pavel Jare\u0161 <58428711+pj892031@users.noreply.github.com>", "committedDate": "2020-09-03T15:23:39Z", "type": "commit"}, {"oid": "cf9c50384d2b199795af8384d62c3c1e9b3ba573", "url": "https://github.com/zowe/api-layer/commit/cf9c50384d2b199795af8384d62c3c1e9b3ba573", "message": "Update zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/ZaasJwtService.java\n\nCo-authored-by: Pavel Jare\u0161 <58428711+pj892031@users.noreply.github.com>", "committedDate": "2020-09-03T15:23:47Z", "type": "commit"}, {"oid": "f8c5eede8bb1272bc15a9c6fb3e5dfbcec8a23b2", "url": "https://github.com/zowe/api-layer/commit/f8c5eede8bb1272bc15a9c6fb3e5dfbcec8a23b2", "message": "Update zaas-client/src/main/java/org/zowe/apiml/zaasclient/service/internal/ZaasJwtService.java\n\nCo-authored-by: Pavel Jare\u0161 <58428711+pj892031@users.noreply.github.com>", "committedDate": "2020-09-03T15:23:54Z", "type": "commit"}, {"oid": "85424c5219afdd82d778656a20dc6814dec6019d", "url": "https://github.com/zowe/api-layer/commit/85424c5219afdd82d778656a20dc6814dec6019d", "message": "Use constant instead of inline string", "committedDate": "2020-09-03T15:37:30Z", "type": "commit"}]}