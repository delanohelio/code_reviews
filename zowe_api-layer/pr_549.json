{"pr_number": 549, "pr_title": "Penetration testing of JWT", "pr_author": "JirkaAichler", "pr_createdAt": "2020-03-10T11:14:39Z", "pr_url": "https://github.com/zowe/api-layer/pull/549", "timeline": [{"oid": "935070bed19849c61ac7a255a0ffb44e5074564a", "url": "https://github.com/zowe/api-layer/commit/935070bed19849c61ac7a255a0ffb44e5074564a", "message": "Add penetration testing of JWT\n\nSigned-off-by: JirkaAichler <jiri.aichler@broadcom.com>", "committedDate": "2020-03-10T11:09:16Z", "type": "commit"}, {"oid": "3c8a7307c95e1f6f8503ce36357fa9e7315e97bd", "url": "https://github.com/zowe/api-layer/commit/3c8a7307c95e1f6f8503ce36357fa9e7315e97bd", "message": "extending penetration tests about JWT (multiple cases and endpoints)\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-13T15:26:27Z", "type": "commit"}, {"oid": "77ff9c22859cba70954d52da00bed9395e55ca6d", "url": "https://github.com/zowe/api-layer/commit/77ff9c22859cba70954d52da00bed9395e55ca6d", "message": "Merge branch 'master' into protectors/jwtTest", "committedDate": "2020-03-16T12:33:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEzMzI0OQ==", "url": "https://github.com/zowe/api-layer/pull/549#discussion_r393133249", "body": "```suggestion\r\n * - PassTicket endpoint on Gateway (covered by Spring Security, see authorized access)\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * - passTicket endpoint on Gateway (covered by Spring security, see authorized access)\n          \n          \n            \n             * - PassTicket endpoint on Gateway (covered by Spring Security, see authorized access)", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"> <span class=\"pl-k\">*</span> <span class=\"pl-k\">-</span> <span class=\"x x-first x-last\">passTicket</span> endpoint on <span class=\"pl-smi\">Gateway</span> (covered by <span class=\"pl-smi\">Spring</span> <span class=\"x x-first x-last\">security</span>, see authorized access)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span> <span class=\"pl-k\">-</span> <span class=\"pl-smi x x-first x-last\">PassTicket</span> endpoint on <span class=\"pl-smi\">Gateway</span> (covered by <span class=\"pl-smi\">Spring</span> <span class=\"pl-smi x x-first x-last\">Security</span>, see authorized access)</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "plavjanik", "createdAt": "2020-03-16T16:01:19Z", "path": "integration-tests/src/test/java/org/zowe/apiml/penetration/JwtPenTest.java", "diffHunk": "@@ -0,0 +1,339 @@\n+package org.zowe.apiml.penetration;\n+\n+import io.jsonwebtoken.Jwts;\n+import io.jsonwebtoken.SignatureAlgorithm;\n+import io.restassured.RestAssured;\n+import org.json.JSONObject;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.zowe.apiml.gatewayservice.SecurityUtils;\n+import org.zowe.apiml.security.HttpsConfig;\n+import org.zowe.apiml.security.common.ticket.TicketRequest;\n+import org.zowe.apiml.util.config.ConfigReader;\n+import org.zowe.apiml.util.config.EnvironmentConfiguration;\n+import org.zowe.apiml.util.config.TlsConfiguration;\n+\n+import java.nio.charset.StandardCharsets;\n+import java.security.PublicKey;\n+import java.util.Base64;\n+\n+import static io.restassured.RestAssured.given;\n+import static io.restassured.http.ContentType.JSON;\n+import static org.apache.http.HttpStatus.SC_OK;\n+import static org.apache.http.HttpStatus.SC_UNAUTHORIZED;\n+import static org.hamcrest.core.Is.is;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.zowe.apiml.gatewayservice.SecurityUtils.getConfiguredSslConfig;\n+import static org.zowe.apiml.security.SecurityUtils.loadPublicKey;\n+\n+/*\n+ * Penetration testing of JWT\n+ *\n+ * Based on the following article:\n+ * https://medium.com/101-writeups/hacking-json-web-token-jwt-233fe6c862e6\n+ *\n+ * It tests three type of endpoints:\n+ * - query endpoint (verify JWT token)\n+ * - passTicket endpoint on Gateway (covered by Spring security, see authorized access)", "originalCommit": "77ff9c22859cba70954d52da00bed9395e55ca6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEzMzUyMQ==", "url": "https://github.com/zowe/api-layer/pull/549#discussion_r393133521", "body": "``\r\n```suggestion\r\n * - PassTicket endpoint on Discoverable client (through server command's treatment)\r\n```", "bodyText": "``\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * - passTicket endpoint on Discoverable client (through server command's treatment)\n          \n          \n            \n             * - PassTicket endpoint on Discoverable client (through server command's treatment)", "bodyHTML": "<p dir=\"auto\">``</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"> <span class=\"pl-k\">*</span> <span class=\"pl-k\">-</span> <span class=\"x x-first x-last\">passTicket</span> endpoint on <span class=\"pl-smi\">Discoverable</span> client (through server command<span class=\"pl-s\"><span class=\"pl-pds\">'</span>s treatment)</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span> <span class=\"pl-k\">-</span> <span class=\"pl-smi x x-first x-last\">PassTicket</span> endpoint on <span class=\"pl-smi\">Discoverable</span> client (through server command<span class=\"pl-s\"><span class=\"pl-pds\">'</span>s treatment)</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "plavjanik", "createdAt": "2020-03-16T16:01:43Z", "path": "integration-tests/src/test/java/org/zowe/apiml/penetration/JwtPenTest.java", "diffHunk": "@@ -0,0 +1,339 @@\n+package org.zowe.apiml.penetration;\n+\n+import io.jsonwebtoken.Jwts;\n+import io.jsonwebtoken.SignatureAlgorithm;\n+import io.restassured.RestAssured;\n+import org.json.JSONObject;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.zowe.apiml.gatewayservice.SecurityUtils;\n+import org.zowe.apiml.security.HttpsConfig;\n+import org.zowe.apiml.security.common.ticket.TicketRequest;\n+import org.zowe.apiml.util.config.ConfigReader;\n+import org.zowe.apiml.util.config.EnvironmentConfiguration;\n+import org.zowe.apiml.util.config.TlsConfiguration;\n+\n+import java.nio.charset.StandardCharsets;\n+import java.security.PublicKey;\n+import java.util.Base64;\n+\n+import static io.restassured.RestAssured.given;\n+import static io.restassured.http.ContentType.JSON;\n+import static org.apache.http.HttpStatus.SC_OK;\n+import static org.apache.http.HttpStatus.SC_UNAUTHORIZED;\n+import static org.hamcrest.core.Is.is;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.zowe.apiml.gatewayservice.SecurityUtils.getConfiguredSslConfig;\n+import static org.zowe.apiml.security.SecurityUtils.loadPublicKey;\n+\n+/*\n+ * Penetration testing of JWT\n+ *\n+ * Based on the following article:\n+ * https://medium.com/101-writeups/hacking-json-web-token-jwt-233fe6c862e6\n+ *\n+ * It tests three type of endpoints:\n+ * - query endpoint (verify JWT token)\n+ * - passTicket endpoint on Gateway (covered by Spring security, see authorized access)\n+ * - passTicket endpoint on Discoverable client (through server command's treatment)", "originalCommit": "77ff9c22859cba70954d52da00bed9395e55ca6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "850bb808acdcfdc97b0c1ee0818f00338554fd47", "url": "https://github.com/zowe/api-layer/commit/850bb808acdcfdc97b0c1ee0818f00338554fd47", "message": "Update integration-tests/src/test/java/org/zowe/apiml/penetration/JwtPenTest.java", "committedDate": "2020-03-16T19:54:34Z", "type": "commit"}, {"oid": "9ab3974d71ec7bfa4fb6f68e8da190595364b925", "url": "https://github.com/zowe/api-layer/commit/9ab3974d71ec7bfa4fb6f68e8da190595364b925", "message": "Update integration-tests/src/test/java/org/zowe/apiml/penetration/JwtPenTest.java", "committedDate": "2020-03-16T19:54:41Z", "type": "commit"}, {"oid": "31db13c1014628cbeddb31524584758f15812380", "url": "https://github.com/zowe/api-layer/commit/31db13c1014628cbeddb31524584758f15812380", "message": "Merge branch 'master' into protectors/jwtTest", "committedDate": "2020-03-17T13:05:55Z", "type": "commit"}, {"oid": "f33efc3c6567eef75632eabc6bba62e063e91657", "url": "https://github.com/zowe/api-layer/commit/f33efc3c6567eef75632eabc6bba62e063e91657", "message": "Add license\n\nSigned-off-by: JirkaAichler <jiri.aichler@broadcom.com>", "committedDate": "2020-03-17T13:51:13Z", "type": "commit"}, {"oid": "4de73b38058a5e2cfcef72f59f26bd3c65be5b8d", "url": "https://github.com/zowe/api-layer/commit/4de73b38058a5e2cfcef72f59f26bd3c65be5b8d", "message": "Merge remote-tracking branch 'origin/protectors/jwtTest' into protectors/jwtTest", "committedDate": "2020-03-17T13:51:34Z", "type": "commit"}, {"oid": "8076252037dbc7710d08a29de5c5770cd55206a8", "url": "https://github.com/zowe/api-layer/commit/8076252037dbc7710d08a29de5c5770cd55206a8", "message": "fix security issue\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-19T09:25:53Z", "type": "commit"}, {"oid": "bbd8caaecf7488f3f46a1e15f9fafdbc450d6791", "url": "https://github.com/zowe/api-layer/commit/bbd8caaecf7488f3f46a1e15f9fafdbc450d6791", "message": "Merge branch 'master' into protectors/jwtTest", "committedDate": "2020-03-19T18:11:02Z", "type": "commit"}, {"oid": "9602c8ffc9b2c853376b43bdc814d3e481ca36e1", "url": "https://github.com/zowe/api-layer/commit/9602c8ffc9b2c853376b43bdc814d3e481ca36e1", "message": "fix tests with invalid tokens and refactor of JwtPenTest\n\nSigned-off-by: Pavel Jare\u0161 <pavel.jares@broadcom.com>", "committedDate": "2020-03-19T21:55:53Z", "type": "commit"}, {"oid": "666a4a15fdfbd5b395aa77c6f06f5c8bb97b15b5", "url": "https://github.com/zowe/api-layer/commit/666a4a15fdfbd5b395aa77c6f06f5c8bb97b15b5", "message": "Merge branch 'master' into protectors/jwtTest", "committedDate": "2020-03-23T09:13:39Z", "type": "commit"}, {"oid": "e1b0e16927e1e48e9c9f72c3d5f6b338f0ea528d", "url": "https://github.com/zowe/api-layer/commit/e1b0e16927e1e48e9c9f72c3d5f6b338f0ea528d", "message": "attempt to remove useJUnitPlatform", "committedDate": "2020-03-24T08:57:21Z", "type": "commit"}]}