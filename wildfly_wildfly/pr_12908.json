{"pr_number": 12908, "pr_title": "WFLY-12961 Fix intermittent deadlock between LocalScheduler.close() and run()", "pr_author": "pferraro", "pr_createdAt": "2020-01-14T13:28:09Z", "pr_url": "https://github.com/wildfly/wildfly/pull/12908", "timeline": [{"oid": "a9d45a38ed96be4785d45a4f8e405cd5402e55fd", "url": "https://github.com/wildfly/wildfly/commit/a9d45a38ed96be4785d45a4f8e405cd5402e55fd", "message": "WFLY-12961 Fix intermittent deadlock between LocalScheduler.close() and run()", "committedDate": "2020-01-14T13:41:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU2NTEyNw==", "url": "https://github.com/wildfly/wildfly/pull/12908#discussion_r366565127", "body": "@pferraro So it's ok if any executing run() method gets interrupted and any scheduled but not yet executed run() doesn't get called?\r\n\r\nI figure yes, but I'm asking because this seems to be the key change in the PR.", "bodyText": "@pferraro So it's ok if any executing run() method gets interrupted and any scheduled but not yet executed run() doesn't get called?\nI figure yes, but I'm asking because this seems to be the key change in the PR.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/pferraro/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/pferraro\">@pferraro</a> So it's ok if any executing run() method gets interrupted and any scheduled but not yet executed run() doesn't get called?</p>\n<p dir=\"auto\">I figure yes, but I'm asking because this seems to be the key change in the PR.</p>", "author": "bstansberry", "createdAt": "2020-01-14T20:49:33Z", "path": "clustering/ee/cache/src/main/java/org/wildfly/clustering/ee/cache/scheduler/LocalScheduler.java", "diffHunk": "@@ -115,15 +115,13 @@ public void accept(Map.Entry<T, Instant> entry) {\n     }\n \n     @Override\n-    public synchronized void close() {\n-        WildFlySecurityManager.doPrivilegedWithParameter(this.executor, DefaultExecutorService.SHUTDOWN_ACTION);\n-        if (this.future != null) {\n+    public void close() {\n+        WildFlySecurityManager.doPrivilegedWithParameter(this.executor, DefaultExecutorService.SHUTDOWN_NOW_ACTION);", "originalCommit": "a9d45a38ed96be4785d45a4f8e405cd5402e55fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4NjM5NA==", "url": "https://github.com/wildfly/wildfly/pull/12908#discussion_r366586394", "bodyText": "Correct.", "author": "pferraro", "createdAt": "2020-01-14T21:39:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU2NTEyNw=="}], "type": "inlineReview"}, {"oid": "e4d4050e3c30af40a7a6d9651b5e2c1988b285c5", "url": "https://github.com/wildfly/wildfly/commit/e4d4050e3c30af40a7a6d9651b5e2c1988b285c5", "message": "WFLY-12961 Fix intermittent deadlock between LocalScheduler.close() and run()", "committedDate": "2020-01-15T02:15:58Z", "type": "commit"}, {"oid": "e4d4050e3c30af40a7a6d9651b5e2c1988b285c5", "url": "https://github.com/wildfly/wildfly/commit/e4d4050e3c30af40a7a6d9651b5e2c1988b285c5", "message": "WFLY-12961 Fix intermittent deadlock between LocalScheduler.close() and run()", "committedDate": "2020-01-15T02:15:58Z", "type": "forcePushed"}]}