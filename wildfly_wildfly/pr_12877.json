{"pr_number": 12877, "pr_title": "WFLY-4699 Expose EJB3 deployment information at runtime", "pr_author": "chengfang", "pr_createdAt": "2020-01-06T05:20:44Z", "pr_url": "https://github.com/wildfly/wildfly/pull/12877", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQyNzkyMQ==", "url": "https://github.com/wildfly/wildfly/pull/12877#discussion_r411427921", "body": "@chengfang I can't find tests related to `Bean statistics (execution-time, invocations, methods, peak-concurrent-invocations and wait-time)` for `Message-driven Beans`: I expected to find those tests in `EjbInvocationStatisticsTestCase` but it only covers SLSB, SFSB and Singletons; can you point me at them?", "bodyText": "@chengfang I can't find tests related to Bean statistics (execution-time, invocations, methods, peak-concurrent-invocations and wait-time) for Message-driven Beans: I expected to find those tests in EjbInvocationStatisticsTestCase but it only covers SLSB, SFSB and Singletons; can you point me at them?", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chengfang/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chengfang\">@chengfang</a> I can't find tests related to <code>Bean statistics (execution-time, invocations, methods, peak-concurrent-invocations and wait-time)</code> for <code>Message-driven Beans</code>: I expected to find those tests in <code>EjbInvocationStatisticsTestCase</code> but it only covers SLSB, SFSB and Singletons; can you point me at them?</p>", "author": "tommaso-borgato", "createdAt": "2020-04-20T14:33:15Z", "path": "testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/ejb/management/deployments/EjbJarRuntimeResourceTestBase.java", "diffHunk": "@@ -72,8 +75,36 @@\n     private static final String[] POOL_ATTRIBUTES =\n             {\"pool-available-count\", \"pool-create-count\", \"pool-current-size\", POOL_NAME, \"pool-max-size\", \"pool-remove-count\"};\n \n-    private static final String[] TIMER_ATTRIBUTES = { \"time-remaining\", \"next-timeout\", \"calendar-timer\"};\n-    private static final String[] SCHEDULE_ATTRIBUTES = { \"day-of-month\", \"day-of-week\", \"hour\", \"minute\", \"year\", \"timezone\", \"start\", \"end\" };\n+    private static final String[] TIMER_ATTRIBUTES = {\"time-remaining\", \"next-timeout\", \"calendar-timer\"};\n+    private static final String[] SCHEDULE_ATTRIBUTES = {\"day-of-month\", \"day-of-week\", \"hour\", \"minute\", \"year\", \"timezone\", \"start\", \"end\"};\n+\n+    private static final String JNDI_NAMES = \"jndi-names\";\n+    private static final String BUSINESS_LOCAL = \"business-local\";\n+    private static final String BUSINESS_REMOTE = \"business-remote\";\n+    private static final String TIMEOUT_METHOD = \"timeout-method\";\n+    private static final String ASYNC_METHODS = \"async-methods\";\n+    private static final String TRANSACTION_TYPE = \"transaction-type\";\n+\n+    // MDB specific resource names\n+    private static final String ACTIVATION_CONFIG = \"activation-config\";\n+    private static final String MESSAGING_TYPE = \"messaging-type\";\n+    private static final String MESSAGE_DESTINATION_TYPE = \"message-destination-type\";\n+    private static final String MESSAGE_DESTINATION_LINK = \"message-destination-link\";\n+\n+    // STATEFUL specific resource names\n+    private static final String STATEFUL_TIMEOUT = \"stateful-timeout\";\n+    private static final String AFTER_BEGIN_METHOD = \"after-begin-method\";\n+    private static final String BEFORE_COMPLETION_METHOD = \"before-completion-method\";\n+    private static final String AFTER_COMPLETION_METHOD = \"after-completion-method\";\n+    private static final String PASSIVATION_CAPABLE = \"passivation-capable\";\n+    private static final String REMOVE_METHODS = \"remove-methods\";\n+    private static final String RETAIN_IF_EXCEPTION = \"retain-if-exception\";\n+    private static final String BEAN_METHOD = \"bean-method\";\n+\n+    // SINGLETON specific resource names\n+    private static final String DEPENDS_ON = \"depends-on\";\n+    private static final String INIT_ON_STARTUP = \"init-on-startup\";\n+    private static final String CONCURRENCY_MANAGEMENT_TYPE = \"concurrency-management-type\";\n ", "originalCommit": "7a45266e0354e5f69f0cc29e8e3ade22b30d927e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUxNzAyNA==", "url": "https://github.com/wildfly/wildfly/pull/12877#discussion_r412517024", "bodyText": "@tommaso-borgato  these bean stats are existing features (already there before we implement this feature), so they are not covered by this PR.", "author": "chengfang", "createdAt": "2020-04-21T21:52:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQyNzkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ1ODA2Mg==", "url": "https://github.com/wildfly/wildfly/pull/12877#discussion_r425458062", "body": "@chengfang For all the various LIST attributes you should used one of the ListAttributeDefinition impls. My guess is all of them are essentially List of String, so use StringListAttributeDefinition. The pattern would be\r\n\r\n```\r\nstatic final SimpleAttributeDefinition JNDI_NAMES = StringListAttributeDefinition.Builder.of(\"jndi-names\")     \r\n```\r\n\r\nfollowed by what you've got now.\r\n\r\nThis results in the management API description having the correct 'value-type' as discussed in https://docs.wildfly.org/19.1/Admin_Guide.html#description-of-an-attribute", "bodyText": "@chengfang For all the various LIST attributes you should used one of the ListAttributeDefinition impls. My guess is all of them are essentially List of String, so use StringListAttributeDefinition. The pattern would be\nstatic final SimpleAttributeDefinition JNDI_NAMES = StringListAttributeDefinition.Builder.of(\"jndi-names\")     \n\nfollowed by what you've got now.\nThis results in the management API description having the correct 'value-type' as discussed in https://docs.wildfly.org/19.1/Admin_Guide.html#description-of-an-attribute", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/chengfang/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/chengfang\">@chengfang</a> For all the various LIST attributes you should used one of the ListAttributeDefinition impls. My guess is all of them are essentially List of String, so use StringListAttributeDefinition. The pattern would be</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"static final SimpleAttributeDefinition JNDI_NAMES = StringListAttributeDefinition.Builder.of(&quot;jndi-names&quot;)     \"><pre><code>static final SimpleAttributeDefinition JNDI_NAMES = StringListAttributeDefinition.Builder.of(\"jndi-names\")     \n</code></pre></div>\n<p dir=\"auto\">followed by what you've got now.</p>\n<p dir=\"auto\">This results in the management API description having the correct 'value-type' as discussed in <a href=\"https://docs.wildfly.org/19.1/Admin_Guide.html#description-of-an-attribute\" rel=\"nofollow\">https://docs.wildfly.org/19.1/Admin_Guide.html#description-of-an-attribute</a></p>", "author": "bstansberry", "createdAt": "2020-05-14T22:07:08Z", "path": "ejb3/src/main/java/org/jboss/as/ejb3/subsystem/deployment/AbstractEJBComponentResourceDefinition.java", "diffHunk": "@@ -51,11 +51,35 @@\n  */\n public abstract class AbstractEJBComponentResourceDefinition extends SimpleResourceDefinition {\n \n-    public static final SimpleAttributeDefinition COMPONENT_CLASS_NAME = new SimpleAttributeDefinitionBuilder(\"component-class-name\", ModelType.STRING)\n+     static final SimpleAttributeDefinition COMPONENT_CLASS_NAME = new SimpleAttributeDefinitionBuilder(\"component-class-name\", ModelType.STRING)\n             .setValidator(new StringLengthValidator(1))\n             .setFlags(AttributeAccess.Flag.STORAGE_RUNTIME)\n             .build();\n \n+     static final SimpleAttributeDefinition JNDI_NAMES = new SimpleAttributeDefinitionBuilder(\"jndi-names\", ModelType.LIST)", "originalCommit": "7a45266e0354e5f69f0cc29e8e3ade22b30d927e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c94d8cda065096ed38d209a92c5ad3eb33ee1bf2", "url": "https://github.com/wildfly/wildfly/commit/c94d8cda065096ed38d209a92c5ad3eb33ee1bf2", "message": "WFLY-4699 Expose EJB3 deployment information at runtime", "committedDate": "2020-05-16T13:43:39Z", "type": "commit"}, {"oid": "f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba", "url": "https://github.com/wildfly/wildfly/commit/f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba", "message": "WFLY-4699 Expose EJB3 deployment info (use StringListAttributeDefinition for list-type attributes)", "committedDate": "2020-05-17T13:43:49Z", "type": "commit"}, {"oid": "f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba", "url": "https://github.com/wildfly/wildfly/commit/f75198e76a0a4b82267a5c3e0e87ee8c2316d8ba", "message": "WFLY-4699 Expose EJB3 deployment info (use StringListAttributeDefinition for list-type attributes)", "committedDate": "2020-05-17T13:43:49Z", "type": "forcePushed"}]}