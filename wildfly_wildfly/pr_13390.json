{"pr_number": 13390, "pr_title": "[WFLY-13626] make transaction subsytem CMR attributes optional", "pr_author": "ochaloup", "pr_createdAt": "2020-06-30T18:03:41Z", "pr_url": "https://github.com/wildfly/wildfly/pull/13390", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk5MDc5Nw==", "url": "https://github.com/wildfly/wildfly/pull/13390#discussion_r447990797", "body": "@ochaloup The parser can't do this. It needs to preserve what it read from the xml, not introduce default values into the management model that were not what the user put in the xml. The subsystem can use a default value from the AttributeDefinition to configure the runtime services, but what's stored in the management model should reflect the user provided configuration.\r\n\r\nIt appears this method is only called by the parseCM method, so I think just eliminating the 'else' block that throws missingRequired would be fine.", "bodyText": "@ochaloup The parser can't do this. It needs to preserve what it read from the xml, not introduce default values into the management model that were not what the user put in the xml. The subsystem can use a default value from the AttributeDefinition to configure the runtime services, but what's stored in the management model should reflect the user provided configuration.\nIt appears this method is only called by the parseCM method, so I think just eliminating the 'else' block that throws missingRequired would be fine.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ochaloup/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ochaloup\">@ochaloup</a> The parser can't do this. It needs to preserve what it read from the xml, not introduce default values into the management model that were not what the user put in the xml. The subsystem can use a default value from the AttributeDefinition to configure the runtime services, but what's stored in the management model should reflect the user provided configuration.</p>\n<p dir=\"auto\">It appears this method is only called by the parseCM method, so I think just eliminating the 'else' block that throws missingRequired would be fine.</p>", "author": "bstansberry", "createdAt": "2020-06-30T21:30:30Z", "path": "transactions/src/main/java/org/jboss/as/txn/subsystem/TransactionSubsystem15Parser.java", "diffHunk": "@@ -181,7 +168,7 @@ private void parseCM(XMLExtendedStreamReader reader, List<ModelNode> operations)\n     }\n \n     private void addAttribute(XMLExtendedStreamReader reader, ModelNode operation, SimpleAttributeDefinition attributeDefinition) throws XMLStreamException {\n-        String value = rawAttributeText(reader, attributeDefinition.getXmlName(), null);\n+        String value = rawAttributeText(reader, attributeDefinition.getXmlName(), attributeDefinition.getDefaultValue().asString());", "originalCommit": "2f40381b0129e27a26ba06d925325778dba46c31", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk5MDk1NA==", "url": "https://github.com/wildfly/wildfly/pull/13390#discussion_r447990954", "body": "Same comment as I made for TransactionSubsystem15Parser.", "bodyText": "Same comment as I made for TransactionSubsystem15Parser.", "bodyHTML": "<p dir=\"auto\">Same comment as I made for TransactionSubsystem15Parser.</p>", "author": "bstansberry", "createdAt": "2020-06-30T21:30:52Z", "path": "transactions/src/main/java/org/jboss/as/txn/subsystem/TransactionSubsystem30Parser.java", "diffHunk": "@@ -185,7 +172,7 @@ private void parseCM(XMLExtendedStreamReader reader, List<ModelNode> operations)\n     }\n \n     private void addAttribute(XMLExtendedStreamReader reader, ModelNode operation, SimpleAttributeDefinition attributeDefinition) throws XMLStreamException {\n-        String value = rawAttributeText(reader, attributeDefinition.getXmlName(), null);\n+        String value = rawAttributeText(reader, attributeDefinition.getXmlName(), attributeDefinition.getDefaultValue().asString());", "originalCommit": "2f40381b0129e27a26ba06d925325778dba46c31", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "998108459873a5d174c682504bcd0c32beb2e842", "url": "https://github.com/wildfly/wildfly/commit/998108459873a5d174c682504bcd0c32beb2e842", "message": "[WFLY-13626] make transaction subsytem CMR attributes optional", "committedDate": "2020-07-01T08:28:42Z", "type": "commit"}, {"oid": "998108459873a5d174c682504bcd0c32beb2e842", "url": "https://github.com/wildfly/wildfly/commit/998108459873a5d174c682504bcd0c32beb2e842", "message": "[WFLY-13626] make transaction subsytem CMR attributes optional", "committedDate": "2020-07-01T08:28:42Z", "type": "forcePushed"}]}