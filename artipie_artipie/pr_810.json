{"pr_number": 810, "pr_title": "#797 - Get value for different extensions ", "pr_author": "genryxy", "pr_createdAt": "2020-12-15T15:32:48Z", "pr_url": "https://github.com/artipie/artipie/pull/810", "timeline": [{"oid": "238a700a1f1d2c0d2833eaf3f0d04330af54d885", "url": "https://github.com/artipie/artipie/commit/238a700a1f1d2c0d2833eaf3f0d04330af54d885", "message": "#797 - Add valueFrom for ConfigFiles", "committedDate": "2020-12-15T15:30:12Z", "type": "commit"}, {"oid": "853c7c7a08076fe44121418ee37553c02d71c35d", "url": "https://github.com/artipie/artipie/commit/853c7c7a08076fe44121418ee37553c02d71c35d", "message": "#797 - Fix test", "committedDate": "2020-12-15T16:17:40Z", "type": "commit"}, {"oid": "78d48c48b3217c8a6702719a1ba2bc67c8a16057", "url": "https://github.com/artipie/artipie/commit/78d48c48b3217c8a6702719a1ba2bc67c8a16057", "message": "#797 - Remove suppressWarning", "committedDate": "2020-12-15T16:20:59Z", "type": "commit"}, {"oid": "5dfd94d104cee5319b38f03876e129db737c5537", "url": "https://github.com/artipie/artipie/commit/5dfd94d104cee5319b38f03876e129db737c5537", "message": "#797 - Fix qulice", "committedDate": "2020-12-15T16:51:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4MjA4Mg==", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544082082", "body": "@genryxy I'd suggest to not have this constant, but instead create a method that extract extension (if any) from filename", "bodyText": "@genryxy I'd suggest to not have this constant, but instead create a method that extract extension (if any) from filename", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> I'd suggest to not have this constant, but instead create a method that extract extension (if any) from filename</p>", "author": "olegmoz", "createdAt": "2020-12-16T07:50:45Z", "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -50,12 +52,17 @@\n      */\n     private static final Pattern PTN_ALL = Pattern.compile(\"(?<name>.+?)(?<extension>\\\\.[^.]*$|$)\");\n \n+    /**\n+     * Extension group name.\n+     */\n+    private static final String EXTNSN = \"extension\";", "originalCommit": "5dfd94d104cee5319b38f03876e129db737c5537", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4MzY5NA==", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544083694", "body": "@genryxy it's better to return `CompletionStage` then `CompletableFuture`. `CompletableFuture` might be more convenient to use sometimes, but it is not an interface and has methods for completion, that should not be provided to user", "bodyText": "@genryxy it's better to return CompletionStage then CompletableFuture. CompletableFuture might be more convenient to use sometimes, but it is not an interface and has methods for completion, that should not be provided to user", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> it's better to return <code>CompletionStage</code> then <code>CompletableFuture</code>. <code>CompletableFuture</code> might be more convenient to use sometimes, but it is not an interface and has methods for completion, that should not be provided to user</p>", "author": "olegmoz", "createdAt": "2020-12-16T07:53:52Z", "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -76,19 +83,19 @@ public ConfigFile(final Key filename) {\n      * @param storage Storage where the file with different extensions is checked for existence\n      * @return True if a file with either of the two extensions exists, false otherwise.\n      */\n-    public CompletionStage<Boolean> existsIn(final Storage storage) {\n-        final CompletionStage<Boolean> res;\n-        if (this.isYamlOrYml() || this.matcher(\"extension\").isEmpty()) {\n+    public CompletableFuture<Boolean> existsIn(final Storage storage) {", "originalCommit": "5dfd94d104cee5319b38f03876e129db737c5537", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg1NzMxMQ==", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544857311", "bodyText": "@olegmoz I replace CompletionStage with CompletableFuture because StorageAliases#find returns CompletableFuture but now realized that I can just use method toCompletableFuture() to convert.", "author": "genryxy", "createdAt": "2020-12-17T07:06:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4MzY5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NDM1Nw==", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544084357", "body": "@genryxy same concern here about `CompletionStage` vs`CompletableFuture`", "bodyText": "@genryxy same concern here about CompletionStage vsCompletableFuture", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> same concern here about <code>CompletionStage</code> vs<code>CompletableFuture</code></p>", "author": "olegmoz", "createdAt": "2020-12-16T07:55:10Z", "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -100,6 +107,38 @@ public ConfigFile(final Key filename) {\n         return res;\n     }\n \n+    /**\n+     * Obtains contents from the specified storage. If files with both extensions\n+     * exists, the file with `.yaml` extension will be obtained.\n+     * @param storage Storage from which the file is obtained\n+     * @return Content of the file.\n+     */\n+    public CompletableFuture<Content> valueFrom(final Storage storage) {", "originalCommit": "5dfd94d104cee5319b38f03876e129db737c5537", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NDk2MA==", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544084960", "body": "@genryxy I'd suggest to make `key` a method of `Format` class instead of static method", "bodyText": "@genryxy I'd suggest to make key a method of Format class instead of static method", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> I'd suggest to make <code>key</code> a method of <code>Format</code> class instead of static method</p>", "author": "olegmoz", "createdAt": "2020-12-16T07:56:18Z", "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -131,4 +170,50 @@ private String matcher(final String group) {\n         return matcher.group(group);\n     }\n \n+    /**\n+     * Key.\n+     * @param name Filename\n+     * @param extension Extension\n+     * @return Key from filename and extension.\n+     */\n+    private static Key key(final String name, final String extension) {", "originalCommit": "5dfd94d104cee5319b38f03876e129db737c5537", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NTQ0Mw==", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544085443", "body": "@genryxy do not see reason to use 3rd party class `StringUtils` here. `String.format` works here as well.", "bodyText": "@genryxy do not see reason to use 3rd party class StringUtils here. String.format works here as well.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> do not see reason to use 3rd party class <code>StringUtils</code> here. <code>String.format</code> works here as well.</p>", "author": "olegmoz", "createdAt": "2020-12-16T07:57:14Z", "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -131,4 +170,50 @@ private String matcher(final String group) {\n         return matcher.group(group);\n     }\n \n+    /**\n+     * Key.\n+     * @param name Filename\n+     * @param extension Extension\n+     * @return Key from filename and extension.\n+     */\n+    private static Key key(final String name, final String extension) {\n+        return new Key.From(StringUtils.join(\"\", name, extension));", "originalCommit": "5dfd94d104cee5319b38f03876e129db737c5537", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NjQ2Mw==", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544086463", "body": "@genryxy I'd suggest to rename the class to `Extension`, because `.yml` and `.yaml` are not different formats, but extensions. The comment for the class also states that we are talking about extensions.", "bodyText": "@genryxy I'd suggest to rename the class to Extension, because .yml and .yaml are not different formats, but extensions. The comment for the class also states that we are talking about extensions.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> I'd suggest to rename the class to <code>Extension</code>, because <code>.yml</code> and <code>.yaml</code> are not different formats, but extensions. The comment for the class also states that we are talking about extensions.</p>", "author": "olegmoz", "createdAt": "2020-12-16T07:59:19Z", "path": "src/main/java/com/artipie/repo/ConfigFile.java", "diffHunk": "@@ -131,4 +170,50 @@ private String matcher(final String group) {\n         return matcher.group(group);\n     }\n \n+    /**\n+     * Key.\n+     * @param name Filename\n+     * @param extension Extension\n+     * @return Key from filename and extension.\n+     */\n+    private static Key key(final String name, final String extension) {\n+        return new Key.From(StringUtils.join(\"\", name, extension));\n+    }\n+\n+    /**\n+     * Config files extensions.\n+     */\n+    enum Formats {", "originalCommit": "5dfd94d104cee5319b38f03876e129db737c5537", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDExNDk1OQ==", "url": "https://github.com/artipie/artipie/pull/810#discussion_r544114959", "body": "@genryxy `@CsvSource` is not needed here, it's easier to use `@ValueSource` for single argument tests", "bodyText": "@genryxy @CsvSource is not needed here, it's easier to use @ValueSource for single argument tests", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> <code>@CsvSource</code> is not needed here, it's easier to use <code>@ValueSource</code> for single argument tests</p>", "author": "olegmoz", "createdAt": "2020-12-16T08:47:15Z", "path": "src/test/java/com/artipie/repo/ConfigFileTest.java", "diffHunk": "@@ -38,26 +40,65 @@\n  * Test cases for {@link ConfigFile}.\n  * @since 0.14\n  */\n+@SuppressWarnings(\"PMD.AvoidDuplicateLiterals\")\n final class ConfigFileTest {\n \n     /**\n      * Filename.\n      */\n     private static final String NAME = \"my-file\";\n \n+    /**\n+     * Content.\n+     */\n+    private static final byte[] CONTENT = \"content from config file\".getBytes();\n+\n     @ParameterizedTest\n     @CsvSource({\".yaml\", \".yml\", \"''\"})\n-    void existInStorageReturnsWhenYamlExist(final String extension) {\n+    void existInStorageReturnsTrueWhenYamlExist(final String extension) {\n         final Storage storage = new InMemoryStorage();\n         this.saveByKey(storage, \".yaml\");\n         MatcherAssert.assertThat(\n             new ConfigFile(new Key.From(ConfigFileTest.NAME + extension))\n                 .existsIn(storage)\n-                .toCompletableFuture().join(),\n+                .join(),\n             new IsEqual<>(true)\n         );\n     }\n \n+    @ParameterizedTest\n+    @CsvSource({\".yaml\", \".yml\", \"''\"})", "originalCommit": "5dfd94d104cee5319b38f03876e129db737c5537", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a40dfec52f17627b4ac109a2dbcf969507f375de", "url": "https://github.com/artipie/artipie/commit/a40dfec52f17627b4ac109a2dbcf969507f375de", "message": "#797 - Changes by review", "committedDate": "2020-12-17T07:05:43Z", "type": "commit"}, {"oid": "4efe634be81b054afa5c025f237cc4dc4622f69f", "url": "https://github.com/artipie/artipie/commit/4efe634be81b054afa5c025f237cc4dc4622f69f", "message": "#797 - Remove unnecessary transoformation", "committedDate": "2020-12-17T07:10:12Z", "type": "commit"}, {"oid": "d5515304dc7a80ff9dd084fbe09fd7d36b762b16", "url": "https://github.com/artipie/artipie/commit/d5515304dc7a80ff9dd084fbe09fd7d36b762b16", "message": "Merge branch 'master' into 797-valuefrom-diff-extensions", "committedDate": "2020-12-17T10:27:35Z", "type": "commit"}]}