{"pr_number": 827, "pr_title": "#826 - Verbose output for IT cases", "pr_author": "genryxy", "pr_createdAt": "2020-12-25T07:37:30Z", "pr_url": "https://github.com/artipie/artipie/pull/827", "timeline": [{"oid": "7c44e3aa1222a4008490f0e19fa556a522a4476d", "url": "https://github.com/artipie/artipie/commit/7c44e3aa1222a4008490f0e19fa556a522a4476d", "message": "#826 - Verbose output for IT cases", "committedDate": "2020-12-25T07:35:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgyODExMw==", "url": "https://github.com/artipie/artipie/pull/827#discussion_r548828113", "body": "@genryxy that looks like too complicated logic for output. I'd suggest to just print stdout and stderr after every command executed as `DEBUG` logging message and throw stderr content as exception if error code is not zero.", "bodyText": "@genryxy that looks like too complicated logic for output. I'd suggest to just print stdout and stderr after every command executed as DEBUG logging message and throw stderr content as exception if error code is not zero.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> that looks like too complicated logic for output. I'd suggest to just print stdout and stderr after every command executed as <code>DEBUG</code> logging message and throw stderr content as exception if error code is not zero.</p>", "author": "olegmoz", "createdAt": "2020-12-25T08:00:47Z", "path": "src/test/java/com/artipie/test/TestContainer.java", "diffHunk": "@@ -106,4 +133,20 @@ public void close() {\n         Logger.debug(this, \"Command:\\n%s\", String.join(\" \", command));\n         return this.cntn.execInContainer(command);\n     }\n+\n+    /**\n+     * Log std result of the command execution.\n+     * @param exec Result of the execution\n+     * @param error Is it necessary to log stderr as error?\n+     */\n+    private void logStd(final Container.ExecResult exec, final boolean error) {\n+        final String outputerr = String.format(\"\\nSTDERR:\\n%s\", exec.getStderr());\n+        if (error) {\n+            Logger.info(this, String.format(\"\\nSTDOUT:\\n%s\", exec.getStdout()));\n+            Logger.error(this, outputerr);\n+        } else {\n+            Logger.warn(this, outputerr);\n+        }\n+    }\n+", "originalCommit": "7c44e3aa1222a4008490f0e19fa556a522a4476d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dc43765b073668c5b90500b9bcd58c841a5543b3", "changed_code": [{"header": "diff --git a/src/test/java/com/artipie/test/TestContainer.java b/src/test/java/com/artipie/test/TestContainer.java\nindex b408465..ad2f457 100644\n--- a/src/test/java/com/artipie/test/TestContainer.java\n+++ b/src/test/java/com/artipie/test/TestContainer.java\n", "chunk": "@@ -131,22 +125,21 @@ public final class TestContainer implements AutoCloseable {\n      */\n     private Container.ExecResult exec(final String... command) throws Exception {\n         Logger.debug(this, \"Command:\\n%s\", String.join(\" \", command));\n-        return this.cntn.execInContainer(command);\n+        final Container.ExecResult exec = this.cntn.execInContainer(command);\n+        Logger.debug(\n+            this,\n+            String.format(\"\\nSTDOUT:\\n%s \\nSTDERR:\\n%s\", exec.getStdout(), exec.getStderr())\n+        );\n+        return exec;\n     }\n \n     /**\n-     * Log std result of the command execution.\n-     * @param exec Result of the execution\n-     * @param error Is it necessary to log stderr as error?\n+     * Replaces break lines with empty string.\n+     * @param text Input text\n+     * @return Text in which break lines were replaced with empty string.\n      */\n-    private void logStd(final Container.ExecResult exec, final boolean error) {\n-        final String outputerr = String.format(\"\\nSTDERR:\\n%s\", exec.getStderr());\n-        if (error) {\n-            Logger.info(this, String.format(\"\\nSTDOUT:\\n%s\", exec.getStdout()));\n-            Logger.error(this, outputerr);\n-        } else {\n-            Logger.warn(this, outputerr);\n-        }\n+    private static String replaceBreakLine(final String text) {\n+        return text.replace(\"\\n\", \"\");\n     }\n \n }\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgyOTYyNw==", "url": "https://github.com/artipie/artipie/pull/827#discussion_r548829627", "body": "@genryxy the code for replacing `\\n` with empty string is duplicated 3 times in this class, I'd suggest to extract a function for that", "bodyText": "@genryxy the code for replacing \\n with empty string is duplicated 3 times in this class, I'd suggest to extract a function for that", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/genryxy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/genryxy\">@genryxy</a> the code for replacing <code>\\n</code> with empty string is duplicated 3 times in this class, I'd suggest to extract a function for that</p>", "author": "olegmoz", "createdAt": "2020-12-25T08:10:15Z", "path": "src/test/java/com/artipie/test/TestContainer.java", "diffHunk": "@@ -88,7 +90,32 @@ public String execStdErr(final String... command) throws Exception {\n      * @throws Exception In case of exception during execution command in container.\n      */\n     public String execStdout(final String... command) throws Exception {\n-        return this.exec(command).getStdout().replace(\"\\n\", \"\");\n+        final Container.ExecResult exec = this.exec(command);\n+        final int code = exec.getExitCode();\n+        if (code != 0) {\n+            this.logStd(exec, true);\n+            throw new IllegalStateException(\n+                String.format(\n+                    \"'%s' failed with %s code\", String.join(\" \", command), code\n+                )\n+            );\n+        }\n+        this.logStd(exec, false);\n+        return exec.getStdout().replace(\"\\n\", \"\");", "originalCommit": "7c44e3aa1222a4008490f0e19fa556a522a4476d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dc43765b073668c5b90500b9bcd58c841a5543b3", "changed_code": [{"header": "diff --git a/src/test/java/com/artipie/test/TestContainer.java b/src/test/java/com/artipie/test/TestContainer.java\nindex b408465..ad2f457 100644\n--- a/src/test/java/com/artipie/test/TestContainer.java\n+++ b/src/test/java/com/artipie/test/TestContainer.java\n", "chunk": "@@ -93,15 +91,13 @@ public final class TestContainer implements AutoCloseable {\n         final Container.ExecResult exec = this.exec(command);\n         final int code = exec.getExitCode();\n         if (code != 0) {\n-            this.logStd(exec, true);\n             throw new IllegalStateException(\n                 String.format(\n                     \"'%s' failed with %s code\", String.join(\" \", command), code\n                 )\n             );\n         }\n-        this.logStd(exec, false);\n-        return exec.getStdout().replace(\"\\n\", \"\");\n+        return replaceBreakLine(exec.getStdout());\n     }\n \n     /**\n", "next_change": null}]}}, {"oid": "dc43765b073668c5b90500b9bcd58c841a5543b3", "url": "https://github.com/artipie/artipie/commit/dc43765b073668c5b90500b9bcd58c841a5543b3", "message": "#826 - Changes by review", "committedDate": "2020-12-25T08:33:23Z", "type": "commit"}]}