{"pr_number": 64389, "pr_title": "Attachment ingest processor: add resource_name field", "pr_author": "yangyaofei", "pr_createdAt": "2020-10-30T07:58:08Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64389", "timeline": [{"oid": "e1154981b79f548eda80b4e85187bb0cf3d51ef2", "url": "https://github.com/elastic/elasticsearch/commit/e1154981b79f548eda80b4e85187bb0cf3d51ef2", "message": "Add filename for Tika to better recognize the txt file", "committedDate": "2020-10-30T02:48:17Z", "type": "commit"}, {"oid": "285a513f7d11d3bd95daf9a55666c7417fe21770", "url": "https://github.com/elastic/elasticsearch/commit/285a513f7d11d3bd95daf9a55666c7417fe21770", "message": "bugfix : no field \"file_name\"", "committedDate": "2020-10-30T07:31:24Z", "type": "commit"}, {"oid": "dcdcb52a1fe3dc635d20eb46a10ff76346cd7968", "url": "https://github.com/elastic/elasticsearch/commit/dcdcb52a1fe3dc635d20eb46a10ff76346cd7968", "message": "add test for adding file_name field in ingest-attachment", "committedDate": "2020-10-30T07:32:20Z", "type": "commit"}, {"oid": "fbd914eae835ca75519250f396d2c9e337293670", "url": "https://github.com/elastic/elasticsearch/commit/fbd914eae835ca75519250f396d2c9e337293670", "message": "Merge branch 'master' into plugin-attachment-filename", "committedDate": "2020-11-16T16:42:42Z", "type": "commit"}, {"oid": "f8adca4029a3353f584101d7b612e835750672fe", "url": "https://github.com/elastic/elasticsearch/commit/f8adca4029a3353f584101d7b612e835750672fe", "message": "[Plugin Attachment] update exclude file", "committedDate": "2020-11-17T02:33:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzOTA1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r536339051", "body": "I think this should call `readOptionalStringProperty` so that any existing fields named `file_name` that are _not_ intended for Tika will not be inadvertently used.", "bodyText": "I think this should call readOptionalStringProperty so that any existing fields named file_name that are not intended for Tika will not be inadvertently used.", "bodyHTML": "<p dir=\"auto\">I think this should call <code>readOptionalStringProperty</code> so that any existing fields named <code>file_name</code> that are <em>not</em> intended for Tika will not be inadvertently used.</p>", "author": "danhermann", "createdAt": "2020-12-04T19:44:52Z", "path": "plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/AttachmentProcessor.java", "diffHunk": "@@ -197,6 +203,7 @@ int getIndexedChars() {\n         public AttachmentProcessor create(Map<String, Processor.Factory> registry, String processorTag,\n                                           String description, Map<String, Object> config) throws Exception {\n             String field = readStringProperty(TYPE, processorTag, config, \"field\");\n+            String fileName = readStringProperty(TYPE, processorTag, config, \"file_name\", \"file_name\");", "originalCommit": "f8adca4029a3353f584101d7b612e835750672fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM0NzMxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r536347319", "bodyText": "Also, is there any particular reason why you chose file_name as the property name when it's called resourceName on the Tika side? Unless there's a good reason for file_name, it's probably best to stick with resource_name since that's what Tika calls the property.", "author": "danhermann", "createdAt": "2020-12-04T20:00:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzOTA1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzOTU5NA==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r536339594", "body": "When `readOptionalStringProperty` is used as I suggested in another comment, this should retrieve the field value only when `fileName != null`.", "bodyText": "When readOptionalStringProperty is used as I suggested in another comment, this should retrieve the field value only when fileName != null.", "bodyHTML": "<p dir=\"auto\">When <code>readOptionalStringProperty</code> is used as I suggested in another comment, this should retrieve the field value only when <code>fileName != null</code>.</p>", "author": "danhermann", "createdAt": "2020-12-04T19:46:00Z", "path": "plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/AttachmentProcessor.java", "diffHunk": "@@ -77,6 +79,7 @@ public IngestDocument execute(IngestDocument ingestDocument) {\n         Map<String, Object> additionalFields = new HashMap<>();\n \n         byte[] input = ingestDocument.getFieldValueAsBytes(field, ignoreMissing);\n+        String fileNameInput = ingestDocument.getFieldValue(fileName, String.class, true);", "originalCommit": "f8adca4029a3353f584101d7b612e835750672fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8f882434da13340a905a3691dab32a750d290ede", "url": "https://github.com/elastic/elasticsearch/commit/8f882434da13340a905a3691dab32a750d290ede", "message": "[Plugin Attachment] update variable name to meet tika's name", "committedDate": "2020-12-05T03:15:04Z", "type": "commit"}, {"oid": "914648d9d8a70bdd17eedeee1af22cb0d8c171a3", "url": "https://github.com/elastic/elasticsearch/commit/914648d9d8a70bdd17eedeee1af22cb0d8c171a3", "message": "[Plugin Attachment] update test", "committedDate": "2020-12-07T02:40:52Z", "type": "commit"}, {"oid": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "url": "https://github.com/elastic/elasticsearch/commit/d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "message": "Merge branch 'master' into plugin-attachment-filename", "committedDate": "2020-12-07T13:54:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1NjU2MA==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537556560", "body": "Let's leave this unspecified so the existing behavior of the processor without a `resource_name` is still verified.\r\n\r\n```suggestion\r\n            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 10000, false, null, null);\r\n```", "bodyText": "Let's leave this unspecified so the existing behavior of the processor without a resource_name is still verified.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 10000, false, null, \"resource_name\");\n          \n          \n            \n                        \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 10000, false, null, null);", "bodyHTML": "<p dir=\"auto\">Let's leave this unspecified so the existing behavior of the processor without a <code>resource_name</code> is still verified.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>target_field<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">EnumSet</span><span class=\"pl-k\">.</span>allOf(<span class=\"pl-smi\">AttachmentProcessor</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">Property</span><span class=\"pl-k\">.</span>class), <span class=\"pl-c1\">10000</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">resource_name</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>target_field<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">EnumSet</span><span class=\"pl-k\">.</span>allOf(<span class=\"pl-smi\">AttachmentProcessor</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">Property</span><span class=\"pl-k\">.</span>class), <span class=\"pl-c1\">10000</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1 x x-first x-last\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:38:25Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -55,7 +55,7 @@\n     @Before\n     public void createStandardProcessor() {\n         processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n-            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 10000, false, null);\n+            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 10000, false, null, \"resource_name\");", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1NzI4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537557281", "body": "Same here:\r\n```suggestion\r\n            \"target_field\", selectedProperties, 10000, false, null, null);\r\n```", "bodyText": "Same here:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"target_field\", selectedProperties, 10000, false, null, \"resource_name\");\n          \n          \n            \n                        \"target_field\", selectedProperties, 10000, false, null, null);", "bodyHTML": "<p dir=\"auto\">Same here:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>target_field<span class=\"pl-pds\">\"</span></span>, selectedProperties, <span class=\"pl-c1\">10000</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">resource_name</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>target_field<span class=\"pl-pds\">\"</span></span>, selectedProperties, <span class=\"pl-c1\">10000</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1 x x-first x-last\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:39:22Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -88,7 +88,7 @@ public void testHtmlDocumentWithRandomFields() throws Exception {\n             selectedProperties.add(AttachmentProcessor.Property.DATE);\n         }\n         processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n-            \"target_field\", selectedProperties, 10000, false, null);\n+            \"target_field\", selectedProperties, 10000, false, null, \"resource_name\");", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1NzY5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537557695", "body": "This test will remain unchanged:\r\n```suggestion\r\n        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/plain\"));\r\n```", "bodyText": "This test will remain unchanged:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/x-asciidoc\"));\n          \n          \n            \n                    assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/plain\"));", "bodyHTML": "<p dir=\"auto\">This test will remain unchanged:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        assertThat(attachmentData<span class=\"pl-k\">.</span>get(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>content_type<span class=\"pl-pds\">\"</span></span>)<span class=\"pl-k\">.</span>toString(), containsString(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>text/<span class=\"x x-first x-last\">x-asciidoc</span><span class=\"pl-pds\">\"</span></span>));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        assertThat(attachmentData<span class=\"pl-k\">.</span>get(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>content_type<span class=\"pl-pds\">\"</span></span>)<span class=\"pl-k\">.</span>toString(), containsString(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>text/<span class=\"x x-first x-last\">plain</span><span class=\"pl-pds\">\"</span></span>));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:39:53Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -211,7 +211,7 @@ public void testAsciidocDocument() throws Exception {\n         Map<String, Object> attachmentData = parseDocument(\"asciidoc.asciidoc\", processor);\n \n         assertThat(attachmentData.keySet(), containsInAnyOrder(\"language\", \"content_type\", \"content\", \"content_length\"));\n-        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/plain\"));\n+        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/x-asciidoc\"));", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2Mjk1Mg==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537562952", "bodyText": "but it's will make the test fail", "author": "yangyaofei", "createdAt": "2020-12-07T14:46:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1NzY5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2NjA3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537566079", "bodyText": "Not if resource_name is not specified for this test.", "author": "danhermann", "createdAt": "2020-12-07T14:50:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1NzY5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1ODE2NA==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537558164", "body": "Let's remove this line so these tests remain unchanged as well.", "bodyText": "Let's remove this line so these tests remain unchanged as well.", "bodyHTML": "<p dir=\"auto\">Let's remove this line so these tests remain unchanged as well.</p>", "author": "danhermann", "createdAt": "2020-12-07T14:40:30Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -229,6 +229,7 @@ public void testParseAsBytesArray() throws Exception {\n \n         Map<String, Object> document = new HashMap<>();\n         document.put(\"source_field\", bytes);\n+        document.put(\"resource_name\", path);", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2NDkxOA==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537564918", "bodyText": "but, the new field \"resource_name\"  should be added here, if not , the \"resource_name\" will meaningless", "author": "yangyaofei", "createdAt": "2020-12-07T14:48:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1ODE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2NzIwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537567201", "bodyText": "Please see my other comment here: #64389 (comment) -- I would like to isolate the testing for resource_name to a new test method and keep the existing tests to verify that the processor's behavior doesn't change if resource_name is unspecified. Let me know if you have any questions about that.", "author": "danhermann", "createdAt": "2020-12-07T14:51:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1ODE2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1ODM5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537558397", "body": "```suggestion\r\n            \"randomTarget\", null, 10, true, null, null);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"randomTarget\", null, 10, true, null, \"resource_name\");\n          \n          \n            \n                        \"randomTarget\", null, 10, true, null, null);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>randomTarget<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">true</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">resource_name</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>randomTarget<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">true</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1 x x-first x-last\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:40:48Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -247,15 +248,17 @@ public void testNullValueWithIgnoreMissing() throws Exception {\n         IngestDocument originalIngestDocument = RandomDocumentPicks.randomIngestDocument(random(),\n             Collections.singletonMap(\"source_field\", null));\n         IngestDocument ingestDocument = new IngestDocument(originalIngestDocument);\n-        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\", \"randomTarget\", null, 10, true, null);\n+        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n+            \"randomTarget\", null, 10, true, null, \"resource_name\");", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1ODU0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537558549", "body": "```suggestion\r\n            \"randomTarget\", null, 10, true, null, null);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"randomTarget\", null, 10, true, null, \"resource_name\");\n          \n          \n            \n                        \"randomTarget\", null, 10, true, null, null);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>randomTarget<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">true</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">resource_name</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>randomTarget<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">true</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1 x x-first x-last\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:40:59Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -247,15 +248,17 @@ public void testNullValueWithIgnoreMissing() throws Exception {\n         IngestDocument originalIngestDocument = RandomDocumentPicks.randomIngestDocument(random(),\n             Collections.singletonMap(\"source_field\", null));\n         IngestDocument ingestDocument = new IngestDocument(originalIngestDocument);\n-        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\", \"randomTarget\", null, 10, true, null);\n+        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n+            \"randomTarget\", null, 10, true, null, \"resource_name\");\n         processor.execute(ingestDocument);\n         assertIngestDocument(originalIngestDocument, ingestDocument);\n     }\n \n     public void testNonExistentWithIgnoreMissing() throws Exception {\n         IngestDocument originalIngestDocument = RandomDocumentPicks.randomIngestDocument(random(), Collections.emptyMap());\n         IngestDocument ingestDocument = new IngestDocument(originalIngestDocument);\n-        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\", \"randomTarget\", null, 10, true, null);\n+        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n+            \"randomTarget\", null, 10, true, null, \"resource_name\");", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1ODY5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537558699", "body": "```suggestion\r\n            \"randomTarget\", null, 10, false, null, null);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"randomTarget\", null, 10, false, null, \"resource_name\");\n          \n          \n            \n                        \"randomTarget\", null, 10, false, null, null);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>randomTarget<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">resource_name</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>randomTarget<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1 x x-first x-last\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:41:12Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -264,15 +267,17 @@ public void testNullWithoutIgnoreMissing() throws Exception {\n         IngestDocument originalIngestDocument = RandomDocumentPicks.randomIngestDocument(random(),\n             Collections.singletonMap(\"source_field\", null));\n         IngestDocument ingestDocument = new IngestDocument(originalIngestDocument);\n-        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\", \"randomTarget\", null, 10, false, null);\n+        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n+            \"randomTarget\", null, 10, false, null, \"resource_name\");", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1ODgyNg==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537558826", "body": "```suggestion\r\n            \"randomTarget\", null, 10, false, null, null);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"randomTarget\", null, 10, false, null, \"resource_name\");\n          \n          \n            \n                        \"randomTarget\", null, 10, false, null, null);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>randomTarget<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">resource_name</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>randomTarget<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1\">10</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1 x x-first x-last\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:41:23Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -264,15 +267,17 @@ public void testNullWithoutIgnoreMissing() throws Exception {\n         IngestDocument originalIngestDocument = RandomDocumentPicks.randomIngestDocument(random(),\n             Collections.singletonMap(\"source_field\", null));\n         IngestDocument ingestDocument = new IngestDocument(originalIngestDocument);\n-        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\", \"randomTarget\", null, 10, false, null);\n+        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n+            \"randomTarget\", null, 10, false, null, \"resource_name\");\n         Exception exception = expectThrows(Exception.class, () -> processor.execute(ingestDocument));\n         assertThat(exception.getMessage(), equalTo(\"field [source_field] is null, cannot parse.\"));\n     }\n \n     public void testNonExistentWithoutIgnoreMissing() throws Exception {\n         IngestDocument originalIngestDocument = RandomDocumentPicks.randomIngestDocument(random(), Collections.emptyMap());\n         IngestDocument ingestDocument = new IngestDocument(originalIngestDocument);\n-        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\", \"randomTarget\", null, 10, false, null);\n+        Processor processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n+            \"randomTarget\", null, 10, false, null, \"resource_name\");", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1OTc1NQ==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537559755", "body": "Could you add an override for the `parseDocument` method that adds a `boolean includeResourceName` parameter and only add `resource_name` if that parameter is true?", "bodyText": "Could you add an override for the parseDocument method that adds a boolean includeResourceName parameter and only add resource_name if that parameter is true?", "bodyHTML": "<p dir=\"auto\">Could you add an override for the <code>parseDocument</code> method that adds a <code>boolean includeResourceName</code> parameter and only add <code>resource_name</code> if that parameter is true?</p>", "author": "danhermann", "createdAt": "2020-12-07T14:42:29Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -285,6 +290,7 @@ public void testNonExistentWithoutIgnoreMissing() throws Exception {\n         throws Exception {\n         Map<String, Object> document = new HashMap<>();\n         document.put(\"source_field\", getAsBinaryOrBase64(file));\n+        document.put(\"resource_name\", file);", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU3MTk5MA==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537571990", "bodyText": "That what I'm going to do, please stay here, I don't want to wait for another week to continue this conversation. I will finish this this night", "author": "yangyaofei", "createdAt": "2020-12-07T14:57:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU1OTc1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2MDA5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537560093", "body": "Let's not change the behavior of these tests:\r\n```suggestion\r\n            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, null, null);\r\n```", "bodyText": "Let's not change the behavior of these tests:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, null, \"resource_name\");\n          \n          \n            \n                        \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, null, null);", "bodyHTML": "<p dir=\"auto\">Let's not change the behavior of these tests:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>target_field<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">EnumSet</span><span class=\"pl-k\">.</span>allOf(<span class=\"pl-smi\">AttachmentProcessor</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">Property</span><span class=\"pl-k\">.</span>class), <span class=\"pl-c1\">19</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">resource_name</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>target_field<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">EnumSet</span><span class=\"pl-k\">.</span>allOf(<span class=\"pl-smi\">AttachmentProcessor</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">Property</span><span class=\"pl-k\">.</span>class), <span class=\"pl-c1\">19</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-c1\">null</span>, <span class=\"pl-c1 x x-first x-last\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:42:54Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -297,7 +303,7 @@ public void testNonExistentWithoutIgnoreMissing() throws Exception {\n \n     public void testIndexedChars() throws Exception {\n         processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n-            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, null);\n+            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, null, \"resource_name\");", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2MDY1OA==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537560658", "body": "```suggestion\r\n            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, \"max_length\", null);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, \"max_length\", \"resource_name\");\n          \n          \n            \n                        \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, \"max_length\", null);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>target_field<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">EnumSet</span><span class=\"pl-k\">.</span>allOf(<span class=\"pl-smi\">AttachmentProcessor</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">Property</span><span class=\"pl-k\">.</span>class), <span class=\"pl-c1\">19</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>max_length<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">resource_name</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>target_field<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-smi\">EnumSet</span><span class=\"pl-k\">.</span>allOf(<span class=\"pl-smi\">AttachmentProcessor</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">Property</span><span class=\"pl-k\">.</span>class), <span class=\"pl-c1\">19</span>, <span class=\"pl-c1\">false</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>max_length<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1 x x-first x-last\">null</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "danhermann", "createdAt": "2020-12-07T14:43:39Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -308,7 +314,7 @@ public void testIndexedChars() throws Exception {\n         assertThat(attachmentData.get(\"content_length\"), is(19L));\n \n         processor = new AttachmentProcessor(randomAlphaOfLength(10), null, \"source_field\",\n-            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, \"max_length\");\n+            \"target_field\", EnumSet.allOf(AttachmentProcessor.Property.class), 19, false, \"max_length\", \"resource_name\");", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2MTY4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537561686", "body": "Can you add these tests to a new test method named something like `testIndexedCharsWithResourceName` that calls your new overloaded `parseDocument` method with `includeResourceName` as true so that it separately tests your new functionality without changing the existing tests?", "bodyText": "Can you add these tests to a new test method named something like testIndexedCharsWithResourceName that calls your new overloaded parseDocument method with includeResourceName as true so that it separately tests your new functionality without changing the existing tests?", "bodyHTML": "<p dir=\"auto\">Can you add these tests to a new test method named something like <code>testIndexedCharsWithResourceName</code> that calls your new overloaded <code>parseDocument</code> method with <code>includeResourceName</code> as true so that it separately tests your new functionality without changing the existing tests?</p>", "author": "danhermann", "createdAt": "2020-12-07T14:44:58Z", "path": "plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java", "diffHunk": "@@ -333,6 +339,30 @@ public void testIndexedChars() throws Exception {\n         assertThat(attachmentData.get(\"content\"), is(\"\\\"God Save the Queen\\\" (alternatively \\\"God Save the King\\\"\"));\n         assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/plain\"));\n         assertThat(attachmentData.get(\"content_length\"), is(56L));\n+\n+        attachmentData = parseDocument(\"text-cjk-big5.txt\", processor, Collections.singletonMap(\"max_length\", 100));\n+\n+        assertThat(attachmentData.keySet(), containsInAnyOrder(\"language\", \"content\", \"content_type\", \"content_length\"));\n+        assertThat(attachmentData.get(\"content\").toString(), containsString(\"\u78a9\u9f20\u78a9\u9f20\uff0c\u7121\u98df\u6211\u9ecd\uff01\"));\n+        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/plain\"));\n+        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"charset=Big5\"));\n+        assertThat(attachmentData.get(\"content_length\"), is(100L));\n+\n+        attachmentData = parseDocument(\"text-cjk-gbk.txt\", processor, Collections.singletonMap(\"max_length\", 100));\n+\n+        assertThat(attachmentData.keySet(), containsInAnyOrder(\"language\", \"content\", \"content_type\", \"content_length\"));\n+        assertThat(attachmentData.get(\"content\").toString(), containsString(\"\u7855\u9f20\u7855\u9f20\uff0c\u65e0\u98df\u6211\u9ecd\uff01\"));\n+        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/plain\"));\n+        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"charset=GB18030\"));\n+        assertThat(attachmentData.get(\"content_length\"), is(100L));\n+\n+        attachmentData = parseDocument(\"text-cjk-euc-jp.txt\", processor, Collections.singletonMap(\"max_length\", 100));\n+\n+        assertThat(attachmentData.keySet(), containsInAnyOrder(\"language\", \"content\", \"content_type\", \"content_length\"));\n+        assertThat(attachmentData.get(\"content\").toString(), containsString(\"\u78a9\u9f20\u3088\u78a9\u9f20\u3088\u3001\\n\u6211\u304c\u9ecd\u3092\u98df\u3089\u3046\u7121\u304b\u308c\uff01\"));\n+        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"text/plain\"));\n+        assertThat(attachmentData.get(\"content_type\").toString(), containsString(\"charset=EUC-JP\"));\n+        assertThat(attachmentData.get(\"content_length\"), is(100L));", "originalCommit": "d8e46385fe6d3612eeb5b01f4f2dbef205d6203a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2NjQwOA==", "url": "https://github.com/elastic/elasticsearch/pull/64389#discussion_r537566408", "bodyText": "ok, I get it ,wait for a moment", "author": "yangyaofei", "createdAt": "2020-12-07T14:50:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2MTY4Ng=="}], "type": "inlineReview"}, {"oid": "bca11758e3881253261eea347c6cde77e349b6db", "url": "https://github.com/elastic/elasticsearch/commit/bca11758e3881253261eea347c6cde77e349b6db", "message": "Update plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-12-07T14:45:41Z", "type": "commit"}, {"oid": "0d4d6cfbcde2a28ab2656c57e065752127203eda", "url": "https://github.com/elastic/elasticsearch/commit/0d4d6cfbcde2a28ab2656c57e065752127203eda", "message": "Update plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-12-07T14:52:07Z", "type": "commit"}, {"oid": "93f8cf5f269c442ee64bf2f6243241199da82ad8", "url": "https://github.com/elastic/elasticsearch/commit/93f8cf5f269c442ee64bf2f6243241199da82ad8", "message": "Update plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-12-07T14:52:31Z", "type": "commit"}, {"oid": "2d927ca80db09b07e0ebd7337450120f29bce10c", "url": "https://github.com/elastic/elasticsearch/commit/2d927ca80db09b07e0ebd7337450120f29bce10c", "message": "Update plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-12-07T14:52:57Z", "type": "commit"}, {"oid": "9cfded6259c019bed23c15290e5f6f48a44befa8", "url": "https://github.com/elastic/elasticsearch/commit/9cfded6259c019bed23c15290e5f6f48a44befa8", "message": "Update plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-12-07T14:53:14Z", "type": "commit"}, {"oid": "f34c5531fdd04844be052d6241b7969dec771bc5", "url": "https://github.com/elastic/elasticsearch/commit/f34c5531fdd04844be052d6241b7969dec771bc5", "message": "Update plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-12-07T14:53:40Z", "type": "commit"}, {"oid": "4c557746a20e9f86aeeadd23b05bd842e5fd8d80", "url": "https://github.com/elastic/elasticsearch/commit/4c557746a20e9f86aeeadd23b05bd842e5fd8d80", "message": "Update plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-12-07T14:54:51Z", "type": "commit"}, {"oid": "74a38ebc1bd8524b82f3588a790272275f7b38d1", "url": "https://github.com/elastic/elasticsearch/commit/74a38ebc1bd8524b82f3588a790272275f7b38d1", "message": "Update plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java\n\nCo-authored-by: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-12-07T14:55:20Z", "type": "commit"}, {"oid": "6e5e033aadd9348b2186533c544b40ae82109073", "url": "https://github.com/elastic/elasticsearch/commit/6e5e033aadd9348b2186533c544b40ae82109073", "message": "[Plugin Attachment] make test independent", "committedDate": "2020-12-07T15:30:00Z", "type": "commit"}, {"oid": "0d158d15cf0402a6f3333abd4e18e72c67f5d6da", "url": "https://github.com/elastic/elasticsearch/commit/0d158d15cf0402a6f3333abd4e18e72c67f5d6da", "message": "[Plugin Attachment] update format", "committedDate": "2020-12-07T17:10:11Z", "type": "commit"}]}