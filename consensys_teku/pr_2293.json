{"pr_number": 2293, "pr_title": "add a metric to track connected eth2 nodes similar to api and console", "pr_author": "rolfyone", "pr_createdAt": "2020-07-02T00:18:39Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2293", "timeline": [{"oid": "0fcf8cfd3c3b2ae4be7bb2cf387e9cf8086fff63", "url": "https://github.com/ConsenSys/teku/commit/0fcf8cfd3c3b2ae4be7bb2cf387e9cf8086fff63", "message": "add a metric to track connected eth2 nodes similar to api and console\n\n - added beacon_peer_count to track connections in the same way the API does\n\n - added regression test to show metric working.\n\nfixes #2177\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-07-02T00:16:21Z", "type": "commit"}, {"oid": "608534e77c097655ad52c8af53e9f210e42a82ea", "url": "https://github.com/ConsenSys/teku/commit/608534e77c097655ad52c8af53e9f210e42a82ea", "message": "add changelog entry.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-07-02T00:23:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4ODE5OQ==", "url": "https://github.com/ConsenSys/teku/pull/2293#discussion_r448688199", "body": "```suggestion\r\n        \"Tracks number of connected peers, verified to be on the same chain\",\r\n```\r\n\r\nWe may need to update the description for the libp2p_peer_count metric as well to make it clear that it's counting connections - otherwise people will just be confused why we have two metrics for the same thing with different values.", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"Tracks number of connected peers\",\n          \n          \n            \n                    \"Tracks number of connected peers, verified to be on the same chain\",\n          \n      \n    \n    \n  \n\nWe may need to update the description for the libp2p_peer_count metric as well to make it clear that it's counting connections - otherwise people will just be confused why we have two metrics for the same thing with different values.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Tracks number of connected peers<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Tracks number of connected peers<span class=\"x x-first x-last\">, verified to be on the same chain</span><span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">We may need to update the description for the libp2p_peer_count metric as well to make it clear that it's counting connections - otherwise people will just be confused why we have two metrics for the same thing with different values.</p>", "author": "ajsutton", "createdAt": "2020-07-02T00:47:52Z", "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java", "diffHunk": "@@ -104,6 +108,11 @@ public BeaconChainMetrics(\n         \"previous_justified_root\",\n         \"Current previously justified root\",\n         this::getPreviousJustifiedRootValue);\n+    metricsSystem.createGauge(\n+        TekuMetricCategory.BEACON,\n+        \"peer_count\",\n+        \"Tracks number of connected peers\",", "originalCommit": "608534e77c097655ad52c8af53e9f210e42a82ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2001d439203b8b2d111ca2a78c5e90d8708df845", "url": "https://github.com/ConsenSys/teku/commit/2001d439203b8b2d111ca2a78c5e90d8708df845", "message": "review comment addressed.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-07-02T02:28:16Z", "type": "commit"}]}