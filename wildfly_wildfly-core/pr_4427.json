{"pr_number": 4427, "pr_title": "[WFCORE-5226] No acceptedIssuers is sent when CRLs are configured", "pr_author": "SoniaZaldana", "pr_createdAt": "2020-12-10T20:27:24Z", "pr_url": "https://github.com/wildfly/wildfly-core/pull/4427", "merge_commit": "84c051847907777c9be5eeb9438f143a8398edb8", "timeline": [{"oid": "0bce5529748307c850ccd1591bb16e39a5b35fc1", "url": "https://github.com/wildfly/wildfly-core/commit/0bce5529748307c850ccd1591bb16e39a5b35fc1", "message": "[WFCORE-5226] No acceptedIssuers is sent when CRLs are configured", "committedDate": "2020-12-11T17:01:22Z", "type": "forcePushed"}, {"oid": "7fa895302a5c4809ef47220186aa464a09b27ef9", "url": "https://github.com/wildfly/wildfly-core/commit/7fa895302a5c4809ef47220186aa464a09b27ef9", "message": "[WFCORE-5226] No acceptedIssuers is sent when CRLs are configured", "committedDate": "2020-12-11T17:03:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5NTQ5OQ==", "url": "https://github.com/wildfly/wildfly-core/pull/4427#discussion_r541095499", "body": "Instead of casting to `SSLDefinitions.ReloadableX509ExtendedTrustManager`, you should be able to just cast to `X509TrustManager` instead. Then, `ReloadableX509ExtendedTrustManager` can be made `private` again.", "bodyText": "Instead of casting to SSLDefinitions.ReloadableX509ExtendedTrustManager, you should be able to just cast to X509TrustManager instead. Then, ReloadableX509ExtendedTrustManager can be made private again.", "bodyHTML": "<p dir=\"auto\">Instead of casting to <code>SSLDefinitions.ReloadableX509ExtendedTrustManager</code>, you should be able to just cast to <code>X509TrustManager</code> instead. Then, <code>ReloadableX509ExtendedTrustManager</code> can be made <code>private</code> again.</p>", "author": "fjuma", "createdAt": "2020-12-11T17:07:04Z", "path": "elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java", "diffHunk": "@@ -471,6 +471,19 @@ public void testRevocationListsDp() throws Throwable {\n         Assert.assertTrue(services.executeOperation(operation).get(OUTCOME).asString().equals(FAILED)); // not realoadable\n     }\n \n+\n+    /**\n+     * Verifies accepted issuers are sent when CRLs are configured.\n+     * Verifies ELY-2057 (No acceptedIssuers sent when CRLs are configured) is resolved.\n+     */\n+    @Test\n+    public void testAcceptedIssuersWithCRLs() throws Throwable {\n+        ServiceName serviceName = Capabilities.TRUST_MANAGER_RUNTIME_CAPABILITY.getCapabilityServiceName(\"trust-with-crl\");\n+        TrustManager trustManager = (TrustManager) services.getContainer().getService(serviceName).getValue();\n+        Assert.assertNotNull(trustManager);\n+        Assert.assertTrue(((SSLDefinitions.ReloadableX509ExtendedTrustManager) trustManager).getAcceptedIssuers().length > 0);", "originalCommit": "7fa895302a5c4809ef47220186aa464a09b27ef9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5OTE2MA==", "url": "https://github.com/wildfly/wildfly-core/pull/4427#discussion_r541099160", "bodyText": "Thanks! I updated it", "author": "SoniaZaldana", "createdAt": "2020-12-11T17:12:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA5NTQ5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "b5a8632c97c24b63560cce07997de3319c84d470", "changed_code": [{"header": "diff --git a/elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java b/elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java\nindex 40215d55d3..cc7924a194 100644\n--- a/elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java\n+++ b/elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java\n", "chunk": "@@ -481,7 +482,7 @@ public class TlsTestCase extends AbstractSubsystemTest {\n         ServiceName serviceName = Capabilities.TRUST_MANAGER_RUNTIME_CAPABILITY.getCapabilityServiceName(\"trust-with-crl\");\n         TrustManager trustManager = (TrustManager) services.getContainer().getService(serviceName).getValue();\n         Assert.assertNotNull(trustManager);\n-        Assert.assertTrue(((SSLDefinitions.ReloadableX509ExtendedTrustManager) trustManager).getAcceptedIssuers().length > 0);\n+        Assert.assertTrue(((X509TrustManager) trustManager).getAcceptedIssuers().length > 0);\n     }\n \n     @Test\n", "next_change": null}]}, "revised_code_in_main": {"commit": "84c051847907777c9be5eeb9438f143a8398edb8", "changed_code": [{"header": "diff --git a/elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java b/elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java\nindex 40215d55d3..cc7924a194 100644\n--- a/elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java\n+++ b/elytron/src/test/java/org/wildfly/extension/elytron/TlsTestCase.java\n", "chunk": "@@ -481,7 +482,7 @@ public class TlsTestCase extends AbstractSubsystemTest {\n         ServiceName serviceName = Capabilities.TRUST_MANAGER_RUNTIME_CAPABILITY.getCapabilityServiceName(\"trust-with-crl\");\n         TrustManager trustManager = (TrustManager) services.getContainer().getService(serviceName).getValue();\n         Assert.assertNotNull(trustManager);\n-        Assert.assertTrue(((SSLDefinitions.ReloadableX509ExtendedTrustManager) trustManager).getAcceptedIssuers().length > 0);\n+        Assert.assertTrue(((X509TrustManager) trustManager).getAcceptedIssuers().length > 0);\n     }\n \n     @Test\n", "next_change": null}]}, "commits_in_main": [{"oid": "84c051847907777c9be5eeb9438f143a8398edb8", "message": "Merge commit", "committedDate": null}, {"oid": "82ced17c7162838d2ec695b5f32cdb737f204bd3", "committedDate": "2021-03-04 10:48:57 -0500", "message": "[WFCORE-5219] Refactor the OpenSSL tests to make sure that the OpenSSL provider is loaded using a ModuleClassLoader to prevent these tests from being ignored"}, {"oid": "555a310e5ba411d7e1bda783bc145bc6dc5a3ca9", "committedDate": "2021-04-08 14:42:02 -0400", "message": "[WFCORE-5170] Certificate Revocation Lists"}, {"oid": "42fc8e8b3404db977825c2410a20a66985313236", "committedDate": "2021-05-31 10:38:34 -0400", "message": "[WFCORE-5145] Elytron server-ssl-context allowed protocols"}, {"oid": "7703ae911f694d4e27621004628fd5a3ff831d7d", "committedDate": "2021-06-01 18:47:05 +0100", "message": "[WFCORE-5435] Include WFCORE-5145"}, {"oid": "5f91b37266de951b49b9bdc50594a9d761f188ae", "committedDate": "2021-06-09 19:06:10 +0100", "message": "[WFCORE-5452] Sync updates to TLS configuration and minor changes for Java 17."}, {"oid": "5819dba8e2b8e9de104cc1d4e9d3b09e0dfe178d", "committedDate": "2021-06-14 10:18:03 -0400", "message": "[WFCORE-5450] TlsTestCase is failing on IBM JDK"}, {"oid": "53608b8828341ed3e7986eaf895ce5c1269cbdc7", "committedDate": "2021-09-24 11:50:57 +0200", "message": "[WFCORE-5587] maximum-cert-path does not work with empty certificate-revocation-list in Elytron trust-manager"}, {"oid": "284563d3f12b5f15c652851f6c235004e036fc64", "committedDate": "2021-10-12 20:14:42 -0500", "message": "[WFCORE-4532] Enable tests on JDK14+ since they  no longer fail"}, {"oid": "511c98cd5f995ac045a6834b0cbccf1be9d6483e", "committedDate": "2021-10-20 13:36:58 +0200", "message": "[WFCORE-5647] Assertion arguments should be passed in the correct order (elytron)"}, {"oid": "bcc252d958044104954a37b7ddd047bec0414f68", "committedDate": "2022-01-06 18:15:07 +0100", "message": "[WFCORE-5758] Fix RealmsTestCase & TlsTestCase on IBM JDK8"}, {"oid": "3a6738692b923300a58a29df3a95743dc4ffecd8", "committedDate": "2022-09-28 15:09:13 +0530", "message": "WFCORE-6061 Rename(methods and variable) the test cases of elytron module"}, {"oid": "57c1fd163ccf4fee46c0f47ebf3750d228570860", "committedDate": "2022-10-20 17:45:01 -0400", "message": "[WFCORE-6090] Unexpected NullPointerException in Elytron tests when init capabilities are missing"}, {"oid": "970b8156c9edbb4e54f51649b4efa95271e3de1b", "committedDate": "2023-03-10 09:36:06 +0800", "message": "[WFCORE-5947] fix test for IBM JDK Semeru 11"}]}, {"oid": "b5a8632c97c24b63560cce07997de3319c84d470", "url": "https://github.com/wildfly/wildfly-core/commit/b5a8632c97c24b63560cce07997de3319c84d470", "message": "[WFCORE-5226] No acceptedIssuers is sent when CRLs are configured", "committedDate": "2020-12-11T17:12:20Z", "type": "forcePushed"}, {"oid": "147179e2a9a2e47a7a241c8ef2b67add1aafc3f9", "url": "https://github.com/wildfly/wildfly-core/commit/147179e2a9a2e47a7a241c8ef2b67add1aafc3f9", "message": "[WFCORE-5226] No acceptedIssuers is sent when CRLs are configured", "committedDate": "2021-01-25T21:11:38Z", "type": "commit"}, {"oid": "147179e2a9a2e47a7a241c8ef2b67add1aafc3f9", "url": "https://github.com/wildfly/wildfly-core/commit/147179e2a9a2e47a7a241c8ef2b67add1aafc3f9", "message": "[WFCORE-5226] No acceptedIssuers is sent when CRLs are configured", "committedDate": "2021-01-25T21:11:38Z", "type": "forcePushed"}]}