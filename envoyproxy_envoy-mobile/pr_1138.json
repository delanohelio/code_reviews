{"pr_number": 1138, "pr_title": "java: create native resource management system", "pr_createdAt": "2020-10-20T10:58:57Z", "pr_url": "https://github.com/envoyproxy/envoy-mobile/pull/1138", "merge_commit": "463a027db5f39b00e7ccdb58b65b9cb2583b3802", "timeline": [{"oid": "a9717a13e2c71eb556f94c26f0333bcf7d8ac941", "url": "https://github.com/envoyproxy/envoy-mobile/commit/a9717a13e2c71eb556f94c26f0333bcf7d8ac941", "message": "java: create native resource management system\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-10-20T10:56:24Z", "type": "commit"}, {"oid": "9c6ce88fab35852ade638b24060b818953f97c6f", "url": "https://github.com/envoyproxy/envoy-mobile/commit/9c6ce88fab35852ade638b24060b818953f97c6f", "message": "fix typo\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-10-20T12:09:28Z", "type": "commit"}, {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf", "url": "https://github.com/envoyproxy/envoy-mobile/commit/54a1530db533470a24db502e112d2756d9cbeaaf", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-10-20T18:00:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1ODA5Mg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508758092", "body": "Do we need to add these to the proguard rules?", "bodyText": "Do we need to add these to the proguard rules?", "bodyHTML": "<p dir=\"auto\">Do we need to add these to the proguard rules?</p>", "author": "buildbreaker", "createdAt": "2020-10-20T18:43:18Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyHTTPFilterCallbacksImpl.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+final class EnvoyHTTPFilterCallbacksImpl\n+    implements EnvoyHTTPFilterCallbacks, EnvoyNativeResourceWrapper {\n+\n+  private static final EnvoyNativeResourceReleaser releaseCallbacks = (long handle) -> {\n+    callReleaseCallbacks(handle);\n+  };\n+\n+  private final long callbackHandle;\n+\n+  /**\n+   * @param callbackHandle, native handle for callback execution. This must be eventually passed to\n+                            `callReleaseCallbacks` to release underlying memory.\n+   */\n+  EnvoyHTTPFilterCallbacksImpl(long callbackHandle) { this.callbackHandle = callbackHandle; }\n+\n+  static EnvoyHTTPFilterCallbacksImpl create(long callbackHandle) {\n+    final EnvoyHTTPFilterCallbacksImpl object = new EnvoyHTTPFilterCallbacksImpl(callbackHandle);\n+    EnvoyNativeResourceRegistry.globalRegister(object, callbackHandle, releaseCallbacks);\n+    return object;\n+  }\n+\n+  public void resumeIteration() { callResumeIteration(callbackHandle, this); }\n+\n+  /**\n+   * @param callbackHandle, native handle for callback execution.\n+   * @param object, pass this object so that the JNI retains it, preventing it from potentially\n+   *                being concurrently garbage-collected while the native call is executing.\n+   */\n+  private native void callResumeIteration(long callbackHandle, EnvoyHTTPFilterCallbacksImpl object);\n+\n+  private static native void callReleaseCallbacks(long callbackHandle);", "originalCommit": "54a1530db533470a24db502e112d2756d9cbeaaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgwODE1Ng==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508808156", "bodyText": "Yes, good callout. Strictly-speaking not required in this PR, but might as well add them now to avoid missing it later.", "author": "goaway", "createdAt": "2020-10-20T20:11:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1ODA5Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1OTc0NA==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508759744", "body": "I think this reads more easily:\r\n```suggestion\r\n  // References are automatically enqueued when the gc flags them as unreachable.\r\n  private ReferenceQueue refQueue; \r\n  // Maintains references in the object graph while we wait for\r\n  // them to be enqueued.\r\n  private Collection refMaintainer; \r\n```", "bodyText": "I think this reads more easily:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private ReferenceQueue\n          \n          \n            \n                  refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n          \n          \n            \n              private Collection refMaintainer; // Maintains references in the object graph while we wait for\n          \n          \n            \n                                                // them to be enqueued.\n          \n          \n            \n              // References are automatically enqueued when the gc flags them as unreachable.\n          \n          \n            \n              private ReferenceQueue refQueue; \n          \n          \n            \n              // Maintains references in the object graph while we wait for\n          \n          \n            \n              // them to be enqueued.\n          \n          \n            \n              private Collection refMaintainer;", "bodyHTML": "<p dir=\"auto\">I think this reads more easily:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"16\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">ReferenceQueue</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"17\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      refQueue; <span class=\"pl-c\"><span class=\"pl-c\">//</span> References are automatically enqueued when the gc flags them as unreachable.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"18\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">Collection</span> refMaintainer; <span class=\"pl-c\"><span class=\"pl-c\">//</span> Maintains references in the object graph while we wait for</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"19\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                                    <span class=\"pl-c\"><span class=\"pl-c\">//</span> them to be enqueued.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"16\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> References are automatically enqueued when the gc flags them as unreachable.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"17\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">ReferenceQueue</span> refQueue; </td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"18\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> Maintains references in the object graph while we wait for</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"19\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> them to be enqueued.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"20\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">Collection</span> refMaintainer; </td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "buildbreaker", "createdAt": "2020-10-20T18:44:55Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeMemoryRegistry.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Collection refMaintainer; // Maintains references in the object graph while we wait for\n+                                    // them to be enqueued.", "originalCommit": "54a1530db533470a24db502e112d2756d9cbeaaf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4ODE2NQ==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508788165", "body": "Could we add a blurb on the responsibilities of this wrapper?", "bodyText": "Could we add a blurb on the responsibilities of this wrapper?", "bodyHTML": "<p dir=\"auto\">Could we add a blurb on the responsibilities of this wrapper?</p>", "author": "buildbreaker", "createdAt": "2020-10-20T19:35:27Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceWrapper.java", "diffHunk": "@@ -0,0 +1,3 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+interface EnvoyNativeResourceWrapper {}", "originalCommit": "54a1530db533470a24db502e112d2756d9cbeaaf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "85aace3482ea74d7247816f1448c9ad68caf6926", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceWrapper.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceWrapper.java\nindex eb97d0c2..8f86f3f4 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceWrapper.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceWrapper.java\n", "chunk": "@@ -1,3 +1,8 @@\n package io.envoyproxy.envoymobile.engine;\n \n+/**\n+ * This interface exists solely to scope the types accepted by EnvoyNativeResourceRegistry.\n+ *\n+ * Implemented by objects that require a native resource to be tied to their lifecycle.\n+ */\n interface EnvoyNativeResourceWrapper {}\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4ODQxMw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508788413", "body": "docs for params", "bodyText": "docs for params", "bodyHTML": "<p dir=\"auto\">docs for params</p>", "author": "buildbreaker", "createdAt": "2020-10-20T19:35:57Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n+                             // be enqueued.\n+  private RefQueueThread\n+      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n+\n+  private class RefQueueThread extends Thread {\n+    public void run() {\n+      EnvoyPhantomRef ref;\n+      while (true) {\n+        try {\n+          ref = (EnvoyPhantomRef)refQueue.remove();\n+        } catch (InterruptedException e) {\n+          continue;\n+        }\n+\n+        ref.releaseResource();\n+        refMaintainer.remove(ref);\n+      }\n+    }\n+  }\n+\n+  private class EnvoyPhantomRef extends PhantomReference<EnvoyNativeResourceWrapper> {\n+    private final EnvoyNativeResourceReleaser releaser;\n+    private final long nativeHandle;\n+\n+    EnvoyPhantomRef(EnvoyNativeResourceWrapper owner, long nativeHandle,\n+                    EnvoyNativeResourceReleaser releaser) {\n+      super(owner, refQueue);\n+      this.nativeHandle = nativeHandle;\n+      this.releaser = releaser;\n+      refQueueThread = new RefQueueThread();\n+      refMaintainer = new ConcurrentHashMap().newKeySet();\n+      refQueueThread.start();\n+    }\n+\n+    void releaseResource() { releaser.release(nativeHandle); }\n+  }\n+\n+  /**\n+   * Register an EnvoyNativeResourceWrapper to schedule cleanup of its native resources when the\n+   * Java object is flagged for collection by the garbage collector.\n+   */\n+  public void register(EnvoyNativeResourceWrapper owner, long nativeHandle,", "originalCommit": "54a1530db533470a24db502e112d2756d9cbeaaf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "85aace3482ea74d7247816f1448c9ad68caf6926", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex 27248dd0..af4307c1 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -58,6 +58,10 @@ public enum EnvoyNativeResourceRegistry {\n   /**\n    * Register an EnvoyNativeResourceWrapper to schedule cleanup of its native resources when the\n    * Java object is flagged for collection by the garbage collector.\n+   *\n+   * @param owner,        The object that has retained the native resource.\n+   * @param nativeHandle, An opaque identifier for the native resource.\n+   * @param releaser,     A lambda that makes the native call to release the resouce.\n    */\n   public void register(EnvoyNativeResourceWrapper owner, long nativeHandle,\n                        EnvoyNativeResourceReleaser releaser) {\n", "next_change": {"commit": "cce3471164bdaae2b49d5c6906e58d34906768aa", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex af4307c1..6c17c4ea 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -61,7 +61,7 @@ public enum EnvoyNativeResourceRegistry {\n    *\n    * @param owner,        The object that has retained the native resource.\n    * @param nativeHandle, An opaque identifier for the native resource.\n-   * @param releaser,     A lambda that makes the native call to release the resouce.\n+   * @param releaser,     A lambda that makes the native call to release the resource.\n    */\n   public void register(EnvoyNativeResourceWrapper owner, long nativeHandle,\n                        EnvoyNativeResourceReleaser releaser) {\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4ODQ4OQ==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508788489", "body": "Docs for params", "bodyText": "Docs for params", "bodyHTML": "<p dir=\"auto\">Docs for params</p>", "author": "buildbreaker", "createdAt": "2020-10-20T19:36:05Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n+                             // be enqueued.\n+  private RefQueueThread\n+      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n+\n+  private class RefQueueThread extends Thread {\n+    public void run() {\n+      EnvoyPhantomRef ref;\n+      while (true) {\n+        try {\n+          ref = (EnvoyPhantomRef)refQueue.remove();\n+        } catch (InterruptedException e) {\n+          continue;\n+        }\n+\n+        ref.releaseResource();\n+        refMaintainer.remove(ref);\n+      }\n+    }\n+  }\n+\n+  private class EnvoyPhantomRef extends PhantomReference<EnvoyNativeResourceWrapper> {\n+    private final EnvoyNativeResourceReleaser releaser;\n+    private final long nativeHandle;\n+\n+    EnvoyPhantomRef(EnvoyNativeResourceWrapper owner, long nativeHandle,\n+                    EnvoyNativeResourceReleaser releaser) {\n+      super(owner, refQueue);\n+      this.nativeHandle = nativeHandle;\n+      this.releaser = releaser;\n+      refQueueThread = new RefQueueThread();\n+      refMaintainer = new ConcurrentHashMap().newKeySet();\n+      refQueueThread.start();\n+    }\n+\n+    void releaseResource() { releaser.release(nativeHandle); }\n+  }\n+\n+  /**\n+   * Register an EnvoyNativeResourceWrapper to schedule cleanup of its native resources when the\n+   * Java object is flagged for collection by the garbage collector.\n+   */\n+  public void register(EnvoyNativeResourceWrapper owner, long nativeHandle,\n+                       EnvoyNativeResourceReleaser releaser) {\n+    EnvoyPhantomRef ref = new EnvoyPhantomRef(owner, nativeHandle, releaser);\n+    refMaintainer.add(ref);\n+  }\n+\n+  public static void globalRegister(EnvoyNativeResourceWrapper owner, long nativeHandle,", "originalCommit": "54a1530db533470a24db502e112d2756d9cbeaaf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "85aace3482ea74d7247816f1448c9ad68caf6926", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex 27248dd0..af4307c1 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -58,6 +58,10 @@ public enum EnvoyNativeResourceRegistry {\n   /**\n    * Register an EnvoyNativeResourceWrapper to schedule cleanup of its native resources when the\n    * Java object is flagged for collection by the garbage collector.\n+   *\n+   * @param owner,        The object that has retained the native resource.\n+   * @param nativeHandle, An opaque identifier for the native resource.\n+   * @param releaser,     A lambda that makes the native call to release the resouce.\n    */\n   public void register(EnvoyNativeResourceWrapper owner, long nativeHandle,\n                        EnvoyNativeResourceReleaser releaser) {\n", "next_change": {"commit": "cce3471164bdaae2b49d5c6906e58d34906768aa", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex af4307c1..6c17c4ea 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -61,7 +61,7 @@ public enum EnvoyNativeResourceRegistry {\n    *\n    * @param owner,        The object that has retained the native resource.\n    * @param nativeHandle, An opaque identifier for the native resource.\n-   * @param releaser,     A lambda that makes the native call to release the resouce.\n+   * @param releaser,     A lambda that makes the native call to release the resource.\n    */\n   public void register(EnvoyNativeResourceWrapper owner, long nativeHandle,\n                        EnvoyNativeResourceReleaser releaser) {\n", "next_change": null}]}}, {"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex 27248dd0..af4307c1 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -65,6 +69,14 @@ public enum EnvoyNativeResourceRegistry {\n     refMaintainer.add(ref);\n   }\n \n+  /**\n+   * Register an EnvoyNativeResourceWrapper to schedule cleanup of its native resources when the\n+   * Java object is flagged for collection by the garbage collector.\n+   *\n+   * @param owner,        The object that has retained the native resource.\n+   * @param nativeHandle, An opaque identifier for the native resource.\n+   * @param releaser,     A lambda that makes the native call to release the resouce.\n+   */\n   public static void globalRegister(EnvoyNativeResourceWrapper owner, long nativeHandle,\n                                     EnvoyNativeResourceReleaser releaser) {\n     SINGLETON.register(owner, nativeHandle, releaser);\n", "next_change": {"commit": "cce3471164bdaae2b49d5c6906e58d34906768aa", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex af4307c1..6c17c4ea 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -75,7 +75,7 @@ public enum EnvoyNativeResourceRegistry {\n    *\n    * @param owner,        The object that has retained the native resource.\n    * @param nativeHandle, An opaque identifier for the native resource.\n-   * @param releaser,     A lambda that makes the native call to release the resouce.\n+   * @param releaser,     A lambda that makes the native call to release the resource.\n    */\n   public static void globalRegister(EnvoyNativeResourceWrapper owner, long nativeHandle,\n                                     EnvoyNativeResourceReleaser releaser) {\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4OTY5Nw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508789697", "body": "```suggestion\r\n  // References are automatically enqueued when the gc flags them as unreachable.\r\n  private ReferenceQueue refQueue;\r\n\r\n  // Maintains references in the object graph while we wait for them to\r\n  // be enqueued.\r\n  private Set refMaintainer;\r\n\r\n  // Blocks on the reference queue and calls the releaser of queued references.\r\n  private RefQueueThread refQueueThread;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private ReferenceQueue\n          \n          \n            \n                  refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n          \n          \n            \n              private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n          \n          \n            \n                                         // be enqueued.\n          \n          \n            \n              private RefQueueThread\n          \n          \n            \n                  refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n          \n          \n            \n              // References are automatically enqueued when the gc flags them as unreachable.\n          \n          \n            \n              private ReferenceQueue refQueue;\n          \n          \n            \n            \n          \n          \n            \n              // Maintains references in the object graph while we wait for them to\n          \n          \n            \n              // be enqueued.\n          \n          \n            \n              private Set refMaintainer;\n          \n          \n            \n            \n          \n          \n            \n              // Blocks on the reference queue and calls the releaser of queued references.\n          \n          \n            \n              private RefQueueThread refQueueThread;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">ReferenceQueue</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      refQueue; <span class=\"pl-c\"><span class=\"pl-c\">//</span> References are automatically enqueued when the gc flags them as unreachable.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">Set</span> refMaintainer; <span class=\"pl-c\"><span class=\"pl-c\">//</span> Maintains references in the object graph while we wait for them to</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                             <span class=\"pl-c\"><span class=\"pl-c\">//</span> be enqueued.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">RefQueueThread</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      refQueueThread; <span class=\"pl-c\"><span class=\"pl-c\">//</span> Blocks on the reference queue and calls the releaser of queued references.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> References are automatically enqueued when the gc flags them as unreachable.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">ReferenceQueue</span> refQueue;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> Maintains references in the object graph while we wait for them to</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> be enqueued.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">Set</span> refMaintainer;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-c\"><span class=\"pl-c\">//</span> Blocks on the reference queue and calls the releaser of queued references.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">RefQueueThread</span> refQueueThread;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "buildbreaker", "createdAt": "2020-10-20T19:38:05Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n+                             // be enqueued.\n+  private RefQueueThread\n+      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.", "originalCommit": "54a1530db533470a24db502e112d2756d9cbeaaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgwNDg5Nw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508804897", "bodyText": "The formatter did this; I didn't even notice. :p", "author": "goaway", "createdAt": "2020-10-20T20:05:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4OTY5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "85aace3482ea74d7247816f1448c9ad68caf6926", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex 27248dd0..af4307c1 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -15,12 +15,12 @@ import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n public enum EnvoyNativeResourceRegistry {\n   SINGLETON;\n \n-  private ReferenceQueue\n-      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n-  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n-                             // be enqueued.\n-  private RefQueueThread\n-      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n+  // References are automatically enqueued when the gc flags them as unreachable.\n+  private ReferenceQueue refQueue;\n+  // Maintains references in the object graph while we wait for them to be enqueued.\n+  private Set refMaintainer;\n+  // Blocks on the reference queue and calls the releaser of queued references.\n+  private RefQueueThread refQueueThread;\n \n   private class RefQueueThread extends Thread {\n     public void run() {\n", "next_change": null}]}, "revised_code_in_main": {"commit": "463a027db5f39b00e7ccdb58b65b9cb2583b3802", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex 27248dd0..6c17c4ea 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -15,12 +15,12 @@ import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n public enum EnvoyNativeResourceRegistry {\n   SINGLETON;\n \n-  private ReferenceQueue\n-      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n-  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n-                             // be enqueued.\n-  private RefQueueThread\n-      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n+  // References are automatically enqueued when the gc flags them as unreachable.\n+  private ReferenceQueue refQueue;\n+  // Maintains references in the object graph while we wait for them to be enqueued.\n+  private Set refMaintainer;\n+  // Blocks on the reference queue and calls the releaser of queued references.\n+  private RefQueueThread refQueueThread;\n \n   private class RefQueueThread extends Thread {\n     public void run() {\n", "next_change": {"commit": "01461c4365e1629d381f1c892119b24578acbdca", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex 6c17c4ea..d0f5a411 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -16,7 +16,7 @@ public enum EnvoyNativeResourceRegistry {\n   SINGLETON;\n \n   // References are automatically enqueued when the gc flags them as unreachable.\n-  private ReferenceQueue refQueue;\n+  private ReferenceQueue<EnvoyNativeResourceWrapper> refQueue;\n   // Maintains references in the object graph while we wait for them to be enqueued.\n   private Set refMaintainer;\n   // Blocks on the reference queue and calls the releaser of queued references.\n", "next_change": {"commit": "2db10d6c0dce9cdd9c67ff10cf948040855eba0d", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex d0f5a411..64ec20b5 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -13,7 +13,7 @@ import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n  * unreachable by the garbage collector.\n  */\n public enum EnvoyNativeResourceRegistry {\n-  SINGLETON;\n+  SINGLETON();\n \n   // References are automatically enqueued when the gc flags them as unreachable.\n   private ReferenceQueue<EnvoyNativeResourceWrapper> refQueue;\n", "next_change": null}]}}]}}]}, "commits_in_main": [{"oid": "463a027db5f39b00e7ccdb58b65b9cb2583b3802", "message": "Merge commit", "committedDate": null}, {"oid": "01461c4365e1629d381f1c892119b24578acbdca", "committedDate": "2020-10-23 07:16:29 +0800", "message": "java: add Android and Java async filter callback support (#1143)"}, {"oid": "2db10d6c0dce9cdd9c67ff10cf948040855eba0d", "committedDate": "2020-11-19 04:21:49 +0800", "message": "native resource registry: fix construction (#1179)"}, {"oid": "102b40d0da174200b4308a2677f6788a1df2a0aa", "committedDate": "2021-03-03 07:25:28 +0800", "message": "tests: centralize all tests under the //test target (#1273)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5MDAyNw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508790027", "body": "Is there a reason for this to be an enum?", "bodyText": "Is there a reason for this to be an enum?", "bodyHTML": "<p dir=\"auto\">Is there a reason for this to be an enum?</p>", "author": "buildbreaker", "createdAt": "2020-10-20T19:38:45Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {", "originalCommit": "54a1530db533470a24db502e112d2756d9cbeaaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgwNjYxMw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508806613", "bodyText": "Just a trivial way to make this a singleton for now.", "author": "goaway", "createdAt": "2020-10-20T20:08:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5MDAyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg5NDIyOQ==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508894229", "bodyText": "Alright", "author": "buildbreaker", "createdAt": "2020-10-20T23:15:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5MDAyNw=="}], "type": "inlineReview", "revised_code": {"commit": "85aace3482ea74d7247816f1448c9ad68caf6926", "changed_code": [{"header": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\nindex 27248dd0..af4307c1 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java\n", "chunk": "@@ -15,12 +15,12 @@ import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n public enum EnvoyNativeResourceRegistry {\n   SINGLETON;\n \n-  private ReferenceQueue\n-      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n-  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n-                             // be enqueued.\n-  private RefQueueThread\n-      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n+  // References are automatically enqueued when the gc flags them as unreachable.\n+  private ReferenceQueue refQueue;\n+  // Maintains references in the object graph while we wait for them to be enqueued.\n+  private Set refMaintainer;\n+  // Blocks on the reference queue and calls the releaser of queued references.\n+  private RefQueueThread refQueueThread;\n \n   private class RefQueueThread extends Thread {\n     public void run() {\n", "next_change": null}]}}, {"oid": "85aace3482ea74d7247816f1448c9ad68caf6926", "url": "https://github.com/envoyproxy/envoy-mobile/commit/85aace3482ea74d7247816f1448c9ad68caf6926", "message": "updates for comments\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-10-20T20:14:04Z", "type": "commit"}, {"oid": "cce3471164bdaae2b49d5c6906e58d34906768aa", "url": "https://github.com/envoyproxy/envoy-mobile/commit/cce3471164bdaae2b49d5c6906e58d34906768aa", "message": "typo\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>", "committedDate": "2020-10-20T20:17:04Z", "type": "commit"}]}