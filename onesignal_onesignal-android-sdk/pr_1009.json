{"pr_number": 1009, "pr_title": "Add Settings option to denied location prompt", "pr_author": "Jeasmine", "pr_createdAt": "2020-05-07T22:29:35Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1009", "timeline": [{"oid": "bcac731294c1a8a4dc27d81cbfa3bb78a0a4ebb2", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/bcac731294c1a8a4dc27d81cbfa3bb78a0a4ebb2", "message": "Don't show setting dialog after first  never ask again option click", "committedDate": "2020-05-07T22:44:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjI5MDk4OA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1009#discussion_r422290988", "body": "Maybe we should move this if check into a separate method to clean up this long `if-statement`, something like below?\r\n```\r\nif (shouldShowLocationPermissionSettings)\r\n    showLocationPermissionSettings();\r\n```\r\n**OR**\r\n```\r\nprivate void attemptToShowLocationPermissionSettings() {\r\n    if (fallbackToSettings \r\n            && neverAskAgainClicked \r\n            && !ActivityCompat.shouldShowRequestPermissionRationale(PermissionsActivity.this, LocationGMS.requestPermission))\r\n        showLocationPermissionSettings();\r\n}\r\n```", "bodyText": "Maybe we should move this if check into a separate method to clean up this long if-statement, something like below?\nif (shouldShowLocationPermissionSettings)\n    showLocationPermissionSettings();\n\nOR\nprivate void attemptToShowLocationPermissionSettings() {\n    if (fallbackToSettings \n            && neverAskAgainClicked \n            && !ActivityCompat.shouldShowRequestPermissionRationale(PermissionsActivity.this, LocationGMS.requestPermission))\n        showLocationPermissionSettings();\n}", "bodyHTML": "<p dir=\"auto\">Maybe we should move this if check into a separate method to clean up this long <code>if-statement</code>, something like below?</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"if (shouldShowLocationPermissionSettings)\n    showLocationPermissionSettings();\"><pre><code>if (shouldShowLocationPermissionSettings)\n    showLocationPermissionSettings();\n</code></pre></div>\n<p dir=\"auto\"><strong>OR</strong></p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"private void attemptToShowLocationPermissionSettings() {\n    if (fallbackToSettings \n            &amp;&amp; neverAskAgainClicked \n            &amp;&amp; !ActivityCompat.shouldShowRequestPermissionRationale(PermissionsActivity.this, LocationGMS.requestPermission))\n        showLocationPermissionSettings();\n}\"><pre><code>private void attemptToShowLocationPermissionSettings() {\n    if (fallbackToSettings \n            &amp;&amp; neverAskAgainClicked \n            &amp;&amp; !ActivityCompat.shouldShowRequestPermissionRationale(PermissionsActivity.this, LocationGMS.requestPermission))\n        showLocationPermissionSettings();\n}\n</code></pre></div>", "author": "mikechoch", "createdAt": "2020-05-08T18:09:32Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/PermissionsActivity.java", "diffHunk": "@@ -104,10 +109,16 @@ public void onRequestPermissionsResult(final int requestCode, @NonNull String pe\n             public void run() {\n                boolean granted = grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED;\n                LocationGMS.sendAndClearPromptHandlers(true, granted);\n-               if (granted)\n+               if (granted) {\n                   LocationGMS.startGetLocation();\n-               else\n+               } else {\n+                  if (fallbackToSettings &&\n+                          neverAskAgainClicked &&\n+                          !ActivityCompat.shouldShowRequestPermissionRationale(PermissionsActivity.this, LocationGMS.requestPermission)) {", "originalCommit": "bcac731294c1a8a4dc27d81cbfa3bb78a0a4ebb2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a8ff1715a8da07ec36f278cae625429d3ef3763a", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a8ff1715a8da07ec36f278cae625429d3ef3763a", "message": "Change message text and address comments", "committedDate": "2020-05-08T22:56:03Z", "type": "forcePushed"}, {"oid": "d28187e7e9ee5ddc255e44c87ef73c271cf5af76", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d28187e7e9ee5ddc255e44c87ef73c271cf5af76", "message": "Add Settings option to denied location prompt\n\n   * Whenever the user clicks on never ask again option and denies the permission,\n     we will show the reason why we need it and the option to open settings and change the location permission\n   * Don't show setting dialog after first never ask again option click", "committedDate": "2020-05-11T22:19:45Z", "type": "commit"}, {"oid": "d28187e7e9ee5ddc255e44c87ef73c271cf5af76", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d28187e7e9ee5ddc255e44c87ef73c271cf5af76", "message": "Add Settings option to denied location prompt\n\n   * Whenever the user clicks on never ask again option and denies the permission,\n     we will show the reason why we need it and the option to open settings and change the location permission\n   * Don't show setting dialog after first never ask again option click", "committedDate": "2020-05-11T22:19:45Z", "type": "forcePushed"}]}