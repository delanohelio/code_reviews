{"pr_number": 3520, "pr_title": "RHDM-1458: [DMN Designer] Multiple DRDs support - The undo/read are lost when user changes between diagrams", "pr_author": "danielzhe", "pr_createdAt": "2020-12-16T07:38:37Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3520", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE3MjE0NA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3520#discussion_r553172144", "body": "I think it is not intuitive to override setter method in this way. `setUndoRedoCommandDisabled` is invoked from `AbstractDiagramEditorMenuSessionItems#setEnabled`, however we already override `AbstractDiagramEditorMenuSessionItems#setEnabled` as `DMNEditorMenuSessionItems#setEnabled`.  `DMNEditorMenuSessionItems#setEnabled` calls `AbstractDiagramEditorMenuSessionItems#setEnabled` plus initialization of `Automatic Layout` menu item.\r\n\r\nIt is hard to understand. I think we could simplify the codebase if we:\r\n- do not introduce `setUndoRedoCommandDisabled` method\r\n- move at least [1] from `AbstractDiagramEditorMenuSessionItems#setEnabled` to `AbstractDiagramEditorMenuSessionItems#populateItems`\r\n\r\nOne more concern is we have `org.kie.workbench.common.dmn.project.client.editor.DMNEditorMenuSessionItems` and `org.kie.workbench.common.dmn.webapp.kogito.common.client.editor.DMNEditorMenuSessionItems` but we overide `setUndoRedoCommandDisabled` just in the first listed.\r\n\r\n[1]\r\n```java\r\nsetItemEnabled(UndoSessionCommand.class, false);\r\nsetItemEnabled(RedoSessionCommand.class, false);\r\n```\r\n", "bodyText": "I think it is not intuitive to override setter method in this way. setUndoRedoCommandDisabled is invoked from AbstractDiagramEditorMenuSessionItems#setEnabled, however we already override AbstractDiagramEditorMenuSessionItems#setEnabled as DMNEditorMenuSessionItems#setEnabled.  DMNEditorMenuSessionItems#setEnabled calls AbstractDiagramEditorMenuSessionItems#setEnabled plus initialization of Automatic Layout menu item.\nIt is hard to understand. I think we could simplify the codebase if we:\n\ndo not introduce setUndoRedoCommandDisabled method\nmove at least [1] from AbstractDiagramEditorMenuSessionItems#setEnabled to AbstractDiagramEditorMenuSessionItems#populateItems\n\nOne more concern is we have org.kie.workbench.common.dmn.project.client.editor.DMNEditorMenuSessionItems and org.kie.workbench.common.dmn.webapp.kogito.common.client.editor.DMNEditorMenuSessionItems but we overide setUndoRedoCommandDisabled just in the first listed.\n[1]\nsetItemEnabled(UndoSessionCommand.class, false);\nsetItemEnabled(RedoSessionCommand.class, false);", "bodyHTML": "<p dir=\"auto\">I think it is not intuitive to override setter method in this way. <code>setUndoRedoCommandDisabled</code> is invoked from <code>AbstractDiagramEditorMenuSessionItems#setEnabled</code>, however we already override <code>AbstractDiagramEditorMenuSessionItems#setEnabled</code> as <code>DMNEditorMenuSessionItems#setEnabled</code>.  <code>DMNEditorMenuSessionItems#setEnabled</code> calls <code>AbstractDiagramEditorMenuSessionItems#setEnabled</code> plus initialization of <code>Automatic Layout</code> menu item.</p>\n<p dir=\"auto\">It is hard to understand. I think we could simplify the codebase if we:</p>\n<ul dir=\"auto\">\n<li>do not introduce <code>setUndoRedoCommandDisabled</code> method</li>\n<li>move at least [1] from <code>AbstractDiagramEditorMenuSessionItems#setEnabled</code> to <code>AbstractDiagramEditorMenuSessionItems#populateItems</code></li>\n</ul>\n<p dir=\"auto\">One more concern is we have <code>org.kie.workbench.common.dmn.project.client.editor.DMNEditorMenuSessionItems</code> and <code>org.kie.workbench.common.dmn.webapp.kogito.common.client.editor.DMNEditorMenuSessionItems</code> but we overide <code>setUndoRedoCommandDisabled</code> just in the first listed.</p>\n<p dir=\"auto\">[1]</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"setItemEnabled(UndoSessionCommand.class, false);\nsetItemEnabled(RedoSessionCommand.class, false);\"><pre>setItemEnabled(<span class=\"pl-smi\">UndoSessionCommand</span><span class=\"pl-k\">.</span>class, <span class=\"pl-c1\">false</span>);\nsetItemEnabled(<span class=\"pl-smi\">RedoSessionCommand</span><span class=\"pl-k\">.</span>class, <span class=\"pl-c1\">false</span>);</pre></div>", "author": "jomarko", "createdAt": "2021-01-07T08:20:19Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-project-client/src/main/java/org/kie/workbench/common/dmn/project/client/editor/DMNEditorMenuSessionItems.java", "diffHunk": "@@ -82,6 +82,11 @@ public void setEnabled(final boolean enabled) {\n         setItemEnabled(DMNPerformAutomaticLayoutCommand.class, enabled);\n     }\n \n+    @Override\n+    protected void setUndoRedoCommandDisabled() {\n+        // Override to keep the status of the undo/redo commands set when they are bind to session.\n+    }", "originalCommit": "d26855292f9452b60c32a27d37c20bc6ee96d56a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDM0ODE2MQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3520#discussion_r560348161", "bodyText": "Sorry, I'm lost, I don't get it what you are proposing. I think it's clear enough the way it is and I don't get it why that refactor you are proposing will make it more clear.\nsetEnable is for one purpose and setUndoRedoCommandDisabled is for another purpose.", "author": "danielzhe", "createdAt": "2021-01-19T17:19:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE3MjE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDM1MDM0OA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3520#discussion_r560350348", "bodyText": "We can't do what you are proposing (let the check status for AbstractDiagramEditorMenuSessionItems#bind\nUndoSessionCommand#checkState, RedoSessionCommand#checkState). It was that way at the first time but it leads to an issue when we change between multiple DRDs because setEnabled in AbstractDiagramEditorMenuSessionItems was always overriding it and setting the undo/redo commands to disabled.", "author": "danielzhe", "createdAt": "2021-01-19T17:22:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE3MjE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDk0OTc3Nw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3520#discussion_r560949777", "bodyText": "I do not agree setUndoRedoCommandDisabled is for different purpose than setEnable. In AbstractDiagramEditorMenuSessionItems.setEnable we clearly invoke setUndoRedoCommandDisabled. Both are handling menu items accessibility.\nHowever we are facing here wrong architecture from my point of view. as setEnable is parameterized with a boolean parameter. I find it as non intuitive. We handle accessibility for most menu items in setEnable however for some of them we ignore the boolean parameter and just disable them.\nThis 'always disable' caused RHDM-1458. That is why I think this moving [1] from AbstractDiagramEditorMenuSessionItems#setEnabled to AbstractDiagramEditorMenuSessionItems#populateItems could be more proper way to fix this issue.\nI can not invest more time to this investigation. Will take me a lot of time to write automated UI test to verify this PR.\n[1]\nsetItemEnabled(UndoSessionCommand.class, false);\nsetItemEnabled(RedoSessionCommand.class, false);", "author": "jomarko", "createdAt": "2021-01-20T13:14:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzE3MjE0NA=="}], "type": "inlineReview"}, {"oid": "5fee9f438af499d3302ad94028ab53ad1ae1ee2c", "url": "https://github.com/kiegroup/kie-wb-common/commit/5fee9f438af499d3302ad94028ab53ad1ae1ee2c", "message": "RHDM-1458: [DMN Designer] Multiple DRDs support - The undo/read are lost when user changes between diagrams", "committedDate": "2021-01-21T19:36:09Z", "type": "commit"}]}