{"pr_number": 1481, "pr_title": "Fix too noisy B3 propagator", "pr_author": "iNikem", "pr_createdAt": "2020-07-30T07:06:04Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1481", "timeline": [{"oid": "6ef6883293f70f243b606fc1d817d26a70e9cc1b", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/6ef6883293f70f243b606fc1d817d26a70e9cc1b", "message": "Fix too noisy B3 propagator", "committedDate": "2020-07-30T06:53:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5Njk0Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1481#discussion_r462796947", "body": "the other propagators log with `info`\r\n```suggestion\r\n      logger.info(\r\n```", "bodyText": "the other propagators log with info\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  logger.warning(\n          \n          \n            \n                  logger.info(", "bodyHTML": "<p dir=\"auto\">the other propagators log with <code>info</code></p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      logger<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">warning</span>(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      logger<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">info</span>(</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "trask", "createdAt": "2020-07-30T07:17:17Z", "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/B3PropagatorExtractorMultipleHeaders.java", "diffHunk": "@@ -49,8 +49,11 @@\n   private static <C> SpanContext getSpanContextFromMultipleHeaders(\n       C carrier, HttpTextFormat.Getter<C> getter) {\n     String traceId = getter.get(carrier, TRACE_ID_HEADER);\n+    if (StringUtils.isNullOrEmpty(traceId)) {\n+      return SpanContext.getInvalid();\n+    }\n     if (!Common.isTraceIdValid(traceId)) {\n-      logger.info(\n+      logger.warning(", "originalCommit": "6ef6883293f70f243b606fc1d817d26a70e9cc1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgwNDAwOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1481#discussion_r462804009", "bodyText": "Maybe we should change them? If there is a non-empty header, but its format is wrong, shouldn't this be WARN?", "author": "iNikem", "createdAt": "2020-07-30T07:31:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5Njk0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjgxNTgwMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1481#discussion_r462815800", "bodyText": "If upstream sends a bad header, I'd be unhappy to have warning logs spammed without much I can do about it. In general, I'd say tracing should avoid spamming logs as much as possible (even info is a bit questionable, warning much more).", "author": "anuraaga", "createdAt": "2020-07-30T07:53:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5Njk0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg0NzcxMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1481#discussion_r462847711", "bodyText": "But without logs, how do you know about that bad header?", "author": "iNikem", "createdAt": "2020-07-30T08:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5Njk0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkxMDEwNA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1481#discussion_r462910104", "bodyText": "I'd generally recommend metrics or using a lower than default level which can be enabled for tests.\nLog spam does have reasonable potential to bring down an app and no one likes it when observability kills the app (even if it's an issue of configuring logs in a scalable way etc).", "author": "anuraaga", "createdAt": "2020-07-30T10:43:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5Njk0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5MzQ5NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1481#discussion_r463193494", "bodyText": "Yes, definitely. If an unknown upstream actor can creating an arbitrary amount of log spam just by setting some bad headers, that's a DOS attack waiting to happen.", "author": "jkwatson", "createdAt": "2020-07-30T18:34:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5Njk0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQxOTQ0NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1481#discussion_r463419444", "bodyText": "Changed all log levels to fine", "author": "iNikem", "createdAt": "2020-07-31T05:57:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc5Njk0Nw=="}], "type": "inlineReview"}, {"oid": "d17993d13139c0babbe89b4a8cbd2eb272c5ed03", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d17993d13139c0babbe89b4a8cbd2eb272c5ed03", "message": "Reduce log level", "committedDate": "2020-07-31T05:56:57Z", "type": "commit"}]}