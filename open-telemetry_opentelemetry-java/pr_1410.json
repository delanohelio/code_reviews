{"pr_number": 1410, "pr_title": "Add semantic attributes for messaging", "pr_author": "iNikem", "pr_createdAt": "2020-07-13T05:59:46Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1410", "timeline": [{"oid": "946bd7b678fdb3d2e049aaf27be60a4a281ebc81", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/946bd7b678fdb3d2e049aaf27be60a4a281ebc81", "message": "Add semantic attributes for messaging", "committedDate": "2020-07-13T05:57:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NjM5Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1410#discussion_r453686396", "body": "```suggestion\r\n  /**\r\n   * A string identifying which kind of message consumption this span describes.\r\n   * Either \"receive\" or \"process\".\r\n   * For message consumers only.\r\n   */\r\n  public static final StringAttributeSetter MESSAGING_CONVERSATION_ID =\r\n      StringAttributeSetter.create(\"messaging.operation\");\r\n\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n              /**\n          \n          \n            \n               * A string identifying which kind of message consumption this span describes.\n          \n          \n            \n               * Either \"receive\" or \"process\".\n          \n          \n            \n               * For message consumers only.\n          \n          \n            \n               */\n          \n          \n            \n              public static final StringAttributeSetter MESSAGING_CONVERSATION_ID =\n          \n          \n            \n                  StringAttributeSetter.create(\"messaging.operation\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"211\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"211\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"x x-first\">  </span><span class=\"pl-c\"><span class=\"pl-c x x-last\">/**</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"212\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">A</span> string identifying which kind of message consumption <span class=\"pl-c1\">this</span> span describes.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"213\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Either</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>receive<span class=\"pl-pds\">\"</span></span> or <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>process<span class=\"pl-pds\">\"</span></span><span class=\"pl-c1\">.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"214\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">For</span> message consumers only.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"215\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*/</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"216\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">StringAttributeSetter</span> <span class=\"pl-c1\">MESSAGING_CONVERSATION_ID</span> <span class=\"pl-k\">=</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"217\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      <span class=\"pl-smi\">StringAttributeSetter</span><span class=\"pl-k\">.</span>create(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>messaging.operation<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"218\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "arminru", "createdAt": "2020-07-13T14:22:33Z", "path": "api/src/main/java/io/opentelemetry/trace/attributes/SemanticAttributes.java", "diffHunk": "@@ -154,5 +154,53 @@\n   /** JDBC substring like \"mysql://db.example.com:3306\" */\n   public static final StringAttributeSetter DB_URL = StringAttributeSetter.create(\"db.url\");\n \n+  /** A string identifying the messaging system such as kafka, rabbitmq or activemq. */\n+  public static final StringAttributeSetter MESSAGING_SYSTEM =\n+      StringAttributeSetter.create(\"messaging.system\");\n+  /**\n+   * The message destination name, e.g. MyQueue or MyTopic. This might be equal to the span name but\n+   * is required nevertheless\n+   */\n+  public static final StringAttributeSetter MESSAGING_DESTINATION =\n+      StringAttributeSetter.create(\"messaging.destination\");\n+  /** The kind of message destination. Either queue or topic. */\n+  public static final StringAttributeSetter MESSAGING_DESTINATION_KIND =\n+      StringAttributeSetter.create(\"messaging.destination_kind\");\n+  /** A boolean that is true if the message destination is temporary. */\n+  public static final BooleanAttributeSetter MESSAGING_TEMP_DESTINATION =\n+      BooleanAttributeSetter.create(\"messaging.temp_destination\");\n+  /** The name of the transport protocol such as AMQP or MQTT. */\n+  public static final StringAttributeSetter MESSAGING_PROTOCOL =\n+      StringAttributeSetter.create(\"messaging.protocol\");\n+  /** The version of the transport protocol such as 0.9.1. */\n+  public static final StringAttributeSetter MESSAGING_PROTOCOL_VERSION =\n+      StringAttributeSetter.create(\"messaging.protocol_version\");\n+  /**\n+   * Connection string such as tibjmsnaming://localhost:7222 or\n+   * https://queue.amazonaws.com/80398EXAMPLE/MyQueue\n+   */\n+  public static final StringAttributeSetter MESSAGING_URL =\n+      StringAttributeSetter.create(\"messaging.url\");\n+  /**\n+   * A value used by the messaging system as an identifier for the message, represented as a string.\n+   */\n+  public static final StringAttributeSetter MESSAGING_MESSAGE_ID =\n+      StringAttributeSetter.create(\"messaging.message_id\");\n+  /**\n+   * A value identifying the conversation to which the message belongs, represented as a string.\n+   * Sometimes called \"Correlation ID\".\n+   */\n+  public static final StringAttributeSetter MESSAGING_CONVERSATION_ID =\n+      StringAttributeSetter.create(\"messaging.conversation_id\");\n+  /**\n+   * The (uncompressed) size of the message payload in bytes. Also use this attribute if it is\n+   * unknown whether the compressed or uncompressed payload size is reported.\n+   */\n+  public static final LongAttributeSetter MESSAGING_MESSAGE_PAYLOAD_SIZE_BYTES =\n+      LongAttributeSetter.create(\"messaging.message_payload_size_bytes\");\n+  /** The compressed size of the message payload in bytes. */\n+  public static final LongAttributeSetter MESSAGING_MESSAGE_PAYLOAD_COMPRESSED_SIZE_BYTES =\n+      LongAttributeSetter.create(\"messaging.message_payload_compressed_size_bytes\");\n+", "originalCommit": "946bd7b678fdb3d2e049aaf27be60a4a281ebc81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5NTg4OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1410#discussion_r453695889", "bodyText": "Thanks! Added.", "author": "iNikem", "createdAt": "2020-07-13T14:35:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NjM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcxNTQyNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1410#discussion_r453715425", "bodyText": "Sure!\nIt would make sense to add the \"for message consumer only\" indication as well. Users should consult the spec anyway but will likely not read up on it if part of it is already shown in their IDE quick definition.", "author": "arminru", "createdAt": "2020-07-13T15:02:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NjM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcxNzM4MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1410#discussion_r453717381", "bodyText": "Doesn't current javadoc says this in first sentence? \"A string identifying which part and kind of message consumption this span describes\"", "author": "iNikem", "createdAt": "2020-07-13T15:05:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NjM5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI4NzUzNA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1410#discussion_r454287534", "bodyText": "I'd personally make it more explicit but it should be fine as it is as well.", "author": "arminru", "createdAt": "2020-07-14T11:26:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY4NjM5Ng=="}], "type": "inlineReview"}, {"oid": "f2e10ee611f45c5fcea3d6bf1cfe42c35514e864", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f2e10ee611f45c5fcea3d6bf1cfe42c35514e864", "message": "Add semantic attributes for messaging", "committedDate": "2020-07-13T14:35:11Z", "type": "commit"}]}