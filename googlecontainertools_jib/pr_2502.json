{"pr_number": 2502, "pr_title": "Add project dependencies in a separate layer for WAR projects", "pr_author": "WuYff", "pr_createdAt": "2020-05-30T16:30:00Z", "pr_url": "https://github.com/GoogleContainerTools/jib/pull/2502", "timeline": [{"oid": "e6cef047d8966fbd53fca87673e86135dd95724e", "url": "https://github.com/GoogleContainerTools/jib/commit/e6cef047d8966fbd53fca87673e86135dd95724e", "message": "add project dependencies for WAR project", "committedDate": "2020-05-30T10:19:27Z", "type": "commit"}, {"oid": "c1916074d99f29f9b1e0d7745958f915272e00ab", "url": "https://github.com/GoogleContainerTools/jib/commit/c1916074d99f29f9b1e0d7745958f915272e00ab", "message": " add test for project dependencies of WAR project", "committedDate": "2020-05-30T14:37:54Z", "type": "commit"}, {"oid": "00dcb2356073024b2536d02e6e31713c9d87f676", "url": "https://github.com/GoogleContainerTools/jib/commit/00dcb2356073024b2536d02e6e31713c9d87f676", "message": "format", "committedDate": "2020-05-30T15:23:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4MTY3MQ==", "url": "https://github.com/GoogleContainerTools/jib/pull/2502#discussion_r433281671", "body": "I'd prefer calling `addProjectDependencies` after `addSnapshotDependencies`. That is, the order should be\r\n1. add 3rd-party dependencies\r\n1. add snapshot dependencies\r\n1. add project dependencies\r\n\r\nAnd let's chain `.filter()`.\r\n```suggestion\r\n              .filter(path -> !path.getFileName().toString().contains(\"SNAPSHOT\"))\r\n              .filter(path -> !projectArtifacts.contains(path.getFileName().toString()))\r\n```\r\nAlso, now it's better to give names to these predicates. For example,\r\n\r\n```java\r\n.filter(path -> !isSnapshot(path))\r\n.filter(path -> !isProjectDependency(path))\r\n...\r\n.filter(isSnapshot)\r\n....\r\n.filter(isProjectDependency)\r\n```", "bodyText": "I'd prefer calling addProjectDependencies after addSnapshotDependencies. That is, the order should be\n\nadd 3rd-party dependencies\nadd snapshot dependencies\nadd project dependencies\n\nAnd let's chain .filter().\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                          .filter(\n          \n          \n            \n                              path ->\n          \n          \n            \n                                  !path.getFileName().toString().contains(\"SNAPSHOT\")\n          \n          \n            \n                                      && !projectArtifacts.contains(path.getFileName().toString()))\n          \n          \n            \n                          .filter(path -> !path.getFileName().toString().contains(\"SNAPSHOT\"))\n          \n          \n            \n                          .filter(path -> !projectArtifacts.contains(path.getFileName().toString()))\n          \n      \n    \n    \n  \n\nAlso, now it's better to give names to these predicates. For example,\n.filter(path -> !isSnapshot(path))\n.filter(path -> !isProjectDependency(path))\n...\n.filter(isSnapshot)\n....\n.filter(isProjectDependency)", "bodyHTML": "<p dir=\"auto\">I'd prefer calling <code>addProjectDependencies</code> after <code>addSnapshotDependencies</code>. That is, the order should be</p>\n<ol dir=\"auto\">\n<li>add 3rd-party dependencies</li>\n<li>add snapshot dependencies</li>\n<li>add project dependencies</li>\n</ol>\n<p dir=\"auto\">And let's chain <code>.filter()</code>.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">              .filter(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                  path <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                      <span class=\"pl-k\">!</span>path<span class=\"pl-k\">.</span>getFileName()<span class=\"pl-k\">.</span>toString()<span class=\"pl-k\">.</span>contains(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>SNAPSHOT<span class=\"pl-pds\">\"</span></span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                          <span class=\"pl-k\">&amp;&amp;</span> <span class=\"pl-k\">!</span>projectArtifacts<span class=\"pl-k\">.</span>contains(path<span class=\"pl-k\">.</span>getFileName()<span class=\"pl-k\">.</span>toString()))</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">              .filter(path <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> <span class=\"pl-k\">!</span>path<span class=\"pl-k\">.</span>getFileName()<span class=\"pl-k\">.</span>toString()<span class=\"pl-k\">.</span>contains(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>SNAPSHOT<span class=\"pl-pds\">\"</span></span>))</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">              .filter(path <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> <span class=\"pl-k\">!</span>projectArtifacts<span class=\"pl-k\">.</span>contains(path<span class=\"pl-k\">.</span>getFileName()<span class=\"pl-k\">.</span>toString()))</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">Also, now it's better to give names to these predicates. For example,</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\".filter(path -&gt; !isSnapshot(path))\n.filter(path -&gt; !isProjectDependency(path))\n...\n.filter(isSnapshot)\n....\n.filter(isProjectDependency)\"><pre>.filter(path <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> <span class=\"pl-k\">!</span>isSnapshot(path))\n.filter(path <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> <span class=\"pl-k\">!</span>isProjectDependency(path))\n<span class=\"pl-c1\">...</span>\n.filter(isSnapshot)\n<span class=\"pl-c1\">....</span>\n.filter(isProjectDependency)</pre></div>", "author": "chanseokoh", "createdAt": "2020-06-01T14:52:06Z", "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/JavaContainerBuilderHelper.java", "diffHunk": "@@ -123,10 +126,18 @@ public static JibContainerBuilder fromExplodedWar(\n       javaContainerBuilder.addClasses(webInfClasses, isClassFile);\n     }\n     if (Files.exists(webInfLib)) {\n+      javaContainerBuilder.addProjectDependencies(\n+          new DirectoryWalker(webInfLib)\n+              .filterRoot()\n+              .filter(path -> projectArtifacts.contains(path.getFileName().toString()))\n+              .walk());\n       javaContainerBuilder.addDependencies(\n           new DirectoryWalker(webInfLib)\n               .filterRoot()\n-              .filter(path -> !path.getFileName().toString().contains(\"SNAPSHOT\"))\n+              .filter(\n+                  path ->\n+                      !path.getFileName().toString().contains(\"SNAPSHOT\")\n+                          && !projectArtifacts.contains(path.getFileName().toString()))", "originalCommit": "00dcb2356073024b2536d02e6e31713c9d87f676", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4NjE2NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2502#discussion_r433286164", "body": "`projectArtifacts` --> `projectArtifactFilename`\r\n\r\nand update the Javadoc accordingly.", "bodyText": "projectArtifacts --> projectArtifactFilename\nand update the Javadoc accordingly.", "bodyHTML": "<p dir=\"auto\"><code>projectArtifacts</code> --&gt; <code>projectArtifactFilename</code></p>\n<p dir=\"auto\">and update the Javadoc accordingly.</p>", "author": "chanseokoh", "createdAt": "2020-06-01T14:59:26Z", "path": "jib-plugins-common/src/main/java/com/google/cloud/tools/jib/plugins/common/JavaContainerBuilderHelper.java", "diffHunk": "@@ -98,11 +99,13 @@ public static FileEntriesLayer extraDirectoryLayerConfiguration(\n    *\n    * @param javaContainerBuilder Java container builder to start with\n    * @param explodedWar the exploded WAR directory\n+   * @param projectArtifacts the project artifacts for project dependencies\n    * @return {@link JibContainerBuilder} containing the layers for the exploded WAR\n    * @throws IOException if adding layer contents fails\n    */\n   public static JibContainerBuilder fromExplodedWar(\n-      JavaContainerBuilder javaContainerBuilder, Path explodedWar) throws IOException {\n+      JavaContainerBuilder javaContainerBuilder, Path explodedWar, Set<String> projectArtifacts)", "originalCommit": "00dcb2356073024b2536d02e6e31713c9d87f676", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4NzUxMA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2502#discussion_r433287510", "body": "Like what you did in Gradle, you can refactoring this out to a variable and reuse it below as well.", "bodyText": "Like what you did in Gradle, you can refactoring this out to a variable and reuse it below as well.", "bodyHTML": "<p dir=\"auto\">Like what you did in Gradle, you can refactoring this out to a variable and reuse it below as well.</p>", "author": "chanseokoh", "createdAt": "2020-06-01T15:01:30Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "diffHunk": "@@ -256,7 +257,16 @@ public JibContainerBuilder createJibContainerBuilder(\n         Path war = getWarArtifact();\n         Path explodedWarPath = tempDirectoryProvider.newDirectory();\n         ZipUtil.unzip(war, explodedWarPath);\n-        return JavaContainerBuilderHelper.fromExplodedWar(javaContainerBuilder, explodedWarPath);\n+        return JavaContainerBuilderHelper.fromExplodedWar(\n+            javaContainerBuilder,\n+            explodedWarPath,\n+            session\n+                .getProjects()\n+                .stream()\n+                .map(MavenProject::getArtifact)\n+                .map(Artifact::getFile)\n+                .map(File::getName)\n+                .collect(Collectors.toSet()));", "originalCommit": "00dcb2356073024b2536d02e6e31713c9d87f676", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4OTIxNA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2502#discussion_r433289214", "body": "```suggestion\r\n    Files.createFile(temporaryExplodedWar.resolve(\"WEB-INF/lib/project-dependency-1.0.0.jar\"));\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                File f = new File(temporaryExplodedWar.resolve(\"WEB-INF/lib/dependencyA-1.0.0.jar\").toString());\n          \n          \n            \n                f.createNewFile();\n          \n          \n            \n                Files.createFile(temporaryExplodedWar.resolve(\"WEB-INF/lib/project-dependency-1.0.0.jar\"));", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-smi\">File</span> f <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">File</span>(temporaryExplodedWar<span class=\"pl-k\">.</span>resolve(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>WEB-INF/lib/dependencyA-1.0.0.jar<span class=\"pl-pds\">\"</span></span>)<span class=\"pl-k\">.</span>toString());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    f<span class=\"pl-k\">.</span>createNewFile();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-smi\">Files</span><span class=\"pl-k\">.</span>createFile(temporaryExplodedWar<span class=\"pl-k\">.</span>resolve(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>WEB-INF/lib/project-dependency-1.0.0.jar<span class=\"pl-pds\">\"</span></span>));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "chanseokoh", "createdAt": "2020-06-01T15:04:42Z", "path": "jib-plugins-common/src/test/java/com/google/cloud/tools/jib/plugins/common/JavaContainerBuilderHelperTest.java", "diffHunk": "@@ -188,14 +191,18 @@ public void testFromExplodedWar()\n         Paths.get(Resources.getResource(\"plugins-common/exploded-war\").toURI());\n     FileOperations.copy(ImmutableList.of(resourceExplodedWar), temporaryFolder.getRoot().toPath());\n     Path temporaryExplodedWar = temporaryFolder.getRoot().toPath().resolve(\"exploded-war\");\n-\n     Files.createDirectories(temporaryExplodedWar.resolve(\"WEB-INF/classes/empty_dir\"));\n+    File f = new File(temporaryExplodedWar.resolve(\"WEB-INF/lib/dependencyA-1.0.0.jar\").toString());\n+    f.createNewFile();", "originalCommit": "00dcb2356073024b2536d02e6e31713c9d87f676", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4OTU2NA==", "url": "https://github.com/GoogleContainerTools/jib/pull/2502#discussion_r433289564", "body": "```suggestion\r\n    projectArtifacts.add(\"project-dependency-1.0.0.jar\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                projectArtifacts.add(f.getName());\n          \n          \n            \n                projectArtifacts.add(\"project-dependency-1.0.0.jar\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    projectArtifacts<span class=\"pl-k\">.</span>add(<span class=\"x x-first\">f</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getName()</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    projectArtifacts<span class=\"pl-k\">.</span>add(<span class=\"pl-s\"><span class=\"pl-pds x x-first\">\"</span><span class=\"x\">project-dependency-1.0.0.jar</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "chanseokoh", "createdAt": "2020-06-01T15:05:19Z", "path": "jib-plugins-common/src/test/java/com/google/cloud/tools/jib/plugins/common/JavaContainerBuilderHelperTest.java", "diffHunk": "@@ -188,14 +191,18 @@ public void testFromExplodedWar()\n         Paths.get(Resources.getResource(\"plugins-common/exploded-war\").toURI());\n     FileOperations.copy(ImmutableList.of(resourceExplodedWar), temporaryFolder.getRoot().toPath());\n     Path temporaryExplodedWar = temporaryFolder.getRoot().toPath().resolve(\"exploded-war\");\n-\n     Files.createDirectories(temporaryExplodedWar.resolve(\"WEB-INF/classes/empty_dir\"));\n+    File f = new File(temporaryExplodedWar.resolve(\"WEB-INF/lib/dependencyA-1.0.0.jar\").toString());\n+    f.createNewFile();\n+    Set<String> projectArtifacts = new HashSet<>();\n+    projectArtifacts.add(f.getName());", "originalCommit": "00dcb2356073024b2536d02e6e31713c9d87f676", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "62dba12c4e9070129bc5ad572712891515e9a662", "url": "https://github.com/GoogleContainerTools/jib/commit/62dba12c4e9070129bc5ad572712891515e9a662", "message": "refactor code", "committedDate": "2020-06-03T15:31:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2ODAzNw==", "url": "https://github.com/GoogleContainerTools/jib/pull/2502#discussion_r437468037", "body": "nit: for consistency with Gradle, let's say\r\n```suggestion\r\n      Set<Artifact> artifactsFromAllProjects =\r\n          session.getProjects().stream().map(MavenProject::getArtifact).collect(Collectors.toSet());\r\n```", "bodyText": "nit: for consistency with Gradle, let's say\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                  Stream<Artifact> mavenProjectArtifactStream =\n          \n          \n            \n                      session.getProjects().stream().map(MavenProject::getArtifact);\n          \n          \n            \n                  Set<Artifact> artifactsFromAllProjects =\n          \n          \n            \n                      session.getProjects().stream().map(MavenProject::getArtifact).collect(Collectors.toSet());", "bodyHTML": "<p dir=\"auto\">nit: for consistency with Gradle, let's say</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      <span class=\"pl-k\">Stream&lt;<span class=\"pl-smi\">Artifact</span>&gt;</span> mavenProjectArtifactStream <span class=\"pl-k\">=</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          session<span class=\"pl-k\">.</span>getProjects()<span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>map(<span class=\"pl-smi\">MavenProject</span><span class=\"pl-k\">::</span>getArtifact);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      <span class=\"pl-k\">Set&lt;<span class=\"pl-smi\">Artifact</span>&gt;</span> artifactsFromAllProjects <span class=\"pl-k\">=</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">          session<span class=\"pl-k\">.</span>getProjects()<span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>map(<span class=\"pl-smi\">MavenProject</span><span class=\"pl-k\">::</span>getArtifact)<span class=\"pl-k\">.</span>collect(<span class=\"pl-smi\">Collectors</span><span class=\"pl-k\">.</span>toSet());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "chanseokoh", "createdAt": "2020-06-09T14:29:42Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "diffHunk": "@@ -252,11 +254,21 @@ public JibContainerBuilder createJibContainerBuilder(\n       JavaContainerBuilder javaContainerBuilder, ContainerizingMode containerizingMode)\n       throws IOException {\n     try {\n+\n+      Stream<Artifact> mavenProjectArtifactStream =\n+          session.getProjects().stream().map(MavenProject::getArtifact);", "originalCommit": "62dba12c4e9070129bc5ad572712891515e9a662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2ODM2Mg==", "url": "https://github.com/GoogleContainerTools/jib/pull/2502#discussion_r437468362", "body": "nit:\r\n```suggestion\r\n          classifyDependencies(project.getArtifacts(), artifactsFromAllProjects);\r\n```", "bodyText": "nit:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      classifyDependencies(\n          \n          \n            \n                      classifyDependencies(project.getArtifacts(), artifactsFromAllProjects);", "bodyHTML": "<p dir=\"auto\">nit:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          classifyDependencies(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">          classifyDependencies(<span class=\"x x-first\">project</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getArtifacts(), artifactsFromAllProjects);</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "chanseokoh", "createdAt": "2020-06-09T14:30:10Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "diffHunk": "@@ -282,12 +294,7 @@ public JibContainerBuilder createJibContainerBuilder(\n       // Classify and add dependencies\n       Map<LayerType, List<Path>> classifiedDependencies =\n           classifyDependencies(", "originalCommit": "62dba12c4e9070129bc5ad572712891515e9a662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2ODg4Ng==", "url": "https://github.com/GoogleContainerTools/jib/pull/2502#discussion_r437468886", "body": "nit:\r\n```suggestion\r\n            artifactsFromAllProjects\r\n                .stream()\r\n```", "bodyText": "nit:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        mavenProjectArtifactStream\n          \n          \n            \n                        artifactsFromAllProjects\n          \n          \n            \n                            .stream()", "bodyHTML": "<p dir=\"auto\">nit:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"x x-first x-last\">mavenProjectArtifactStream</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"x x-first x-last\">artifactsFromAllProjects</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                .stream()</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "chanseokoh", "createdAt": "2020-06-09T14:30:48Z", "path": "jib-maven-plugin/src/main/java/com/google/cloud/tools/jib/maven/MavenProjectProperties.java", "diffHunk": "@@ -252,11 +254,21 @@ public JibContainerBuilder createJibContainerBuilder(\n       JavaContainerBuilder javaContainerBuilder, ContainerizingMode containerizingMode)\n       throws IOException {\n     try {\n+\n+      Stream<Artifact> mavenProjectArtifactStream =\n+          session.getProjects().stream().map(MavenProject::getArtifact);\n+\n       if (isWarProject()) {\n         Path war = getWarArtifact();\n         Path explodedWarPath = tempDirectoryProvider.newDirectory();\n         ZipUtil.unzip(war, explodedWarPath);\n-        return JavaContainerBuilderHelper.fromExplodedWar(javaContainerBuilder, explodedWarPath);\n+        return JavaContainerBuilderHelper.fromExplodedWar(\n+            javaContainerBuilder,\n+            explodedWarPath,\n+            mavenProjectArtifactStream", "originalCommit": "62dba12c4e9070129bc5ad572712891515e9a662", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a07044e922b27140958e159fe6444f29098499e1", "url": "https://github.com/GoogleContainerTools/jib/commit/a07044e922b27140958e159fe6444f29098499e1", "message": "Fix NullPointerException", "committedDate": "2020-06-09T15:38:26Z", "type": "commit"}, {"oid": "73b97214903652a740233c27326903ec79d614df", "url": "https://github.com/GoogleContainerTools/jib/commit/73b97214903652a740233c27326903ec79d614df", "message": "Add CHANGELOG", "committedDate": "2020-06-09T16:16:47Z", "type": "commit"}]}