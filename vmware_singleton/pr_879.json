{"pr_number": 879, "pr_title": "fix bug #819: [BUG] [Service] [getPattern] Week info(\"firstDayOfWeek\" &\"weekendOfRange\") should also follow CLDR data", "pr_author": "huihuiw01", "pr_createdAt": "2020-11-18T16:49:28Z", "pr_url": "https://github.com/vmware/singleton/pull/879", "timeline": [{"oid": "1612bbaa0e9f048938a78225a7cfa571a608dd06", "url": "https://github.com/vmware/singleton/commit/1612bbaa0e9f048938a78225a7cfa571a608dd06", "message": "Correct firstDayOfWeek's value with cldr data", "committedDate": "2020-11-18T09:17:30Z", "type": "commit"}, {"oid": "5d65662a48430639184da78f7dddecc0c7b0e264", "url": "https://github.com/vmware/singleton/commit/5d65662a48430639184da78f7dddecc0c7b0e264", "message": "Correct weekendRange's value with cldr data", "committedDate": "2020-11-18T09:51:16Z", "type": "commit"}, {"oid": "a591a037126a6937fa31e431f92f7f6e69f31bdb", "url": "https://github.com/vmware/singleton/commit/a591a037126a6937fa31e431f92f7f6e69f31bdb", "message": "Convert day string to index number", "committedDate": "2020-11-18T10:47:42Z", "type": "commit"}, {"oid": "4b8868f82745fbc37df36b1d5b87b4f80516b3bf", "url": "https://github.com/vmware/singleton/commit/4b8868f82745fbc37df36b1d5b87b4f80516b3bf", "message": "add logic of supplementing default region for locales without region", "committedDate": "2020-11-18T16:36:33Z", "type": "commit"}, {"oid": "6ece854420fd1fc210a4b7779edf037f2e2a4b28", "url": "https://github.com/vmware/singleton/commit/6ece854420fd1fc210a4b7779edf037f2e2a4b28", "message": "fix CI failure problem: add header in new added file DayEnum", "committedDate": "2020-11-19T03:49:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzNTg2Nw==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r526635867", "body": "recommend the method name firstDayExtract to getFirstDayExtract", "bodyText": "recommend the method name firstDayExtract to getFirstDayExtract", "bodyHTML": "<p dir=\"auto\">recommend the method name firstDayExtract to getFirstDayExtract</p>", "author": "tigershi", "createdAt": "2020-11-19T07:05:51Z", "path": "g11n-ws/tools/tool-cldr-extractor/src/main/java/com/vmware/i18n/utils/CLDRUtils.java", "diffHunk": "@@ -563,6 +572,43 @@ public static String readZip(String fileName, String zipPath) {\n         return erasMap;\n     }\n \n+    /**\n+     * Get the first day of one Country, the implementation is according to https://www.unicode.org/reports/tr35/tr35-49/tr35-dates.html#Week_Data\n+     *\n+     * @param localeStr\n+     * @param firstDayData\n+     * @return\n+     */\n+    private static Integer firstDayExtract(String localeStr, Map<String, String> firstDayData){", "originalCommit": "6ece854420fd1fc210a4b7779edf037f2e2a4b28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4NjcyMg==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r526686722", "bodyText": "Just for keep code style consistent with previous code, but it really doesn't conform the naming convention, so rename it to 'extractFirstDay'.", "author": "huihuiw01", "createdAt": "2020-11-19T08:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzNTg2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzNjIwMQ==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r526636201", "body": "recommend the method name weekendRangeExtract to getWeekendRangeExtract ", "bodyText": "recommend the method name weekendRangeExtract to getWeekendRangeExtract", "bodyHTML": "<p dir=\"auto\">recommend the method name weekendRangeExtract to getWeekendRangeExtract</p>", "author": "tigershi", "createdAt": "2020-11-19T07:06:42Z", "path": "g11n-ws/tools/tool-cldr-extractor/src/main/java/com/vmware/i18n/utils/CLDRUtils.java", "diffHunk": "@@ -563,6 +572,43 @@ public static String readZip(String fileName, String zipPath) {\n         return erasMap;\n     }\n \n+    /**\n+     * Get the first day of one Country, the implementation is according to https://www.unicode.org/reports/tr35/tr35-49/tr35-dates.html#Week_Data\n+     *\n+     * @param localeStr\n+     * @param firstDayData\n+     * @return\n+     */\n+    private static Integer firstDayExtract(String localeStr, Map<String, String> firstDayData){\n+        String firstDay = firstDayData.get(Constants.TERRITORY_001);\n+        String territory = LocaleDataUtils.getInstance().getTerritory(localeStr);\n+        if(territory != null && firstDayData.get(territory) != null)\n+            firstDay = firstDayData.get(territory);\n+        return DayEnum.getIndexByDay(firstDay);\n+    }\n+\n+    /**\n+     * Get the weekend range of one Country, the implementation is according to https://www.unicode.org/reports/tr35/tr35-49/tr35-dates.html#Week_Data\n+     *\n+     * @param localeStr\n+     * @param supplementalWeekData\n+     * @return\n+     */\n+    private static List<Integer> weekendRangeExtract(String localeStr, Map<String, Object> supplementalWeekData){", "originalCommit": "6ece854420fd1fc210a4b7779edf037f2e2a4b28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4NjQyOQ==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r526686429", "bodyText": "Just for keep code style consistent with previous code, but it really doesn't conform the naming convention, so rename it to 'extractWeekendRange'.", "author": "huihuiw01", "createdAt": "2020-11-19T08:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYzNjIwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY0NzYyMg==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r526647622", "body": "I remember there is an existing method to get the default region of a locale. Could you check?", "bodyText": "I remember there is an existing method to get the default region of a locale. Could you check?", "bodyHTML": "<p dir=\"auto\">I remember there is an existing method to get the default region of a locale. Could you check?</p>", "author": "Xiaochao8", "createdAt": "2020-11-19T07:34:26Z", "path": "g11n-ws/tools/tool-cldr-extractor/src/main/java/com/vmware/i18n/utils/LocaleDataUtils.java", "diffHunk": "@@ -159,6 +159,38 @@ public String getDefaultRegionCode(String inputLocale, Map<String, String> regio\n \t\treturn defaultRegionMap;\n \t}\n \n+\t/**\n+\t * Get territory of a locale\n+\t *\n+\t * @param localeStr\n+\t * @return\n+\t */\n+\tpublic String getTerritory(String localeStr){\n+\t\tLocale locale = Locale.forLanguageTag(localeStr);\n+\t\tString territory = locale.getCountry();\n+\t\tif(territory == null || territory.isEmpty())//this is for supplement default region for locales like en, zh-Hans..\n+\t\t\tterritory = getLanguageDefaultRegionMappings().get(localeStr);", "originalCommit": "6ece854420fd1fc210a4b7779edf037f2e2a4b28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc3NjU0NQ==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r526776545", "bodyText": "Confirmed with @chaoq0318, there is no such method.", "author": "huihuiw01", "createdAt": "2020-11-19T11:06:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY0NzYyMg=="}], "type": "inlineReview"}, {"oid": "827921de00b07e1baf3fde0ca9e961a4f9a84231", "url": "https://github.com/vmware/singleton/commit/827921de00b07e1baf3fde0ca9e961a4f9a84231", "message": "rename some methods' names according to review comment", "committedDate": "2020-11-19T08:40:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ4NjcyNg==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r527486726", "body": "How about this?\r\n```suggestion\r\n\t\t\tterritory = JSONUtils.getMapFromJson(PatternUtil.getRegionFromLib(localeStr)).get(ConstantsKeys.DEFAULT_REGION_CODE);\r\n```", "bodyText": "How about this?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tterritory = getLanguageDefaultRegionMappings().get(localeStr);\n          \n          \n            \n            \t\t\tterritory = JSONUtils.getMapFromJson(PatternUtil.getRegionFromLib(localeStr)).get(ConstantsKeys.DEFAULT_REGION_CODE);", "bodyHTML": "<p dir=\"auto\">How about this?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\tterritory <span class=\"pl-k\">=</span> <span class=\"x x-first x-last\">getLanguageDefaultRegionMappings()</span><span class=\"pl-k\">.</span>get(<span class=\"x x-first x-last\">localeStr</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t\tterritory <span class=\"pl-k\">=</span> <span class=\"pl-smi x x-first\">JSONUtils</span><span class=\"pl-k x\">.</span><span class=\"x\">getMapFromJson(</span><span class=\"pl-smi x\">PatternUtil</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getRegionFromLib(localeStr))</span><span class=\"pl-k\">.</span>get(<span class=\"pl-smi x x-first\">ConstantsKeys</span><span class=\"pl-c1\"><span class=\"pl-k x\">.</span><span class=\"x x-last\">DEFAULT_REGION_CODE</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Xiaochao8", "createdAt": "2020-11-20T07:23:23Z", "path": "g11n-ws/tools/tool-cldr-extractor/src/main/java/com/vmware/i18n/utils/LocaleDataUtils.java", "diffHunk": "@@ -159,6 +159,38 @@ public String getDefaultRegionCode(String inputLocale, Map<String, String> regio\n \t\treturn defaultRegionMap;\n \t}\n \n+\t/**\n+\t * Get territory of a locale\n+\t *\n+\t * @param localeStr\n+\t * @return\n+\t */\n+\tpublic String getTerritory(String localeStr){\n+\t\tLocale locale = Locale.forLanguageTag(localeStr);\n+\t\tString territory = locale.getCountry();\n+\t\tif(territory == null || territory.isEmpty())//this is for supplement default region for locales like en, zh-Hans..\n+\t\t\tterritory = getLanguageDefaultRegionMappings().get(localeStr);", "originalCommit": "827921de00b07e1baf3fde0ca9e961a4f9a84231", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI1MjMyNg==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r529252326", "bodyText": "As I confirmed with @chaoq0318 and we synced yesterday, this method is not appropriate due to it use the extracted data and is used for calling by L2 API, so not appropriate to be used in the extracting process.\nI find another method which can be used here, and change code accordingly.", "author": "huihuiw01", "createdAt": "2020-11-24T07:24:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ4NjcyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MTczOQ==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r528471739", "body": "Why add weekend range. How does this relate to the first day of week?", "bodyText": "Why add weekend range. How does this relate to the first day of week?", "bodyHTML": "<p dir=\"auto\">Why add weekend range. How does this relate to the first day of week?</p>", "author": "Xiaochao8", "createdAt": "2020-11-23T04:55:06Z", "path": "g11n-ws/tools/tool-cldr-extractor/src/main/java/com/vmware/i18n/utils/CLDRUtils.java", "diffHunk": "@@ -184,8 +193,8 @@ public static String readZip(String fileName, String zipPath) {\n         dateMap.put(Constants.MONTH_FORMAT, monthsFormatMap);\n         dateMap.put(Constants.MONTHS_STANDALONE, monthsStandaloneMap);\n         dateMap.put(Constants.ERAS, erasMap);\n-        dateMap.put(Constants.FIRST_DAY_OF_WEEK, 0);\n-        dateMap.put(Constants.WEEKEND_RANGE, Arrays.asList(6, 0));\n+        dateMap.put(Constants.FIRST_DAY_OF_WEEK, firstDayOfWeek);\n+        dateMap.put(Constants.WEEKEND_RANGE, weekendRange);", "originalCommit": "827921de00b07e1baf3fde0ca9e961a4f9a84231", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI1NTQ2Nw==", "url": "https://github.com/vmware/singleton/pull/879#discussion_r529255467", "bodyText": "As weekend range has the same bug, and need similar code change, so I fix them together.\nI have asked @nannany00 include weekend range problem in the issue #819, and change PR title accordingly.", "author": "huihuiw01", "createdAt": "2020-11-24T07:30:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ3MTczOQ=="}], "type": "inlineReview"}, {"oid": "923d77c9cb6c107660e5c56098fabebad185158c", "url": "https://github.com/vmware/singleton/commit/923d77c9cb6c107660e5c56098fabebad185158c", "message": "fix review comment: use existed method to get region of a locale", "committedDate": "2020-11-24T04:48:56Z", "type": "commit"}, {"oid": "ba58739edd00730cbc13d9228afeeca1decd4f00", "url": "https://github.com/vmware/singleton/commit/ba58739edd00730cbc13d9228afeeca1decd4f00", "message": "Merge branch 'master' of github.com:vmware/singleton into master_#819", "committedDate": "2020-11-30T06:30:27Z", "type": "commit"}, {"oid": "ba58739edd00730cbc13d9228afeeca1decd4f00", "url": "https://github.com/vmware/singleton/commit/ba58739edd00730cbc13d9228afeeca1decd4f00", "message": "Merge branch 'master' of github.com:vmware/singleton into master_#819", "committedDate": "2020-11-30T06:30:27Z", "type": "forcePushed"}]}