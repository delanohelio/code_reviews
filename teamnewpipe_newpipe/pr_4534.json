{"pr_number": 4534, "pr_title": "Add a secondary control panel to video detail fragment", "pr_author": "Stypox", "pr_createdAt": "2020-10-16T18:19:49Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/4534", "timeline": [{"oid": "08f04f8288e31d9457ba7a6ce4833c67aef6fd2e", "url": "https://github.com/TeamNewPipe/NewPipe/commit/08f04f8288e31d9457ba7a6ce4833c67aef6fd2e", "message": "Move description to a tab alongside related streams and comments", "committedDate": "2020-11-01T12:55:20Z", "type": "forcePushed"}, {"oid": "4046b35ce302764269b673df483e3c9fb381593a", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4046b35ce302764269b673df483e3c9fb381593a", "message": "Move description to a tab alongside related streams and comments", "committedDate": "2020-11-27T18:41:53Z", "type": "forcePushed"}, {"oid": "39ef1daf3496758404020ca89b94116e0a8fed87", "url": "https://github.com/TeamNewPipe/NewPipe/commit/39ef1daf3496758404020ca89b94116e0a8fed87", "message": "Move description to a tab alongside related streams and comments", "committedDate": "2020-11-30T08:05:53Z", "type": "forcePushed"}, {"oid": "6342038494b01f0577cbdae5e94881a42c0c372e", "url": "https://github.com/TeamNewPipe/NewPipe/commit/6342038494b01f0577cbdae5e94881a42c0c372e", "message": "Add icons to VideoDetailFragment tab layout for better accessibility", "committedDate": "2020-12-08T20:52:18Z", "type": "forcePushed"}, {"oid": "c377a03372af1f9ba08f7cc936afe236df055cc5", "url": "https://github.com/TeamNewPipe/NewPipe/commit/c377a03372af1f9ba08f7cc936afe236df055cc5", "message": "Always show tab layout at the bottom of the screen", "committedDate": "2020-12-29T15:02:10Z", "type": "forcePushed"}, {"oid": "c0ab13d813e89359074c53a57ef41bfbe79ebee3", "url": "https://github.com/TeamNewPipe/NewPipe/commit/c0ab13d813e89359074c53a57ef41bfbe79ebee3", "message": "Add preference to hide description tab in video details", "committedDate": "2020-12-29T21:52:56Z", "type": "forcePushed"}, {"oid": "cebf81f79e0fe82551efb208221d770ff0995273", "url": "https://github.com/TeamNewPipe/NewPipe/commit/cebf81f79e0fe82551efb208221d770ff0995273", "message": "Hide tab layout in detail fragment when there is no space+", "committedDate": "2021-01-14T12:18:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY3ODk0OQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4534#discussion_r557678949", "body": "You can use `shouldShowPlayWithKodi()` now:\r\nhttps://github.com/TeamNewPipe/NewPipe/blob/8fd48a88be33dc09a7215ef31044922ea7c7e376/app/src/main/java/org/schabi/newpipe/util/KoreUtil.java#L19", "bodyText": "You can use shouldShowPlayWithKodi() now:\n\n  \n    \n      NewPipe/app/src/main/java/org/schabi/newpipe/util/KoreUtil.java\n    \n    \n         Line 19\n      in\n      8fd48a8\n    \n    \n    \n    \n\n        \n          \n           public static boolean shouldShowPlayWithKodi(final Context context, final int serviceId) {", "bodyHTML": "<p dir=\"auto\">You can use <code>shouldShowPlayWithKodi()</code> now:<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/TeamNewPipe/NewPipe/blob/8fd48a88be33dc09a7215ef31044922ea7c7e376/app/src/main/java/org/schabi/newpipe/util/KoreUtil.java#L19\">NewPipe/app/src/main/java/org/schabi/newpipe/util/KoreUtil.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 19\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/TeamNewPipe/NewPipe/commit/8fd48a88be33dc09a7215ef31044922ea7c7e376\">8fd48a8</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L19\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"19\"></td>\n          <td id=\"LC19\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">boolean</span> <span class=\"pl-en\">shouldShowPlayWithKodi</span>(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">Context</span> <span class=\"pl-v\">context</span>, <span class=\"pl-k\">final</span> <span class=\"pl-k\">int</span> <span class=\"pl-v\">serviceId</span>) { </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "author": "TobiGr", "createdAt": "2021-01-14T20:28:30Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/detail/VideoDetailFragment.java", "diffHunk": "@@ -779,6 +811,14 @@ public void onLoadingFailed(final String imageUri, final View view,\n         }\n     }\n \n+    private void showHideKodiButton() {\n+        // show kodi button if it supports the current service and it is enabled in settings\n+        final boolean showKodiButton = KoreUtil.isServiceSupportedByKore(serviceId)\n+                && PreferenceManager.getDefaultSharedPreferences(requireContext())\n+                .getBoolean(getString(R.string.show_play_with_kodi_key), false);", "originalCommit": "cebf81f79e0fe82551efb208221d770ff0995273", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzY4MDE0OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4534#discussion_r557680148", "body": "```suggestion\r\n            if (relatedStreamsLayout == null) { // phone\r\n                pageAdapter.updateItem(RELATED_TAB_TAG,\r\n                        RelatedVideosFragment.getInstance(info));\r\n            } else { // tablet + TV\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (relatedStreamsLayout == null) { //phone\n          \n          \n            \n                            pageAdapter.updateItem(RELATED_TAB_TAG,\n          \n          \n            \n                                    RelatedVideosFragment.getInstance(info));\n          \n          \n            \n                        } else { //tablet\n          \n          \n            \n                        if (relatedStreamsLayout == null) { // phone\n          \n          \n            \n                            pageAdapter.updateItem(RELATED_TAB_TAG,\n          \n          \n            \n                                    RelatedVideosFragment.getInstance(info));\n          \n          \n            \n                        } else { // tablet + TV", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">if</span> (relatedStreamsLayout <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>) { <span class=\"pl-c\"><span class=\"pl-c\">//</span>phone</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                pageAdapter<span class=\"pl-k\">.</span>updateItem(<span class=\"pl-c1\">RELATED_TAB_TAG</span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                        <span class=\"pl-smi\">RelatedVideosFragment</span><span class=\"pl-k\">.</span>getInstance(info));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            } <span class=\"pl-k\">else</span> { <span class=\"pl-c\"><span class=\"pl-c\">//</span>tablet</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">if</span> (relatedStreamsLayout <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>) { <span class=\"pl-c\"><span class=\"pl-c\">//</span><span class=\"x x-first x-last\"> </span>phone</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                pageAdapter<span class=\"pl-k\">.</span>updateItem(<span class=\"pl-c1\">RELATED_TAB_TAG</span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                        <span class=\"pl-smi\">RelatedVideosFragment</span><span class=\"pl-k\">.</span>getInstance(info));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            } <span class=\"pl-k\">else</span> { <span class=\"pl-c\"><span class=\"pl-c\">//</span><span class=\"x x-first x-last\"> </span>tablet<span class=\"x x-first x-last\"> + TV</span></span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "TobiGr", "createdAt": "2021-01-14T20:30:41Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/detail/VideoDetailFragment.java", "diffHunk": "@@ -980,37 +1020,88 @@ private void runWorker(final boolean forceLoad, final boolean addToBackStack) {\n                 });\n     }\n \n+    /*//////////////////////////////////////////////////////////////////////////\n+    // Tabs\n+    //////////////////////////////////////////////////////////////////////////*/\n+\n     private void initTabs() {\n         if (pageAdapter.getCount() != 0) {\n             selectedTabTag = pageAdapter.getItemTitle(viewPager.getCurrentItem());\n         }\n         pageAdapter.clearAllItems();\n+        tabIcons.clear();\n+        tabContentDescriptions.clear();\n \n         if (shouldShowComments()) {\n             pageAdapter.addFragment(\n                     CommentsFragment.getInstance(serviceId, url, title), COMMENTS_TAB_TAG);\n+            tabIcons.add(R.drawable.ic_comment_white_24dp);\n+            tabContentDescriptions.add(R.string.comments_tab_description);\n         }\n \n-        if (showRelatedStreams && null == relatedStreamsLayout) {\n-            //temp empty fragment. will be updated in handleResult\n+        if (showRelatedStreams && relatedStreamsLayout == null) {\n+            // temp empty fragment. will be updated in handleResult\n             pageAdapter.addFragment(new Fragment(), RELATED_TAB_TAG);\n+            tabIcons.add(R.drawable.ic_art_track_white_24dp);\n+            tabContentDescriptions.add(R.string.related_streams_tab_description);\n         }\n \n-        if (pageAdapter.getCount() == 0) {\n-            pageAdapter.addFragment(new EmptyFragment(), EMPTY_TAB_TAG);\n+        if (showDescription) {\n+            // temp empty fragment. will be updated in handleResult\n+            pageAdapter.addFragment(new Fragment(), DESCRIPTION_TAB_TAG);\n+            tabIcons.add(R.drawable.ic_description_white_24dp);\n+            tabContentDescriptions.add(R.string.description_tab_description);\n         }\n-\n         pageAdapter.notifyDataSetUpdate();\n \n-        if (pageAdapter.getCount() < 2) {\n-            tabLayout.setVisibility(View.GONE);\n-        } else {\n+        if (pageAdapter.getCount() >= 2) {\n             final int position = pageAdapter.getItemPositionByTitle(selectedTabTag);\n             if (position != -1) {\n                 viewPager.setCurrentItem(position);\n             }\n-            tabLayout.setVisibility(View.VISIBLE);\n+            updateTabIconsAndContentDescriptions();\n+        }\n+        updateTabLayoutVisibility();\n+    }\n+\n+    /**\n+     * To be called whenever {@link #pageAdapter} is modified, since that triggers a refresh in\n+     * {@link #tabLayout} resetting all tab's icons and content descriptions. This reads icons from\n+     * {@link #tabIcons} and content descriptions from {@link #tabContentDescriptions}, which are\n+     * all set in {@link #initTabs()}\n+     */\n+    private void updateTabIconsAndContentDescriptions() {\n+        for (int i = 0; i < tabIcons.size(); ++i) {\n+            final TabLayout.Tab tab = tabLayout.getTabAt(i);\n+            if (tab != null) {\n+                tab.setIcon(tabIcons.get(i));\n+                tab.setContentDescription(tabContentDescriptions.get(i));\n+            }\n+        }\n+    }\n+\n+    private void updateTabs(@NonNull final StreamInfo info) {\n+        if (showRelatedStreams) {\n+            if (relatedStreamsLayout == null) { //phone\n+                pageAdapter.updateItem(RELATED_TAB_TAG,\n+                        RelatedVideosFragment.getInstance(info));\n+            } else { //tablet", "originalCommit": "cebf81f79e0fe82551efb208221d770ff0995273", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6409890557c702027cfc5b24de425c809e3ba50a", "url": "https://github.com/TeamNewPipe/NewPipe/commit/6409890557c702027cfc5b24de425c809e3ba50a", "message": "Use KoreUtil function", "committedDate": "2021-01-14T21:35:31Z", "type": "forcePushed"}, {"oid": "dcd01bedf461bb8ff5ed43441eb5c859ffaf0b8d", "url": "https://github.com/TeamNewPipe/NewPipe/commit/dcd01bedf461bb8ff5ed43441eb5c859ffaf0b8d", "message": "Use KoreUtil function", "committedDate": "2021-01-14T21:38:03Z", "type": "forcePushed"}, {"oid": "8d199b6d956c16979b2011326196381ce05ccde0", "url": "https://github.com/TeamNewPipe/NewPipe/commit/8d199b6d956c16979b2011326196381ce05ccde0", "message": "Use KoreUtil function", "committedDate": "2021-01-16T11:02:10Z", "type": "forcePushed"}, {"oid": "4b8f9a582a316498b41c06bfcfbdf6a663c12966", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4b8f9a582a316498b41c06bfcfbdf6a663c12966", "message": "Use KoreUtil function", "committedDate": "2021-01-16T15:01:59Z", "type": "forcePushed"}, {"oid": "b04ed347351e10c03c06747187f88b3e982a3548", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b04ed347351e10c03c06747187f88b3e982a3548", "message": "Use KoreUtil function", "committedDate": "2021-01-16T17:23:49Z", "type": "forcePushed"}, {"oid": "e43c967c0dac0156e3349450803fa220928f26b2", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e43c967c0dac0156e3349450803fa220928f26b2", "message": "Use KoreUtil function", "committedDate": "2021-01-16T17:41:33Z", "type": "forcePushed"}, {"oid": "78a9811fe386c05bff52357d3a6dbc2c54cd1767", "url": "https://github.com/TeamNewPipe/NewPipe/commit/78a9811fe386c05bff52357d3a6dbc2c54cd1767", "message": "Add a secondary control panel to video detail fragment\n\nIt is shown when the user expands the description\nIt contains share, open in browser and play in kodi", "committedDate": "2021-01-17T14:12:29Z", "type": "commit"}, {"oid": "a314f55a1718f0ada954412e2882b44a41026af8", "url": "https://github.com/TeamNewPipe/NewPipe/commit/a314f55a1718f0ada954412e2882b44a41026af8", "message": "Move description to a tab alongside related streams and comments", "committedDate": "2021-01-17T14:26:25Z", "type": "commit"}, {"oid": "4c3ba0fe3d2887a545238d958a5c425e74e219a4", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4c3ba0fe3d2887a545238d958a5c425e74e219a4", "message": "Add icons to VideoDetailFragment tab layout for better accessibility", "committedDate": "2021-01-17T14:34:24Z", "type": "commit"}, {"oid": "d043a4f410c2397a25e6bd26cccd7ddbc067fd47", "url": "https://github.com/TeamNewPipe/NewPipe/commit/d043a4f410c2397a25e6bd26cccd7ddbc067fd47", "message": "Always show tab layout at the bottom of the screen", "committedDate": "2021-01-17T14:36:42Z", "type": "commit"}, {"oid": "750c4ffbd3ccfa9e6cf17ad6fb2f3a0e58e4a2bb", "url": "https://github.com/TeamNewPipe/NewPipe/commit/750c4ffbd3ccfa9e6cf17ad6fb2f3a0e58e4a2bb", "message": "Add preference to hide description tab in video details", "committedDate": "2021-01-17T14:36:42Z", "type": "commit"}, {"oid": "e840d42fb9395abc8b5655c593d4d6b0317a3436", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e840d42fb9395abc8b5655c593d4d6b0317a3436", "message": "Add content description to detail fragment tabs", "committedDate": "2021-01-17T14:38:12Z", "type": "commit"}, {"oid": "71d92c8d1b1a440b7c0b5dce5f198480fe5af15d", "url": "https://github.com/TeamNewPipe/NewPipe/commit/71d92c8d1b1a440b7c0b5dce5f198480fe5af15d", "message": "Hide tab layout in detail fragment when there is no space", "committedDate": "2021-01-17T14:42:54Z", "type": "commit"}, {"oid": "243f539439d21320d9d96ed6ecbfc1eab20342c0", "url": "https://github.com/TeamNewPipe/NewPipe/commit/243f539439d21320d9d96ed6ecbfc1eab20342c0", "message": "Use KoreUtil function", "committedDate": "2021-01-17T14:46:00Z", "type": "commit"}, {"oid": "3868243c2a79ef88820701b2568c78ac17cf3828", "url": "https://github.com/TeamNewPipe/NewPipe/commit/3868243c2a79ef88820701b2568c78ac17cf3828", "message": "Animate secondary controls toggle", "committedDate": "2021-01-17T14:59:29Z", "type": "commit"}, {"oid": "3868243c2a79ef88820701b2568c78ac17cf3828", "url": "https://github.com/TeamNewPipe/NewPipe/commit/3868243c2a79ef88820701b2568c78ac17cf3828", "message": "Animate secondary controls toggle", "committedDate": "2021-01-17T14:59:29Z", "type": "forcePushed"}]}