{"pr_number": 3160, "pr_title": "Hide 5, 15, 25 second seek options if inexact seek is enabled", "pr_author": "XiangRongLin", "pr_createdAt": "2020-02-29T12:02:01Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3160", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjY2MA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#discussion_r386626660", "body": "Add a newline here:\r\n```suggestion\r\n\r\n        final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));\r\n```", "bodyText": "Add a newline here:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));\n          \n          \n            \n            \n          \n          \n            \n                    final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));", "bodyHTML": "<p dir=\"auto\">Add a newline here:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"87\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"x x-first\">        </span><span class=\"pl-k x\">final</span><span class=\"x\"> </span><span class=\"pl-smi x\">ListPreference</span><span class=\"x\"> durations </span><span class=\"pl-k x\">=</span><span class=\"x\"> (</span><span class=\"pl-smi x\">ListPreference</span><span class=\"x\">) findPreference(getString(</span><span class=\"pl-smi x\">R</span><span class=\"pl-k x\">.</span><span class=\"x\">string</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">seek_duration_key));</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"87\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"88\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">ListPreference</span> durations <span class=\"pl-k\">=</span> (<span class=\"pl-smi\">ListPreference</span>) findPreference(getString(<span class=\"pl-smi\">R</span><span class=\"pl-k\">.</span>string<span class=\"pl-k\">.</span>seek_duration_key));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Stypox", "createdAt": "2020-03-02T20:17:59Z", "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -58,10 +46,59 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n                             .show();\n \n                 }\n+            } else if (s.equals(getString(R.string.use_inexact_seek_key))) {\n+                updateSeekOptions();\n             }\n         };\n     }\n \n+    /**\n+     * Update fast-forward/-rewind seek duration options according to language and inexact seek setting.\n+     * Exoplayer can't seek 5 seconds in audio when using inexact seek.\n+     */\n+    private void updateSeekOptions() {\n+        //initializing R.array.seek_duration_description to display the translation of seconds\n+        final Resources res = getResources();\n+        final String[] durationsValues = res.getStringArray(R.array.seek_duration_value);\n+        final List<String> displayedDurationValues = new LinkedList<>();\n+        final List<String> displayedDescriptionValues = new LinkedList<>();\n+        int currentDurationValue;\n+        final boolean inexactSeek = getPreferenceManager().getSharedPreferences()\n+            .getBoolean(res.getString(R.string.use_inexact_seek_key), false);\n+\n+        for (String durationsValue : durationsValues) {\n+            currentDurationValue =\n+                Integer.parseInt(durationsValue) / (int) DateUtils.SECOND_IN_MILLIS;\n+            if (inexactSeek && currentDurationValue % 10 == 5) {\n+                continue;\n+            }\n+            try {\n+                displayedDurationValues.add(durationsValue);\n+                displayedDescriptionValues.add(String.format(\n+                    res.getQuantityString(R.plurals.dynamic_seek_duration_description,\n+                        currentDurationValue),\n+                    currentDurationValue));\n+            } catch (Resources.NotFoundException ignored) {\n+                //if this happens, the translation is missing, and the english string will be displayed instead\n+            }\n+        }\n+        final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));", "originalCommit": "8a077c46958e3f550309b45bd0a257e763586071", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "57504acd0017b2825ecbb68a4ff7bec9c7f64fdc", "url": "https://github.com/TeamNewPipe/NewPipe/commit/57504acd0017b2825ecbb68a4ff7bec9c7f64fdc", "message": "If inexact seekt is used, hide 5,15,25 seconds seek duration options when opening settings", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "446380433804c1c38213c37562d8d34151caca3b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/446380433804c1c38213c37562d8d34151caca3b", "message": "Update seek options on inexact seek option change.\nReset to 10 seconds when previous value is not valid anymore", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "288a61895cde2c271ae80c7b927a0200ca1480c9", "url": "https://github.com/TeamNewPipe/NewPipe/commit/288a61895cde2c271ae80c7b927a0200ca1480c9", "message": "Update inexact seek summary", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "6a42714326dbd42dabdf4b072cf25396fa4da529", "url": "https://github.com/TeamNewPipe/NewPipe/commit/6a42714326dbd42dabdf4b072cf25396fa4da529", "message": "Round seek duration up instead of setting it to 10 seconds", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "7d3b21582cc94b3954d88d57ec3c186712396a78", "url": "https://github.com/TeamNewPipe/NewPipe/commit/7d3b21582cc94b3954d88d57ec3c186712396a78", "message": "Use DateUtils constant for 1000", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "message": "Show a toast when seek duration was rounded up", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "message": "Show a toast when seek duration was rounded up", "committedDate": "2020-03-03T18:40:10Z", "type": "forcePushed"}, {"oid": "efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7", "url": "https://github.com/TeamNewPipe/NewPipe/commit/efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7", "message": "Change toast string resource to be useable with different languages", "committedDate": "2020-03-03T18:50:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1MzY3OQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#discussion_r387253679", "body": "Even though this is not relative to this PR, I think this line should be before the try-catch, since it can't throw an exception, and for a moment it led me to thinking that for missing translations the value would not be added.\r\nAlso note the added newline.\r\n```suggestion\r\n\r\n            displayedDurationValues.add(durationsValue);\r\n            try {\r\n```", "bodyText": "Even though this is not relative to this PR, I think this line should be before the try-catch, since it can't throw an exception, and for a moment it led me to thinking that for missing translations the value would not be added.\nAlso note the added newline.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        try {\n          \n          \n            \n                            displayedDurationValues.add(durationsValue);\n          \n          \n            \n            \n          \n          \n            \n                        displayedDurationValues.add(durationsValue);\n          \n          \n            \n                        try {", "bodyHTML": "<p dir=\"auto\">Even though this is not relative to this PR, I think this line should be before the try-catch, since it can't throw an exception, and for a moment it led me to thinking that for missing translations the value would not be added.<br>\nAlso note the added newline.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">try</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                displayedDurationValues<span class=\"pl-k\">.</span>add(durationsValue);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            displayedDurationValues<span class=\"pl-k\">.</span>add(durationsValue);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">try</span> {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Stypox", "createdAt": "2020-03-03T19:47:46Z", "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -58,10 +46,58 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n                             .show();\n \n                 }\n+            } else if (s.equals(getString(R.string.use_inexact_seek_key))) {\n+                updateSeekOptions();\n             }\n         };\n     }\n \n+    /**\n+     * Update fast-forward/-rewind seek duration options according to language and inexact seek setting.\n+     * Exoplayer can't seek 5 seconds in audio when using inexact seek.\n+     */\n+    private void updateSeekOptions() {\n+        //initializing R.array.seek_duration_description to display the translation of seconds\n+        final Resources res = getResources();\n+        final String[] durationsValues = res.getStringArray(R.array.seek_duration_value);\n+        final List<String> displayedDurationValues = new LinkedList<>();\n+        final List<String> displayedDescriptionValues = new LinkedList<>();\n+        int currentDurationValue;\n+        final boolean inexactSeek = getPreferenceManager().getSharedPreferences()\n+            .getBoolean(res.getString(R.string.use_inexact_seek_key), false);\n+\n+        for (String durationsValue : durationsValues) {\n+            currentDurationValue =\n+                Integer.parseInt(durationsValue) / (int) DateUtils.SECOND_IN_MILLIS;\n+            if (inexactSeek && currentDurationValue % 10 == 5) {\n+                continue;\n+            }\n+            try {\n+                displayedDurationValues.add(durationsValue);", "originalCommit": "efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f7ef7a18ac764f53c7b2a748af43a34a252abe90", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f7ef7a18ac764f53c7b2a748af43a34a252abe90", "message": "Update app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n\nCo-Authored-By: Stypox <stypox@pm.me>", "committedDate": "2020-03-03T20:41:15Z", "type": "commit"}, {"oid": "4bb6a146e8212af975d9c1acd1bbd3cf51fa6af6", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4bb6a146e8212af975d9c1acd1bbd3cf51fa6af6", "message": "Update app/src/main/res/values/strings.xml", "committedDate": "2020-03-03T20:51:46Z", "type": "commit"}]}