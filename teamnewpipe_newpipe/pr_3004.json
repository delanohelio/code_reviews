{"pr_number": 3004, "pr_title": "ask for display over other apps permission in settings", "pr_author": "harshlele", "pr_createdAt": "2020-01-25T17:06:34Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3004", "timeline": [{"oid": "e1145f16f2b49b07d6a74d3ebe1fe6e22095ec3b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e1145f16f2b49b07d6a74d3ebe1fe6e22095ec3b", "message": "ask for display over other apps permission in settings", "committedDate": "2020-01-25T17:00:49Z", "type": "commit"}, {"oid": "52420d4bf109bc36d4b299283f317aa43e86ff06", "url": "https://github.com/TeamNewPipe/NewPipe/commit/52420d4bf109bc36d4b299283f317aa43e86ff06", "message": "Merge branch 'dev' into ask-overlay-perm-settings", "committedDate": "2020-01-26T04:27:30Z", "type": "commit"}, {"oid": "1f24c186146c17f6fe5e140539cc7e56b2266062", "url": "https://github.com/TeamNewPipe/NewPipe/commit/1f24c186146c17f6fe5e140539cc7e56b2266062", "message": "reformatted and commented code", "committedDate": "2020-01-28T14:44:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1MzQ4NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3004#discussion_r371853485", "body": "Suggestion:\r\n```java\r\npublic void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\r\n    // on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\r\n    // display over other apps permission, so show a snackbar to let the user give permission\r\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M &&\r\n            s.equals(getString(R.string.minimize_on_exit_key))) {\r\n\r\n        String newSetting = sharedPreferences.getString(s,null);\r\n        if(newSetting != null &&\r\n                newSetting.equals(getString(R.string.minimize_on_exit_popup_key)) &&\r\n                !Settings.canDrawOverlays(getContext())) {\r\n\r\n            Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\r\n                           .setAction(R.string.settings, new View.OnClickListener() {\r\n                               @Override\r\n                               public void onClick(View view) {\r\n                                   PermissionHelper.checkSystemAlertWindowPermission(getContext());\r\n                               }\r\n                           })\r\n                           .show();\r\n        }\r\n    }\r\n}", "bodyText": "Suggestion:\npublic void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n    // on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n    // display over other apps permission, so show a snackbar to let the user give permission\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M &&\n            s.equals(getString(R.string.minimize_on_exit_key))) {\n\n        String newSetting = sharedPreferences.getString(s,null);\n        if(newSetting != null &&\n                newSetting.equals(getString(R.string.minimize_on_exit_popup_key)) &&\n                !Settings.canDrawOverlays(getContext())) {\n\n            Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n                           .setAction(R.string.settings, new View.OnClickListener() {\n                               @Override\n                               public void onClick(View view) {\n                                   PermissionHelper.checkSystemAlertWindowPermission(getContext());\n                               }\n                           })\n                           .show();\n        }\n    }\n}", "bodyHTML": "<p dir=\"auto\">Suggestion:</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n    // on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n    // display over other apps permission, so show a snackbar to let the user give permission\n    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M &amp;&amp;\n            s.equals(getString(R.string.minimize_on_exit_key))) {\n\n        String newSetting = sharedPreferences.getString(s,null);\n        if(newSetting != null &amp;&amp;\n                newSetting.equals(getString(R.string.minimize_on_exit_popup_key)) &amp;&amp;\n                !Settings.canDrawOverlays(getContext())) {\n\n            Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n                           .setAction(R.string.settings, new View.OnClickListener() {\n                               @Override\n                               public void onClick(View view) {\n                                   PermissionHelper.checkSystemAlertWindowPermission(getContext());\n                               }\n                           })\n                           .show();\n        }\n    }\n}\"><pre><span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> onSharedPreferenceChanged(<span class=\"pl-smi\">SharedPreferences</span> sharedPreferences, <span class=\"pl-smi\">String</span> s) {\n    <span class=\"pl-c\"><span class=\"pl-c\">//</span> on M and above, if user chooses to minimise to popup player on exit and the app doesn't have</span>\n    <span class=\"pl-c\"><span class=\"pl-c\">//</span> display over other apps permission, so show a snackbar to let the user give permission</span>\n    <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">Build</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>VERSION<span class=\"pl-k\">.</span>SDK_INT</span> <span class=\"pl-k\">&gt;=</span> <span class=\"pl-smi\">Build</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>VERSION_CODES</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">M</span> <span class=\"pl-k\">&amp;&amp;</span>\n            s<span class=\"pl-k\">.</span>equals(getString(<span class=\"pl-smi\">R</span><span class=\"pl-k\">.</span>string<span class=\"pl-k\">.</span>minimize_on_exit_key))) {\n\n        <span class=\"pl-smi\">String</span> newSetting <span class=\"pl-k\">=</span> sharedPreferences<span class=\"pl-k\">.</span>getString(s,<span class=\"pl-c1\">null</span>);\n        <span class=\"pl-k\">if</span>(newSetting <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">null</span> <span class=\"pl-k\">&amp;&amp;</span>\n                newSetting<span class=\"pl-k\">.</span>equals(getString(<span class=\"pl-smi\">R</span><span class=\"pl-k\">.</span>string<span class=\"pl-k\">.</span>minimize_on_exit_popup_key)) <span class=\"pl-k\">&amp;&amp;</span>\n                <span class=\"pl-k\">!</span><span class=\"pl-smi\">Settings</span><span class=\"pl-k\">.</span>canDrawOverlays(getContext())) {\n\n            <span class=\"pl-smi\">Snackbar</span><span class=\"pl-k\">.</span>make(getListView(),<span class=\"pl-smi\">R</span><span class=\"pl-k\">.</span>string<span class=\"pl-k\">.</span>permission_display_over_apps,<span class=\"pl-smi\">Snackbar</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>LENGTH_INDEFINITE</span>)\n                           .setAction(<span class=\"pl-smi\">R</span><span class=\"pl-k\">.</span>string<span class=\"pl-k\">.</span>settings, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">View</span>.<span class=\"pl-smi\">OnClickListener</span>() {\n                               <span class=\"pl-k\">@Override</span>\n                               <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"pl-en\">onClick</span>(<span class=\"pl-smi\">View</span> <span class=\"pl-v\">view</span>) {\n                                   <span class=\"pl-smi\">PermissionHelper</span><span class=\"pl-k\">.</span>checkSystemAlertWindowPermission(getContext());\n                               }\n                           })\n                           .show();\n        }\n    }\n}</pre></div>", "author": "Stypox", "createdAt": "2020-01-28T14:58:18Z", "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -1,12 +1,75 @@\n package org.schabi.newpipe.settings;\n \n+import android.content.SharedPreferences;\n+import android.os.Build;\n import android.os.Bundle;\n+import android.provider.Settings;\n+import android.view.View;\n+\n+import androidx.annotation.Nullable;\n+\n+import com.google.android.material.snackbar.Snackbar;\n \n import org.schabi.newpipe.R;\n+import org.schabi.newpipe.util.PermissionHelper;\n \n public class VideoAudioSettingsFragment extends BasePreferenceFragment {\n+\n+    private SharedPreferences.OnSharedPreferenceChangeListener listener;\n+\n+    @Override\n+    public void onCreate(@Nullable Bundle savedInstanceState) {\n+        super.onCreate(savedInstanceState);\n+\n+        listener = new SharedPreferences.OnSharedPreferenceChangeListener() {\n+            @Override\n+            public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n+\n+                //on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n+                //display over other apps permission, show a snackbar to let the user give permission\n+                if(s.equals(getString(R.string.minimize_on_exit_key))){\n+\n+                    String newSetting = sharedPreferences.getString(s,null);\n+                    if(newSetting != null){\n+\n+                        if(newSetting.equals(getString(R.string.minimize_on_exit_popup_key))){\n+\n+                            if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.M && !Settings.canDrawOverlays(getContext())){\n+\n+                                Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n+                                        .setAction(R.string.settings, new View.OnClickListener() {\n+                                            @Override\n+                                            public void onClick(View view) {\n+                                                PermissionHelper.checkSystemAlertWindowPermission(getContext());\n+                                            }\n+                                        })\n+                                        .show();\n+\n+                            }\n+                        }\n+                    }\n+                }\n+            }", "originalCommit": "1f24c186146c17f6fe5e140539cc7e56b2266062", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a78762756a68b8db5fd711f461e53b8aed0a3c48", "url": "https://github.com/TeamNewPipe/NewPipe/commit/a78762756a68b8db5fd711f461e53b8aed0a3c48", "message": "reformatted code", "committedDate": "2020-01-28T15:24:24Z", "type": "commit"}, {"oid": "f7203d4ac9666c1eee10374210c2f92ec50a2eba", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f7203d4ac9666c1eee10374210c2f92ec50a2eba", "message": "Fix formatting and use lamda functions", "committedDate": "2020-02-01T12:41:03Z", "type": "commit"}]}