{"pr_number": 1513, "pr_title": "Add explicit names to metrics/trace SPI factories", "pr_author": "pavolloffay", "pr_createdAt": "2020-10-28T18:57:37Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1513", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcwNjEyNg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1513#discussion_r513706126", "body": "i think it's a little confusing why we support multiple names without a bit of explanation:\r\n\r\n```suggestion\r\n   * Returns names of metric servers supported by this factory.\r\n   *\r\n   * <p>Multiple names are useful for enabling a pair of span and metric exporters using the same\r\n   * name, while still having separate names for enabling them individually.\r\n```", "bodyText": "i think it's a little confusing why we support multiple names without a bit of explanation:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Returns names of metric servers supported by this factory.\n          \n          \n            \n               * Returns names of metric servers supported by this factory.\n          \n          \n            \n               *\n          \n          \n            \n               * <p>Multiple names are useful for enabling a pair of span and metric exporters using the same\n          \n          \n            \n               * name, while still having separate names for enabling them individually.", "bodyHTML": "<p dir=\"auto\">i think it's a little confusing why we support multiple names without a bit of explanation:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"32\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Returns</span> names of metric servers supported by <span class=\"pl-c1\">this</span> factory.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"32\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Returns</span> names of metric servers supported by <span class=\"pl-c1\">this</span> factory.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"33\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"34\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-k\">&lt;</span>p<span class=\"pl-k\">&gt;</span><span class=\"pl-smi\">Multiple</span> names are useful <span class=\"pl-k\">for</span> enabling a pair of span and metric exporters using the same</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"35\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> name, <span class=\"pl-k\">while</span> still having separate names <span class=\"pl-k\">for</span> enabling them individually.</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "trask", "createdAt": "2020-10-28T19:28:01Z", "path": "javaagent-spi/src/main/java/io/opentelemetry/javaagent/spi/exporter/MetricServer.java", "diffHunk": "@@ -23,4 +24,11 @@\n    * @param config The configuration\n    */\n   void start(MetricProducer producer, Properties config);\n+\n+  /**\n+   * Returns names of metric servers supported by this factory.", "originalCommit": "338c562acd57c7535a7c65fe370e974be6463ea8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzcwNjkyMw==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1513#discussion_r513706923", "body": "same as above\r\n\r\n```suggestion\r\n   * Returns names of span exporters supported by this factory.\r\n   *\r\n   * <p>Multiple names are useful for enabling a pair of span and metric exporters using the same\r\n   * name, while still having separate names for enabling them individually.\r\n```\r\n", "bodyText": "same as above\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Returns names of span exporters supported by this factory.\n          \n          \n            \n               * Returns names of span exporters supported by this factory.\n          \n          \n            \n               *\n          \n          \n            \n               * <p>Multiple names are useful for enabling a pair of span and metric exporters using the same\n          \n          \n            \n               * name, while still having separate names for enabling them individually.", "bodyHTML": "<p dir=\"auto\">same as above</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"27\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Returns</span> names of span exporters supported by <span class=\"pl-c1\">this</span> factory.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"27\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Returns</span> names of span exporters supported by <span class=\"pl-c1\">this</span> factory.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"28\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"29\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-k\">&lt;</span>p<span class=\"pl-k\">&gt;</span><span class=\"pl-smi\">Multiple</span> names are useful <span class=\"pl-k\">for</span> enabling a pair of span and metric exporters using the same</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"30\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> name, <span class=\"pl-k\">while</span> still having separate names <span class=\"pl-k\">for</span> enabling them individually.</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "trask", "createdAt": "2020-10-28T19:29:26Z", "path": "javaagent-spi/src/main/java/io/opentelemetry/javaagent/spi/exporter/SpanExporterFactory.java", "diffHunk": "@@ -21,4 +22,11 @@\n    * @return An implementation of a {@link SpanExporter}\n    */\n   SpanExporter fromConfig(Properties config);\n+\n+  /**\n+   * Returns names of span exporters supported by this factory.", "originalCommit": "338c562acd57c7535a7c65fe370e974be6463ea8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc0MzI2MA==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1513#discussion_r513743260", "body": "```suggestion\r\n      if (spanExporterFactory.getNames().contains(exporterName)) {\r\n        return spanExporterFactory;\r\n      }\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  if (spanExporterFactory.getNames().contains(exporterName)) return spanExporterFactory;\n          \n          \n            \n                  if (spanExporterFactory.getNames().contains(exporterName)) {\n          \n          \n            \n                    return spanExporterFactory;\n          \n          \n            \n                  }", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      <span class=\"pl-k\">if</span> (spanExporterFactory<span class=\"pl-k\">.</span>getNames()<span class=\"pl-k\">.</span>contains(exporterName)) <span class=\"pl-k x x-first\">return</span><span class=\"x x-last\"> spanExporterFactory;</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      <span class=\"pl-k\">if</span> (spanExporterFactory<span class=\"pl-k\">.</span>getNames()<span class=\"pl-k\">.</span>contains(exporterName)) <span class=\"x x-first x-last\">{</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">return</span> spanExporterFactory;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "iNikem", "createdAt": "2020-10-28T20:35:12Z", "path": "javaagent-tooling/src/main/java/io/opentelemetry/javaagent/tooling/TracerInstaller.java", "diffHunk": "@@ -122,21 +114,11 @@ private static SpanExporterFactory findSpanExporterFactory(String exporterName)\n         ServiceLoader.load(SpanExporterFactory.class, TracerInstaller.class.getClassLoader());\n \n     for (SpanExporterFactory spanExporterFactory : serviceLoader) {\n-      if (spanExporterFactory\n-          .getClass()\n-          .getSimpleName()\n-          .toLowerCase()\n-          .startsWith(exporterName(exporterName).toLowerCase())) {\n-        return spanExporterFactory;\n-      }\n+      if (spanExporterFactory.getNames().contains(exporterName)) return spanExporterFactory;", "originalCommit": "338c562acd57c7535a7c65fe370e974be6463ea8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b7b21768b6f21fc8566fc766beb5b82bce8668b6", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b7b21768b6f21fc8566fc766beb5b82bce8668b6", "message": "Add explicit names to metrics/trace SPI factories\n\nSigned-off-by: Pavol Loffay <p.loffay@gmail.com>", "committedDate": "2020-10-29T07:18:33Z", "type": "commit"}, {"oid": "b7b21768b6f21fc8566fc766beb5b82bce8668b6", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/b7b21768b6f21fc8566fc766beb5b82bce8668b6", "message": "Add explicit names to metrics/trace SPI factories\n\nSigned-off-by: Pavol Loffay <p.loffay@gmail.com>", "committedDate": "2020-10-29T07:18:33Z", "type": "forcePushed"}, {"oid": "7b70c5a4142155eb3cce0122df4964317f6fe3ec", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/7b70c5a4142155eb3cce0122df4964317f6fe3ec", "message": "Fix tests\n\nSigned-off-by: Pavol Loffay <p.loffay@gmail.com>", "committedDate": "2020-10-29T09:30:51Z", "type": "commit"}]}