{"pr_number": 1690, "pr_title": "Update to SDK 0.11.0", "pr_author": "anuraaga", "pr_createdAt": "2020-11-19T07:54:10Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1690", "timeline": [{"oid": "634511fadd59ff4499b1aed545c94040caf49b49", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/634511fadd59ff4499b1aed545c94040caf49b49", "message": "Update to SDK 0.11.0", "committedDate": "2020-11-19T07:09:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY4ODk4Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/pull/1690#discussion_r526688982", "body": "Minor reuse suggestion:\r\n\r\n```suggestion\r\n      setGlobalPropagators(DefaultContextPropagators.builder()\r\n              .addTextMapPropagator(HttpTraceContext.getInstance())\r\n              .build());\r\n```", "bodyText": "Minor reuse suggestion:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  OpenTelemetry.set(\n          \n          \n            \n                      OpenTelemetrySdk.builder()\n          \n          \n            \n                          .setResource(OpenTelemetrySdk.get().getResource())\n          \n          \n            \n                          .setClock(OpenTelemetrySdk.get().getClock())\n          \n          \n            \n                          .setMeterProvider(OpenTelemetry.getGlobalMeterProvider())\n          \n          \n            \n                          .setTracerProvider(unobfuscate(OpenTelemetry.getGlobalTracerProvider()))\n          \n          \n            \n                          .setPropagators(\n          \n          \n            \n                              DefaultContextPropagators.builder()\n          \n          \n            \n                                  .addTextMapPropagator(HttpTraceContext.getInstance())\n          \n          \n            \n                                  .build())\n          \n          \n            \n                          .build());\n          \n          \n            \n                  setGlobalPropagators(DefaultContextPropagators.builder()\n          \n          \n            \n                          .addTextMapPropagator(HttpTraceContext.getInstance())\n          \n          \n            \n                          .build());", "bodyHTML": "<p dir=\"auto\">Minor reuse suggestion:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"119\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      <span class=\"pl-smi\">OpenTelemetry</span><span class=\"pl-k\">.</span>set(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"120\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          <span class=\"pl-smi\">OpenTelemetrySdk</span><span class=\"pl-k\">.</span>builder()</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"121\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">              .setResource(<span class=\"pl-smi\">OpenTelemetrySdk</span><span class=\"pl-k\">.</span>get()<span class=\"pl-k\">.</span>getResource())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"122\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">              .setClock(<span class=\"pl-smi\">OpenTelemetrySdk</span><span class=\"pl-k\">.</span>get()<span class=\"pl-k\">.</span>getClock())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"123\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">              .setMeterProvider(<span class=\"pl-smi\">OpenTelemetry</span><span class=\"pl-k\">.</span>getGlobalMeterProvider())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"124\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">              .setTracerProvider(unobfuscate(<span class=\"pl-smi\">OpenTelemetry</span><span class=\"pl-k\">.</span>getGlobalTracerProvider()))</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"125\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">              .setPropagators(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"126\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                  <span class=\"pl-smi\">DefaultContextPropagators</span><span class=\"pl-k\">.</span>builder()</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"127\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                      .addTextMapPropagator(<span class=\"pl-smi\">HttpTraceContext</span><span class=\"pl-k\">.</span>getInstance())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"128\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                      .build())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"129\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">              .build());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"119\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      setGlobalPropagators(<span class=\"pl-smi\">DefaultContextPropagators</span><span class=\"pl-k\">.</span>builder()</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"120\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">              .addTextMapPropagator(<span class=\"pl-smi\">HttpTraceContext</span><span class=\"pl-k\">.</span>getInstance())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"121\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">              .build());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "mateuszrzeszutek", "createdAt": "2020-11-19T08:51:21Z", "path": "testing-common/src/main/groovy/io/opentelemetry/instrumentation/test/AgentTestRunner.java", "diffHunk": "@@ -109,9 +112,17 @@\n         .getClass()\n         .getSimpleName()\n         .equals(\"NoopTextMapPropagator\")) {\n-      OpenTelemetry.setGlobalPropagators(\n-          DefaultContextPropagators.builder()\n-              .addTextMapPropagator(HttpTraceContext.getInstance())\n+      // Workaround https://github.com/open-telemetry/opentelemetry-java/pull/2096\n+      OpenTelemetry.set(\n+          OpenTelemetrySdk.builder()\n+              .setResource(OpenTelemetrySdk.get().getResource())\n+              .setClock(OpenTelemetrySdk.get().getClock())\n+              .setMeterProvider(OpenTelemetry.getGlobalMeterProvider())\n+              .setTracerProvider(unobfuscate(OpenTelemetry.getGlobalTracerProvider()))\n+              .setPropagators(\n+                  DefaultContextPropagators.builder()\n+                      .addTextMapPropagator(HttpTraceContext.getInstance())\n+                      .build())\n               .build());", "originalCommit": "634511fadd59ff4499b1aed545c94040caf49b49", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fb462e031be48584db28a61b0de462a72b3c6752", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/fb462e031be48584db28a61b0de462a72b3c6752", "message": "Merge remote-tracking branch 'upstream/master' into pr-otel-0.11", "committedDate": "2020-11-19T22:43:15Z", "type": "commit"}, {"oid": "96394ff2ea2f55b43b3d360a17936b932e4f9826", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/96394ff2ea2f55b43b3d360a17936b932e4f9826", "message": "Shade OTel SPI", "committedDate": "2020-11-19T22:47:18Z", "type": "commit"}, {"oid": "465bf4d933d41dbaf261efe63f07701a0f2ae7a8", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/465bf4d933d41dbaf261efe63f07701a0f2ae7a8", "message": "Accept review feedback", "committedDate": "2020-11-19T22:53:15Z", "type": "commit"}, {"oid": "54718914d0132899517a92c00209e92faff5c088", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/54718914d0132899517a92c00209e92faff5c088", "message": "Cleanup", "committedDate": "2020-11-19T23:40:40Z", "type": "commit"}, {"oid": "467875bfe6d2caca0e5c4680cce398e0c52801e0", "url": "https://github.com/open-telemetry/opentelemetry-java-instrumentation/commit/467875bfe6d2caca0e5c4680cce398e0c52801e0", "message": "Spotless", "committedDate": "2020-11-20T00:30:40Z", "type": "commit"}]}