{"pr_number": 10076, "pr_title": "Add query optimizer incl. rules for cast optimizations", "pr_author": "seut", "pr_createdAt": "2020-06-11T15:46:23Z", "pr_url": "https://github.com/crate/crate/pull/10076", "merge_commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "timeline": [{"oid": "3efa9b457e875100a2dbf2534202086f68c29177", "url": "https://github.com/crate/crate/commit/3efa9b457e875100a2dbf2534202086f68c29177", "message": "Add query optimizer incl. rules for cast optimizations\n\nThis replaces the special literal downcast logic inside the deprecated/old\nfunction matching which caused bugs on arithmetics.\n\nThe optimizer runs before creating any `RoutedCollectPhase` while building\nexecution plans and thus only runs once per query.", "committedDate": "2020-06-11T16:02:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA2OTk4NQ==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439069985", "body": "Maybe we could create a new `symbol` or `expression` package within `optimizer`. \r\n\r\nThis stuff isn't necessarily reserved for the `collect` pieces.", "bodyText": "Maybe we could create a new symbol or expression package within optimizer.\nThis stuff isn't necessarily reserved for the collect pieces.", "bodyHTML": "<p dir=\"auto\">Maybe we could create a new <code>symbol</code> or <code>expression</code> package within <code>optimizer</code>.</p>\n<p dir=\"auto\">This stuff isn't necessarily reserved for the <code>collect</code> pieces.</p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:04:24Z", "path": "server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java", "diffHunk": "@@ -0,0 +1,156 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.planner.optimizer.collect;", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "597ff9fa442dc639cffd76d3e6f88949086b371b", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nsimilarity index 82%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nindex 857ddfb198..bb86845561 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\n", "chunk": "@@ -20,7 +20,7 @@\n  * agreement.\n  */\n \n-package io.crate.planner.optimizer.collect;\n+package io.crate.planner.optimizer.symbol;\n \n import io.crate.analyze.expressions.ExpressionAnalyzer;\n import io.crate.common.collections.Lists2;\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nsimilarity index 82%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nindex 857ddfb198..bb86845561 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\n", "chunk": "@@ -20,7 +20,7 @@\n  * agreement.\n  */\n \n-package io.crate.planner.optimizer.collect;\n+package io.crate.planner.optimizer.symbol;\n \n import io.crate.analyze.expressions.ExpressionAnalyzer;\n import io.crate.common.collections.Lists2;\n", "next_change": null}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3MDQ4Nw==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439070487", "body": "`() -> Version.CURRENT` isn't the `minNodeVersionInCluster`. Is this correct?", "bodyText": "() -> Version.CURRENT isn't the minNodeVersionInCluster. Is this correct?", "bodyHTML": "<p dir=\"auto\"><code>() -&gt; Version.CURRENT</code> isn't the <code>minNodeVersionInCluster</code>. Is this correct?</p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:05:37Z", "path": "server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java", "diffHunk": "@@ -0,0 +1,156 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.planner.optimizer.collect;\n+\n+import io.crate.analyze.expressions.ExpressionAnalyzer;\n+import io.crate.common.collections.Lists2;\n+import io.crate.exceptions.ConversionException;\n+import io.crate.expression.symbol.FunctionCopyVisitor;\n+import io.crate.expression.symbol.Symbol;\n+import io.crate.metadata.CoordinatorTxnCtx;\n+import io.crate.metadata.Functions;\n+import io.crate.planner.PlannerContext;\n+import io.crate.planner.optimizer.collect.rule.MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenLeftIsReference;\n+import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference;\n+import io.crate.planner.optimizer.collect.rule.MoveSubscriptOnReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.matcher.Captures;\n+import io.crate.planner.optimizer.matcher.Match;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.Version;\n+\n+import java.util.List;\n+import java.util.function.BiFunction;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n+public class Optimizer {\n+\n+    public static Symbol optimizeQuery(PlannerContext plannerContext, Symbol query) {\n+        Optimizer optimizer = new Optimizer(\n+            plannerContext.functions(),\n+            plannerContext.transactionContext(),\n+            () -> Version.CURRENT,", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTM2MDI0OA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439360248", "bodyText": "Yep, good catch.", "author": "seut", "createdAt": "2020-06-12T11:17:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3MDQ4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "597ff9fa442dc639cffd76d3e6f88949086b371b", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nsimilarity index 82%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nindex 857ddfb198..bb86845561 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\n", "chunk": "@@ -30,29 +30,28 @@ import io.crate.expression.symbol.Symbol;\n import io.crate.metadata.CoordinatorTxnCtx;\n import io.crate.metadata.Functions;\n import io.crate.planner.PlannerContext;\n-import io.crate.planner.optimizer.collect.rule.MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators;\n-import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastInsideOperators;\n-import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenLeftIsReference;\n-import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference;\n-import io.crate.planner.optimizer.collect.rule.MoveSubscriptOnReferenceCastToLiteralCastInsideOperators;\n import io.crate.planner.optimizer.matcher.Captures;\n import io.crate.planner.optimizer.matcher.Match;\n+import io.crate.planner.optimizer.symbol.rule.MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.symbol.rule.MoveReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.symbol.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenLeftIsReference;\n+import io.crate.planner.optimizer.symbol.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference;\n+import io.crate.planner.optimizer.symbol.rule.MoveSubscriptOnReferenceCastToLiteralCastInsideOperators;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n import org.elasticsearch.Version;\n \n import java.util.List;\n-import java.util.function.BiFunction;\n import java.util.function.Function;\n import java.util.function.Supplier;\n \n public class Optimizer {\n \n-    public static Symbol optimizeQuery(PlannerContext plannerContext, Symbol query) {\n+    public static Symbol optimizeCasts(Symbol query, PlannerContext plannerContext) {\n         Optimizer optimizer = new Optimizer(\n             plannerContext.functions(),\n             plannerContext.transactionContext(),\n-            () -> Version.CURRENT,\n+            () -> plannerContext.clusterState().nodes().getMinNodeVersion(),\n             List.of(\n                 MoveReferenceCastToLiteralCastInsideOperators::new,\n                 MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference::new,\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nsimilarity index 82%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nindex 857ddfb198..bb86845561 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\n", "chunk": "@@ -30,29 +30,28 @@ import io.crate.expression.symbol.Symbol;\n import io.crate.metadata.CoordinatorTxnCtx;\n import io.crate.metadata.Functions;\n import io.crate.planner.PlannerContext;\n-import io.crate.planner.optimizer.collect.rule.MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators;\n-import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastInsideOperators;\n-import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenLeftIsReference;\n-import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference;\n-import io.crate.planner.optimizer.collect.rule.MoveSubscriptOnReferenceCastToLiteralCastInsideOperators;\n import io.crate.planner.optimizer.matcher.Captures;\n import io.crate.planner.optimizer.matcher.Match;\n+import io.crate.planner.optimizer.symbol.rule.MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.symbol.rule.MoveReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.symbol.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenLeftIsReference;\n+import io.crate.planner.optimizer.symbol.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference;\n+import io.crate.planner.optimizer.symbol.rule.MoveSubscriptOnReferenceCastToLiteralCastInsideOperators;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n import org.elasticsearch.Version;\n \n import java.util.List;\n-import java.util.function.BiFunction;\n import java.util.function.Function;\n import java.util.function.Supplier;\n \n public class Optimizer {\n \n-    public static Symbol optimizeQuery(PlannerContext plannerContext, Symbol query) {\n+    public static Symbol optimizeCasts(Symbol query, PlannerContext plannerContext) {\n         Optimizer optimizer = new Optimizer(\n             plannerContext.functions(),\n             plannerContext.transactionContext(),\n-            () -> Version.CURRENT,\n+            () -> plannerContext.clusterState().nodes().getMinNodeVersion(),\n             List.of(\n                 MoveReferenceCastToLiteralCastInsideOperators::new,\n                 MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference::new,\n", "next_change": null}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3MTAyMQ==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439071021", "body": "Based on the types and name it is hard to guess what `String` and `List<Symbol>`, `Symbol` here are referring to. Maybe it would be worth to introduce a named specific interface?", "bodyText": "Based on the types and name it is hard to guess what String and List<Symbol>, Symbol here are referring to. Maybe it would be worth to introduce a named specific interface?", "bodyHTML": "<p dir=\"auto\">Based on the types and name it is hard to guess what <code>String</code> and <code>List&lt;Symbol&gt;</code>, <code>Symbol</code> here are referring to. Maybe it would be worth to introduce a named specific interface?</p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:06:49Z", "path": "server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java", "diffHunk": "@@ -0,0 +1,156 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.planner.optimizer.collect;\n+\n+import io.crate.analyze.expressions.ExpressionAnalyzer;\n+import io.crate.common.collections.Lists2;\n+import io.crate.exceptions.ConversionException;\n+import io.crate.expression.symbol.FunctionCopyVisitor;\n+import io.crate.expression.symbol.Symbol;\n+import io.crate.metadata.CoordinatorTxnCtx;\n+import io.crate.metadata.Functions;\n+import io.crate.planner.PlannerContext;\n+import io.crate.planner.optimizer.collect.rule.MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenLeftIsReference;\n+import io.crate.planner.optimizer.collect.rule.MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference;\n+import io.crate.planner.optimizer.collect.rule.MoveSubscriptOnReferenceCastToLiteralCastInsideOperators;\n+import io.crate.planner.optimizer.matcher.Captures;\n+import io.crate.planner.optimizer.matcher.Match;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.elasticsearch.Version;\n+\n+import java.util.List;\n+import java.util.function.BiFunction;\n+import java.util.function.Function;\n+import java.util.function.Supplier;\n+\n+public class Optimizer {\n+\n+    public static Symbol optimizeQuery(PlannerContext plannerContext, Symbol query) {\n+        Optimizer optimizer = new Optimizer(\n+            plannerContext.functions(),\n+            plannerContext.transactionContext(),\n+            () -> Version.CURRENT,\n+            List.of(\n+                MoveReferenceCastToLiteralCastInsideOperators::new,\n+                MoveReferenceCastToLiteralCastOnAnyOperatorsWhenRightIsReference::new,\n+                MoveReferenceCastToLiteralCastOnAnyOperatorsWhenLeftIsReference::new,\n+                MoveSubscriptOnReferenceCastToLiteralCastInsideOperators::new,\n+                MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators::new\n+            )\n+        );\n+        return optimizer.optimize(query);\n+    }\n+\n+    private static final Logger LOGGER = LogManager.getLogger(Optimizer.class);\n+\n+    private final List<Rule<?>> rules;\n+    private final Supplier<Version> minNodeVersionInCluster;\n+    private final Functions functions;\n+    private final Visitor visitor = new Visitor();\n+\n+    public Optimizer(Functions functions,\n+                     CoordinatorTxnCtx coordinatorTxnCtx,\n+                     Supplier<Version> minNodeVersionInCluster,\n+                     List<Function<BiFunction<String, List<Symbol>, Symbol>, Rule<?>>> rules) {\n+        BiFunction<String, List<Symbol>, Symbol> functionResolver =", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "597ff9fa442dc639cffd76d3e6f88949086b371b", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nsimilarity index 82%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nindex 857ddfb198..bb86845561 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\n", "chunk": "@@ -74,8 +73,8 @@ public class Optimizer {\n     public Optimizer(Functions functions,\n                      CoordinatorTxnCtx coordinatorTxnCtx,\n                      Supplier<Version> minNodeVersionInCluster,\n-                     List<Function<BiFunction<String, List<Symbol>, Symbol>, Rule<?>>> rules) {\n-        BiFunction<String, List<Symbol>, Symbol> functionResolver =\n+                     List<Function<FunctionSymbolResolver, Rule<?>>> rules) {\n+        FunctionSymbolResolver functionResolver =\n             (f, args) -> {\n                 try {\n                     return ExpressionAnalyzer.allocateFunction(\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nsimilarity index 82%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\nindex 857ddfb198..bb86845561 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/Optimizer.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/Optimizer.java\n", "chunk": "@@ -74,8 +73,8 @@ public class Optimizer {\n     public Optimizer(Functions functions,\n                      CoordinatorTxnCtx coordinatorTxnCtx,\n                      Supplier<Version> minNodeVersionInCluster,\n-                     List<Function<BiFunction<String, List<Symbol>, Symbol>, Rule<?>>> rules) {\n-        BiFunction<String, List<Symbol>, Symbol> functionResolver =\n+                     List<Function<FunctionSymbolResolver, Rule<?>>> rules) {\n+        FunctionSymbolResolver functionResolver =\n             (f, args) -> {\n                 try {\n                     return ExpressionAnalyzer.allocateFunction(\n", "next_change": null}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3MjgzNA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439072834", "body": "Should we try to create some \"matcher\" functions, similar to how `isFunction(name, argMatcher...)` works that we use in the tests?", "bodyText": "Should we try to create some \"matcher\" functions, similar to how isFunction(name, argMatcher...) works that we use in the tests?", "bodyHTML": "<p dir=\"auto\">Should we try to create some \"matcher\" functions, similar to how <code>isFunction(name, argMatcher...)</code> works that we use in the tests?</p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:11:07Z", "path": "server/src/main/java/io/crate/planner/optimizer/collect/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.planner.optimizer.collect.rule;\n+\n+import io.crate.expression.scalar.ArrayUpperFunction;\n+import io.crate.expression.symbol.Function;\n+import io.crate.expression.symbol.Symbol;\n+import io.crate.expression.symbol.SymbolType;\n+import io.crate.metadata.Functions;\n+import io.crate.planner.optimizer.collect.Rule;\n+import io.crate.planner.optimizer.matcher.Capture;\n+import io.crate.planner.optimizer.matcher.Captures;\n+import io.crate.planner.optimizer.matcher.Pattern;\n+import io.crate.types.DataType;\n+\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.function.BiFunction;\n+\n+import static io.crate.expression.operator.Operators.COMPARISON_OPERATORS;\n+import static io.crate.expression.scalar.cast.CastFunctionResolver.CAST_FUNCTION_NAMES;\n+import static io.crate.planner.optimizer.matcher.Pattern.typeOf;\n+\n+\n+public class MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators implements Rule<Function> {\n+\n+    private final Capture<Function> castCapture;\n+    private final Pattern<Function> pattern;\n+    private final BiFunction<String, List<Symbol>, Symbol> functionResolver;\n+    private volatile boolean enabled = true;\n+\n+    public MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators(\n+        BiFunction<String, List<Symbol>, Symbol> functionResolver\n+    ) {\n+        this.functionResolver = functionResolver;\n+        this.castCapture = new Capture<>();\n+        this.pattern = typeOf(Function.class)\n+            .with(f -> COMPARISON_OPERATORS.contains(f.info().ident().name()))\n+            .with(f -> f.arguments().get(1).symbolType() == SymbolType.LITERAL)\n+            .with(f -> Optional.of(f.arguments().get(0)), typeOf(Function.class).capturedAs(castCapture)", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMyMDc4NA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439320784", "bodyText": "Good idea, will try.", "author": "seut", "createdAt": "2020-06-12T09:48:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3MjgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAyNTkyMA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r440025920", "bodyText": "I'd suggest to do this as a follow up so we first could get this functionality merged in and finish up the complete function registry overhaul (move missing functions, afaik only operators left).", "author": "seut", "createdAt": "2020-06-15T08:53:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3MjgzNA=="}], "type": "inlineReview", "revised_code": {"commit": "597ff9fa442dc639cffd76d3e6f88949086b371b", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java b/server/src/main/java/io/crate/planner/optimizer/symbol/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\nsimilarity index 87%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\nindex 929b714fba..fc6ea9265b 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\n", "chunk": "@@ -46,12 +46,9 @@ public class MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators implemen\n \n     private final Capture<Function> castCapture;\n     private final Pattern<Function> pattern;\n-    private final BiFunction<String, List<Symbol>, Symbol> functionResolver;\n-    private volatile boolean enabled = true;\n+    private final FunctionSymbolResolver functionResolver;\n \n-    public MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators(\n-        BiFunction<String, List<Symbol>, Symbol> functionResolver\n-    ) {\n+    public MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators(FunctionSymbolResolver functionResolver) {\n         this.functionResolver = functionResolver;\n         this.castCapture = new Capture<>();\n         this.pattern = typeOf(Function.class)\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java b/server/src/main/java/io/crate/planner/optimizer/symbol/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\nsimilarity index 87%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\nindex 929b714fba..fc6ea9265b 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/rule/MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators.java\n", "chunk": "@@ -46,12 +46,9 @@ public class MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators implemen\n \n     private final Capture<Function> castCapture;\n     private final Pattern<Function> pattern;\n-    private final BiFunction<String, List<Symbol>, Symbol> functionResolver;\n-    private volatile boolean enabled = true;\n+    private final FunctionSymbolResolver functionResolver;\n \n-    public MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators(\n-        BiFunction<String, List<Symbol>, Symbol> functionResolver\n-    ) {\n+    public MoveArrayLengthOnReferenceCastToLiteralCastInsideOperators(FunctionSymbolResolver functionResolver) {\n         this.functionResolver = functionResolver;\n         this.castCapture = new Capture<>();\n         this.pattern = typeOf(Function.class)\n", "next_change": null}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3NTc3MQ==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439075771", "body": "Is this to assign the name with the predicate? (Just to make sure I understand why this is being changed)\r\n\r\nI'm not sure I see the benefit of doing this in this new way?", "bodyText": "Is this to assign the name with the predicate? (Just to make sure I understand why this is being changed)\nI'm not sure I see the benefit of doing this in this new way?", "bodyHTML": "<p dir=\"auto\">Is this to assign the name with the predicate? (Just to make sure I understand why this is being changed)</p>\n<p dir=\"auto\">I'm not sure I see the benefit of doing this in this new way?</p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:18:13Z", "path": "server/src/main/java/io/crate/expression/operator/any/AnyOperators.java", "diffHunk": "@@ -22,42 +22,73 @@\n \n package io.crate.expression.operator.any;\n \n+import io.crate.common.collections.Lists2;\n+import io.crate.expression.operator.LikeOperators;\n import io.crate.expression.operator.OperatorModule;\n import io.crate.sql.tree.ComparisonExpression;\n \n import java.util.Arrays;\n import java.util.Collection;\n+import java.util.List;\n import java.util.Locale;\n+import java.util.function.IntPredicate;\n \n import static io.crate.expression.operator.any.AnyOperator.OPERATOR_PREFIX;\n-import static io.crate.expression.operator.any.AnyOperators.Names.EQ;\n-import static io.crate.expression.operator.any.AnyOperators.Names.GT;\n-import static io.crate.expression.operator.any.AnyOperators.Names.GTE;\n-import static io.crate.expression.operator.any.AnyOperators.Names.LT;\n-import static io.crate.expression.operator.any.AnyOperators.Names.LTE;\n-import static io.crate.expression.operator.any.AnyOperators.Names.NEQ;\n \n public final class AnyOperators {\n \n-    private AnyOperators() {\n-    }\n+    public static final List<String> OPERATOR_NAMES = Lists2.concat(\n+        AnyOperators.Type.fullQualifiedNames(),\n+        List.of(\n+            LikeOperators.ANY_LIKE,\n+            LikeOperators.ANY_ILIKE,\n+            LikeOperators.ANY_NOT_LIKE,\n+            LikeOperators.ANY_NOT_ILIKE\n+        )\n+    );\n \n     public static class Names {\n-        public static final String EQ = OPERATOR_PREFIX + ComparisonExpression.Type.EQUAL.getValue();\n-        public static final String GTE = OPERATOR_PREFIX + ComparisonExpression.Type.GREATER_THAN_OR_EQUAL.getValue();\n-        public static final String GT = OPERATOR_PREFIX + ComparisonExpression.Type.GREATER_THAN.getValue();\n-        public static final String LTE = OPERATOR_PREFIX + ComparisonExpression.Type.LESS_THAN_OR_EQUAL.getValue();\n-        public static final String LT = OPERATOR_PREFIX + ComparisonExpression.Type.LESS_THAN.getValue();\n-        public static final String NEQ = OPERATOR_PREFIX + ComparisonExpression.Type.NOT_EQUAL.getValue();\n+        public static final String EQ = Type.EQ.fullQualifiedName;\n+        public static final String GTE = Type.GTE.fullQualifiedName;\n+        public static final String GT = Type.GT.fullQualifiedName;\n+        public static final String LTE = Type.LTE.fullQualifiedName;\n+        public static final String LT = Type.LT.fullQualifiedName;\n+        public static final String NEQ = Type.NEQ.fullQualifiedName;\n+    }\n+\n+    public enum Type {", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMxMDEyNA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439310124", "bodyText": "We need to match inside the rule predicates again a list of all full-qualified internal operator names. (https://github.com/crate/crate/pull/10076/files#diff-cc8e036acde8edb2dfa2dd74f78d3336R40)\nAlso by doing it this way we just can loop over the enum to register the operators.\nWe could also do this in a concrete way (like it was before) and additionally store a list of the operator names. I guess this is a bit of personal preference, no strong opinion here.", "author": "seut", "createdAt": "2020-06-12T09:26:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3NTc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwMDY4Ng==", "url": "https://github.com/crate/crate/pull/10076#discussion_r440000686", "bodyText": "We need to match inside the rule predicates again a list of all full-qualified internal operator names\n\nAh I missed that.\nCould we now also remove the Names class and refer to the enum directly instead?", "author": "mfussenegger", "createdAt": "2020-06-15T08:09:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3NTc3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "597ff9fa442dc639cffd76d3e6f88949086b371b", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\nindex 157528cfa8..7a864794cd 100644\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n", "chunk": "@@ -47,15 +48,6 @@ public final class AnyOperators {\n         )\n     );\n \n-    public static class Names {\n-        public static final String EQ = Type.EQ.fullQualifiedName;\n-        public static final String GTE = Type.GTE.fullQualifiedName;\n-        public static final String GT = Type.GT.fullQualifiedName;\n-        public static final String LTE = Type.LTE.fullQualifiedName;\n-        public static final String LT = Type.LT.fullQualifiedName;\n-        public static final String NEQ = Type.NEQ.fullQualifiedName;\n-    }\n-\n     public enum Type {\n         EQ(ComparisonExpression.Type.EQUAL, result -> result == 0),\n         NEQ(ComparisonExpression.Type.NOT_EQUAL, result -> result != 0),\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\nindex 157528cfa8..7a864794cd 100644\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n", "chunk": "@@ -47,15 +48,6 @@ public final class AnyOperators {\n         )\n     );\n \n-    public static class Names {\n-        public static final String EQ = Type.EQ.fullQualifiedName;\n-        public static final String GTE = Type.GTE.fullQualifiedName;\n-        public static final String GT = Type.GT.fullQualifiedName;\n-        public static final String LTE = Type.LTE.fullQualifiedName;\n-        public static final String LT = Type.LT.fullQualifiedName;\n-        public static final String NEQ = Type.NEQ.fullQualifiedName;\n-    }\n-\n     public enum Type {\n         EQ(ComparisonExpression.Type.EQUAL, result -> result == 0),\n         NEQ(ComparisonExpression.Type.NOT_EQUAL, result -> result != 0),\n", "next_change": {"commit": "8518543d750bfc5542a936bcc3730ce120991c07", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\ndeleted file mode 100644\nindex 7a864794cd..0000000000\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ /dev/null\n", "chunk": "@@ -1,104 +0,0 @@\n-/*\n- * Licensed to Crate under one or more contributor license agreements.\n- * See the NOTICE file distributed with this work for additional\n- * information regarding copyright ownership.  Crate licenses this file\n- * to you under the Apache License, Version 2.0 (the \"License\"); you may\n- * not use this file except in compliance with the License.  You may\n- * obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n- * implied.  See the License for the specific language governing\n- * permissions and limitations under the License.\n- *\n- * However, if you have executed another commercial license agreement\n- * with Crate these terms will supersede the license and you may use the\n- * software solely pursuant to the terms of the relevant commercial\n- * agreement.\n- */\n-\n-package io.crate.expression.operator.any;\n-\n-import io.crate.common.annotations.VisibleForTesting;\n-import io.crate.common.collections.Lists2;\n-import io.crate.expression.operator.LikeOperators;\n-import io.crate.expression.operator.OperatorModule;\n-import io.crate.sql.tree.ComparisonExpression;\n-\n-import java.util.Arrays;\n-import java.util.Collection;\n-import java.util.List;\n-import java.util.Locale;\n-import java.util.function.IntPredicate;\n-\n-import static io.crate.expression.operator.any.AnyOperator.OPERATOR_PREFIX;\n-\n-public final class AnyOperators {\n-\n-    public static final List<String> OPERATOR_NAMES = Lists2.concat(\n-        AnyOperators.Type.fullQualifiedNames(),\n-        List.of(\n-            LikeOperators.ANY_LIKE,\n-            LikeOperators.ANY_ILIKE,\n-            LikeOperators.ANY_NOT_LIKE,\n-            LikeOperators.ANY_NOT_ILIKE\n-        )\n-    );\n-\n-    public enum Type {\n-        EQ(ComparisonExpression.Type.EQUAL, result -> result == 0),\n-        NEQ(ComparisonExpression.Type.NOT_EQUAL, result -> result != 0),\n-        GTE(ComparisonExpression.Type.GREATER_THAN_OR_EQUAL, result -> result >= 0),\n-        GT(ComparisonExpression.Type.GREATER_THAN, result -> result > 0),\n-        LTE(ComparisonExpression.Type.LESS_THAN_OR_EQUAL, result -> result <= 0),\n-        LT(ComparisonExpression.Type.LESS_THAN, result -> result < 0);\n-\n-        final String opName;\n-        final String opSymbol;\n-        final IntPredicate cmp;\n-\n-        Type(ComparisonExpression.Type type, IntPredicate cmp) {\n-            this.opName = OPERATOR_PREFIX + type.getValue();\n-            this.opSymbol = type.getValue();\n-            this.cmp = cmp;\n-        }\n-\n-        public String opName() {\n-            return opName;\n-        }\n-\n-        public static List<String> fullQualifiedNames() {\n-            return Lists2.map(Arrays.asList(values()), t -> t.opName);\n-        }\n-\n-        @VisibleForTesting\n-        public static List<String> operatorSymbols() {\n-            return Lists2.map(Arrays.asList(values()), t -> t.opSymbol);\n-        }\n-    }\n-\n-    public static void register(OperatorModule module) {\n-        for (var type : Type.values()) {\n-            module.registerDynamicOperatorFunction(\n-                type.opName,\n-                new AnyOperator.AnyResolver(type.opName, type.cmp));\n-        }\n-    }\n-\n-    public static Iterable<?> collectionValueToIterable(Object collectionRef) throws IllegalArgumentException {\n-        if (collectionRef instanceof Object[]) {\n-            return Arrays.asList((Object[]) collectionRef);\n-        } else if (collectionRef instanceof Collection) {\n-            return (Collection<?>) collectionRef;\n-        } else {\n-            throw new IllegalArgumentException(\n-                String.format(Locale.ENGLISH, \"cannot cast %s to Iterable\", collectionRef));\n-        }\n-    }\n-\n-    private AnyOperators() {\n-    }\n-}\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}, {"oid": "67ba347bd3ddbd4289aad5c91e0873d515b78578", "committedDate": "2020-06-17 15:02:09 +0000", "message": "Convert all operators to new signature based function registry"}, {"oid": "28de18fcc33f14c44121d49daedcdcc11caf536f", "committedDate": "2020-06-26 15:55:24 +0000", "message": "Use Signature instead of FunctionIdent/Info"}, {"oid": "df77bd0147b960da9e905351dc6a8c833c5ac26b", "committedDate": "2021-05-07 09:46:36 +0000", "message": "Update license boilerplates to state company name in full"}, {"oid": "0481d8cafa47526960df42bf1085852b0ab8dd93", "committedDate": "2021-10-05 08:42:55 +0000", "message": "Remove `collectionValueToIterable`"}, {"oid": "8518543d750bfc5542a936bcc3730ce120991c07", "committedDate": "2021-10-06 15:39:32 +0000", "message": "Migrate ANY query building to new interface"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3NzM4MQ==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439077381", "body": "Looks like this is only used in tests. Maybe annotate with `@VisibleForTesting`", "bodyText": "Looks like this is only used in tests. Maybe annotate with @VisibleForTesting", "bodyHTML": "<p dir=\"auto\">Looks like this is only used in tests. Maybe annotate with <code>@VisibleForTesting</code></p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:22:04Z", "path": "server/src/main/java/io/crate/expression/operator/any/AnyOperators.java", "diffHunk": "@@ -22,42 +22,73 @@\n \n package io.crate.expression.operator.any;\n \n+import io.crate.common.collections.Lists2;\n+import io.crate.expression.operator.LikeOperators;\n import io.crate.expression.operator.OperatorModule;\n import io.crate.sql.tree.ComparisonExpression;\n \n import java.util.Arrays;\n import java.util.Collection;\n+import java.util.List;\n import java.util.Locale;\n+import java.util.function.IntPredicate;\n \n import static io.crate.expression.operator.any.AnyOperator.OPERATOR_PREFIX;\n-import static io.crate.expression.operator.any.AnyOperators.Names.EQ;\n-import static io.crate.expression.operator.any.AnyOperators.Names.GT;\n-import static io.crate.expression.operator.any.AnyOperators.Names.GTE;\n-import static io.crate.expression.operator.any.AnyOperators.Names.LT;\n-import static io.crate.expression.operator.any.AnyOperators.Names.LTE;\n-import static io.crate.expression.operator.any.AnyOperators.Names.NEQ;\n \n public final class AnyOperators {\n \n-    private AnyOperators() {\n-    }\n+    public static final List<String> OPERATOR_NAMES = Lists2.concat(\n+        AnyOperators.Type.fullQualifiedNames(),\n+        List.of(\n+            LikeOperators.ANY_LIKE,\n+            LikeOperators.ANY_ILIKE,\n+            LikeOperators.ANY_NOT_LIKE,\n+            LikeOperators.ANY_NOT_ILIKE\n+        )\n+    );\n \n     public static class Names {\n-        public static final String EQ = OPERATOR_PREFIX + ComparisonExpression.Type.EQUAL.getValue();\n-        public static final String GTE = OPERATOR_PREFIX + ComparisonExpression.Type.GREATER_THAN_OR_EQUAL.getValue();\n-        public static final String GT = OPERATOR_PREFIX + ComparisonExpression.Type.GREATER_THAN.getValue();\n-        public static final String LTE = OPERATOR_PREFIX + ComparisonExpression.Type.LESS_THAN_OR_EQUAL.getValue();\n-        public static final String LT = OPERATOR_PREFIX + ComparisonExpression.Type.LESS_THAN.getValue();\n-        public static final String NEQ = OPERATOR_PREFIX + ComparisonExpression.Type.NOT_EQUAL.getValue();\n+        public static final String EQ = Type.EQ.fullQualifiedName;\n+        public static final String GTE = Type.GTE.fullQualifiedName;\n+        public static final String GT = Type.GT.fullQualifiedName;\n+        public static final String LTE = Type.LTE.fullQualifiedName;\n+        public static final String LT = Type.LT.fullQualifiedName;\n+        public static final String NEQ = Type.NEQ.fullQualifiedName;\n+    }\n+\n+    public enum Type {\n+        EQ(ComparisonExpression.Type.EQUAL, result -> result == 0),\n+        NEQ(ComparisonExpression.Type.NOT_EQUAL, result -> result != 0),\n+        GTE(ComparisonExpression.Type.GREATER_THAN_OR_EQUAL, result -> result >= 0),\n+        GT(ComparisonExpression.Type.GREATER_THAN, result -> result > 0),\n+        LTE(ComparisonExpression.Type.LESS_THAN_OR_EQUAL, result -> result <= 0),\n+        LT(ComparisonExpression.Type.LESS_THAN, result -> result < 0);\n+\n+        final String fullQualifiedName;\n+        final String name;\n+        final IntPredicate cmp;\n+\n+        Type(ComparisonExpression.Type type, IntPredicate cmp) {\n+            this.fullQualifiedName = OPERATOR_PREFIX + type.getValue();\n+            this.name = type.getValue();\n+            this.cmp = cmp;\n+        }\n+\n+        public static List<String> fullQualifiedNames() {\n+            return Lists2.map(Arrays.asList(values()), t -> t.fullQualifiedName);\n+        }\n+\n+        public static List<String> operatorSymbols() {", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "597ff9fa442dc639cffd76d3e6f88949086b371b", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\nindex 157528cfa8..7a864794cd 100644\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n", "chunk": "@@ -64,30 +56,35 @@ public final class AnyOperators {\n         LTE(ComparisonExpression.Type.LESS_THAN_OR_EQUAL, result -> result <= 0),\n         LT(ComparisonExpression.Type.LESS_THAN, result -> result < 0);\n \n-        final String fullQualifiedName;\n-        final String name;\n+        final String opName;\n+        final String opSymbol;\n         final IntPredicate cmp;\n \n         Type(ComparisonExpression.Type type, IntPredicate cmp) {\n-            this.fullQualifiedName = OPERATOR_PREFIX + type.getValue();\n-            this.name = type.getValue();\n+            this.opName = OPERATOR_PREFIX + type.getValue();\n+            this.opSymbol = type.getValue();\n             this.cmp = cmp;\n         }\n \n+        public String opName() {\n+            return opName;\n+        }\n+\n         public static List<String> fullQualifiedNames() {\n-            return Lists2.map(Arrays.asList(values()), t -> t.fullQualifiedName);\n+            return Lists2.map(Arrays.asList(values()), t -> t.opName);\n         }\n \n+        @VisibleForTesting\n         public static List<String> operatorSymbols() {\n-            return Lists2.map(Arrays.asList(values()), t -> t.name);\n+            return Lists2.map(Arrays.asList(values()), t -> t.opSymbol);\n         }\n     }\n \n     public static void register(OperatorModule module) {\n         for (var type : Type.values()) {\n             module.registerDynamicOperatorFunction(\n-                type.fullQualifiedName,\n-                new AnyOperator.AnyResolver(type.fullQualifiedName, type.cmp));\n+                type.opName,\n+                new AnyOperator.AnyResolver(type.opName, type.cmp));\n         }\n     }\n \n", "next_change": null}]}, "revised_code_in_main": {"commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\nindex 157528cfa8..7a864794cd 100644\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n", "chunk": "@@ -64,30 +56,35 @@ public final class AnyOperators {\n         LTE(ComparisonExpression.Type.LESS_THAN_OR_EQUAL, result -> result <= 0),\n         LT(ComparisonExpression.Type.LESS_THAN, result -> result < 0);\n \n-        final String fullQualifiedName;\n-        final String name;\n+        final String opName;\n+        final String opSymbol;\n         final IntPredicate cmp;\n \n         Type(ComparisonExpression.Type type, IntPredicate cmp) {\n-            this.fullQualifiedName = OPERATOR_PREFIX + type.getValue();\n-            this.name = type.getValue();\n+            this.opName = OPERATOR_PREFIX + type.getValue();\n+            this.opSymbol = type.getValue();\n             this.cmp = cmp;\n         }\n \n+        public String opName() {\n+            return opName;\n+        }\n+\n         public static List<String> fullQualifiedNames() {\n-            return Lists2.map(Arrays.asList(values()), t -> t.fullQualifiedName);\n+            return Lists2.map(Arrays.asList(values()), t -> t.opName);\n         }\n \n+        @VisibleForTesting\n         public static List<String> operatorSymbols() {\n-            return Lists2.map(Arrays.asList(values()), t -> t.name);\n+            return Lists2.map(Arrays.asList(values()), t -> t.opSymbol);\n         }\n     }\n \n     public static void register(OperatorModule module) {\n         for (var type : Type.values()) {\n             module.registerDynamicOperatorFunction(\n-                type.fullQualifiedName,\n-                new AnyOperator.AnyResolver(type.fullQualifiedName, type.cmp));\n+                type.opName,\n+                new AnyOperator.AnyResolver(type.opName, type.cmp));\n         }\n     }\n \n", "next_change": {"commit": "67ba347bd3ddbd4289aad5c91e0873d515b78578", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\nindex 7a864794cd..bc1bc0a50a 100644\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n", "chunk": "@@ -82,9 +89,20 @@ public final class AnyOperators {\n \n     public static void register(OperatorModule module) {\n         for (var type : Type.values()) {\n-            module.registerDynamicOperatorFunction(\n-                type.opName,\n-                new AnyOperator.AnyResolver(type.opName, type.cmp));\n+            module.register(\n+                Signature.scalar(\n+                    type.opName,\n+                    parseTypeSignature(\"E\"),\n+                    parseTypeSignature(\"array(E)\"),\n+                    Operator.RETURN_TYPE.getTypeSignature()\n+                ).withTypeVariableConstraints(typeVariable(\"E\")),\n+                (signature, dataTypes) ->\n+                    new AnyOperator(\n+                        new FunctionInfo(new FunctionIdent(signature.getName().name(), dataTypes), DataTypes.BOOLEAN),\n+                        signature,\n+                        type.cmp\n+                    )\n+            );\n         }\n     }\n \n", "next_change": {"commit": "28de18fcc33f14c44121d49daedcdcc11caf536f", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\nindex bc1bc0a50a..164caec4f0 100644\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n", "chunk": "@@ -96,10 +93,10 @@ public final class AnyOperators {\n                     parseTypeSignature(\"array(E)\"),\n                     Operator.RETURN_TYPE.getTypeSignature()\n                 ).withTypeVariableConstraints(typeVariable(\"E\")),\n-                (signature, dataTypes) ->\n+                (signature, boundSignature) ->\n                     new AnyOperator(\n-                        new FunctionInfo(new FunctionIdent(signature.getName().name(), dataTypes), DataTypes.BOOLEAN),\n                         signature,\n+                        boundSignature,\n                         type.cmp\n                     )\n             );\n", "next_change": {"commit": "0481d8cafa47526960df42bf1085852b0ab8dd93", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\nindex 164caec4f0..36439d58d1 100644\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n", "chunk": "@@ -103,17 +100,6 @@ public final class AnyOperators {\n         }\n     }\n \n-    public static Iterable<?> collectionValueToIterable(Object collectionRef) throws IllegalArgumentException {\n-        if (collectionRef instanceof Object[]) {\n-            return Arrays.asList((Object[]) collectionRef);\n-        } else if (collectionRef instanceof Collection) {\n-            return (Collection<?>) collectionRef;\n-        } else {\n-            throw new IllegalArgumentException(\n-                String.format(Locale.ENGLISH, \"cannot cast %s to Iterable\", collectionRef));\n-        }\n-    }\n-\n     private AnyOperators() {\n     }\n }\n", "next_change": {"commit": "8518543d750bfc5542a936bcc3730ce120991c07", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java b/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\ndeleted file mode 100644\nindex 36439d58d1..0000000000\n--- a/server/src/main/java/io/crate/expression/operator/any/AnyOperators.java\n+++ /dev/null\n", "chunk": "@@ -1,105 +0,0 @@\n-/*\n- * Licensed to Crate.io GmbH (\"Crate\") under one or more contributor\n- * license agreements.  See the NOTICE file distributed with this work for\n- * additional information regarding copyright ownership.  Crate licenses\n- * this file to you under the Apache License, Version 2.0 (the \"License\");\n- * you may not use this file except in compliance with the License.  You may\n- * obtain a copy of the License at\n- *\n- *   http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the\n- * License for the specific language governing permissions and limitations\n- * under the License.\n- *\n- * However, if you have executed another commercial license agreement\n- * with Crate these terms will supersede the license and you may use the\n- * software solely pursuant to the terms of the relevant commercial agreement.\n- */\n-\n-package io.crate.expression.operator.any;\n-\n-import io.crate.common.annotations.VisibleForTesting;\n-import io.crate.common.collections.Lists2;\n-import io.crate.expression.operator.LikeOperators;\n-import io.crate.expression.operator.Operator;\n-import io.crate.expression.operator.OperatorModule;\n-import io.crate.metadata.functions.Signature;\n-import io.crate.sql.tree.ComparisonExpression;\n-\n-import java.util.Arrays;\n-import java.util.List;\n-import java.util.function.IntPredicate;\n-\n-import static io.crate.expression.operator.any.AnyOperator.OPERATOR_PREFIX;\n-import static io.crate.metadata.functions.TypeVariableConstraint.typeVariable;\n-import static io.crate.types.TypeSignature.parseTypeSignature;\n-\n-public final class AnyOperators {\n-\n-    public static final List<String> OPERATOR_NAMES = Lists2.concat(\n-        AnyOperators.Type.fullQualifiedNames(),\n-        List.of(\n-            LikeOperators.ANY_LIKE,\n-            LikeOperators.ANY_ILIKE,\n-            LikeOperators.ANY_NOT_LIKE,\n-            LikeOperators.ANY_NOT_ILIKE\n-        )\n-    );\n-\n-    public enum Type {\n-        EQ(ComparisonExpression.Type.EQUAL, result -> result == 0),\n-        NEQ(ComparisonExpression.Type.NOT_EQUAL, result -> result != 0),\n-        GTE(ComparisonExpression.Type.GREATER_THAN_OR_EQUAL, result -> result >= 0),\n-        GT(ComparisonExpression.Type.GREATER_THAN, result -> result > 0),\n-        LTE(ComparisonExpression.Type.LESS_THAN_OR_EQUAL, result -> result <= 0),\n-        LT(ComparisonExpression.Type.LESS_THAN, result -> result < 0);\n-\n-        final String opName;\n-        final String opSymbol;\n-        final IntPredicate cmp;\n-\n-        Type(ComparisonExpression.Type type, IntPredicate cmp) {\n-            this.opName = OPERATOR_PREFIX + type.getValue();\n-            this.opSymbol = type.getValue();\n-            this.cmp = cmp;\n-        }\n-\n-        public String opName() {\n-            return opName;\n-        }\n-\n-        public static List<String> fullQualifiedNames() {\n-            return Lists2.map(Arrays.asList(values()), t -> t.opName);\n-        }\n-\n-        @VisibleForTesting\n-        public static List<String> operatorSymbols() {\n-            return Lists2.map(Arrays.asList(values()), t -> t.opSymbol);\n-        }\n-    }\n-\n-    public static void register(OperatorModule module) {\n-        for (var type : Type.values()) {\n-            module.register(\n-                Signature.scalar(\n-                    type.opName,\n-                    parseTypeSignature(\"E\"),\n-                    parseTypeSignature(\"array(E)\"),\n-                    Operator.RETURN_TYPE.getTypeSignature()\n-                ).withTypeVariableConstraints(typeVariable(\"E\")),\n-                (signature, boundSignature) ->\n-                    new AnyOperator(\n-                        signature,\n-                        boundSignature,\n-                        type.cmp\n-                    )\n-            );\n-        }\n-    }\n-\n-    private AnyOperators() {\n-    }\n-}\n", "next_change": null}]}}]}}]}}]}}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}, {"oid": "67ba347bd3ddbd4289aad5c91e0873d515b78578", "committedDate": "2020-06-17 15:02:09 +0000", "message": "Convert all operators to new signature based function registry"}, {"oid": "28de18fcc33f14c44121d49daedcdcc11caf536f", "committedDate": "2020-06-26 15:55:24 +0000", "message": "Use Signature instead of FunctionIdent/Info"}, {"oid": "df77bd0147b960da9e905351dc6a8c833c5ac26b", "committedDate": "2021-05-07 09:46:36 +0000", "message": "Update license boilerplates to state company name in full"}, {"oid": "0481d8cafa47526960df42bf1085852b0ab8dd93", "committedDate": "2021-10-05 08:42:55 +0000", "message": "Remove `collectionValueToIterable`"}, {"oid": "8518543d750bfc5542a936bcc3730ce120991c07", "committedDate": "2021-10-06 15:39:32 +0000", "message": "Migrate ANY query building to new interface"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3ODkwMg==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439078902", "body": "Looks like in the call-sites of this we're now creating comparisons where the types don't match. Shouldn't they still be adjusted somehow? \r\n\r\nI'm afraid that this might bite us later if we don't do that.", "bodyText": "Looks like in the call-sites of this we're now creating comparisons where the types don't match. Shouldn't they still be adjusted somehow?\nI'm afraid that this might bite us later if we don't do that.", "bodyHTML": "<p dir=\"auto\">Looks like in the call-sites of this we're now creating comparisons where the types don't match. Shouldn't they still be adjusted somehow?</p>\n<p dir=\"auto\">I'm afraid that this might bite us later if we don't do that.</p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:25:39Z", "path": "server/src/main/java/io/crate/expression/symbol/Symbols.java", "diffHunk": "@@ -170,6 +172,14 @@ public static String format(String messageTmpl, Symbol... symbols) {\n         return String.format(Locale.ENGLISH, messageTmpl, formattedSymbols);\n     }\n \n+    public static Symbol unwrapReferenceFromCast(Symbol symbol) {", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMwNzIyNw==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439307227", "bodyText": "It is only used to extract primary key columns or columns which generated column expressions are including/targeting to expand queries with the generated column. So the symbol tree will not be changed, the expanded generated column will still take the original comparison into account. Do I maybe miss something?", "author": "seut", "createdAt": "2020-06-12T09:19:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3ODkwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwMTE1Mw==", "url": "https://github.com/crate/crate/pull/10076#discussion_r440001153", "bodyText": "Do I maybe miss something?\n\nNo, thanks for the clarification - I misunderstood what's happening.", "author": "mfussenegger", "createdAt": "2020-06-15T08:10:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3ODkwMg=="}], "type": "inlineReview", "revised_code": null, "revised_code_in_main": {"commit": "5dd03a1a8c28dd41d5d370bc0987c859c5258160", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/expression/symbol/Symbols.java b/server/src/main/java/io/crate/expression/symbol/Symbols.java\nindex cdb0ea18a4..9bc2399927 100644\n--- a/server/src/main/java/io/crate/expression/symbol/Symbols.java\n+++ b/server/src/main/java/io/crate/expression/symbol/Symbols.java\n", "chunk": "@@ -174,7 +179,7 @@ public class Symbols {\n \n     public static Symbol unwrapReferenceFromCast(Symbol symbol) {\n         if (symbol instanceof Function\n-            && CAST_FUNCTION_NAMES.contains(((Function) symbol).info().ident().name())) {\n+            && CAST_FUNCTION_NAMES.contains(((Function) symbol).name())) {\n             return ((Function) symbol).arguments().get(0);\n         }\n         return symbol;\n", "next_change": null}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}, {"oid": "9b6aed02c0664e7df5b67466ee9e1e238fc8677e", "committedDate": "2020-06-24 12:05:30 +0000", "message": "Fix DataType generics"}, {"oid": "28de18fcc33f14c44121d49daedcdcc11caf536f", "committedDate": "2020-06-26 15:55:24 +0000", "message": "Use Signature instead of FunctionIdent/Info"}, {"oid": "5dd03a1a8c28dd41d5d370bc0987c859c5258160", "committedDate": "2020-06-26 15:55:24 +0000", "message": "Replace read usages of deprecated function info"}, {"oid": "a57f3f68feb5665736a1c464b8ebf2c8c22f1106", "committedDate": "2020-07-27 09:29:01 +0000", "message": "Integrate LazyMapList into Lists2"}, {"oid": "571c5c7ce4f2f4e7d98271a70136546fddc3308a", "committedDate": "2020-08-24 15:34:59 +0000", "message": "Prevent the use of aggregations in generated columns"}, {"oid": "ad07b33ce508826071abfab094407b9231525e65", "committedDate": "2021-05-07 09:46:36 +0000", "message": "Update license boilerplates to remove \"Technology\" from company name"}, {"oid": "bb91a8c8a1a022f69c576a7f10aa1c1b07d176d1", "committedDate": "2021-06-23 10:05:45 +0000", "message": "Add a `toColumnType` method to `DataType`"}, {"oid": "5879c1d72f6008d1cf46e21f82db1ace1268215d", "committedDate": "2022-05-30 08:53:08 +0000", "message": "Turn Reference into an Interface"}, {"oid": "e12dc6953dc7de7e61e118dc538fccd00cfa0eee", "committedDate": "2022-05-30 08:53:08 +0000", "message": "Change GeneratedReference to implement Reference instead of SimpleReference"}, {"oid": "0a14cbb95ebf52a0ca547ce530621658fb4730fb", "committedDate": "2022-06-01 09:04:54 +0000", "message": "Avoid array copy operation to generate streamers"}, {"oid": "de1d721e810a7b03486ef7d7a753bf72c70ce8c3", "committedDate": "2022-07-05 09:34:07 +0000", "message": "Remove deprecated FunctionInfo and FunctionIdent"}, {"oid": "fa997316b687127da4dafee5753aa5deb56679ac", "committedDate": "2022-08-16 12:58:12 +0000", "message": "Add limited correlated subquery support"}, {"oid": "5f8a0ae148111db74cf92792b878345416457463", "committedDate": "2023-03-13 14:57:49 +0000", "message": "Use Indexer for replica operation"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3OTcwMA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439079700", "body": "Looks like this is not used yet. Should we remove this + `isEnabled` altogether for now?", "bodyText": "Looks like this is not used yet. Should we remove this + isEnabled altogether for now?", "bodyHTML": "<p dir=\"auto\">Looks like this is not used yet. Should we remove this + <code>isEnabled</code> altogether for now?</p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:27:29Z", "path": "server/src/main/java/io/crate/planner/optimizer/collect/Rule.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.planner.optimizer.collect;\n+\n+import io.crate.expression.symbol.Symbol;\n+import io.crate.metadata.Functions;\n+import io.crate.planner.optimizer.matcher.Captures;\n+import io.crate.planner.optimizer.matcher.Pattern;\n+import org.elasticsearch.Version;\n+\n+public interface Rule<T> {\n+\n+    Pattern<T> pattern();\n+\n+    boolean isEnabled();\n+\n+    void setEnabled(boolean enabled);", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI5MjcxOQ==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439292719", "bodyText": "Right. Maybe we should group all cast rules and expose one session setting to enable/disable all?", "author": "seut", "createdAt": "2020-06-12T08:50:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3OTcwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwMTQ4Mg==", "url": "https://github.com/crate/crate/pull/10076#discussion_r440001482", "bodyText": "Right. Maybe we should group all cast rules and expose one session setting to enable/disable all?\n\nNot sure. I'd leave it out and postpone the decision how to handle this for later.", "author": "mfussenegger", "createdAt": "2020-06-15T08:10:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA3OTcwMA=="}], "type": "inlineReview", "revised_code": {"commit": "597ff9fa442dc639cffd76d3e6f88949086b371b", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/Rule.java b/server/src/main/java/io/crate/planner/optimizer/symbol/Rule.java\nsimilarity index 93%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/Rule.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/Rule.java\nindex 2d3a29ca80..8c9545da85 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/Rule.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/Rule.java\n", "chunk": "@@ -32,10 +32,6 @@ public interface Rule<T> {\n \n     Pattern<T> pattern();\n \n-    boolean isEnabled();\n-\n-    void setEnabled(boolean enabled);\n-\n     Symbol apply(T symbol, Captures captures, Functions functions);\n \n     /**\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/collect/Rule.java b/server/src/main/java/io/crate/planner/optimizer/symbol/Rule.java\nsimilarity index 93%\nrename from server/src/main/java/io/crate/planner/optimizer/collect/Rule.java\nrename to server/src/main/java/io/crate/planner/optimizer/symbol/Rule.java\nindex 2d3a29ca80..8c9545da85 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/collect/Rule.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/Rule.java\n", "chunk": "@@ -32,10 +32,6 @@ public interface Rule<T> {\n \n     Pattern<T> pattern();\n \n-    boolean isEnabled();\n-\n-    void setEnabled(boolean enabled);\n-\n     Symbol apply(T symbol, Captures captures, Functions functions);\n \n     /**\n", "next_change": null}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA4MDQ4NQ==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439080485", "body": "Would `date` be casted to `long` without the explicit timestamp cast?\r\n\r\nHow would something like `date >= '2019-01-01'` behave?", "bodyText": "Would date be casted to long without the explicit timestamp cast?\nHow would something like date >= '2019-01-01' behave?", "bodyHTML": "<p dir=\"auto\">Would <code>date</code> be casted to <code>long</code> without the explicit timestamp cast?</p>\n<p dir=\"auto\">How would something like <code>date &gt;= '2019-01-01'</code> behave?</p>", "author": "mfussenegger", "createdAt": "2020-06-11T21:29:29Z", "path": "server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java", "diffHunk": "@@ -82,7 +82,7 @@ public void testDeleteWhereSysColumn() throws Exception {\n \n     @Test\n     public void testDeleteWherePartitionedByColumn() throws Exception {\n-        AnalyzedDeleteStatement delete = e.analyze(\"delete from parted where date = 1395874800000\");\n+        AnalyzedDeleteStatement delete = e.analyze(\"delete from parted where date = 1395874800000::timestamp\");", "originalCommit": "3efa9b457e875100a2dbf2534202086f68c29177", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI5NDA3OA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439294078", "bodyText": "Would date be casted to long without the explicit timestamp cast?\n\nYes. But the cast optimizer rules would change the cast to 1395874800000::timestamp eventually. I just wanted to avoid changing the assertions in that analyzer test.\n\nHow would something like date >= '2019-01-01' behave?\n\nThe same, cast on date will be replaced afterwards by the cast optimizer rules.", "author": "seut", "createdAt": "2020-06-12T08:53:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA4MDQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI5ODQwNw==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439298407", "bodyText": "I think date::text >= '2019-01-01' has different semantics than date >= '2019-01-01'::timestamp has.\nIf we \"restore\" the later semantics only by the optimization, it's no longer only a performance optimization, but will be required for correct behavior - which I think is bad. We should be able to turn off all optimizations and every query should still return the same results as with the optimizations on.\nFor the numeric cases x::int = 1 or x = 1::long have the same behavior, so I think there it doesn't matter and is okay.\nMaybe we should add additional timestamp, text overloads for the comparison operators?", "author": "mfussenegger", "createdAt": "2020-06-12T09:01:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA4MDQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMxNDYzOA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r439314638", "bodyText": "I think date::text >= '2019-01-01' has different semantics than date >= '2019-01-01'::timestamp has.\n\nYeah right, good point.\n\nMaybe we should add additional timestamp, text overloads for the comparison operators?\n\nYes good idea. Could we then postpone this until the operators are refactored to use the new signature based function registry which easily allow overloads?\nI think adding this overload to the existing (old/deprecated) function resolver maybe tricky.", "author": "seut", "createdAt": "2020-06-12T09:36:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA4MDQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwMTY0MQ==", "url": "https://github.com/crate/crate/pull/10076#discussion_r440001641", "bodyText": "Could we then postpone this until the operators are refactored to use the new signature based function registry which easily allow overloads?\n\nyep", "author": "mfussenegger", "createdAt": "2020-06-15T08:11:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTA4MDQ4NQ=="}], "type": "inlineReview", "revised_code": null, "revised_code_in_main": {"commit": "4c268980ed9469ee71ed2d87caf09442be804049", "changed_code": [{"header": "diff --git a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\nindex 667e6883e1..cee7c0d114 100644\n--- a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n+++ b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n", "chunk": "@@ -82,7 +82,7 @@ public class DeleteAnalyzerTest extends CrateDummyClusterServiceUnitTest {\n \n     @Test\n     public void testDeleteWherePartitionedByColumn() throws Exception {\n-        AnalyzedDeleteStatement delete = e.analyze(\"delete from parted where date = 1395874800000::timestamp\");\n+        AnalyzedDeleteStatement delete = e.analyze(\"delete from parted where date = 1395874800000::timestamptz\");\n         assertThat(delete.query(), isFunction(EqOperator.NAME, isReference(\"date\"), isLiteral(1395874800000L)));\n     }\n \n", "next_change": {"commit": "a9e3d857c43f50c76c782fd8ad5e5bf30257db53", "changed_code": [{"header": "diff --git a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\nindex cee7c0d114..43979afa6a 100644\n--- a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n+++ b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n", "chunk": "@@ -83,7 +87,7 @@ public class DeleteAnalyzerTest extends CrateDummyClusterServiceUnitTest {\n     @Test\n     public void testDeleteWherePartitionedByColumn() throws Exception {\n         AnalyzedDeleteStatement delete = e.analyze(\"delete from parted where date = 1395874800000::timestamptz\");\n-        assertThat(delete.query(), isFunction(EqOperator.NAME, isReference(\"date\"), isLiteral(1395874800000L)));\n+        assertThat(delete.query()).isFunction(EqOperator.NAME, isReference(\"date\"), isLiteral(1395874800000L));\n     }\n \n     @Test\n", "next_change": null}, {"header": "diff --git a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\nindex cee7c0d114..43979afa6a 100644\n--- a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n+++ b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n", "chunk": "@@ -91,8 +95,8 @@ public class DeleteAnalyzerTest extends CrateDummyClusterServiceUnitTest {\n         AnalyzedDeleteStatement expectedStatement = e.analyze(\"delete from users where name='Trillian'\");\n         AnalyzedDeleteStatement actualStatement = e.analyze(\"delete from users as u where u.name='Trillian'\");\n \n-        assertThat(actualStatement.relation().tableInfo(), equalTo(expectedStatement.relation().tableInfo()));\n-        assertThat(actualStatement.query(), equalTo(expectedStatement.query()));\n+        assertThat(actualStatement.relation().tableInfo()).isEqualTo(expectedStatement.relation().tableInfo());\n+        assertThat(actualStatement.query()).isEqualTo(expectedStatement.query());\n     }\n \n     @Test\n", "next_change": {"commit": "105a09c590947d8b196adf55fa41b9822203574f", "changed_code": [{"header": "diff --git a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\nindex 43979afa6a..ab8a636e65 100644\n--- a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n+++ b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n", "chunk": "@@ -101,7 +102,7 @@ public class DeleteAnalyzerTest extends CrateDummyClusterServiceUnitTest {\n \n     @Test\n     public void testWhereClauseObjectArrayField() throws Exception {\n-        expectedException.expect(UnsupportedOperationException.class);\n+        expectedException.expect(UnsupportedFunctionException.class);\n         expectedException.expectMessage(\"Unknown function: (doc.users.friends['id'] = 5),\" +\n                                         \" no overload found for matching argument types: (bigint_array, integer).\");\n         e.analyze(\"delete from users where friends['id'] = 5\");\n", "next_change": {"commit": "2375004ae76d4bb7ab928c5b15a077b994f9c926", "changed_code": [{"header": "diff --git a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\nindex ab8a636e65..84530af382 100644\n--- a/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n+++ b/server/src/test/java/io/crate/analyze/DeleteAnalyzerTest.java\n", "chunk": "@@ -102,10 +103,10 @@ public class DeleteAnalyzerTest extends CrateDummyClusterServiceUnitTest {\n \n     @Test\n     public void testWhereClauseObjectArrayField() throws Exception {\n-        expectedException.expect(UnsupportedFunctionException.class);\n-        expectedException.expectMessage(\"Unknown function: (doc.users.friends['id'] = 5),\" +\n-                                        \" no overload found for matching argument types: (bigint_array, integer).\");\n-        e.analyze(\"delete from users where friends['id'] = 5\");\n+        assertThatThrownBy(() -> e.analyze(\"delete from users where friends['id'] = 5\"))\n+            .isExactlyInstanceOf(UnsupportedFunctionException.class)\n+            .hasMessageStartingWith(\"Unknown function: (doc.users.friends['id'] = 5),\" +\n+                                    \" no overload found for matching argument types: (bigint_array, integer).\");\n     }\n \n     @Test\n", "next_change": null}]}}]}}]}}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}, {"oid": "67ba347bd3ddbd4289aad5c91e0873d515b78578", "committedDate": "2020-06-17 15:02:09 +0000", "message": "Convert all operators to new signature based function registry"}, {"oid": "72246aba81d720d5aa1b56306d9f847f62e2d540", "committedDate": "2020-06-23 14:49:05 +0000", "message": "Improve unknown function error for operators"}, {"oid": "ad07b33ce508826071abfab094407b9231525e65", "committedDate": "2021-05-07 09:46:36 +0000", "message": "Update license boilerplates to remove \"Technology\" from company name"}, {"oid": "4c268980ed9469ee71ed2d87caf09442be804049", "committedDate": "2022-05-30 16:05:39 +0000", "message": "Change timestamp to timestamp without time zone"}, {"oid": "4d15525b3560a4754d725069dad1c43813ffbdd5", "committedDate": "2022-07-06 10:30:59 +0000", "message": "tests: Fix checkstyle warnings"}, {"oid": "da06dceeb3636650f6afcc6f37c54cd2c33ae275", "committedDate": "2022-07-20 15:00:29 +0000", "message": "tests: Import `org.junit.Assert.*` methods"}, {"oid": "c8b770081c742a46a7aac67b1b0d78c480b69590", "committedDate": "2022-09-27 10:00:51 +0000", "message": "tests: Remove deprecated enableDefaultTables"}, {"oid": "a9e3d857c43f50c76c782fd8ad5e5bf30257db53", "committedDate": "2022-10-10 10:08:56 +0000", "message": "tests: Replace Symbol/Relation Matchers with assertj"}, {"oid": "105a09c590947d8b196adf55fa41b9822203574f", "committedDate": "2023-03-08 15:18:14 +0000", "message": "Fix invalid conversions of UnsupportedFeatureExceptions to MissingPrivilegeExceptions"}, {"oid": "2375004ae76d4bb7ab928c5b15a077b994f9c926", "committedDate": "2023-03-31 11:31:51 +0000", "message": "Migrate to assertj"}]}, {"oid": "597ff9fa442dc639cffd76d3e6f88949086b371b", "url": "https://github.com/crate/crate/commit/597ff9fa442dc639cffd76d3e6f88949086b371b", "message": "fixup! Add query optimizer incl. rules for cast optimizations", "committedDate": "2020-06-15T11:23:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE0NTEyMA==", "url": "https://github.com/crate/crate/pull/10076#discussion_r440145120", "body": "```suggestion\r\n    Symbol apply(String name, List<Symbol> arguments);\r\n```\r\n\r\ntypo?", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Symbol apply(String bame, List<Symbol> arguments);\n          \n          \n            \n                Symbol apply(String name, List<Symbol> arguments);\n          \n      \n    \n    \n  \n\ntypo?", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-smi\">Symbol</span> apply(<span class=\"pl-smi\">String</span> <span class=\"x x-first x-last\">bame</span>, <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">Symbol</span>&gt;</span> arguments);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-smi\">Symbol</span> apply(<span class=\"pl-smi\">String</span> <span class=\"x x-first x-last\">name</span>, <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">Symbol</span>&gt;</span> arguments);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">typo?</p>", "author": "mfussenegger", "createdAt": "2020-06-15T12:38:27Z", "path": "server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to Crate under one or more contributor license agreements.\n+ * See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.  Crate licenses this file\n+ * to you under the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.  You may\n+ * obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+ * implied.  See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ *\n+ * However, if you have executed another commercial license agreement\n+ * with Crate these terms will supersede the license and you may use the\n+ * software solely pursuant to the terms of the relevant commercial\n+ * agreement.\n+ */\n+\n+package io.crate.planner.optimizer.symbol;\n+\n+import io.crate.expression.symbol.Symbol;\n+\n+import java.util.List;\n+\n+public interface FunctionSymbolResolver {\n+\n+    Symbol apply(String bame, List<Symbol> arguments);", "originalCommit": "597ff9fa442dc639cffd76d3e6f88949086b371b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE4MDMyMQ==", "url": "https://github.com/crate/crate/pull/10076#discussion_r440180321", "bodyText": "\ud83d\udc4d thx", "author": "seut", "createdAt": "2020-06-15T13:36:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE0NTEyMA=="}], "type": "inlineReview", "revised_code": {"commit": "5fc9a5de52f1036949d3283479d78321e5f3e44e", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java b/server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java\nindex b251e61592..14bedb4b5e 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java\n", "chunk": "@@ -28,5 +28,5 @@ import java.util.List;\n \n public interface FunctionSymbolResolver {\n \n-    Symbol apply(String bame, List<Symbol> arguments);\n+    Symbol apply(String name, List<Symbol> arguments);\n }\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "changed_code": [{"header": "diff --git a/server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java b/server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java\nindex b251e61592..14bedb4b5e 100644\n--- a/server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java\n+++ b/server/src/main/java/io/crate/planner/optimizer/symbol/FunctionSymbolResolver.java\n", "chunk": "@@ -28,5 +28,5 @@ import java.util.List;\n \n public interface FunctionSymbolResolver {\n \n-    Symbol apply(String bame, List<Symbol> arguments);\n+    Symbol apply(String name, List<Symbol> arguments);\n }\n", "next_change": null}]}, "commits_in_main": [{"oid": "9f63a1d9691de9abdfe09c6e49fc5e4a937e589a", "message": "Merge commit", "committedDate": null}, {"oid": "df77bd0147b960da9e905351dc6a8c833c5ac26b", "committedDate": "2021-05-07 09:46:36 +0000", "message": "Update license boilerplates to state company name in full"}]}, {"oid": "5fc9a5de52f1036949d3283479d78321e5f3e44e", "url": "https://github.com/crate/crate/commit/5fc9a5de52f1036949d3283479d78321e5f3e44e", "message": "Add query optimizer incl. rules for cast optimizations\n\nThis replaces the special literal downcast logic inside the deprecated/old\nfunction matching which caused bugs on arithmetics.\n\nThe optimizer runs before creating any `RoutedCollectPhase` while building\nexecution plans and thus only runs once per query.", "committedDate": "2020-06-15T14:43:09Z", "type": "commit"}, {"oid": "5fc9a5de52f1036949d3283479d78321e5f3e44e", "url": "https://github.com/crate/crate/commit/5fc9a5de52f1036949d3283479d78321e5f3e44e", "message": "Add query optimizer incl. rules for cast optimizations\n\nThis replaces the special literal downcast logic inside the deprecated/old\nfunction matching which caused bugs on arithmetics.\n\nThe optimizer runs before creating any `RoutedCollectPhase` while building\nexecution plans and thus only runs once per query.", "committedDate": "2020-06-15T14:43:09Z", "type": "forcePushed"}, {"oid": "ee770ac8a5ecfced944413093bb07fe824715919", "url": "https://github.com/crate/crate/commit/ee770ac8a5ecfced944413093bb07fe824715919", "message": "Merge branch 'master' into s/cast-symbol-optimizer", "committedDate": "2020-06-15T15:17:45Z", "type": "commit"}]}