{"pr_number": 8093, "pr_title": "Fix chunk highlighting issue", "pr_author": "melissa-barca", "pr_createdAt": "2020-10-16T19:02:51Z", "pr_url": "https://github.com/rstudio/rstudio/pull/8093", "timeline": [{"oid": "4b4665a2a7f8ba8103b4d010af4b158fc5ff1c26", "url": "https://github.com/rstudio/rstudio/commit/4b4665a2a7f8ba8103b4d010af4b158fc5ff1c26", "message": "reattach handlers onAttach", "committedDate": "2020-10-16T18:53:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY5NDM3MA==", "url": "https://github.com/rstudio/rstudio/pull/8093#discussion_r506694370", "body": "Should we also remove any existing handlers here as well, just in case? (Since we do initialize handlers in the constructor here: https://github.com/rstudio/rstudio/blob/e2be2eea8c7bf0852bac78034dbddfa5d71be245/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ace/AceBackgroundHighlighter.java#L168-L170)\r\n\r\nOr, maybe we can just remove that initialization and only init in attach / detach as you currently have things?", "bodyText": "Should we also remove any existing handlers here as well, just in case? (Since we do initialize handlers in the constructor here: \n  \n    \n      rstudio/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ace/AceBackgroundHighlighter.java\n    \n    \n        Lines 168 to 170\n      in\n      e2be2ee\n    \n    \n    \n    \n\n        \n          \n           handlers_ = new HandlerRegistrations( \n        \n\n        \n          \n                 editor.addEditorModeChangedHandler(this), \n        \n\n        \n          \n                 editor.addAttachHandler(this)); \n        \n    \n  \n\n)\nOr, maybe we can just remove that initialization and only init in attach / detach as you currently have things?", "bodyHTML": "<p dir=\"auto\">Should we also remove any existing handlers here as well, just in case? (Since we do initialize handlers in the constructor here: <div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rstudio/rstudio/blob/e2be2eea8c7bf0852bac78034dbddfa5d71be245/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ace/AceBackgroundHighlighter.java#L168-L170\">rstudio/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ace/AceBackgroundHighlighter.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 168 to 170\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rstudio/rstudio/commit/e2be2eea8c7bf0852bac78034dbddfa5d71be245\">e2be2ee</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L168\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"168\"></td>\n          <td id=\"LC168\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> handlers_ <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">HandlerRegistrations</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L169\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"169\"></td>\n          <td id=\"LC169\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">       editor<span class=\"pl-k\">.</span>addEditorModeChangedHandler(<span class=\"pl-c1\">this</span>), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L170\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"170\"></td>\n          <td id=\"LC170\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">       editor<span class=\"pl-k\">.</span>addAttachHandler(<span class=\"pl-c1\">this</span>)); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n)</p>\n<p dir=\"auto\">Or, maybe we can just remove that initialization and only init in attach / detach as you currently have things?</p>", "author": "kevinushey", "createdAt": "2020-10-16T20:01:01Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/ace/AceBackgroundHighlighter.java", "diffHunk": "@@ -277,6 +277,18 @@ public void onAttachOrDetach(AttachEvent event)\n             documentChangedHandler_ = null;\n          }\n       }\n+      else\n+      {\n+         handlers_ = new HandlerRegistrations(", "originalCommit": "4b4665a2a7f8ba8103b4d010af4b158fc5ff1c26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc0MDM0Nw==", "url": "https://github.com/rstudio/rstudio/pull/8093#discussion_r506740347", "bodyText": "We can't remove the constructor's initialization because otherwise this function won't be set as the editors' attach handler and doesn't get called. I updated the code to remove handlers regardless of attaching or detaching.", "author": "melissa-barca", "createdAt": "2020-10-16T22:03:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY5NDM3MA=="}], "type": "inlineReview"}, {"oid": "8d432cbedd9892bf08d695bf052460935a55c168", "url": "https://github.com/rstudio/rstudio/commit/8d432cbedd9892bf08d695bf052460935a55c168", "message": "prevent excess handlers", "committedDate": "2020-10-16T22:01:30Z", "type": "commit"}]}