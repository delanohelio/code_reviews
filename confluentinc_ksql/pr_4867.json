{"pr_number": 4867, "pr_title": "fix: avoid long possible format lists on PRINT TOPIC for nulls", "pr_author": "big-andy-coates", "pr_createdAt": "2020-03-23T12:53:49Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4867", "timeline": [{"oid": "c14dfdc0906f4adbc4107f06b9d0f33fdbb053fb", "url": "https://github.com/confluentinc/ksql/commit/c14dfdc0906f4adbc4107f06b9d0f33fdbb053fb", "message": "fix: avoid long possible format lists on PRINT TOPIC for nulls\n\nfixes: https://github.com/confluentinc/ksql/issues/4852\n\nIf processing data with NULL key or values, (generally keys), then PRINT TOPIC would output a long list of possible formats for the key, i.e. ALL the possible formats for the key.  This isn't really very useful.\n\nThe cause was that no data had been processed, so no formats had been rejected.\n\nThis commit changes the behaviour in the situation where no data has been processed to output a shorter message, for example:\n\n```\nksql> print Topic_with_null_keys from beginning;\nKey format: \u00af\\_(\u30c4)_/\u00af - no data processed\nValue format: JSON or KAFKA_STRING\nrowtime: 23/03/20 12:45:33 GMT, key: <null>, value: {\"NAME\": \"bob\"}\n```", "committedDate": "2020-03-23T12:53:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxNzk1NQ==", "url": "https://github.com/confluentinc/ksql/pull/4867#discussion_r396517955", "body": "```suggestion\r\n        return ImmutableList.of(\"\u00af\\\\_(\u30c4)_/\u00af - undetermined key format (no data processed)\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return ImmutableList.of(\"\u00af\\\\_(\u30c4)_/\u00af - no data processed\");\n          \n          \n            \n                    return ImmutableList.of(\"\u00af\\\\_(\u30c4)_/\u00af - undetermined key format (no data processed)\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"238\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">return</span> <span class=\"pl-smi\">ImmutableList</span><span class=\"pl-k\">.</span>of(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>\u00af<span class=\"pl-cce\">\\\\</span>_(\u30c4)_/\u00af - no data processed<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"238\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">return</span> <span class=\"pl-smi\">ImmutableList</span><span class=\"pl-k\">.</span>of(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>\u00af<span class=\"pl-cce\">\\\\</span>_(\u30c4)_/\u00af - <span class=\"x x-first x-last\">undetermined key format (</span>no data processed<span class=\"x x-first x-last\">)</span><span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "agavra", "createdAt": "2020-03-23T15:02:28Z", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/streaming/RecordFormatter.java", "diffHunk": "@@ -232,6 +234,10 @@ private String formatRowTime(final long timestamp) {\n     }\n \n     List<String> getPossibleFormats() {\n+      if (!seenData) {\n+        return ImmutableList.of(\"\u00af\\\\_(\u30c4)_/\u00af - no data processed\");", "originalCommit": "c14dfdc0906f4adbc4107f06b9d0f33fdbb053fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYzMTY4OQ==", "url": "https://github.com/confluentinc/ksql/pull/4867#discussion_r396631689", "bodyText": "Feel strongly about this?", "author": "big-andy-coates", "createdAt": "2020-03-23T17:34:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUxNzk1NQ=="}], "type": "inlineReview"}]}