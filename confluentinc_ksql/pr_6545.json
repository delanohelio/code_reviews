{"pr_number": 6545, "pr_title": "feat: add constraint to deny drop sources referenced by other CREATE_AS sources", "pr_author": "spena", "pr_createdAt": "2020-10-29T19:51:49Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6545", "timeline": [{"oid": "2d54ab3a0dab0f1959f8bcf765fac7b564c33cd8", "url": "https://github.com/confluentinc/ksql/commit/2d54ab3a0dab0f1959f8bcf765fac7b564c33cd8", "message": "feat: add constraint to no drop sources referenced by other CREATE_AS sources", "committedDate": "2020-10-29T14:53:34Z", "type": "commit"}, {"oid": "66be896727054b0e22c0e98c0dcadb8acbc95fc5", "url": "https://github.com/confluentinc/ksql/commit/66be896727054b0e22c0e98c0dcadb8acbc95fc5", "message": "feat: return DROP source constraints from DESCRIBE EXTENDED", "committedDate": "2020-10-29T16:34:37Z", "type": "commit"}, {"oid": "a3d67f2f7829b5cc8926c5d8cdc94db58385daa0", "url": "https://github.com/confluentinc/ksql/commit/a3d67f2f7829b5cc8926c5d8cdc94db58385daa0", "message": "chore: drop sources in order for Rest QTT cleanup methods", "committedDate": "2020-10-29T19:19:08Z", "type": "commit"}, {"oid": "1fc508f810b63c847ef21b4a9dc3146b8e00a040", "url": "https://github.com/confluentinc/ksql/commit/1fc508f810b63c847ef21b4a9dc3146b8e00a040", "message": "chore: fix tests", "committedDate": "2020-10-29T19:34:15Z", "type": "commit"}, {"oid": "1ca7780d3246ecc966d135b993bf46414f86dfe9", "url": "https://github.com/confluentinc/ksql/commit/1ca7780d3246ecc966d135b993bf46414f86dfe9", "message": "chore: add sourceConstraints() to API client", "committedDate": "2020-10-29T20:40:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4NjI0MA==", "url": "https://github.com/confluentinc/ksql/pull/6545#discussion_r516986240", "body": "what happens if we get old response with new CLI and vice versa?", "bodyText": "what happens if we get old response with new CLI and vice versa?", "bodyHTML": "<p dir=\"auto\">what happens if we get old response with new CLI and vice versa?</p>", "author": "agavra", "createdAt": "2020-11-03T22:13:25Z", "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/SourceDescription.java", "diffHunk": "@@ -68,7 +69,9 @@ public SourceDescription(\n       @JsonProperty(\"partitions\") final int partitions,\n       @JsonProperty(\"replication\") final int replication,\n       @JsonProperty(\"statement\") final String statement,\n-      @JsonProperty(\"queryOffsetSummaries\") final List<QueryOffsetSummary> queryOffsetSummaries) {\n+      @JsonProperty(\"queryOffsetSummaries\") final List<QueryOffsetSummary> queryOffsetSummaries,\n+      @JsonProperty(\"sourceConstraints\") final List<String> sourceConstraints", "originalCommit": "66be896727054b0e22c0e98c0dcadb8acbc95fc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY1NDY2Mw==", "url": "https://github.com/confluentinc/ksql/pull/6545#discussion_r517654663", "bodyText": "From an old CLI to the new Server works.\nFrom the new CLI to the old Server doesn't work. But, is this a valid support? And, how do others maintain compatibility with an old Server? I was looking at the code for other properties and I don't see how this is supported. Any idea?", "author": "spena", "createdAt": "2020-11-04T21:57:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4NjI0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY2NTM5MQ==", "url": "https://github.com/confluentinc/ksql/pull/6545#discussion_r517665391", "bodyText": "From an old CLI to the new Server works.\n\nThis one is more important. The other is a nice-to-have. It's not expected to work, but it would be nice if it behaved nicely (either ignoring it or telling you there's an issue). You don't need to implement that for this pr", "author": "agavra", "createdAt": "2020-11-04T22:21:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4NjI0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk5MTI3Mw==", "url": "https://github.com/confluentinc/ksql/pull/6545#discussion_r516991273", "body": "```suggestion\r\n   * Returns a list of sources that have a DROP constraint reference on this source. This source\r\n   * cannot be dropped until all sources returned by this method are deleted.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Returns a list of sources that have a DROP constraint reference on this source. This DROP\n          \n          \n            \n               * constraint does not allow to delete this source after all referenced sources are deleted.\n          \n          \n            \n               * Returns a list of sources that have a DROP constraint reference on this source. This source\n          \n          \n            \n               * cannot be dropped until all sources returned by this method are deleted.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Returns</span> a list of sources that have a <span class=\"pl-c1\">DROP</span> constraint reference on <span class=\"pl-c1\">this</span> source. <span class=\"pl-smi\">This</span> <span class=\"pl-c1 x x-first x-last\">DROP</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">   <span class=\"pl-k\">*</span> <span class=\"x x-first\">constraint does not allow to delete </span><span class=\"pl-c1 x\">this</span><span class=\"x x-last\"> source after all referenced sources</span> are deleted.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Returns</span> a list of sources that have a <span class=\"pl-c1\">DROP</span> constraint reference on <span class=\"pl-c1\">this</span> source. <span class=\"pl-smi\">This</span> <span class=\"x x-first x-last\">source</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"x x-first\">cannot be dropped until all sources returned by </span><span class=\"pl-c1 x\">this</span><span class=\"x x-last\"> method</span> are deleted.</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "agavra", "createdAt": "2020-11-03T22:24:58Z", "path": "ksqldb-api-client/src/main/java/io/confluent/ksql/api/client/SourceDescription.java", "diffHunk": "@@ -85,4 +85,11 @@\n    */\n   String sqlStatement();\n \n+  /**\n+   * Returns a list of sources that have a DROP constraint reference on this source. This DROP\n+   * constraint does not allow to delete this source after all referenced sources are deleted.", "originalCommit": "1ca7780d3246ecc966d135b993bf46414f86dfe9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "22290faba89a2a6ea23ae25065974d864cde7925", "url": "https://github.com/confluentinc/ksql/commit/22290faba89a2a6ea23ae25065974d864cde7925", "message": "Update comment in SourceDescription\n\nCo-authored-by: Almog Gavra <almog@confluent.io>", "committedDate": "2020-11-04T20:27:16Z", "type": "commit"}, {"oid": "4db49e0dbe63ff579591532e7449458f3c175cf8", "url": "https://github.com/confluentinc/ksql/commit/4db49e0dbe63ff579591532e7449458f3c175cf8", "message": "chore: add recover test to verify DROP will work from an upgrade", "committedDate": "2020-11-04T21:36:40Z", "type": "commit"}]}