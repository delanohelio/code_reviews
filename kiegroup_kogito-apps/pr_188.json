{"pr_number": 188, "pr_title": "KOGITO-1108 [Jobs Service] API to allow updating the callback for a Job", "pr_author": "tiagodolphine", "pr_createdAt": "2020-04-16T20:27:04Z", "pr_url": "https://github.com/kiegroup/kogito-apps/pull/188", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU1MTI5NQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r411551295", "body": "PATCH (like PUT) should target a specific ID, present as a path param.http://restcookbook.com/HTTP%20Methods/patch/", "bodyText": "PATCH (like PUT) should target a specific ID, present as a path param.http://restcookbook.com/HTTP%20Methods/patch/", "bodyHTML": "<p dir=\"auto\">PATCH (like PUT) should target a specific ID, present as a path param.<a href=\"http://restcookbook.com/HTTP%20Methods/patch/\" rel=\"nofollow\">http://restcookbook.com/HTTP%20Methods/patch/</a></p>", "author": "radtriste", "createdAt": "2020-04-20T17:16:14Z", "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +65,17 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(Job job) {", "originalCommit": "03a97a1ea13248a4b03913135f07aa4cf615f915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU5MDQ1OQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r411590459", "bodyText": "yep, I agree, added under the path \"/{id}\"", "author": "tiagodolphine", "createdAt": "2020-04-20T18:16:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU1MTI5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex e18b5db24..a3408cdc8 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -66,11 +67,12 @@ public class JobResource {\n     }\n \n     @PATCH\n+    @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public CompletionStage<ScheduledJob> patch(Job job) {\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(ScheduledJob.builder().job(job).build())\n+        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n                         .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n", "next_change": {"commit": "602130b5faf42dbb43b534ba0171288bb7785709", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex a3408cdc8..464b6cdff 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -67,15 +66,11 @@ public class JobResource {\n     }\n \n     @PATCH\n-    @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+    public CompletionStage<ScheduledJob> patch(Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n-                .thenApply(result -> Optional\n-                        .ofNullable(result)\n-                        .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n+        return jobRepository.merge(ScheduledJob.builder().job(job).build());\n     }\n \n     @DELETE\n", "next_change": {"commit": "d2a4d5321fde4dc716d2b06c55a195d644b391a6", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex 464b6cdff..e18b5db24 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -70,7 +70,10 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(ScheduledJob.builder().job(job).build());\n+        return jobRepository.merge(ScheduledJob.builder().job(job).build())\n+                .thenApply(result -> Optional\n+                        .ofNullable(result)\n+                        .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n     }\n \n     @DELETE\n", "next_change": {"commit": "d0afd13229052f4c1584e68078268f05f13aa69e", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex e18b5db24..b9831e1c6 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -66,10 +67,18 @@ public class JobResource {\n     }\n \n     @PATCH\n+    @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public CompletionStage<ScheduledJob> patch(Job job) {\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n+\n+        //validate parameters for job and id\n+        Optional.ofNullable(job)\n+                .map(Job::getId)\n+                .filter(id::equals)\n+                .orElseThrow(()-> new IllegalArgumentException(\"Job Id must be the same as id on path : \"+  id));\n+\n         return jobRepository.merge(ScheduledJob.builder().job(job).build())\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n", "next_change": {"commit": "ad7ffdbadf168286d543119dcea34d0a0df30ba1", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex b9831e1c6..a3408cdc8 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -72,14 +72,7 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-\n-        //validate parameters for job and id\n-        Optional.ofNullable(job)\n-                .map(Job::getId)\n-                .filter(id::equals)\n-                .orElseThrow(()-> new IllegalArgumentException(\"Job Id must be the same as id on path : \"+  id));\n-\n-        return jobRepository.merge(ScheduledJob.builder().job(job).build())\n+        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n                         .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n", "next_change": {"commit": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex a3408cdc8..3c519e27c 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -72,7 +73,7 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n+        return jobRepository.merge(id, ScheduledJobBuilder.from(job))\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n                         .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n", "next_change": null}]}}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk4Mzg5Mw==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r411983893", "body": "This should not be needed on a patch.\r\nthe job structure contains only the fields which need to be updated\r\nso id is not present in it", "bodyText": "This should not be needed on a patch.\nthe job structure contains only the fields which need to be updated\nso id is not present in it", "bodyHTML": "<p dir=\"auto\">This should not be needed on a patch.<br>\nthe job structure contains only the fields which need to be updated<br>\nso id is not present in it</p>", "author": "radtriste", "createdAt": "2020-04-21T08:31:48Z", "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +66,25 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Path(\"/{id}\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+        LOGGER.debug(\"REST patch update {}\", job);\n+\n+        //validate parameters for job and id\n+        Optional.ofNullable(job)", "originalCommit": "ebbf90fa5feb6b688f7444098dd199ef1df6a2af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM4ODQ2Mw==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420388463", "bodyText": "updated", "author": "tiagodolphine", "createdAt": "2020-05-05T20:33:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk4Mzg5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex b9831e1c6..a3408cdc8 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -72,14 +72,7 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-\n-        //validate parameters for job and id\n-        Optional.ofNullable(job)\n-                .map(Job::getId)\n-                .filter(id::equals)\n-                .orElseThrow(()-> new IllegalArgumentException(\"Job Id must be the same as id on path : \"+  id));\n-\n-        return jobRepository.merge(ScheduledJob.builder().job(job).build())\n+        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n                         .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n", "next_change": {"commit": "602130b5faf42dbb43b534ba0171288bb7785709", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex a3408cdc8..464b6cdff 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -67,15 +66,11 @@ public class JobResource {\n     }\n \n     @PATCH\n-    @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+    public CompletionStage<ScheduledJob> patch(Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n-                .thenApply(result -> Optional\n-                        .ofNullable(result)\n-                        .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n+        return jobRepository.merge(ScheduledJob.builder().job(job).build());\n     }\n \n     @DELETE\n", "next_change": {"commit": "d2a4d5321fde4dc716d2b06c55a195d644b391a6", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex 464b6cdff..e18b5db24 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -70,7 +70,10 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(ScheduledJob.builder().job(job).build());\n+        return jobRepository.merge(ScheduledJob.builder().job(job).build())\n+                .thenApply(result -> Optional\n+                        .ofNullable(result)\n+                        .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n     }\n \n     @DELETE\n", "next_change": {"commit": "d0afd13229052f4c1584e68078268f05f13aa69e", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex e18b5db24..b9831e1c6 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -66,10 +67,18 @@ public class JobResource {\n     }\n \n     @PATCH\n+    @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public CompletionStage<ScheduledJob> patch(Job job) {\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n+\n+        //validate parameters for job and id\n+        Optional.ofNullable(job)\n+                .map(Job::getId)\n+                .filter(id::equals)\n+                .orElseThrow(()-> new IllegalArgumentException(\"Job Id must be the same as id on path : \"+  id));\n+\n         return jobRepository.merge(ScheduledJob.builder().job(job).build())\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n", "next_change": {"commit": "ad7ffdbadf168286d543119dcea34d0a0df30ba1", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex b9831e1c6..a3408cdc8 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -72,14 +72,7 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-\n-        //validate parameters for job and id\n-        Optional.ofNullable(job)\n-                .map(Job::getId)\n-                .filter(id::equals)\n-                .orElseThrow(()-> new IllegalArgumentException(\"Job Id must be the same as id on path : \"+  id));\n-\n-        return jobRepository.merge(ScheduledJob.builder().job(job).build())\n+        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n                         .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n", "next_change": {"commit": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex a3408cdc8..3c519e27c 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -72,7 +73,7 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n+        return jobRepository.merge(id, ScheduledJobBuilder.from(job))\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n                         .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n", "next_change": null}]}}]}}]}}]}}]}}]}}, {"oid": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "url": "https://github.com/kiegroup/kogito-apps/commit/f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "message": "Use job id on path to apply the patch method and rebase with master", "committedDate": "2020-05-05T20:32:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyOTAwNQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420629005", "body": "`ScheduledJob.builder().job(job).build()`\r\ncould we have something like `ScheduledJob.from(job)` instead that is hiding this implementation ?", "bodyText": "ScheduledJob.builder().job(job).build()\ncould we have something like ScheduledJob.from(job) instead that is hiding this implementation ?", "bodyHTML": "<p dir=\"auto\"><code>ScheduledJob.builder().job(job).build()</code><br>\ncould we have something like <code>ScheduledJob.from(job)</code> instead that is hiding this implementation ?</p>", "author": "radtriste", "createdAt": "2020-05-06T08:36:42Z", "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +66,18 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Path(\"/{id}\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+        LOGGER.debug(\"REST patch update {}\", job);\n+        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())", "originalCommit": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAwOTAyNA==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r423009024", "bodyText": "I didn't get, basically, it is building a new instance of ScheduledJob based on a Job, that's a superclass, the approach of using the builder is to keep immutability. The jobRepository is based on ScheduledJob that's why it was necessary.", "author": "tiagodolphine", "createdAt": "2020-05-11T12:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyOTAwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAxNTMxNQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r423015315", "bodyText": "yeah. I was just thinking about creating a direct method ScheduledJob.from(job) instead of the whole ScheduledJob.builder().job(job).build().\nIt would avoid the long line. it is just esthetic I would say", "author": "radtriste", "createdAt": "2020-05-11T12:50:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyOTAwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "602130b5faf42dbb43b534ba0171288bb7785709", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex a3408cdc8..464b6cdff 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -67,15 +66,11 @@ public class JobResource {\n     }\n \n     @PATCH\n-    @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+    public CompletionStage<ScheduledJob> patch(Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n-                .thenApply(result -> Optional\n-                        .ofNullable(result)\n-                        .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n+        return jobRepository.merge(ScheduledJob.builder().job(job).build());\n     }\n \n     @DELETE\n", "next_change": {"commit": "d2a4d5321fde4dc716d2b06c55a195d644b391a6", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex 464b6cdff..e18b5db24 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -70,7 +70,10 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(ScheduledJob.builder().job(job).build());\n+        return jobRepository.merge(ScheduledJob.builder().job(job).build())\n+                .thenApply(result -> Optional\n+                        .ofNullable(result)\n+                        .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n     }\n \n     @DELETE\n", "next_change": {"commit": "d0afd13229052f4c1584e68078268f05f13aa69e", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex e18b5db24..b9831e1c6 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -66,10 +67,18 @@ public class JobResource {\n     }\n \n     @PATCH\n+    @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public CompletionStage<ScheduledJob> patch(Job job) {\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n+\n+        //validate parameters for job and id\n+        Optional.ofNullable(job)\n+                .map(Job::getId)\n+                .filter(id::equals)\n+                .orElseThrow(()-> new IllegalArgumentException(\"Job Id must be the same as id on path : \"+  id));\n+\n         return jobRepository.merge(ScheduledJob.builder().job(job).build())\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n", "next_change": {"commit": "ad7ffdbadf168286d543119dcea34d0a0df30ba1", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex b9831e1c6..a3408cdc8 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -72,14 +72,7 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-\n-        //validate parameters for job and id\n-        Optional.ofNullable(job)\n-                .map(Job::getId)\n-                .filter(id::equals)\n-                .orElseThrow(()-> new IllegalArgumentException(\"Job Id must be the same as id on path : \"+  id));\n-\n-        return jobRepository.merge(ScheduledJob.builder().job(job).build())\n+        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n                         .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n", "next_change": {"commit": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\nindex a3408cdc8..3c519e27c 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java\n", "chunk": "@@ -72,7 +73,7 @@ public class JobResource {\n     @Consumes(MediaType.APPLICATION_JSON)\n     public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n         LOGGER.debug(\"REST patch update {}\", job);\n-        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())\n+        return jobRepository.merge(id, ScheduledJobBuilder.from(job))\n                 .thenApply(result -> Optional\n                         .ofNullable(result)\n                         .orElseThrow(() -> new NotFoundException(\"Job not found \" + job)));\n", "next_change": null}]}}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYzMTI5MA==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420631290", "body": "could we have that on one line ?\r\nmake it in fact hard to read like that whereas it is a simple thing...", "bodyText": "could we have that on one line ?\nmake it in fact hard to read like that whereas it is a simple thing...", "bodyHTML": "<p dir=\"auto\">could we have that on one line ?<br>\nmake it in fact hard to read like that whereas it is a simple thing...</p>", "author": "radtriste", "createdAt": "2020-05-06T08:40:47Z", "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java", "diffHunk": "@@ -66,4 +69,23 @@ public BaseReactiveJobRepository(Vertx vertx, JobStreams jobStreams) {\n         return delete(job.getId())\n                 .thenApply(j -> jobStreams.publishJobStatusChange(job));\n     }\n+\n+    @Override\n+    public CompletionStage<ScheduledJob> merge(String id, ScheduledJob job) {\n+        return Optional.ofNullable(id)\n+                .filter(StringUtils::isNotBlank)\n+                .filter(s -> StringUtils.isBlank(job.getId()) || s.equals(job.getId()))\n+                .map(s -> get(s)\n+                        .thenApply(Optional::ofNullable)\n+                        .thenApply(current -> current\n+                                .map(j -> ScheduledJob", "originalCommit": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc1NDQ4OQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420754489", "bodyText": "I reformatted the method extracting the merge operation into a new method, take a look it is now more clear IMO.", "author": "tiagodolphine", "createdAt": "2020-05-06T12:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYzMTI5MA=="}], "type": "inlineReview", "revised_code": {"commit": "602130b5faf42dbb43b534ba0171288bb7785709", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\nindex ed6b5d412..8a5e41f23 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\n", "chunk": "@@ -71,21 +69,13 @@ public abstract class BaseReactiveJobRepository implements ReactiveJobRepository\n     }\n \n     @Override\n-    public CompletionStage<ScheduledJob> merge(String id, ScheduledJob job) {\n-        return Optional.ofNullable(id)\n-                .filter(StringUtils::isNotBlank)\n-                .filter(s -> StringUtils.isBlank(job.getId()) || s.equals(job.getId()))\n-                .map(s -> get(s)\n-                        .thenApply(Optional::ofNullable)\n-                        .thenApply(current -> current\n-                                .map(j -> ScheduledJob\n-                                        .builder()\n-                                        .of(j)\n-                                        .merge(job)\n-                                        .build()))\n-                        .thenCompose(j -> j\n-                                .map(this::save)\n-                                .orElse(CompletableFuture.completedFuture(null))))\n-                .orElseThrow(() -> new IllegalArgumentException(\"Id is empty or not equals to Job.id : \" + id));\n+    public CompletionStage<ScheduledJob> merge(ScheduledJob job) {\n+        return get(job.getId())\n+                .thenApply(current -> ScheduledJob\n+                        .builder()\n+                        .of(current)\n+                        .merge(job)\n+                        .build())\n+                .thenCompose(this::save);\n     }\n }\n", "next_change": {"commit": "d2a4d5321fde4dc716d2b06c55a195d644b391a6", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\nindex 8a5e41f23..ae8d50c05 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\n", "chunk": "@@ -71,11 +72,15 @@ public abstract class BaseReactiveJobRepository implements ReactiveJobRepository\n     @Override\n     public CompletionStage<ScheduledJob> merge(ScheduledJob job) {\n         return get(job.getId())\n-                .thenApply(current -> ScheduledJob\n-                        .builder()\n-                        .of(current)\n-                        .merge(job)\n-                        .build())\n-                .thenCompose(this::save);\n+                .thenApply(Optional::ofNullable)\n+                .thenApply(current -> current\n+                        .map(j -> ScheduledJob\n+                                .builder()\n+                                .of(j)\n+                                .merge(job)\n+                                .build()))\n+                .thenCompose(j -> j\n+                        .map(this::save)\n+                        .orElse(CompletableFuture.completedFuture(null)));\n     }\n }\n", "next_change": {"commit": "ad7ffdbadf168286d543119dcea34d0a0df30ba1", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\nindex ae8d50c05..ed6b5d412 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\n", "chunk": "@@ -70,17 +71,21 @@ public abstract class BaseReactiveJobRepository implements ReactiveJobRepository\n     }\n \n     @Override\n-    public CompletionStage<ScheduledJob> merge(ScheduledJob job) {\n-        return get(job.getId())\n-                .thenApply(Optional::ofNullable)\n-                .thenApply(current -> current\n-                        .map(j -> ScheduledJob\n-                                .builder()\n-                                .of(j)\n-                                .merge(job)\n-                                .build()))\n-                .thenCompose(j -> j\n-                        .map(this::save)\n-                        .orElse(CompletableFuture.completedFuture(null)));\n+    public CompletionStage<ScheduledJob> merge(String id, ScheduledJob job) {\n+        return Optional.ofNullable(id)\n+                .filter(StringUtils::isNotBlank)\n+                .filter(s -> StringUtils.isBlank(job.getId()) || s.equals(job.getId()))\n+                .map(s -> get(s)\n+                        .thenApply(Optional::ofNullable)\n+                        .thenApply(current -> current\n+                                .map(j -> ScheduledJob\n+                                        .builder()\n+                                        .of(j)\n+                                        .merge(job)\n+                                        .build()))\n+                        .thenCompose(j -> j\n+                                .map(this::save)\n+                                .orElse(CompletableFuture.completedFuture(null))))\n+                .orElseThrow(() -> new IllegalArgumentException(\"Id is empty or not equals to Job.id : \" + id));\n     }\n }\n", "next_change": {"commit": "dd2640abd6b5bdf2b51432ee0531c0dd7d557cb9", "changed_code": [{"header": "diff --git a/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java b/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\nindex ed6b5d412..de28de6f6 100644\n--- a/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\n+++ b/jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java\n", "chunk": "@@ -71,21 +71,23 @@ public abstract class BaseReactiveJobRepository implements ReactiveJobRepository\n     }\n \n     @Override\n-    public CompletionStage<ScheduledJob> merge(String id, ScheduledJob job) {\n+    public CompletionStage<ScheduledJob> merge(String id, ScheduledJob jobToMerge) {\n         return Optional.ofNullable(id)\n+                //do validations\n                 .filter(StringUtils::isNotBlank)\n-                .filter(s -> StringUtils.isBlank(job.getId()) || s.equals(job.getId()))\n-                .map(s -> get(s)\n+                .filter(s -> StringUtils.isBlank(jobToMerge.getId()) || s.equals(jobToMerge.getId()))\n+                //perform merge\n+                .map(jobId -> this.get(jobId)\n                         .thenApply(Optional::ofNullable)\n-                        .thenApply(current -> current\n-                                .map(j -> ScheduledJob\n-                                        .builder()\n-                                        .of(j)\n-                                        .merge(job)\n-                                        .build()))\n-                        .thenCompose(j -> j\n-                                .map(this::save)\n-                                .orElse(CompletableFuture.completedFuture(null))))\n+                        .thenApply(j -> j.map(currentJob -> doMerge(jobToMerge, currentJob)))\n+                        .thenCompose(j -> j.map(this::save).orElse(CompletableFuture.completedFuture(null))))//save it\n                 .orElseThrow(() -> new IllegalArgumentException(\"Id is empty or not equals to Job.id : \" + id));\n     }\n+\n+    private ScheduledJob doMerge(ScheduledJob toMerge, ScheduledJob current) {\n+        return ScheduledJob.builder()\n+                .of(current)\n+                .merge(toMerge)\n+                .build();\n+    }\n }\n", "next_change": null}]}}]}}]}}]}}, {"oid": "602130b5faf42dbb43b534ba0171288bb7785709", "url": "https://github.com/kiegroup/kogito-apps/commit/602130b5faf42dbb43b534ba0171288bb7785709", "message": "KOGITO-1108 [Jobs Service] API to allow updating the callback for a Job", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "d2a4d5321fde4dc716d2b06c55a195d644b391a6", "url": "https://github.com/kiegroup/kogito-apps/commit/d2a4d5321fde4dc716d2b06c55a195d644b391a6", "message": "Handle job not found on merge", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "d0afd13229052f4c1584e68078268f05f13aa69e", "url": "https://github.com/kiegroup/kogito-apps/commit/d0afd13229052f4c1584e68078268f05f13aa69e", "message": "Inserting id on the patch path", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "ad7ffdbadf168286d543119dcea34d0a0df30ba1", "url": "https://github.com/kiegroup/kogito-apps/commit/ad7ffdbadf168286d543119dcea34d0a0df30ba1", "message": "Use job id on path to apply the patch method and rebase with master", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "dd2640abd6b5bdf2b51432ee0531c0dd7d557cb9", "url": "https://github.com/kiegroup/kogito-apps/commit/dd2640abd6b5bdf2b51432ee0531c0dd7d557cb9", "message": "Reformatting merge method on BaseReactiveJobRepository", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "url": "https://github.com/kiegroup/kogito-apps/commit/03e959bdf786efc2da5160adf761f0bbfa1edbaf", "message": "Adding a helper method to create a ScheduledJob based on Job", "committedDate": "2020-05-11T13:12:42Z", "type": "commit"}, {"oid": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "url": "https://github.com/kiegroup/kogito-apps/commit/03e959bdf786efc2da5160adf761f0bbfa1edbaf", "message": "Adding a helper method to create a ScheduledJob based on Job", "committedDate": "2020-05-11T13:12:42Z", "type": "forcePushed"}]}