{"pr_number": 1631, "pr_title": "Entity, DAO and Service for Faceted Search Classification", "pr_author": "PenghaiZhang", "pr_createdAt": "2020-04-22T05:14:28Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1631", "merge_commit": "bf3ad59d6c074499910e54963fe21e214c5b6c23", "timeline": [{"oid": "6be2ee93c8cf5ed0bdb911cb187b4d7f561e9a9a", "url": "https://github.com/openequella/openEQUELLA/commit/6be2ee93c8cf5ed0bdb911cb187b4d7f561e9a9a", "message": "Entity, DAO and Service for the Faceted Search Classification.\n\nSupport create, retrieve, update and delete one Faceted Search Classification,\nand retrieve all classifications.", "committedDate": "2020-04-22T05:10:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NjA0NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r412676044", "body": "I am not sure if `maxResults` and `orderIndex` can be null or not so at the moment I assume they could be null.", "bodyText": "I am not sure if maxResults and orderIndex can be null or not so at the moment I assume they could be null.", "bodyHTML": "<p dir=\"auto\">I am not sure if <code>maxResults</code> and <code>orderIndex</code> can be null or not so at the moment I assume they could be null.</p>", "author": "PenghaiZhang", "createdAt": "2020-04-22T05:16:11Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.tle.core.facetedsearch.bean;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import java.util.Date;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n+import org.hibernate.annotations.AccessType;\n+\n+@Entity\n+@AccessType(\"field\")\n+public class FacetedSearchClassification {\n+  @Id\n+  @GeneratedValue(strategy = GenerationType.AUTO)\n+  private long id;\n+\n+  @Column(nullable = false)\n+  private long institutionId;\n+\n+  @Column @JsonIgnore private Date dateCreated;\n+\n+  @Column @JsonIgnore private Date dateModified;\n+\n+  @Column(nullable = false)\n+  private String name;\n+\n+  @Column(nullable = false)\n+  private String schemaNode;\n+\n+  private int maxResults;\n+\n+  private int orderIndex;", "originalCommit": "6be2ee93c8cf5ed0bdb911cb187b4d7f561e9a9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY5MTczNg==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r412691736", "bodyText": "Yeah, we can start there.", "author": "edalex-ian", "createdAt": "2020-04-22T05:58:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NjA0NA=="}], "type": "inlineReview", "revised_code": {"commit": "f3c6297d3ed006032abd7c3b0c9ba4e01e7717f7", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java\nindex 82a2ed39d..b93fcadde 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java\n", "chunk": "@@ -33,16 +41,12 @@ public class FacetedSearchClassification {\n \n   private int orderIndex;\n \n-  public long getId() {\n-    return id;\n+  public void setInstitution(Institution institution) {\n+    this.institution = institution;\n   }\n \n-  public void setId(long id) {\n-    this.id = id;\n-  }\n-\n-  public void setInstitution_id(long institutionId) {\n-    this.institutionId = institutionId;\n+  public long getId() {\n+    return id;\n   }\n \n   public Date getDateCreated() {\n", "next_change": null}]}}, {"oid": "4943816e15b3882201799882c0f7f985dfcd1d6b", "url": "https://github.com/openequella/openEQUELLA/commit/4943816e15b3882201799882c0f7f985dfcd1d6b", "message": "Remove the setter of id", "committedDate": "2020-04-22T05:48:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY4MTA0MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r412681041", "body": "I don't see any need to ignore these - and I can see some cases where it could be useful (such as `dateModified` indicating currency - unless we have ETags setup).", "bodyText": "I don't see any need to ignore these - and I can see some cases where it could be useful (such as dateModified indicating currency - unless we have ETags setup).", "bodyHTML": "<p dir=\"auto\">I don't see any need to ignore these - and I can see some cases where it could be useful (such as <code>dateModified</code> indicating currency - unless we have ETags setup).</p>", "author": "edalex-ian", "createdAt": "2020-04-22T05:30:32Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.tle.core.facetedsearch.bean;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import java.util.Date;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n+import org.hibernate.annotations.AccessType;\n+\n+@Entity\n+@AccessType(\"field\")\n+public class FacetedSearchClassification {\n+  @Id\n+  @GeneratedValue(strategy = GenerationType.AUTO)\n+  private long id;\n+\n+  @Column(nullable = false)\n+  private long institutionId;\n+\n+  @Column @JsonIgnore private Date dateCreated;\n+\n+  @Column @JsonIgnore private Date dateModified;", "originalCommit": "6be2ee93c8cf5ed0bdb911cb187b4d7f561e9a9a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f3c6297d3ed006032abd7c3b0c9ba4e01e7717f7", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java\nindex 82a2ed39d..b93fcadde 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/bean/FacetedSearchClassification.java\n", "chunk": "@@ -16,12 +21,15 @@ public class FacetedSearchClassification {\n   @GeneratedValue(strategy = GenerationType.AUTO)\n   private long id;\n \n-  @Column(nullable = false)\n-  private long institutionId;\n+  @JoinColumn(nullable = false)\n+  @ManyToOne(fetch = FetchType.LAZY)\n+  @Index(name = \"facetSearchClassificationInstitutionIndex\")\n+  @XStreamOmitField\n+  private Institution institution;\n \n-  @Column @JsonIgnore private Date dateCreated;\n+  @Column private Date dateCreated;\n \n-  @Column @JsonIgnore private Date dateModified;\n+  @Column private Date dateModified;\n \n   @Column(nullable = false)\n   private String name;\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY4NTAyNA==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r412685024", "body": "Aren't these redundant? It should be fine to just use the inherited `delete`, `save` and `merge`.", "bodyText": "Aren't these redundant? It should be fine to just use the inherited delete, save and merge.", "bodyHTML": "<p dir=\"auto\">Aren't these redundant? It should be fine to just use the inherited <code>delete</code>, <code>save</code> and <code>merge</code>.</p>", "author": "edalex-ian", "createdAt": "2020-04-22T05:41:20Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.tle.core.facetedsearch.dao;\n+\n+import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n+import com.tle.core.hibernate.dao.GenericDao;\n+import java.util.List;\n+\n+public interface FacetedSearchClassificationDao\n+    extends GenericDao<FacetedSearchClassification, Long> {\n+\n+  FacetedSearchClassification getClassificationById(long id);\n+\n+  List getAllClassifications();\n+\n+  void deleteClassification(FacetedSearchClassification facetedSearchClassification);\n+\n+  void addFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n+\n+  void updateFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);", "originalCommit": "6be2ee93c8cf5ed0bdb911cb187b4d7f561e9a9a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "873e143cc2562b39ddc640bdfc54a68403f8b952", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\nindex b00b2b62e..f7fcab42a 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n", "chunk": "@@ -1,19 +1,7 @@\n package com.tle.core.facetedsearch.dao;\n \n import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n-import com.tle.core.hibernate.dao.GenericDao;\n-import java.util.List;\n+import com.tle.core.hibernate.dao.GenericInstitutionalDao;\n \n public interface FacetedSearchClassificationDao\n-    extends GenericDao<FacetedSearchClassification, Long> {\n-\n-  FacetedSearchClassification getClassificationById(long id);\n-\n-  List getAllClassifications();\n-\n-  void deleteClassification(FacetedSearchClassification facetedSearchClassification);\n-\n-  void addFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n-\n-  void updateFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n-}\n+    extends GenericInstitutionalDao<FacetedSearchClassification, Long> {}\n", "next_change": {"commit": "ad17ca296b9b257cc356977b0a9d02a81d881c59", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\nindex f7fcab42a..e296b2d88 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n", "chunk": "@@ -1,3 +1,21 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n package com.tle.core.facetedsearch.dao;\n \n import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY4NzQzMw==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r412687433", "body": "I wonder if it'd be better to rely on the enumerate methods provided by `GenericInstitutionalDao`?", "bodyText": "I wonder if it'd be better to rely on the enumerate methods provided by GenericInstitutionalDao?", "bodyHTML": "<p dir=\"auto\">I wonder if it'd be better to rely on the enumerate methods provided by <code>GenericInstitutionalDao</code>?</p>", "author": "edalex-ian", "createdAt": "2020-04-22T05:47:56Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.tle.core.facetedsearch.dao;\n+\n+import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n+import com.tle.core.hibernate.dao.GenericDao;\n+import java.util.List;\n+\n+public interface FacetedSearchClassificationDao\n+    extends GenericDao<FacetedSearchClassification, Long> {\n+\n+  FacetedSearchClassification getClassificationById(long id);\n+\n+  List getAllClassifications();", "originalCommit": "6be2ee93c8cf5ed0bdb911cb187b4d7f561e9a9a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "873e143cc2562b39ddc640bdfc54a68403f8b952", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\nindex b00b2b62e..f7fcab42a 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n", "chunk": "@@ -1,19 +1,7 @@\n package com.tle.core.facetedsearch.dao;\n \n import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n-import com.tle.core.hibernate.dao.GenericDao;\n-import java.util.List;\n+import com.tle.core.hibernate.dao.GenericInstitutionalDao;\n \n public interface FacetedSearchClassificationDao\n-    extends GenericDao<FacetedSearchClassification, Long> {\n-\n-  FacetedSearchClassification getClassificationById(long id);\n-\n-  List getAllClassifications();\n-\n-  void deleteClassification(FacetedSearchClassification facetedSearchClassification);\n-\n-  void addFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n-\n-  void updateFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n-}\n+    extends GenericInstitutionalDao<FacetedSearchClassification, Long> {}\n", "next_change": {"commit": "ad17ca296b9b257cc356977b0a9d02a81d881c59", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\nindex f7fcab42a..e296b2d88 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n", "chunk": "@@ -1,3 +1,21 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n package com.tle.core.facetedsearch.dao;\n \n import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY4OTQ1Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r412689452", "body": "I'm surprised this also is provided by one of the base classes, but looks not. However might want to go with the simple `getById` or `findById`.", "bodyText": "I'm surprised this also is provided by one of the base classes, but looks not. However might want to go with the simple getById or findById.", "bodyHTML": "<p dir=\"auto\">I'm surprised this also is provided by one of the base classes, but looks not. However might want to go with the simple <code>getById</code> or <code>findById</code>.</p>", "author": "edalex-ian", "createdAt": "2020-04-22T05:53:08Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.tle.core.facetedsearch.dao;\n+\n+import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n+import com.tle.core.hibernate.dao.GenericDao;\n+import java.util.List;\n+\n+public interface FacetedSearchClassificationDao\n+    extends GenericDao<FacetedSearchClassification, Long> {\n+\n+  FacetedSearchClassification getClassificationById(long id);", "originalCommit": "4943816e15b3882201799882c0f7f985dfcd1d6b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "873e143cc2562b39ddc640bdfc54a68403f8b952", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\nindex b00b2b62e..f7fcab42a 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n", "chunk": "@@ -1,19 +1,7 @@\n package com.tle.core.facetedsearch.dao;\n \n import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n-import com.tle.core.hibernate.dao.GenericDao;\n-import java.util.List;\n+import com.tle.core.hibernate.dao.GenericInstitutionalDao;\n \n public interface FacetedSearchClassificationDao\n-    extends GenericDao<FacetedSearchClassification, Long> {\n-\n-  FacetedSearchClassification getClassificationById(long id);\n-\n-  List getAllClassifications();\n-\n-  void deleteClassification(FacetedSearchClassification facetedSearchClassification);\n-\n-  void addFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n-\n-  void updateFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n-}\n+    extends GenericInstitutionalDao<FacetedSearchClassification, Long> {}\n", "next_change": {"commit": "ad17ca296b9b257cc356977b0a9d02a81d881c59", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\nindex f7fcab42a..e296b2d88 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n", "chunk": "@@ -1,3 +1,21 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n package com.tle.core.facetedsearch.dao;\n \n import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY4OTg1NA==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r412689854", "body": "And although it's not done too often in oEQ, it'd be good to put a JavaDoc on it to say it'll retrieve by `id` within the current institution.", "bodyText": "And although it's not done too often in oEQ, it'd be good to put a JavaDoc on it to say it'll retrieve by id within the current institution.", "bodyHTML": "<p dir=\"auto\">And although it's not done too often in oEQ, it'd be good to put a JavaDoc on it to say it'll retrieve by <code>id</code> within the current institution.</p>", "author": "edalex-ian", "createdAt": "2020-04-22T05:54:10Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.tle.core.facetedsearch.dao;\n+\n+import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n+import com.tle.core.hibernate.dao.GenericDao;\n+import java.util.List;\n+\n+public interface FacetedSearchClassificationDao\n+    extends GenericDao<FacetedSearchClassification, Long> {\n+\n+  FacetedSearchClassification getClassificationById(long id);", "originalCommit": "4943816e15b3882201799882c0f7f985dfcd1d6b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "873e143cc2562b39ddc640bdfc54a68403f8b952", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\nindex b00b2b62e..f7fcab42a 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n", "chunk": "@@ -1,19 +1,7 @@\n package com.tle.core.facetedsearch.dao;\n \n import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n-import com.tle.core.hibernate.dao.GenericDao;\n-import java.util.List;\n+import com.tle.core.hibernate.dao.GenericInstitutionalDao;\n \n public interface FacetedSearchClassificationDao\n-    extends GenericDao<FacetedSearchClassification, Long> {\n-\n-  FacetedSearchClassification getClassificationById(long id);\n-\n-  List getAllClassifications();\n-\n-  void deleteClassification(FacetedSearchClassification facetedSearchClassification);\n-\n-  void addFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n-\n-  void updateFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n-}\n+    extends GenericInstitutionalDao<FacetedSearchClassification, Long> {}\n", "next_change": {"commit": "ad17ca296b9b257cc356977b0a9d02a81d881c59", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\nindex f7fcab42a..e296b2d88 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/dao/FacetedSearchClassificationDao.java\n", "chunk": "@@ -1,3 +1,21 @@\n+/*\n+ * Licensed to The Apereo Foundation under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * The Apereo Foundation licenses this file to you under the Apache License,\n+ * Version 2.0, (the \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at:\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n package com.tle.core.facetedsearch.dao;\n \n import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY5MDMzMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r412690331", "body": "For the method names, no need to use `Classifications` again. It's unnecessarily verbose and is kind of implied on a service dedicated to classifications.", "bodyText": "For the method names, no need to use Classifications again. It's unnecessarily verbose and is kind of implied on a service dedicated to classifications.", "bodyHTML": "<p dir=\"auto\">For the method names, no need to use <code>Classifications</code> again. It's unnecessarily verbose and is kind of implied on a service dedicated to classifications.</p>", "author": "edalex-ian", "createdAt": "2020-04-22T05:55:25Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/service/FacetedSearchClassificationService.java", "diffHunk": "@@ -0,0 +1,16 @@\n+package com.tle.core.facetedsearch.service;\n+\n+import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n+import java.util.List;\n+\n+public interface FacetedSearchClassificationService {", "originalCommit": "4943816e15b3882201799882c0f7f985dfcd1d6b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "873e143cc2562b39ddc640bdfc54a68403f8b952", "changed_code": [{"header": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/service/FacetedSearchClassificationService.java b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/service/FacetedSearchClassificationService.java\nindex e2a7d7973..c7acc047a 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/service/FacetedSearchClassificationService.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/core/facetedsearch/service/FacetedSearchClassificationService.java\n", "chunk": "@@ -4,13 +4,13 @@ import com.tle.core.facetedsearch.bean.FacetedSearchClassification;\n import java.util.List;\n \n public interface FacetedSearchClassificationService {\n-  FacetedSearchClassification getClassificationById(long id);\n+  FacetedSearchClassification getById(long id);\n \n-  List getAllClassifications();\n+  List enumerateAll();\n \n-  void deleteClassification(FacetedSearchClassification facetedSearchClassification);\n+  void delete(FacetedSearchClassification facetedSearchClassification);\n \n-  void addClassification(FacetedSearchClassification facetedSearchClassification);\n+  void add(FacetedSearchClassification facetedSearchClassification);\n \n-  void updateFacetedSearchClassification(FacetedSearchClassification facetedSearchClassification);\n+  void update(FacetedSearchClassification facetedSearchClassification);\n }\n", "next_change": null}]}}, {"oid": "f3c6297d3ed006032abd7c3b0c9ba4e01e7717f7", "url": "https://github.com/openequella/openEQUELLA/commit/f3c6297d3ed006032abd7c3b0c9ba4e01e7717f7", "message": "Remove @JsonIgnore from 'dateCreated' and 'dateModified';\n\nIn order to make the DAO extend GenericInstitutionDao, this entity needs\nfull information of an institution. So replace 'institutionId' with an\ninstance of 'Institution'. The relation should be many-to-one. And when\nexporting an institution, there is no need to export the institution\ninformation together with this entity so add '@XStreamOmitField'.", "committedDate": "2020-04-23T01:57:00Z", "type": "commit"}, {"oid": "873e143cc2562b39ddc640bdfc54a68403f8b952", "url": "https://github.com/openequella/openEQUELLA/commit/873e143cc2562b39ddc640bdfc54a68403f8b952", "message": "All the basic database related methods are already provided by\nGenericInstitutionalDao so remove redundant methods.\n\nRename names of methods of the 'FacetedSearchClassificationService'.\n\nAdd the annotation of Transactional to DML operations.", "committedDate": "2020-04-23T02:06:37Z", "type": "commit"}, {"oid": "61789e12a640ccf0ce4b40a31685f85240e382e2", "url": "https://github.com/openequella/openEQUELLA/commit/61789e12a640ccf0ce4b40a31685f85240e382e2", "message": "Support data migration for the new classification table;\n\nCreate a new Converter to ensure data of classification are imported and\nexported when importing or exporting the institution.", "committedDate": "2020-04-23T02:12:05Z", "type": "commit"}, {"oid": "ad17ca296b9b257cc356977b0a9d02a81d881c59", "url": "https://github.com/openequella/openEQUELLA/commit/ad17ca296b9b257cc356977b0a9d02a81d881c59", "message": "Headers for new files.", "committedDate": "2020-04-23T02:19:58Z", "type": "commit"}, {"oid": "a42cb8eb5bba156dd42d676d048b5fa76aa3f698", "url": "https://github.com/openequella/openEQUELLA/commit/a42cb8eb5bba156dd42d676d048b5fa76aa3f698", "message": "Add 'FacetedSearchClassification' to 'InitialSchema'", "committedDate": "2020-04-23T04:47:03Z", "type": "commit"}, {"oid": "98cae93ad6f8b1cd80faa843e7510b93f86bdf0e", "url": "https://github.com/openequella/openEQUELLA/commit/98cae93ad6f8b1cd80faa843e7510b93f86bdf0e", "message": "Add new endpoints to support create, retrieve, update and delete faceted\nsearch classification;\n\nAdd a method used to validate classification  but limited to name and\nschema node at the moment;\n\nAdd new tests for the new endpoints.", "committedDate": "2020-04-24T00:07:48Z", "type": "commit"}, {"oid": "9501c92a190b58876cf63e13eed427cfe7e9abfc", "url": "https://github.com/openequella/openEQUELLA/commit/9501c92a190b58876cf63e13eed427cfe7e9abfc", "message": "Add the testing json file", "committedDate": "2020-04-24T03:00:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI5NzgzNw==", "url": "https://github.com/openequella/openEQUELLA/pull/1631#discussion_r414297837", "body": "Sees odd to need to use something called `Attachments` for this. Normally you'd just use the `classloader.getResourceAsStream(<filename>)`. But maybe this is the oEQ way?", "bodyText": "Sees odd to need to use something called Attachments for this. Normally you'd just use the classloader.getResourceAsStream(<filename>). But maybe this is the oEQ way?", "bodyHTML": "<p dir=\"auto\">Sees odd to need to use something called <code>Attachments</code> for this. Normally you'd just use the <code>classloader.getResourceAsStream(&lt;filename&gt;)</code>. But maybe this is the oEQ way?</p>", "author": "edalex-ian", "createdAt": "2020-04-24T05:11:56Z", "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/webservices/rest/FacetedSearchClassificationApiTest.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package com.tle.webtests.test.webservices.rest;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import com.tle.common.Pair;\n+import com.tle.webtests.test.files.Attachments;\n+import java.util.List;\n+import org.apache.http.HttpResponse;\n+import org.codehaus.jackson.JsonNode;\n+import org.codehaus.jackson.node.ObjectNode;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+public class FacetedSearchClassificationApiTest extends AbstractRestApiTest {\n+  private static final String OAUTH_CLIENT_ID = \"FacetedSearchApiTestClient\";\n+  private static final String API_PATH = \"api/settings/facetedsearch/classification/\";\n+  private long classificationId;\n+  private ObjectNode validClassification;\n+  private ObjectNode invalidClassification;\n+\n+  private static final String NAME = \"good name\";\n+  private static final String NEW_NAME = \"better name\";\n+  private static final long invalidId = 763311234511L;\n+\n+  @Override\n+  protected void addOAuthClients(List<Pair<String, String>> clients) {\n+    clients.add(new Pair<String, String>(OAUTH_CLIENT_ID, \"AutoTest\"));\n+  }\n+\n+  @BeforeClass\n+  @Override\n+  public void registerClients() throws Exception {\n+    super.registerClients();\n+    JsonNode node = mapper.readTree(Attachments.get(\"facetedsearchclassification.json\"));", "originalCommit": "9501c92a190b58876cf63e13eed427cfe7e9abfc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d3777c6b2718302ec942d59125ee16fd37ed354", "changed_code": [{"header": "diff --git a/autotest/OldTests/src/test/java/com/tle/webtests/test/webservices/rest/FacetedSearchClassificationApiTest.java b/autotest/OldTests/src/test/java/com/tle/webtests/test/webservices/rest/FacetedSearchClassificationApiTest.java\nindex 019a8c089..679e70231 100644\n--- a/autotest/OldTests/src/test/java/com/tle/webtests/test/webservices/rest/FacetedSearchClassificationApiTest.java\n+++ b/autotest/OldTests/src/test/java/com/tle/webtests/test/webservices/rest/FacetedSearchClassificationApiTest.java\n", "chunk": "@@ -31,7 +30,10 @@ public class FacetedSearchClassificationApiTest extends AbstractRestApiTest {\n   @Override\n   public void registerClients() throws Exception {\n     super.registerClients();\n-    JsonNode node = mapper.readTree(Attachments.get(\"facetedsearchclassification.json\"));\n+    JsonNode node =\n+        mapper.readTree(\n+            getClass().getClassLoader().getResource(\"facetedsearchclassification.json\"));\n+\n     validClassification = (ObjectNode) node.get(\"valid\");\n     invalidClassification = (ObjectNode) node.get(\"invalid\");\n   }\n", "next_change": null}]}}, {"oid": "7d3777c6b2718302ec942d59125ee16fd37ed354", "url": "https://github.com/openequella/openEQUELLA/commit/7d3777c6b2718302ec942d59125ee16fd37ed354", "message": "Specify the endpoint path at the top of the file;\n\nCreate a resources folder for 'OldTests';\n\nAdd the new test in Codebuild and Travis.", "committedDate": "2020-04-24T06:57:52Z", "type": "commit"}]}