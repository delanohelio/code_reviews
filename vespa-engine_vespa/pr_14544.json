{"pr_number": 14544, "pr_title": "Jonmv/more doc api parameters", "pr_author": "jonmv", "pr_createdAt": "2020-09-24T19:44:24Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14544", "timeline": [{"oid": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632", "url": "https://github.com/vespa-engine/vespa/commit/bea49fe5bd3f4d02b003617dc8a7b4091ec3a632", "message": "Add DocumentOperationParameters to document session API", "committedDate": "2020-09-24T19:36:31Z", "type": "commit"}, {"oid": "ba878c027385ac2db61dd849d39705c704786f62", "url": "https://github.com/vespa-engine/vespa/commit/ba878c027385ac2db61dd849d39705c704786f62", "message": "Use trace level from parameters, and pass on to Response", "committedDate": "2020-09-24T19:36:38Z", "type": "commit"}, {"oid": "7d280adf22a83d5446153820a42258d352418269", "url": "https://github.com/vespa-engine/vespa/commit/7d280adf22a83d5446153820a42258d352418269", "message": "Use NOT_FOUND in DocumentResponse as well \u2014 as success", "committedDate": "2020-09-24T19:38:03Z", "type": "commit"}, {"oid": "0001e35d02bd576355507d78a44e08514dcc7f0c", "url": "https://github.com/vespa-engine/vespa/commit/0001e35d02bd576355507d78a44e08514dcc7f0c", "message": "Remove _probably_ irrelevant case handling", "committedDate": "2020-09-24T19:38:11Z", "type": "commit"}, {"oid": "08bca580ba37998cc826629e0a11532c51e35131", "url": "https://github.com/vespa-engine/vespa/commit/08bca580ba37998cc826629e0a11532c51e35131", "message": "Update abi spec", "committedDate": "2020-09-24T19:38:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc5MDA3OA==", "url": "https://github.com/vespa-engine/vespa/pull/14544#discussion_r494790078", "body": "```suggestion\r\n     * call will cause one or more {@link DocumentIdResponse} objects to appear within the timeout time of this session.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * call will cause one or more {@link DocumentIdResponse} objects to apprear within the timeout time of this session.\n          \n          \n            \n                 * call will cause one or more {@link DocumentIdResponse} objects to appear within the timeout time of this session.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> call will cause one or more {<span class=\"pl-k\">@link</span> <span class=\"pl-smi\">DocumentIdResponse</span>} objects to <span class=\"x x-first x-last\">apprear</span> within the timeout time of <span class=\"pl-c1\">this</span> session.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> call will cause one or more {<span class=\"pl-k\">@link</span> <span class=\"pl-smi\">DocumentIdResponse</span>} objects to <span class=\"x x-first x-last\">appear</span> within the timeout time of <span class=\"pl-c1\">this</span> session.</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-09-25T07:07:54Z", "path": "documentapi/src/main/java/com/yahoo/documentapi/AsyncSession.java", "diffHunk": "@@ -158,6 +194,23 @@ default Result get(DocumentId id, DocumentProtocol.Priority priority) {\n      * @throws UnsupportedOperationException if this access implementation does not support removal\n      */\n     default Result remove(DocumentId id, DocumentProtocol.Priority priority) {\n+        return remove(id, parameters().withPriority(priority));\n+    }\n+\n+    /**\n+     * <p>Removes a document if it is present. This method returns immediately.</p>\n+     *\n+     * <p>If this result is a success, this\n+     * call will cause one or more {@link DocumentIdResponse} objects to apprear within the timeout time of this session.", "originalCommit": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc5MDUyNg==", "url": "https://github.com/vespa-engine/vespa/pull/14544#discussion_r494790526", "body": "```suggestion\r\n/** \r\n * Optional parameters for a document operation. Immutable class.\r\n *\r\n * @author jonmv \r\n */\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /** Optional parameters for a document operation. Immutable class. */\n          \n          \n            \n            /** \n          \n          \n            \n             * Optional parameters for a document operation. Immutable class.\n          \n          \n            \n             *\n          \n          \n            \n             * @author jonmv \n          \n          \n            \n             */", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-c\"><span class=\"pl-c\">/*</span>* <span class=\"x x-first\">Optional parameters for a document operation. Immutable class. </span><span class=\"pl-c x x-last\">*/</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-c\"><span class=\"pl-c\">/**</span> </span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Optional</span> parameters <span class=\"pl-k\">for</span> a document operation. <span class=\"pl-smi\">Immutable</span> class.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span> <span class=\"pl-k\">@author</span> jonmv </td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*/</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-09-25T07:09:02Z", "path": "documentapi/src/main/java/com/yahoo/documentapi/DocumentOperationParameters.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.yahoo.documentapi;\n+\n+import com.yahoo.document.fieldset.FieldSet;\n+import com.yahoo.document.fieldset.FieldSetRepo;\n+import com.yahoo.documentapi.messagebus.protocol.DocumentProtocol;\n+\n+import java.util.Optional;\n+import java.util.OptionalInt;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+/** Optional parameters for a document operation. Immutable class. */", "originalCommit": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc5MDgwNQ==", "url": "https://github.com/vespa-engine/vespa/pull/14544#discussion_r494790805", "body": "```suggestion\r\n// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\r\npackage com.yahoo.documentapi;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            package com.yahoo.documentapi;\n          \n          \n            \n            // Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n          \n          \n            \n            package com.yahoo.documentapi;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"2\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k x x-first\">package</span><span class=\"x\"> </span><span class=\"pl-smi x\">com.yahoo.documentapi</span><span class=\"x x-last\">;</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"2\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-c\"><span class=\"pl-c x x-first\">//</span><span class=\"x x-last\"> Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"3\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">package</span> <span class=\"pl-smi\">com.yahoo.documentapi</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-09-25T07:09:39Z", "path": "documentapi/src/main/java/com/yahoo/documentapi/DocumentOperationParameters.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.yahoo.documentapi;", "originalCommit": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f52458bedbbd2856eb6170aecebe008f097b7b5b", "url": "https://github.com/vespa-engine/vespa/commit/f52458bedbbd2856eb6170aecebe008f097b7b5b", "message": "Fix javadoc typo\n\nCo-authored-by: Jon Bratseth <bratseth@oath.com>", "committedDate": "2020-09-25T07:22:02Z", "type": "commit"}, {"oid": "db2797a271390eb12be83910402cbc7c540f78f0", "url": "https://github.com/vespa-engine/vespa/commit/db2797a271390eb12be83910402cbc7c540f78f0", "message": "Fix javadoc header\n\nCo-authored-by: Jon Bratseth <bratseth@oath.com>", "committedDate": "2020-09-25T07:22:12Z", "type": "commit"}, {"oid": "5c4cfe18a62db70f25e66b00459e11f573b05b16", "url": "https://github.com/vespa-engine/vespa/commit/5c4cfe18a62db70f25e66b00459e11f573b05b16", "message": "Add copyright header\n\nCo-authored-by: Jon Bratseth <bratseth@oath.com>", "committedDate": "2020-09-25T07:22:22Z", "type": "commit"}]}