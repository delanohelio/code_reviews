{"pr_number": 13050, "pr_title": "add more tracing and debug logging of stemming", "pr_author": "arnej27959", "pr_createdAt": "2020-04-24T08:46:22Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13050", "timeline": [{"oid": "976f28680df424bf028eb12a3f413049c17bf098", "url": "https://github.com/vespa-engine/vespa/commit/976f28680df424bf028eb12a3f413049c17bf098", "message": "add more tracing and debug logging of stemming", "committedDate": "2020-04-24T08:34:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQxODIxNw==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414418217", "body": "```suggestion\r\n            getLogger().log(LogLevel.DEBUG, () -> \"Stem '\"+current.stringValue()+\"' mode \"+index.getStemMode()\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        getLogger().log(LogLevel.DEBUG, \"Stem '\"+current.stringValue()+\"' mode \"+index.getStemMode()\n          \n          \n            \n                        getLogger().log(LogLevel.DEBUG, () -> \"Stem '\"+current.stringValue()+\"' mode \"+index.getStemMode()", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            getLogger()<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">LogLevel</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>DEBUG</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Stem '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>current<span class=\"pl-k\">.</span>stringValue()<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>' mode <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>index<span class=\"pl-k\">.</span>getStemMode()</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            getLogger()<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">LogLevel</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>DEBUG</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Stem '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>current<span class=\"pl-k\">.</span>stringValue()<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>' mode <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>index<span class=\"pl-k\">.</span>getStemMode()</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:07:30Z", "path": "container-search/src/main/java/com/yahoo/prelude/querytransform/StemmingSearcher.java", "diffHunk": "@@ -183,9 +184,20 @@ private Item stem(BlockItem current, StemContext context, Index index) {\n         Substring substring = getOffsets(current);\n \n         if (segments.size() == 1) {\n+            getLogger().log(LogLevel.DEBUG, \"Stem '\"+current.stringValue()+\"' mode \"+index.getStemMode()", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQxOTQ0NQ==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414419445", "body": "```suggestion\r\n            getLogger().log(LogLevel.DEBUG, () -> \"Stem to multiple segments '\"+segment+\"'\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        getLogger().log(LogLevel.DEBUG, \"Stem to multiple segments '\"+segment+\"'\");\n          \n          \n            \n                        getLogger().log(LogLevel.DEBUG, () -> \"Stem to multiple segments '\"+segment+\"'\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            getLogger()<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">LogLevel</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>DEBUG</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Stem to multiple segments '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>segment<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            getLogger()<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">LogLevel</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>DEBUG</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Stem to multiple segments '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>segment<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:09:20Z", "path": "container-search/src/main/java/com/yahoo/prelude/querytransform/StemmingSearcher.java", "diffHunk": "@@ -194,6 +206,7 @@ private Item stem(BlockItem current, StemContext context, Index index) {\n             composite = chooseComposite(current, ((Item) current).getParent(), indexName);\n \n         for (StemList segment : segments) {\n+            getLogger().log(LogLevel.DEBUG, \"Stem to multiple segments '\"+segment+\"'\");", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMDE1Mw==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414420153", "body": "```suggestion\r\n        log.log(Level.FINEST, () -> \"getStemmerForLanguage '\"+language+\"' mode: \"+stemMode);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINEST, \"getStemmerForLanguage '\"+language+\"' mode: \"+stemMode);\n          \n          \n            \n                    log.log(Level.FINEST, () -> \"getStemmerForLanguage '\"+language+\"' mode: \"+stemMode);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>getStemmerForLanguage '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>language<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>' mode: <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>stemMode);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>getStemmerForLanguage '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>language<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>' mode: <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>stemMode);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:10:21Z", "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OpenNlpTokenizer.java", "diffHunk": "@@ -57,6 +60,7 @@ public OpenNlpTokenizer(Normalizer normalizer, Transformer transformer) {\n     }\n \n     private Stemmer getStemmerForLanguage(Language language, StemMode stemMode) {\n+        log.log(Level.FINEST, \"getStemmerForLanguage '\"+language+\"' mode: \"+stemMode);", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMDQyOQ==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414420429", "body": "```suggestion\r\n        log.log(Level.FINEST, () -> \"processToken '\"+token+\"'\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n          \n          \n            \n                    log.log(Level.FINEST, () -> \"processToken '\"+token+\"'\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>processToken '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>processToken '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:10:43Z", "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OpenNlpTokenizer.java", "diffHunk": "@@ -120,13 +124,17 @@ private Stemmer getStemmerForLanguage(Language language, StemMode stemMode) {\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents,\n                                 Stemmer stemmer) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMDYyMA==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414420620", "body": "```suggestion\r\n            log.log(Level.FINEST, () -> \"stem '\"+oldToken+\"' to '\"+token+\"'\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");\n          \n          \n            \n                        log.log(Level.FINEST, () -> \"stem '\"+oldToken+\"' to '\"+token+\"'\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>stem '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>oldToken<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>' to '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>stem '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>oldToken<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>' to '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:11:02Z", "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OpenNlpTokenizer.java", "diffHunk": "@@ -120,13 +124,17 @@ private Stemmer getStemmerForLanguage(Language language, StemMode stemMode) {\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents,\n                                 Stemmer stemmer) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n         token = normalizer.normalize(token);\n         token = LinguisticsCase.toLowerCase(token);\n         if (removeAccents)\n             token = transformer.accentDrop(token, language);\n         if (stemMode != StemMode.NONE) {\n+            String oldToken = token;\n             token = doStemming(token, stemmer);\n+            log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMDgyMg==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414420822", "body": "```suggestion\r\n        log.log(Level.FINEST, () -> \"processed token is: \"+token);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINEST, \"processed token is: \"+token);\n          \n          \n            \n                    log.log(Level.FINEST, () -> \"processed token is: \"+token);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>processed token is: <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>processed token is: <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:11:20Z", "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OpenNlpTokenizer.java", "diffHunk": "@@ -120,13 +124,17 @@ private Stemmer getStemmerForLanguage(Language language, StemMode stemMode) {\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents,\n                                 Stemmer stemmer) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n         token = normalizer.normalize(token);\n         token = LinguisticsCase.toLowerCase(token);\n         if (removeAccents)\n             token = transformer.accentDrop(token, language);\n         if (stemMode != StemMode.NONE) {\n+            String oldToken = token;\n             token = doStemming(token, stemmer);\n+            log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");\n         }\n+        log.log(Level.FINEST, \"processed token is: \"+token);", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMTAzOA==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414421038", "body": "```suggestion\r\n        log.log(Level.FINE, () -> \"guessing language \"+result.get()+\" from input: \"+input);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINE, \"guessing language \"+result.get()+\" from input: \"+input);\n          \n          \n            \n                    log.log(Level.FINE, () -> \"guessing language \"+result.get()+\" from input: \"+input);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINE</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>guessing language <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>result<span class=\"pl-k\">.</span>get()<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span> from input: <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>input);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINE</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>guessing language <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>result<span class=\"pl-k\">.</span>get()<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span> from input: <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>input);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:11:39Z", "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OptimaizeDetector.java", "diffHunk": "@@ -96,6 +99,7 @@ public Language guessLanguage(String input) {\n     private static Language guessLanguageUsingOptimaize(String input) {\n         Optional<LdLocale> result = languageDetector.detect(textObjectFactory.forText(input));\n         if ( ! result.isPresent()) return Language.UNKNOWN;\n+        log.log(Level.FINE, \"guessing language \"+result.get()+\" from input: \"+input);", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMTI3NA==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414421274", "body": "```suggestion\r\n            log.log(Level.FINEST, () -> \"stem '\"+oldToken+\"' to '\"+token+\"'\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");\n          \n          \n            \n                        log.log(Level.FINEST, () -> \"stem '\"+oldToken+\"' to '\"+token+\"'\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>stem '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>oldToken<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>' to '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>stem '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>oldToken<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>' to '<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token<span class=\"pl-k\">+</span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>'<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:11:57Z", "path": "linguistics/src/main/java/com/yahoo/language/simple/SimpleTokenizer.java", "diffHunk": "@@ -64,12 +67,17 @@ public SimpleTokenizer(Normalizer normalizer, Transformer transformer) {\n     }\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n         token = normalizer.normalize(token);\n         token = LinguisticsCase.toLowerCase(token);\n         if (removeAccents)\n             token = transformer.accentDrop(token, language);\n-        if (stemMode != StemMode.NONE)\n+        if (stemMode != StemMode.NONE) {\n+            String oldToken = token;\n             token = stemmer.stem(token);\n+            log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMTM5NA==", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414421394", "body": "```suggestion\r\n        log.log(Level.FINEST, () -> \"processed token is: \"+token);\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINEST, \"processed token is: \"+token);\n          \n          \n            \n                    log.log(Level.FINEST, () -> \"processed token is: \"+token);", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>processed token is: <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        log<span class=\"pl-k\">.</span>log(<span class=\"pl-smi\">Level</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>FINEST</span>, <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span><span class=\"pl-s\"><span class=\"pl-pds\">\"</span>processed token is: <span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">+</span>token);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bratseth", "createdAt": "2020-04-24T09:12:09Z", "path": "linguistics/src/main/java/com/yahoo/language/simple/SimpleTokenizer.java", "diffHunk": "@@ -64,12 +67,17 @@ public SimpleTokenizer(Normalizer normalizer, Transformer transformer) {\n     }\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n         token = normalizer.normalize(token);\n         token = LinguisticsCase.toLowerCase(token);\n         if (removeAccents)\n             token = transformer.accentDrop(token, language);\n-        if (stemMode != StemMode.NONE)\n+        if (stemMode != StemMode.NONE) {\n+            String oldToken = token;\n             token = stemmer.stem(token);\n+            log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");\n+        }\n+        log.log(Level.FINEST, \"processed token is: \"+token);", "originalCommit": "976f28680df424bf028eb12a3f413049c17bf098", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be1fb0d49eead759e69ed224c403cd8ecf5ed84e", "url": "https://github.com/vespa-engine/vespa/commit/be1fb0d49eead759e69ed224c403cd8ecf5ed84e", "message": "Apply suggestions from code review\n\nCo-Authored-By: Jon Bratseth <bratseth@oath.com>", "committedDate": "2020-04-24T09:18:18Z", "type": "commit"}, {"oid": "b1e84e7c2275cf787826e7621934480c7056f142", "url": "https://github.com/vespa-engine/vespa/commit/b1e84e7c2275cf787826e7621934480c7056f142", "message": "variables in lambdas must be final", "committedDate": "2020-04-24T09:29:53Z", "type": "commit"}]}