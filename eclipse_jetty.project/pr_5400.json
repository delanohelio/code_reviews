{"pr_number": 5400, "pr_title": "Add more origin info to quickstart-web.xml elements", "pr_author": "janbartel", "pr_createdAt": "2020-10-06T13:18:56Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5400", "timeline": [{"oid": "87ee2ddaa7a933c69dc828944553da875dfa3a58", "url": "https://github.com/eclipse/jetty.project/commit/87ee2ddaa7a933c69dc828944553da875dfa3a58", "message": "Issue #5360 Add more origin info to quickstart-web.xml elements\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-09-30T13:50:26Z", "type": "commit"}, {"oid": "c6ccc73b60072c53781d5e81ea275338238ae308", "url": "https://github.com/eclipse/jetty.project/commit/c6ccc73b60072c53781d5e81ea275338238ae308", "message": "No idea.", "committedDate": "2020-10-06T12:10:46Z", "type": "commit"}, {"oid": "7c21dfa814ff03590c900f07df318ccff71918f0", "url": "https://github.com/eclipse/jetty.project/commit/7c21dfa814ff03590c900f07df318ccff71918f0", "message": "Merge remote-tracking branch 'origin/jetty-10.0.x' into jetty-10.0.x-5361-origin-in-quickstart", "committedDate": "2020-10-06T12:14:35Z", "type": "commit"}, {"oid": "a3dc2b785b9d0f95225e00c9f891fa18c6b1d174", "url": "https://github.com/eclipse/jetty.project/commit/a3dc2b785b9d0f95225e00c9f891fa18c6b1d174", "message": "Issue #5361 Fix origin generation for ExtraXmlDescriptorProcessor\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-10-06T13:13:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4NDY3MA==", "url": "https://github.com/eclipse/jetty.project/pull/5400#discussion_r503184670", "body": "Can we actually use the `_originAttribute` when precomputing like:\r\n```java\r\norigin = StringUtil.isBlank(_originAttribute)) ? null : (\"  <!-- \" +  _originAttribute + \"=\" + descriptor + \" -->\\n\")\r\n``` \r\nand then the code here can just be:\r\n```suggestion\r\n        if (_origin != null)\r\n```\r\n", "bodyText": "Can we actually use the _originAttribute when precomputing like:\norigin = StringUtil.isBlank(_originAttribute)) ? null : (\"  <!-- \" +  _originAttribute + \"=\" + descriptor + \" -->\\n\")\nand then the code here can just be:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!StringUtil.isBlank(_originAttribute))\n          \n          \n            \n                    if (_origin != null)", "bodyHTML": "<p dir=\"auto\">Can we actually use the <code>_originAttribute</code> when precomputing like:</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"origin = StringUtil.isBlank(_originAttribute)) ? null : (&quot;  &lt;!-- &quot; +  _originAttribute + &quot;=&quot; + descriptor + &quot; --&gt;\\n&quot;)\"><pre>origin <span class=\"pl-k\">=</span> <span class=\"pl-smi\">StringUtil</span><span class=\"pl-k\">.</span>isBlank(_originAttribute)) <span class=\"pl-k\">?</span> <span class=\"pl-c1\">null</span> <span class=\"pl-k\">:</span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>  &lt;!-- <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span>  _originAttribute <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>=<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> descriptor <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span> --&gt;<span class=\"pl-cce\">\\n</span><span class=\"pl-pds\">\"</span></span>)</pre></div>\n<p dir=\"auto\">and then the code here can just be:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (<span class=\"pl-k x x-first\">!</span><span class=\"pl-smi x\">StringUtil</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">isBlank(_originAttribute)</span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">if</span> (<span class=\"x x-first\">_origin </span><span class=\"pl-k x\">!=</span><span class=\"x\"> </span><span class=\"pl-c1 x x-last\">null</span>)</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "gregw", "createdAt": "2020-10-12T10:04:10Z", "path": "jetty-quickstart/src/main/java/org/eclipse/jetty/quickstart/ExtraXmlDescriptorProcessor.java", "diffHunk": "@@ -68,11 +68,19 @@ public void end(WebAppContext context, Descriptor descriptor)\n     {\n     }\n \n+    public void setOriginAttribute(String name)\n+    {\n+        _originAttribute = name;\n+    }\n+    \n     public void saveSnippet(WebAppContext context, Descriptor descriptor, XmlParser.Node node)\n         throws Exception\n     {\n+        //Note: we have to output the origin as a comment field instead of\n+        //as an attribute like the other other elements because\n+        //we are copying these elements _verbatim_ from the descriptor\n         LOG.debug(\"save {}\", node.getTag());\n-        if (_showOrigin)\n+        if (!StringUtil.isBlank(_originAttribute))", "originalCommit": "a3dc2b785b9d0f95225e00c9f891fa18c6b1d174", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4NjEzMg==", "url": "https://github.com/eclipse/jetty.project/pull/5400#discussion_r503186132", "body": "It is good to add the hashCode, but can we do it with with @hex rather than .long\r\n```suggestion\r\n            metaData.setOrigin(String.format(\"%s.filter.mapping@%x\", name, mapping.hashCode()), filterAnnotation, clazz);\r\n```", "bodyText": "It is good to add the hashCode, but can we do it with with @hex rather than .long\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        metaData.setOrigin(name + \".filter.mapping.\" + mapping.hashCode(), filterAnnotation, clazz);\n          \n          \n            \n                        metaData.setOrigin(String.format(\"%s.filter.mapping@%x\", name, mapping.hashCode()), filterAnnotation, clazz);", "bodyHTML": "<p dir=\"auto\">It is good to add the hashCode, but can we do it with with <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/hex/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/hex\">@hex</a> rather than .long</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            metaData<span class=\"pl-k\">.</span>setOrigin(<span class=\"x x-first\">name </span><span class=\"pl-k x\">+</span><span class=\"x\"> </span><span class=\"pl-s\"><span class=\"pl-pds x x-last\">\"</span>.filter.mapping<span class=\"x x-first\">.</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\"> </span><span class=\"pl-k x x-last\">+</span> mapping<span class=\"pl-k\">.</span>hashCode(), filterAnnotation, clazz);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            metaData<span class=\"pl-k\">.</span>setOrigin(<span class=\"pl-smi x x-first\">String</span><span class=\"pl-k x\">.</span><span class=\"x\">format(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x x-last\">%s</span>.filter.mapping<span class=\"x x-first\">@%x</span><span class=\"pl-pds x\">\"</span></span><span class=\"x x-last\">, name,</span> mapping<span class=\"pl-k\">.</span>hashCode(<span class=\"x x-first x-last\">)</span>), filterAnnotation, clazz);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "gregw", "createdAt": "2020-10-12T10:06:43Z", "path": "jetty-annotations/src/main/java/org/eclipse/jetty/annotations/WebFilterAnnotation.java", "diffHunk": "@@ -108,7 +108,7 @@ public void apply()\n \n             FilterMapping mapping = new FilterMapping();\n             mapping.setFilterName(holder.getName());\n-\n+            metaData.setOrigin(name + \".filter.mapping.\" + mapping.hashCode(), filterAnnotation, clazz);", "originalCommit": "a3dc2b785b9d0f95225e00c9f891fa18c6b1d174", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4NjM1Mw==", "url": "https://github.com/eclipse/jetty.project/pull/5400#discussion_r503186353", "bodyText": "hmmm can @ be put into an XML comment???", "author": "gregw", "createdAt": "2020-10-12T10:07:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4NjEzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU0NTE3MQ==", "url": "https://github.com/eclipse/jetty.project/pull/5400#discussion_r504545171", "bodyText": "The origin is used programmatically to determine whether or not we're allowed to add more mappings, change mappings etc. It actually doesn't have anything to do with the output of the \"origin\" attribute for quickstart, which is simply the url of the descriptor that declared the mapping, or the classname of the class with the @webfilter annotation that has a mapping contained in it.\nSo, as the origin is used programmatically, I don't want to fiddle around with pretty-printing it as it makes it more difficult to a) calculate and b) use.", "author": "janbartel", "createdAt": "2020-10-14T09:45:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4NjEzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU4MTU2NQ==", "url": "https://github.com/eclipse/jetty.project/pull/5400#discussion_r504581565", "bodyText": "This is more than pretty printing.   hashCodes are alwayrs reported in hex everywhere else in the code.   If we are ever debugging this, then having the hex rather than the long would be helpful.  Don't care so much about the @ vs the . but the former is more common with hashcodes.\nI don't see how this makes it harder to a) calculate and b) use ?", "author": "gregw", "createdAt": "2020-10-14T10:49:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4NjEzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY3Mjc1NQ==", "url": "https://github.com/eclipse/jetty.project/pull/5400#discussion_r504672755", "bodyText": "Done.", "author": "janbartel", "createdAt": "2020-10-14T13:23:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4NjEzMg=="}], "type": "inlineReview"}, {"oid": "0a1fa009721d644e494387a74ec002b51355775e", "url": "https://github.com/eclipse/jetty.project/commit/0a1fa009721d644e494387a74ec002b51355775e", "message": "Issue #5361 Update after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-10-14T09:42:09Z", "type": "commit"}, {"oid": "59d18801f875139695cdbcdd64f30d95ba682d95", "url": "https://github.com/eclipse/jetty.project/commit/59d18801f875139695cdbcdd64f30d95ba682d95", "message": "Still trying to fix this crlf crap", "committedDate": "2020-10-14T10:10:59Z", "type": "commit"}, {"oid": "94c9a41421e525fa2893b1f73afdbe7dddbdf477", "url": "https://github.com/eclipse/jetty.project/commit/94c9a41421e525fa2893b1f73afdbe7dddbdf477", "message": "Issue #5361 Update after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-10-14T13:08:00Z", "type": "commit"}, {"oid": "ede42877a54c49f4004e21ffaf808fbd0b74a12a", "url": "https://github.com/eclipse/jetty.project/commit/ede42877a54c49f4004e21ffaf808fbd0b74a12a", "message": "Merge remote-tracking branch 'origin/jetty-10.0.x' into jetty-10.0.x-5361-origin-in-quickstart", "committedDate": "2020-10-14T13:22:18Z", "type": "commit"}]}