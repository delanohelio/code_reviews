{"pr_number": 2646, "pr_title": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug", "pr_author": "rohanKanojia", "pr_createdAt": "2020-12-02T16:36:56Z", "pr_url": "https://github.com/fabric8io/kubernetes-client/pull/2646", "timeline": [{"oid": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "url": "https://github.com/fabric8io/kubernetes-client/commit/db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\n+ Fallback to SnakeYAML while deserializing Kubernetes YAML manifests\n+ Refactored SerializationUtils#dumpAsYaml(...) to use SnakeYAML instead\n  of Jackson\n+ Moved `SerializationUtils` to `io.fabric8.kubernetes.client.utils`", "committedDate": "2020-12-02T17:04:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0MTY1NQ==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540041655", "body": "This class (`Yaml`) is not thread safe, should be instantiated for each request.\r\n\r\nnit: it's not a mapper either.\r\n\r\nThe field should be removed. See proposed changes in lines 62-64 for the thread-safety issue.", "bodyText": "This class (Yaml) is not thread safe, should be instantiated for each request.\nnit: it's not a mapper either.\nThe field should be removed. See proposed changes in lines 62-64 for the thread-safety issue.", "bodyHTML": "<p dir=\"auto\">This class (<code>Yaml</code>) is not thread safe, should be instantiated for each request.</p>\n<p dir=\"auto\">nit: it's not a mapper either.</p>\n<p dir=\"auto\">The field should be removed. See proposed changes in lines 62-64 for the thread-safety issue.</p>", "author": "manusa", "createdAt": "2020-12-10T10:12:01Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -46,6 +48,7 @@ private Serialization() { }\n     JSON_MAPPER.registerModule(new JavaTimeModule());\n   }\n   private static final ObjectMapper YAML_MAPPER = new ObjectMapper(new YAMLFactory());\n+  private static final Yaml SNAKE_YAML_MAPPER = new Yaml();", "originalCommit": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDA0MjA4NQ==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540042085", "body": "https://github.com/fabric8io/kubernetes-client/pull/2646/files#r540041655\r\n```suggestion\r\n  public static Yaml newSnakeYaml() {\r\n    return new Yaml();\r\n  }\r\n```", "bodyText": "https://github.com/fabric8io/kubernetes-client/pull/2646/files#r540041655\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public static Yaml snakeYamlMapper() {\n          \n          \n            \n                return SNAKE_YAML_MAPPER;\n          \n          \n            \n              }\n          \n          \n            \n              public static Yaml newSnakeYaml() {\n          \n          \n            \n                return new Yaml();\n          \n          \n            \n              }", "bodyHTML": "<p dir=\"auto\"><a href=\"https://github.com/fabric8io/kubernetes-client/pull/2646/files#r540041655\">https://github.com/fabric8io/kubernetes-client/pull/2646/files#r540041655</a></p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">Yaml</span> <span class=\"x x-first x-last\">snakeYamlMapper</span>() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">return</span> <span class=\"pl-c1 x x-first x-last\">SNAKE_YAML_MAPPER</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">Yaml</span> <span class=\"x x-first x-last\">newSnakeYaml</span>() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">return</span> <span class=\"pl-k x x-first\">new</span><span class=\"x\"> </span><span class=\"pl-smi x\">Yaml</span><span class=\"x x-last\">()</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "manusa", "createdAt": "2020-12-10T10:12:26Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -56,6 +59,10 @@ public static ObjectMapper yamlMapper() {\n     return YAML_MAPPER;\n   }\n \n+  public static Yaml snakeYamlMapper() {\n+    return SNAKE_YAML_MAPPER;\n+  }", "originalCommit": "db4b6ce919cbcdbfb86cbe388b1c536557cd410d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "url": "https://github.com/fabric8io/kubernetes-client/commit/a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object", "committedDate": "2020-12-11T07:02:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc1NDAxNA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2646#discussion_r540754014", "body": "nit: these comments are very redundant", "bodyText": "nit: these comments are very redundant", "bodyHTML": "<p dir=\"auto\">nit: these comments are very redundant</p>", "author": "manusa", "createdAt": "2020-12-11T07:53:33Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/utils/Serialization.java", "diffHunk": "@@ -294,4 +294,21 @@ private static String readSpecFileFromInputStream(InputStream inputStream) {\n       throw new RuntimeException(\"Unable to read InputStream.\" + e);\n     }\n   }\n+\n+  private static <T> T unmarshalYaml(InputStream is, TypeReference<T> type) throws JsonProcessingException {\n+    final Yaml yaml = new Yaml();\n+    // Load YAML into HashMap using SnakeYAML", "originalCommit": "a7d65db4c7f0b70bd9efeb2e7918e87419ff208b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db1923b62b44b774077cf5359b0492ab6eda75bb", "url": "https://github.com/fabric8io/kubernetes-client/commit/db1923b62b44b774077cf5359b0492ab6eda75bb", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object", "committedDate": "2020-12-11T09:18:38Z", "type": "commit"}, {"oid": "db1923b62b44b774077cf5359b0492ab6eda75bb", "url": "https://github.com/fabric8io/kubernetes-client/commit/db1923b62b44b774077cf5359b0492ab6eda75bb", "message": "Fix #2510: Yaml containing aliases rejected due to FasterXML bug\n\nModify the way we deserialize Yaml objects. Load them into raw HashMap\nusing SnakeYAML and then use Jackson to convert them to JSON and finally\nthe required object", "committedDate": "2020-12-11T09:18:38Z", "type": "forcePushed"}]}