{"pr_number": 296, "pr_title": "Fix search errors detection and refactor search tests", "pr_author": "mauriciocolli", "pr_createdAt": "2020-03-21T19:06:19Z", "pr_url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/296", "timeline": [{"oid": "0c27198ba17bc8721fb712fd187dab8153743fdb", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0c27198ba17bc8721fb712fd187dab8153743fdb", "message": "Include errors from child collectors in the search collector", "committedDate": "2020-03-21T18:55:29Z", "type": "commit"}, {"oid": "d72130edae12ff4a85ad18b9957adb8bdef68930", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d72130edae12ff4a85ad18b9957adb8bdef68930", "message": "Always return a new item collector in the search extractor", "committedDate": "2020-03-21T18:55:34Z", "type": "commit"}, {"oid": "9704fc99521959c7abea90d6600dfa1d40de3bca", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/9704fc99521959c7abea90d6600dfa1d40de3bca", "message": "Improve search extractor tests for services", "committedDate": "2020-03-21T18:55:36Z", "type": "commit"}, {"oid": "9b7999fe54c30d77e710c38ca64cea80ba1cbf5c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/9b7999fe54c30d77e710c38ca64cea80ba1cbf5c", "message": "[YouTube] Check if channel item has subscription count in search", "committedDate": "2020-03-21T18:55:37Z", "type": "commit"}, {"oid": "b7f8001a49fd963d008a02e64f7bd8ff1239548b", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/b7f8001a49fd963d008a02e64f7bd8ff1239548b", "message": "[YouTube] Add check for channel items without description in search", "committedDate": "2020-03-21T18:55:38Z", "type": "commit"}, {"oid": "921bf30bb7eedbd0c92843d3471cb2c092ef4754", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/921bf30bb7eedbd0c92843d3471cb2c092ef4754", "message": "[YouTube] Add check for channel items with no video count in search", "committedDate": "2020-03-21T18:55:39Z", "type": "commit"}, {"oid": "04bfa0ec6a01228a6cb0f91177855e94a88f4981", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/04bfa0ec6a01228a6cb0f91177855e94a88f4981", "message": "[PeerTube] Update video used in age limit test (was 404 not found)", "committedDate": "2020-03-21T18:55:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA4OTU1Mg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/296#discussion_r396089552", "body": "Do we really need a `getInfoItemSearchCollector()` function? We don't have one in the other kind of extractors either. Otherwise this PR looks good, however you'll need to do YouTube Music tests as well when that PR gets merged.", "bodyText": "Do we really need a getInfoItemSearchCollector() function? We don't have one in the other kind of extractors either. Otherwise this PR looks good, however you'll need to do YouTube Music tests as well when that PR gets merged.", "bodyHTML": "<p dir=\"auto\">Do we really need a <code>getInfoItemSearchCollector()</code> function? We don't have one in the other kind of extractors either. Otherwise this PR looks good, however you'll need to do YouTube Music tests as well when that PR gets merged.</p>", "author": "wb9688", "createdAt": "2020-03-22T12:45:41Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/search/SearchExtractor.java", "diffHunk": "@@ -31,7 +28,7 @@ public String getSearchString() {\n     public abstract String getSearchSuggestion() throws ParsingException;\n \n     protected InfoItemsSearchCollector getInfoItemSearchCollector() {\n-        return collector;\n+        return new InfoItemsSearchCollector(getService().getServiceId());", "originalCommit": "04bfa0ec6a01228a6cb0f91177855e94a88f4981", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMzc5MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/296#discussion_r396103791", "body": "Here you will need to return `ListExtractor.ITEM_COUNT_UNKNOWN` after #280 is merged", "bodyText": "Here you will need to return ListExtractor.ITEM_COUNT_UNKNOWN after #280 is merged", "bodyHTML": "<p dir=\"auto\">Here you will need to return <code>ListExtractor.ITEM_COUNT_UNKNOWN</code> after <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"577348602\" data-permission-text=\"Title is private\" data-url=\"https://github.com/TeamNewPipe/NewPipeExtractor/issues/280\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/TeamNewPipe/NewPipeExtractor/pull/280/hovercard\" href=\"https://github.com/TeamNewPipe/NewPipeExtractor/pull/280\">#280</a> is merged</p>", "author": "Stypox", "createdAt": "2020-03-22T15:05:39Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeChannelInfoItemExtractor.java", "diffHunk": "@@ -80,7 +86,14 @@ public long getSubscriberCount() throws ParsingException {\n     @Override\n     public long getStreamCount() throws ParsingException {\n         try {\n-            return Long.parseLong(Utils.removeNonDigitCharacters(getTextFromObject(channelInfoItem.getObject(\"videoCountText\"))));\n+            final JsonObject videoCountObject = channelInfoItem.getObject(\"videoCountText\");\n+\n+            if (videoCountObject == null) {\n+                // Video count is not available, channel probably has no public uploads.\n+                return -1;", "originalCommit": "04bfa0ec6a01228a6cb0f91177855e94a88f4981", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwNDM4MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/296#discussion_r396104381", "body": "Use assertThat; maybe omit `CoreMatchers.` and import statically\r\nDo this everywhere you test if a string contains another.\r\n```suggestion\r\n        assertThat(extractor().getUrl(), CoreMatchers.containsString(expectedUrlContains());\r\n```\r\n```suggestion\r\n        assertThat(extractor().getUrl(), containsString(expectedUrlContains());\r\n```", "bodyText": "Use assertThat; maybe omit CoreMatchers. and import statically\nDo this everywhere you test if a string contains another.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final String url = extractor().getUrl();\n          \n          \n            \n                    final String expectedContains = expectedUrlContains();\n          \n          \n            \n            \n          \n          \n            \n                    assertIsSecureUrl(url);\n          \n          \n            \n                    assertTrue(\"Url \\\"\" + url + \"\\\" doesn't contains \\\"\" + expectedContains + \"\\\"\",\n          \n          \n            \n                            url.contains(expectedContains));\n          \n          \n            \n                    assertThat(extractor().getUrl(), CoreMatchers.containsString(expectedUrlContains());\n          \n      \n    \n    \n  \n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final String url = extractor().getUrl();\n          \n          \n            \n                    final String expectedContains = expectedUrlContains();\n          \n          \n            \n            \n          \n          \n            \n                    assertIsSecureUrl(url);\n          \n          \n            \n                    assertTrue(\"Url \\\"\" + url + \"\\\" doesn't contains \\\"\" + expectedContains + \"\\\"\",\n          \n          \n            \n                            url.contains(expectedContains));\n          \n          \n            \n                    assertThat(extractor().getUrl(), containsString(expectedUrlContains());", "bodyHTML": "<p dir=\"auto\">Use assertThat; maybe omit <code>CoreMatchers.</code> and import statically<br>\nDo this everywhere you test if a string contains another.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> url <span class=\"pl-k\">=</span> extractor()<span class=\"pl-k\">.</span>getUrl();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> expectedContains <span class=\"pl-k\">=</span> expectedUrlContains();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        assertIsSecureUrl(url);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        assertTrue(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Url <span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> url <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\\"</span> doesn't contains <span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> expectedContains <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                url<span class=\"pl-k\">.</span>contains(expectedContains));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        assertThat(extractor()<span class=\"pl-k\">.</span>getUrl(), <span class=\"pl-smi\">CoreMatchers</span><span class=\"pl-k\">.</span>containsString(expectedUrlContains());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> url <span class=\"pl-k\">=</span> extractor()<span class=\"pl-k\">.</span>getUrl();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> expectedContains <span class=\"pl-k\">=</span> expectedUrlContains();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        assertIsSecureUrl(url);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        assertTrue(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Url <span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> url <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\\"</span> doesn't contains <span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> expectedContains <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                url<span class=\"pl-k\">.</span>contains(expectedContains));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        assertThat(extractor()<span class=\"pl-k\">.</span>getUrl(), containsString(expectedUrlContains());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Stypox", "createdAt": "2020-03-22T15:11:14Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultExtractorTest.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.Extractor;\n+import org.schabi.newpipe.extractor.StreamingService;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+\n+public abstract class DefaultExtractorTest<T extends Extractor> implements BaseExtractorTest {\n+    public abstract T extractor() throws Exception;\n+\n+    public abstract StreamingService expectedService() throws Exception;\n+    public abstract String expectedName() throws Exception;\n+    public abstract String expectedId() throws Exception;\n+    public abstract String expectedUrlContains() throws Exception;\n+    public abstract String expectedOriginalUrlContains() throws Exception;\n+\n+    @Test\n+    @Override\n+    public void testServiceId() throws Exception {\n+        assertEquals(expectedService().getServiceId(), extractor().getServiceId());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testName() throws Exception {\n+        assertEquals(expectedName(), extractor().getName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testId() throws Exception {\n+        assertEquals(expectedId(), extractor().getId());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUrl() throws Exception {\n+        final String url = extractor().getUrl();\n+        final String expectedContains = expectedUrlContains();\n+\n+        assertIsSecureUrl(url);\n+        assertTrue(\"Url \\\"\" + url + \"\\\" doesn't contains \\\"\" + expectedContains + \"\\\"\",\n+                url.contains(expectedContains));", "originalCommit": "04bfa0ec6a01228a6cb0f91177855e94a88f4981", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1ODk1NQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/296#discussion_r396758955", "bodyText": "Forgot about those, thanks for the reminder, much cleaner!", "author": "mauriciocolli", "createdAt": "2020-03-23T21:10:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwNDM4MQ=="}], "type": "inlineReview"}, {"oid": "c921e5d6a5651186af57ac3bd645c1ee53a3d9f5", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/c921e5d6a5651186af57ac3bd645c1ee53a3d9f5", "message": "Remove unnecessary collector creation function from search extractor", "committedDate": "2020-03-23T21:08:51Z", "type": "commit"}, {"oid": "0a20c53f1a5bad1c35686d19fabce855e4cd747b", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0a20c53f1a5bad1c35686d19fabce855e4cd747b", "message": "Use easier-to-read asserts statements in tests", "committedDate": "2020-03-23T21:08:59Z", "type": "commit"}]}