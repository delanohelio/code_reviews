{"pr_number": 3935, "pr_title": "feat(JOML): migrated Diamond3iIterator ->  Diamond3iIterable", "pr_author": "pollend", "pr_createdAt": "2020-05-05T01:28:59Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3935", "merge_commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "timeline": [{"oid": "3ef616a65a3ebbdc1a2bed776223071a2528bbc4", "url": "https://github.com/MovingBlocks/Terasology/commit/3ef616a65a3ebbdc1a2bed776223071a2528bbc4", "message": "add iterable namespace for Diamond3iIterable/SpiralIterable", "committedDate": "2020-05-05T01:25:11Z", "type": "commit"}, {"oid": "54f0856f5214d81ff62c993d22530383d3ee5e43", "url": "https://github.com/MovingBlocks/Terasology/commit/54f0856f5214d81ff62c993d22530383d3ee5e43", "message": "moved back into math package", "committedDate": "2020-05-05T01:43:41Z", "type": "commit"}, {"oid": "20608166fc0ba88ab3d0830f761bcb33d82951bb", "url": "https://github.com/MovingBlocks/Terasology/commit/20608166fc0ba88ab3d0830f761bcb33d82951bb", "message": "added precondition checks", "committedDate": "2020-05-05T02:20:30Z", "type": "commit"}, {"oid": "da38dbc8d397f0015e46882b57723e86d174bbbc", "url": "https://github.com/MovingBlocks/Terasology/commit/da38dbc8d397f0015e46882b57723e86d174bbbc", "message": "updated javadocs", "committedDate": "2020-05-05T02:27:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE3MDMzMw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422170333", "body": "Message says > 0, but argument validation checks for >= 0.", "bodyText": "Message says > 0, but argument validation checks for >= 0.", "bodyHTML": "<p dir=\"auto\">Message says &gt; 0, but argument validation checks for &gt;= 0.</p>", "author": "kBlaszczyk", "createdAt": "2020-05-08T14:19:31Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef08b782789b8acaec1abc7696aabb77bb072235", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..3d94727e5 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -39,7 +39,7 @@ public final class Diamond3iIterable implements Iterable<Vector3ic> {\n      * @param maxDistance maxDistance away\n      */\n     private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n-        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n         this.origin.set(origin);\n         this.endDistance = maxDistance;\n     }\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -39,7 +39,7 @@ public final class Diamond3iIterable implements Iterable<Vector3ic> {\n      * @param maxDistance maxDistance away\n      */\n     private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n-        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n         this.origin.set(origin);\n         this.endDistance = maxDistance;\n     }\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE3MTcxMw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422171713", "body": "Copy paste error, `startDistance` vs `maxDistance`.", "bodyText": "Copy paste error, startDistance vs maxDistance.", "bodyHTML": "<p dir=\"auto\">Copy paste error, <code>startDistance</code> vs <code>maxDistance</code>.</p>", "author": "kBlaszczyk", "createdAt": "2020-05-08T14:21:58Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef08b782789b8acaec1abc7696aabb77bb072235", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..3d94727e5 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -53,7 +53,7 @@ private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n     private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n         Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n         Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n-        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"startDistance must be >= 0\");\n \n         this.origin.set(origin);\n         this.endDistance = maxDistance;\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -53,7 +53,7 @@ private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n     private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n         Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n         Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n-        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"startDistance must be >= 0\");\n \n         this.origin.set(origin);\n         this.endDistance = maxDistance;\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5MzU4OA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422193588", "body": "The point of the + 1 is to make sure the `endDistance` is always at least 1? But it also messes with the distance provided by the client. The client provides a \"radius distance\" of 10 and will end up with a Diamond3Iterable with endDistance 11. Can you explain the point of this?", "bodyText": "The point of the + 1 is to make sure the endDistance is always at least 1? But it also messes with the distance provided by the client. The client provides a \"radius distance\" of 10 and will end up with a Diamond3Iterable with endDistance 11. Can you explain the point of this?", "bodyHTML": "<p dir=\"auto\">The point of the + 1 is to make sure the <code>endDistance</code> is always at least 1? But it also messes with the distance provided by the client. The client provides a \"radius distance\" of 10 and will end up with a Diamond3Iterable with endDistance 11. Can you explain the point of this?</p>", "author": "kBlaszczyk", "createdAt": "2020-05-08T14:59:49Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+        this.startDistance = startDistance;\n+    }\n+\n+    /**\n+     * solid diamond shape from the center to a radius\n+     * @param origin center of diamond iterator\n+     * @param radius distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder region(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius);\n+    }\n+\n+    /**\n+     * hollow shape with an inner and outer distance to iterate over\n+     * @param origin  center of diamond iterator\n+     * @param start distance to start iterating from\n+     * @param end distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int end) {\n+        return new Diamond3iIterable.Builder(origin, end).start(start);\n+    }\n+\n+    /**\n+     * iterates in a shell that is 1 block wide\n+     * @param origin center of shell\n+     * @param radius distance for 1 block wide shell\n+     */\n+    public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+    }\n+\n+    @Override\n+    public Iterator<Vector3ic> iterator() {\n+        Vector3i pos = new Vector3i();\n+        final int[] level = {this.startDistance};\n+        final int[] offset = {-this.startDistance,0,0};\n+\n+        return new Iterator<Vector3ic>() {\n+            @Override\n+            public boolean hasNext() {\n+                return level[0] < endDistance;\n+            }\n+\n+            @Override\n+            public Vector3ic next() {\n+                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n+                if (offset[2] < 0) {\n+                    offset[2] *= -1;\n+                } else if (offset[1] < 0) {\n+                    offset[1] *= -1;\n+                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                } else {\n+                    offset[1] = -offset[1] + 1;\n+                    if (offset[1] > 0) {\n+                        if (++offset[0] <= level[0]) {\n+                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n+                            offset[2] = 0;\n+                        } else {\n+                            level[0]++;\n+                            offset[0] = -level[0];\n+                            offset[1] = 0;\n+                            offset[2] = 0;\n+                        }\n+                    } else {\n+                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                    }\n+                }\n+                return pos;\n+            }\n+        };\n+    }\n+\n+    public static final class Builder {\n+        private final Vector3ic origin;\n+        private final int endDistance;\n+        private int startDistance = 0;\n+\n+        /**\n+         * Default endDistance starts at 1\n+         * @param origin center region for iterator\n+         * @param endDistance maximums radius\n+         */\n+        private Builder(Vector3ic origin, int endDistance){\n+            this.origin = origin;\n+            this.endDistance = endDistance + 1;", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyMjc3MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422222770", "bodyText": "The way I see it, the +/- 1 confusion can be removed by changing a few things. The unit tests keep functioning.\nI'll add suggestions at the lines that would need to be adjusted, play around with it. Feel free to dismiss and hide these suggestions, the readability gain is not significant (but it makes things more logical).", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:54:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5MzU4OA=="}], "type": "inlineReview", "revised_code": {"commit": "ef08b782789b8acaec1abc7696aabb77bb072235", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..3d94727e5 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -135,13 +135,12 @@ public static final class Builder {\n         private int startDistance = 0;\n \n         /**\n-         * Default endDistance starts at 1\n          * @param origin center region for iterator\n          * @param endDistance maximums radius\n          */\n         private Builder(Vector3ic origin, int endDistance){\n             this.origin = origin;\n-            this.endDistance = endDistance + 1;\n+            this.endDistance = endDistance;\n         }\n \n         /**\n", "next_change": {"commit": "fecb8d11b6784393b8ce2cbfdc7daa15f9ca316f", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex 3d94727e5..ec6335665 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -140,7 +140,7 @@ public static final class Builder {\n          */\n         private Builder(Vector3ic origin, int endDistance){\n             this.origin = origin;\n-            this.endDistance = endDistance;\n+            this.endDistance = endDistance + 1;\n         }\n \n         /**\n", "next_change": null}]}}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -135,7 +135,6 @@ public static final class Builder {\n         private int startDistance = 0;\n \n         /**\n-         * Default endDistance starts at 1\n          * @param origin center region for iterator\n          * @param endDistance maximums radius\n          */\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5NDMzNg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422194336", "body": "I'd prefer the inner class on top, but I'm not sure if we have style guidelines for that.", "bodyText": "I'd prefer the inner class on top, but I'm not sure if we have style guidelines for that.", "bodyHTML": "<p dir=\"auto\">I'd prefer the inner class on top, but I'm not sure if we have style guidelines for that.</p>", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:01:05Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+        this.startDistance = startDistance;\n+    }\n+\n+    /**\n+     * solid diamond shape from the center to a radius\n+     * @param origin center of diamond iterator\n+     * @param radius distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder region(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius);\n+    }\n+\n+    /**\n+     * hollow shape with an inner and outer distance to iterate over\n+     * @param origin  center of diamond iterator\n+     * @param start distance to start iterating from\n+     * @param end distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int end) {\n+        return new Diamond3iIterable.Builder(origin, end).start(start);\n+    }\n+\n+    /**\n+     * iterates in a shell that is 1 block wide\n+     * @param origin center of shell\n+     * @param radius distance for 1 block wide shell\n+     */\n+    public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+    }\n+\n+    @Override\n+    public Iterator<Vector3ic> iterator() {\n+        Vector3i pos = new Vector3i();\n+        final int[] level = {this.startDistance};\n+        final int[] offset = {-this.startDistance,0,0};\n+\n+        return new Iterator<Vector3ic>() {\n+            @Override\n+            public boolean hasNext() {\n+                return level[0] < endDistance;\n+            }\n+\n+            @Override\n+            public Vector3ic next() {\n+                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n+                if (offset[2] < 0) {\n+                    offset[2] *= -1;\n+                } else if (offset[1] < 0) {\n+                    offset[1] *= -1;\n+                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                } else {\n+                    offset[1] = -offset[1] + 1;\n+                    if (offset[1] > 0) {\n+                        if (++offset[0] <= level[0]) {\n+                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n+                            offset[2] = 0;\n+                        } else {\n+                            level[0]++;\n+                            offset[0] = -level[0];\n+                            offset[1] = 0;\n+                            offset[2] = 0;\n+                        }\n+                    } else {\n+                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                    }\n+                }\n+                return pos;\n+            }\n+        };\n+    }\n+\n+    public static final class Builder {", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fe0942f2b6297c68d455ed2231cb3f20ace61349", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..017ed7929 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,26 +102,26 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n-                if (offset[2] < 0) {\n-                    offset[2] *= -1;\n-                } else if (offset[1] < 0) {\n-                    offset[1] *= -1;\n-                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);\n+                if (offset.z < 0) {\n+                    offset.z *= -1;\n+                } else if (offset.y() < 0) {\n+                    offset.y *= -1;\n+                    offset.z = -(level[0] - TeraMath.fastAbs(offset.x()) - TeraMath.fastAbs(offset.y()));\n                 } else {\n-                    offset[1] = -offset[1] + 1;\n-                    if (offset[1] > 0) {\n-                        if (++offset[0] <= level[0]) {\n-                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n-                            offset[2] = 0;\n+                    offset.y = -offset.y() + 1;\n+                    if (offset.y > 0) {\n+                        if (++offset.x <= level[0]) {\n+                            offset.y = TeraMath.fastAbs(offset.x) - level[0];\n+                            offset.z = 0;\n                         } else {\n                             level[0]++;\n-                            offset[0] = -level[0];\n-                            offset[1] = 0;\n-                            offset[2] = 0;\n+                            offset.x = -level[0];\n+                            offset.y = 0;\n+                            offset.z = 0;\n                         }\n                     } else {\n-                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                        offset.z = -(level[0] - TeraMath.fastAbs(offset.x) - TeraMath.fastAbs(offset.y));\n                     }\n                 }\n                 return pos;\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,26 +102,26 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n-                if (offset[2] < 0) {\n-                    offset[2] *= -1;\n-                } else if (offset[1] < 0) {\n-                    offset[1] *= -1;\n-                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                origin.add(offset, pos);\n+                if (offset.z < 0) {\n+                    offset.z *= -1;\n+                } else if (offset.y() < 0) {\n+                    offset.y *= -1;\n+                    offset.z = -(level[0] - TeraMath.fastAbs(offset.x()) - TeraMath.fastAbs(offset.y()));\n                 } else {\n-                    offset[1] = -offset[1] + 1;\n-                    if (offset[1] > 0) {\n-                        if (++offset[0] <= level[0]) {\n-                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n-                            offset[2] = 0;\n+                    offset.y = -offset.y() + 1;\n+                    if (offset.y > 0) {\n+                        if (++offset.x <= level[0]) {\n+                            offset.y = TeraMath.fastAbs(offset.x) - level[0];\n+                            offset.z = 0;\n                         } else {\n                             level[0]++;\n-                            offset[0] = -level[0];\n-                            offset[1] = 0;\n-                            offset[2] = 0;\n+                            offset.x = -level[0];\n+                            offset.y = 0;\n+                            offset.z = 0;\n                         }\n                     } else {\n-                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                        offset.z = -(level[0] - TeraMath.fastAbs(offset.x) - TeraMath.fastAbs(offset.y));\n                     }\n                 }\n                 return pos;\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwMzQzNQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422203435", "body": "The value access would be clearer using a Vector3i here.", "bodyText": "The value access would be clearer using a Vector3i here.", "bodyHTML": "<p dir=\"auto\">The value access would be clearer using a Vector3i here.</p>", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:17:34Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+        this.startDistance = startDistance;\n+    }\n+\n+    /**\n+     * solid diamond shape from the center to a radius\n+     * @param origin center of diamond iterator\n+     * @param radius distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder region(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius);\n+    }\n+\n+    /**\n+     * hollow shape with an inner and outer distance to iterate over\n+     * @param origin  center of diamond iterator\n+     * @param start distance to start iterating from\n+     * @param end distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int end) {\n+        return new Diamond3iIterable.Builder(origin, end).start(start);\n+    }\n+\n+    /**\n+     * iterates in a shell that is 1 block wide\n+     * @param origin center of shell\n+     * @param radius distance for 1 block wide shell\n+     */\n+    public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+    }\n+\n+    @Override\n+    public Iterator<Vector3ic> iterator() {\n+        Vector3i pos = new Vector3i();\n+        final int[] level = {this.startDistance};\n+        final int[] offset = {-this.startDistance,0,0};", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fe0942f2b6297c68d455ed2231cb3f20ace61349", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..017ed7929 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -92,7 +92,7 @@ public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n     public Iterator<Vector3ic> iterator() {\n         Vector3i pos = new Vector3i();\n         final int[] level = {this.startDistance};\n-        final int[] offset = {-this.startDistance,0,0};\n+        final Vector3i offset = new Vector3i(-this.startDistance,0,0);\n \n         return new Iterator<Vector3ic>() {\n             @Override\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -85,14 +85,14 @@ public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int\n      * @param radius distance for 1 block wide shell\n      */\n     public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n-        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius);\n     }\n \n     @Override\n     public Iterator<Vector3ic> iterator() {\n         Vector3i pos = new Vector3i();\n         final int[] level = {this.startDistance};\n-        final int[] offset = {-this.startDistance,0,0};\n+        final Vector3i offset = new Vector3i(-this.startDistance,0,0);\n \n         return new Iterator<Vector3ic>() {\n             @Override\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIwNTUxMQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422205511", "body": "If a `Vector3i` was used no represent the offset, the statement could be simplified to:\r\n`origin.add(offset, pos);`", "bodyText": "If a Vector3i was used no represent the offset, the statement could be simplified to:\norigin.add(offset, pos);", "bodyHTML": "<p dir=\"auto\">If a <code>Vector3i</code> was used no represent the offset, the statement could be simplified to:<br>\n<code>origin.add(offset, pos);</code></p>", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:21:33Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+        this.startDistance = startDistance;\n+    }\n+\n+    /**\n+     * solid diamond shape from the center to a radius\n+     * @param origin center of diamond iterator\n+     * @param radius distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder region(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius);\n+    }\n+\n+    /**\n+     * hollow shape with an inner and outer distance to iterate over\n+     * @param origin  center of diamond iterator\n+     * @param start distance to start iterating from\n+     * @param end distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int end) {\n+        return new Diamond3iIterable.Builder(origin, end).start(start);\n+    }\n+\n+    /**\n+     * iterates in a shell that is 1 block wide\n+     * @param origin center of shell\n+     * @param radius distance for 1 block wide shell\n+     */\n+    public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+    }\n+\n+    @Override\n+    public Iterator<Vector3ic> iterator() {\n+        Vector3i pos = new Vector3i();\n+        final int[] level = {this.startDistance};\n+        final int[] offset = {-this.startDistance,0,0};\n+\n+        return new Iterator<Vector3ic>() {\n+            @Override\n+            public boolean hasNext() {\n+                return level[0] < endDistance;\n+            }\n+\n+            @Override\n+            public Vector3ic next() {\n+                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fe0942f2b6297c68d455ed2231cb3f20ace61349", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..017ed7929 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,26 +102,26 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n-                if (offset[2] < 0) {\n-                    offset[2] *= -1;\n-                } else if (offset[1] < 0) {\n-                    offset[1] *= -1;\n-                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);\n+                if (offset.z < 0) {\n+                    offset.z *= -1;\n+                } else if (offset.y() < 0) {\n+                    offset.y *= -1;\n+                    offset.z = -(level[0] - TeraMath.fastAbs(offset.x()) - TeraMath.fastAbs(offset.y()));\n                 } else {\n-                    offset[1] = -offset[1] + 1;\n-                    if (offset[1] > 0) {\n-                        if (++offset[0] <= level[0]) {\n-                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n-                            offset[2] = 0;\n+                    offset.y = -offset.y() + 1;\n+                    if (offset.y > 0) {\n+                        if (++offset.x <= level[0]) {\n+                            offset.y = TeraMath.fastAbs(offset.x) - level[0];\n+                            offset.z = 0;\n                         } else {\n                             level[0]++;\n-                            offset[0] = -level[0];\n-                            offset[1] = 0;\n-                            offset[2] = 0;\n+                            offset.x = -level[0];\n+                            offset.y = 0;\n+                            offset.z = 0;\n                         }\n                     } else {\n-                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                        offset.z = -(level[0] - TeraMath.fastAbs(offset.x) - TeraMath.fastAbs(offset.y));\n                     }\n                 }\n                 return pos;\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,26 +102,26 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n-                if (offset[2] < 0) {\n-                    offset[2] *= -1;\n-                } else if (offset[1] < 0) {\n-                    offset[1] *= -1;\n-                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                origin.add(offset, pos);\n+                if (offset.z < 0) {\n+                    offset.z *= -1;\n+                } else if (offset.y() < 0) {\n+                    offset.y *= -1;\n+                    offset.z = -(level[0] - TeraMath.fastAbs(offset.x()) - TeraMath.fastAbs(offset.y()));\n                 } else {\n-                    offset[1] = -offset[1] + 1;\n-                    if (offset[1] > 0) {\n-                        if (++offset[0] <= level[0]) {\n-                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n-                            offset[2] = 0;\n+                    offset.y = -offset.y() + 1;\n+                    if (offset.y > 0) {\n+                        if (++offset.x <= level[0]) {\n+                            offset.y = TeraMath.fastAbs(offset.x) - level[0];\n+                            offset.z = 0;\n                         } else {\n                             level[0]++;\n-                            offset[0] = -level[0];\n-                            offset[1] = 0;\n-                            offset[2] = 0;\n+                            offset.x = -level[0];\n+                            offset.y = 0;\n+                            offset.z = 0;\n                         }\n                     } else {\n-                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                        offset.z = -(level[0] - TeraMath.fastAbs(offset.x) - TeraMath.fastAbs(offset.y));\n                     }\n                 }\n                 return pos;\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyMzM3Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422223377", "body": "+/- 1 confusion:\r\n```suggestion\r\n        Preconditions.checkArgument(startDistance <= maxDistance, \"startDistance must be <= maxDistance\");\r\n```", "bodyText": "+/- 1 confusion:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n          \n          \n            \n                    Preconditions.checkArgument(startDistance <= maxDistance, \"startDistance must be <= maxDistance\");", "bodyHTML": "<p dir=\"auto\">+/- 1 confusion:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"54\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-smi\">Preconditions</span><span class=\"pl-k\">.</span>checkArgument(startDistance <span class=\"pl-k\">&lt;</span> maxDistance, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>startDistance must be &lt; maxDistance<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"54\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-smi\">Preconditions</span><span class=\"pl-k\">.</span>checkArgument(startDistance <span class=\"pl-k\">&lt;<span class=\"x x-first x-last\">=</span></span> maxDistance, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>startDistance must be &lt;<span class=\"x x-first x-last\">=</span> maxDistance<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:55:12Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef08b782789b8acaec1abc7696aabb77bb072235", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..3d94727e5 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -53,7 +53,7 @@ private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n     private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n         Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n         Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n-        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"startDistance must be >= 0\");\n \n         this.origin.set(origin);\n         this.endDistance = maxDistance;\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -53,7 +53,7 @@ private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n     private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n         Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n         Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n-        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"startDistance must be >= 0\");\n \n         this.origin.set(origin);\n         this.endDistance = maxDistance;\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyMzc3MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422223771", "body": "+/- 1 confusion:\r\n```suggestion\r\n        return new Diamond3iIterable.Builder(origin, radius).start(radius);\r\n```", "bodyText": "+/- 1 confusion:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n          \n          \n            \n                    return new Diamond3iIterable.Builder(origin, radius).start(radius);", "bodyHTML": "<p dir=\"auto\">+/- 1 confusion:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">Diamond3iIterable</span>.<span class=\"pl-smi\">Builder</span>(origin, radius)<span class=\"pl-k\">.</span>start(radius<span class=\"x x-first\"> </span><span class=\"pl-k x\">-</span><span class=\"x\"> </span><span class=\"pl-c1 x x-last\">1</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">return</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">Diamond3iIterable</span>.<span class=\"pl-smi\">Builder</span>(origin, radius)<span class=\"pl-k\">.</span>start(radius);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:55:52Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+        this.startDistance = startDistance;\n+    }\n+\n+    /**\n+     * solid diamond shape from the center to a radius\n+     * @param origin center of diamond iterator\n+     * @param radius distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder region(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius);\n+    }\n+\n+    /**\n+     * hollow shape with an inner and outer distance to iterate over\n+     * @param origin  center of diamond iterator\n+     * @param start distance to start iterating from\n+     * @param end distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int end) {\n+        return new Diamond3iIterable.Builder(origin, end).start(start);\n+    }\n+\n+    /**\n+     * iterates in a shell that is 1 block wide\n+     * @param origin center of shell\n+     * @param radius distance for 1 block wide shell\n+     */\n+    public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fecb8d11b6784393b8ce2cbfdc7daa15f9ca316f", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..ec6335665 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -85,14 +85,14 @@ public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int\n      * @param radius distance for 1 block wide shell\n      */\n     public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n-        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius);\n     }\n \n     @Override\n     public Iterator<Vector3ic> iterator() {\n         Vector3i pos = new Vector3i();\n         final int[] level = {this.startDistance};\n-        final int[] offset = {-this.startDistance,0,0};\n+        final Vector3i offset = new Vector3i(-this.startDistance,0,0);\n \n         return new Iterator<Vector3ic>() {\n             @Override\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -85,14 +85,14 @@ public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int\n      * @param radius distance for 1 block wide shell\n      */\n     public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n-        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius);\n     }\n \n     @Override\n     public Iterator<Vector3ic> iterator() {\n         Vector3i pos = new Vector3i();\n         final int[] level = {this.startDistance};\n-        final int[] offset = {-this.startDistance,0,0};\n+        final Vector3i offset = new Vector3i(-this.startDistance,0,0);\n \n         return new Iterator<Vector3ic>() {\n             @Override\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyNDEzMw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422224133", "body": "+/- 1 confusion:\r\n```suggestion\r\n                return level[0] <= endDistance;\r\n```", "bodyText": "+/- 1 confusion:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            return level[0] < endDistance;\n          \n          \n            \n                            return level[0] <= endDistance;", "bodyHTML": "<p dir=\"auto\">+/- 1 confusion:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"100\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">return</span> level[<span class=\"pl-c1\">0</span>] <span class=\"pl-k\">&lt;</span> endDistance;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"100\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">return</span> level[<span class=\"pl-c1\">0</span>] <span class=\"pl-k\">&lt;<span class=\"x x-first x-last\">=</span></span> endDistance;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:56:31Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+        this.startDistance = startDistance;\n+    }\n+\n+    /**\n+     * solid diamond shape from the center to a radius\n+     * @param origin center of diamond iterator\n+     * @param radius distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder region(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius);\n+    }\n+\n+    /**\n+     * hollow shape with an inner and outer distance to iterate over\n+     * @param origin  center of diamond iterator\n+     * @param start distance to start iterating from\n+     * @param end distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int end) {\n+        return new Diamond3iIterable.Builder(origin, end).start(start);\n+    }\n+\n+    /**\n+     * iterates in a shell that is 1 block wide\n+     * @param origin center of shell\n+     * @param radius distance for 1 block wide shell\n+     */\n+    public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+    }\n+\n+    @Override\n+    public Iterator<Vector3ic> iterator() {\n+        Vector3i pos = new Vector3i();\n+        final int[] level = {this.startDistance};\n+        final int[] offset = {-this.startDistance,0,0};\n+\n+        return new Iterator<Vector3ic>() {\n+            @Override\n+            public boolean hasNext() {\n+                return level[0] < endDistance;", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fe0942f2b6297c68d455ed2231cb3f20ace61349", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..017ed7929 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -92,7 +92,7 @@ public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n     public Iterator<Vector3ic> iterator() {\n         Vector3i pos = new Vector3i();\n         final int[] level = {this.startDistance};\n-        final int[] offset = {-this.startDistance,0,0};\n+        final Vector3i offset = new Vector3i(-this.startDistance,0,0);\n \n         return new Iterator<Vector3ic>() {\n             @Override\n", "next_change": null}, {"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..017ed7929 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,26 +102,26 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n-                if (offset[2] < 0) {\n-                    offset[2] *= -1;\n-                } else if (offset[1] < 0) {\n-                    offset[1] *= -1;\n-                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);\n+                if (offset.z < 0) {\n+                    offset.z *= -1;\n+                } else if (offset.y() < 0) {\n+                    offset.y *= -1;\n+                    offset.z = -(level[0] - TeraMath.fastAbs(offset.x()) - TeraMath.fastAbs(offset.y()));\n                 } else {\n-                    offset[1] = -offset[1] + 1;\n-                    if (offset[1] > 0) {\n-                        if (++offset[0] <= level[0]) {\n-                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n-                            offset[2] = 0;\n+                    offset.y = -offset.y() + 1;\n+                    if (offset.y > 0) {\n+                        if (++offset.x <= level[0]) {\n+                            offset.y = TeraMath.fastAbs(offset.x) - level[0];\n+                            offset.z = 0;\n                         } else {\n                             level[0]++;\n-                            offset[0] = -level[0];\n-                            offset[1] = 0;\n-                            offset[2] = 0;\n+                            offset.x = -level[0];\n+                            offset.y = 0;\n+                            offset.z = 0;\n                         }\n                     } else {\n-                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                        offset.z = -(level[0] - TeraMath.fastAbs(offset.x) - TeraMath.fastAbs(offset.y));\n                     }\n                 }\n                 return pos;\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -85,14 +85,14 @@ public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int\n      * @param radius distance for 1 block wide shell\n      */\n     public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n-        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius);\n     }\n \n     @Override\n     public Iterator<Vector3ic> iterator() {\n         Vector3i pos = new Vector3i();\n         final int[] level = {this.startDistance};\n-        final int[] offset = {-this.startDistance,0,0};\n+        final Vector3i offset = new Vector3i(-this.startDistance,0,0);\n \n         return new Iterator<Vector3ic>() {\n             @Override\n", "next_change": null}, {"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,26 +102,26 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n-                if (offset[2] < 0) {\n-                    offset[2] *= -1;\n-                } else if (offset[1] < 0) {\n-                    offset[1] *= -1;\n-                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                origin.add(offset, pos);\n+                if (offset.z < 0) {\n+                    offset.z *= -1;\n+                } else if (offset.y() < 0) {\n+                    offset.y *= -1;\n+                    offset.z = -(level[0] - TeraMath.fastAbs(offset.x()) - TeraMath.fastAbs(offset.y()));\n                 } else {\n-                    offset[1] = -offset[1] + 1;\n-                    if (offset[1] > 0) {\n-                        if (++offset[0] <= level[0]) {\n-                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n-                            offset[2] = 0;\n+                    offset.y = -offset.y() + 1;\n+                    if (offset.y > 0) {\n+                        if (++offset.x <= level[0]) {\n+                            offset.y = TeraMath.fastAbs(offset.x) - level[0];\n+                            offset.z = 0;\n                         } else {\n                             level[0]++;\n-                            offset[0] = -level[0];\n-                            offset[1] = 0;\n-                            offset[2] = 0;\n+                            offset.x = -level[0];\n+                            offset.y = 0;\n+                            offset.z = 0;\n                         }\n                     } else {\n-                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                        offset.z = -(level[0] - TeraMath.fastAbs(offset.x) - TeraMath.fastAbs(offset.y));\n                     }\n                 }\n                 return pos;\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyNDQ1NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422224454", "body": "+/- 1 confusion:\r\n```suggestion\r\n            this.endDistance = endDistance;\r\n```", "bodyText": "+/- 1 confusion:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        this.endDistance = endDistance + 1;\n          \n          \n            \n                        this.endDistance = endDistance;", "bodyHTML": "<p dir=\"auto\">+/- 1 confusion:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"143\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>endDistance <span class=\"pl-k\">=</span> endDistance<span class=\"x x-first\"> </span><span class=\"pl-k x\">+</span><span class=\"x\"> </span><span class=\"pl-c1 x x-last\">1</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"143\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>endDistance <span class=\"pl-k\">=</span> endDistance;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:57:09Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+        this.startDistance = startDistance;\n+    }\n+\n+    /**\n+     * solid diamond shape from the center to a radius\n+     * @param origin center of diamond iterator\n+     * @param radius distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder region(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius);\n+    }\n+\n+    /**\n+     * hollow shape with an inner and outer distance to iterate over\n+     * @param origin  center of diamond iterator\n+     * @param start distance to start iterating from\n+     * @param end distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int end) {\n+        return new Diamond3iIterable.Builder(origin, end).start(start);\n+    }\n+\n+    /**\n+     * iterates in a shell that is 1 block wide\n+     * @param origin center of shell\n+     * @param radius distance for 1 block wide shell\n+     */\n+    public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+    }\n+\n+    @Override\n+    public Iterator<Vector3ic> iterator() {\n+        Vector3i pos = new Vector3i();\n+        final int[] level = {this.startDistance};\n+        final int[] offset = {-this.startDistance,0,0};\n+\n+        return new Iterator<Vector3ic>() {\n+            @Override\n+            public boolean hasNext() {\n+                return level[0] < endDistance;\n+            }\n+\n+            @Override\n+            public Vector3ic next() {\n+                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n+                if (offset[2] < 0) {\n+                    offset[2] *= -1;\n+                } else if (offset[1] < 0) {\n+                    offset[1] *= -1;\n+                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                } else {\n+                    offset[1] = -offset[1] + 1;\n+                    if (offset[1] > 0) {\n+                        if (++offset[0] <= level[0]) {\n+                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n+                            offset[2] = 0;\n+                        } else {\n+                            level[0]++;\n+                            offset[0] = -level[0];\n+                            offset[1] = 0;\n+                            offset[2] = 0;\n+                        }\n+                    } else {\n+                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                    }\n+                }\n+                return pos;\n+            }\n+        };\n+    }\n+\n+    public static final class Builder {\n+        private final Vector3ic origin;\n+        private final int endDistance;\n+        private int startDistance = 0;\n+\n+        /**\n+         * Default endDistance starts at 1\n+         * @param origin center region for iterator\n+         * @param endDistance maximums radius\n+         */\n+        private Builder(Vector3ic origin, int endDistance){\n+            this.origin = origin;\n+            this.endDistance = endDistance + 1;", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef08b782789b8acaec1abc7696aabb77bb072235", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..3d94727e5 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -135,13 +135,12 @@ public static final class Builder {\n         private int startDistance = 0;\n \n         /**\n-         * Default endDistance starts at 1\n          * @param origin center region for iterator\n          * @param endDistance maximums radius\n          */\n         private Builder(Vector3ic origin, int endDistance){\n             this.origin = origin;\n-            this.endDistance = endDistance + 1;\n+            this.endDistance = endDistance;\n         }\n \n         /**\n", "next_change": {"commit": "fecb8d11b6784393b8ce2cbfdc7daa15f9ca316f", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex 3d94727e5..ec6335665 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -140,7 +140,7 @@ public static final class Builder {\n          */\n         private Builder(Vector3ic origin, int endDistance){\n             this.origin = origin;\n-            this.endDistance = endDistance;\n+            this.endDistance = endDistance + 1;\n         }\n \n         /**\n", "next_change": null}]}}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -135,7 +135,6 @@ public static final class Builder {\n         private int startDistance = 0;\n \n         /**\n-         * Default endDistance starts at 1\n          * @param origin center region for iterator\n          * @param endDistance maximums radius\n          */\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjIyNDcyNw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422224727", "body": "+/- 1 confusion:\r\n```suggestion\r\n            this.startDistance = start;\r\n```\r\nthat was the last one.", "bodyText": "+/- 1 confusion:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        this.startDistance = start + 1;\n          \n          \n            \n                        this.startDistance = start;\n          \n      \n    \n    \n  \n\nthat was the last one.", "bodyHTML": "<p dir=\"auto\">+/- 1 confusion:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>startDistance <span class=\"pl-k\">=</span> start<span class=\"x x-first\"> </span><span class=\"pl-k x\">+</span><span class=\"x\"> </span><span class=\"pl-c1 x x-last\">1</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>startDistance <span class=\"pl-k\">=</span> start;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">that was the last one.</p>", "author": "kBlaszczyk", "createdAt": "2020-05-08T15:57:41Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.terasology.math;\n+\n+import com.google.common.base.Preconditions;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+\n+import java.util.Iterator;\n+\n+/**\n+ * Diamond3Iterable iterates in a diamond shape hull where the manhattan distance is the same for that level.\n+ * for each group of iterations the manhattan distance decreases. inner and outer radiuses can be set where\n+ * the shape can be an hull with distance 1 to a full solid.\n+ */\n+public final class Diamond3iIterable implements Iterable<Vector3ic> {\n+\n+    private final Vector3i origin = new Vector3i();\n+    private final int endDistance;\n+    private int startDistance = 0;\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int maxDistance) {\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be > 0\");\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+    }\n+\n+    /**\n+     *\n+     * @param origin center point of Diamond3iIterator\n+     * @param startDistance inner distance outwards\n+     * @param maxDistance maxDistance away\n+     */\n+    private Diamond3iIterable(Vector3ic origin, int startDistance, int maxDistance) {\n+        Preconditions.checkArgument(startDistance < maxDistance, \"startDistance must be < maxDistance\");\n+        Preconditions.checkArgument(maxDistance >= 0, \"maxDistance must be >= 0\");\n+        Preconditions.checkArgument(startDistance >= 0, \"maxDistance must be >= 0\");\n+\n+        this.origin.set(origin);\n+        this.endDistance = maxDistance;\n+        this.startDistance = startDistance;\n+    }\n+\n+    /**\n+     * solid diamond shape from the center to a radius\n+     * @param origin center of diamond iterator\n+     * @param radius distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder region(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius);\n+    }\n+\n+    /**\n+     * hollow shape with an inner and outer distance to iterate over\n+     * @param origin  center of diamond iterator\n+     * @param start distance to start iterating from\n+     * @param end distance to iterate out to\n+     */\n+    public static Diamond3iIterable.Builder hollow(Vector3ic origin, int start, int end) {\n+        return new Diamond3iIterable.Builder(origin, end).start(start);\n+    }\n+\n+    /**\n+     * iterates in a shell that is 1 block wide\n+     * @param origin center of shell\n+     * @param radius distance for 1 block wide shell\n+     */\n+    public static Diamond3iIterable.Builder shell(Vector3ic origin, int radius) {\n+        return new Diamond3iIterable.Builder(origin, radius).start(radius - 1);\n+    }\n+\n+    @Override\n+    public Iterator<Vector3ic> iterator() {\n+        Vector3i pos = new Vector3i();\n+        final int[] level = {this.startDistance};\n+        final int[] offset = {-this.startDistance,0,0};\n+\n+        return new Iterator<Vector3ic>() {\n+            @Override\n+            public boolean hasNext() {\n+                return level[0] < endDistance;\n+            }\n+\n+            @Override\n+            public Vector3ic next() {\n+                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n+                if (offset[2] < 0) {\n+                    offset[2] *= -1;\n+                } else if (offset[1] < 0) {\n+                    offset[1] *= -1;\n+                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                } else {\n+                    offset[1] = -offset[1] + 1;\n+                    if (offset[1] > 0) {\n+                        if (++offset[0] <= level[0]) {\n+                            offset[1] = TeraMath.fastAbs(offset[0]) - level[0];\n+                            offset[2] = 0;\n+                        } else {\n+                            level[0]++;\n+                            offset[0] = -level[0];\n+                            offset[1] = 0;\n+                            offset[2] = 0;\n+                        }\n+                    } else {\n+                        offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                    }\n+                }\n+                return pos;\n+            }\n+        };\n+    }\n+\n+    public static final class Builder {\n+        private final Vector3ic origin;\n+        private final int endDistance;\n+        private int startDistance = 0;\n+\n+        /**\n+         * Default endDistance starts at 1\n+         * @param origin center region for iterator\n+         * @param endDistance maximums radius\n+         */\n+        private Builder(Vector3ic origin, int endDistance){\n+            this.origin = origin;\n+            this.endDistance = endDistance + 1;\n+        }\n+\n+        /**\n+         * Default start distance is 0\n+         * @param start  the minimum radius\n+         */\n+        public Diamond3iIterable.Builder start(int start) {\n+            this.startDistance = start + 1;", "originalCommit": "da38dbc8d397f0015e46882b57723e86d174bbbc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef08b782789b8acaec1abc7696aabb77bb072235", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..3d94727e5 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -135,13 +135,12 @@ public static final class Builder {\n         private int startDistance = 0;\n \n         /**\n-         * Default endDistance starts at 1\n          * @param origin center region for iterator\n          * @param endDistance maximums radius\n          */\n         private Builder(Vector3ic origin, int endDistance){\n             this.origin = origin;\n-            this.endDistance = endDistance + 1;\n+            this.endDistance = endDistance;\n         }\n \n         /**\n", "next_change": {"commit": "fecb8d11b6784393b8ce2cbfdc7daa15f9ca316f", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex 3d94727e5..ec6335665 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -140,7 +140,7 @@ public static final class Builder {\n          */\n         private Builder(Vector3ic origin, int endDistance){\n             this.origin = origin;\n-            this.endDistance = endDistance;\n+            this.endDistance = endDistance + 1;\n         }\n \n         /**\n", "next_change": null}]}}, {"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..3d94727e5 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -149,7 +148,7 @@ private Builder(Vector3ic origin, int endDistance){\n          * @param start  the minimum radius\n          */\n         public Diamond3iIterable.Builder start(int start) {\n-            this.startDistance = start + 1;\n+            this.startDistance = start;\n             return this;\n         }\n \n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex d74eaffda..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -149,7 +148,7 @@ private Builder(Vector3ic origin, int endDistance){\n          * @param start  the minimum radius\n          */\n         public Diamond3iIterable.Builder start(int start) {\n-            this.startDistance = start + 1;\n+            this.startDistance = start;\n             return this;\n         }\n \n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"oid": "ef08b782789b8acaec1abc7696aabb77bb072235", "url": "https://github.com/MovingBlocks/Terasology/commit/ef08b782789b8acaec1abc7696aabb77bb072235", "message": "corrected start distance", "committedDate": "2020-05-09T04:06:28Z", "type": "commit"}, {"oid": "fe0942f2b6297c68d455ed2231cb3f20ace61349", "url": "https://github.com/MovingBlocks/Terasology/commit/fe0942f2b6297c68d455ed2231cb3f20ace61349", "message": "tweaked offset", "committedDate": "2020-05-09T04:23:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ4NjM1OA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422486358", "body": "No! that's not a good idea.\r\nThe changes I suggested kept the unit tests unchanged and intact. You changed the API and now every usage of that method would need to be adjusted.\r\nBesides, the API was fine - If I create a diamond with radius 1, I expect the coordinates to be (-1, 0, 0), (1, 0, 0), ...\r\nThis behavior needs to be kept, my changes only optimized the internals.", "bodyText": "No! that's not a good idea.\nThe changes I suggested kept the unit tests unchanged and intact. You changed the API and now every usage of that method would need to be adjusted.\nBesides, the API was fine - If I create a diamond with radius 1, I expect the coordinates to be (-1, 0, 0), (1, 0, 0), ...\nThis behavior needs to be kept, my changes only optimized the internals.", "bodyHTML": "<p dir=\"auto\">No! that's not a good idea.<br>\nThe changes I suggested kept the unit tests unchanged and intact. You changed the API and now every usage of that method would need to be adjusted.<br>\nBesides, the API was fine - If I create a diamond with radius 1, I expect the coordinates to be (-1, 0, 0), (1, 0, 0), ...<br>\nThis behavior needs to be kept, my changes only optimized the internals.</p>", "author": "kBlaszczyk", "createdAt": "2020-05-09T11:45:07Z", "path": "engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java", "diffHunk": "@@ -35,13 +35,13 @@\n \n     @Test\n     public void testZeroDistanceIteration() {\n-        Iterator<Vector3ic> iter = Diamond3iIterable.region(new org.joml.Vector3i(),0).build().iterator();\n+        Iterator<Vector3ic> iter = Diamond3iIterable.region(new org.joml.Vector3i(),1).build().iterator();\n         assertEquals(Lists.newArrayList(new Vector3i()), Lists.newArrayList(iter));\n     }\n \n     @Test\n     public void testOneDistanceIteration() {\n-        Iterator<Vector3ic> iter = Diamond3iIterable.region(new Vector3i(),1).build().iterator();\n+        Iterator<Vector3ic> iter = Diamond3iIterable.region(new Vector3i(),2).build().iterator();", "originalCommit": "fe0942f2b6297c68d455ed2231cb3f20ace61349", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fecb8d11b6784393b8ce2cbfdc7daa15f9ca316f", "changed_code": [{"header": "diff --git a/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java b/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\nindex 613a861b1..57a32f1b5 100644\n--- a/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\n+++ b/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\n", "chunk": "@@ -35,13 +35,13 @@ public class Diamond3iIteratorTest {\n \n     @Test\n     public void testZeroDistanceIteration() {\n-        Iterator<Vector3ic> iter = Diamond3iIterable.region(new org.joml.Vector3i(),1).build().iterator();\n+        Iterator<Vector3ic> iter = Diamond3iIterable.region(new org.joml.Vector3i(),0).build().iterator();\n         assertEquals(Lists.newArrayList(new Vector3i()), Lists.newArrayList(iter));\n     }\n \n     @Test\n     public void testOneDistanceIteration() {\n-        Iterator<Vector3ic> iter = Diamond3iIterable.region(new Vector3i(),2).build().iterator();\n+        Iterator<Vector3ic> iter = Diamond3iIterable.region(new Vector3i(),1).build().iterator();\n         Set<Vector3i> expected = Sets.newHashSet(new Vector3i(), new Vector3i(1, 0, 0), new Vector3i(-1, 0, 0), new Vector3i(0, 1, 0),\n             new Vector3i(0, -1, 0), new Vector3i(0, 0, 1), new Vector3i(0, 0, -1));\n         while (iter.hasNext()) {\n", "next_change": null}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java b/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\nindex 613a861b1..57a32f1b5 100644\n--- a/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\n+++ b/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\n", "chunk": "@@ -35,13 +35,13 @@ public class Diamond3iIteratorTest {\n \n     @Test\n     public void testZeroDistanceIteration() {\n-        Iterator<Vector3ic> iter = Diamond3iIterable.region(new org.joml.Vector3i(),1).build().iterator();\n+        Iterator<Vector3ic> iter = Diamond3iIterable.region(new org.joml.Vector3i(),0).build().iterator();\n         assertEquals(Lists.newArrayList(new Vector3i()), Lists.newArrayList(iter));\n     }\n \n     @Test\n     public void testOneDistanceIteration() {\n-        Iterator<Vector3ic> iter = Diamond3iIterable.region(new Vector3i(),2).build().iterator();\n+        Iterator<Vector3ic> iter = Diamond3iIterable.region(new Vector3i(),1).build().iterator();\n         Set<Vector3i> expected = Sets.newHashSet(new Vector3i(), new Vector3i(1, 0, 0), new Vector3i(-1, 0, 0), new Vector3i(0, 1, 0),\n             new Vector3i(0, -1, 0), new Vector3i(0, 0, 1), new Vector3i(0, 0, -1));\n         while (iter.hasNext()) {\n", "next_change": {"commit": "2d0c434654b797b71e9a0d00004b3b79f3a4c5e7", "changed_code": [{"header": "diff --git a/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java b/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\nindex 57a32f1b5..ad8ac784d 100644\n--- a/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\n+++ b/engine-tests/src/test/java/org/terasology/math/Diamond3iIteratorTest.java\n", "chunk": "@@ -28,20 +16,18 @@\n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n-/**\n- *\n- */\n+\n public class Diamond3iIteratorTest {\n \n     @Test\n     public void testZeroDistanceIteration() {\n-        Iterator<Vector3ic> iter = Diamond3iIterable.region(new org.joml.Vector3i(),0).build().iterator();\n+        Iterator<Vector3ic> iter = Diamond3iIterable.region(new org.joml.Vector3i(), 0).build().iterator();\n         assertEquals(Lists.newArrayList(new Vector3i()), Lists.newArrayList(iter));\n     }\n \n     @Test\n     public void testOneDistanceIteration() {\n-        Iterator<Vector3ic> iter = Diamond3iIterable.region(new Vector3i(),1).build().iterator();\n+        Iterator<Vector3ic> iter = Diamond3iIterable.region(new Vector3i(), 1).build().iterator();\n         Set<Vector3i> expected = Sets.newHashSet(new Vector3i(), new Vector3i(1, 0, 0), new Vector3i(-1, 0, 0), new Vector3i(0, 1, 0),\n             new Vector3i(0, -1, 0), new Vector3i(0, 0, 1), new Vector3i(0, 0, -1));\n         while (iter.hasNext()) {\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "2d0c434654b797b71e9a0d00004b3b79f3a4c5e7", "committedDate": "2021-05-24 13:50:30 +0200", "message": "style: improve code style (#4702)"}, {"oid": "710e57260001767fa8d7eeaae32b1925e0c8d8ed", "committedDate": "2021-09-04 20:34:45 -0700", "message": "chore: cleanup extra qualification for org.joml from termath migration (#4887)"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjQ4Njg5Ng==", "url": "https://github.com/MovingBlocks/Terasology/pull/3935#discussion_r422486896", "body": "As suggested before, why not use vector math?\r\n```suggestion\r\n                origin.add(offset, pos);\r\n```\r\nalternatively: `pos.set(origin).add(offset)`", "bodyText": "As suggested before, why not use vector math?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);\n          \n          \n            \n                            origin.add(offset, pos);\n          \n      \n    \n    \n  \n\nalternatively: pos.set(origin).add(offset)", "bodyHTML": "<p dir=\"auto\">As suggested before, why not use vector math?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"x x-first\">pos</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">set(</span>origin<span class=\"pl-k\">.</span><span class=\"x x-first\">x </span><span class=\"pl-k x\">+</span><span class=\"x x-last\"> </span>offset<span class=\"pl-k x x-first\">.</span><span class=\"x\">x, origin</span><span class=\"pl-k x\">.</span><span class=\"x\">y </span><span class=\"pl-k x\">+</span><span class=\"x\"> offset</span><span class=\"pl-k x\">.</span><span class=\"x\">y, origin</span><span class=\"pl-k x\">.</span><span class=\"x\">z </span><span class=\"pl-k x\">+</span><span class=\"x\"> offset</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">z</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                origin<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">add(</span>offset<span class=\"x x-first x-last\">, pos</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">alternatively: <code>pos.set(origin).add(offset)</code></p>", "author": "kBlaszczyk", "createdAt": "2020-05-09T11:52:29Z", "path": "engine/src/main/java/org/terasology/math/Diamond3iIterable.java", "diffHunk": "@@ -102,26 +102,26 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset[0], origin.y + offset[1], origin.z + offset[2]);\n-                if (offset[2] < 0) {\n-                    offset[2] *= -1;\n-                } else if (offset[1] < 0) {\n-                    offset[1] *= -1;\n-                    offset[2] = -(level[0] - TeraMath.fastAbs(offset[0]) - TeraMath.fastAbs(offset[1]));\n+                pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);", "originalCommit": "fe0942f2b6297c68d455ed2231cb3f20ace61349", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "198d5e00c8ff6f6a71fd3f4bac6e0d2028a5e98f", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex 017ed7929..e6ff7a827 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,7 +102,7 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);\n+                origin.add(offset, pos);\n                 if (offset.z < 0) {\n                     offset.z *= -1;\n                 } else if (offset.y() < 0) {\n", "next_change": {"commit": "fecb8d11b6784393b8ce2cbfdc7daa15f9ca316f", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex e6ff7a827..ec6335665 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,7 +102,7 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                origin.add(offset, pos);\n+                pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);\n                 if (offset.z < 0) {\n                     offset.z *= -1;\n                 } else if (offset.y() < 0) {\n", "next_change": {"commit": "b4c7a563397508588fa58b2292b73dfb205007ce", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex ec6335665..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,7 +102,7 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);\n+                origin.add(offset, pos);\n                 if (offset.z < 0) {\n                     offset.z *= -1;\n                 } else if (offset.y() < 0) {\n", "next_change": null}]}}]}}]}, "revised_code_in_main": {"commit": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "changed_code": [{"header": "diff --git a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\nindex 017ed7929..07094b1d8 100644\n--- a/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n+++ b/engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n", "chunk": "@@ -102,7 +102,7 @@ public boolean hasNext() {\n \n             @Override\n             public Vector3ic next() {\n-                pos.set(origin.x + offset.x, origin.y + offset.y, origin.z + offset.z);\n+                origin.add(offset, pos);\n                 if (offset.z < 0) {\n                     offset.z *= -1;\n                 } else if (offset.y() < 0) {\n", "next_change": null}]}, "commits_in_main": [{"oid": "9dd43a61d49787bd7c22e6327bd2b8b92082fdef", "message": "Merge commit", "committedDate": null}, {"oid": "66e5f5d86804a849381e3abd8dfe79713e24cc2a", "committedDate": "2021-03-04 21:45:23 -0800", "message": "refactor! move engine code in to org.terasology.engine package"}, {"oid": "7143a6c10bd09cd48a96d39538d2cabb99c6719b", "committedDate": "2021-03-17 13:44:39 -0700", "message": "refactor: move engine packages to proper directory"}]}, {"oid": "198d5e00c8ff6f6a71fd3f4bac6e0d2028a5e98f", "url": "https://github.com/MovingBlocks/Terasology/commit/198d5e00c8ff6f6a71fd3f4bac6e0d2028a5e98f", "message": "Update engine/src/main/java/org/terasology/math/Diamond3iIterable.java\n\nCo-authored-by: Kevin Blaszczyk <kevin.blaszczyk@gmail.com>", "committedDate": "2020-05-09T15:45:50Z", "type": "commit"}, {"oid": "fecb8d11b6784393b8ce2cbfdc7daa15f9ca316f", "url": "https://github.com/MovingBlocks/Terasology/commit/fecb8d11b6784393b8ce2cbfdc7daa15f9ca316f", "message": "correct distance", "committedDate": "2020-05-09T16:48:20Z", "type": "commit"}, {"oid": "b4c7a563397508588fa58b2292b73dfb205007ce", "url": "https://github.com/MovingBlocks/Terasology/commit/b4c7a563397508588fa58b2292b73dfb205007ce", "message": "Merge branch 'feature/iterable' of github.com:pollend/Terasology into feature/iterable", "committedDate": "2020-05-09T16:48:46Z", "type": "commit"}]}