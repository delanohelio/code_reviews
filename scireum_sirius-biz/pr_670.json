{"pr_number": 670, "pr_title": "Provides a helper to conveniently check permissions on an entity with\u2026", "pr_author": "andyHa", "pr_createdAt": "2020-01-23T15:24:27Z", "pr_url": "https://github.com/scireum/sirius-biz/pull/670", "timeline": [{"oid": "97c417504e1b352e96210ac24b821307ae97c6a2", "url": "https://github.com/scireum/sirius-biz/commit/97c417504e1b352e96210ac24b821307ae97c6a2", "message": "Provides a helper to conveniently check permissions on an entity without relying on a UserManager or the like to transform them.\n\nIn some cases we only have the database entity at hands and need to reason about granted permissions. We still want to\nutilize the profiles and other facilities to conveniently work with permissions. This is now provided by getEffectivePermissions\nand hasPermission.", "committedDate": "2020-01-23T15:22:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE5ODYzNw==", "url": "https://github.com/scireum/sirius-biz/pull/670#discussion_r370198637", "body": "```suggestion\r\n     * will most probably be way more efficient.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * will most probably way more efficient.\n          \n          \n            \n                 * will most probably be way more efficient.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> will most probably way more efficient.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> will most probably <span class=\"x x-first x-last\">be </span>way more efficient.</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "sabieber", "createdAt": "2020-01-23T15:48:11Z", "path": "src/main/java/sirius/biz/model/PermissionData.java", "diffHunk": "@@ -82,6 +89,43 @@ public StringList getPermissions() {\n         return permissions;\n     }\n \n+    /**\n+     * Provides a helper to determine the effective set of permissions based on {@link #getPermissions()} and\n+     * {@link Permissions#copyAndApplyProfiles(Collection)}.\n+     * <p>\n+     * Note that the result of applying all profiles is cached within this entity and will not reflect\n+     * any changes to {@link #getPermissions()}.\n+     *\n+     * @return the effective set of permissions\n+     */\n+    public Set<String> getEffectivePermissions() {\n+        if (effectivePermissions == null) {\n+            effectivePermissions = Permissions.copyAndApplyProfiles(getPermissions().data());\n+        }\n+\n+        return Collections.unmodifiableSet(effectivePermissions);\n+    }\n+\n+    /**\n+     * Checks if the requested permission expression is satisfied by the permissions granted in\n+     * {@link #getPermissions()}.\n+     * <p>\n+     * Note that this uses {@link #getEffectivePermissions()} which applies all profiles to the granted permissions,\n+     * which will be cached in this entity and will not reflect changes to {@link #getPermissions()}.\n+     * <p>\n+     * Also note that this is a helper method for rare cases, a call to\n+     * {@link sirius.web.security.UserInfo#hasPermission(String)} should always be preferred (if appropriate) as this\n+     * will most probably way more efficient.", "originalCommit": "97c417504e1b352e96210ac24b821307ae97c6a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2386b5c1446f8b2824b5d48f249146fef60f61d1", "url": "https://github.com/scireum/sirius-biz/commit/2386b5c1446f8b2824b5d48f249146fef60f61d1", "message": "Update src/main/java/sirius/biz/model/PermissionData.java\n\nCo-Authored-By: Sascha Bieberstein <sabieber@users.noreply.github.com>", "committedDate": "2020-01-23T16:13:16Z", "type": "commit"}]}