{"pr_number": 805, "pr_title": "Export of Metrics and Tenants.", "pr_author": "andyHa", "pr_createdAt": "2020-07-02T11:49:09Z", "pr_url": "https://github.com/scireum/sirius-biz/pull/805", "timeline": [{"oid": "04210e4ac15075ab5654c460fc9c7d5bdbed680e", "url": "https://github.com/scireum/sirius-biz/commit/04210e4ac15075ab5654c460fc9c7d5bdbed680e", "message": "Provides a simple way of injecting metrics into entity exports.", "committedDate": "2020-07-02T10:38:27Z", "type": "commit"}, {"oid": "7a2e936ae98f7601e742f6aa73aeb1777f098789", "url": "https://github.com/scireum/sirius-biz/commit/7a2e936ae98f7601e742f6aa73aeb1777f098789", "message": "Removes an unused field.", "committedDate": "2020-07-02T10:44:10Z", "type": "commit"}, {"oid": "8bfd0c0defd01084558e85acc28c70e0cc56c17b", "url": "https://github.com/scireum/sirius-biz/commit/8bfd0c0defd01084558e85acc28c70e0cc56c17b", "message": "Enables the metrics framework for the tests.\n\nOtherwise startup warnings occur.", "committedDate": "2020-07-02T10:44:42Z", "type": "commit"}, {"oid": "f71177d690adda22aa505bf226d5f7e02a204aad", "url": "https://github.com/scireum/sirius-biz/commit/f71177d690adda22aa505bf226d5f7e02a204aad", "message": "Provides an export-job for tenants.", "committedDate": "2020-07-02T11:46:08Z", "type": "commit"}, {"oid": "8eeec8ae432b4a7c0da888892a92c4f1594c20f1", "url": "https://github.com/scireum/sirius-biz/commit/8eeec8ae432b4a7c0da888892a92c4f1594c20f1", "message": "Merge remote-tracking branch 'origin/master' into aha/metrics-export-and-tenant-export", "committedDate": "2020-07-02T11:46:12Z", "type": "commit"}, {"oid": "d671d298a6793268020d31b844ebab39ffa39b20", "url": "https://github.com/scireum/sirius-biz/commit/d671d298a6793268020d31b844ebab39ffa39b20", "message": "Reverts a version bump performed by dependabot.\n\nWith the new driver (8.0.x) the schema tool fails with\n\"Unknown table 'dailymetric' in information_schema\".\n\nA better solution is probably to completely abandon the\nMySQL driver and switch over to the MariaDB one.", "committedDate": "2020-07-02T11:48:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk0OTI5Nw==", "url": "https://github.com/scireum/sirius-biz/pull/805#discussion_r448949297", "body": "```suggestion\r\n * itself. This can now decide which metric to make exportable (or even place them\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * itself. This can now deciede which metric to make exportable (or even place them\n          \n          \n            \n             * itself. This can now decide which metric to make exportable (or even place them", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"> <span class=\"pl-k\">*</span> itself. <span class=\"pl-smi\">This</span> can now <span class=\"x x-first x-last\">deciede</span> which metric to make exportable (or even place them</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span> itself. <span class=\"pl-smi\">This</span> can now <span class=\"x x-first x-last\">decide</span> which metric to make exportable (or even place them</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "sabieber", "createdAt": "2020-07-02T11:59:08Z", "path": "src/main/java/sirius/biz/analytics/metrics/MetricsImportHandlerExtender.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.analytics.metrics;\n+\n+import sirius.biz.importer.BaseImportHandler;\n+import sirius.biz.importer.EntityImportHandlerExtender;\n+import sirius.biz.importer.ImporterContext;\n+import sirius.biz.importer.format.FieldDefinition;\n+import sirius.db.mixing.BaseEntity;\n+import sirius.db.mixing.EntityDescriptor;\n+import sirius.db.mixing.Mapping;\n+import sirius.kernel.commons.MultiMap;\n+import sirius.kernel.commons.Strings;\n+import sirius.kernel.di.PartCollection;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Parts;\n+import sirius.kernel.di.std.Register;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collection;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.function.BiConsumer;\n+import java.util.function.Function;\n+\n+/**\n+ * Provides a convenient way of semi-automatically exporting metrics for an entity.\n+ * <p>\n+ * To extend the export of an entity, a {@link MetricExporter} has to be created and\n+ * registered. Most probably this can be the {@link MonthlyMetricComputer} (or the like)\n+ * itself. This can now deciede which metric to make exportable (or even place them", "originalCommit": "04210e4ac15075ab5654c460fc9c7d5bdbed680e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b04547bbe06e33bda5d11979a7d146ffb5eba3f3", "url": "https://github.com/scireum/sirius-biz/commit/b04547bbe06e33bda5d11979a7d146ffb5eba3f3", "message": "Update src/main/java/sirius/biz/analytics/metrics/MetricsImportHandlerExtender.java\n\nCo-authored-by: Sascha Bieberstein <sabieber@users.noreply.github.com>", "committedDate": "2020-07-02T12:10:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1MTc3Ng==", "url": "https://github.com/scireum/sirius-biz/pull/805#discussion_r448951776", "body": "```suggestion\r\n * Wraps all infos required to inject a metric into an entity export via a {@link MetricExporter}.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Wraps all infos required to inject a metric into an entity export via an {@link MetricExporter}.\n          \n          \n            \n             * Wraps all infos required to inject a metric into an entity export via a {@link MetricExporter}.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"> <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Wraps</span> all infos required to inject a metric into an entity export via <span class=\"x x-first x-last\">an</span> {<span class=\"pl-k\">@link</span> <span class=\"pl-smi\">MetricExporter</span>}<span class=\"pl-c1\">.</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span> <span class=\"pl-smi\">Wraps</span> all infos required to inject a metric into an entity export via <span class=\"x x-first x-last\">a</span> {<span class=\"pl-k\">@link</span> <span class=\"pl-smi\">MetricExporter</span>}<span class=\"pl-c1\">.</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "mkeckmkeck", "createdAt": "2020-07-02T12:03:47Z", "path": "src/main/java/sirius/biz/analytics/metrics/MetricExportInfo.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.analytics.metrics;\n+\n+import java.util.concurrent.atomic.AtomicInteger;\n+import java.util.function.ToIntFunction;\n+\n+/**\n+ * Wraps all infos required to inject a metric into an entity export via an {@link MetricExporter}.", "originalCommit": "04210e4ac15075ab5654c460fc9c7d5bdbed680e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bb85a855800eb089816820f08be03a656a0e224b", "url": "https://github.com/scireum/sirius-biz/commit/bb85a855800eb089816820f08be03a656a0e224b", "message": "Typo\n\nCo-authored-by: Matthias Keck <60612914+mkeckmkeck@users.noreply.github.com>", "committedDate": "2020-07-02T12:24:50Z", "type": "commit"}]}