{"pr_number": 2269, "pr_title": " gh-2216 Scheduled Jobs will not reschedule following restart.", "pr_author": "m29827", "pr_createdAt": "2020-04-20T12:41:09Z", "pr_url": "https://github.com/gchq/Gaffer/pull/2269", "timeline": [{"oid": "b5118aee5ab949e79ab92a9669ff3920210365c3", "url": "https://github.com/gchq/Gaffer/commit/b5118aee5ab949e79ab92a9669ff3920210365c3", "message": "gh-2216 Scheduled Jobs will not reschedule following restart.", "committedDate": "2020-04-20T12:39:17Z", "type": "commit"}, {"oid": "2ffd064138c5308ca0ba04097bbefedafafdd7c4", "url": "https://github.com/gchq/Gaffer/commit/2ffd064138c5308ca0ba04097bbefedafafdd7c4", "message": "Merge branch 'develop' into gh-2216-scheduled-jobs-will-not-reschedule", "committedDate": "2020-04-20T13:43:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkzNTkyMg==", "url": "https://github.com/gchq/Gaffer/pull/2269#discussion_r411935922", "body": "This will change the public API which would mean a breaking change. We've committed not to introduce breaking changes in version 1.x. Would it be possible to revert these and add some new constructors.\r\n```suggestion\r\n    @Deprecated\r\n    public JobDetail(final String jobId, final String userId, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {\r\n        this(jobId, null, new User(userId), opChain, jobStatus, description);\r\n    }\r\n    // other constructors following same pattern\r\n    public JobDetail(final String jobId, final String parentJobId, final User user, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {   \r\n         // do stuff\r\n     }\r\n```", "bodyText": "This will change the public API which would mean a breaking change. We've committed not to introduce breaking changes in version 1.x. Would it be possible to revert these and add some new constructors.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public JobDetail(final String jobId, final User user, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {\n          \n          \n            \n                @Deprecated\n          \n          \n            \n                public JobDetail(final String jobId, final String userId, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {\n          \n          \n            \n                    this(jobId, null, new User(userId), opChain, jobStatus, description);\n          \n          \n            \n                }\n          \n          \n            \n                // other constructors following same pattern\n          \n          \n            \n                public JobDetail(final String jobId, final String parentJobId, final User user, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {   \n          \n          \n            \n                     // do stuff\n          \n          \n            \n                 }", "bodyHTML": "<p dir=\"auto\">This will change the public API which would mean a breaking change. We've committed not to introduce breaking changes in version 1.x. Would it be possible to revert these and add some new constructors.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"74\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k x x-first\">public</span><span class=\"x\"> JobDetail(</span><span class=\"pl-k x\">final</span><span class=\"x\"> </span><span class=\"pl-smi x\">String</span><span class=\"x\"> jobId, </span><span class=\"pl-k x\">final</span><span class=\"x\"> </span><span class=\"pl-smi x\">User</span><span class=\"x\"> user, </span><span class=\"pl-k x\">final</span><span class=\"x\"> </span><span class=\"pl-k x\">OperationChain&lt;?&gt;</span><span class=\"x\"> opChain, </span><span class=\"pl-k x\">final</span><span class=\"x\"> </span><span class=\"pl-smi x\">JobStatus</span><span class=\"x\"> jobStatus, </span><span class=\"pl-k x\">final</span><span class=\"x\"> </span><span class=\"pl-smi x\">String</span><span class=\"x x-last\"> description) {</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"74\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k x x-first x-last\">@Deprecated</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"75\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> JobDetail(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> jobId, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> userId, <span class=\"pl-k\">final</span> <span class=\"pl-k\">OperationChain&lt;?&gt;</span> opChain, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">JobStatus</span> jobStatus, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> description) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"76\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-c1\">this</span>(jobId, <span class=\"pl-c1\">null</span>, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">User</span>(userId), opChain, jobStatus, description);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"77\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"78\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-c\"><span class=\"pl-c\">//</span> other constructors following same pattern</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"79\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> JobDetail(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> jobId, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> parentJobId, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">User</span> user, <span class=\"pl-k\">final</span> <span class=\"pl-k\">OperationChain&lt;?&gt;</span> opChain, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">JobStatus</span> jobStatus, <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> description) {   </td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"80\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">         <span class=\"pl-c\"><span class=\"pl-c\">//</span> do stuff</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"81\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "d47853", "createdAt": "2020-04-21T07:22:35Z", "path": "core/operation/src/main/java/uk/gov/gchq/gaffer/jobtracker/JobDetail.java", "diffHunk": "@@ -60,36 +66,37 @@ public JobDetail(final JobDetail oldJobDetail, final JobDetail newJobDetail) {\n         }\n     }\n \n-    public JobDetail(final String jobId, final String userId, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {\n-        this(jobId, null, userId, opChain, jobStatus, description);\n+    public JobDetail(final String jobId, final User user, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {", "originalCommit": "2ffd064138c5308ca0ba04097bbefedafafdd7c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI1MDQ1OQ==", "url": "https://github.com/gchq/Gaffer/pull/2269#discussion_r412250459", "bodyText": "Re-instated deleted code and marked @deprecated", "author": "m29827", "createdAt": "2020-04-21T14:46:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkzNTkyMg=="}], "type": "inlineReview", "revised_code": {"commit": "5162af4b4c9380c4d76099ea30fc4682fced6661", "changed_code": [{"header": "diff --git a/core/operation/src/main/java/uk/gov/gchq/gaffer/jobtracker/JobDetail.java b/core/operation/src/main/java/uk/gov/gchq/gaffer/jobtracker/JobDetail.java\nindex def13fc84a..567c8ed265 100644\n--- a/core/operation/src/main/java/uk/gov/gchq/gaffer/jobtracker/JobDetail.java\n+++ b/core/operation/src/main/java/uk/gov/gchq/gaffer/jobtracker/JobDetail.java\n", "chunk": "@@ -66,12 +66,23 @@ public class JobDetail implements Serializable {\n         }\n     }\n \n+    @Deprecated\n+    public JobDetail(final String jobId, final String userId, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {\n+        this(jobId, null, userId, opChain, jobStatus, description);\n+    }\n+\n     public JobDetail(final String jobId, final User user, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {\n         this(jobId, null, user, opChain, jobStatus, description);\n     }\n \n-    public JobDetail(final String jobId, final User user, final String opChain, final JobStatus jobStatus, final String description) {\n-        this(jobId, null, user, opChain, jobStatus, description);\n+    @Deprecated\n+    public JobDetail(final String jobId, final String userId, final String opChain, final JobStatus jobStatus, final String description) {\n+        this(jobId, null, userId, opChain, jobStatus, description);\n+    }\n+\n+    @Deprecated\n+    public JobDetail(final String jobId, final String parentJobId, final String userId, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {\n+        this(jobId, parentJobId, new User(userId), opChain, jobStatus, description);\n     }\n \n     public JobDetail(final String jobId, final String parentJobId, final User user, final OperationChain<?> opChain, final JobStatus jobStatus, final String description) {\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkzNzQ0Nw==", "url": "https://github.com/gchq/Gaffer/pull/2269#discussion_r411937447", "body": "Add a serialVersionUID", "bodyText": "Add a serialVersionUID", "bodyHTML": "<p dir=\"auto\">Add a serialVersionUID</p>", "author": "d47853", "createdAt": "2020-04-21T07:24:48Z", "path": "core/operation/src/main/java/uk/gov/gchq/gaffer/user/User.java", "diffHunk": "@@ -34,7 +35,8 @@\n  * uses the values of the dataAuths and opAuths objects associated with the user\n  * to determine if they are allowed to perform the operation or not.\n  */\n-public class User {\n+public class User implements Serializable {\n+", "originalCommit": "2ffd064138c5308ca0ba04097bbefedafafdd7c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI0OTc5Mw==", "url": "https://github.com/gchq/Gaffer/pull/2269#discussion_r412249793", "bodyText": "Added serialVersionUID", "author": "m29827", "createdAt": "2020-04-21T14:45:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkzNzQ0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "5162af4b4c9380c4d76099ea30fc4682fced6661", "changed_code": [{"header": "diff --git a/core/operation/src/main/java/uk/gov/gchq/gaffer/user/User.java b/core/operation/src/main/java/uk/gov/gchq/gaffer/user/User.java\nindex 7a8a5162fe..eff0376391 100644\n--- a/core/operation/src/main/java/uk/gov/gchq/gaffer/user/User.java\n+++ b/core/operation/src/main/java/uk/gov/gchq/gaffer/user/User.java\n", "chunk": "@@ -37,6 +37,8 @@ import static java.util.Objects.nonNull;\n  */\n public class User implements Serializable {\n \n+    private static final long serialVersionUID = -2446354817298439281L;\n+\n     public static final String UNKNOWN_USER_ID = \"UNKNOWN\";\n     private final String userId;\n     private final Set<String> dataAuths = new HashSet<>();\n", "next_change": null}]}}, {"oid": "5162af4b4c9380c4d76099ea30fc4682fced6661", "url": "https://github.com/gchq/Gaffer/commit/5162af4b4c9380c4d76099ea30fc4682fced6661", "message": "gh-2216 Code review comments:\n- Adding serialVersionId to User\n- Ensure no breaking API changes in JobDetail", "committedDate": "2020-04-21T14:23:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI4MTY1Mw==", "url": "https://github.com/gchq/Gaffer/pull/2269#discussion_r412281653", "body": "```suggestion\r\n```", "bodyText": "Suggested change", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "d47853", "createdAt": "2020-04-21T15:22:37Z", "path": "core/common-util/src/main/java/uk/gov/gchq/gaffer/commonutil/ExecutorService.java", "diffHunk": "@@ -36,13 +37,16 @@ private ExecutorService() {\n         // private constructor to prevent instantiation\n     }\n \n-    public static void initialise(final int jobExecutorThreadCount) {\n-        LOGGER.debug(\"Initialising ExecutorService with \" + jobExecutorThreadCount + \" threads\");\n-        service = Executors.newScheduledThreadPool(jobExecutorThreadCount, runnable -> {\n-            final Thread thread = new Thread(runnable);\n-            thread.setDaemon(true);\n-            return thread;\n-        });\n+    public static synchronized void initialise(final int jobExecutorThreadCount) {\n+", "originalCommit": "5162af4b4c9380c4d76099ea30fc4682fced6661", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c9f7d47e3e7bca024e82139fb6f171840e6b79dd", "changed_code": [{"header": "diff --git a/core/common-util/src/main/java/uk/gov/gchq/gaffer/commonutil/ExecutorService.java b/core/common-util/src/main/java/uk/gov/gchq/gaffer/commonutil/ExecutorService.java\nindex 7138ec0f9a..cbb8535a01 100644\n--- a/core/common-util/src/main/java/uk/gov/gchq/gaffer/commonutil/ExecutorService.java\n+++ b/core/common-util/src/main/java/uk/gov/gchq/gaffer/commonutil/ExecutorService.java\n", "chunk": "@@ -38,7 +38,6 @@ public final class ExecutorService {\n     }\n \n     public static synchronized void initialise(final int jobExecutorThreadCount) {\n-\n         if (service == null) {\n             LOGGER.debug(\"Initialising ExecutorService with \" + jobExecutorThreadCount + \" threads\");\n             service = Executors.newScheduledThreadPool(jobExecutorThreadCount, runnable -> {\n", "next_change": null}]}}, {"oid": "c9f7d47e3e7bca024e82139fb6f171840e6b79dd", "url": "https://github.com/gchq/Gaffer/commit/c9f7d47e3e7bca024e82139fb6f171840e6b79dd", "message": "Removed whitespace", "committedDate": "2020-04-22T13:04:48Z", "type": "commit"}, {"oid": "463f9bae1fe9cad6735381e57f0916029ebb7bb7", "url": "https://github.com/gchq/Gaffer/commit/463f9bae1fe9cad6735381e57f0916029ebb7bb7", "message": "Merge branch 'develop' into gh-2216-scheduled-jobs-will-not-reschedule", "committedDate": "2020-04-22T13:04:56Z", "type": "commit"}]}