{"pr_number": 4144, "pr_title": "Fix Usage failed to get pid", "pr_author": "div8cn", "pr_createdAt": "2020-06-11T17:38:18Z", "pr_url": "https://github.com/apache/cloudstack/pull/4144", "timeline": [{"oid": "c3573cbc615ab445d60fb06a0f2d02569f97eafb", "url": "https://github.com/apache/cloudstack/commit/c3573cbc615ab445d60fb06a0f2d02569f97eafb", "message": "Update UsageManagerImpl.java\n\nWhen System.getProperty Failure to get the PID will cause the service to stay in the config phase. The startup cannot continue and there will be no log output\r\nUse managementfactory to get the PID and throw an exception when the PID cannot be obtained.", "committedDate": "2020-06-11T17:27:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI0NTM4Ng==", "url": "https://github.com/apache/cloudstack/pull/4144#discussion_r447245386", "body": "Should we add a more meaningful message here so its more clear?", "bodyText": "Should we add a more meaningful message here so its more clear?", "bodyHTML": "<p dir=\"auto\">Should we add a more meaningful message here so its more clear?</p>", "author": "ravening", "createdAt": "2020-06-29T20:49:45Z", "path": "usage/src/main/java/com/cloud/usage/UsageManagerImpl.java", "diffHunk": "@@ -275,7 +277,14 @@ public boolean configure(String name, Map<String, Object> params) throws Configu\n             s_logger.error(\"Unhandled exception configuring UsageManger\", e);\n             throw new ConfigurationException(\"Unhandled exception configuring UsageManager \" + e.toString());\n         }\n-        _pid = Integer.parseInt(System.getProperty(\"pid\"));\n+\n+        try {\n+            String processName = ManagementFactory.getRuntimeMXBean().getName();\n+            _pid = Integer.parseInt(processName.split(\"@\")[0]);\n+        } catch (Exception e) {\n+            s_logger.error(\"Unable to get process pid \", e);\n+            throw new ConfigurationException(\"Unable to get process pid \" + e.toString());", "originalCommit": "c3573cbc615ab445d60fb06a0f2d02569f97eafb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1OTgyNg==", "url": "https://github.com/apache/cloudstack/pull/4144#discussion_r465259826", "bodyText": "I'm all for clarity @ravening . what do you suggest?", "author": "DaanHoogland", "createdAt": "2020-08-04T18:52:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI0NTM4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYzNjExMA==", "url": "https://github.com/apache/cloudstack/pull/4144#discussion_r461636110", "body": "1. twice the same message should be in a string constand\r\n1. rethrown should not abandon the stack trace for the original problem\r\n```suggestion\r\n        String processName;\r\n        try {\r\n            processName = ManagementFactory.getRuntimeMXBean().getName();\r\n            _pid = Integer.parseInt(processName.split(\"@\")[0]);\r\n        } catch (Exception e) {\r\n            String msg = String.format(\"Unable to get process Id for %s!\", processName);\r\n            s_logger.error(msg);\r\n            throw new ConfigurationException(msg, e);\r\n        }\r\n```\r\nor\r\n```suggestion\r\n        String processName;\r\n        try {\r\n            processName = ManagementFactory.getRuntimeMXBean().getName();\r\n            _pid = Integer.parseInt(processName.split(\"@\")[0]);\r\n        } catch (Exception e) {\r\n            String msg = String.format(\"Unable to get process Id for %s!\", processName);\r\n            s_logger.debug(msg , e);\r\n            throw new ConfigurationException(msg, e);\r\n        }\r\n```", "bodyText": "twice the same message should be in a string constand\nrethrown should not abandon the stack trace for the original problem\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    try {\n          \n          \n            \n                        String processName = ManagementFactory.getRuntimeMXBean().getName();\n          \n          \n            \n                        _pid = Integer.parseInt(processName.split(\"@\")[0]);\n          \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                        s_logger.error(\"Unable to get process pid \", e);\n          \n          \n            \n                        throw new ConfigurationException(\"Unable to get process pid \" + e.toString());\n          \n          \n            \n                    }\n          \n          \n            \n                    String processName;\n          \n          \n            \n                    try {\n          \n          \n            \n                        processName = ManagementFactory.getRuntimeMXBean().getName();\n          \n          \n            \n                        _pid = Integer.parseInt(processName.split(\"@\")[0]);\n          \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                        String msg = String.format(\"Unable to get process Id for %s!\", processName);\n          \n          \n            \n                        s_logger.error(msg);\n          \n          \n            \n                        throw new ConfigurationException(msg, e);\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nor\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    try {\n          \n          \n            \n                        String processName = ManagementFactory.getRuntimeMXBean().getName();\n          \n          \n            \n                        _pid = Integer.parseInt(processName.split(\"@\")[0]);\n          \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                        s_logger.error(\"Unable to get process pid \", e);\n          \n          \n            \n                        throw new ConfigurationException(\"Unable to get process pid \" + e.toString());\n          \n          \n            \n                    }\n          \n          \n            \n                    String processName;\n          \n          \n            \n                    try {\n          \n          \n            \n                        processName = ManagementFactory.getRuntimeMXBean().getName();\n          \n          \n            \n                        _pid = Integer.parseInt(processName.split(\"@\")[0]);\n          \n          \n            \n                    } catch (Exception e) {\n          \n          \n            \n                        String msg = String.format(\"Unable to get process Id for %s!\", processName);\n          \n          \n            \n                        s_logger.debug(msg , e);\n          \n          \n            \n                        throw new ConfigurationException(msg, e);\n          \n          \n            \n                    }", "bodyHTML": "<ol dir=\"auto\">\n<li>twice the same message should be in a string constand</li>\n<li>rethrown should not abandon the stack trace for the original problem</li>\n</ol>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"285\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">try</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"286\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-smi\">String</span> processName <span class=\"pl-k\">=</span> <span class=\"pl-smi\">ManagementFactory</span><span class=\"pl-k\">.</span>getRuntimeMXBean()<span class=\"pl-k\">.</span>getName();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"287\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            _pid <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Integer</span><span class=\"pl-k\">.</span>parseInt(processName<span class=\"pl-k\">.</span>split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>@<span class=\"pl-pds\">\"</span></span>)[<span class=\"pl-c1\">0</span>]);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"288\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">Exception</span> e) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"289\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            s_logger<span class=\"pl-k\">.</span>error(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unable to get process pid <span class=\"pl-pds\">\"</span></span>, e);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"290\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ConfigurationException</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unable to get process pid <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> e<span class=\"pl-k\">.</span>toString());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"291\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"285\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-smi\">String</span> processName;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"286\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">try</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"287\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            processName <span class=\"pl-k\">=</span> <span class=\"pl-smi\">ManagementFactory</span><span class=\"pl-k\">.</span>getRuntimeMXBean()<span class=\"pl-k\">.</span>getName();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"288\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            _pid <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Integer</span><span class=\"pl-k\">.</span>parseInt(processName<span class=\"pl-k\">.</span>split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>@<span class=\"pl-pds\">\"</span></span>)[<span class=\"pl-c1\">0</span>]);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"289\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">Exception</span> e) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"290\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-smi\">String</span> msg <span class=\"pl-k\">=</span> <span class=\"pl-smi\">String</span><span class=\"pl-k\">.</span>format(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unable to get process Id for %s!<span class=\"pl-pds\">\"</span></span>, processName);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"291\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            s_logger<span class=\"pl-k\">.</span>error(msg);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"292\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ConfigurationException</span>(msg, e);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"293\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">or</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"285\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">try</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"286\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-smi\">String</span> processName <span class=\"pl-k\">=</span> <span class=\"pl-smi\">ManagementFactory</span><span class=\"pl-k\">.</span>getRuntimeMXBean()<span class=\"pl-k\">.</span>getName();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"287\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            _pid <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Integer</span><span class=\"pl-k\">.</span>parseInt(processName<span class=\"pl-k\">.</span>split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>@<span class=\"pl-pds\">\"</span></span>)[<span class=\"pl-c1\">0</span>]);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"288\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">Exception</span> e) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"289\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            s_logger<span class=\"pl-k\">.</span>error(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unable to get process pid <span class=\"pl-pds\">\"</span></span>, e);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"290\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ConfigurationException</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unable to get process pid <span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> e<span class=\"pl-k\">.</span>toString());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"291\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"285\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-smi\">String</span> processName;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"286\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">try</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"287\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            processName <span class=\"pl-k\">=</span> <span class=\"pl-smi\">ManagementFactory</span><span class=\"pl-k\">.</span>getRuntimeMXBean()<span class=\"pl-k\">.</span>getName();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"288\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            _pid <span class=\"pl-k\">=</span> <span class=\"pl-smi\">Integer</span><span class=\"pl-k\">.</span>parseInt(processName<span class=\"pl-k\">.</span>split(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>@<span class=\"pl-pds\">\"</span></span>)[<span class=\"pl-c1\">0</span>]);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"289\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">Exception</span> e) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"290\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-smi\">String</span> msg <span class=\"pl-k\">=</span> <span class=\"pl-smi\">String</span><span class=\"pl-k\">.</span>format(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unable to get process Id for %s!<span class=\"pl-pds\">\"</span></span>, processName);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"291\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            s_logger<span class=\"pl-k\">.</span>debug(msg , e);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"292\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ConfigurationException</span>(msg, e);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"293\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "DaanHoogland", "createdAt": "2020-07-28T14:41:23Z", "path": "usage/src/main/java/com/cloud/usage/UsageManagerImpl.java", "diffHunk": "@@ -275,7 +277,14 @@ public boolean configure(String name, Map<String, Object> params) throws Configu\n             s_logger.error(\"Unhandled exception configuring UsageManger\", e);\n             throw new ConfigurationException(\"Unhandled exception configuring UsageManager \" + e.toString());\n         }\n-        _pid = Integer.parseInt(System.getProperty(\"pid\"));\n+\n+        try {\n+            String processName = ManagementFactory.getRuntimeMXBean().getName();\n+            _pid = Integer.parseInt(processName.split(\"@\")[0]);\n+        } catch (Exception e) {\n+            s_logger.error(\"Unable to get process pid \", e);\n+            throw new ConfigurationException(\"Unable to get process pid \" + e.toString());\n+        }", "originalCommit": "c3573cbc615ab445d60fb06a0f2d02569f97eafb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eba35575a0ad2f1b8bbeea062e9dd058282741c5", "url": "https://github.com/apache/cloudstack/commit/eba35575a0ad2f1b8bbeea062e9dd058282741c5", "message": "Update usage/src/main/java/com/cloud/usage/UsageManagerImpl.java\n\nCo-authored-by: dahn <daan.hoogland@gmail.com>", "committedDate": "2020-07-28T14:43:41Z", "type": "commit"}, {"oid": "1383d18bc90d7941bc3a534021620764e6082675", "url": "https://github.com/apache/cloudstack/commit/1383d18bc90d7941bc3a534021620764e6082675", "message": "Update UsageManagerImpl.java", "committedDate": "2020-08-04T11:42:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ0MTAwNg==", "url": "https://github.com/apache/cloudstack/pull/4144#discussion_r465441006", "body": "@DaanHoogland @div8cn What do you think of using `e.printStackTrace()` to add the stack on the log/ConfigurationException?\r\n\r\nWith `toString` (or simply s_logger.debug(msg , e)) it logs only the exception name and the error message (if there is any message). On the other hand, `printStackTrace()` presents the whole stack trace of an exception, which is very helpful for debugging.", "bodyText": "@DaanHoogland @div8cn What do you think of using e.printStackTrace() to add the stack on the log/ConfigurationException?\nWith toString (or simply s_logger.debug(msg , e)) it logs only the exception name and the error message (if there is any message). On the other hand, printStackTrace() presents the whole stack trace of an exception, which is very helpful for debugging.", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/DaanHoogland/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/DaanHoogland\">@DaanHoogland</a> <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/div8cn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/div8cn\">@div8cn</a> What do you think of using <code>e.printStackTrace()</code> to add the stack on the log/ConfigurationException?</p>\n<p dir=\"auto\">With <code>toString</code> (or simply s_logger.debug(msg , e)) it logs only the exception name and the error message (if there is any message). On the other hand, <code>printStackTrace()</code> presents the whole stack trace of an exception, which is very helpful for debugging.</p>", "author": "GabrielBrascher", "createdAt": "2020-08-05T02:50:53Z", "path": "usage/src/main/java/com/cloud/usage/UsageManagerImpl.java", "diffHunk": "@@ -275,7 +277,16 @@ public boolean configure(String name, Map<String, Object> params) throws Configu\n             s_logger.error(\"Unhandled exception configuring UsageManger\", e);\n             throw new ConfigurationException(\"Unhandled exception configuring UsageManager \" + e.toString());\n         }\n-        _pid = Integer.parseInt(System.getProperty(\"pid\"));\n+\n+        String processName = null;\n+        try {\n+            processName = ManagementFactory.getRuntimeMXBean().getName();\n+            _pid = Integer.parseInt(processName.split(\"@\")[0]);\n+        } catch (Exception e) {\n+            String msg = String.format(\"Unable to get process Id for %s!\", processName);\n+            s_logger.debug(msg , e);\n+            throw new ConfigurationException(msg + \" \" + e.toString());", "originalCommit": "1383d18bc90d7941bc3a534021620764e6082675", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUyNDM1NQ==", "url": "https://github.com/apache/cloudstack/pull/4144#discussion_r465524355", "bodyText": "logger.debug(msg, e) should log the entire stacktrace @GabrielBrascher . and it gives the user to filter or direct the output to a certain stream/file. e.printStacktrace() only logs to stdout (or stderr, i forgot). in short i think not too much of it. I agree toString does not seem the best, but we have alreadyt output the stacktrace by then. A change from toString() to getLocalizedMessage() maybe, @div8cn? Of course we can add the entire exception again i.e. throw new ConfigurationException(msg, e), that's fine as well.", "author": "DaanHoogland", "createdAt": "2020-08-05T07:20:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ0MTAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk1ODM4MQ==", "url": "https://github.com/apache/cloudstack/pull/4144#discussion_r480958381", "body": "@div8cn master is on java 11 now, can you use `ProcessHandle.current().pid()`? I did a quick test:\r\n```\r\n> jshell \r\n|  Welcome to JShell -- Version 11.0.7\r\n|  For an introduction type: /help intro\r\n\r\njshell> ProcessHandle.current().pid()\r\n$1 ==> 20380\r\n\r\n```", "bodyText": "@div8cn master is on java 11 now, can you use ProcessHandle.current().pid()? I did a quick test:\n> jshell \n|  Welcome to JShell -- Version 11.0.7\n|  For an introduction type: /help intro\n\njshell> ProcessHandle.current().pid()\n$1 ==> 20380", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/div8cn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/div8cn\">@div8cn</a> master is on java 11 now, can you use <code>ProcessHandle.current().pid()</code>? I did a quick test:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&gt; jshell \n|  Welcome to JShell -- Version 11.0.7\n|  For an introduction type: /help intro\n\njshell&gt; ProcessHandle.current().pid()\n$1 ==&gt; 20380\n\n\"><pre><code>&gt; jshell \n|  Welcome to JShell -- Version 11.0.7\n|  For an introduction type: /help intro\n\njshell&gt; ProcessHandle.current().pid()\n$1 ==&gt; 20380\n\n</code></pre></div>", "author": "rhtyd", "createdAt": "2020-09-01T08:19:39Z", "path": "usage/src/main/java/com/cloud/usage/UsageManagerImpl.java", "diffHunk": "@@ -275,7 +277,16 @@ public boolean configure(String name, Map<String, Object> params) throws Configu\n             s_logger.error(\"Unhandled exception configuring UsageManger\", e);\n             throw new ConfigurationException(\"Unhandled exception configuring UsageManager \" + e.toString());\n         }\n-        _pid = Integer.parseInt(System.getProperty(\"pid\"));\n+\n+        String processName = null;\n+        try {\n+            processName = ManagementFactory.getRuntimeMXBean().getName();", "originalCommit": "1383d18bc90d7941bc3a534021620764e6082675", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "469652aaccc55cc165bb50a5eaffef446183be70", "url": "https://github.com/apache/cloudstack/commit/469652aaccc55cc165bb50a5eaffef446183be70", "message": "Update UsageManagerImpl.java", "committedDate": "2020-09-02T00:33:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTkwNDMyNg==", "url": "https://github.com/apache/cloudstack/pull/4144#discussion_r481904326", "body": "processName is always null .", "bodyText": "processName is always null .", "bodyHTML": "<p dir=\"auto\">processName is always null .</p>", "author": "weizhouapache", "createdAt": "2020-09-02T08:51:35Z", "path": "usage/src/main/java/com/cloud/usage/UsageManagerImpl.java", "diffHunk": "@@ -280,8 +278,7 @@ public boolean configure(String name, Map<String, Object> params) throws Configu\n \n         String processName = null;\n         try {\n-            processName = ManagementFactory.getRuntimeMXBean().getName();\n-            _pid = Integer.parseInt(processName.split(\"@\")[0]);\n+            _pid = (int) ProcessHandle.current().pid();\n         } catch (Exception e) {\n             String msg = String.format(\"Unable to get process Id for %s!\", processName);", "originalCommit": "469652aaccc55cc165bb50a5eaffef446183be70", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTkzNzQ5OA==", "url": "https://github.com/apache/cloudstack/pull/4144#discussion_r481937498", "body": "processName is not used and can be removed @div8cn ", "bodyText": "processName is not used and can be removed @div8cn", "bodyHTML": "<p dir=\"auto\">processName is not used and can be removed <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/div8cn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/div8cn\">@div8cn</a></p>", "author": "rhtyd", "createdAt": "2020-09-02T09:36:50Z", "path": "usage/src/main/java/com/cloud/usage/UsageManagerImpl.java", "diffHunk": "@@ -275,7 +275,15 @@ public boolean configure(String name, Map<String, Object> params) throws Configu\n             s_logger.error(\"Unhandled exception configuring UsageManger\", e);\n             throw new ConfigurationException(\"Unhandled exception configuring UsageManager \" + e.toString());\n         }\n-        _pid = Integer.parseInt(System.getProperty(\"pid\"));\n+\n+        String processName = null;", "originalCommit": "469652aaccc55cc165bb50a5eaffef446183be70", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2b63caa5c7c75a1391281e08fa63e939657cfe4d", "url": "https://github.com/apache/cloudstack/commit/2b63caa5c7c75a1391281e08fa63e939657cfe4d", "message": "Update UsageManagerImpl.java", "committedDate": "2020-09-02T10:28:17Z", "type": "commit"}]}