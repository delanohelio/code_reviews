{"pr_number": 741, "pr_title": "Respond with 404 when calling operation rest api with invalid operation guid", "pr_author": "radoslav-d", "pr_createdAt": "2020-01-28T15:29:29Z", "pr_url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/741", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4MDIyNg==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/741#discussion_r371880226", "body": "Can be renamed to getOperation", "bodyText": "Can be renamed to getOperation", "bodyHTML": "<p dir=\"auto\">Can be renamed to getOperation</p>", "author": "boyan-velinov", "createdAt": "2020-01-28T15:39:36Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/api/impl/OperationsApiServiceImpl.java", "diffHunk": "@@ -222,13 +205,21 @@ private boolean containsOnlyFinishedStates(List<Operation.State> statusList) {\n \n     @Override\n     public ResponseEntity<List<String>> getOperationActions(String spaceGuid, String operationId) {\n-        Operation operation = operationService.createQuery()\n-                                              .processId(operationId)\n-                                              .singleResult();\n+        Operation operation = queryOperation(operationId);\n         return ResponseEntity.ok()\n                              .body(getAvailableActions(operation));\n     }\n \n+    private Operation queryOperation(String operationId) {", "originalCommit": "4db7087abad1b077a9a78a94ac56440196728469", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1OTMzNw==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/741#discussion_r372259337", "body": "Add the `NoResultException` as a cause for the `NotFoundException`.", "bodyText": "Add the NoResultException as a cause for the NotFoundException.", "bodyHTML": "<p dir=\"auto\">Add the <code>NoResultException</code> as a cause for the <code>NotFoundException</code>.</p>", "author": "nictas", "createdAt": "2020-01-29T09:02:12Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/api/impl/OperationsApiServiceImpl.java", "diffHunk": "@@ -222,13 +205,21 @@ private boolean containsOnlyFinishedStates(List<Operation.State> statusList) {\n \n     @Override\n     public ResponseEntity<List<String>> getOperationActions(String spaceGuid, String operationId) {\n-        Operation operation = operationService.createQuery()\n-                                              .processId(operationId)\n-                                              .singleResult();\n+        Operation operation = queryOperation(operationId);\n         return ResponseEntity.ok()\n                              .body(getAvailableActions(operation));\n     }\n \n+    private Operation queryOperation(String operationId) {\n+        try {\n+            return operationService.createQuery()\n+                .processId(operationId)\n+                .singleResult();\n+        } catch (NoResultException e) {\n+            throw new NotFoundException(Messages.OPERATION_0_NOT_FOUND, operationId);", "originalCommit": "4db7087abad1b077a9a78a94ac56440196728469", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI1OTg0NA==", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/pull/741#discussion_r372259844", "body": "Use this formatter:\r\nhttps://github.com/cloudfoundry-incubator/multiapps/blob/master/ide/eclipse-formatter.xml", "bodyText": "Use this formatter:\nhttps://github.com/cloudfoundry-incubator/multiapps/blob/master/ide/eclipse-formatter.xml", "bodyHTML": "<p dir=\"auto\">Use this formatter:<br>\n<a href=\"https://github.com/cloudfoundry-incubator/multiapps/blob/master/ide/eclipse-formatter.xml\">https://github.com/cloudfoundry-incubator/multiapps/blob/master/ide/eclipse-formatter.xml</a></p>", "author": "nictas", "createdAt": "2020-01-29T09:03:24Z", "path": "com.sap.cloud.lm.sl.cf.web/src/main/java/com/sap/cloud/lm/sl/cf/web/api/impl/OperationsApiServiceImpl.java", "diffHunk": "@@ -222,13 +205,21 @@ private boolean containsOnlyFinishedStates(List<Operation.State> statusList) {\n \n     @Override\n     public ResponseEntity<List<String>> getOperationActions(String spaceGuid, String operationId) {\n-        Operation operation = operationService.createQuery()\n-                                              .processId(operationId)\n-                                              .singleResult();\n+        Operation operation = queryOperation(operationId);\n         return ResponseEntity.ok()\n                              .body(getAvailableActions(operation));\n     }\n \n+    private Operation queryOperation(String operationId) {\n+        try {\n+            return operationService.createQuery()\n+                .processId(operationId)", "originalCommit": "4db7087abad1b077a9a78a94ac56440196728469", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ea7dad21cdcf5e5e7987986d73a87ff0319ac95c", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ea7dad21cdcf5e5e7987986d73a87ff0319ac95c", "message": "Respond 404 when guid is invalid in operation api\n\nCatch NoResultException, which originates from JPA, when quering the\noperations by ID. Throw NotFoundException, which is mapped to 404 status\ncode. JIRA: LMCROSSITXSADEPLOY-1864", "committedDate": "2020-01-29T09:30:32Z", "type": "commit"}, {"oid": "ea7dad21cdcf5e5e7987986d73a87ff0319ac95c", "url": "https://github.com/cloudfoundry-incubator/multiapps-controller/commit/ea7dad21cdcf5e5e7987986d73a87ff0319ac95c", "message": "Respond 404 when guid is invalid in operation api\n\nCatch NoResultException, which originates from JPA, when quering the\noperations by ID. Throw NotFoundException, which is mapped to 404 status\ncode. JIRA: LMCROSSITXSADEPLOY-1864", "committedDate": "2020-01-29T09:30:32Z", "type": "forcePushed"}]}