{"pr_number": 7756, "pr_title": "[weatherunderground] Log URL with masked API key", "pr_author": "lolodomo", "pr_createdAt": "2020-05-23T18:29:08Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7756", "timeline": [{"oid": "c9448fec0331892b277fddfd604bbe3d6e569b66", "url": "https://github.com/openhab/openhab-addons/commit/c9448fec0331892b277fddfd604bbe3d6e569b66", "message": "[weatherunderground] Log URL with masked API key\n\nRelative to #3990\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-05-23T18:26:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjgwMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7756#discussion_r429572801", "body": "We are currently in the process of removing use of apache commons.lang from addons, so please implement `trimToEmpty` by hand here.", "bodyText": "We are currently in the process of removing use of apache commons.lang from addons, so please implement trimToEmpty by hand here.", "bodyHTML": "<p dir=\"auto\">We are currently in the process of removing use of apache commons.lang from addons, so please implement <code>trimToEmpty</code> by hand here.</p>", "author": "cpmeister", "createdAt": "2020-05-23T19:40:54Z", "path": "bundles/org.openhab.binding.weatherunderground/src/main/java/org/openhab/binding/weatherunderground/internal/handler/WeatherUndergroundHandler.java", "diffHunk": "@@ -553,7 +551,9 @@ private boolean updateWeatherData(Set<String> features) {\n             }\n \n             urlStr = urlStr.replace(\"%QUERY%\", StringUtils.trimToEmpty(config.location));\n-            logger.debug(\"URL = {}\", urlStr);\n+            logger.debug(\"URL = {}\", urlStr.replace(\"%APIKEY%\", \"***\"));\n+\n+            urlStr = urlStr.replace(\"%APIKEY%\", StringUtils.trimToEmpty(bridgeHandler.getApikey()));", "originalCommit": "c9448fec0331892b277fddfd604bbe3d6e569b66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3NDAwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7756#discussion_r429574006", "bodyText": "I will do it in a separate PR please.\nAs you can see in my current PR, this line is not new but just moved.\nJust changing this line would have no sense as there are several similar lines to be changed.\nAnd I consider this PR as of a higher priority (security).", "author": "lolodomo", "createdAt": "2020-05-23T20:00:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjgwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3OTM3NA==", "url": "https://github.com/openhab/openhab-addons/pull/7756#discussion_r429579374", "body": "```suggestion\r\n            if(logger.isDebugEnabled()){\r\n                logger.debug(\"URL = {}\", urlStr.replace(\"%APIKEY%\", \"***\"));\r\n            }\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logger.debug(\"URL = {}\", urlStr.replace(\"%APIKEY%\", \"***\"));\n          \n          \n            \n                        if(logger.isDebugEnabled()){\n          \n          \n            \n                            logger.debug(\"URL = {}\", urlStr.replace(\"%APIKEY%\", \"***\"));\n          \n          \n            \n                        }", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            logger<span class=\"pl-k\">.</span><span class=\"x x-first\">debug(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">URL = {}</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">, urlStr</span><span class=\"pl-k x\">.</span><span class=\"x\">replace(</span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">%APIKEY%</span><span class=\"pl-pds x\">\"</span></span><span class=\"x\">, </span><span class=\"pl-s\"><span class=\"pl-pds x\">\"</span><span class=\"x\">***</span><span class=\"pl-pds x\">\"</span></span><span class=\"x x-last\">));</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k x x-first\">if</span><span class=\"x x-last\">(</span>logger<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">isDebugEnabled()){</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                logger<span class=\"pl-k\">.</span>debug(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>URL = {}<span class=\"pl-pds\">\"</span></span>, urlStr<span class=\"pl-k\">.</span>replace(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>%APIKEY%<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>***<span class=\"pl-pds\">\"</span></span>));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-05-23T21:23:42Z", "path": "bundles/org.openhab.binding.weatherunderground/src/main/java/org/openhab/binding/weatherunderground/internal/handler/WeatherUndergroundHandler.java", "diffHunk": "@@ -553,7 +551,9 @@ private boolean updateWeatherData(Set<String> features) {\n             }\n \n             urlStr = urlStr.replace(\"%QUERY%\", StringUtils.trimToEmpty(config.location));\n-            logger.debug(\"URL = {}\", urlStr);\n+            logger.debug(\"URL = {}\", urlStr.replace(\"%APIKEY%\", \"***\"));", "originalCommit": "c9448fec0331892b277fddfd604bbe3d6e569b66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4MDY5MA==", "url": "https://github.com/openhab/openhab-addons/pull/7756#discussion_r429580690", "bodyText": "What's the interest to add this test?", "author": "lolodomo", "createdAt": "2020-05-23T21:46:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3OTM3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4MjAwMg==", "url": "https://github.com/openhab/openhab-addons/pull/7756#discussion_r429582002", "bodyText": "Since users may not be interested in debug logging, and as such would be filtered out, you should try to minimize wasting computational resources on creating values to be logged.\nIn this case String.replace involves a search and replace, the result of which might not even be used. So in order to prevent unnecessary calls to this operation we just check if that logging level is even enabled in the first place.", "author": "cpmeister", "createdAt": "2020-05-23T22:09:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3OTM3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYwNjMwNw==", "url": "https://github.com/openhab/openhab-addons/pull/7756#discussion_r429606307", "bodyText": "Ok, done.", "author": "lolodomo", "createdAt": "2020-05-24T07:02:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3OTM3NA=="}], "type": "inlineReview"}, {"oid": "2bb3390969893a3c4e4a7a852536bf99160d656e", "url": "https://github.com/openhab/openhab-addons/commit/2bb3390969893a3c4e4a7a852536bf99160d656e", "message": "Add isDebugEnabled\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-05-24T07:00:51Z", "type": "commit"}]}