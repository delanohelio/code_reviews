{"pr_number": 9176, "pr_title": "[miio] Add discovery from cloud feature.", "pr_author": "marcelrv", "pr_createdAt": "2020-11-29T20:37:37Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9176", "timeline": [{"oid": "11261a27cf8a3b676009a122d5e0a05f5d2d4252", "url": "https://github.com/openhab/openhab-addons/commit/11261a27cf8a3b676009a122d5e0a05f5d2d4252", "message": "[miio] Add discovery from cloud feature.\n\nThis allows to discover things that are not directly on the same subnet\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-11-29T20:20:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5OTQ5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r532999499", "body": "```suggestion\r\n                    boolean isOnline = device.getIsOnline();\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                Boolean isOnline = device.getIsOnline();\n          \n          \n            \n                                boolean isOnline = device.getIsOnline();", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                    <span class=\"pl-smi x x-first x-last\">Boolean</span> isOnline <span class=\"pl-k\">=</span> device<span class=\"pl-k\">.</span>getIsOnline();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                    <span class=\"pl-k x x-first x-last\">boolean</span> isOnline <span class=\"pl-k\">=</span> device<span class=\"pl-k\">.</span>getIsOnline();</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-12-01T00:48:08Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/discovery/MiIoDiscovery.java", "diffHunk": "@@ -133,6 +169,33 @@ private void discover() {\n         }\n     }\n \n+    private void cloudDiscovery() {\n+        String cloudDiscoveryMode = getCloudDiscoveryMode();\n+        if (cloudConnector.isConnected()) {\n+            List<CloudDeviceDTO> dv = cloudConnector.getDevicesList();\n+            for (CloudDeviceDTO device : dv) {\n+                String id = String.format(\"%08X\", Long.parseUnsignedLong(device.getDid()));\n+                if (cloudDiscoveryMode.contentEquals(SUPPORTED)) {\n+                    if (MiIoDevices.getType(device.getModel()).getThingType().equals(THING_TYPE_UNSUPPORTED)) {\n+                        logger.warn(\"Discovered from cloud, but ignored because not supported: {} {}\", id, device);\n+                    }\n+                }\n+                if (device.getIsOnline()) {\n+                    logger.debug(\"Discovered from cloud: {} {}\", id, device);\n+                    cloudDevices.put(id, device.getLocalip());\n+                    String token = device.getToken();\n+                    String label = device.getName() + \" \" + id + \" (\" + device.getDid() + \")\";\n+                    String country = device.getServer();\n+                    Boolean isOnline = device.getIsOnline();", "originalCommit": "11261a27cf8a3b676009a122d5e0a05f5d2d4252", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5OTY5Nw==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r532999697", "body": "```suggestion\r\n    private @Nullable Configuration miioConfig;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Nullable\n          \n          \n            \n                private Configuration miioConfig;\n          \n          \n            \n                private @Nullable Configuration miioConfig;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">@Nullable</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">Configuration</span> miioConfig;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">@Nullable</span> <span class=\"pl-smi\">Configuration</span> miioConfig;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-12-01T00:48:43Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/discovery/MiIoDiscovery.java", "diffHunk": "@@ -66,11 +76,33 @@\n \n     private final Logger logger = LoggerFactory.getLogger(MiIoDiscovery.class);\n     private final CloudConnector cloudConnector;\n+    private Map<String, String> cloudDevices = new HashMap<>();\n+    @Nullable\n+    private Configuration miioConfig;", "originalCommit": "11261a27cf8a3b676009a122d5e0a05f5d2d4252", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwMTIwMw==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r533001203", "body": "Is there a reason you did `contains` instead of `equals`? If not then you can simplify the code.\r\n```suggestion\r\n        if(ip.equals(cloudDevices.get(id)){\r\n            logger.debug(\"Skipped adding local found {}. Already discovered by cloud.\", label);\r\n            return;\r\n        }\r\n```", "bodyText": "Is there a reason you did contains instead of equals? If not then you can simplify the code.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (cloudDevices.containsKey(id)) {\n          \n          \n            \n                        if (cloudDevices.get(id).contains(ip)) {\n          \n          \n            \n                            logger.debug(\"Skipped adding local found {}. Already discovered by cloud.\", label);\n          \n          \n            \n                            return;\n          \n          \n            \n                        }\n          \n          \n            \n                    }\n          \n          \n            \n                    if(ip.equals(cloudDevices.get(id)){\n          \n          \n            \n                        logger.debug(\"Skipped adding local found {}. Already discovered by cloud.\", label);\n          \n          \n            \n                        return;\n          \n          \n            \n                    }", "bodyHTML": "<p dir=\"auto\">Is there a reason you did <code>contains</code> instead of <code>equals</code>? If not then you can simplify the code.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"215\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (cloudDevices<span class=\"pl-k\">.</span>containsKey(id)) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"216\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">if</span> (cloudDevices<span class=\"pl-k\">.</span>get(id)<span class=\"pl-k\">.</span>contains(ip)) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"217\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                logger<span class=\"pl-k\">.</span>debug(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Skipped adding local found {}. Already discovered by cloud.<span class=\"pl-pds\">\"</span></span>, label);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"218\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">return</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"219\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"220\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"215\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">if</span>(ip<span class=\"pl-k\">.</span>equals(cloudDevices<span class=\"pl-k\">.</span>get(id)){</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"216\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            logger<span class=\"pl-k\">.</span>debug(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Skipped adding local found {}. Already discovered by cloud.<span class=\"pl-pds\">\"</span></span>, label);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"217\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">return</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"218\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-12-01T00:53:07Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/discovery/MiIoDiscovery.java", "diffHunk": "@@ -141,6 +204,12 @@ private void discovered(String ip, byte[] response) {\n         String label = \"Xiaomi Mi Device \" + id + \" (\" + Long.parseUnsignedLong(id, 16) + \")\";\n         String country = \"\";\n         boolean isOnline = false;\n+        if (cloudDevices.containsKey(id)) {\n+            if (cloudDevices.get(id).contains(ip)) {\n+                logger.debug(\"Skipped adding local found {}. Already discovered by cloud.\", label);\n+                return;\n+            }\n+        }", "originalCommit": "11261a27cf8a3b676009a122d5e0a05f5d2d4252", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc3Njg0MA==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r533776840", "bodyText": "Yours is better indeed. The contains was only to avoid the NPE", "author": "marcelrv", "createdAt": "2020-12-01T22:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwMTIwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwMTU2Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r533001566", "body": "If there is change this would be modified by multiple threads the you should use ConcurrentHashMap instead.", "bodyText": "If there is change this would be modified by multiple threads the you should use ConcurrentHashMap instead.", "bodyHTML": "<p dir=\"auto\">If there is change this would be modified by multiple threads the you should use ConcurrentHashMap instead.</p>", "author": "cpmeister", "createdAt": "2020-12-01T00:54:13Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/discovery/MiIoDiscovery.java", "diffHunk": "@@ -66,11 +76,33 @@\n \n     private final Logger logger = LoggerFactory.getLogger(MiIoDiscovery.class);\n     private final CloudConnector cloudConnector;\n+    private Map<String, String> cloudDevices = new HashMap<>();", "originalCommit": "11261a27cf8a3b676009a122d5e0a05f5d2d4252", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "59bca6dd7c8bba4d62f8ba3f0354172a38aaea47", "url": "https://github.com/openhab/openhab-addons/commit/59bca6dd7c8bba4d62f8ba3f0354172a38aaea47", "message": "[miio] update based on review\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-12-01T22:55:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUzMzc5Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r535533793", "body": "Please do proper null checks instead of just catching the NullPointerException.", "bodyText": "Please do proper null checks instead of just catching the NullPointerException.", "bodyHTML": "<p dir=\"auto\">Please do proper null checks instead of just catching the NullPointerException.</p>", "author": "cpmeister", "createdAt": "2020-12-03T19:42:17Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/discovery/MiIoDiscovery.java", "diffHunk": "@@ -66,11 +76,32 @@\n \n     private final Logger logger = LoggerFactory.getLogger(MiIoDiscovery.class);\n     private final CloudConnector cloudConnector;\n+    private Map<String, String> cloudDevices = new ConcurrentHashMap<>();\n+    private @Nullable Configuration miioConfig;\n \n     @Activate\n-    public MiIoDiscovery(@Reference CloudConnector cloudConnector) throws IllegalArgumentException {\n+    public MiIoDiscovery(@Reference CloudConnector cloudConnector, @Reference ConfigurationAdmin configAdmin)\n+            throws IllegalArgumentException {\n         super(DISCOVERY_TIME);\n         this.cloudConnector = cloudConnector;\n+        try {\n+            miioConfig = configAdmin.getConfiguration(\"binding.miio\");\n+        } catch (IOException | SecurityException e) {\n+            logger.debug(\"Error getting configuration: {}\", e.getMessage());\n+        }\n+    }\n+\n+    private String getCloudDiscoveryMode() {\n+        if (miioConfig != null) {\n+            try {\n+                Dictionary<String, Object> properties = miioConfig.getProperties();\n+                String cloudDiscoveryModeConfig = ((String) properties.get(\"cloudDiscoveryMode\")).toLowerCase();\n+                return Set.of(SUPPORTED, ALL).contains(cloudDiscoveryModeConfig) ? cloudDiscoveryModeConfig : DISABLED;\n+            } catch (NullPointerException | ClassCastException | SecurityException e) {", "originalCommit": "59bca6dd7c8bba4d62f8ba3f0354172a38aaea47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkyMDczOQ==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r535920739", "bodyText": "yes, did that... I did it in the former way to avoid one more dead code warning.\nSomehow it assumes that the result of a Map.get is a notnull and complains about the null check.\nI don't know how to tell it that it can be a Null", "author": "marcelrv", "createdAt": "2020-12-04T08:29:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUzMzc5Mw=="}], "type": "inlineReview"}, {"oid": "c6978200d501b84e90de2ee19d9269a9c9f4d95c", "url": "https://github.com/openhab/openhab-addons/commit/c6978200d501b84e90de2ee19d9269a9c9f4d95c", "message": "[miio] update based on code review\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-12-04T08:29:19Z", "type": "commit"}, {"oid": "19e741473c527ebc828ce5b90ee91c06dbdac73c", "url": "https://github.com/openhab/openhab-addons/commit/19e741473c527ebc828ce5b90ee91c06dbdac73c", "message": "[miio] avoid dead code warning\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-12-04T09:54:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQwNzAwNw==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r536407007", "body": "Is it guaranteed that `id` is an integer at this point? You make no attempt to catch the NumberFormatException that this would throw. If you know that it is an integer why not have the `id` passed as a long parameter instead?", "bodyText": "Is it guaranteed that id is an integer at this point? You make no attempt to catch the NumberFormatException that this would throw. If you know that it is an integer why not have the id passed as a long parameter instead?", "bodyHTML": "<p dir=\"auto\">Is it guaranteed that <code>id</code> is an integer at this point? You make no attempt to catch the NumberFormatException that this would throw. If you know that it is an integer why not have the <code>id</code> passed as a long parameter instead?</p>", "author": "cpmeister", "createdAt": "2020-12-04T21:56:31Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/discovery/MiIoDiscovery.java", "diffHunk": "@@ -152,17 +224,22 @@ private void discovered(String ip, byte[] response) {\n                 isOnline = cloudInfo.getIsOnline();\n             }\n         }\n+        submitDiscovery(ip, token, id, label, country, isOnline);\n+    }\n+\n+    private void submitDiscovery(String ip, String token, String id, String label, String country, boolean isOnline) {\n         ThingUID uid = new ThingUID(THING_TYPE_MIIO, id);\n-        logger.debug(\"Discovered Mi Device {} ({}) at {} as {}\", id, Long.parseUnsignedLong(id, 16), ip, uid);\n         DiscoveryResultBuilder dr = DiscoveryResultBuilder.create(uid).withProperty(PROPERTY_HOST_IP, ip)\n                 .withProperty(PROPERTY_DID, id);\n         if (IGNORED_TOKENS.contains(token)) {\n+            logger.debug(\"Discovered Mi Device {} ({}) at {} as {}\", id, Long.parseUnsignedLong(id, 16), ip, uid);", "originalCommit": "19e741473c527ebc828ce5b90ee91c06dbdac73c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQzNzI5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r536437292", "bodyText": "it is a HEX string in this setting..\nBut I can indeed surround it with a try/catch NumberFormatException", "author": "marcelrv", "createdAt": "2020-12-04T23:09:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQwNzAwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQzNzgwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/9176#discussion_r536437805", "bodyText": "This is how it looks like", "author": "marcelrv", "createdAt": "2020-12-04T23:11:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQwNzAwNw=="}], "type": "inlineReview"}, {"oid": "9e3f43b74deb03eeb531f42dc3d599a9af7808c6", "url": "https://github.com/openhab/openhab-addons/commit/9e3f43b74deb03eeb531f42dc3d599a9af7808c6", "message": "[miio] safe conversions did\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-12-05T00:27:34Z", "type": "commit"}]}