{"pr_number": 8637, "pr_title": "[miio] add new map elements", "pr_author": "marcelrv", "pr_createdAt": "2020-10-02T21:17:10Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8637", "timeline": [{"oid": "bb2d8c830807acea5fc3d79c41d36123087ad79d", "url": "https://github.com/openhab/openhab-addons/commit/bb2d8c830807acea5fc3d79c41d36123087ad79d", "message": "[miio] add new map elements\n\nAdd newly found mapelements for obstacles\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-10-02T21:12:43Z", "type": "commit"}, {"oid": "10f101c232716bf1b30a87d1cab7d490c2c64564", "url": "https://github.com/openhab/openhab-addons/commit/10f101c232716bf1b30a87d1cab7d490c2c64564", "message": "[miio] apply spotless\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-10-02T22:45:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MDQyNA==", "url": "https://github.com/openhab/openhab-addons/pull/8637#discussion_r499090424", "body": "Is there a reason you are only allowing 15 colors instead of the full 16?\r\n```suggestion\r\n                                g2d.setColor(ROOM_COLORS[mapId % ROOM_COLORS.length]);\r\n```", "bodyText": "Is there a reason you are only allowing 15 colors instead of the full 16?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            g2d.setColor(ROOM_COLORS[mapId % 15]);\n          \n          \n            \n                                            g2d.setColor(ROOM_COLORS[mapId % ROOM_COLORS.length]);", "bodyHTML": "<p dir=\"auto\">Is there a reason you are only allowing 15 colors instead of the full 16?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"168\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                                g2d<span class=\"pl-k\">.</span>setColor(<span class=\"pl-c1\">ROOM_COLORS</span>[mapId <span class=\"pl-k\">%</span> <span class=\"pl-c1 x x-first x-last\">15</span>]);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"168\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                                g2d<span class=\"pl-k\">.</span>setColor(<span class=\"pl-c1\">ROOM_COLORS</span>[mapId <span class=\"pl-k\">%</span> <span class=\"pl-c1 x x-first\">ROOM_COLORS</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">length</span>]);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-10-02T23:43:48Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/robot/RRMapDraw.java", "diffHunk": "@@ -160,7 +165,8 @@ private void drawMap(Graphics2D g2d, float scale) {\n                                 g2d.setColor(Color.BLACK);\n                                 break;\n                             case 7:\n-                                g2d.setColor(ROOM_COLORS[Math.round(mapId / 2)]);\n+                                g2d.setColor(ROOM_COLORS[mapId % 15]);", "originalCommit": "10f101c232716bf1b30a87d1cab7d490c2c64564", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEyNjY1NQ==", "url": "https://github.com/openhab/openhab-addons/pull/8637#discussion_r499126655", "bodyText": "yes, I saw that in quite a few occasions somehow both room 1 & 17 were defined. (without many in between)\nThat made the color the same for both rooms, hence not recognizable as separate rooms anymore.\nso this is little hack to avoid that... double colors can obviously still occur, but this seems to reduce the chance.", "author": "marcelrv", "createdAt": "2020-10-03T08:00:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MDQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0Mzc0MA==", "url": "https://github.com/openhab/openhab-addons/pull/8637#discussion_r499143740", "bodyText": "Can't you just make sure that each room has a unique color?", "author": "cpmeister", "createdAt": "2020-10-03T12:28:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MDQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0MTA1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/8637#discussion_r499241056", "bodyText": "not easy to find 32 distinct colors while keeping the path, walls, vacuum etc still properly visible.\nThe Xiaomi app also does not do that.. don't know exactly how many they are using, but certainly not 32.\nHence originally I created 16 colors.. Seeing some of the maps from other (I don't have a vacuum that produces these roomcolor maps) I recognized that several ones had overlapping colors, hence the 16 colors and divide rooms/2 was maybe bit of a unlucky choice.", "author": "marcelrv", "createdAt": "2020-10-04T12:24:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MDQyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MDgwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/8637#discussion_r499090805", "body": "```suggestion\r\n        for (ArrayList<int[]> value : obstacles.values()) {\r\n            value.forEach(obstacle -> {\r\n                final float obstacleX = toXCoord(obstacle[0]) * scale;\r\n                final float obstacleY = toYCoord(obstacle[1]) * scale;\r\n                drawCircle(g2d, obstacleX, obstacleY, radius, true);\r\n                if (scale > 1.0) {\r\n                    drawCenteredImg(g2d, scale / 3, \"obstacle-\" + obstacle[2] + \".png\", obstacleX, obstacleY + 15);\r\n                }\r\n            });\r\n        }\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for (Integer obstacleType : obstacles.keySet()) {\n          \n          \n            \n                        obstacles.get(obstacleType).forEach(obstacle -> {\n          \n          \n            \n                            final float obstacleX = toXCoord(obstacle[0]) * scale;\n          \n          \n            \n                            final float obstacleY = toYCoord(obstacle[1]) * scale;\n          \n          \n            \n                            drawCircle(g2d, obstacleX, obstacleY, radius, true);\n          \n          \n            \n                            if (scale > 1.0) {\n          \n          \n            \n                                drawCenteredImg(g2d, scale / 3, \"obstacle-\" + obstacle[2] + \".png\", obstacleX, obstacleY + 15);\n          \n          \n            \n                            }\n          \n          \n            \n                        });\n          \n          \n            \n            \n          \n          \n            \n                    }\n          \n          \n            \n                    for (ArrayList<int[]> value : obstacles.values()) {\n          \n          \n            \n                        value.forEach(obstacle -> {\n          \n          \n            \n                            final float obstacleX = toXCoord(obstacle[0]) * scale;\n          \n          \n            \n                            final float obstacleY = toYCoord(obstacle[1]) * scale;\n          \n          \n            \n                            drawCircle(g2d, obstacleX, obstacleY, radius, true);\n          \n          \n            \n                            if (scale > 1.0) {\n          \n          \n            \n                                drawCenteredImg(g2d, scale / 3, \"obstacle-\" + obstacle[2] + \".png\", obstacleX, obstacleY + 15);\n          \n          \n            \n                            }\n          \n          \n            \n                        });\n          \n          \n            \n                    }", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"319\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">Integer</span> obstacleType <span class=\"pl-k\">:</span> obstacles<span class=\"pl-k\">.</span>keySet()) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"320\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            obstacles<span class=\"pl-k\">.</span>get(obstacleType)<span class=\"pl-k\">.</span>forEach(obstacle <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"321\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">final</span> <span class=\"pl-k\">float</span> obstacleX <span class=\"pl-k\">=</span> toXCoord(obstacle[<span class=\"pl-c1\">0</span>]) <span class=\"pl-k\">*</span> scale;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"322\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">final</span> <span class=\"pl-k\">float</span> obstacleY <span class=\"pl-k\">=</span> toYCoord(obstacle[<span class=\"pl-c1\">1</span>]) <span class=\"pl-k\">*</span> scale;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"323\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                drawCircle(g2d, obstacleX, obstacleY, radius, <span class=\"pl-c1\">true</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"324\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">if</span> (scale <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">1.0</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"325\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                    drawCenteredImg(g2d, scale <span class=\"pl-k\">/</span> <span class=\"pl-c1\">3</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>obstacle-<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> obstacle[<span class=\"pl-c1\">2</span>] <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>.png<span class=\"pl-pds\">\"</span></span>, obstacleX, obstacleY <span class=\"pl-k\">+</span> <span class=\"pl-c1\">15</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"326\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"327\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            });</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"328\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"329\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"319\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">for</span> (<span class=\"pl-k\">ArrayList&lt;int[]&gt;</span> value <span class=\"pl-k\">:</span> obstacles<span class=\"pl-k\">.</span>values()) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"320\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            value<span class=\"pl-k\">.</span>forEach(obstacle <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"321\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">final</span> <span class=\"pl-k\">float</span> obstacleX <span class=\"pl-k\">=</span> toXCoord(obstacle[<span class=\"pl-c1\">0</span>]) <span class=\"pl-k\">*</span> scale;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"322\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">final</span> <span class=\"pl-k\">float</span> obstacleY <span class=\"pl-k\">=</span> toYCoord(obstacle[<span class=\"pl-c1\">1</span>]) <span class=\"pl-k\">*</span> scale;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"323\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                drawCircle(g2d, obstacleX, obstacleY, radius, <span class=\"pl-c1\">true</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"324\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">if</span> (scale <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">1.0</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"325\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                    drawCenteredImg(g2d, scale <span class=\"pl-k\">/</span> <span class=\"pl-c1\">3</span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>obstacle-<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">+</span> obstacle[<span class=\"pl-c1\">2</span>] <span class=\"pl-k\">+</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>.png<span class=\"pl-pds\">\"</span></span>, obstacleX, obstacleY <span class=\"pl-k\">+</span> <span class=\"pl-c1\">15</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"326\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"327\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            });</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"328\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-10-02T23:45:53Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/robot/RRMapDraw.java", "diffHunk": "@@ -275,31 +288,58 @@ private void drawRobo(Graphics2D g2d, float scale) {\n         g2d.setColor(COLOR_CHARGER_HALO);\n         final float chargerX = toXCoord(rmfp.getChargerX()) * scale;\n         final float chargerY = toYCoord(rmfp.getChargerY()) * scale;\n-        drawCircle(g2d, chargerX, chargerY, radius);\n+        drawCircle(g2d, chargerX, chargerY, radius, false);\n         drawCenteredImg(g2d, scale / 8, \"charger.png\", chargerX, chargerY);\n         radius = 3 * scale;\n         g2d.setColor(COLOR_ROBO);\n         final float roboX = toXCoord(rmfp.getRoboX()) * scale;\n         final float roboY = toYCoord(rmfp.getRoboY()) * scale;\n-        drawCircle(g2d, roboX, roboY, radius);\n+        drawCircle(g2d, roboX, roboY, radius, false);\n         if (scale > 1.5) {\n             drawCenteredImg(g2d, scale / 15, \"robo.png\", roboX, roboY);\n         }\n     }\n \n-    private void drawCircle(Graphics2D g2d, float x, float y, float radius) {\n-        g2d.draw(new Ellipse2D.Double(x - radius, y - radius, 2.0 * radius, 2.0 * radius));\n+    private void drawObstacles(Graphics2D g2d, float scale) {\n+        float radius = 2 * scale;\n+        Stroke stroke = new BasicStroke(3 * scale);\n+        g2d.setStroke(stroke);\n+        g2d.setColor(Color.MAGENTA);\n+\n+        Map<Integer, ArrayList<int[]>> obstacles = rmfp.getObstacles();\n+        for (Integer obstacleType : obstacles.keySet()) {\n+            obstacles.get(obstacleType).forEach(obstacle -> {\n+                final float obstacleX = toXCoord(obstacle[0]) * scale;\n+                final float obstacleY = toYCoord(obstacle[1]) * scale;\n+                drawCircle(g2d, obstacleX, obstacleY, radius, true);\n+                if (scale > 1.0) {\n+                    drawCenteredImg(g2d, scale / 3, \"obstacle-\" + obstacle[2] + \".png\", obstacleX, obstacleY + 15);\n+                }\n+            });\n+\n+        }", "originalCommit": "10f101c232716bf1b30a87d1cab7d490c2c64564", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MDg3OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8637#discussion_r499090879", "body": "remove blank line", "bodyText": "remove blank line", "bodyHTML": "<p dir=\"auto\">remove blank line</p>", "author": "cpmeister", "createdAt": "2020-10-02T23:46:14Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/robot/RRMapDraw.java", "diffHunk": "@@ -275,31 +288,58 @@ private void drawRobo(Graphics2D g2d, float scale) {\n         g2d.setColor(COLOR_CHARGER_HALO);\n         final float chargerX = toXCoord(rmfp.getChargerX()) * scale;\n         final float chargerY = toYCoord(rmfp.getChargerY()) * scale;\n-        drawCircle(g2d, chargerX, chargerY, radius);\n+        drawCircle(g2d, chargerX, chargerY, radius, false);\n         drawCenteredImg(g2d, scale / 8, \"charger.png\", chargerX, chargerY);\n         radius = 3 * scale;\n         g2d.setColor(COLOR_ROBO);\n         final float roboX = toXCoord(rmfp.getRoboX()) * scale;\n         final float roboY = toYCoord(rmfp.getRoboY()) * scale;\n-        drawCircle(g2d, roboX, roboY, radius);\n+        drawCircle(g2d, roboX, roboY, radius, false);\n         if (scale > 1.5) {\n             drawCenteredImg(g2d, scale / 15, \"robo.png\", roboX, roboY);\n         }\n     }\n \n-    private void drawCircle(Graphics2D g2d, float x, float y, float radius) {\n-        g2d.draw(new Ellipse2D.Double(x - radius, y - radius, 2.0 * radius, 2.0 * radius));\n+    private void drawObstacles(Graphics2D g2d, float scale) {\n+        float radius = 2 * scale;\n+        Stroke stroke = new BasicStroke(3 * scale);\n+        g2d.setStroke(stroke);\n+        g2d.setColor(Color.MAGENTA);\n+\n+        Map<Integer, ArrayList<int[]>> obstacles = rmfp.getObstacles();\n+        for (Integer obstacleType : obstacles.keySet()) {\n+            obstacles.get(obstacleType).forEach(obstacle -> {\n+                final float obstacleX = toXCoord(obstacle[0]) * scale;\n+                final float obstacleY = toYCoord(obstacle[1]) * scale;\n+                drawCircle(g2d, obstacleX, obstacleY, radius, true);\n+                if (scale > 1.0) {\n+                    drawCenteredImg(g2d, scale / 3, \"obstacle-\" + obstacle[2] + \".png\", obstacleX, obstacleY + 15);\n+                }\n+            });\n+\n+        }\n+    }\n+\n+    private void drawCircle(Graphics2D g2d, float x, float y, float radius, boolean fill) {\n+", "originalCommit": "10f101c232716bf1b30a87d1cab7d490c2c64564", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MTE2OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8637#discussion_r499091169", "body": "```suggestion\r\n            pw.print(\"\\tObstacle coordinates:\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        pw.printf(\"\\tObstacle coordinates:\");\n          \n          \n            \n                        pw.print(\"\\tObstacle coordinates:\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            pw<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">printf</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\t</span>Obstacle coordinates:<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            pw<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">print</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\t</span>Obstacle coordinates:<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-10-02T23:47:59Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/robot/RRMapFileParser.java", "diffHunk": "@@ -309,6 +368,16 @@ private void printAreaDetails(ArrayList<float[]> areas, PrintWriter pw) {\n         });\n     }\n \n+    private void printObstacleDetails(ArrayList<int[]> obstacle, PrintWriter pw) {\n+        obstacle.forEach(area -> {\n+            pw.printf(\"\\tObstacle coordinates:\");", "originalCommit": "10f101c232716bf1b30a87d1cab7d490c2c64564", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7407bdd318a39b666ad8bd57b3b59cd98e668724", "url": "https://github.com/openhab/openhab-addons/commit/7407bdd318a39b666ad8bd57b3b59cd98e668724", "message": "[miio] cleanup based on feedback\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>", "committedDate": "2020-10-03T08:06:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE0Mzg4Ng==", "url": "https://github.com/openhab/openhab-addons/pull/8637#discussion_r499143886", "body": "```suggestion\r\n        Map<Integer, ArrayList<int[]>> obstacleMap = rmfp.getObstacles();\r\n        for (ArrayList<int[]> obstacles : obstacleMap.values()) {\r\n            obstacles.forEach(obstacle -> {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Map<Integer, ArrayList<int[]>> obstacles = rmfp.getObstacles();\n          \n          \n            \n                    for (Integer obstacleType : obstacles.keySet()) {\n          \n          \n            \n                        obstacles.get(obstacleType).forEach(obstacle -> {\n          \n          \n            \n                    Map<Integer, ArrayList<int[]>> obstacleMap = rmfp.getObstacles();\n          \n          \n            \n                    for (ArrayList<int[]> obstacles : obstacleMap.values()) {\n          \n          \n            \n                        obstacles.forEach(obstacle -> {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">Integer</span>, <span class=\"pl-k\">ArrayList&lt;int[]&gt;</span>&gt;</span> <span class=\"x x-first x-last\">obstacles</span> <span class=\"pl-k\">=</span> rmfp<span class=\"pl-k\">.</span>getObstacles();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">for</span> (<span class=\"pl-smi x x-first\">Integer</span><span class=\"x x-last\"> obstacleType</span> <span class=\"pl-k\">:</span> <span class=\"x x-first\">obstacles</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">keySet</span>()) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            obstacles<span class=\"pl-k\">.</span><span class=\"x x-first\">get(obstacleType)</span><span class=\"pl-k x x-last\">.</span>forEach(obstacle <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">Map&lt;<span class=\"pl-smi\">Integer</span>, <span class=\"pl-k\">ArrayList&lt;int[]&gt;</span>&gt;</span> <span class=\"x x-first x-last\">obstacleMap</span> <span class=\"pl-k\">=</span> rmfp<span class=\"pl-k\">.</span>getObstacles();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">for</span> (<span class=\"pl-k x x-first\">ArrayList&lt;int[]&gt;</span><span class=\"x x-last\"> obstacles</span> <span class=\"pl-k\">:</span> <span class=\"x x-first\">obstacleMap</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">values</span>()) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            obstacles<span class=\"pl-k\">.</span>forEach(obstacle <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-10-03T12:30:09Z", "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/robot/RRMapDraw.java", "diffHunk": "@@ -275,31 +288,58 @@ private void drawRobo(Graphics2D g2d, float scale) {\n         g2d.setColor(COLOR_CHARGER_HALO);\n         final float chargerX = toXCoord(rmfp.getChargerX()) * scale;\n         final float chargerY = toYCoord(rmfp.getChargerY()) * scale;\n-        drawCircle(g2d, chargerX, chargerY, radius);\n+        drawCircle(g2d, chargerX, chargerY, radius, false);\n         drawCenteredImg(g2d, scale / 8, \"charger.png\", chargerX, chargerY);\n         radius = 3 * scale;\n         g2d.setColor(COLOR_ROBO);\n         final float roboX = toXCoord(rmfp.getRoboX()) * scale;\n         final float roboY = toYCoord(rmfp.getRoboY()) * scale;\n-        drawCircle(g2d, roboX, roboY, radius);\n+        drawCircle(g2d, roboX, roboY, radius, false);\n         if (scale > 1.5) {\n             drawCenteredImg(g2d, scale / 15, \"robo.png\", roboX, roboY);\n         }\n     }\n \n-    private void drawCircle(Graphics2D g2d, float x, float y, float radius) {\n-        g2d.draw(new Ellipse2D.Double(x - radius, y - radius, 2.0 * radius, 2.0 * radius));\n+    private void drawObstacles(Graphics2D g2d, float scale) {\n+        float radius = 2 * scale;\n+        Stroke stroke = new BasicStroke(3 * scale);\n+        g2d.setStroke(stroke);\n+        g2d.setColor(Color.MAGENTA);\n+\n+        Map<Integer, ArrayList<int[]>> obstacles = rmfp.getObstacles();\n+        for (Integer obstacleType : obstacles.keySet()) {\n+            obstacles.get(obstacleType).forEach(obstacle -> {", "originalCommit": "10f101c232716bf1b30a87d1cab7d490c2c64564", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "479c6cbdce4f6858da833786da01ad26a8f54b19", "url": "https://github.com/openhab/openhab-addons/commit/479c6cbdce4f6858da833786da01ad26a8f54b19", "message": "Update bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/robot/RRMapDraw.java\r\n\r\ncommit suggestion cpmeister\r\n\r\nSigned-off-by: Marcel Verpaalen marcel@verpaalen.com\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>", "committedDate": "2020-10-04T12:26:14Z", "type": "commit"}]}