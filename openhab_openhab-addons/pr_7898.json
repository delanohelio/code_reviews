{"pr_number": 7898, "pr_title": "[hyperion] Fixes #6377 hyperion NPE", "pr_author": "posseydon6891", "pr_createdAt": "2020-06-11T17:00:13Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7898", "timeline": [{"oid": "7894d97f7981094c1aa6bacf514a2113ff34a8b3", "url": "https://github.com/openhab/openhab-addons/commit/7894d97f7981094c1aa6bacf514a2113ff34a8b3", "message": "[hyperion] Fixes #6377 hyperion NPE\n\nIncorporate changes to HyperionNG serverInfo API - alpha6.\nHyperionEnabled state channel is now determined by special component\nstate \"ALL\". See: https://docs.hyperion-project.org/en/json/ServerInfo.html\n\nSigned-off-by: posseydon6891 <lserwicki@gmail.com>", "committedDate": "2020-06-11T17:02:06Z", "type": "forcePushed"}, {"oid": "60e10c542c1c53a2ce7161985a7a08c5721f30c5", "url": "https://github.com/openhab/openhab-addons/commit/60e10c542c1c53a2ce7161985a7a08c5721f30c5", "message": "[hyperion] Fixes #6377 hyperion NPE\n\nIncorporate changes to HyperionNG serverInfo API - alpha6.\nHyperionEnabled state channel is now determined by special component\nstate \"ALL\" for newer APIs.\n\nSee: https://docs.hyperion-project.org/en/json/ServerInfo.html\n\nSigned-off-by: posseydon6891 <lserwicki@gmail.com>", "committedDate": "2020-06-15T11:09:19Z", "type": "commit"}, {"oid": "60e10c542c1c53a2ce7161985a7a08c5721f30c5", "url": "https://github.com/openhab/openhab-addons/commit/60e10c542c1c53a2ce7161985a7a08c5721f30c5", "message": "[hyperion] Fixes #6377 hyperion NPE\n\nIncorporate changes to HyperionNG serverInfo API - alpha6.\nHyperionEnabled state channel is now determined by special component\nstate \"ALL\" for newer APIs.\n\nSee: https://docs.hyperion-project.org/en/json/ServerInfo.html\n\nSigned-off-by: posseydon6891 <lserwicki@gmail.com>", "committedDate": "2020-06-15T11:09:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNTYyNg==", "url": "https://github.com/openhab/openhab-addons/pull/7898#discussion_r440305626", "body": "```suggestion\r\n            Hyperion hyperion = info.getHyperion();\r\n            if (hyperion != null) {\r\n                \r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(info.getHyperion() != null) {\n          \n          \n            \n                            Hyperion hyperion = info.getHyperion();\n          \n          \n            \n                        Hyperion hyperion = info.getHyperion();\n          \n          \n            \n                        if (hyperion != null) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">if</span>(info<span class=\"pl-k\">.</span>getHyperion() <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">null</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-smi\">Hyperion</span> hyperion <span class=\"pl-k\">=</span> info<span class=\"pl-k\">.</span>getHyperion();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-smi\">Hyperion</span> hyperion <span class=\"pl-k\">=</span> info<span class=\"pl-k\">.</span>getHyperion();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">if</span> (hyperion <span class=\"pl-k\">!=</span> <span class=\"pl-c1\">null</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                </td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-06-15T16:39:09Z", "path": "bundles/org.openhab.binding.hyperion/src/main/java/org/openhab/binding/hyperion/internal/handler/HyperionNgHandler.java", "diffHunk": "@@ -173,10 +173,12 @@ public void dispose() {\n     protected void handleServerInfoResponse(NgResponse response) {\n         NgInfo info = response.getInfo();\n         if (info != null) {\n-            // update Hyperion\n-            Hyperion hyperion = info.getHyperion();\n-            updateHyperion(hyperion);\n-\n+            // update Hyperion, older API compatibility\n+            if(info.getHyperion() != null) {\n+                Hyperion hyperion = info.getHyperion();", "originalCommit": "60e10c542c1c53a2ce7161985a7a08c5721f30c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNjcxMA==", "url": "https://github.com/openhab/openhab-addons/pull/7898#discussion_r440306710", "body": "How does the ALL component only correspond to the hyperion enabled channel? Is there no separate enabled channel?", "bodyText": "How does the ALL component only correspond to the hyperion enabled channel? Is there no separate enabled channel?", "bodyHTML": "<p dir=\"auto\">How does the ALL component only correspond to the hyperion enabled channel? Is there no separate enabled channel?</p>", "author": "cpmeister", "createdAt": "2020-06-15T16:41:01Z", "path": "bundles/org.openhab.binding.hyperion/src/main/java/org/openhab/binding/hyperion/internal/handler/HyperionNgHandler.java", "diffHunk": "@@ -295,6 +297,9 @@ private void updateComponents(List<Component> components) {\n                 case COMPONENT_LEDDEVICE:\n                     updateState(CHANNEL_LEDDEVICE, componentState);\n                     break;\n+                case COMPONENT_ALL:", "originalCommit": "60e10c542c1c53a2ce7161985a7a08c5721f30c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM1MDI3MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7898#discussion_r440350271", "bodyText": "According to Hyperion docs, sending on/off to special component \"ALL\":\n\nsaves/restores current state of every component,\ntoggles every component on/off,\neffectively disabling/enabling hyperion.\n\nAlso I double checked by looking at their standalone app which comes with Hyperion:\n$ hyperion-remote --help | grep -e Activate -e Deactivate\n  --off                                              Deactivates hyperion\n  --on                                               Activates hyperion\n\nWhat this app do is actually calling API for component \"ALL\":\n$ strace -s 9999 -f -e trace=network,write hyperion-remote --off -a 192.168.0.203:19444 \n...\nwrite(2, \"Connected to: \\\"192.168.0.203:19444\\\"\\n\", 36Connected to: \"192.168.0.203:19444\"\n...\nwrite(2, \"Disable Component \\\"ALL\\\"\\n\", 24Disable Component \"ALL\"\n...\nwrite(5, \"{\\\"command\\\":\\\"componentstate\\\",\\\"componentstate\\\":{\\\"component\\\":\\\"ALL\\\",\\\"state\\\":false}}\\n\", 80) = 80\n...\n\nBasically, there is no dedicated disable/enable channel except API shorthand for disabling/enabling ALL components.\nState updates for HyperionEnabled channel look like this in OH logs:", "author": "posseydon6891", "createdAt": "2020-06-15T17:59:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMwNjcxMA=="}], "type": "inlineReview"}, {"oid": "7189db850ce51400817467c50d38ac9626e62000", "url": "https://github.com/openhab/openhab-addons/commit/7189db850ce51400817467c50d38ac9626e62000", "message": "Update bundles/org.openhab.binding.hyperion/src/main/java/org/openhab/binding/hyperion/internal/handler/HyperionNgHandler.java\n\nCo-authored-by: cpmeister <mistercpp2000@gmail.com>", "committedDate": "2020-06-15T18:05:04Z", "type": "commit"}]}