{"pr_number": 9194, "pr_title": "[digitalstrom] fixes StringIndexOutOfBoundsException", "pr_author": "gaetancollaud", "pr_createdAt": "2020-12-01T20:35:26Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9194", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0OTUzMw==", "url": "https://github.com/openhab/openhab-addons/pull/9194#discussion_r534349533", "body": "The error logging level should be reserved for issues catastrophic enough to threaten the operation of openHab itself. An error in a binding shouldn't qualify for this. Please read the [openHab coding guidelines](https://www.openhab.org/docs/developer/guidelines.html#f-logging) for expected use of logging in bindings.\r\n\r\nI suggest logging warn instead. Also please try to catch specific exceptions or at the very least RuntimeException. In addition, you should always log the exception or at the very least the exception message to make debugging easier.\r\n```suggestion\r\n        } catch (RuntimeException ex) {\r\n            logger.warn(\"Unable to add devices {}: {}\", device, ex.getMessage());\r\n```", "bodyText": "The error logging level should be reserved for issues catastrophic enough to threaten the operation of openHab itself. An error in a binding shouldn't qualify for this. Please read the openHab coding guidelines for expected use of logging in bindings.\nI suggest logging warn instead. Also please try to catch specific exceptions or at the very least RuntimeException. In addition, you should always log the exception or at the very least the exception message to make debugging easier.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (Exception ex) {\n          \n          \n            \n                        logger.error(\"Unable to add devices {}\", device);\n          \n          \n            \n                    } catch (RuntimeException ex) {\n          \n          \n            \n                        logger.warn(\"Unable to add devices {}: {}\", device, ex.getMessage());", "bodyHTML": "<p dir=\"auto\">The error logging level should be reserved for issues catastrophic enough to threaten the operation of openHab itself. An error in a binding shouldn't qualify for this. Please read the <a href=\"https://www.openhab.org/docs/developer/guidelines.html#f-logging\" rel=\"nofollow\">openHab coding guidelines</a> for expected use of logging in bindings.</p>\n<p dir=\"auto\">I suggest logging warn instead. Also please try to catch specific exceptions or at the very least RuntimeException. In addition, you should always log the exception or at the very least the exception message to make debugging easier.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi x x-first x-last\">Exception</span> ex) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            logger<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">error</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unable to add devices {}<span class=\"pl-pds\">\"</span></span>, device);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi x x-first x-last\">RuntimeException</span> ex) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            logger<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">warn</span>(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Unable to add devices {}<span class=\"x x-first x-last\">: {}</span><span class=\"pl-pds\">\"</span></span>, device<span class=\"x x-first\">, ex</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getMessage()</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-12-02T17:28:09Z", "path": "bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java", "diffHunk": "@@ -194,20 +198,25 @@ public void onDeviceRemoved(GeneralDeviceInformation device) {\n \n     @Override\n     public void onDeviceAdded(GeneralDeviceInformation device) {\n-        if (device instanceof Device) {\n-            String id = ((Device) device).getHWinfo().substring(0, 2);\n-            if (((Device) device).isSensorDevice()) {\n-                id = ((Device) device).getHWinfo();\n-            }\n-            if (discoveryServices.get(id) != null) {\n-                ((DeviceDiscoveryService) discoveryServices.get(id)).onDeviceAdded(device);\n+        try {\n+            if (device instanceof Device) {\n+                String id = ((Device) device).getHWinfo().substring(0, 2);\n+                if (((Device) device).isSensorDevice()) {\n+                    id = ((Device) device).getHWinfo();\n+                }\n+                if (discoveryServices.get(id) != null) {\n+                    ((DeviceDiscoveryService) discoveryServices.get(id)).onDeviceAdded(device);\n+                }\n             }\n-        }\n-        if (device instanceof Circuit) {\n-            if (discoveryServices.get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()) != null) {\n-                ((DeviceDiscoveryService) discoveryServices\n-                        .get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString())).onDeviceAdded(device);\n+            if (device instanceof Circuit) {\n+                if (discoveryServices.get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()) != null) {\n+                    ((DeviceDiscoveryService) discoveryServices\n+                            .get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()))\n+                                    .onDeviceAdded(device);\n+                }\n             }\n+        } catch (Exception ex) {\n+            logger.error(\"Unable to add devices {}\", device);", "originalCommit": "82b31b205b6686668806e517199aaf4795c4fd54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQwMTA3Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9194#discussion_r534401076", "bodyText": "I guess I wrote this a bit too fast and forgot to forward the exception.\nAgree for le level. No problem for me. I will put the complete stacktrace instead of just the message if it's ok for you ?", "author": "gaetancollaud", "createdAt": "2020-12-02T18:47:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0OTUzMw=="}], "type": "inlineReview"}, {"oid": "a001d717078bc469840d5a81b659157e89e493bb", "url": "https://github.com/openhab/openhab-addons/commit/a001d717078bc469840d5a81b659157e89e493bb", "message": "[digitalstrom] catch issues when adding devices\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>", "committedDate": "2020-12-02T18:48:40Z", "type": "commit"}, {"oid": "44d98d4cb591080c54eaf81f1e1b03ee29cf1af2", "url": "https://github.com/openhab/openhab-addons/commit/44d98d4cb591080c54eaf81f1e1b03ee29cf1af2", "message": "Update bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>", "committedDate": "2020-12-02T18:48:40Z", "type": "commit"}, {"oid": "bc22f550ceca11c56566243029dfa70a1a8cb43e", "url": "https://github.com/openhab/openhab-addons/commit/bc22f550ceca11c56566243029dfa70a1a8cb43e", "message": "print stacktrace in case of error\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>", "committedDate": "2020-12-02T18:48:40Z", "type": "commit"}, {"oid": "bc22f550ceca11c56566243029dfa70a1a8cb43e", "url": "https://github.com/openhab/openhab-addons/commit/bc22f550ceca11c56566243029dfa70a1a8cb43e", "message": "print stacktrace in case of error\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>", "committedDate": "2020-12-02T18:48:40Z", "type": "forcePushed"}]}