{"pr_number": 7690, "pr_title": "[yeelight] Added support Ceiling 1 with Night Mode", "pr_author": "DragonNP", "pr_createdAt": "2020-05-18T20:45:52Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7690", "timeline": [{"oid": "6ea29de2685e52d45a7095bb56be48982d48b7e9", "url": "https://github.com/openhab/openhab-addons/commit/6ea29de2685e52d45a7095bb56be48982d48b7e9", "message": "Added support Ceiling 1\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>", "committedDate": "2020-05-18T20:40:27Z", "type": "commit"}, {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c", "url": "https://github.com/openhab/openhab-addons/commit/103a851fec7cf6b10af2e436bfdc2049655d697c", "message": "Changed Author\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>", "committedDate": "2020-05-19T11:37:00Z", "type": "commit"}, {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c", "url": "https://github.com/openhab/openhab-addons/commit/103a851fec7cf6b10af2e436bfdc2049655d697c", "message": "Changed Author\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>", "committedDate": "2020-05-19T11:37:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5Mzg5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427493891", "body": "Some of our build tools don't like EOF without a newline. So add a newline here.", "bodyText": "Some of our build tools don't like EOF without a newline. So add a newline here.", "bodyHTML": "<p dir=\"auto\">Some of our build tools don't like EOF without a newline. So add a newline here.</p>", "author": "cpmeister", "createdAt": "2020-05-19T17:57:44Z", "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/lib/device/CeilingDeviceWithNightDevice.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.lib.device;\n+\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+import org.openhab.binding.yeelight.internal.lib.enums.DeviceType;\n+import org.openhab.binding.yeelight.internal.lib.enums.MethodAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+\n+/**\n+ * The {@link CeilingDeviceWithNightDevice} contains methods for handling the ceiling device with ambient light.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class CeilingDeviceWithNightDevice extends CeilingDevice\n+        implements DeviceWithNightlight {\n+    private final Logger logger = LoggerFactory.getLogger(CeilingDeviceWithNightDevice.class);\n+\n+    public CeilingDeviceWithNightDevice(String id) {\n+        super(id);\n+\n+        mDeviceType = DeviceType.ceiling1;\n+    }\n+\n+    @Override\n+    public void onNotify(String msg) {\n+        logger.debug(\"Got state: {}\", msg);\n+\n+        JsonObject result = new JsonParser().parse(msg).getAsJsonObject();\n+\n+        if (result.has(\"id\")) {\n+            String id = result.get(\"id\").getAsString();\n+            // for cmd transaction.\n+\n+            if (mQueryList.contains(id)) {\n+                JsonArray status = result.get(\"result\").getAsJsonArray();\n+\n+                final int activeMode = status.get(8).getAsInt();\n+                mDeviceStatus.setActiveMode(ActiveMode.values()[activeMode]);\n+            }\n+        }\n+\n+        super.onNotify(msg);\n+    }\n+\n+    @Override\n+    public void toggleNightlightMode(boolean turnOn) {\n+        if (turnOn) {\n+            mConnection.invoke(\n+                    new DeviceMethod(MethodAction.SCENE, new Object[] { \"nightlight\", mDeviceStatus.getBrightness() }));\n+        } else {\n+            mConnection.invoke(MethodFactory.buildCTMethod(mDeviceStatus.getCt(), DeviceMethod.EFFECT_SMOOTH, 500));\n+        }\n+    }\n+}", "originalCommit": "103a851fec7cf6b10af2e436bfdc2049655d697c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5NjMwNA==", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427496304", "body": "I don't think you need to override this. YeelightCeilingHandler already implements this for you, unless you want to fix the string instead.", "bodyText": "I don't think you need to override this. YeelightCeilingHandler already implements this for you, unless you want to fix the string instead.", "bodyHTML": "<p dir=\"auto\">I don't think you need to override this. YeelightCeilingHandler already implements this for you, unless you want to fix the string instead.</p>", "author": "cpmeister", "createdAt": "2020-05-19T18:01:26Z", "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.handler;\n+\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.yeelight.internal.YeelightBindingConstants;\n+import org.openhab.binding.yeelight.internal.lib.device.DeviceStatus;\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+\n+/**\n+ * The {@link YeelightCeilingWithNightHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {\n+\n+    public YeelightCeilingWithNightHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        handleCommandHelper(channelUID, command, \"Handle ceiling ambient light command\");\n+    }", "originalCommit": "103a851fec7cf6b10af2e436bfdc2049655d697c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5ODIzMw==", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427498233", "body": "```suggestion\r\npublic class YeelightCeilingWithNightHandler extends YeelightCeilingHandler {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {\n          \n          \n            \n            public class YeelightCeilingWithNightHandler extends YeelightCeilingHandler {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">YeelightCeilingWithNightHandler</span> <span class=\"pl-k\">extends</span> <span class=\"pl-e x x-first x-last\">YeelightHandlerBase</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">YeelightCeilingWithNightHandler</span> <span class=\"pl-k\">extends</span> <span class=\"pl-e x x-first x-last\">YeelightCeilingHandler</span> {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-05-19T18:04:39Z", "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.handler;\n+\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.yeelight.internal.YeelightBindingConstants;\n+import org.openhab.binding.yeelight.internal.lib.device.DeviceStatus;\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+\n+/**\n+ * The {@link YeelightCeilingWithNightHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {", "originalCommit": "103a851fec7cf6b10af2e436bfdc2049655d697c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5OTE4Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427499182", "body": "Also, please use your real name in the authoring tags", "bodyText": "Also, please use your real name in the authoring tags", "bodyHTML": "<p dir=\"auto\">Also, please use your real name in the authoring tags</p>", "author": "cpmeister", "createdAt": "2020-05-19T18:06:13Z", "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/YeelightHandlerFactory.java", "diffHunk": "@@ -29,6 +29,7 @@\n  * The {@link YeelightHandlerFactory} is responsible for returning supported things and handlers for the devices.\n  *\n  * @author Coaster Li - Initial contribution\n+ * @author DragonNP - Added YeelightCeilingWithNightHandler for Ceiling 3", "originalCommit": "103a851fec7cf6b10af2e436bfdc2049655d697c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "url": "https://github.com/openhab/openhab-addons/commit/0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "message": "Fixing bugs\n\nSigned-off-by: Nikita Pogudalov <dragonnp@ya.ru>", "committedDate": "2020-05-19T18:52:35Z", "type": "commit"}]}