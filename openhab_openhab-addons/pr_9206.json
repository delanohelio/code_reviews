{"pr_number": 9206, "pr_title": "[openthermgateway] Fix for #9205 incorrect control setpoint override", "pr_author": "jamesmelville", "pr_createdAt": "2020-12-02T23:12:37Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9206", "timeline": [{"oid": "a8e71052f8d24ec828fc0e79fa915beb7b4582b1", "url": "https://github.com/openhab/openhab-addons/commit/a8e71052f8d24ec828fc0e79fa915beb7b4582b1", "message": "Initial attempt to resolve issue with flickering statuses when override\npresent on OTGW\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>", "committedDate": "2020-12-01T22:36:03Z", "type": "commit"}, {"oid": "b2a0392f6a1141541da2b8eb39ceb9e10055e1ea", "url": "https://github.com/openhab/openhab-addons/commit/b2a0392f6a1141541da2b8eb39ceb9e10055e1ea", "message": "apply spotless, fix enum usage\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>", "committedDate": "2020-12-01T22:36:52Z", "type": "commit"}, {"oid": "7193dbd90bec29dac9b8e229642850d2edd316dc", "url": "https://github.com/openhab/openhab-addons/commit/7193dbd90bec29dac9b8e229642850d2edd316dc", "message": "Update readme\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>", "committedDate": "2020-12-02T23:12:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTgwMTkzMw==", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r535801933", "body": "Can you give these enum value more verbose names?", "bodyText": "Can you give these enum value more verbose names?", "bodyHTML": "<p dir=\"auto\">Can you give these enum value more verbose names?</p>", "author": "cpmeister", "createdAt": "2020-12-04T03:06:09Z", "path": "bundles/org.openhab.binding.openthermgateway/src/main/java/org/openhab/binding/openthermgateway/internal/CodeType.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.openthermgateway.internal;\n+\n+/**\n+ * The {@link CodeType} field is not part of OpenTherm specification, but added by OpenTherm Gateway.\n+ * It can be any of the following:\n+ *\n+ * T: Message received from the thermostat\n+ * B: Message received from the boiler\n+ * R: Request sent to the boiler\n+ * A: Response returned to the thermostat\n+ * E: Parity or stop bit error\n+ *\n+ * @author Arjen Korevaar - Initial contribution\n+ * @author James Melville - Introduced code filtering functionality\n+ */\n+public enum CodeType {\n+    /**\n+     * Message received from the thermostat\n+     */\n+    T,", "originalCommit": "7193dbd90bec29dac9b8e229642850d2edd316dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTg3ODk2Nw==", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r535878967", "bodyText": "Hi cpmeister, some of the code of the OTGW binding is directly related to the OpenTherm or the OTGW specifications. While it is possible to use more verbose names, this would require extra mappings and in general obfuscates the relationship to the OpenTherm or OTGW specifications. I would prefer to stick with the values as they are used by the OTGW. The comments should provide sufficient explanation of each value.", "author": "ArjenKorevaar", "createdAt": "2020-12-04T07:02:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTgwMTkzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMwNTUzMw==", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536305533", "body": "It is possible for `CodeType.valueOf(code);` to throw an exception if the given code isn't one of the enum values. Since a constructor isn't really a suitable place to do exception handling I think is would be better if you changed the `code` parameter from String to CodeType so that you push the burden of exception handling to the caller instead.\r\n\r\n```suggestion\r\n    public Message(CodeType code, MessageType messageType, int id, String data) {\r\n```", "bodyText": "It is possible for CodeType.valueOf(code); to throw an exception if the given code isn't one of the enum values. Since a constructor isn't really a suitable place to do exception handling I think is would be better if you changed the code parameter from String to CodeType so that you push the burden of exception handling to the caller instead.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public Message(String code, MessageType messageType, int id, String data) {\n          \n          \n            \n                public Message(CodeType code, MessageType messageType, int id, String data) {", "bodyHTML": "<p dir=\"auto\">It is possible for <code>CodeType.valueOf(code);</code> to throw an exception if the given code isn't one of the enum values. Since a constructor isn't really a suitable place to do exception handling I think is would be better if you changed the <code>code</code> parameter from String to CodeType so that you push the burden of exception handling to the caller instead.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> Message(<span class=\"pl-smi x x-first x-last\">String</span> code, <span class=\"pl-smi\">MessageType</span> messageType, <span class=\"pl-k\">int</span> id, <span class=\"pl-smi\">String</span> data) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> Message(<span class=\"pl-smi x x-first x-last\">CodeType</span> code, <span class=\"pl-smi\">MessageType</span> messageType, <span class=\"pl-k\">int</span> id, <span class=\"pl-smi\">String</span> data) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-12-04T18:47:28Z", "path": "bundles/org.openhab.binding.openthermgateway/src/main/java/org/openhab/binding/openthermgateway/internal/Message.java", "diffHunk": "@@ -149,7 +139,7 @@ public String toString() {\n     }\n \n     public Message(String code, MessageType messageType, int id, String data) {", "originalCommit": "7193dbd90bec29dac9b8e229642850d2edd316dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQwNzM1Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536407352", "bodyText": "I've moved the evaluation of the CodeType into the parse() method, which uses a regexp to validate the code type is valid before parsing so won't error.", "author": "jamesmelville", "createdAt": "2020-12-04T21:57:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMwNTUzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMwNjg1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9206#discussion_r536306856", "body": "Enum comparisons are one of the few instances in which reference comparing is safe.\r\n```suggestion\r\n                && (this.code == CodeType.R || this.code == CodeType.A);\r\n```", "bodyText": "Enum comparisons are one of the few instances in which reference comparing is safe.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            && (CodeType.R.equals(this.getCode()) || CodeType.A.equals(this.getCode()));\n          \n          \n            \n                            && (this.code == CodeType.R || this.code == CodeType.A);", "bodyHTML": "<p dir=\"auto\">Enum comparisons are one of the few instances in which reference comparing is safe.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">&amp;&amp;</span> (<span class=\"pl-smi\">CodeType</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">R</span><span class=\"pl-k x x-first\">.</span><span class=\"x\">equals(</span><span class=\"pl-c1 x\">this</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getCode())</span> <span class=\"pl-k\">||</span> <span class=\"pl-smi\">CodeType</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">A</span><span class=\"pl-k x x-first\">.</span><span class=\"x\">equals(</span><span class=\"pl-c1 x\">this</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">getCode())</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">&amp;&amp;</span> (<span class=\"pl-c1 x x-first\">this</span><span class=\"pl-k x\">.</span><span class=\"x\">code </span><span class=\"pl-k x\">==</span><span class=\"x x-last\"> </span><span class=\"pl-smi\">CodeType</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">R</span> <span class=\"pl-k\">||</span> <span class=\"pl-c1 x x-first\">this</span><span class=\"pl-k x\">.</span><span class=\"x\">code </span><span class=\"pl-k x\">==</span><span class=\"x x-last\"> </span><span class=\"pl-smi\">CodeType</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">A</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "cpmeister", "createdAt": "2020-12-04T18:49:52Z", "path": "bundles/org.openhab.binding.openthermgateway/src/main/java/org/openhab/binding/openthermgateway/internal/Message.java", "diffHunk": "@@ -140,7 +130,7 @@ public boolean overrides(@Nullable Message other) {\n         // thermostat, and it's ID is equal to the previous message, then this is an\n         // override sent by the OpenTherm Gateway\n         return other != null && this.getID() == other.getID()\n-                && (\"R\".equals(this.getCode()) || \"A\".equals(this.getCode()));\n+                && (CodeType.R.equals(this.getCode()) || CodeType.A.equals(this.getCode()));", "originalCommit": "7193dbd90bec29dac9b8e229642850d2edd316dc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05", "url": "https://github.com/openhab/openhab-addons/commit/dd5a2dba16c079ff4230e5a3b9e86a045fd9ba05", "message": "Refactor use of CodeType enum\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>", "committedDate": "2020-12-04T21:55:25Z", "type": "commit"}, {"oid": "c47f416b576fb27ff7e93f1a5c929c1f7a601fbf", "url": "https://github.com/openhab/openhab-addons/commit/c47f416b576fb27ff7e93f1a5c929c1f7a601fbf", "message": "Update from review comments\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>", "committedDate": "2020-12-06T21:09:07Z", "type": "commit"}, {"oid": "7d8597ae1e2089041eb127eacac1b0511cdd55ea", "url": "https://github.com/openhab/openhab-addons/commit/7d8597ae1e2089041eb127eacac1b0511cdd55ea", "message": "Update Units\n\nSigned-off-by: James Melville <jamesmelville@gmail.com>", "committedDate": "2020-12-07T21:09:37Z", "type": "commit"}]}