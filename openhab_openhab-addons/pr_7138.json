{"pr_number": 7138, "pr_title": "[ojelectronics] Initial contribution", "pr_author": "EvilPingu", "pr_createdAt": "2020-03-09T20:53:45Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7138", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MDQxNg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443160416", "body": "Can this message be replaced by using the debugger or by increasing the framework's log level? See point 4 https://www.openhab.org/docs/developer/guidelines.html#f-logging\r\nSame for below.", "bodyText": "Can this message be replaced by using the debugger or by increasing the framework's log level? See point 4 https://www.openhab.org/docs/developer/guidelines.html#f-logging\nSame for below.", "bodyHTML": "<p dir=\"auto\">Can this message be replaced by using the debugger or by increasing the framework's log level? See point 4 <a href=\"https://www.openhab.org/docs/developer/guidelines.html#f-logging\" rel=\"nofollow\">https://www.openhab.org/docs/developer/guidelines.html#f-logging</a><br>\nSame for below.</p>", "author": "fwolter", "createdAt": "2020-06-20T21:14:24Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MDcyMA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443160720", "body": "Are you sure this needs to be started?", "bodyText": "Are you sure this needs to be started?", "bodyHTML": "<p dir=\"auto\">Are you sure this needs to be started?</p>", "author": "fwolter", "createdAt": "2020-06-20T21:19:58Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MDc0OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443160749", "body": "You should call the base class destructor at the end of the method.", "bodyText": "You should call the base class destructor at the end of the method.", "bodyHTML": "<p dir=\"auto\">You should call the base class destructor at the end of the method.</p>", "author": "fwolter", "createdAt": "2020-06-20T21:20:32Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();\n+            ensureSignIn();\n+\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        super.dispose();", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MDgwMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443160801", "body": "Does the state matter, when the Thing is disposed? Can this be removed?", "bodyText": "Does the state matter, when the Thing is disposed? Can this be removed?", "bodyHTML": "<p dir=\"auto\">Does the state matter, when the Thing is disposed? Can this be removed?</p>", "author": "fwolter", "createdAt": "2020-06-20T21:21:16Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();\n+            ensureSignIn();\n+\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        updateStatus(ThingStatus.OFFLINE);", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MTMxNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443161315", "body": "Bindings should only log to error, when something really severe happened. In this case you could put the message as an argument to the `updateStatus()` invocation. This is logged by the framework and shown in the UI.", "bodyText": "Bindings should only log to error, when something really severe happened. In this case you could put the message as an argument to the updateStatus() invocation. This is logged by the framework and shown in the UI.", "bodyHTML": "<p dir=\"auto\">Bindings should only log to error, when something really severe happened. In this case you could put the message as an argument to the <code>updateStatus()</code> invocation. This is logged by the framework and shown in the UI.</p>", "author": "fwolter", "createdAt": "2020-06-20T21:30:31Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();\n+            ensureSignIn();\n+\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        updateStatus(ThingStatus.OFFLINE);\n+    }\n+\n+    /**\n+     * Handles commands\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        // nothing to do here\n+    }\n+\n+    private void ensureSignIn() {\n+        if (signInService == null) {\n+            signInService = new SignInService(getConfiguration(), httpClient);\n+        }\n+        if (signInService != null) {\n+            signInService.SignIn(sessionId -> handleSignInDone(sessionId), () -> handleConnectionLost(),\n+                    () -> handleUnauthorizedWhileSignIn());\n+        }\n+    }\n+\n+    private void handleRefreshDone(@Nullable GroupContentResponseModel groupContentResponse) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleRefreshDone({})\", groupContentResponse);\n+\n+        if (groupContentResponse != null && groupContentResponse.errorCode == 0) {\n+            new RefreshGroupContentService(groupContentResponse.groupContents, getThing().getThings()).Handle();\n+        } else {\n+            logger.error(\"Wrong or no result model; Refreshing stoppped\");\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MTUwMg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443161502", "body": "You could give the user a hint what went wrong. See above.", "bodyText": "You could give the user a hint what went wrong. See above.", "bodyHTML": "<p dir=\"auto\">You could give the user a hint what went wrong. See above.</p>", "author": "fwolter", "createdAt": "2020-06-20T21:33:36Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();\n+            ensureSignIn();\n+\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        updateStatus(ThingStatus.OFFLINE);\n+    }\n+\n+    /**\n+     * Handles commands\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        // nothing to do here\n+    }\n+\n+    private void ensureSignIn() {\n+        if (signInService == null) {\n+            signInService = new SignInService(getConfiguration(), httpClient);\n+        }\n+        if (signInService != null) {\n+            signInService.SignIn(sessionId -> handleSignInDone(sessionId), () -> handleConnectionLost(),\n+                    () -> handleUnauthorizedWhileSignIn());\n+        }\n+    }\n+\n+    private void handleRefreshDone(@Nullable GroupContentResponseModel groupContentResponse) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleRefreshDone({})\", groupContentResponse);\n+\n+        if (groupContentResponse != null && groupContentResponse.errorCode == 0) {\n+            new RefreshGroupContentService(groupContentResponse.groupContents, getThing().getThings()).Handle();\n+        } else {\n+            logger.error(\"Wrong or no result model; Refreshing stoppped\");\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+            if (refreshService != null) {\n+                refreshService.stop();\n+            }\n+        }\n+    }\n+\n+    private void handleSignInDone(String sessionId) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleSignInDone({})\", sessionId);\n+        if (refreshService == null) {\n+            refreshService = new RefreshService(getConfiguration(), httpClient);\n+        }\n+        if (refreshService != null) {\n+            refreshService.start(sessionId, content -> handleRefreshDone(content), () -> handleConnectionLost(),\n+                    () -> handleUnauthorized());\n+\n+            updateStatus(ThingStatus.ONLINE);\n+        }\n+    }\n+\n+    private void handleUnauthorized() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleUnauthorized()\");\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(1);\n+    }\n+\n+    private void handleUnauthorizedWhileSignIn() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleUnauthorizedWhileSignIn()\");\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR);", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MTY0NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443161645", "body": "You could use the framework's thread pool (and syntactical sugar)\r\n```suggestion\r\n        scheduler.schedule(this::ensureSignIn, delayInSeconds, TimeUnit.SECONDS);\r\n```", "bodyText": "You could use the framework's thread pool (and syntactical sugar)\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Executors.newScheduledThreadPool(1).schedule(new Runnable() {\n          \n          \n            \n                        @Override\n          \n          \n            \n                        public void run() {\n          \n          \n            \n                            ensureSignIn();\n          \n          \n            \n                        }\n          \n          \n            \n                    }, delayInSeconds, TimeUnit.SECONDS);\n          \n          \n            \n                    scheduler.schedule(this::ensureSignIn, delayInSeconds, TimeUnit.SECONDS);", "bodyHTML": "<p dir=\"auto\">You could use the framework's thread pool (and syntactical sugar)</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-smi\">Executors</span><span class=\"pl-k\">.</span>newScheduledThreadPool(<span class=\"pl-c1\">1</span>)<span class=\"pl-k\">.</span>schedule(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">Runnable</span>() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">@Override</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> run() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                ensureSignIn();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }, delayInSeconds, <span class=\"pl-smi\">TimeUnit</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>SECONDS</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        scheduler<span class=\"pl-k\">.</span>schedule(<span class=\"pl-c1\">this</span><span class=\"pl-k\">::</span>ensureSignIn, delayInSeconds, <span class=\"pl-smi\">TimeUnit</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>SECONDS</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "fwolter", "createdAt": "2020-06-20T21:35:58Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();\n+            ensureSignIn();\n+\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        updateStatus(ThingStatus.OFFLINE);\n+    }\n+\n+    /**\n+     * Handles commands\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        // nothing to do here\n+    }\n+\n+    private void ensureSignIn() {\n+        if (signInService == null) {\n+            signInService = new SignInService(getConfiguration(), httpClient);\n+        }\n+        if (signInService != null) {\n+            signInService.SignIn(sessionId -> handleSignInDone(sessionId), () -> handleConnectionLost(),\n+                    () -> handleUnauthorizedWhileSignIn());\n+        }\n+    }\n+\n+    private void handleRefreshDone(@Nullable GroupContentResponseModel groupContentResponse) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleRefreshDone({})\", groupContentResponse);\n+\n+        if (groupContentResponse != null && groupContentResponse.errorCode == 0) {\n+            new RefreshGroupContentService(groupContentResponse.groupContents, getThing().getThings()).Handle();\n+        } else {\n+            logger.error(\"Wrong or no result model; Refreshing stoppped\");\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+            if (refreshService != null) {\n+                refreshService.stop();\n+            }\n+        }\n+    }\n+\n+    private void handleSignInDone(String sessionId) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleSignInDone({})\", sessionId);\n+        if (refreshService == null) {\n+            refreshService = new RefreshService(getConfiguration(), httpClient);\n+        }\n+        if (refreshService != null) {\n+            refreshService.start(sessionId, content -> handleRefreshDone(content), () -> handleConnectionLost(),\n+                    () -> handleUnauthorized());\n+\n+            updateStatus(ThingStatus.ONLINE);\n+        }\n+    }\n+\n+    private void handleUnauthorized() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleUnauthorized()\");\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(1);\n+    }\n+\n+    private void handleUnauthorizedWhileSignIn() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleUnauthorizedWhileSignIn()\");\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR);\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+    }\n+\n+    private void handleConnectionLost() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleConnectionLost()\");\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(getConfiguration().refreshDelayInSeconds);\n+    }\n+\n+    private void restartRefreshServiceAsync(long delayInSeconds) {\n+        logger.trace(\"OJElectronicsBridgeHandler.restartRefreshServiceAsync({})\", delayInSeconds);\n+        Executors.newScheduledThreadPool(1).schedule(new Runnable() {\n+            @Override\n+            public void run() {\n+                ensureSignIn();\n+            }\n+        }, delayInSeconds, TimeUnit.SECONDS);", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MTY5Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443161693", "body": "You could cache the config in `initialize()`, since this invocation is quite expensive.", "bodyText": "You could cache the config in initialize(), since this invocation is quite expensive.", "bodyHTML": "<p dir=\"auto\">You could cache the config in <code>initialize()</code>, since this invocation is quite expensive.</p>", "author": "fwolter", "createdAt": "2020-06-20T21:37:08Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();\n+            ensureSignIn();\n+\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        updateStatus(ThingStatus.OFFLINE);\n+    }\n+\n+    /**\n+     * Handles commands\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        // nothing to do here\n+    }\n+\n+    private void ensureSignIn() {\n+        if (signInService == null) {\n+            signInService = new SignInService(getConfiguration(), httpClient);\n+        }\n+        if (signInService != null) {\n+            signInService.SignIn(sessionId -> handleSignInDone(sessionId), () -> handleConnectionLost(),\n+                    () -> handleUnauthorizedWhileSignIn());\n+        }\n+    }\n+\n+    private void handleRefreshDone(@Nullable GroupContentResponseModel groupContentResponse) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleRefreshDone({})\", groupContentResponse);\n+\n+        if (groupContentResponse != null && groupContentResponse.errorCode == 0) {\n+            new RefreshGroupContentService(groupContentResponse.groupContents, getThing().getThings()).Handle();\n+        } else {\n+            logger.error(\"Wrong or no result model; Refreshing stoppped\");\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+            if (refreshService != null) {\n+                refreshService.stop();\n+            }\n+        }\n+    }\n+\n+    private void handleSignInDone(String sessionId) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleSignInDone({})\", sessionId);\n+        if (refreshService == null) {\n+            refreshService = new RefreshService(getConfiguration(), httpClient);\n+        }\n+        if (refreshService != null) {\n+            refreshService.start(sessionId, content -> handleRefreshDone(content), () -> handleConnectionLost(),\n+                    () -> handleUnauthorized());\n+\n+            updateStatus(ThingStatus.ONLINE);\n+        }\n+    }\n+\n+    private void handleUnauthorized() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleUnauthorized()\");\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(1);\n+    }\n+\n+    private void handleUnauthorizedWhileSignIn() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleUnauthorizedWhileSignIn()\");\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR);\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+    }\n+\n+    private void handleConnectionLost() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleConnectionLost()\");\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(getConfiguration().refreshDelayInSeconds);\n+    }\n+\n+    private void restartRefreshServiceAsync(long delayInSeconds) {\n+        logger.trace(\"OJElectronicsBridgeHandler.restartRefreshServiceAsync({})\", delayInSeconds);\n+        Executors.newScheduledThreadPool(1).schedule(new Runnable() {\n+            @Override\n+            public void run() {\n+                ensureSignIn();\n+            }\n+        }, delayInSeconds, TimeUnit.SECONDS);\n+    }\n+\n+    private OJElectronicsBridgeConfiguration getConfiguration() {\n+        return getConfigAs(OJElectronicsBridgeConfiguration.class);\n+    }", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjA1Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162052", "body": "Are you sure this method is needed? If the config is updated `dispose()`/`initialize()` are called.", "bodyText": "Are you sure this method is needed? If the config is updated dispose()/initialize() are called.", "bodyHTML": "<p dir=\"auto\">Are you sure this method is needed? If the config is updated <code>dispose()</code>/<code>initialize()</code> are called.</p>", "author": "fwolter", "createdAt": "2020-06-20T21:43:03Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();\n+            ensureSignIn();\n+\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        updateStatus(ThingStatus.OFFLINE);\n+    }\n+\n+    /**\n+     * Handles commands\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        // nothing to do here\n+    }\n+\n+    private void ensureSignIn() {\n+        if (signInService == null) {\n+            signInService = new SignInService(getConfiguration(), httpClient);\n+        }\n+        if (signInService != null) {\n+            signInService.SignIn(sessionId -> handleSignInDone(sessionId), () -> handleConnectionLost(),\n+                    () -> handleUnauthorizedWhileSignIn());\n+        }\n+    }\n+\n+    private void handleRefreshDone(@Nullable GroupContentResponseModel groupContentResponse) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleRefreshDone({})\", groupContentResponse);\n+\n+        if (groupContentResponse != null && groupContentResponse.errorCode == 0) {\n+            new RefreshGroupContentService(groupContentResponse.groupContents, getThing().getThings()).Handle();\n+        } else {\n+            logger.error(\"Wrong or no result model; Refreshing stoppped\");\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+            if (refreshService != null) {\n+                refreshService.stop();\n+            }\n+        }\n+    }\n+\n+    private void handleSignInDone(String sessionId) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleSignInDone({})\", sessionId);\n+        if (refreshService == null) {\n+            refreshService = new RefreshService(getConfiguration(), httpClient);\n+        }\n+        if (refreshService != null) {\n+            refreshService.start(sessionId, content -> handleRefreshDone(content), () -> handleConnectionLost(),\n+                    () -> handleUnauthorized());\n+\n+            updateStatus(ThingStatus.ONLINE);\n+        }\n+    }\n+\n+    private void handleUnauthorized() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleUnauthorized()\");\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(1);\n+    }\n+\n+    private void handleUnauthorizedWhileSignIn() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleUnauthorizedWhileSignIn()\");\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR);\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+    }\n+\n+    private void handleConnectionLost() {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleConnectionLost()\");\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(getConfiguration().refreshDelayInSeconds);\n+    }\n+\n+    private void restartRefreshServiceAsync(long delayInSeconds) {\n+        logger.trace(\"OJElectronicsBridgeHandler.restartRefreshServiceAsync({})\", delayInSeconds);\n+        Executors.newScheduledThreadPool(1).schedule(new Runnable() {\n+            @Override\n+            public void run() {\n+                ensureSignIn();\n+            }\n+        }, delayInSeconds, TimeUnit.SECONDS);\n+    }\n+\n+    private OJElectronicsBridgeConfiguration getConfiguration() {\n+        return getConfigAs(OJElectronicsBridgeConfiguration.class);\n+    }\n+\n+    @Override\n+    public void handleConfigurationUpdate(Map<String, Object> configurationParameters) {", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjI3MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162271", "body": "Are you sure this method is needed? If the bridge goes offline, its child Things are updated, too.", "bodyText": "Are you sure this method is needed? If the bridge goes offline, its child Things are updated, too.", "bodyHTML": "<p dir=\"auto\">Are you sure this method is needed? If the bridge goes offline, its child Things are updated, too.</p>", "author": "fwolter", "createdAt": "2020-06-20T21:46:53Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsThermostatHandler.java", "diffHunk": "@@ -0,0 +1,124 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingStatusInfo;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsThermostatConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link OJElectronicsThermostatHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author EvilPingu - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsThermostatHandler extends BaseThingHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsThermostatHandler.class);\n+\n+    private String serialNumber;\n+\n+    /**\n+     * Creates a new instance of {@link OJElectronicsThermostatHandler}\n+     *\n+     * @param thing Thing\n+     */\n+    public OJElectronicsThermostatHandler(Thing thing) {\n+        super(thing);\n+        serialNumber = getConfigAs(OJElectronicsThermostatConfiguration.class).serialNumber;\n+    }\n+\n+    /**\n+     * Gets the thing's serial number.\n+     *\n+     * @return serial number\n+     */\n+    public String getSerialNumber() {\n+        return serialNumber;\n+    }\n+\n+    /**\n+     * Handles changes of the state of the bridge of this thing.\n+     */\n+    @Override\n+    public void bridgeStatusChanged(ThingStatusInfo bridgeStatusInfo) {", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjMyMA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162320", "body": "You might want to handle the refresh command.", "bodyText": "You might want to handle the refresh command.", "bodyHTML": "<p dir=\"auto\">You might want to handle the refresh command.</p>", "author": "fwolter", "createdAt": "2020-06-20T21:47:35Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsThermostatHandler.java", "diffHunk": "@@ -0,0 +1,124 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.ThingStatusInfo;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsThermostatConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link OJElectronicsThermostatHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author EvilPingu - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsThermostatHandler extends BaseThingHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsThermostatHandler.class);\n+\n+    private String serialNumber;\n+\n+    /**\n+     * Creates a new instance of {@link OJElectronicsThermostatHandler}\n+     *\n+     * @param thing Thing\n+     */\n+    public OJElectronicsThermostatHandler(Thing thing) {\n+        super(thing);\n+        serialNumber = getConfigAs(OJElectronicsThermostatConfiguration.class).serialNumber;\n+    }\n+\n+    /**\n+     * Gets the thing's serial number.\n+     *\n+     * @return serial number\n+     */\n+    public String getSerialNumber() {\n+        return serialNumber;\n+    }\n+\n+    /**\n+     * Handles changes of the state of the bridge of this thing.\n+     */\n+    @Override\n+    public void bridgeStatusChanged(ThingStatusInfo bridgeStatusInfo) {\n+        super.bridgeStatusChanged(bridgeStatusInfo);\n+        if (bridgeStatusInfo.getStatus() == ThingStatus.OFFLINE) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.BRIDGE_OFFLINE);\n+        }\n+    }\n+\n+    /**\n+     * Handles commands to this thing.\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        // nothing do here", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxODIwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443218205", "bodyText": "Yes i want but not an the moment. Handle command is the next step", "author": "EvilPingu", "createdAt": "2020-06-21T13:10:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjQwNA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162404", "body": "Is this key public?", "bodyText": "Is this key public?", "bodyHTML": "<p dir=\"auto\">Is this key public?</p>", "author": "fwolter", "createdAt": "2020-06-20T21:48:45Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/config/OJElectronicsBridgeConfiguration.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.config;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+/**\n+ * The configuration for {@link org.openhab.binding.ojelectronics.internal.OJElectronicsBridgeHandler}\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeConfiguration {\n+\n+    /**\n+     * Password\n+     */\n+    public String password = \"\";\n+\n+    /**\n+     * Customer-ID\n+     */\n+    public Integer customerId = 1;\n+\n+    /**\n+     * User Name\n+     */\n+    public String userName = \"\";\n+\n+    /**\n+     * Url for API\n+     */\n+    public String apiUrl = \"https://OWD5-OJ001-App.ojelectronics.com/api\";\n+\n+    /**\n+     * API-Key\n+     */\n+    public String APIKEY = \"f219aab4-9ac0-4343-8422-b72203e2fac9\";", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIxODU2NA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443218564", "bodyText": "It's not public. Should i remove the bridge parameter?", "author": "EvilPingu", "createdAt": "2020-06-21T13:15:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjQwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIzNzY3Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443237672", "bodyText": "It depends on the license of the vendor. If you are allowed to distribute the key to third parties, it's ok. By signing the commit messages you take responsibility.", "author": "fwolter", "createdAt": "2020-06-21T16:56:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjQwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI0NDEyNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443244125", "bodyText": "I think it's complicated. I'm not the vendor so i'm not allowed to distrubute. So i'm deleting the Key and every one have to set it to a thing property.", "author": "EvilPingu", "createdAt": "2020-06-21T18:23:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjQwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjQzNg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162436", "body": "Syntactical sugar\r\n```suggestion\r\n    public List<Event> events = new ArrayList<>();\r\n```", "bodyText": "Syntactical sugar\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public List<Event> events = new ArrayList<Event>();\n          \n          \n            \n                public List<Event> events = new ArrayList<>();", "bodyHTML": "<p dir=\"auto\">Syntactical sugar</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">Event</span>&gt;</span> events <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-k\">ArrayList&lt;<span class=\"pl-smi x x-first x-last\">Event</span>&gt;</span>();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">List&lt;<span class=\"pl-smi\">Event</span>&gt;</span> events <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-k\">ArrayList&lt;&gt;</span>();</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "fwolter", "createdAt": "2020-06-20T21:49:20Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/models/groups/Day.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.models.groups;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Model for a day\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class Day {\n+\n+    @SerializedName(\"WeekDayGrpNo\")\n+    @Expose\n+    public Integer weekDayGrpNo = 0;\n+    @SerializedName(\"Events\")\n+    @Expose\n+    public List<Event> events = new ArrayList<Event>();", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjUwMA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162500", "body": "How about `apikey`?", "bodyText": "How about apikey?", "bodyHTML": "<p dir=\"auto\">How about <code>apikey</code>?</p>", "author": "fwolter", "createdAt": "2020-06-20T21:50:41Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/models/userprofile/PostSignInQueryModel.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.models.userprofile;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Model for signing sin\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class PostSignInQueryModel {\n+\n+    @SerializedName(\"APIKEY\")\n+    @Expose\n+    public String aPIKEY = \"\";", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjU4Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162586", "body": "Syntactical sugar\r\n```suggestion\r\n        groupContentList.stream().flatMap(entry -> entry.thermostats.stream()).forEach(this::HandleThermostat);\r\n```", "bodyText": "Syntactical sugar\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    groupContentList.stream().flatMap(entry -> entry.thermostats.stream())\n          \n          \n            \n                            .forEach(thermostat -> HandleThermostat(thermostat));\n          \n          \n            \n                    groupContentList.stream().flatMap(entry -> entry.thermostats.stream()).forEach(this::HandleThermostat);", "bodyHTML": "<p dir=\"auto\">Syntactical sugar</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        groupContentList<span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>flatMap(entry <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> entry<span class=\"pl-k\">.</span>thermostats<span class=\"pl-k\">.</span>stream())</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                .forEach(thermostat <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> HandleThermostat(thermostat));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        groupContentList<span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>flatMap(entry <span class=\"pl-k\">-</span><span class=\"pl-k\">&gt;</span> entry<span class=\"pl-k\">.</span>thermostats<span class=\"pl-k\">.</span>stream())<span class=\"pl-k\">.</span>forEach(<span class=\"pl-c1\">this</span><span class=\"pl-k\">::</span><span class=\"pl-smi\">HandleThermostat</span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "fwolter", "createdAt": "2020-06-20T21:52:10Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshGroupContentService.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.openhab.binding.ojelectronics.internal.OJElectronicsThermostatHandler;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContent;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * Refreshes values of {@link OJElectronicsThermostatHandler}\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class RefreshGroupContentService {\n+\n+    private final List<GroupContent> groupContentList;\n+    private List<Thing> things;\n+\n+    /**\n+     * Creates a new instance of {@link RefreshGroupContentService}\n+     *\n+     * @param groupContents {@link GroupContent}\n+     * @param things Things\n+     */\n+    public RefreshGroupContentService(List<GroupContent> groupContents, List<Thing> things) {\n+        this.groupContentList = groupContents;\n+        this.things = things;\n+    }\n+\n+    /**\n+     * Handles the changes to all things.\n+     */\n+    public void Handle() {\n+        groupContentList.stream().flatMap(entry -> entry.thermostats.stream())\n+                .forEach(thermostat -> HandleThermostat(thermostat));", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjYzMg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162632", "body": "Can you use camel case? Same for below.\r\n```suggestion\r\n    public void handle() {\r\n```", "bodyText": "Can you use camel case? Same for below.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void Handle() {\n          \n          \n            \n                public void handle() {", "bodyHTML": "<p dir=\"auto\">Can you use camel case? Same for below.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">Handle</span>() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">handle</span>() {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "fwolter", "createdAt": "2020-06-20T21:53:01Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshGroupContentService.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.openhab.binding.ojelectronics.internal.OJElectronicsThermostatHandler;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContent;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * Refreshes values of {@link OJElectronicsThermostatHandler}\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class RefreshGroupContentService {\n+\n+    private final List<GroupContent> groupContentList;\n+    private List<Thing> things;\n+\n+    /**\n+     * Creates a new instance of {@link RefreshGroupContentService}\n+     *\n+     * @param groupContents {@link GroupContent}\n+     * @param things Things\n+     */\n+    public RefreshGroupContentService(List<GroupContent> groupContents, List<Thing> things) {\n+        this.groupContentList = groupContents;\n+        this.things = things;\n+    }\n+\n+    /**\n+     * Handles the changes to all things.\n+     */\n+    public void Handle() {", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2Mjc1NA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162754", "body": "```suggestion\r\n    private @Nullable Runnable connectionLost;\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private @Nullable Runnable connectionLosed;\n          \n          \n            \n                private @Nullable Runnable connectionLost;", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">@Nullable</span> <span class=\"pl-smi\">Runnable</span> <span class=\"x x-first x-last\">connectionLosed</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">@Nullable</span> <span class=\"pl-smi\">Runnable</span> <span class=\"x x-first x-last\">connectionLost</span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "fwolter", "createdAt": "2020-06-20T21:55:29Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshService.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Handles the refreshing of the devices of a OJElectronics session\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public final class RefreshService implements AutoCloseable {\n+\n+    private final OJElectronicsBridgeConfiguration config;\n+    private final Logger logger = LoggerFactory.getLogger(RefreshService.class);\n+    private final HttpClient httpClient;\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\").create();\n+\n+    private @Nullable Runnable connectionLosed;", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjgwMA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162800", "body": "See above", "bodyText": "See above", "bodyHTML": "<p dir=\"auto\">See above</p>", "author": "fwolter", "createdAt": "2020-06-20T21:56:11Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshService.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Handles the refreshing of the devices of a OJElectronics session\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public final class RefreshService implements AutoCloseable {\n+\n+    private final OJElectronicsBridgeConfiguration config;\n+    private final Logger logger = LoggerFactory.getLogger(RefreshService.class);\n+    private final HttpClient httpClient;\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\").create();\n+\n+    private @Nullable Runnable connectionLosed;\n+    private @Nullable Consumer<@Nullable GroupContentResponseModel> refreshDone;\n+    private @Nullable ScheduledFuture<?> scheduler;\n+    private @Nullable Runnable unauthorized;\n+    private String sessionId = \"\";\n+    private static Boolean destroyed = false;\n+\n+    /**\n+     * Creates a new instance of {@link RefreshService}\n+     *\n+     * @param config Configuration of the bridge\n+     * @param httpClient HTTP client\n+     */\n+    public RefreshService(OJElectronicsBridgeConfiguration config, HttpClient httpClient) {\n+        this.config = config;\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Starts refreshing all thing values\n+     *\n+     * @param sessionId Session-Id\n+     * @param refreshDone This method is called if refreshing is done.\n+     * @param connectionLosed This method is called if no connection could established.\n+     * @param unauthorized This method is called if the result is unauthorized.\n+     */\n+    public void start(String sessionId, Consumer<@Nullable GroupContentResponseModel> refreshDone,\n+            Runnable connectionLosed, Runnable unauthorized) {\n+        logger.trace(\"RefreshService.startService({})\", sessionId);\n+        this.connectionLosed = connectionLosed;\n+        this.refreshDone = refreshDone;\n+        this.unauthorized = unauthorized;\n+        this.sessionId = sessionId;\n+        long refreshTime = config.refreshDelayInSeconds;\n+        scheduler = Executors.newScheduledThreadPool(1).scheduleWithFixedDelay(() -> refresh(), refreshTime,\n+                refreshTime, TimeUnit.SECONDS);", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MjkyNA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443162924", "body": "Syntactical sugar\r\n```suggestion\r\n            refreshService.start(sessionId, this::handleRefreshDone, this::handleConnectionLost,\r\n                    this::handleUnauthorized);\r\n```", "bodyText": "Syntactical sugar\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        refreshService.start(sessionId, content -> handleRefreshDone(content), () -> handleConnectionLost(),\n          \n          \n            \n                                () -> handleUnauthorized());\n          \n          \n            \n                        refreshService.start(sessionId, this::handleRefreshDone, this::handleConnectionLost,\n          \n          \n            \n                                this::handleUnauthorized);", "bodyHTML": "<p dir=\"auto\">Syntactical sugar</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            refreshService<span class=\"pl-k\">.</span>start(sessionId, <span class=\"x x-first\">content </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span>handleRefreshDone<span class=\"x x-first\">(content), () </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span>handleConnectionLost<span class=\"x x-first x-last\">()</span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                    <span class=\"x x-first\">() </span><span class=\"pl-k x\">-</span><span class=\"pl-k x\">&gt;</span><span class=\"x x-last\"> </span>handleUnauthorized<span class=\"x x-first x-last\">()</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            refreshService<span class=\"pl-k\">.</span>start(sessionId, <span class=\"pl-c1 x x-first\">this</span><span class=\"pl-k x x-last\">::</span>handleRefreshDone<span class=\"x x-first\">, </span><span class=\"pl-c1 x\">this</span><span class=\"pl-k x x-last\">::</span>handleConnectionLost,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                    <span class=\"pl-c1 x x-first\">this</span><span class=\"pl-k x x-last\">::</span>handleUnauthorized);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "fwolter", "createdAt": "2020-06-20T21:58:03Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        logger.trace(\"OJElectronicsBridgeHandler.OJElectronicsBridgeHandler({})\", bridge);\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        try {\n+            httpClient.start();\n+            ensureSignIn();\n+\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        super.dispose();\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        updateStatus(ThingStatus.OFFLINE);\n+    }\n+\n+    /**\n+     * Handles commands\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        // nothing to do here\n+    }\n+\n+    private void ensureSignIn() {\n+        if (signInService == null) {\n+            signInService = new SignInService(getConfiguration(), httpClient);\n+        }\n+        if (signInService != null) {\n+            signInService.SignIn(sessionId -> handleSignInDone(sessionId), () -> handleConnectionLost(),\n+                    () -> handleUnauthorizedWhileSignIn());\n+        }\n+    }\n+\n+    private void handleRefreshDone(@Nullable GroupContentResponseModel groupContentResponse) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleRefreshDone({})\", groupContentResponse);\n+\n+        if (groupContentResponse != null && groupContentResponse.errorCode == 0) {\n+            new RefreshGroupContentService(groupContentResponse.groupContents, getThing().getThings()).Handle();\n+        } else {\n+            logger.error(\"Wrong or no result model; Refreshing stoppped\");\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+            if (refreshService != null) {\n+                refreshService.stop();\n+            }\n+        }\n+    }\n+\n+    private void handleSignInDone(String sessionId) {\n+        logger.trace(\"OJElectronicsBridgeHandler.handleSignInDone({})\", sessionId);\n+        if (refreshService == null) {\n+            refreshService = new RefreshService(getConfiguration(), httpClient);\n+        }\n+        if (refreshService != null) {\n+            refreshService.start(sessionId, content -> handleRefreshDone(content), () -> handleConnectionLost(),\n+                    () -> handleUnauthorized());", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MzIyNA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443163224", "body": "You might want to log the exception's message.", "bodyText": "You might want to log the exception's message.", "bodyHTML": "<p dir=\"auto\">You might want to log the exception's message.</p>", "author": "fwolter", "createdAt": "2020-06-20T22:03:17Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshService.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Handles the refreshing of the devices of a OJElectronics session\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public final class RefreshService implements AutoCloseable {\n+\n+    private final OJElectronicsBridgeConfiguration config;\n+    private final Logger logger = LoggerFactory.getLogger(RefreshService.class);\n+    private final HttpClient httpClient;\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\").create();\n+\n+    private @Nullable Runnable connectionLosed;\n+    private @Nullable Consumer<@Nullable GroupContentResponseModel> refreshDone;\n+    private @Nullable ScheduledFuture<?> scheduler;\n+    private @Nullable Runnable unauthorized;\n+    private String sessionId = \"\";\n+    private static Boolean destroyed = false;\n+\n+    /**\n+     * Creates a new instance of {@link RefreshService}\n+     *\n+     * @param config Configuration of the bridge\n+     * @param httpClient HTTP client\n+     */\n+    public RefreshService(OJElectronicsBridgeConfiguration config, HttpClient httpClient) {\n+        this.config = config;\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Starts refreshing all thing values\n+     *\n+     * @param sessionId Session-Id\n+     * @param refreshDone This method is called if refreshing is done.\n+     * @param connectionLosed This method is called if no connection could established.\n+     * @param unauthorized This method is called if the result is unauthorized.\n+     */\n+    public void start(String sessionId, Consumer<@Nullable GroupContentResponseModel> refreshDone,\n+            Runnable connectionLosed, Runnable unauthorized) {\n+        logger.trace(\"RefreshService.startService({})\", sessionId);\n+        this.connectionLosed = connectionLosed;\n+        this.refreshDone = refreshDone;\n+        this.unauthorized = unauthorized;\n+        this.sessionId = sessionId;\n+        long refreshTime = config.refreshDelayInSeconds;\n+        scheduler = Executors.newScheduledThreadPool(1).scheduleWithFixedDelay(() -> refresh(), refreshTime,\n+                refreshTime, TimeUnit.SECONDS);\n+        destroyed = false;\n+    }\n+\n+    /**\n+     * Stops refreshing.\n+     */\n+    public void stop() {\n+        logger.trace(\"RefreshService.stopService({})\", this);\n+        destroyed = true;\n+        if (scheduler != null) {\n+            scheduler.cancel(false);\n+            scheduler = null;\n+        }\n+    }\n+\n+    private void refresh() {\n+        logger.trace(\"RefreshService.refresh({})\", this);\n+\n+        if (sessionId.equals(\"\")) {\n+            handleConnectionLosed();\n+            return;\n+        }\n+        CreateRequest().send(new BufferingResponseListener() {\n+            @Override\n+            public void onComplete(@Nullable Result result) {\n+                if (!destroyed) {\n+                    if (result == null || result.isFailed()) {\n+                        handleConnectionLosed();\n+                    } else if (result.getResponse().getStatus() == HttpStatus.FORBIDDEN_403) {\n+                        if (unauthorized != null) {\n+                            unauthorized.run();\n+                        }\n+                    } else {\n+                        handleRefreshDone(getContentAsString());\n+                    }\n+                }\n+            }\n+\n+        });\n+    }\n+\n+    private Request CreateRequest() {\n+        Request request = httpClient.newRequest(config.apiUrl + \"/Group/GroupContents\").param(\"sessionid\", sessionId)\n+                .param(\"APIKEY\", config.APIKEY).method(HttpMethod.GET);\n+        return request;\n+    }\n+\n+    private void handleRefreshDone(String responseBody) {\n+        if (refreshDone != null) {\n+            logger.trace(\"refresh {}\", responseBody);\n+\n+            try {\n+                GroupContentResponseModel content = gson.fromJson(responseBody, GroupContentResponseModel.class);\n+                if (refreshDone != null) {\n+                    refreshDone.accept(content);\n+                }\n+            } catch (JsonSyntaxException exception) {\n+                handleConnectionLosed();", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2MzI2OA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443163268", "body": "```suggestion\r\n    private PostSignInQueryModel getPostSignInQueryModel() {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private PostSignInQueryModel getpostSignInQueryModel() {\n          \n          \n            \n                private PostSignInQueryModel getPostSignInQueryModel() {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">PostSignInQueryModel</span> <span class=\"x x-first x-last\">getpostSignInQueryModel</span>() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">PostSignInQueryModel</span> <span class=\"x x-first x-last\">getPostSignInQueryModel</span>() {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "fwolter", "createdAt": "2020-06-20T22:04:37Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/SignInService.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.userprofile.PostSignInQueryModel;\n+import org.openhab.binding.ojelectronics.internal.models.userprofile.PostSignInResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Handles the sign in process.\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class SignInService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(SignInService.class);\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().create();\n+\n+    private final HttpClient httpClient;\n+    private final OJElectronicsBridgeConfiguration config;\n+\n+    /**\n+     * Creates a new instance of {@link SignInService}\n+     *\n+     * @param config configuration {@link OJElectronicsBridgeConfiguration}\n+     * @param httpClient HTTP client\n+     */\n+    public SignInService(OJElectronicsBridgeConfiguration config, HttpClient httpClient) {\n+        this.config = config;\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Signing in\n+     *\n+     * @param signInDone This method is called if sign in process was successful.\n+     * @param connectionLosed This method is called if no connection could established.\n+     * @param unauthorized This method is called if the result is unauthorized.\n+     */\n+    public void SignIn(Consumer<String> signInDone, Runnable connectionLosed, Runnable unauthorized) {\n+        logger.trace(\"SignInService.SignIn ({})\", this);\n+        Request request = httpClient.POST(config.apiUrl + \"/UserProfile/SignIn\")\n+                .header(HttpHeader.CONTENT_TYPE, \"application/json\")\n+                .content(new StringContentProvider(gson.toJson(getpostSignInQueryModel())));\n+\n+        request.send(new BufferingResponseListener() {\n+            @Override\n+            public void onComplete(@Nullable Result result) {\n+                if (result == null || result.isFailed()) {\n+                    connectionLosed.run();\n+                    return;\n+                }\n+                if (result != null && result.getResponse().getStatus() != 200) {\n+                    unauthorized.run();\n+                    return;\n+                }\n+                PostSignInResponseModel signInModel = gson.fromJson(getContentAsString(),\n+                        PostSignInResponseModel.class);\n+                if (signInModel.errorCode != 0 || signInModel.sessionId.equals(\"\")) {\n+                    unauthorized.run();\n+                    return;\n+                }\n+                signInDone.accept(signInModel.sessionId);\n+            }\n+        });\n+    }\n+\n+    private PostSignInQueryModel getpostSignInQueryModel() {", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2NDAyNA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443164024", "body": "This is not used.", "bodyText": "This is not used.", "bodyHTML": "<p dir=\"auto\">This is not used.</p>", "author": "fwolter", "createdAt": "2020-06-20T22:17:46Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.Map;\n+import java.util.concurrent.Executors;", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE2NDA1MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r443164051", "body": "This null check is not needed.", "bodyText": "This null check is not needed.", "bodyHTML": "<p dir=\"auto\">This null check is not needed.</p>", "author": "fwolter", "createdAt": "2020-06-20T22:18:36Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/SignInService.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.client.util.StringContentProvider;\n+import org.eclipse.jetty.http.HttpHeader;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.userprofile.PostSignInQueryModel;\n+import org.openhab.binding.ojelectronics.internal.models.userprofile.PostSignInResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+\n+/**\n+ * Handles the sign in process.\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class SignInService {\n+\n+    private final Logger logger = LoggerFactory.getLogger(SignInService.class);\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().create();\n+\n+    private final HttpClient httpClient;\n+    private final OJElectronicsBridgeConfiguration config;\n+\n+    /**\n+     * Creates a new instance of {@link SignInService}\n+     *\n+     * @param config configuration {@link OJElectronicsBridgeConfiguration}\n+     * @param httpClient HTTP client\n+     */\n+    public SignInService(OJElectronicsBridgeConfiguration config, HttpClient httpClient) {\n+        this.config = config;\n+        this.httpClient = httpClient;\n+    }\n+\n+    /**\n+     * Signing in\n+     *\n+     * @param signInDone This method is called if sign in process was successful.\n+     * @param connectionLosed This method is called if no connection could established.\n+     * @param unauthorized This method is called if the result is unauthorized.\n+     */\n+    public void SignIn(Consumer<String> signInDone, Runnable connectionLosed, Runnable unauthorized) {\n+        logger.trace(\"SignInService.SignIn ({})\", this);\n+        Request request = httpClient.POST(config.apiUrl + \"/UserProfile/SignIn\")\n+                .header(HttpHeader.CONTENT_TYPE, \"application/json\")\n+                .content(new StringContentProvider(gson.toJson(getpostSignInQueryModel())));\n+\n+        request.send(new BufferingResponseListener() {\n+            @Override\n+            public void onComplete(@Nullable Result result) {\n+                if (result == null || result.isFailed()) {\n+                    connectionLosed.run();\n+                    return;\n+                }\n+                if (result != null && result.getResponse().getStatus() != 200) {", "originalCommit": "2f6825ed37a2d831875e1e062fd02fbc08a781d2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4MzE4OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r446683189", "body": "What exception do you want to catch here? Can you sepcify the concrete type or can this be removed?", "bodyText": "What exception do you want to catch here? Can you sepcify the concrete type or can this be removed?", "bodyHTML": "<p dir=\"auto\">What exception do you want to catch here? Can you sepcify the concrete type or can this be removed?</p>", "author": "fwolter", "createdAt": "2020-06-28T18:35:10Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+    private OJElectronicsBridgeConfiguration configuration;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        this.configuration = new OJElectronicsBridgeConfiguration();\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        configuration = getConfigAs(OJElectronicsBridgeConfiguration.class);\n+        try {\n+            ensureSignIn();\n+        } catch (Exception e) {", "originalCommit": "28bfcc274d491586ac61468eb3e8f8576284eb3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4MzMwOA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r446683308", "body": "No harm in setting a null field to null. You could remove the if.", "bodyText": "No harm in setting a null field to null. You could remove the if.", "bodyHTML": "<p dir=\"auto\">No harm in setting a null field to null. You could remove the if.</p>", "author": "fwolter", "createdAt": "2020-06-28T18:36:03Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsBridgeHandler.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsBridgeHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+    private OJElectronicsBridgeConfiguration configuration;\n+\n+    public OJElectronicsBridgeHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        this.configuration = new OJElectronicsBridgeConfiguration();\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        configuration = getConfigAs(OJElectronicsBridgeConfiguration.class);\n+        try {\n+            ensureSignIn();\n+        } catch (Exception e) {\n+            logger.error(\"error initializing OJElectronicsBridgeHandler\", e);\n+        }\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        if (refreshService != null) {\n+            refreshService.stop();\n+            refreshService = null;\n+        }\n+        if (signInService != null) {\n+            signInService = null;\n+        }", "originalCommit": "28bfcc274d491586ac61468eb3e8f8576284eb3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY4NTAzNw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r446685037", "body": "Units of Measure, to be able to specify `Number:Temperature` in the XML file.\r\n```suggestion\r\n                new QuantityType<Temperature>(thermostat.floorTemperature / (double) 100, SIUnits.CELSIUS));\r\n```", "bodyText": "Units of Measure, to be able to specify Number:Temperature in the XML file.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            new DecimalType(thermostat.comfortSetpoint / (double) 100));\n          \n          \n            \n                            new QuantityType<Temperature>(thermostat.floorTemperature / (double) 100, SIUnits.CELSIUS));", "bodyHTML": "<p dir=\"auto\">Units of Measure, to be able to specify <code>Number:Temperature</code> in the XML file.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                <span class=\"pl-k\">new</span> <span class=\"pl-smi x x-first x-last\">DecimalType</span>(thermostat<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">comfortSetpoint</span> <span class=\"pl-k\">/</span> (<span class=\"pl-k\">double</span>) <span class=\"pl-c1\">100</span>));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">new</span> <span class=\"pl-k\"><span class=\"x x-first\">QuantityType&lt;</span><span class=\"pl-smi x\">Temperature</span><span class=\"x x-last\">&gt;</span></span>(thermostat<span class=\"pl-k\">.</span><span class=\"x x-first x-last\">floorTemperature</span> <span class=\"pl-k\">/</span> (<span class=\"pl-k\">double</span>) <span class=\"pl-c1\">100</span><span class=\"x x-first\">, </span><span class=\"pl-smi x\">SIUnits</span><span class=\"pl-c1\"><span class=\"pl-k x\">.</span><span class=\"x x-last\">CELSIUS</span></span>));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "fwolter", "createdAt": "2020-06-28T18:53:58Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsThermostatHandler.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OpenClosedType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsThermostatConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * The {@link OJElectronicsThermostatHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author EvilPingu - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsThermostatHandler extends BaseThingHandler {\n+\n+    private String serialNumber;\n+\n+    /**\n+     * Creates a new instance of {@link OJElectronicsThermostatHandler}\n+     *\n+     * @param thing Thing\n+     */\n+    public OJElectronicsThermostatHandler(Thing thing) {\n+        super(thing);\n+        serialNumber = getConfigAs(OJElectronicsThermostatConfiguration.class).serialNumber;\n+    }\n+\n+    /**\n+     * Gets the thing's serial number.\n+     *\n+     * @return serial number\n+     */\n+    public String getSerialNumber() {\n+        return serialNumber;\n+    }\n+\n+    /**\n+     * Handles commands to this thing.\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        // nothing do here\n+    }\n+\n+    /**\n+     * Initializes the thing handler.\n+     */\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    /**\n+     * Sets the values after refreshing the thermostats values\n+     *\n+     * @param thermostat thermostat values\n+     */\n+    public void handleThermostatRefresh(Thermostat thermostat) {\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_GROUPNAME, StringType.valueOf(thermostat.groupName));\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_GROUPID, new DecimalType(thermostat.groupId));\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_ONLINE,\n+                thermostat.online ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_HEATING,\n+                thermostat.heating ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_ROOMTEMPERATURE,\n+                new DecimalType(thermostat.roomTemperature / (double) 100));\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_FLOORTEMPERATURE,\n+                new DecimalType(thermostat.floorTemperature / (double) 100));\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_THERMOSTATNAME,\n+                StringType.valueOf(thermostat.thermostatName));\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_REGULATIONMODE,\n+                StringType.valueOf(thermostat.regulationMode.toString()));\n+        updateState(OJElectronicsBindingConstants.CHANNEL_OWD5_COMFORTSETPOINT,\n+                new DecimalType(thermostat.comfortSetpoint / (double) 100));", "originalCommit": "28bfcc274d491586ac61468eb3e8f8576284eb3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE5OTI4MA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r449199280", "body": "Didn't notice this can't be final. In this case this should be lower case. Sorry.\r\n\r\nYou could use the primitve type: `boolean`", "bodyText": "Didn't notice this can't be final. In this case this should be lower case. Sorry.\nYou could use the primitve type: boolean", "bodyHTML": "<p dir=\"auto\">Didn't notice this can't be final. In this case this should be lower case. Sorry.</p>\n<p dir=\"auto\">You could use the primitve type: <code>boolean</code></p>", "author": "fwolter", "createdAt": "2020-07-02T18:31:27Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshService.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Handles the refreshing of the devices of a OJElectronics session\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public final class RefreshService implements AutoCloseable {\n+\n+    private final OJElectronicsBridgeConfiguration config;\n+    private final Logger logger = LoggerFactory.getLogger(RefreshService.class);\n+    private final HttpClient httpClient;\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\").create();\n+    private final ScheduledExecutorService schedulerService;\n+\n+    private @Nullable Runnable connectionLost;\n+    private @Nullable Consumer<@Nullable GroupContentResponseModel> refreshDone;\n+    private @Nullable ScheduledFuture<?> scheduler;\n+    private @Nullable Runnable unauthorized;\n+    private String sessionId = \"\";\n+    private static Boolean DESTROYED = false;", "originalCommit": "520dff5a82286ab4ff8a02305da7a2459f1b94fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMDcxMA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r449200710", "body": "Can you cancel this task when `dispose()` is invoked?", "bodyText": "Can you cancel this task when dispose() is invoked?", "bodyHTML": "<p dir=\"auto\">Can you cancel this task when <code>dispose()</code> is invoked?</p>", "author": "fwolter", "createdAt": "2020-07-02T18:34:32Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsCloudHandler.java", "diffHunk": "@@ -0,0 +1,152 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsCloudHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsCloudHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+    private OJElectronicsBridgeConfiguration configuration;\n+\n+    public OJElectronicsCloudHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        this.configuration = new OJElectronicsBridgeConfiguration();\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        configuration = getConfigAs(OJElectronicsBridgeConfiguration.class);\n+        ensureSignIn();\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        final RefreshService refreshService = this.refreshService;\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        this.refreshService = null;\n+        signInService = null;\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }\n+\n+    private void ensureSignIn() {\n+        if (signInService == null) {\n+            signInService = new SignInService(configuration, httpClient);\n+        }\n+        final SignInService signInService = this.signInService;\n+        if (signInService != null) {\n+            signInService.signIn(this::handleSignInDone, this::handleConnectionLost,\n+                    this::handleUnauthorizedWhileSignIn);\n+        }\n+    }\n+\n+    private void handleRefreshDone(@Nullable GroupContentResponseModel groupContentResponse) {\n+        logger.trace(\"OJElectronicsCloudHandler.handleRefreshDone({})\", groupContentResponse);\n+\n+        if (groupContentResponse != null && groupContentResponse.errorCode == 0) {\n+            new RefreshGroupContentService(groupContentResponse.groupContents, getThing().getThings()).handle();\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR,\n+                    \"Wrong or no result model; Refreshing stoppped\");\n+            final RefreshService refreshService = this.refreshService;\n+            if (refreshService != null) {\n+                refreshService.stop();\n+            }\n+        }\n+    }\n+\n+    private void handleSignInDone(String sessionId) {\n+        logger.trace(\"OJElectronicsCloudHandler.handleSignInDone({})\", sessionId);\n+        if (refreshService == null) {\n+            refreshService = new RefreshService(configuration, httpClient, scheduler);\n+        }\n+        final RefreshService refreshService = this.refreshService;\n+        if (refreshService != null) {\n+            refreshService.start(sessionId, this::handleRefreshDone, this::handleConnectionLost,\n+                    this::handleUnauthorized);\n+\n+            updateStatus(ThingStatus.ONLINE);\n+        }\n+    }\n+\n+    private void handleUnauthorized() {\n+        final RefreshService refreshService = this.refreshService;\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(1);\n+    }\n+\n+    private void handleUnauthorizedWhileSignIn() {\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                \"Could not sign in. Check user name and password.\");\n+        final RefreshService refreshService = this.refreshService;\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+    }\n+\n+    private void handleConnectionLost() {\n+        updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR);\n+        final RefreshService refreshService = this.refreshService;\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        restartRefreshServiceAsync(configuration.refreshDelayInSeconds);\n+    }\n+\n+    private void restartRefreshServiceAsync(long delayInSeconds) {\n+        scheduler.schedule(this::ensureSignIn, delayInSeconds, TimeUnit.SECONDS);", "originalCommit": "520dff5a82286ab4ff8a02305da7a2459f1b94fe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyMjMyNw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452222327", "body": "Please handle the REFRESH-command directly or indirectly via some cache. It prevents situations were people link an additional channel after the binding was already started. It will make sure that they don't have to wait until the next cycle for the data to be populated.", "bodyText": "Please handle the REFRESH-command directly or indirectly via some cache. It prevents situations were people link an additional channel after the binding was already started. It will make sure that they don't have to wait until the next cycle for the data to be populated.", "bodyHTML": "<p dir=\"auto\">Please handle the REFRESH-command directly or indirectly via some cache. It prevents situations were people link an additional channel after the binding was already started. It will make sure that they don't have to wait until the next cycle for the data to be populated.</p>", "author": "martinvw", "createdAt": "2020-07-09T13:36:18Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsCloudHandler.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseBridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshGroupContentService;\n+import org.openhab.binding.ojelectronics.internal.services.RefreshService;\n+import org.openhab.binding.ojelectronics.internal.services.SignInService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * Handles all traffic with OJ Electronics cloud\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsCloudHandler extends BaseBridgeHandler implements BridgeHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OJElectronicsCloudHandler.class);\n+    private final HttpClient httpClient;\n+\n+    private @Nullable RefreshService refreshService;\n+    private @Nullable SignInService signInService;\n+    private OJElectronicsBridgeConfiguration configuration;\n+    private @Nullable ScheduledFuture<?> signTask;\n+\n+    public OJElectronicsCloudHandler(Bridge bridge, HttpClient httpClient) {\n+        super(bridge);\n+        this.httpClient = httpClient;\n+        this.configuration = new OJElectronicsBridgeConfiguration();\n+    }\n+\n+    /**\n+     * Initializes the binding.\n+     */\n+    @Override\n+    public void initialize() {\n+        configuration = getConfigAs(OJElectronicsBridgeConfiguration.class);\n+        ensureSignIn();\n+    }\n+\n+    /**\n+     * Disposes the binding.\n+     */\n+    @Override\n+    public void dispose() {\n+        final RefreshService refreshService = this.refreshService;\n+        if (refreshService != null) {\n+            refreshService.stop();\n+        }\n+        final ScheduledFuture<?> signTask = this.signTask;\n+        if (signTask != null) {\n+            signTask.cancel(true);\n+        }\n+        this.refreshService = null;\n+        signInService = null;\n+        super.dispose();\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+    }", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMDk1MA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453220950", "bodyText": "Done.", "author": "EvilPingu", "createdAt": "2020-07-11T18:20:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyMjMyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyMzEzNA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452223134", "body": "It seems that this field can be final.", "bodyText": "It seems that this field can be final.", "bodyHTML": "<p dir=\"auto\">It seems that this field can be final.</p>", "author": "martinvw", "createdAt": "2020-07-09T13:37:23Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsThermostatHandler.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+\n+import javax.measure.quantity.Temperature;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OpenClosedType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsThermostatConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * The {@link OJElectronicsThermostatHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author EvilPingu - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsThermostatHandler extends BaseThingHandler {\n+\n+    private String serialNumber;", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxMDEyNA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452410124", "bodyText": "That's true.", "author": "EvilPingu", "createdAt": "2020-07-09T18:27:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyMzEzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyMzI3Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452223276", "body": "Please use your real name and check all.", "bodyText": "Please use your real name and check all.", "bodyHTML": "<p dir=\"auto\">Please use your real name and check all.</p>", "author": "martinvw", "createdAt": "2020-07-09T13:37:36Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsThermostatHandler.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+\n+import javax.measure.quantity.Temperature;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OpenClosedType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsThermostatConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * The {@link OJElectronicsThermostatHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author EvilPingu - Initial contribution", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxMDY0Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452410643", "bodyText": "Done", "author": "EvilPingu", "createdAt": "2020-07-09T18:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyMzI3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyMzYzOA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452223638", "body": "Are you sure that this guaranteed to be non-null?", "bodyText": "Are you sure that this guaranteed to be non-null?", "bodyHTML": "<p dir=\"auto\">Are you sure that this guaranteed to be non-null?</p>", "author": "martinvw", "createdAt": "2020-07-09T13:38:09Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJElectronicsThermostatHandler.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+\n+import javax.measure.quantity.Temperature;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OpenClosedType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsThermostatConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * The {@link OJElectronicsThermostatHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author EvilPingu - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsThermostatHandler extends BaseThingHandler {\n+\n+    private String serialNumber;\n+\n+    /**\n+     * Creates a new instance of {@link OJElectronicsThermostatHandler}\n+     *\n+     * @param thing Thing\n+     */\n+    public OJElectronicsThermostatHandler(Thing thing) {\n+        super(thing);\n+        serialNumber = getConfigAs(OJElectronicsThermostatConfiguration.class).serialNumber;", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxMTQ2Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452411467", "bodyText": "I think yes because it is required in thing-types.xml", "author": "EvilPingu", "createdAt": "2020-07-09T18:30:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyMzYzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyNDQxMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452224411", "body": "You could consider making this an `int` it will ensure that its non-null :-)", "bodyText": "You could consider making this an int it will ensure that its non-null :-)", "bodyHTML": "<p dir=\"auto\">You could consider making this an <code>int</code> it will ensure that its non-null :-)</p>", "author": "martinvw", "createdAt": "2020-07-09T13:39:19Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/config/OJElectronicsBridgeConfiguration.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.config;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+/**\n+ * The configuration for {@link org.openhab.binding.ojelectronics.internal.OJElectronicsCloudHandler}\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OJElectronicsBridgeConfiguration {\n+\n+    /**\n+     * Password\n+     */\n+    public String password = \"\";\n+\n+    /**\n+     * Customer-ID\n+     */\n+    public Integer customerId = 1;\n+\n+    /**\n+     * User Name\n+     */\n+    public String userName = \"\";\n+\n+    /**\n+     * Url for API\n+     */\n+    public String apiUrl = \"https://OWD5-OJ001-App.ojelectronics.com/api\";\n+\n+    /**\n+     * API-Key\n+     */\n+    public String apiKey = \"\";\n+\n+    /**\n+     * Software Version\n+     */\n+    public Integer softwareVersion = 1060;", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxMzUzMw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452413533", "bodyText": "Done", "author": "EvilPingu", "createdAt": "2020-07-09T18:34:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyNDQxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyNjc5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452226792", "body": "Consider using the consistent `apiKey`", "bodyText": "Consider using the consistent apiKey", "bodyHTML": "<p dir=\"auto\">Consider using the consistent <code>apiKey</code></p>", "author": "martinvw", "createdAt": "2020-07-09T13:42:40Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/models/userprofile/PostSignInQueryModel.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.models.userprofile;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Model for signing sin\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class PostSignInQueryModel {\n+\n+    @SerializedName(\"APIKEY\")\n+    @Expose\n+    public String apikey = \"\";", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxNzkxNA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452417914", "bodyText": "Done", "author": "EvilPingu", "createdAt": "2020-07-09T18:42:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIyNjc5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzNzA2NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452237065", "body": "Is the expose needed, or would it work fine without it?", "bodyText": "Is the expose needed, or would it work fine without it?", "bodyHTML": "<p dir=\"auto\">Is the expose needed, or would it work fine without it?</p>", "author": "martinvw", "createdAt": "2020-07-09T13:56:59Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/models/groups/Day.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.models.groups;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Model for a day\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class Day {\n+\n+    @SerializedName(\"WeekDayGrpNo\")\n+    @Expose", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2OTc1Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453169752", "bodyText": "Of course it works without it. I generated this models with http://www.jsonschema2pojo.org/. I remove this explicit expose. No problem", "author": "EvilPingu", "createdAt": "2020-07-11T07:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzNzA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzODM1Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452238353", "body": "What about using `FieldNamingPolicy.UPPER_CAMEL_CASE` it makes the mapping less verbose and you only have to document what is actually interesting.", "bodyText": "What about using FieldNamingPolicy.UPPER_CAMEL_CASE it makes the mapping less verbose and you only have to document what is actually interesting.", "bodyHTML": "<p dir=\"auto\">What about using <code>FieldNamingPolicy.UPPER_CAMEL_CASE</code> it makes the mapping less verbose and you only have to document what is actually interesting.</p>", "author": "martinvw", "createdAt": "2020-07-09T13:58:44Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/models/groups/Day.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.models.groups;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Model for a day\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class Day {\n+\n+    @SerializedName(\"WeekDayGrpNo\")", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE5NjAwNw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453196007", "bodyText": "I changed this in all models", "author": "EvilPingu", "createdAt": "2020-07-11T13:38:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIzODM1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDEyNw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452240127", "body": "I think it might be dangerous to annotate your JSON classes like this, it gives a false sense of security. GSON will not validate the `null`-ness of the fields. And I don't know whether your bases it on some documentation but even that is not guaranteed to remain as is.\r\n\r\n@cpmeister what do you think of this?", "bodyText": "I think it might be dangerous to annotate your JSON classes like this, it gives a false sense of security. GSON will not validate the null-ness of the fields. And I don't know whether your bases it on some documentation but even that is not guaranteed to remain as is.\n@cpmeister what do you think of this?", "bodyHTML": "<p dir=\"auto\">I think it might be dangerous to annotate your JSON classes like this, it gives a false sense of security. GSON will not validate the <code>null</code>-ness of the fields. And I don't know whether your bases it on some documentation but even that is not guaranteed to remain as is.</p>\n<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/cpmeister/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/cpmeister\">@cpmeister</a> what do you think of this?</p>", "author": "martinvw", "createdAt": "2020-07-09T14:01:05Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/models/groups/Schedule.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.models.groups;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Model for a schedule\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQzNTc0NA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452435744", "bodyText": "If i do so, i think i got a warning.", "author": "EvilPingu", "createdAt": "2020-07-09T19:16:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIxNTgyNA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453215824", "bodyText": "I think it might be dangerous to annotate your JSON classes like this, it gives a false sense of security. GSON will not validate the null-ness of the fields. And I don't know whether your bases it on some documentation but even that is not guaranteed to remain as is.\n\n@openhab/add-ons-maintainers your opinions are greatly appreciated here :-)", "author": "martinvw", "createdAt": "2020-07-11T17:24:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMjIxMg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453222212", "bodyText": "@EvilPingu if no one veto's this (about nullable and json-mapping) one tonight and you looked into the latest remarks it should be ready to be merged! Thanks for your quick responses.", "author": "martinvw", "createdAt": "2020-07-11T18:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyNjc3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453226777", "bodyText": "@martinvw Afaik, our guidelines say that @NonNullByDefault must be used on classes and I do not recall any exception for JSON pojos. I'd hence say, it is fine (while not saying that your remark that it gives a false sense of security is wrong).", "author": "kaikreuzer", "createdAt": "2020-07-11T19:30:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDQ5Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452240497", "body": "If you do believe fields will not be `null`, then better use the primitive types.", "bodyText": "If you do believe fields will not be null, then better use the primitive types.", "bodyHTML": "<p dir=\"auto\">If you do believe fields will not be <code>null</code>, then better use the primitive types.</p>", "author": "martinvw", "createdAt": "2020-07-09T14:01:34Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/models/groups/Schedule.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.models.groups;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Model for a schedule\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class Schedule {\n+\n+    @SerializedName(\"Days\")\n+    @Expose\n+    public List<Day> days = new ArrayList<Day>();\n+    @SerializedName(\"ModifiedDueToVerification\")\n+    @Expose\n+    public Boolean modifiedDueToVerification = false;", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE5NjA4OA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453196088", "bodyText": "I changed this too. I always use primitive types in models now", "author": "EvilPingu", "createdAt": "2020-07-11T13:39:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDQ5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDg1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452240856", "body": "See above", "bodyText": "See above", "bodyHTML": "<p dir=\"auto\">See above</p>", "author": "martinvw", "createdAt": "2020-07-09T14:02:02Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/models/userprofile/PostSignInQueryModel.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.models.userprofile;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+\n+import com.google.gson.annotations.Expose;\n+import com.google.gson.annotations.SerializedName;\n+\n+/**\n+ * Model for signing sin\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class PostSignInQueryModel {\n+\n+    @SerializedName(\"APIKEY\")\n+    @Expose\n+    public String apikey = \"\";\n+\n+    @SerializedName(\"UserName\")\n+    @Expose\n+    public String userName = \"\";\n+\n+    @SerializedName(\"Password\")\n+    @Expose\n+    public String password = \"\";\n+\n+    @SerializedName(\"CustomerId\")\n+    @Expose\n+    public Integer customerId = 0;\n+\n+    @SerializedName(\"ClientSWVersion\")\n+    @Expose\n+    public Integer clientSWVersion = 0;\n+\n+    /**\n+     * Add API-Key\n+     *\n+     * @param aPIKEY API-Key\n+     * @return Model\n+     */\n+    public PostSignInQueryModel withAPIKEY(String apikey) {", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxODk0Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452418946", "bodyText": "Done", "author": "EvilPingu", "createdAt": "2020-07-09T18:44:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MDg1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MjQ5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452242492", "body": "Would something terrible happen if you would support a duplicated device with the same serial number? It would simplify the code:\r\n\r\nyou could then just skip the `findFirst` and replace it by a `forEach`", "bodyText": "Would something terrible happen if you would support a duplicated device with the same serial number? It would simplify the code:\nyou could then just skip the findFirst and replace it by a forEach", "bodyHTML": "<p dir=\"auto\">Would something terrible happen if you would support a duplicated device with the same serial number? It would simplify the code:</p>\n<p dir=\"auto\">you could then just skip the <code>findFirst</code> and replace it by a <code>forEach</code></p>", "author": "martinvw", "createdAt": "2020-07-09T14:04:24Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshGroupContentService.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.openhab.binding.ojelectronics.internal.OJElectronicsThermostatHandler;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContent;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * Refreshes values of {@link OJElectronicsThermostatHandler}\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public class RefreshGroupContentService {\n+\n+    private final List<GroupContent> groupContentList;\n+    private List<Thing> things;\n+\n+    /**\n+     * Creates a new instance of {@link RefreshGroupContentService}\n+     *\n+     * @param groupContents {@link GroupContent}\n+     * @param things Things\n+     */\n+    public RefreshGroupContentService(List<GroupContent> groupContents, List<Thing> things) {\n+        this.groupContentList = groupContents;\n+        this.things = things;\n+    }\n+\n+    /**\n+     * Handles the changes to all things.\n+     */\n+    public void handle() {\n+        groupContentList.stream().flatMap(entry -> entry.thermostats.stream()).forEach(this::handleThermostat);\n+    }\n+\n+    private void handleThermostat(Thermostat thermostat) {\n+        Optional<OJElectronicsThermostatHandler> handler = things.stream()", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIxNzIzNw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453217237", "bodyText": "Done", "author": "EvilPingu", "createdAt": "2020-07-11T17:39:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MjQ5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MzA4NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452243085", "body": "See remark above about using a naming strategy, given the size of the statement you might also consider creating some static method to initialize it.", "bodyText": "See remark above about using a naming strategy, given the size of the statement you might also consider creating some static method to initialize it.", "bodyHTML": "<p dir=\"auto\">See remark above about using a naming strategy, given the size of the statement you might also consider creating some static method to initialize it.</p>", "author": "martinvw", "createdAt": "2020-07-09T14:05:19Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshService.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Handles the refreshing of the devices of a OJElectronics session\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public final class RefreshService implements AutoCloseable {\n+\n+    private final OJElectronicsBridgeConfiguration config;\n+    private final Logger logger = LoggerFactory.getLogger(RefreshService.class);\n+    private final HttpClient httpClient;\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\").create();", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE5NzA5NA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453197094", "bodyText": "I shorten the class names and extracts some methods", "author": "EvilPingu", "createdAt": "2020-07-11T13:51:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI0MzA4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1MDQ3OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452250479", "body": "It might make more sense to just make this fields nullable, it seems you have \"\" a magical meaning instead.\r\n\r\nIf you want to leave, then position the literal first in `String` comparisons - that way if the `String` is `null` you won't get a `NullPointerException`, it'll just return `false`. [source: PMD](http://pmd.sourceforge.net/pmd-4.3.0/rules/design.html#PositionLiteralsFirstInComparisons)", "bodyText": "It might make more sense to just make this fields nullable, it seems you have \"\" a magical meaning instead.\nIf you want to leave, then position the literal first in String comparisons - that way if the String is null you won't get a NullPointerException, it'll just return false. source: PMD", "bodyHTML": "<p dir=\"auto\">It might make more sense to just make this fields nullable, it seems you have \"\" a magical meaning instead.</p>\n<p dir=\"auto\">If you want to leave, then position the literal first in <code>String</code> comparisons - that way if the <code>String</code> is <code>null</code> you won't get a <code>NullPointerException</code>, it'll just return <code>false</code>. <a href=\"http://pmd.sourceforge.net/pmd-4.3.0/rules/design.html#PositionLiteralsFirstInComparisons\" rel=\"nofollow\">source: PMD</a></p>", "author": "martinvw", "createdAt": "2020-07-09T14:15:38Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshService.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Handles the refreshing of the devices of a OJElectronics session\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public final class RefreshService implements AutoCloseable {\n+\n+    private final OJElectronicsBridgeConfiguration config;\n+    private final Logger logger = LoggerFactory.getLogger(RefreshService.class);\n+    private final HttpClient httpClient;\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\").create();\n+    private final ScheduledExecutorService schedulerService;\n+\n+    private @Nullable Runnable connectionLost;\n+    private @Nullable Consumer<@Nullable GroupContentResponseModel> refreshDone;\n+    private @Nullable ScheduledFuture<?> scheduler;\n+    private @Nullable Runnable unauthorized;\n+    private String sessionId = \"\";\n+    private static boolean destroyed = false;\n+\n+    /**\n+     * Creates a new instance of {@link RefreshService}\n+     *\n+     * @param config Configuration of the bridge\n+     * @param httpClient HTTP client\n+     */\n+    public RefreshService(OJElectronicsBridgeConfiguration config, HttpClient httpClient,\n+            ScheduledExecutorService schedulerService) {\n+        this.config = config;\n+        this.httpClient = httpClient;\n+        this.schedulerService = schedulerService;\n+    }\n+\n+    /**\n+     * Starts refreshing all thing values\n+     *\n+     * @param sessionId Session-Id\n+     * @param refreshDone This method is called if refreshing is done.\n+     * @param connectionLosed This method is called if no connection could established.\n+     * @param unauthorized This method is called if the result is unauthorized.\n+     */\n+    public void start(String sessionId, Consumer<@Nullable GroupContentResponseModel> refreshDone,\n+            Runnable connectionLost, Runnable unauthorized) {\n+        logger.trace(\"RefreshService.startService({})\", sessionId);\n+        this.connectionLost = connectionLost;\n+        this.refreshDone = refreshDone;\n+        this.unauthorized = unauthorized;\n+        this.sessionId = sessionId;\n+        long refreshTime = config.refreshDelayInSeconds;\n+        scheduler = schedulerService.scheduleWithFixedDelay(this::refresh, refreshTime, refreshTime, TimeUnit.SECONDS);\n+        destroyed = false;\n+    }\n+\n+    /**\n+     * Stops refreshing.\n+     */\n+    public void stop() {\n+        destroyed = true;\n+        final ScheduledFuture<?> scheduler = this.scheduler;\n+        if (scheduler != null) {\n+            scheduler.cancel(false);\n+        }\n+        this.scheduler = null;\n+    }\n+\n+    private void refresh() {\n+        if (sessionId.equals(\"\")) {", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIxNzIyMw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453217223", "bodyText": "Done", "author": "EvilPingu", "createdAt": "2020-07-11T17:39:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1MDQ3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1MTMzOA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452251338", "body": "In [E.4 of the coding guidelines](http://docs.openhab.org/developers/development/guidelines.html#e-logging) we listed what kind of logging level should be used when. Error should only be used:\r\n\r\n> `error` logging should only be used to inform the user that something is tremendously wrong in his setup, the system cannot function normally anymore, and there is a need for immediate action. \r\n\r\nPlease change this to use the correct logging levels.", "bodyText": "In E.4 of the coding guidelines we listed what kind of logging level should be used when. Error should only be used:\n\nerror logging should only be used to inform the user that something is tremendously wrong in his setup, the system cannot function normally anymore, and there is a need for immediate action.\n\nPlease change this to use the correct logging levels.", "bodyHTML": "<p dir=\"auto\">In <a href=\"http://docs.openhab.org/developers/development/guidelines.html#e-logging\" rel=\"nofollow\">E.4 of the coding guidelines</a> we listed what kind of logging level should be used when. Error should only be used:</p>\n<blockquote>\n<p dir=\"auto\"><code>error</code> logging should only be used to inform the user that something is tremendously wrong in his setup, the system cannot function normally anymore, and there is a need for immediate action.</p>\n</blockquote>\n<p dir=\"auto\">Please change this to use the correct logging levels.</p>", "author": "martinvw", "createdAt": "2020-07-09T14:16:51Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/services/RefreshService.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal.services;\n+\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+import java.util.function.Consumer;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.jetty.client.HttpClient;\n+import org.eclipse.jetty.client.api.Request;\n+import org.eclipse.jetty.client.api.Result;\n+import org.eclipse.jetty.client.util.BufferingResponseListener;\n+import org.eclipse.jetty.http.HttpMethod;\n+import org.eclipse.jetty.http.HttpStatus;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsBridgeConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.GroupContentResponseModel;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.GsonBuilder;\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * Handles the refreshing of the devices of a OJElectronics session\n+ *\n+ * @author Christian Kittel - Initial Contribution\n+ */\n+@NonNullByDefault\n+public final class RefreshService implements AutoCloseable {\n+\n+    private final OJElectronicsBridgeConfiguration config;\n+    private final Logger logger = LoggerFactory.getLogger(RefreshService.class);\n+    private final HttpClient httpClient;\n+    private final Gson gson = new GsonBuilder().setPrettyPrinting().setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\").create();\n+    private final ScheduledExecutorService schedulerService;\n+\n+    private @Nullable Runnable connectionLost;\n+    private @Nullable Consumer<@Nullable GroupContentResponseModel> refreshDone;\n+    private @Nullable ScheduledFuture<?> scheduler;\n+    private @Nullable Runnable unauthorized;\n+    private String sessionId = \"\";\n+    private static boolean destroyed = false;\n+\n+    /**\n+     * Creates a new instance of {@link RefreshService}\n+     *\n+     * @param config Configuration of the bridge\n+     * @param httpClient HTTP client\n+     */\n+    public RefreshService(OJElectronicsBridgeConfiguration config, HttpClient httpClient,\n+            ScheduledExecutorService schedulerService) {\n+        this.config = config;\n+        this.httpClient = httpClient;\n+        this.schedulerService = schedulerService;\n+    }\n+\n+    /**\n+     * Starts refreshing all thing values\n+     *\n+     * @param sessionId Session-Id\n+     * @param refreshDone This method is called if refreshing is done.\n+     * @param connectionLosed This method is called if no connection could established.\n+     * @param unauthorized This method is called if the result is unauthorized.\n+     */\n+    public void start(String sessionId, Consumer<@Nullable GroupContentResponseModel> refreshDone,\n+            Runnable connectionLost, Runnable unauthorized) {\n+        logger.trace(\"RefreshService.startService({})\", sessionId);\n+        this.connectionLost = connectionLost;\n+        this.refreshDone = refreshDone;\n+        this.unauthorized = unauthorized;\n+        this.sessionId = sessionId;\n+        long refreshTime = config.refreshDelayInSeconds;\n+        scheduler = schedulerService.scheduleWithFixedDelay(this::refresh, refreshTime, refreshTime, TimeUnit.SECONDS);\n+        destroyed = false;\n+    }\n+\n+    /**\n+     * Stops refreshing.\n+     */\n+    public void stop() {\n+        destroyed = true;\n+        final ScheduledFuture<?> scheduler = this.scheduler;\n+        if (scheduler != null) {\n+            scheduler.cancel(false);\n+        }\n+        this.scheduler = null;\n+    }\n+\n+    private void refresh() {\n+        if (sessionId.equals(\"\")) {\n+            handleConnectionLost();\n+            return;\n+        }\n+        final Runnable unauthorized = this.unauthorized;\n+        createRequest().send(new BufferingResponseListener() {\n+            @Override\n+            public void onComplete(@Nullable Result result) {\n+                if (!destroyed) {\n+                    if (result == null || result.isFailed()) {\n+                        handleConnectionLost();\n+                    } else if (result.getResponse().getStatus() == HttpStatus.FORBIDDEN_403) {\n+                        if (unauthorized != null) {\n+                            unauthorized.run();\n+                        }\n+                    } else {\n+                        handleRefreshDone(getContentAsString());\n+                    }\n+                }\n+            }\n+        });\n+    }\n+\n+    private Request createRequest() {\n+        Request request = httpClient.newRequest(config.apiUrl + \"/Group/GroupContents\").param(\"sessionid\", sessionId)\n+                .param(\"APIKEY\", config.apiKey).method(HttpMethod.GET);\n+        return request;\n+    }\n+\n+    private void handleRefreshDone(String responseBody) {\n+        final Consumer<@Nullable GroupContentResponseModel> refreshDone = this.refreshDone;\n+        if (refreshDone != null) {\n+            logger.trace(\"refresh {}\", responseBody);\n+            try {\n+                GroupContentResponseModel content = gson.fromJson(responseBody, GroupContentResponseModel.class);\n+                refreshDone.accept(content);\n+            } catch (JsonSyntaxException exception) {\n+                logger.error(\"Error mapping Result to model\", exception);", "originalCommit": "6353e1d0e1aea865f8abb9f574fb19b7beb8778e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0MDY2Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452440667", "bodyText": "I think the correct way is to remove the logging and disable the thing. Is this correct?", "author": "EvilPingu", "createdAt": "2020-07-09T19:26:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1MTMzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4NTY1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r452485659", "bodyText": "Not really disabling, updating the thing status, calling updateStatus and I would see that this indicates a communication error, you could log the full stack trace to debug, but the most important is reporting to the user that something is wrong and passing the exception.getMessage() to the updateStatus could help for that.", "author": "martinvw", "createdAt": "2020-07-09T20:57:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1MTMzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIxNzI1Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453217257", "bodyText": "Done", "author": "EvilPingu", "createdAt": "2020-07-11T17:39:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI1MTMzOA=="}], "type": "inlineReview"}, {"oid": "98c32544558ac0d087f903fda744f0cdc89a04a2", "url": "https://github.com/openhab/openhab-addons/commit/98c32544558ac0d087f903fda744f0cdc89a04a2", "message": "[ojelectronics] Initial contribution\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-09T18:18:14Z", "type": "commit"}, {"oid": "88eb790e9c3205b9556b9e15b5cf07ef3152f6cb", "url": "https://github.com/openhab/openhab-addons/commit/88eb790e9c3205b9556b9e15b5cf07ef3152f6cb", "message": "remove file; correct README.md; correct some minor issues\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-09T19:14:51Z", "type": "commit"}, {"oid": "96b98dead80842e488b98c2164f726674dda7678", "url": "https://github.com/openhab/openhab-addons/commit/96b98dead80842e488b98c2164f726674dda7678", "message": "remove explicit expose in models\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T07:55:54Z", "type": "commit"}, {"oid": "a6642dc68c9db29d2f00f26967124b89421b9be1", "url": "https://github.com/openhab/openhab-addons/commit/a6642dc68c9db29d2f00f26967124b89421b9be1", "message": "simplify models; change regulation mode\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T13:37:00Z", "type": "commit"}, {"oid": "04d5e8c37b25d049762214106cbc062639f71256", "url": "https://github.com/openhab/openhab-addons/commit/04d5e8c37b25d049762214106cbc062639f71256", "message": "shorten classnames\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T13:49:52Z", "type": "commit"}, {"oid": "6400457a1e14d5a7a9ed5a937be53f61375dfa1f", "url": "https://github.com/openhab/openhab-addons/commit/6400457a1e14d5a7a9ed5a937be53f61375dfa1f", "message": "support multiple devices with same serial\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T15:30:21Z", "type": "commit"}, {"oid": "1b0a765e0325f5c346073b078208532398104629", "url": "https://github.com/openhab/openhab-addons/commit/1b0a765e0325f5c346073b078208532398104629", "message": "better handling for wrong result\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T15:50:51Z", "type": "commit"}, {"oid": "02d14193a234337372a2093a7871edd9ee0ed4b2", "url": "https://github.com/openhab/openhab-addons/commit/02d14193a234337372a2093a7871edd9ee0ed4b2", "message": "better handling for wrong result\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T15:57:51Z", "type": "commit"}, {"oid": "04b6369348011d9fdebcbdb0a957f350c0d94775", "url": "https://github.com/openhab/openhab-addons/commit/04b6369348011d9fdebcbdb0a957f350c0d94775", "message": "change options value; refactor refresh of thermostat\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T18:21:37Z", "type": "commit"}, {"oid": "7040b63cae57c31533d80b24a50b9e10b7c26ba7", "url": "https://github.com/openhab/openhab-addons/commit/7040b63cae57c31533d80b24a50b9e10b7c26ba7", "message": "fixed warnings\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T18:24:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMTk3OA==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453221978", "body": "Declare vars with their interface for the `Collection` types, so this should rather be: \r\n```suggestion\r\n    private static Map<Integer, String> createRegulationMap() {\r\n```", "bodyText": "Declare vars with their interface for the Collection types, so this should rather be:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static HashMap<Integer, String> createRegulationMap() {\n          \n          \n            \n                private static Map<Integer, String> createRegulationMap() {", "bodyHTML": "<p dir=\"auto\">Declare vars with their interface for the <code>Collection</code> types, so this should rather be:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\"><span class=\"x x-first x-last\">HashMap</span>&lt;<span class=\"pl-smi\">Integer</span>, <span class=\"pl-smi\">String</span>&gt;</span> createRegulationMap() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\"><span class=\"x x-first x-last\">Map</span>&lt;<span class=\"pl-smi\">Integer</span>, <span class=\"pl-smi\">String</span>&gt;</span> createRegulationMap() {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "martinvw", "createdAt": "2020-07-11T18:32:30Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "diffHunk": "@@ -0,0 +1,193 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+\n+import javax.measure.quantity.Temperature;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OpenClosedType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsThermostatConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * The {@link ThermostatHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class ThermostatHandler extends BaseThingHandler {\n+\n+    private final String serialNumber;\n+    private @Nullable Thermostat currentThermostat;\n+    private static final Map<Integer, String> REGULATION_MODES = createRegulationMap();\n+    private final Map<String, Consumer<Thermostat>> channelrefreshActions = createChannelRefreshActionMap();\n+\n+    /**\n+     * Creates a new instance of {@link ThermostatHandler}\n+     *\n+     * @param thing Thing\n+     */\n+    public ThermostatHandler(Thing thing) {\n+        super(thing);\n+        serialNumber = getConfigAs(OJElectronicsThermostatConfiguration.class).serialNumber;\n+    }\n+\n+    /**\n+     * Gets the thing's serial number.\n+     *\n+     * @return serial number\n+     */\n+    public String getSerialNumber() {\n+        return serialNumber;\n+    }\n+\n+    /**\n+     * Handles commands to this thing.\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            final Thermostat thermostat = currentThermostat;\n+            if (thermostat != null && channelrefreshActions.containsKey(channelUID.getId())) {\n+                channelrefreshActions.get(channelUID.getId()).accept(thermostat);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Initializes the thing handler.\n+     */\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    /**\n+     * Sets the values after refreshing the thermostats values\n+     *\n+     * @param thermostat thermostat values\n+     */\n+    public void handleThermostatRefresh(Thermostat thermostat) {\n+        currentThermostat = thermostat;\n+        channelrefreshActions.forEach((channelUID, action) -> action.accept(thermostat));\n+    }\n+\n+    private void updateManualSetpoint(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_MANUALSETPOINT,\n+                new QuantityType<Temperature>(thermostat.manualModeSetpoint / (double) 100, SIUnits.CELSIUS));\n+    }\n+\n+    private void updateBoostEndTime(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_BOOSTENDTIME,\n+                new DateTimeType(ZonedDateTime.ofInstant(thermostat.boostEndTime.toInstant(), ZoneId.systemDefault())));\n+    }\n+\n+    private void updateComfortEndTime(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_COMFORTENDTIME, new DateTimeType(\n+                ZonedDateTime.ofInstant(thermostat.comfortEndTime.toInstant(), ZoneId.systemDefault())));\n+    }\n+\n+    private void updateComfortSetpoint(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_COMFORTSETPOINT,\n+                new QuantityType<Temperature>(thermostat.comfortSetpoint / (double) 100, SIUnits.CELSIUS));\n+    }\n+\n+    private void updateRegulationMode(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_REGULATIONMODE,\n+                StringType.valueOf(getRegulationMode(thermostat.regulationMode)));\n+    }\n+\n+    private void updateThermostatName(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_THERMOSTATNAME, StringType.valueOf(thermostat.thermostatName));\n+    }\n+\n+    private void updateFloorTemperature(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_FLOORTEMPERATURE,\n+                new QuantityType<Temperature>(thermostat.floorTemperature / (double) 100, SIUnits.CELSIUS));\n+    }\n+\n+    private void updateRoomTemperature(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_ROOMTEMPERATURE,\n+                new QuantityType<Temperature>(thermostat.roomTemperature / (double) 100, SIUnits.CELSIUS));\n+    }\n+\n+    private void updateHeating(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_HEATING,\n+                thermostat.heating ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+    }\n+\n+    private void updateOnline(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_ONLINE,\n+                thermostat.online ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+    }\n+\n+    private void updateGroupId(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_GROUPID, new DecimalType(thermostat.groupId));\n+    }\n+\n+    private void updateGroupName(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_GROUPNAME, StringType.valueOf(thermostat.groupName));\n+    }\n+\n+    private String getRegulationMode(int regulationMode) {\n+        return REGULATION_MODES.get(regulationMode);\n+    }\n+\n+    private static HashMap<Integer, String> createRegulationMap() {", "originalCommit": "7040b63cae57c31533d80b24a50b9e10b7c26ba7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMjAzNg==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453222036", "body": "Please use the diamond operator, ie replace the second occurrence of the same generic by `<>`\r\n\r\n```suggestion\r\n        Map<Integer, String> map = new HashMap<>();\r\n```", "bodyText": "Please use the diamond operator, ie replace the second occurrence of the same generic by <>\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    HashMap<Integer, String> map = new HashMap<Integer, String>();\n          \n          \n            \n                    Map<Integer, String> map = new HashMap<>();", "bodyHTML": "<p dir=\"auto\">Please use the diamond operator, ie replace the second occurrence of the same generic by <code>&lt;&gt;</code></p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\"><span class=\"x x-first x-last\">HashMap</span>&lt;<span class=\"pl-smi\">Integer</span>, <span class=\"pl-smi\">String</span>&gt;</span> map <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-k\">HashMap&lt;<span class=\"pl-smi x x-first\">Integer</span><span class=\"x\">, </span><span class=\"pl-smi x x-last\">String</span>&gt;</span>();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\"><span class=\"x x-first x-last\">Map</span>&lt;<span class=\"pl-smi\">Integer</span>, <span class=\"pl-smi\">String</span>&gt;</span> map <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-k\">HashMap&lt;&gt;</span>();</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "martinvw", "createdAt": "2020-07-11T18:32:59Z", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "diffHunk": "@@ -0,0 +1,193 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.ojelectronics.internal;\n+\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+\n+import javax.measure.quantity.Temperature;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.DateTimeType;\n+import org.eclipse.smarthome.core.library.types.DecimalType;\n+import org.eclipse.smarthome.core.library.types.OpenClosedType;\n+import org.eclipse.smarthome.core.library.types.QuantityType;\n+import org.eclipse.smarthome.core.library.types.StringType;\n+import org.eclipse.smarthome.core.library.unit.SIUnits;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.openhab.binding.ojelectronics.internal.config.OJElectronicsThermostatConfiguration;\n+import org.openhab.binding.ojelectronics.internal.models.groups.Thermostat;\n+\n+/**\n+ * The {@link ThermostatHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author Christian Kittel - Initial contribution\n+ */\n+@NonNullByDefault\n+public class ThermostatHandler extends BaseThingHandler {\n+\n+    private final String serialNumber;\n+    private @Nullable Thermostat currentThermostat;\n+    private static final Map<Integer, String> REGULATION_MODES = createRegulationMap();\n+    private final Map<String, Consumer<Thermostat>> channelrefreshActions = createChannelRefreshActionMap();\n+\n+    /**\n+     * Creates a new instance of {@link ThermostatHandler}\n+     *\n+     * @param thing Thing\n+     */\n+    public ThermostatHandler(Thing thing) {\n+        super(thing);\n+        serialNumber = getConfigAs(OJElectronicsThermostatConfiguration.class).serialNumber;\n+    }\n+\n+    /**\n+     * Gets the thing's serial number.\n+     *\n+     * @return serial number\n+     */\n+    public String getSerialNumber() {\n+        return serialNumber;\n+    }\n+\n+    /**\n+     * Handles commands to this thing.\n+     */\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        if (command instanceof RefreshType) {\n+            final Thermostat thermostat = currentThermostat;\n+            if (thermostat != null && channelrefreshActions.containsKey(channelUID.getId())) {\n+                channelrefreshActions.get(channelUID.getId()).accept(thermostat);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Initializes the thing handler.\n+     */\n+    @Override\n+    public void initialize() {\n+        updateStatus(ThingStatus.ONLINE);\n+    }\n+\n+    /**\n+     * Sets the values after refreshing the thermostats values\n+     *\n+     * @param thermostat thermostat values\n+     */\n+    public void handleThermostatRefresh(Thermostat thermostat) {\n+        currentThermostat = thermostat;\n+        channelrefreshActions.forEach((channelUID, action) -> action.accept(thermostat));\n+    }\n+\n+    private void updateManualSetpoint(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_MANUALSETPOINT,\n+                new QuantityType<Temperature>(thermostat.manualModeSetpoint / (double) 100, SIUnits.CELSIUS));\n+    }\n+\n+    private void updateBoostEndTime(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_BOOSTENDTIME,\n+                new DateTimeType(ZonedDateTime.ofInstant(thermostat.boostEndTime.toInstant(), ZoneId.systemDefault())));\n+    }\n+\n+    private void updateComfortEndTime(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_COMFORTENDTIME, new DateTimeType(\n+                ZonedDateTime.ofInstant(thermostat.comfortEndTime.toInstant(), ZoneId.systemDefault())));\n+    }\n+\n+    private void updateComfortSetpoint(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_COMFORTSETPOINT,\n+                new QuantityType<Temperature>(thermostat.comfortSetpoint / (double) 100, SIUnits.CELSIUS));\n+    }\n+\n+    private void updateRegulationMode(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_REGULATIONMODE,\n+                StringType.valueOf(getRegulationMode(thermostat.regulationMode)));\n+    }\n+\n+    private void updateThermostatName(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_THERMOSTATNAME, StringType.valueOf(thermostat.thermostatName));\n+    }\n+\n+    private void updateFloorTemperature(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_FLOORTEMPERATURE,\n+                new QuantityType<Temperature>(thermostat.floorTemperature / (double) 100, SIUnits.CELSIUS));\n+    }\n+\n+    private void updateRoomTemperature(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_ROOMTEMPERATURE,\n+                new QuantityType<Temperature>(thermostat.roomTemperature / (double) 100, SIUnits.CELSIUS));\n+    }\n+\n+    private void updateHeating(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_HEATING,\n+                thermostat.heating ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+    }\n+\n+    private void updateOnline(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_ONLINE,\n+                thermostat.online ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+    }\n+\n+    private void updateGroupId(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_GROUPID, new DecimalType(thermostat.groupId));\n+    }\n+\n+    private void updateGroupName(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_GROUPNAME, StringType.valueOf(thermostat.groupName));\n+    }\n+\n+    private String getRegulationMode(int regulationMode) {\n+        return REGULATION_MODES.get(regulationMode);\n+    }\n+\n+    private static HashMap<Integer, String> createRegulationMap() {\n+        HashMap<Integer, String> map = new HashMap<Integer, String>();", "originalCommit": "7040b63cae57c31533d80b24a50b9e10b7c26ba7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyNTQyNw==", "url": "https://github.com/openhab/openhab-addons/pull/7138#discussion_r453225427", "bodyText": "Done.", "author": "EvilPingu", "createdAt": "2020-07-11T19:13:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIyMjAzNg=="}], "type": "inlineReview"}, {"oid": "8f2fb17f34bcb9628ce6e7b72bac66adb6c37823", "url": "https://github.com/openhab/openhab-addons/commit/8f2fb17f34bcb9628ce6e7b72bac66adb6c37823", "message": "documentation completed; fixed some issues\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>", "committedDate": "2020-07-11T19:48:50Z", "type": "commit"}]}