{"pr_number": 4088, "pr_title": "NXP-28950: compute bundle and component deployment order in explorer", "pr_author": "atchertchian", "pr_createdAt": "2020-05-28T10:35:58Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4088", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MTQ0Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431741443", "body": "```suggestion\r\n        checkDeploymentOrder(!legacy);\r\n```\r\n(same elsewhere)", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    checkDeploymentOrder(legacy ? false : true);\n          \n          \n            \n                    checkDeploymentOrder(!legacy);\n          \n      \n    \n    \n  \n\n(same elsewhere)", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        checkDeploymentOrder(legacy<span class=\"x x-first\"> </span><span class=\"pl-k x\">?</span><span class=\"x\"> </span><span class=\"pl-c1 x\">false</span><span class=\"x\"> </span><span class=\"pl-k x\">:</span><span class=\"x\"> </span><span class=\"pl-c1 x x-last\">true</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        checkDeploymentOrder(<span class=\"pl-k x x-first x-last\">!</span>legacy);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">(same elsewhere)</p>", "author": "efge", "createdAt": "2020-05-28T10:38:26Z", "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/pages/artifacts/BundleArtifactPage.java", "diffHunk": "@@ -60,16 +67,18 @@ public void checkReference(boolean partial, boolean legacy) {\n         checkGroupId(\"org.nuxeo.ecm.platform\");\n         checkArtifactId(\"nuxeo-apidoc-core\");\n         checkRequirements(null);\n+        checkDeploymentOrder(legacy ? false : true);", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MjQ3NQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431742475", "body": "```suggestion\r\n        assertEquals(!set, orderIsBlank);\r\n```\r\n(same elsewhere)", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (set) {\n          \n          \n            \n                        assertFalse(orderIsBlank);\n          \n          \n            \n                    } else {\n          \n          \n            \n                        assertTrue(orderIsBlank);\n          \n          \n            \n                    }\n          \n          \n            \n                    assertEquals(!set, orderIsBlank);\n          \n      \n    \n    \n  \n\n(same elsewhere)", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (set) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            assertFalse(orderIsBlank);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        } <span class=\"pl-k\">else</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            assertTrue(orderIsBlank);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        assertEquals(<span class=\"pl-k\">!</span>set, orderIsBlank);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">(same elsewhere)</p>", "author": "efge", "createdAt": "2020-05-28T10:40:32Z", "path": "ftests/nuxeo-platform-explorer-ftests/src/test/java/org/nuxeo/functionaltests/explorer/pages/artifacts/BundleArtifactPage.java", "diffHunk": "@@ -90,4 +99,13 @@ public void checkArtifactId(String id) {\n         assertEquals(id, artifactId.getText());\n     }\n \n+    public void checkDeploymentOrder(boolean set) {\n+        boolean orderIsBlank = StringUtils.isBlank(deploymentOrder.getText());\n+        if (set) {\n+            assertFalse(orderIsBlank);\n+        } else {\n+            assertTrue(orderIsBlank);\n+        }", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MzMwNg==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431743306", "body": "Keep newline at end of file", "bodyText": "Keep newline at end of file", "bodyHTML": "<p dir=\"auto\">Keep newline at end of file</p>", "author": "efge", "createdAt": "2020-05-28T10:42:15Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/api/ComponentInfo.java", "diffHunk": "@@ -89,4 +96,16 @@\n      */\n     List<String> getRequirements();\n \n-}\n+    /**\n+     * Returns the registration order as indicated by {@link ComponentManager}.\n+     *\n+     * @since 11.1\n+     */\n+    Long getRegistrationOrder();\n+\n+    /**\n+     * @since 11.1\n+     */\n+    void setRegistrationOrder(Long order);\n+\n+}", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MzY2OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431743669", "body": "Setter could use a `@since 11.1` too for consistency.", "bodyText": "Setter could use a @since 11.1 too for consistency.", "bodyHTML": "<p dir=\"auto\">Setter could use a <code>@since 11.1</code> too for consistency.</p>", "author": "efge", "createdAt": "2020-05-28T10:42:57Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/api/BundleInfo.java", "diffHunk": "@@ -91,4 +96,13 @@\n      */\n     Blob getParentReadme();\n \n+    /**\n+     * Returns the deployment order as indicated by the runtime context.\n+     *\n+     * @since 11.1\n+     */\n+    Long getDeploymentOrder();\n+\n+    void setDeploymentOrder(Long order);", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc5Njc2Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431796763", "bodyText": "indeed!", "author": "atchertchian", "createdAt": "2020-05-28T12:27:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0MzY2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDE2Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431744163", "body": "Could be written this way to minimize space taken, especially on a `protected` member\r\n```suggestion\r\n    /** @since 11.1 */\r\n```", "bodyText": "Could be written this way to minimize space taken, especially on a protected member\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /**\n          \n          \n            \n                 * @since 11.1\n          \n          \n            \n                 */\n          \n          \n            \n                /** @since 11.1 */", "bodyHTML": "<p dir=\"auto\">Could be written this way to minimize space taken, especially on a <code>protected</code> member</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-c\"><span class=\"pl-c\">/**</span></span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@since</span> <span class=\"pl-c1\">11.1</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*/</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-c\"><span class=\"pl-c\">/*</span>* @since 11.1 <span class=\"pl-c\">*/</span></span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "efge", "createdAt": "2020-05-28T10:43:59Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/introspection/BundleInfoImpl.java", "diffHunk": "@@ -42,6 +42,9 @@\n \n     protected String manifest;\n \n+    /**\n+     * @since 11.1\n+     */", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc5NzY0OQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431797649", "bodyText": "\ud83d\udc4d i'll probably do that kind of cleanup on others independently, then", "author": "atchertchian", "createdAt": "2020-05-28T12:29:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDE2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431744817", "body": "If you make `registrationOrder` a `long` then autoboxing will allow you to get rid of the `Long.valueOf` (another instance below for `bindex`/`setDeploymentOrder`)", "bodyText": "If you make registrationOrder a long then autoboxing will allow you to get rid of the Long.valueOf (another instance below for bindex/setDeploymentOrder)", "bodyHTML": "<p dir=\"auto\">If you make <code>registrationOrder</code> a <code>long</code> then autoboxing will allow you to get rid of the <code>Long.valueOf</code> (another instance below for <code>bindex</code>/<code>setDeploymentOrder</code>)</p>", "author": "efge", "createdAt": "2020-05-28T10:45:11Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-core/src/main/java/org/nuxeo/apidoc/introspection/ServerInfo.java", "diffHunk": "@@ -352,6 +355,8 @@ public static ServerInfo build(String name, String version) {\n             }\n \n             ComponentInfoImpl component = new ComponentInfoImpl(binfo, cname);\n+            component.setRegistrationOrder(Long.valueOf(registrationOrder++));", "originalCommit": "8c1d61134fa2748c1a5f3c46ac604dfdf48cf7c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgwMDA0NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431800044", "bodyText": "But what if i needed to be able to keep it null (unset), for legacy persisted distribs, typically?", "author": "atchertchian", "createdAt": "2020-05-28T12:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgxMzAwOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431813008", "bodyText": "Well Long.valueOf(registrationOrder++) is never null, so you might as well take advantage of autoboxing here.", "author": "efge", "createdAt": "2020-05-28T12:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgxNjk3Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431816976", "bodyText": "This is on the live distrib (and the same interface is shared with persisted ones)", "author": "atchertchian", "createdAt": "2020-05-28T13:02:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgxNzEyMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431817123", "bodyText": "(for now...)", "author": "atchertchian", "createdAt": "2020-05-28T13:02:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgxOTE1NA==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431819154", "bodyText": "I don't get your point.\nMy point is that this:\nint foo = 1;\ncomponent.setRegistrationOrder(Long.valueOf(foo++));\n\nis identical too:\nlong foo = 1;\ncomponent.setRegistrationOrder(foo++);", "author": "efge", "createdAt": "2020-05-28T13:05:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTgyNzc5Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4088#discussion_r431827793", "bodyText": "Ah! sorry got confused, will do (i thought you were talking about changing from \"Long\" to \"long\" in the API, nevermind)", "author": "atchertchian", "createdAt": "2020-05-28T13:19:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc0NDgxNw=="}], "type": "inlineReview"}, {"oid": "30aa992e933eb514b20799e1412354d7997ae859", "url": "https://github.com/nuxeo/nuxeo/commit/30aa992e933eb514b20799e1412354d7997ae859", "message": "NXP-28950: compute bundle and component deployment order in explorer", "committedDate": "2020-05-28T12:43:48Z", "type": "forcePushed"}, {"oid": "56d811fd811ec51ba7df53f5d090d1217fcadcab", "url": "https://github.com/nuxeo/nuxeo/commit/56d811fd811ec51ba7df53f5d090d1217fcadcab", "message": "NXP-28950: compute bundle and component deployment order in explorer", "committedDate": "2020-05-28T13:37:21Z", "type": "commit"}, {"oid": "56d811fd811ec51ba7df53f5d090d1217fcadcab", "url": "https://github.com/nuxeo/nuxeo/commit/56d811fd811ec51ba7df53f5d090d1217fcadcab", "message": "NXP-28950: compute bundle and component deployment order in explorer", "committedDate": "2020-05-28T13:37:21Z", "type": "forcePushed"}]}