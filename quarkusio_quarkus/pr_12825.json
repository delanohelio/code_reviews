{"pr_number": 12825, "pr_title": "Upgrade MySQL Connector to 8.0.22", "pr_author": "gsmet", "pr_createdAt": "2020-10-20T12:12:15Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12825", "timeline": [{"oid": "025d7f771674c8a7b4e7fa5112f0edaf4c13a81e", "url": "https://github.com/quarkusio/quarkus/commit/025d7f771674c8a7b4e7fa5112f0edaf4c13a81e", "message": "Upgrade MySQL Connector to 8.0.22\n\nAsyncSocketFactory is gone entirely.\nI haven't upgraded MySQL itself as it seems Docker images are not\navailable yet or it hasn't been released yet.", "committedDate": "2020-10-20T12:11:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg==", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508574832", "body": "```suggestion\r\n    @BuildStep(onlyIfNot = NativeBuild.class)\r\n```\r\nwould make it clearer.", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @BuildStep\n          \n          \n            \n                @BuildStep(onlyIfNot = NativeBuild.class)\n          \n      \n    \n    \n  \n\nwould make it clearer.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">@BuildStep</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">@BuildStep</span><span class=\"x x-first\">(</span><span class=\"pl-c1 x\">onlyIfNot</span><span class=\"x\"> </span><span class=\"pl-k x\">=</span><span class=\"x\"> </span><span class=\"pl-smi x\">NativeBuild</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">class)</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">would make it clearer.</p>", "author": "gsmet", "createdAt": "2020-10-20T14:48:40Z", "path": "extensions/jdbc/jdbc-mysql/deployment/src/main/java/io/quarkus/jdbc/mysql/deployment/JDBCMySQLProcessor.java", "diffHunk": "@@ -86,6 +78,16 @@ NativeImageEnableAllTimeZonesBuildItem enableAllTimeZones() {\n         return new NativeImageEnableAllTimeZonesBuildItem();\n     }\n \n+    @BuildStep\n+    NativeImageSystemPropertyBuildItem disableAbandonedConnectionCleanUpInNativeMode() {\n+        return new NativeImageSystemPropertyBuildItem(\"com.mysql.cj.disableAbandonedConnectionCleanup\", \"true\");\n+    }\n+\n+    @BuildStep", "originalCommit": "62ee0faaf5105ab6a7e993c8be29bee2e49ee8fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NzA1Mg==", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508577052", "bodyText": "I was wondering about that.. woudldn't it be enough to just have this single buildStep?", "author": "Sanne", "createdAt": "2020-10-20T14:51:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4MTAzMQ==", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508581031", "bodyText": "I was wondering about that.. woudldn't it be enough to just have this single buildStep?\n\nWould SystemPropertyBuildItem be consumed and produce the NativeImageSystemPropertyBuildItem? My first time producing either of them so I might be missing something.", "author": "machi1990", "createdAt": "2020-10-20T14:55:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU4MzM5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508583391", "bodyText": "I don't know :) @gsmet ?", "author": "Sanne", "createdAt": "2020-10-20T14:58:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU5NDYwNg==", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508594606", "bodyText": "I think it's OK the way it is now.", "author": "gsmet", "createdAt": "2020-10-20T15:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU5ODExNg==", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508598116", "bodyText": "I was wondering about that.. woudldn't it be enough to just have this single buildStep?\n\n\nTested it and it works by only producing the SystemPropertyBuildItem. But to get an answer to my question below ...\n\nWould SystemPropertyBuildItem be consumed and produce the NativeImageSystemPropertyBuildItem? My first time producing either of them so I might be missing something.\n\nWith only the SystemPropertyBuildItem the command to generate native image is:\nnative-image -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-DCoordinatorEnvironmentBean.transactionStatusManagerEnable=false -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=1 -J-Duser.language=en -J-Dfile.encoding=UTF-8 --initialize-at-build-time= -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy\\$BySpaceAndTime -H:+JNI -jar quarkus-integration-test-jpa-mysql-999-SNAPSHOT-runner.jar -H:FallbackThreshold=0 -H:+ReportExceptionStackTraces -H:+AddAllCharsets -H:EnableURLProtocols=http,https --enable-all-security-services -H:NativeLinkerOption=-no-pie --no-server -H:-UseServiceLoaderFeature -H:+StackTrace quarkus-integration-test-jpa-mysql-999-SNAPSHOT-runner\nWith the NativeImageSystemPropertyBuildItem the command become:\nnative-image -J-Dsun.nio.ch.maxUpdateArraySize=100 -J-Djava.util.logging.manager=org.jboss.logmanager.LogManager -J-Dcom.mysql.cj.disableAbandonedConnectionCleanup=true -J-DCoordinatorEnvironmentBean.transactionStatusManagerEnable=false -J-Dvertx.logger-delegate-factory-class-name=io.quarkus.vertx.core.runtime.VertxLogDelegateFactory -J-Dvertx.disableDnsResolver=true -J-Dio.netty.leakDetection.level=DISABLED -J-Dio.netty.allocator.maxOrder=1 -J-Duser.language=en -J-Dfile.encoding=UTF-8 --initialize-at-build-time= -H:InitialCollectionPolicy=com.oracle.svm.core.genscavenge.CollectionPolicy\\$BySpaceAndTime -H:+JNI -jar quarkus-integration-test-jpa-mysql-999-SNAPSHOT-runner.jar -H:FallbackThreshold=0 -H:+ReportExceptionStackTraces -H:+AddAllCharsets -H:EnableURLProtocols=http,https --enable-all-security-services -H:NativeLinkerOption=-no-pie --no-server -H:-UseServiceLoaderFeature -H:+StackTrace quarkus-integration-test-jpa-mysql-999-SNAPSHOT-runner\nNotice the -J-Dcom.mysql.cj.disableAbandonedConnectionCleanup=true in the second command which is missing from the first.\nI think for the sake of being explicit in the generated command, I'd stick with producing the two build items.", "author": "machi1990", "createdAt": "2020-10-20T15:17:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYwMTY2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/12825#discussion_r508601669", "bodyText": "Sure. But thanks for testing it! Good to know.", "author": "Sanne", "createdAt": "2020-10-20T15:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU3NDgzMg=="}], "type": "inlineReview"}, {"oid": "2e21466b602f6689c483b7b54561ddd62b1ccfae", "url": "https://github.com/quarkusio/quarkus/commit/2e21466b602f6689c483b7b54561ddd62b1ccfae", "message": "feat(mysql): disable abandoned connection cleanup thread as this is handled by Agroal\n\nFollows up https://github.com/quarkusio/quarkus/pull/12825#pullrequestreview-512665087", "committedDate": "2020-10-20T14:52:58Z", "type": "commit"}, {"oid": "2e21466b602f6689c483b7b54561ddd62b1ccfae", "url": "https://github.com/quarkusio/quarkus/commit/2e21466b602f6689c483b7b54561ddd62b1ccfae", "message": "feat(mysql): disable abandoned connection cleanup thread as this is handled by Agroal\n\nFollows up https://github.com/quarkusio/quarkus/pull/12825#pullrequestreview-512665087", "committedDate": "2020-10-20T14:52:58Z", "type": "forcePushed"}]}