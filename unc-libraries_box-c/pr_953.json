{"pr_number": 953, "pr_title": "Add message to confirm that user wants to update MODS record without adding a title", "pr_createdAt": "2020-04-03T15:13:27Z", "pr_url": "https://github.com/UNC-Libraries/box-c/pull/953", "merge_commit": "11df450b6521adeeeae083aa058d0ef74beada33", "timeline": [{"oid": "43e4bf5f698bccb6436ecf09b3d39c0af11fd72c", "url": "https://github.com/UNC-Libraries/box-c/commit/43e4bf5f698bccb6436ecf09b3d39c0af11fd72c", "message": "Add message to confirm that user want to update MODS record without setting a title.", "committedDate": "2020-04-03T15:11:05Z", "type": "commit"}, {"oid": "341bda97cc4a8c74ff567420f05426b23b10e388", "url": "https://github.com/UNC-Libraries/box-c/commit/341bda97cc4a8c74ff567420f05426b23b10e388", "message": "* Don't set title to an empty string\n* Refactor getAlternativeTitle. Variable \"title\" was always null", "committedDate": "2020-04-08T15:59:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ4OTMzMQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/953#discussion_r407489331", "body": "Should we do empty checks before returning these values? `StringUtils.isBlank` catches null, blank, or all whitespace. If the title is present but empty, we'd want to fall back to the other options", "bodyText": "Should we do empty checks before returning these values? StringUtils.isBlank catches null, blank, or all whitespace. If the title is present but empty, we'd want to fall back to the other options", "bodyHTML": "<p dir=\"auto\">Should we do empty checks before returning these values? <code>StringUtils.isBlank</code> catches null, blank, or all whitespace. If the title is present but empty, we'd want to fall back to the other options</p>", "author": "bbpennel", "createdAt": "2020-04-13T13:53:53Z", "path": "solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java", "diffHunk": "@@ -97,23 +97,18 @@ public void filter(DocumentIndexingPackage dip) throws IndexingException {\n     }\n \n     private String getAlternativeTitle(DocumentIndexingPackage dip) throws FedoraException, IndexingException {\n-        String title = null;\n         Resource resc = dip.getContentObject().getResource();\n \n         // Use dc:title as a default\n         if (resc.hasProperty(DcElements.title)) {\n             Statement dcTitle = resc.getProperty(DcElements.title);\n             return dcTitle.getString();\n-        }\n-\n-        // fall back to filename if one is present\n-        if (title == null && resc.hasProperty(Ebucore.filename)) {\n+        } else if (resc.hasProperty(Ebucore.filename)) { // fall back to filename if one is present", "originalCommit": "341bda97cc4a8c74ff567420f05426b23b10e388", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5b8444b823839786f9f0b8b1d83a3a7499a6c713", "changed_code": [{"header": "diff --git a/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java b/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\nindex 658143847..0f1552cf8 100644\n--- a/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\n+++ b/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\n", "chunk": "@@ -98,19 +101,27 @@ public class SetDescriptiveMetadataFilter implements IndexDocumentFilter {\n \n     private String getAlternativeTitle(DocumentIndexingPackage dip) throws FedoraException, IndexingException {\n         Resource resc = dip.getContentObject().getResource();\n+        String dcTitle = titleText(resc, DcElements.title);\n+        String ebucoreTitle = titleText(resc, Ebucore.filename);\n \n         // Use dc:title as a default\n-        if (resc.hasProperty(DcElements.title)) {\n-            Statement dcTitle = resc.getProperty(DcElements.title);\n-            return dcTitle.getString();\n-        } else if (resc.hasProperty(Ebucore.filename)) { // fall back to filename if one is present\n-            Statement filename = resc.getProperty(Ebucore.filename);\n-            return filename.getString();\n+        if (!isBlank(dcTitle)) {\n+            return dcTitle;\n+        } else if (!isBlank(ebucoreTitle)) { // fall back to filename if one is present\n+            return ebucoreTitle;\n         } else { // Use the object's id as the title as a final option\n             return dip.getPid().getId();\n         }\n     }\n \n+    private String titleText(Resource resc, Property field) {\n+        if (resc.hasProperty(field)) {\n+            return resc.getProperty(field).getString();\n+        }\n+\n+        return \"\";\n+    }\n+\n     private void extractTitles(Element mods, IndexDocumentBean idb) {\n         List<?> titles = mods.getChildren(\"titleInfo\", JDOMNamespaceUtil.MODS_V3_NS);\n         String mainTitle = null;\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5MTA1Mw==", "url": "https://github.com/UNC-Libraries/box-c/pull/953#discussion_r407491053", "body": "you can use StringUtils.isBlank in place of these two checks (the apache commons lang3 version)", "bodyText": "you can use StringUtils.isBlank in place of these two checks (the apache commons lang3 version)", "bodyHTML": "<p dir=\"auto\">you can use StringUtils.isBlank in place of these two checks (the apache commons lang3 version)</p>", "author": "bbpennel", "createdAt": "2020-04-13T13:57:22Z", "path": "solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java", "diffHunk": "@@ -131,7 +126,11 @@ private void extractTitles(Element mods, IndexDocumentBean idb) {\n                 }\n             }\n         }\n-        idb.setTitle(mainTitle);\n+\n+        if (mainTitle != null && !mainTitle.equals(\"\")) {", "originalCommit": "341bda97cc4a8c74ff567420f05426b23b10e388", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5b8444b823839786f9f0b8b1d83a3a7499a6c713", "changed_code": [{"header": "diff --git a/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java b/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\nindex 658143847..0f1552cf8 100644\n--- a/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\n+++ b/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\n", "chunk": "@@ -127,7 +138,7 @@ public class SetDescriptiveMetadataFilter implements IndexDocumentFilter {\n             }\n         }\n \n-        if (mainTitle != null && !mainTitle.equals(\"\")) {\n+        if (!isBlank(mainTitle)) {\n             idb.setTitle(mainTitle);\n         }\n \n", "next_change": null}]}, "revised_code_in_main": {"commit": "11df450b6521adeeeae083aa058d0ef74beada33", "changed_code": [{"header": "diff --git a/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java b/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\nindex 658143847..7f0931d9a 100644\n--- a/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\n+++ b/solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java\n", "chunk": "@@ -127,7 +139,7 @@ public class SetDescriptiveMetadataFilter implements IndexDocumentFilter {\n             }\n         }\n \n-        if (mainTitle != null && !mainTitle.equals(\"\")) {\n+        if (!isBlank(mainTitle)) {\n             idb.setTitle(mainTitle);\n         }\n \n", "next_change": null}]}, "commits_in_main": [{"oid": "11df450b6521adeeeae083aa058d0ef74beada33", "message": "Merge commit", "committedDate": null}, {"oid": "3cc79855f71e7df8d7767fb762b355c03ea331d2", "committedDate": "2020-12-16 10:23:52 -0500", "message": "Make sure that display label exists before checking its value for finding aid links"}, {"oid": "91d9cc49664bf3f9669ebd0553d10efdea40f089", "committedDate": "2021-02-16 10:31:07 -0500", "message": "Update jdom usage to reflect changes in jdom2, remove DC references"}, {"oid": "93bf05fb587cf8459c5ef4ba8350b8c736f0ea71", "committedDate": "2021-02-22 13:39:13 -0500", "message": "Remove indexing of finding aid field"}, {"oid": "c60a2b2c6e451ab9ca96b80d8abd458465351036", "committedDate": "2021-03-18 12:04:09 -0400", "message": "Add multiple images with metadata (#1216)"}, {"oid": "f356b6d2985d018b8ff08b64f4d93d87b7aff82e", "committedDate": "2021-04-01 09:14:41 -0400", "message": "Update server side add container workflow to allow for optional collection number field to be set, only for collections. Switch to passing ResourceType enums instead of Resource representations"}, {"oid": "0c980788be444c9b9239d03bb7e68e8d6f92add3", "committedDate": "2021-07-06 14:02:28 -0400", "message": "BXC-3188 - Reorganize modules to create model (#1271)"}, {"oid": "5ac2f7f656ff72aa85becedbf158eba2a648d076", "committedDate": "2021-08-02 10:17:30 -0400", "message": "BXC-3190 - Reorganize persistence module (#1278)"}, {"oid": "38e61fb772cc0699e071f06e4b2b6e8d3f485320", "committedDate": "2021-08-13 11:28:09 -0400", "message": "BXC-3191 - Refactor/reorganize solr modules (#1283)"}]}, {"oid": "5b8444b823839786f9f0b8b1d83a3a7499a6c713", "url": "https://github.com/UNC-Libraries/box-c/commit/5b8444b823839786f9f0b8b1d83a3a7499a6c713", "message": "Remove editor note and add blank check.", "committedDate": "2020-04-13T19:25:34Z", "type": "commit"}, {"oid": "9ccc521477ffd6ac54d912ebd0b713d0e5d4038d", "url": "https://github.com/UNC-Libraries/box-c/commit/9ccc521477ffd6ac54d912ebd0b713d0e5d4038d", "message": "Remove unused import", "committedDate": "2020-04-13T19:31:26Z", "type": "commit"}, {"oid": "a22a684fd954ac7b18983ec0c14aa5489e1b2407", "url": "https://github.com/UNC-Libraries/box-c/commit/a22a684fd954ac7b18983ec0c14aa5489e1b2407", "message": "Add tests for altTitle", "committedDate": "2020-04-13T20:09:34Z", "type": "commit"}]}