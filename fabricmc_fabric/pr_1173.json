{"pr_number": 1173, "pr_title": "Add tag builder method for the new optional entries", "pr_author": "williewillus", "pr_createdAt": "2020-11-20T03:22:13Z", "pr_url": "https://github.com/FabricMC/fabric/pull/1173", "timeline": [{"oid": "02a8b147afe5d65573a181dbbf86fe6c04c32e2e", "url": "https://github.com/FabricMC/fabric/commit/02a8b147afe5d65573a181dbbf86fe6c04c32e2e", "message": "Add tag builder method for the new optional entries", "committedDate": "2020-11-20T03:21:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2OTA0Ng==", "url": "https://github.com/FabricMC/fabric/pull/1173#discussion_r527369046", "body": "nb: this string is only for debug logging to show who added the entry, so I just chose the module name. Not worth adding a parameter for and burdening callers", "bodyText": "nb: this string is only for debug logging to show who added the entry, so I just chose the module name. Not worth adding a parameter for and burdening callers", "bodyHTML": "<p dir=\"auto\">nb: this string is only for debug logging to show who added the entry, so I just chose the module name. Not worth adding a parameter for and burdening callers</p>", "author": "williewillus", "createdAt": "2020-11-20T03:22:41Z", "path": "fabric-tag-extensions-v0/src/main/java/net/fabricmc/fabric/mixin/tag/extension/MixinTagBuilder.java", "diffHunk": "@@ -57,4 +60,14 @@ public void clearTagEntries() {\n \t\tentries.clear();\n \t\tfabric_clearCount++;\n \t}\n+\n+\t@Override\n+\tpublic void addOptional(Identifier id) {\n+\t\tadd(new Tag.OptionalObjectEntry(id), \"fabric-tag-extensions\");\n+\t}\n+\n+\t@Override\n+\tpublic void addOptionalTag(Identifier id) {\n+\t\tadd(new Tag.OptionalTagEntry(id), \"fabric-tag-extensions\");", "originalCommit": "02a8b147afe5d65573a181dbbf86fe6c04c32e2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2OTI5OA==", "url": "https://github.com/FabricMC/fabric/pull/1173#discussion_r527369298", "body": "Source should match the fabric api module name completely.\r\n\r\n```suggestion\r\n\t\tadd(new Tag.OptionalObjectEntry(id), \"fabric-tag-extensions-v0\");\r\n```", "bodyText": "Source should match the fabric api module name completely.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tadd(new Tag.OptionalObjectEntry(id), \"fabric-tag-extensions\");\n          \n          \n            \n            \t\tadd(new Tag.OptionalObjectEntry(id), \"fabric-tag-extensions-v0\");", "bodyHTML": "<p dir=\"auto\">Source should match the fabric api module name completely.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\tadd(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">Tag</span>.<span class=\"pl-smi\">OptionalObjectEntry</span>(id), <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>fabric-tag-extensions<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\tadd(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">Tag</span>.<span class=\"pl-smi\">OptionalObjectEntry</span>(id), <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>fabric-tag-extensions<span class=\"x x-first x-last\">-v0</span><span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "i509VCB", "createdAt": "2020-11-20T03:23:46Z", "path": "fabric-tag-extensions-v0/src/main/java/net/fabricmc/fabric/mixin/tag/extension/MixinTagBuilder.java", "diffHunk": "@@ -57,4 +60,14 @@ public void clearTagEntries() {\n \t\tentries.clear();\n \t\tfabric_clearCount++;\n \t}\n+\n+\t@Override\n+\tpublic void addOptional(Identifier id) {\n+\t\tadd(new Tag.OptionalObjectEntry(id), \"fabric-tag-extensions\");", "originalCommit": "02a8b147afe5d65573a181dbbf86fe6c04c32e2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2OTM3Ng==", "url": "https://github.com/FabricMC/fabric/pull/1173#discussion_r527369376", "body": "```suggestion\r\n\t\tadd(new Tag.OptionalTagEntry(id), \"fabric-tag-extensions-v0\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tadd(new Tag.OptionalTagEntry(id), \"fabric-tag-extensions\");\n          \n          \n            \n            \t\tadd(new Tag.OptionalTagEntry(id), \"fabric-tag-extensions-v0\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\tadd(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">Tag</span>.<span class=\"pl-smi\">OptionalTagEntry</span>(id), <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>fabric-tag-extensions<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\tadd(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">Tag</span>.<span class=\"pl-smi\">OptionalTagEntry</span>(id), <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>fabric-tag-extensions<span class=\"x x-first x-last\">-v0</span><span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "i509VCB", "createdAt": "2020-11-20T03:24:03Z", "path": "fabric-tag-extensions-v0/src/main/java/net/fabricmc/fabric/mixin/tag/extension/MixinTagBuilder.java", "diffHunk": "@@ -57,4 +60,14 @@ public void clearTagEntries() {\n \t\tentries.clear();\n \t\tfabric_clearCount++;\n \t}\n+\n+\t@Override\n+\tpublic void addOptional(Identifier id) {\n+\t\tadd(new Tag.OptionalObjectEntry(id), \"fabric-tag-extensions\");\n+\t}\n+\n+\t@Override\n+\tpublic void addOptionalTag(Identifier id) {\n+\t\tadd(new Tag.OptionalTagEntry(id), \"fabric-tag-extensions\");", "originalCommit": "02a8b147afe5d65573a181dbbf86fe6c04c32e2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2OTc5Mg==", "url": "https://github.com/FabricMC/fabric/pull/1173#discussion_r527369792", "body": "Could you verify the import order here?\r\n\r\nTip: `gradlew check` will run checkstyle et al", "bodyText": "Could you verify the import order here?\nTip: gradlew check will run checkstyle et al", "bodyHTML": "<p dir=\"auto\">Could you verify the import order here?</p>\n<p dir=\"auto\">Tip: <code>gradlew check</code> will run checkstyle et al</p>", "author": "i509VCB", "createdAt": "2020-11-20T03:25:27Z", "path": "fabric-tag-extensions-v0/src/main/java/net/fabricmc/fabric/mixin/tag/extension/MixinTagBuilder.java", "diffHunk": "@@ -20,6 +20,7 @@\n import java.util.Optional;\n \n import com.google.gson.JsonObject;\n+import net.minecraft.util.Identifier;", "originalCommit": "02a8b147afe5d65573a181dbbf86fe6c04c32e2e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f4175780949bda6aaca43322abc17a5eee2a5465", "url": "https://github.com/FabricMC/fabric/commit/f4175780949bda6aaca43322abc17a5eee2a5465", "message": "Address comments", "committedDate": "2020-11-20T03:45:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5OTE1Nw==", "url": "https://github.com/FabricMC/fabric/pull/1173#discussion_r527499157", "body": "`addOptionalObject` maybe to reduce confusion? Would also be nice to describe these in more detail. The reader should get an idea what these methods are needed/useful for.", "bodyText": "addOptionalObject maybe to reduce confusion? Would also be nice to describe these in more detail. The reader should get an idea what these methods are needed/useful for.", "bodyHTML": "<p dir=\"auto\"><code>addOptionalObject</code> maybe to reduce confusion? Would also be nice to describe these in more detail. The reader should get an idea what these methods are needed/useful for.</p>", "author": "sfPlayer1", "createdAt": "2020-11-20T07:54:16Z", "path": "fabric-tag-extensions-v0/src/main/java/net/fabricmc/fabric/api/tag/FabricTagBuilder.java", "diffHunk": "@@ -27,4 +29,16 @@\n \t * Clear the contained entries and mark the tag as replaced.\n \t */\n \tvoid clearTagEntries();\n+\n+\t/**\n+\t * Add an optional object entry.\n+\t * @param id The ID of the object to add\n+\t */\n+\tvoid addOptional(Identifier id);", "originalCommit": "f4175780949bda6aaca43322abc17a5eee2a5465", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY5MDAyMw==", "url": "https://github.com/FabricMC/fabric/pull/1173#discussion_r527690023", "bodyText": "They correspond directly to the non-optional methods on the base vanilla class, so I didn't really want to go into a whole explanation of the tag system.", "author": "williewillus", "createdAt": "2020-11-20T13:28:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5OTE1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzcwNTk0Mg==", "url": "https://github.com/FabricMC/fabric/pull/1173#discussion_r527705942", "bodyText": "There is no need to explain the whole tag system, just the differences Tag<>Object and Optional<>\"Normal\". E.g. something along the lines of \"Optional entries will not produce load errors if their referenced object are missing\" or whatever is appropriate.\nPlease consider adding this documentation, we try to guide the curious viewer to a reasonable extent. This file is particularly unusual/confusing since it's a detached interface that needs casting to be useful, I hope we can at some point migrate it to a subclass of Tag.Builder. Right now the two addOptional methods are quite exposed compared to the vanilla equivalents if someone sees our class before the vanilla one.", "author": "sfPlayer1", "createdAt": "2020-11-20T13:55:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5OTE1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE5MjY2OQ==", "url": "https://github.com/FabricMC/fabric/pull/1173#discussion_r529192669", "bodyText": "done", "author": "williewillus", "createdAt": "2020-11-24T04:21:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzQ5OTE1Nw=="}], "type": "inlineReview"}, {"oid": "df054d404fe3d72d176404a5c60d3b1e87ab3124", "url": "https://github.com/FabricMC/fabric/commit/df054d404fe3d72d176404a5c60d3b1e87ab3124", "message": "Rename addOptional to addOptionalObject", "committedDate": "2020-11-20T13:38:16Z", "type": "commit"}, {"oid": "728ae2ffc98252a71baa06515a737fd2dd1cae8e", "url": "https://github.com/FabricMC/fabric/commit/728ae2ffc98252a71baa06515a737fd2dd1cae8e", "message": "Flesh out doc", "committedDate": "2020-11-24T04:21:03Z", "type": "commit"}, {"oid": "95d4452733b344e06ac8550682c5fc313b7a79cd", "url": "https://github.com/FabricMC/fabric/commit/95d4452733b344e06ac8550682c5fc313b7a79cd", "message": "Move mixin to target proper class", "committedDate": "2020-11-26T03:00:45Z", "type": "commit"}]}