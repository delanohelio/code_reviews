{"pr_number": 12288, "pr_title": "Fix LostStorageIntegrationTest failure on user 'root'", "pr_author": "maobaolong", "pr_createdAt": "2020-10-14T06:19:00Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12288", "timeline": [{"oid": "16dd2ffd1f55d3f94caf09680b8ef5904900097c", "url": "https://github.com/Alluxio/alluxio/commit/16dd2ffd1f55d3f94caf09680b8ef5904900097c", "message": "Fix LostStorageIntegrationTest failure on user 'root'", "committedDate": "2020-10-14T03:21:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg4OTI5MQ==", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r504889291", "body": "Please fix the comment way", "bodyText": "Please fix the comment way", "bodyHTML": "<p dir=\"auto\">Please fix the comment way</p>", "author": "LuQQiu", "createdAt": "2020-10-14T18:33:53Z", "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "diffHunk": "@@ -60,9 +78,21 @@ public void reportLostStorageInWorkerRegister() throws Exception {\n     File hddDir = Files.createTempDir();\n     String hddPath = hddDir.getAbsolutePath();\n \n-    // Set to read only so worker storage paths cannot be initialize\n-    ssdDir.setReadOnly();\n-    hddDir.setReadOnly();\n+//    // Mock no write permission so worker storage paths cannot be initialize", "originalCommit": "16dd2ffd1f55d3f94caf09680b8ef5904900097c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA3NTM2OQ==", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r505075369", "bodyText": "OK, sorry for this", "author": "maobaolong", "createdAt": "2020-10-14T23:43:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg4OTI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MTU1Mw==", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r504891553", "body": "Why need two mockito mock? \r\ncan the path be strings other than ssdPath and hdd path?", "bodyText": "Why need two mockito mock?\ncan the path be strings other than ssdPath and hdd path?", "bodyHTML": "<p dir=\"auto\">Why need two mockito mock?<br>\ncan the path be strings other than ssdPath and hdd path?</p>", "author": "LuQQiu", "createdAt": "2020-10-14T18:37:49Z", "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "diffHunk": "@@ -60,9 +78,21 @@ public void reportLostStorageInWorkerRegister() throws Exception {\n     File hddDir = Files.createTempDir();\n     String hddPath = hddDir.getAbsolutePath();\n \n-    // Set to read only so worker storage paths cannot be initialize\n-    ssdDir.setReadOnly();\n-    hddDir.setReadOnly();\n+//    // Mock no write permission so worker storage paths cannot be initialize\n+    PowerMockito.mockStatic(StorageDir.class);\n+    Mockito.when(StorageDir.newStorageDir(any(StorageTier.class),\n+        anyInt(),\n+        anyLong(),\n+        anyLong(),\n+        anyString(),\n+        anyString())).thenCallRealMethod();\n+    Mockito.when(StorageDir.newStorageDir(any(StorageTier.class),\n+        anyInt(),\n+        anyLong(),\n+        anyLong(),\n+        or(startsWith(ssdPath), startsWith(hddPath)),", "originalCommit": "16dd2ffd1f55d3f94caf09680b8ef5904900097c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA3NDgxNA==", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r505074814", "bodyText": "Yeah, the mem tier path is another path, we need to call real method when the path is mem path.", "author": "maobaolong", "createdAt": "2020-10-14T23:42:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MTU1Mw=="}], "type": "inlineReview"}, {"oid": "483e5392d3ad598852e6e93cc4e337c8b741dfc2", "url": "https://github.com/Alluxio/alluxio/commit/483e5392d3ad598852e6e93cc4e337c8b741dfc2", "message": "Fix the comment way", "committedDate": "2020-10-14T23:50:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA4NzMwMw==", "url": "https://github.com/Alluxio/alluxio/pull/12288#discussion_r505087303", "body": "is this because `StorageDir` is `final`?\r\nIn case yes, lets change `public final class StorageDir` to be `public class StorageDir`.\r\nIn general, we should avoid using `PowerMock` which has a lot limitation", "bodyText": "is this because StorageDir is final?\nIn case yes, lets change public final class StorageDir to be public class StorageDir.\nIn general, we should avoid using PowerMock which has a lot limitation", "bodyHTML": "<p dir=\"auto\">is this because <code>StorageDir</code> is <code>final</code>?<br>\nIn case yes, lets change <code>public final class StorageDir</code> to be <code>public class StorageDir</code>.<br>\nIn general, we should avoid using <code>PowerMock</code> which has a lot limitation</p>", "author": "apc999", "createdAt": "2020-10-15T00:01:03Z", "path": "tests/src/test/java/alluxio/server/tieredstore/LostStorageIntegrationTest.java", "diffHunk": "@@ -38,6 +53,9 @@\n /**\n  * Tests for getting worker lost storage information.\n  */\n+@RunWith(PowerMockRunner.class)\n+@PrepareForTest({StorageDir.class})", "originalCommit": "483e5392d3ad598852e6e93cc4e337c8b741dfc2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}