{"pr_number": 3198, "pr_title": "[GEOT-6733] Add new expression functions to support And && Or operators", "pr_author": "ebocher", "pr_createdAt": "2020-11-05T07:55:32Z", "pr_url": "https://github.com/geotools/geotools/pull/3198", "timeline": [{"oid": "373556699743d3fa7dd00a0841fa0188e6775b0d", "url": "https://github.com/geotools/geotools/commit/373556699743d3fa7dd00a0841fa0188e6775b0d", "message": "Start to implement logical functions", "committedDate": "2020-11-04T14:21:07Z", "type": "commit"}, {"oid": "8f5dec5d82967fb91d370bf4408840cbdedf9eca", "url": "https://github.com/geotools/geotools/commit/8f5dec5d82967fb91d370bf4408840cbdedf9eca", "message": "Add AndFunction", "committedDate": "2020-11-04T15:15:05Z", "type": "commit"}, {"oid": "bbe105f8f7e4535c38d5b8a37dbba94f39aaabe3", "url": "https://github.com/geotools/geotools/commit/bbe105f8f7e4535c38d5b8a37dbba94f39aaabe3", "message": "Add OrFunction", "committedDate": "2020-11-04T15:44:02Z", "type": "commit"}, {"oid": "7a64d5bf7db3583860e3af39eac65707b8a0f03d", "url": "https://github.com/geotools/geotools/commit/7a64d5bf7db3583860e3af39eac65707b8a0f03d", "message": "Unnecessary cast", "committedDate": "2020-11-04T16:04:56Z", "type": "commit"}, {"oid": "2440d21c16f4c60243c0544a7e4d8892141f0b0a", "url": "https://github.com/geotools/geotools/commit/2440d21c16f4c60243c0544a7e4d8892141f0b0a", "message": "Add test for if_then_else", "committedDate": "2020-11-05T07:42:02Z", "type": "commit"}, {"oid": "5d87f5599e48dfe3be60f1962eb672c1bcf2b447", "url": "https://github.com/geotools/geotools/commit/5d87f5599e48dfe3be60f1962eb672c1bcf2b447", "message": "Run mvn fmt:format", "committedDate": "2020-11-05T08:52:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY4NDM3OA==", "url": "https://github.com/geotools/geotools/pull/3198#discussion_r519684378", "body": "Dates here should be all just \"2020\", e.g.:\r\n\r\n```suggestion\r\n *    (C) 2020, Open Source Geospatial Foundation (OSGeo)\r\n```", "bodyText": "Dates here should be all just \"2020\", e.g.:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             *    (C) 2002-2008, Open Source Geospatial Foundation (OSGeo)\n          \n          \n            \n             *    (C) 2020, Open Source Geospatial Foundation (OSGeo)", "bodyHTML": "<p dir=\"auto\">Dates here should be all just \"2020\", e.g.:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"> <span class=\"pl-k\">*</span>    (<span class=\"pl-smi\">C</span>) <span class=\"pl-c1 x x-first\">2002</span><span class=\"pl-k x\">-</span><span class=\"pl-c1 x x-last\">2008</span>, <span class=\"pl-smi\">Open</span> <span class=\"pl-smi\">Source</span> <span class=\"pl-smi\">Geospatial</span> <span class=\"pl-smi\">Foundation</span> (<span class=\"pl-smi\">OSGeo</span>)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"> <span class=\"pl-k\">*</span>    (<span class=\"pl-smi\">C</span>) <span class=\"pl-c1 x x-first x-last\">2020</span>, <span class=\"pl-smi\">Open</span> <span class=\"pl-smi\">Source</span> <span class=\"pl-smi\">Geospatial</span> <span class=\"pl-smi\">Foundation</span> (<span class=\"pl-smi\">OSGeo</span>)</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "aaime", "createdAt": "2020-11-09T09:59:05Z", "path": "modules/library/main/src/main/java/org/geotools/filter/function/AndFunction.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ *    GeoTools - The Open Source Java GIS Toolkit\n+ *    http://geotools.org\n+ *\n+ *    (C) 2002-2008, Open Source Geospatial Foundation (OSGeo)", "originalCommit": "5d87f5599e48dfe3be60f1962eb672c1bcf2b447", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "65ccc9cbcc51b2fc0392c95c6937e078344b2619", "url": "https://github.com/geotools/geotools/commit/65ccc9cbcc51b2fc0392c95c6937e078344b2619", "message": "Update modules/library/main/src/main/java/org/geotools/filter/function/AndFunction.java\n\nCo-authored-by: Andrea Aime <andrea.aime@gmail.com>", "committedDate": "2020-11-09T10:00:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY4NjA2MA==", "url": "https://github.com/geotools/geotools/pull/3198#discussion_r519686060", "body": "I think you commented on it already, and it's just for talking, not a request, but ... what about having a varying number of inputs, allow the user to pass as many arguments as they want? Should make setting up complex expressions easier. \r\nIn case you're interested, the \"in\" function can be used as a template to implement this behavior:\r\n\r\nhttps://github.com/geotools/geotools/blob/41ac131a56b020bd6bf1436e8fd0fa303f7927d1/modules/library/main/src/main/java/org/geotools/filter/function/InFunction.java#L77\r\n\r\nI'm happy to merge as it is now though, as said, not a requirement.", "bodyText": "I think you commented on it already, and it's just for talking, not a request, but ... what about having a varying number of inputs, allow the user to pass as many arguments as they want? Should make setting up complex expressions easier.\nIn case you're interested, the \"in\" function can be used as a template to implement this behavior:\n\n  \n    \n      geotools/modules/library/main/src/main/java/org/geotools/filter/function/InFunction.java\n    \n    \n         Line 77\n      in\n      41ac131\n    \n    \n    \n    \n\n        \n          \n           public static FunctionName NAME = \n        \n    \n  \n\n\nI'm happy to merge as it is now though, as said, not a requirement.", "bodyHTML": "<p dir=\"auto\">I think you commented on it already, and it's just for talking, not a request, but ... what about having a varying number of inputs, allow the user to pass as many arguments as they want? Should make setting up complex expressions easier.<br>\nIn case you're interested, the \"in\" function can be used as a template to implement this behavior:</p>\n<p dir=\"auto\"><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/geotools/geotools/blob/41ac131a56b020bd6bf1436e8fd0fa303f7927d1/modules/library/main/src/main/java/org/geotools/filter/function/InFunction.java#L77\">geotools/modules/library/main/src/main/java/org/geotools/filter/function/InFunction.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 77\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/geotools/geotools/commit/41ac131a56b020bd6bf1436e8fd0fa303f7927d1\">41ac131</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L77\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"77\"></td>\n          <td id=\"LC77\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">FunctionName</span> <span class=\"pl-c1\">NAME</span> <span class=\"pl-k\">=</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p dir=\"auto\">I'm happy to merge as it is now though, as said, not a requirement.</p>", "author": "aaime", "createdAt": "2020-11-09T10:01:35Z", "path": "modules/library/main/src/main/java/org/geotools/filter/function/AndFunction.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ *    GeoTools - The Open Source Java GIS Toolkit\n+ *    http://geotools.org\n+ *\n+ *    (C) 2002-2008, Open Source Geospatial Foundation (OSGeo)\n+ *\n+ *    This library is free software; you can redistribute it and/or\n+ *    modify it under the terms of the GNU Lesser General Public\n+ *    License as published by the Free Software Foundation;\n+ *    version 2.1 of the License.\n+ *\n+ *    This library is distributed in the hope that it will be useful,\n+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ *    Lesser General Public License for more details.\n+ *\n+ */\n+package org.geotools.filter.function;\n+\n+import static org.geotools.filter.capability.FunctionNameImpl.parameter;\n+\n+import org.geotools.filter.FunctionExpressionImpl;\n+import org.geotools.filter.capability.FunctionNameImpl;\n+import org.opengis.filter.capability.FunctionName;\n+\n+/**\n+ * This function is used to evaluate a And operator with a left and right operands\n+ *\n+ * @author Erwan Bocher, CNRS, 2020\n+ */\n+public class AndFunction extends FunctionExpressionImpl {\n+\n+    public static FunctionName NAME =\n+            new FunctionNameImpl(\n+                    \"And\",\n+                    Boolean.class,\n+                    parameter(\"left\", Boolean.class),", "originalCommit": "5d87f5599e48dfe3be60f1962eb672c1bcf2b447", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY5MDA5MA==", "url": "https://github.com/geotools/geotools/pull/3198#discussion_r519690090", "bodyText": "I can check the In logic. Can you point me the resource ?", "author": "ebocher", "createdAt": "2020-11-09T10:07:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY4NjA2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY5MjA1MA==", "url": "https://github.com/geotools/geotools/pull/3198#discussion_r519692050", "bodyText": "The previous comment contains a link to it, follow it, it's the entire InFunction:\n\n  \n    \n      geotools/modules/library/main/src/main/java/org/geotools/filter/function/InFunction.java\n    \n    \n         Line 77\n      in\n      41ac131\n    \n    \n    \n    \n\n        \n          \n           public static FunctionName NAME =", "author": "aaime", "createdAt": "2020-11-09T10:11:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY4NjA2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY5NjUyNQ==", "url": "https://github.com/geotools/geotools/pull/3198#discussion_r519696525", "bodyText": "Ok it seems InFunction ;-)\nBy the way I have a question.\nWhat about  this expression\ntype = 'geotools' or version > 20 and language = 'it'\nIs geotools internal function evaluator is able to manage precedence between  or and and op ?\nor should I build a  tree to manage that ?", "author": "ebocher", "createdAt": "2020-11-09T10:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY4NjA2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTcwMzkxOQ==", "url": "https://github.com/geotools/geotools/pull/3198#discussion_r519703919", "bodyText": "Functions do not have precedence, they are applied in the order they are called.", "author": "aaime", "createdAt": "2020-11-09T10:29:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY4NjA2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTc4MjQwMA==", "url": "https://github.com/geotools/geotools/pull/3198#discussion_r519782400", "bodyText": "So after looking on Function mechanism, I think you can merge this PR. The setting up of the function precedence should be left to the developer's appreciation.", "author": "ebocher", "createdAt": "2020-11-09T12:50:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTY4NjA2MA=="}], "type": "inlineReview"}]}