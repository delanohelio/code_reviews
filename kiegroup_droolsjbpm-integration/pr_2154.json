{"pr_number": 2154, "pr_title": "[JBPM-9229] hasRole implementation shouldn't return always false", "pr_author": "fjtirado", "pr_createdAt": "2020-07-13T10:54:30Z", "pr_url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2154", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3MDQ4OA==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2154#discussion_r453770488", "body": "Missing indentation here", "bodyText": "Missing indentation here", "bodyHTML": "<p dir=\"auto\">Missing indentation here</p>", "author": "gmunozfe", "createdAt": "2020-07-13T16:20:35Z", "path": "kie-server-parent/kie-server-services/kie-server-services-common/src/main/java/org/kie/server/services/impl/security/JACCIdentityProvider.java", "diffHunk": "@@ -91,6 +92,31 @@ public String getName() {\n \n     @Override\n     public boolean hasRole(String s) {\n+        Subject subject = getSubjectFromContainer();\n+        if (subject != null) {\n+        Set<Principal> principals = subject.getPrincipals();", "originalCommit": "5a24bbc9b8c7221f70f630d213c0f5b57a6fe986", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3MDU0NA==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2154#discussion_r453770544", "body": "Avoid possible NullPointerException in case \"s\" is null:\r\n```suggestion\r\n                            if (groupPrincipal.getName().equals(s)) {\r\n```", "bodyText": "Avoid possible NullPointerException in case \"s\" is null:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        if (s.equals(groupPrincipal.getName())) {\n          \n          \n            \n                                        if (groupPrincipal.getName().equals(s)) {", "bodyHTML": "<p dir=\"auto\">Avoid possible NullPointerException in case \"s\" is null:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                            <span class=\"pl-k\">if</span> (<span class=\"x x-first\">s</span><span class=\"pl-k x\">.</span><span class=\"x x-last\">equals(</span>groupPrincipal<span class=\"pl-k\">.</span>getName())) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                            <span class=\"pl-k\">if</span> (groupPrincipal<span class=\"pl-k\">.</span>getName()<span class=\"pl-k x x-first\">.</span><span class=\"x x-last\">equals(s</span>)) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "gmunozfe", "createdAt": "2020-07-13T16:20:40Z", "path": "kie-server-parent/kie-server-services/kie-server-services-common/src/main/java/org/kie/server/services/impl/security/JACCIdentityProvider.java", "diffHunk": "@@ -91,6 +92,31 @@ public String getName() {\n \n     @Override\n     public boolean hasRole(String s) {\n+        Subject subject = getSubjectFromContainer();\n+        if (subject != null) {\n+        Set<Principal> principals = subject.getPrincipals();\n+            if (principals != null) {\n+                for (Principal principal : principals) {\n+                    if (principal instanceof Group) {\n+                        Enumeration<? extends Principal> groups = ((Group) principal).members();\n+                        while (groups.hasMoreElements()) {\n+                            Principal groupPrincipal = (Principal) groups.nextElement();\n+                            if (s.equals(groupPrincipal.getName())) {", "originalCommit": "5a24bbc9b8c7221f70f630d213c0f5b57a6fe986", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3MTM1MQ==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2154#discussion_r453771351", "body": "You can add a test for null role:\r\n`assertFalse(jaccIdentityProvider.hasRole(null));`\r\n ", "bodyText": "You can add a test for null role:\nassertFalse(jaccIdentityProvider.hasRole(null));", "bodyHTML": "<p dir=\"auto\">You can add a test for null role:<br>\n<code>assertFalse(jaccIdentityProvider.hasRole(null));</code></p>", "author": "gmunozfe", "createdAt": "2020-07-13T16:22:03Z", "path": "kie-server-parent/kie-server-services/kie-server-services-common/src/test/java/org/kie/server/services/impl/security/JACCIdentityProviderWildFlyTomcatTest.java", "diffHunk": "@@ -101,6 +102,9 @@ public void testGetRoles() throws Exception {\n         assertEquals(2, jaccIdentityProvider.getRoles().size());\n         assertTrue(jaccIdentityProvider.getRoles().contains(GROUP_ONE_NAME));\n         assertTrue(jaccIdentityProvider.getRoles().contains(GROUP_TWO_NAME));\n+        assertTrue(jaccIdentityProvider.hasRole(GROUP_ONE_NAME));\n+        assertTrue(jaccIdentityProvider.hasRole(GROUP_TWO_NAME));\n+        assertFalse(jaccIdentityProvider.hasRole(\"non_existing_role\"));", "originalCommit": "5a24bbc9b8c7221f70f630d213c0f5b57a6fe986", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b0d763de5108264338c31b29fbf8b7ceb0e6dac0", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/b0d763de5108264338c31b29fbf8b7ceb0e6dac0", "message": "[JBPM-9229] hasRole implementation shouldn't return always false\n\nA proper implementation for hasRole has been implemented", "committedDate": "2020-07-13T17:04:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2MDc2Nw==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2154#discussion_r454960767", "body": "Cast to `Principal` is redundant\r\n```suggestion\r\n                            Principal groupPrincipal = groups.nextElement();\r\n```", "bodyText": "Cast to Principal is redundant\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        Principal groupPrincipal = (Principal) groups.nextElement();\n          \n          \n            \n                                        Principal groupPrincipal = groups.nextElement();", "bodyHTML": "<p dir=\"auto\">Cast to <code>Principal</code> is redundant</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                            <span class=\"pl-smi\">Principal</span> groupPrincipal <span class=\"pl-k\">=</span> <span class=\"x x-first\">(</span><span class=\"pl-smi x\">Principal</span><span class=\"x x-last\">) </span>groups<span class=\"pl-k\">.</span>nextElement();</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                            <span class=\"pl-smi\">Principal</span> groupPrincipal <span class=\"pl-k\">=</span> groups<span class=\"pl-k\">.</span>nextElement();</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "afalhambra", "createdAt": "2020-07-15T10:45:49Z", "path": "kie-server-parent/kie-server-services/kie-server-services-common/src/main/java/org/kie/server/services/impl/security/JACCIdentityProvider.java", "diffHunk": "@@ -91,6 +92,31 @@ public String getName() {\n \n     @Override\n     public boolean hasRole(String s) {\n+        Subject subject = getSubjectFromContainer();\n+        if (subject != null) {\n+            Set<Principal> principals = subject.getPrincipals();\n+            if (principals != null) {\n+                for (Principal principal : principals) {\n+                    if (principal instanceof Group) {\n+                        Enumeration<? extends Principal> groups = ((Group) principal).members();\n+                        while (groups.hasMoreElements()) {\n+                            Principal groupPrincipal = (Principal) groups.nextElement();", "originalCommit": "b0d763de5108264338c31b29fbf8b7ceb0e6dac0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3NDQzMg==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2154#discussion_r454974432", "bodyText": "good catch, removing this casting from here and former code", "author": "fjtirado", "createdAt": "2020-07-15T11:13:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2MDc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2MjU3Mw==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2154#discussion_r454962573", "body": "Not really sure here, should we ignore case sensitive? What do you think?", "bodyText": "Not really sure here, should we ignore case sensitive? What do you think?", "bodyHTML": "<p dir=\"auto\">Not really sure here, should we ignore case sensitive? What do you think?</p>", "author": "afalhambra", "createdAt": "2020-07-15T10:49:33Z", "path": "kie-server-parent/kie-server-services/kie-server-services-common/src/main/java/org/kie/server/services/impl/security/JACCIdentityProvider.java", "diffHunk": "@@ -91,6 +92,31 @@ public String getName() {\n \n     @Override\n     public boolean hasRole(String s) {\n+        Subject subject = getSubjectFromContainer();\n+        if (subject != null) {\n+            Set<Principal> principals = subject.getPrincipals();\n+            if (principals != null) {\n+                for (Principal principal : principals) {\n+                    if (principal instanceof Group) {\n+                        Enumeration<? extends Principal> groups = ((Group) principal).members();\n+                        while (groups.hasMoreElements()) {\n+                            Principal groupPrincipal = (Principal) groups.nextElement();\n+                            if (groupPrincipal.getName().equals(s)) {", "originalCommit": "b0d763de5108264338c31b29fbf8b7ceb0e6dac0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3Mzk5Mg==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2154#discussion_r454973992", "bodyText": "hmmm, good point, since there are not requirement about that, lets keep it this way, which is the default.", "author": "fjtirado", "createdAt": "2020-07-15T11:12:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2MjU3Mw=="}], "type": "inlineReview"}, {"oid": "f7ae6ea0f6bc57e8043331f8f34cd563f27c31b4", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f7ae6ea0f6bc57e8043331f8f34cd563f27c31b4", "message": "[JBPM-9229] hasRole implementation shouldn't return always false\n\nA proper implementation for hasRole has been implemented", "committedDate": "2020-07-15T11:11:19Z", "type": "commit"}, {"oid": "f7ae6ea0f6bc57e8043331f8f34cd563f27c31b4", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f7ae6ea0f6bc57e8043331f8f34cd563f27c31b4", "message": "[JBPM-9229] hasRole implementation shouldn't return always false\n\nA proper implementation for hasRole has been implemented", "committedDate": "2020-07-15T11:11:19Z", "type": "forcePushed"}]}