{"pr_number": 2389, "pr_title": "show devices limit", "pr_author": "haimeiguo", "pr_createdAt": "2020-12-30T12:10:38Z", "pr_url": "https://github.com/apache/iotdb/pull/2389", "timeline": [{"oid": "02579ce2bd99b0981ba0f2cd6b3dbc6b435fd606", "url": "https://github.com/apache/iotdb/commit/02579ce2bd99b0981ba0f2cd6b3dbc6b435fd606", "message": "show devices limit", "committedDate": "2020-12-30T12:12:41Z", "type": "forcePushed"}, {"oid": "4a1795e084ebd525371408b2f0086d0327323a7a", "url": "https://github.com/apache/iotdb/commit/4a1795e084ebd525371408b2f0086d0327323a7a", "message": "show devices limit", "committedDate": "2020-12-30T12:17:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM3OTQzNQ==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r550379435", "body": "Rename this to `getDevices` or change the other to `showDevices` to implement overloading.", "bodyText": "Rename this to getDevices or change the other to showDevices to implement overloading.", "bodyHTML": "<p dir=\"auto\">Rename this to <code>getDevices</code> or change the other to <code>showDevices</code> to implement overloading.</p>", "author": "Alima777", "createdAt": "2020-12-31T02:29:15Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MManager.java", "diffHunk": "@@ -688,6 +689,10 @@ public TSDataType getSeriesType(PartialPath path) throws MetadataException {\n     return mtree.getDevices(prefixPath);\n   }\n \n+  public Set<PartialPath> showDevices(ShowDevicesPlan plan) throws MetadataException {", "originalCommit": "4a1795e084ebd525371408b2f0086d0327323a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM3OTk0Mw==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r550379943", "body": "Do this in `PhysicalGenerator` or the constructor of `ShowDevicePlan`, not here.", "bodyText": "Do this in PhysicalGenerator or the constructor of ShowDevicePlan, not here.", "bodyHTML": "<p dir=\"auto\">Do this in <code>PhysicalGenerator</code> or the constructor of <code>ShowDevicePlan</code>, not here.</p>", "author": "Alima777", "createdAt": "2020-12-31T02:34:25Z", "path": "server/src/main/java/org/apache/iotdb/db/service/TSServiceImpl.java", "diffHunk": "@@ -672,6 +673,17 @@ private TSExecuteStatementResp internalExecuteQueryStatement(String statement,\n           ((ShowTimeSeriesPlan) plan).setHasLimit(true);\n         }\n       }\n+\n+      if (plan instanceof ShowDevicesPlan) {\n+        //If the user does not pass the limit, then set limit = fetchSize and haslimit=false,else set haslimit = true\n+        if (((ShowDevicesPlan) plan).getLimit() == 0) {\n+          ((ShowDevicesPlan) plan).setLimit(fetchSize);\n+          ((ShowDevicesPlan) plan).setHasLimit(false);\n+        } else {\n+          ((ShowDevicesPlan) plan).setHasLimit(true);\n+        }\n+      }\n+", "originalCommit": "4a1795e084ebd525371408b2f0086d0327323a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM4MTMzMg==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r550381332", "body": "Line 1134: Set<PartialPath> devices = new TreeSet<>();", "bodyText": "Line 1134: Set devices = new TreeSet<>();", "bodyHTML": "<p dir=\"auto\">Line 1134: Set devices = new TreeSet&lt;&gt;();</p>", "author": "Alima777", "createdAt": "2020-12-31T02:45:16Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -1121,7 +1122,32 @@ private void findChildNodePathInNextLevel(\n       throw new IllegalPathException(prefixPath.getFullPath());\n     }\n     Set<PartialPath> devices = new TreeSet<>();\n-    findDevices(root, nodes, 1, devices);\n+    findDevices(root, nodes, 1, devices, false);\n+    return devices;\n+  }\n+\n+  Set<PartialPath> getDevices(ShowDevicesPlan plan) throws MetadataException {\n+    String[] nodes = plan.getPath().getNodes();\n+    if (nodes.length == 0 || !nodes[0].equals(root.getName())) {\n+      throw new IllegalPathException(plan.getPath().getFullPath());\n+    }\n+    Set<PartialPath> devices;\n+    limit.set(plan.getLimit());\n+    offset.set(plan.getOffset());\n+    curOffset.set(-1);\n+    count.set(0);\n+    if (offset.get() != 0 || limit.get() != 0) {\n+      devices = new TreeSet<>();\n+      findDevices(root, nodes, 1, devices, true);\n+    } else {\n+      devices = new TreeSet<>();", "originalCommit": "4a1795e084ebd525371408b2f0086d0327323a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM4NDY1NQ==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r550384655", "body": "```suggestion\r\n          if (hasLimit) {\r\n            curOffset.set(curOffset.get() + 1);\r\n            if (curOffset.get() < offset.get() || count.get().intValue() == limit.get().intValue()) {\r\n              return;\r\n            }\r\n            count.set(count.get() + 1);\r\n          }\r\n          res.add(node.getPartialPath());\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      if (hasLimit) {\n          \n          \n            \n                        curOffset.set(curOffset.get() + 1);\n          \n          \n            \n                        if (curOffset.get() < offset.get() || count.get().intValue() == limit.get().intValue()) {\n          \n          \n            \n                          return;\n          \n          \n            \n                        }\n          \n          \n            \n                      }\n          \n          \n            \n                      res.add(node.getPartialPath());\n          \n          \n            \n                      if (hasLimit) {\n          \n          \n            \n                        count.set(count.get() + 1);\n          \n          \n            \n                      }\n          \n          \n            \n                      if (hasLimit) {\n          \n          \n            \n                        curOffset.set(curOffset.get() + 1);\n          \n          \n            \n                        if (curOffset.get() < offset.get() || count.get().intValue() == limit.get().intValue()) {\n          \n          \n            \n                          return;\n          \n          \n            \n                        }\n          \n          \n            \n                        count.set(count.get() + 1);\n          \n          \n            \n                      }\n          \n          \n            \n                      res.add(node.getPartialPath());", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1165\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          <span class=\"pl-k\">if</span> (hasLimit) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1166\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            curOffset<span class=\"pl-k\">.</span>set(curOffset<span class=\"pl-k\">.</span>get() <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1167\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            <span class=\"pl-k\">if</span> (curOffset<span class=\"pl-k\">.</span>get() <span class=\"pl-k\">&lt;</span> offset<span class=\"pl-k\">.</span>get() <span class=\"pl-k\">||</span> count<span class=\"pl-k\">.</span>get()<span class=\"pl-k\">.</span>intValue() <span class=\"pl-k\">==</span> limit<span class=\"pl-k\">.</span>get()<span class=\"pl-k\">.</span>intValue()) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1168\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">              <span class=\"pl-k\">return</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1169\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1170\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1171\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          res<span class=\"pl-k\">.</span>add(node<span class=\"pl-k\">.</span>getPartialPath());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1172\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          <span class=\"pl-k\">if</span> (hasLimit) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1173\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            count<span class=\"pl-k\">.</span>set(count<span class=\"pl-k\">.</span>get() <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1174\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1165\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">          <span class=\"pl-k\">if</span> (hasLimit) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1166\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            curOffset<span class=\"pl-k\">.</span>set(curOffset<span class=\"pl-k\">.</span>get() <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1167\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            <span class=\"pl-k\">if</span> (curOffset<span class=\"pl-k\">.</span>get() <span class=\"pl-k\">&lt;</span> offset<span class=\"pl-k\">.</span>get() <span class=\"pl-k\">||</span> count<span class=\"pl-k\">.</span>get()<span class=\"pl-k\">.</span>intValue() <span class=\"pl-k\">==</span> limit<span class=\"pl-k\">.</span>get()<span class=\"pl-k\">.</span>intValue()) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1168\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">              <span class=\"pl-k\">return</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1169\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1170\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            count<span class=\"pl-k\">.</span>set(count<span class=\"pl-k\">.</span>get() <span class=\"pl-k\">+</span> <span class=\"pl-c1\">1</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1171\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">          }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"1172\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">          res<span class=\"pl-k\">.</span>add(node<span class=\"pl-k\">.</span>getPartialPath());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Alima777", "createdAt": "2020-12-31T03:11:40Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -1134,16 +1160,25 @@ private void findChildNodePathInNextLevel(\n    * @param res   store all matched device names\n    */\n   @SuppressWarnings(\"squid:S3776\")\n-  private void findDevices(MNode node, String[] nodes, int idx, Set<PartialPath> res) {\n+  private void findDevices(MNode node, String[] nodes, int idx, Set<PartialPath> res, boolean hasLimit) {\n     String nodeReg = MetaUtils.getNodeRegByIdx(idx, nodes);\n     // the node path doesn't contains '*'\n     if (!nodeReg.contains(PATH_WILDCARD)) {\n       MNode next = node.getChild(nodeReg);\n       if (next != null) {\n         if (next instanceof MeasurementMNode && idx >= nodes.length) {\n+          if (hasLimit) {\n+            curOffset.set(curOffset.get() + 1);\n+            if (curOffset.get() < offset.get() || count.get().intValue() == limit.get().intValue()) {\n+              return;\n+            }\n+          }\n           res.add(node.getPartialPath());\n+          if (hasLimit) {\n+            count.set(count.get() + 1);\n+          }", "originalCommit": "4a1795e084ebd525371408b2f0086d0327323a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM4NDY2OQ==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r550384669", "body": "The same.", "bodyText": "The same.", "bodyHTML": "<p dir=\"auto\">The same.</p>", "author": "Alima777", "createdAt": "2020-12-31T03:11:57Z", "path": "server/src/main/java/org/apache/iotdb/db/metadata/MTree.java", "diffHunk": "@@ -1155,10 +1190,19 @@ private void findDevices(MNode node, String[] nodes, int idx, Set<PartialPath> r\n           continue;\n         }\n         if (child instanceof MeasurementMNode && !deviceAdded && idx >= nodes.length) {\n+          if (hasLimit) {\n+            curOffset.set(curOffset.get() + 1);\n+            if (curOffset.get() < offset.get() || count.get().intValue() == limit.get().intValue()) {\n+              return;\n+            }\n+          }\n           res.add(node.getPartialPath());\n+          if (hasLimit) {\n+            count.set(count.get() + 1);\n+          }", "originalCommit": "4a1795e084ebd525371408b2f0086d0327323a7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4a1795e084ebd525371408b2f0086d0327323a7a", "url": "https://github.com/apache/iotdb/commit/4a1795e084ebd525371408b2f0086d0327323a7a", "message": "show devices limit", "committedDate": "2020-12-30T12:17:22Z", "type": "forcePushed"}, {"oid": "daf609ca59da7081852333c0a02d899296806902", "url": "https://github.com/apache/iotdb/commit/daf609ca59da7081852333c0a02d899296806902", "message": "show devices limit", "committedDate": "2020-12-31T09:34:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTA5MDk5NQ==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r551090995", "body": "```suggestion\r\n  public ShowDevicesPlan(ShowContentType showContentType, PartialPath path, int limit, int offset) {\r\n    this(showContentType, path);\r\n    this.offset = offset;\r\n     if (limit == 0) {\r\n          this.limit = fetchSize;\r\n          this.hasLimit = false;\r\n        } else {\r\n          this.hasLimit = true;\r\n        }\r\n  }\r\n\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public ShowDevicesPlan(ShowContentType showContentType, PartialPath path, int limit, int offset) {\n          \n          \n            \n                this(showContentType, path);\n          \n          \n            \n                this.limit = limit;\n          \n          \n            \n                this.offset = offset;\n          \n          \n            \n              }\n          \n          \n            \n              public ShowDevicesPlan(ShowContentType showContentType, PartialPath path, int limit, int offset) {\n          \n          \n            \n                this(showContentType, path);\n          \n          \n            \n                this.offset = offset;\n          \n          \n            \n                 if (limit == 0) {\n          \n          \n            \n                      this.limit = fetchSize;\n          \n          \n            \n                      this.hasLimit = false;\n          \n          \n            \n                    } else {\n          \n          \n            \n                      this.hasLimit = true;\n          \n          \n            \n                    }\n          \n          \n            \n              }", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">public</span> ShowDevicesPlan(<span class=\"pl-smi\">ShowContentType</span> showContentType, <span class=\"pl-smi\">PartialPath</span> path, <span class=\"pl-k\">int</span> limit, <span class=\"pl-k\">int</span> offset) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-c1\">this</span>(showContentType, path);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>limit <span class=\"pl-k\">=</span> limit;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>offset <span class=\"pl-k\">=</span> offset;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">public</span> ShowDevicesPlan(<span class=\"pl-smi\">ShowContentType</span> showContentType, <span class=\"pl-smi\">PartialPath</span> path, <span class=\"pl-k\">int</span> limit, <span class=\"pl-k\">int</span> offset) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-c1\">this</span>(showContentType, path);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>offset <span class=\"pl-k\">=</span> offset;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">if</span> (limit <span class=\"pl-k\">==</span> <span class=\"pl-c1\">0</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">          <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>limit <span class=\"pl-k\">=</span> fetchSize;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">          <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>hasLimit <span class=\"pl-k\">=</span> <span class=\"pl-c1\">false</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        } <span class=\"pl-k\">else</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">          <span class=\"pl-c1\">this</span><span class=\"pl-k\">.</span>hasLimit <span class=\"pl-k\">=</span> <span class=\"pl-c1\">true</span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Alima777", "createdAt": "2021-01-04T02:23:58Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/physical/sys/ShowDevicesPlan.java", "diffHunk": "@@ -21,15 +21,49 @@\n import org.apache.iotdb.db.metadata.PartialPath;\n \n public class ShowDevicesPlan extends ShowPlan{\n+\n   private PartialPath path;\n+  private int limit = 0;\n+  private int offset = 0;\n+  private boolean hasLimit;\n \n   public ShowDevicesPlan(ShowContentType showContentType, PartialPath path) {\n     super(showContentType);\n     this.path = path;\n   }\n \n+  public ShowDevicesPlan(ShowContentType showContentType, PartialPath path, int limit, int offset) {\n+    this(showContentType, path);\n+    this.limit = limit;\n+    this.offset = offset;\n+  }\n+", "originalCommit": "daf609ca59da7081852333c0a02d899296806902", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTA5MTIyMw==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r551091223", "bodyText": "Why not put the initialization here? :D", "author": "Alima777", "createdAt": "2021-01-04T02:25:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTA5MDk5NQ=="}], "type": "inlineReview"}, {"oid": "3ca804a55ccb5176fdac08c2a54259e85b4af3be", "url": "https://github.com/apache/iotdb/commit/3ca804a55ccb5176fdac08c2a54259e85b4af3be", "message": "show devices limit", "committedDate": "2021-01-11T10:07:03Z", "type": "commit"}, {"oid": "d7d0ebc024edda2929dfd4d0c4035144aca68d99", "url": "https://github.com/apache/iotdb/commit/d7d0ebc024edda2929dfd4d0c4035144aca68d99", "message": "edit ShowPlan, ShowDataSet", "committedDate": "2021-01-11T10:07:04Z", "type": "commit"}, {"oid": "76ca3ea9a7389c67ebc90de62c0a04e4ca6efa51", "url": "https://github.com/apache/iotdb/commit/76ca3ea9a7389c67ebc90de62c0a04e4ca6efa51", "message": "fix code smell", "committedDate": "2021-01-11T11:15:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTA5OTc2Mw==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r555099763", "body": "The sonar test shows these lines are duplicated with some lines in `ShowTimeseriesPlan`. How do you think remove the lines in `ShowTimeseriesPlan`? ", "bodyText": "The sonar test shows these lines are duplicated with some lines in ShowTimeseriesPlan. How do you think remove the lines in ShowTimeseriesPlan?", "bodyHTML": "<p dir=\"auto\">The sonar test shows these lines are duplicated with some lines in <code>ShowTimeseriesPlan</code>. How do you think remove the lines in <code>ShowTimeseriesPlan</code>?</p>", "author": "HTHou", "createdAt": "2021-01-11T14:50:36Z", "path": "server/src/main/java/org/apache/iotdb/db/qp/physical/sys/ShowPlan.java", "diffHunk": "@@ -44,6 +65,34 @@ public ShowContentType getShowContentType() {\n     return showContentType;\n   }\n \n+  public PartialPath getPath() {\n+    return this.path;\n+  }\n+\n+  public int getLimit() {\n+    return limit;\n+  }\n+\n+  public void setLimit(int limit) {\n+    this.limit = limit;\n+  }\n+\n+  public int getOffset() {\n+    return offset;\n+  }\n+\n+  public void setOffset(int offset) {\n+    this.offset = offset;\n+  }\n+\n+  public boolean hasLimit() {\n+    return hasLimit;\n+  }", "originalCommit": "76ca3ea9a7389c67ebc90de62c0a04e4ca6efa51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTQ3MjgzMg==", "url": "https://github.com/apache/iotdb/pull/2389#discussion_r555472832", "bodyText": "code smell solved. thank you :)", "author": "haimeiguo", "createdAt": "2021-01-12T02:36:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTA5OTc2Mw=="}], "type": "inlineReview"}, {"oid": "c49bd49e236e24e21edb3d435991d0a946616dfc", "url": "https://github.com/apache/iotdb/commit/c49bd49e236e24e21edb3d435991d0a946616dfc", "message": "fix code smell", "committedDate": "2021-01-12T01:43:10Z", "type": "forcePushed"}, {"oid": "5d2b75fb187f4801308126f97234d92fb5eb9f7e", "url": "https://github.com/apache/iotdb/commit/5d2b75fb187f4801308126f97234d92fb5eb9f7e", "message": "fix code smell", "committedDate": "2021-01-12T02:19:24Z", "type": "commit"}, {"oid": "5d2b75fb187f4801308126f97234d92fb5eb9f7e", "url": "https://github.com/apache/iotdb/commit/5d2b75fb187f4801308126f97234d92fb5eb9f7e", "message": "fix code smell", "committedDate": "2021-01-12T02:19:24Z", "type": "forcePushed"}]}