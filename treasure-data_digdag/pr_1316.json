{"pr_number": 1316, "pr_title": "Fix EcsCommandExecutor to use finish marker to know if logging is finished or not", "pr_author": "naritta", "pr_createdAt": "2020-01-10T09:19:06Z", "pr_url": "https://github.com/treasure-data/digdag/pull/1316", "timeline": [{"oid": "b7304d8f03674c166bec24a5323a1495a5cf5767", "url": "https://github.com/treasure-data/digdag/commit/b7304d8f03674c166bec24a5323a1495a5cf5767", "message": "Fix EcsCommandExecutor to use finish marker to know if task is finished or not", "committedDate": "2020-01-10T09:16:16Z", "type": "commit"}, {"oid": "a7adc4f0d7c5537b6dea03ebedba1ff813fde44c", "url": "https://github.com/treasure-data/digdag/commit/a7adc4f0d7c5537b6dea03ebedba1ff813fde44c", "message": "Add timeout and refactor", "committedDate": "2020-01-14T08:22:13Z", "type": "commit"}, {"oid": "a7adc4f0d7c5537b6dea03ebedba1ff813fde44c", "url": "https://github.com/treasure-data/digdag/commit/a7adc4f0d7c5537b6dea03ebedba1ff813fde44c", "message": "Add timeout and refactor", "committedDate": "2020-01-14T08:22:13Z", "type": "forcePushed"}, {"oid": "1ed8b398e30344c79a92046311d4418e05656dc6", "url": "https://github.com/treasure-data/digdag/commit/1ed8b398e30344c79a92046311d4418e05656dc6", "message": "move log uploading to after marker is checked", "committedDate": "2020-01-14T09:02:24Z", "type": "commit"}, {"oid": "e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "url": "https://github.com/treasure-data/digdag/commit/e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "message": "Fix to use contain for checking finish marker", "committedDate": "2020-01-15T08:53:41Z", "type": "commit"}, {"oid": "e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "url": "https://github.com/treasure-data/digdag/commit/e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "message": "Fix to use contain for checking finish marker", "committedDate": "2020-01-15T08:53:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1NDkxNA==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r370854914", "body": "1. We can make this happen earlier. As soon as a task finishes, right before `// always return false to check if ...` comment, we can set status_code.\r\n", "bodyText": "We can make this happen earlier. As soon as a task finishes, right before // always return false to check if ... comment, we can set status_code.", "bodyHTML": "<ol dir=\"auto\">\n<li>We can make this happen earlier. As soon as a task finishes, right before <code>// always return false to check if ...</code> comment, we can set status_code.</li>\n</ol>", "author": "frsyuki", "createdAt": "2020-01-24T21:41:04Z", "path": "digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java", "diffHunk": "@@ -287,8 +288,39 @@ CommandStatus createNextCommandStatus(\n         }\n \n         final EcsTaskStatus taskStatus = EcsTaskStatus.of(task.getLastStatus());\n-        final ObjectNode previousExecutorStatus = (ObjectNode) previousStatus.get(\"executor_state\");\n-        final ObjectNode nextExecutorStatus;\n+        ObjectNode previousExecutorStatus = (ObjectNode) previousStatus.get(\"executor_state\");\n+        ObjectNode nextExecutorStatus;\n+\n+        // To fetch log until all logs is written in CloudWatch, it should wait until getting finish marker in end of task.\n+        // (finished previous poll once considering risk of crushing while running previous actual poll.)\n+        final Optional<Long> taskFinishedAt = !previousStatus.has(\"task_finished_at\") ?\n+                Optional.absent() : Optional.of(previousStatus.get(\"task_finished_at\").asLong());\n+        if (taskFinishedAt.isPresent()) {\n+            long timeout = taskFinishedAt.get() + 60;\n+            do {\n+                previousExecutorStatus = fetchLogEvents(client, task, previousStatus, previousExecutorStatus);\n+                if (previousExecutorStatus.get(\"logging_finished\") != null) {\n+                    break;\n+                }\n+            } while (Instant.now().getEpochSecond() < timeout);\n+\n+            final String outputArchivePathName = \"archive-output.tar.gz\";\n+            final String outputArchiveKey = createStorageKey(commandContext.getTaskRequest(), outputArchivePathName); // url format\n+            // Download output config archive\n+            final TemporalProjectArchiveStorage temporalStorage = createTemporalProjectArchiveStorage(commandContext.getTaskRequest().getConfig());\n+            try (final InputStream in = temporalStorage.getContentInputStream(outputArchiveKey)) {\n+                ProjectArchives.extractTarArchive(commandContext.getLocalProjectPath(), in); // IOException\n+            }\n+\n+            final ObjectNode nextStatus = previousStatus.deepCopy();\n+            nextStatus.set(\"executor_state\", previousExecutorStatus);\n+\n+            // Set exit code of container finished to nextStatus\n+            nextStatus.put(\"status_code\", task.getContainers().get(0).getExitCode());", "originalCommit": "e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyOTIzMA==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r371329230", "bodyText": "I moved status_code putting to after task is finished.\n3c6c3dc", "author": "naritta", "createdAt": "2020-01-27T16:03:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg1NDkxNA=="}], "type": "inlineReview", "revised_code": {"commit": "3c6c3dc7afe0e488d1767018c0894fdb89a7b03a", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 1de97828a2..4ac861f325 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -315,9 +316,6 @@ public class EcsCommandExecutor\n             final ObjectNode nextStatus = previousStatus.deepCopy();\n             nextStatus.set(\"executor_state\", previousExecutorStatus);\n \n-            // Set exit code of container finished to nextStatus\n-            nextStatus.put(\"status_code\", task.getContainers().get(0).getExitCode());\n-\n             return EcsCommandStatus.of(true, nextStatus);\n         }\n \n", "next_change": {"commit": "d8de229d1475895705fd39658cc4d4fcccb129e6", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 4ac861f325..5f9ea4fb30 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -319,12 +307,28 @@ public class EcsCommandExecutor\n             return EcsCommandStatus.of(true, nextStatus);\n         }\n \n+        final String cluster = previousStatus.get(\"cluster_name\").asText();\n+        final String taskArn = previousStatus.get(\"task_arn\").asText();\n+        final Task task;\n+        try {\n+            task = client.getTask(cluster, taskArn);\n+        } catch (TaskSetNotFoundException e) {\n+            // if task is not present, an operator will throw TaskExecutionException to retry polling the status.\n+            logger.info(\"Cannot get the Ecs task status. Will be retried.\");\n+            return EcsCommandStatus.of(false, previousStatus.deepCopy());\n+        }\n+\n+        if (logger.isDebugEnabled()) {\n+            logger.debug(\"Get task: \" + task);\n+        }\n+\n+        final EcsTaskStatus taskStatus = EcsTaskStatus.of(task.getLastStatus());\n         // If the container doesn't start yet, it cannot extract any log messages from the container.\n         if (taskStatus.isSameOrAfter(EcsTaskStatus.RUNNING)) {\n             // if previous status has 'awslogs' log driver configuration, it tries to fetch log events by that.\n             // Otherwise, it skips fetching logs.\n             if (!previousStatus.get(\"awslogs\").isNull()) { // awslogs?\n-                nextExecutorStatus = fetchLogEvents(client, task, previousStatus, previousExecutorStatus);\n+                nextExecutorStatus = fetchLogEvents(client, previousStatus, previousExecutorStatus);\n             }\n             else {\n                 nextExecutorStatus = previousExecutorStatus.deepCopy();\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MDMwMQ==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r370860301", "body": "2. After 1., if you feel you have energy (meaning it's optional to do), it's better to do a refactoring around execution status data:\r\n\r\n* `toLogStreamName` is formatting a string but it's unnecessary if `previousStatus` includes the pre-built string. As like `toLogGroupName` is doing. If `toLogStreamName` simply uses `previousStatus.get(\"awslogs\").get(\"awslogs-stream\").asText()` then, we can do as following:\r\n* `run` calls `createCurrentStatus` to set `awslogs` to the status. It's calling `getAwsLogsConfiguration(td)`, which copies all of the `logConfig.getOptions().entrySet()` to the executor status. This becomes unnecessary. Instead, it simply needs to copy `awslogs.awslogs-group` and format&set `awslogs.awslogs-stream` only.\r\n* Because `toLogStreamName` gets pre-formatted text from the executor status, it doesn't need `TaskDefinition td` any more. It also means that `fetchLogEvents` doesn't need `Task task`. It means that `createNextCommandStatus` doesn't have to pass `Task task` to `fetchLogEvents`. Therefore, you can move this entire block (`if (taskFinishedAt.isPresent()) { ... }`) right before `client.getTask` call. It means that EcsCommandExecutor doesn't have to call ECS API when it's waiting for logs.\r\n\r\nThis is helpful to mitigate API call rate limit of ECS API.\r\n", "bodyText": "After 1., if you feel you have energy (meaning it's optional to do), it's better to do a refactoring around execution status data:\n\n\ntoLogStreamName is formatting a string but it's unnecessary if previousStatus includes the pre-built string. As like toLogGroupName is doing. If toLogStreamName simply uses previousStatus.get(\"awslogs\").get(\"awslogs-stream\").asText() then, we can do as following:\nrun calls createCurrentStatus to set awslogs to the status. It's calling getAwsLogsConfiguration(td), which copies all of the logConfig.getOptions().entrySet() to the executor status. This becomes unnecessary. Instead, it simply needs to copy awslogs.awslogs-group and format&set awslogs.awslogs-stream only.\nBecause toLogStreamName gets pre-formatted text from the executor status, it doesn't need TaskDefinition td any more. It also means that fetchLogEvents doesn't need Task task. It means that createNextCommandStatus doesn't have to pass Task task to fetchLogEvents. Therefore, you can move this entire block (if (taskFinishedAt.isPresent()) { ... }) right before client.getTask call. It means that EcsCommandExecutor doesn't have to call ECS API when it's waiting for logs.\n\nThis is helpful to mitigate API call rate limit of ECS API.", "bodyHTML": "<ol start=\"2\" dir=\"auto\">\n<li>After 1., if you feel you have energy (meaning it's optional to do), it's better to do a refactoring around execution status data:</li>\n</ol>\n<ul dir=\"auto\">\n<li><code>toLogStreamName</code> is formatting a string but it's unnecessary if <code>previousStatus</code> includes the pre-built string. As like <code>toLogGroupName</code> is doing. If <code>toLogStreamName</code> simply uses <code>previousStatus.get(\"awslogs\").get(\"awslogs-stream\").asText()</code> then, we can do as following:</li>\n<li><code>run</code> calls <code>createCurrentStatus</code> to set <code>awslogs</code> to the status. It's calling <code>getAwsLogsConfiguration(td)</code>, which copies all of the <code>logConfig.getOptions().entrySet()</code> to the executor status. This becomes unnecessary. Instead, it simply needs to copy <code>awslogs.awslogs-group</code> and format&amp;set <code>awslogs.awslogs-stream</code> only.</li>\n<li>Because <code>toLogStreamName</code> gets pre-formatted text from the executor status, it doesn't need <code>TaskDefinition td</code> any more. It also means that <code>fetchLogEvents</code> doesn't need <code>Task task</code>. It means that <code>createNextCommandStatus</code> doesn't have to pass <code>Task task</code> to <code>fetchLogEvents</code>. Therefore, you can move this entire block (<code>if (taskFinishedAt.isPresent()) { ... }</code>) right before <code>client.getTask</code> call. It means that EcsCommandExecutor doesn't have to call ECS API when it's waiting for logs.</li>\n</ul>\n<p dir=\"auto\">This is helpful to mitigate API call rate limit of ECS API.</p>", "author": "frsyuki", "createdAt": "2020-01-24T21:56:26Z", "path": "digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java", "diffHunk": "@@ -287,8 +288,39 @@ CommandStatus createNextCommandStatus(\n         }\n \n         final EcsTaskStatus taskStatus = EcsTaskStatus.of(task.getLastStatus());\n-        final ObjectNode previousExecutorStatus = (ObjectNode) previousStatus.get(\"executor_state\");\n-        final ObjectNode nextExecutorStatus;\n+        ObjectNode previousExecutorStatus = (ObjectNode) previousStatus.get(\"executor_state\");\n+        ObjectNode nextExecutorStatus;\n+\n+        // To fetch log until all logs is written in CloudWatch, it should wait until getting finish marker in end of task.\n+        // (finished previous poll once considering risk of crushing while running previous actual poll.)\n+        final Optional<Long> taskFinishedAt = !previousStatus.has(\"task_finished_at\") ?\n+                Optional.absent() : Optional.of(previousStatus.get(\"task_finished_at\").asLong());\n+        if (taskFinishedAt.isPresent()) {\n+            long timeout = taskFinishedAt.get() + 60;\n+            do {\n+                previousExecutorStatus = fetchLogEvents(client, task, previousStatus, previousExecutorStatus);", "originalCommit": "e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM0ODE4Mw==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r371348183", "bodyText": "Thank for teaching, I refactored like that to reduce ECS API call.\nd8de229", "author": "naritta", "createdAt": "2020-01-27T16:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MDMwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "b45c5fb60f7480a6ad6c21f9d71d90ed663ae23b", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 1de97828a2..22e2aa4f60 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -299,7 +300,7 @@ public class EcsCommandExecutor\n             long timeout = taskFinishedAt.get() + 60;\n             do {\n                 previousExecutorStatus = fetchLogEvents(client, task, previousStatus, previousExecutorStatus);\n-                if (previousExecutorStatus.get(\"logging_finished\") != null) {\n+                if (previousExecutorStatus.get(\"logging_finished_at\") != null) {\n                     break;\n                 }\n             } while (Instant.now().getEpochSecond() < timeout);\n", "next_change": {"commit": "d8de229d1475895705fd39658cc4d4fcccb129e6", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 22e2aa4f60..5f9ea4fb30 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -299,7 +287,7 @@ public class EcsCommandExecutor\n         if (taskFinishedAt.isPresent()) {\n             long timeout = taskFinishedAt.get() + 60;\n             do {\n-                previousExecutorStatus = fetchLogEvents(client, task, previousStatus, previousExecutorStatus);\n+                previousExecutorStatus = fetchLogEvents(client, previousStatus, previousExecutorStatus);\n                 if (previousExecutorStatus.get(\"logging_finished_at\") != null) {\n                     break;\n                 }\n", "next_change": null}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MTMwMg==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r370861302", "body": "```suggestion\r\n                }\r\n                else {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            } else {\n          \n          \n            \n                            }\n          \n          \n            \n                            else {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">                }<span class=\"x x-first\"> </span><span class=\"pl-k x\">else</span><span class=\"x x-last\"> {</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">                <span class=\"pl-k\">else</span> {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "frsyuki", "createdAt": "2020-01-24T21:59:25Z", "path": "digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java", "diffHunk": "@@ -361,7 +386,12 @@ ObjectNode fetchLogEvents(final EcsClient client,\n         }\n         else {\n             for (final OutputLogEvent logEvent : logEvents) {\n-                log(logEvent.getMessage() + \"\\n\", clog);\n+                String log = logEvent.getMessage();\n+                if (log.contains(ECS_TASK_FINISHED)) {\n+                    nextExecutorStatus.set(\"logging_finished\", JsonNodeFactory.instance.textNode(\"true\"));\n+                } else {", "originalCommit": "e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyODAxMw==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r371328013", "bodyText": "I fixed here.\nc8a0ac6", "author": "naritta", "createdAt": "2020-01-27T16:01:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MTMwMg=="}], "type": "inlineReview", "revised_code": {"commit": "c57f438030abfbb3c95c6fd4b960f9e291f96561", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 1de97828a2..dd0b816ea1 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -387,7 +388,7 @@ public class EcsCommandExecutor\n         else {\n             for (final OutputLogEvent logEvent : logEvents) {\n                 String log = logEvent.getMessage();\n-                if (log.contains(ECS_TASK_FINISHED)) {\n+                if (log.contains(ECS_END_OF_TASK_LOG_MARK)) {\n                     nextExecutorStatus.set(\"logging_finished\", JsonNodeFactory.instance.textNode(\"true\"));\n                 } else {\n                     log(log + \"\\n\", clog);\n", "next_change": {"commit": "b45c5fb60f7480a6ad6c21f9d71d90ed663ae23b", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex dd0b816ea1..22e2aa4f60 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -389,7 +389,7 @@ public class EcsCommandExecutor\n             for (final OutputLogEvent logEvent : logEvents) {\n                 String log = logEvent.getMessage();\n                 if (log.contains(ECS_END_OF_TASK_LOG_MARK)) {\n-                    nextExecutorStatus.set(\"logging_finished\", JsonNodeFactory.instance.textNode(\"true\"));\n+                    nextExecutorStatus.put(\"logging_finished_at\", Instant.now().getEpochSecond());\n                 } else {\n                     log(log + \"\\n\", clog);\n                 }\n", "next_change": {"commit": "c8a0ac626ea82458e90db004fddb885208c3ea77", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 22e2aa4f60..8246b20c52 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -390,7 +390,8 @@ public class EcsCommandExecutor\n                 String log = logEvent.getMessage();\n                 if (log.contains(ECS_END_OF_TASK_LOG_MARK)) {\n                     nextExecutorStatus.put(\"logging_finished_at\", Instant.now().getEpochSecond());\n-                } else {\n+                } \n+                else {\n                     log(log + \"\\n\", clog);\n                 }\n             }\n", "next_change": {"commit": "ec0e18ecc8a2133b5efbd17e26fddb6ccb21bb04", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 8246b20c52..c7aff454a0 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -390,7 +390,7 @@ public class EcsCommandExecutor\n                 String log = logEvent.getMessage();\n                 if (log.contains(ECS_END_OF_TASK_LOG_MARK)) {\n                     nextExecutorStatus.put(\"logging_finished_at\", Instant.now().getEpochSecond());\n-                } \n+                }\n                 else {\n                     log(log + \"\\n\", clog);\n                 }\n", "next_change": null}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MTU4Ng==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r370861586", "body": "It's better to use a self-explaining name:\r\n\r\n```suggestion\r\n    private static final String ECS_END_OF_TASK_LOG_MARK = \"ECS_TASK_FINISHED\";\r\n```", "bodyText": "It's better to use a self-explaining name:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static final String ECS_TASK_FINISHED = \"ECS_TASK_FINISHED\";\n          \n          \n            \n                private static final String ECS_END_OF_TASK_LOG_MARK = \"ECS_TASK_FINISHED\";", "bodyHTML": "<p dir=\"auto\">It's better to use a self-explaining name:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1 x x-first x-last\">ECS_TASK_FINISHED</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ECS_TASK_FINISHED<span class=\"pl-pds\">\"</span></span>;</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1 x x-first x-last\">ECS_END_OF_TASK_LOG_MARK</span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ECS_TASK_FINISHED<span class=\"pl-pds\">\"</span></span>;</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "frsyuki", "createdAt": "2020-01-24T22:00:20Z", "path": "digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java", "diffHunk": "@@ -66,6 +66,7 @@\n \n     private static final String ECS_COMMAND_EXECUTOR_SYSTEM_CONFIG_PREFIX = \"agent.command_executor.ecs.\";\n     private static final String DEFAULT_COMMAND_TASK_TTL = ECS_COMMAND_EXECUTOR_SYSTEM_CONFIG_PREFIX + \"default_command_task_ttl\";\n+    private static final String ECS_TASK_FINISHED = \"ECS_TASK_FINISHED\";", "originalCommit": "e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2NTI5MA==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r370865290", "bodyText": "I think the value (\"ECS_TASK_FINISHED\") needs to be something more unlike because log stream finishes unexpectedly if a script outputs this message.\nHow about using \"--RWNzQ29tbWFuZEV4ZWN1dG9y--\"  // base64(\"EcsCommandExecutor\") for example? Idea is partially taken from https://www.w3.org/Protocols/rfc1341/7_2_Multipart.html", "author": "frsyuki", "createdAt": "2020-01-24T22:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MTU4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyNzI0OA==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r371327248", "bodyText": "I changed key to ECS_END_OF_TASK_LOG_MARK  and value to \"--RWNzQ29tbWFuZEV4ZWN1dG9y--\" here.\nc57f438", "author": "naritta", "createdAt": "2020-01-27T16:00:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MTU4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "c57f438030abfbb3c95c6fd4b960f9e291f96561", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 1de97828a2..dd0b816ea1 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -66,7 +67,7 @@ public class EcsCommandExecutor\n \n     private static final String ECS_COMMAND_EXECUTOR_SYSTEM_CONFIG_PREFIX = \"agent.command_executor.ecs.\";\n     private static final String DEFAULT_COMMAND_TASK_TTL = ECS_COMMAND_EXECUTOR_SYSTEM_CONFIG_PREFIX + \"default_command_task_ttl\";\n-    private static final String ECS_TASK_FINISHED = \"ECS_TASK_FINISHED\";\n+    private static final String ECS_END_OF_TASK_LOG_MARK = \"--RWNzQ29tbWFuZEV4ZWN1dG9y--\"; // base64(\"EcsCommandExecutor\")\n \n     private final Config systemConfig;\n     private final EcsClientFactory ecsClientFactory;\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2Mjk3OA==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r370862978", "body": "I recommend to use `logging_finished_at` and set timestamp instead of `true` because we can know when waiting logging has finished without much overhead. It helps us to investigate problems if some happened.\r\n", "bodyText": "I recommend to use logging_finished_at and set timestamp instead of true because we can know when waiting logging has finished without much overhead. It helps us to investigate problems if some happened.", "bodyHTML": "<p dir=\"auto\">I recommend to use <code>logging_finished_at</code> and set timestamp instead of <code>true</code> because we can know when waiting logging has finished without much overhead. It helps us to investigate problems if some happened.</p>", "author": "frsyuki", "createdAt": "2020-01-24T22:04:26Z", "path": "digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java", "diffHunk": "@@ -361,7 +386,12 @@ ObjectNode fetchLogEvents(final EcsClient client,\n         }\n         else {\n             for (final OutputLogEvent logEvent : logEvents) {\n-                log(logEvent.getMessage() + \"\\n\", clog);\n+                String log = logEvent.getMessage();\n+                if (log.contains(ECS_TASK_FINISHED)) {\n+                    nextExecutorStatus.set(\"logging_finished\", JsonNodeFactory.instance.textNode(\"true\"));", "originalCommit": "e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyNzc0Mg==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r371327742", "bodyText": "Sorry I forgot to fix, and I fixed to use time here.\nb45c5fb", "author": "naritta", "createdAt": "2020-01-27T16:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2Mjk3OA=="}], "type": "inlineReview", "revised_code": {"commit": "c57f438030abfbb3c95c6fd4b960f9e291f96561", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 1de97828a2..dd0b816ea1 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -387,7 +388,7 @@ public class EcsCommandExecutor\n         else {\n             for (final OutputLogEvent logEvent : logEvents) {\n                 String log = logEvent.getMessage();\n-                if (log.contains(ECS_TASK_FINISHED)) {\n+                if (log.contains(ECS_END_OF_TASK_LOG_MARK)) {\n                     nextExecutorStatus.set(\"logging_finished\", JsonNodeFactory.instance.textNode(\"true\"));\n                 } else {\n                     log(log + \"\\n\", clog);\n", "next_change": {"commit": "b45c5fb60f7480a6ad6c21f9d71d90ed663ae23b", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex dd0b816ea1..22e2aa4f60 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -389,7 +389,7 @@ public class EcsCommandExecutor\n             for (final OutputLogEvent logEvent : logEvents) {\n                 String log = logEvent.getMessage();\n                 if (log.contains(ECS_END_OF_TASK_LOG_MARK)) {\n-                    nextExecutorStatus.set(\"logging_finished\", JsonNodeFactory.instance.textNode(\"true\"));\n+                    nextExecutorStatus.put(\"logging_finished_at\", Instant.now().getEpochSecond());\n                 } else {\n                     log(log + \"\\n\", clog);\n                 }\n", "next_change": {"commit": "c8a0ac626ea82458e90db004fddb885208c3ea77", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 22e2aa4f60..8246b20c52 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -390,7 +390,8 @@ public class EcsCommandExecutor\n                 String log = logEvent.getMessage();\n                 if (log.contains(ECS_END_OF_TASK_LOG_MARK)) {\n                     nextExecutorStatus.put(\"logging_finished_at\", Instant.now().getEpochSecond());\n-                } else {\n+                } \n+                else {\n                     log(log + \"\\n\", clog);\n                 }\n             }\n", "next_change": {"commit": "ec0e18ecc8a2133b5efbd17e26fddb6ccb21bb04", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 8246b20c52..c7aff454a0 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -390,7 +390,7 @@ public class EcsCommandExecutor\n                 String log = logEvent.getMessage();\n                 if (log.contains(ECS_END_OF_TASK_LOG_MARK)) {\n                     nextExecutorStatus.put(\"logging_finished_at\", Instant.now().getEpochSecond());\n-                } \n+                }\n                 else {\n                     log(log + \"\\n\", clog);\n                 }\n", "next_change": null}]}}]}}]}}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MzM5Nw==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r370863397", "body": "This needs escaping:\r\n```suggestion\r\n        bashArguments.add(s(\"echo \\\"%s\\\"\", ECS_TASK_FINISHED));\r\n```", "bodyText": "This needs escaping:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    bashArguments.add(s(\"echo %s\", ECS_TASK_FINISHED));\n          \n          \n            \n                    bashArguments.add(s(\"echo \\\"%s\\\"\", ECS_TASK_FINISHED));", "bodyHTML": "<p dir=\"auto\">This needs escaping:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        bashArguments<span class=\"pl-k\">.</span>add(s(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>echo <span class=\"x x-first x-last\">%s</span><span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">ECS_TASK_FINISHED</span>));</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        bashArguments<span class=\"pl-k\">.</span>add(s(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>echo <span class=\"pl-cce x x-first\">\\\"</span><span class=\"x\">%s</span><span class=\"pl-cce x x-last\">\\\"</span><span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">ECS_TASK_FINISHED</span>));</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "frsyuki", "createdAt": "2020-01-24T22:05:45Z", "path": "digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java", "diffHunk": "@@ -618,6 +648,7 @@ protected void setEcsContainerOverrideCommand(\n         }\n         bashArguments.add(s(\"tar -zcf %s  --exclude %s --exclude %s .digdag/tmp/\", outputProjectArchivePathName, relativeProjectArchivePath.toString(), outputProjectArchivePathName));\n         bashArguments.add(s(\"curl -s -X PUT -T %s -L \\\"%s\\\"\", outputProjectArchivePathName, outputProjectArchiveDirectUploadUrl));\n+        bashArguments.add(s(\"echo %s\", ECS_TASK_FINISHED));", "originalCommit": "e7a04fb48c8febdc8838a8533eba16fb474b0ec4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyODQ0Mw==", "url": "https://github.com/treasure-data/digdag/pull/1316#discussion_r371328443", "bodyText": "I added escape here.\nec0e18e", "author": "naritta", "createdAt": "2020-01-27T16:02:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg2MzM5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "c57f438030abfbb3c95c6fd4b960f9e291f96561", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex 1de97828a2..dd0b816ea1 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -648,7 +649,7 @@ public class EcsCommandExecutor\n         }\n         bashArguments.add(s(\"tar -zcf %s  --exclude %s --exclude %s .digdag/tmp/\", outputProjectArchivePathName, relativeProjectArchivePath.toString(), outputProjectArchivePathName));\n         bashArguments.add(s(\"curl -s -X PUT -T %s -L \\\"%s\\\"\", outputProjectArchivePathName, outputProjectArchiveDirectUploadUrl));\n-        bashArguments.add(s(\"echo %s\", ECS_TASK_FINISHED));\n+        bashArguments.add(s(\"echo %s\", ECS_END_OF_TASK_LOG_MARK));\n         bashArguments.add(s(\"exit $exit_code\"));\n \n         final List<String> bashCommand = ImmutableList.<String>builder()\n", "next_change": {"commit": "ec0e18ecc8a2133b5efbd17e26fddb6ccb21bb04", "changed_code": [{"header": "diff --git a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\nindex dd0b816ea1..c7aff454a0 100644\n--- a/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n+++ b/digdag-standards/src/main/java/io/digdag/standards/command/EcsCommandExecutor.java\n", "chunk": "@@ -649,7 +650,7 @@ public class EcsCommandExecutor\n         }\n         bashArguments.add(s(\"tar -zcf %s  --exclude %s --exclude %s .digdag/tmp/\", outputProjectArchivePathName, relativeProjectArchivePath.toString(), outputProjectArchivePathName));\n         bashArguments.add(s(\"curl -s -X PUT -T %s -L \\\"%s\\\"\", outputProjectArchivePathName, outputProjectArchiveDirectUploadUrl));\n-        bashArguments.add(s(\"echo %s\", ECS_END_OF_TASK_LOG_MARK));\n+        bashArguments.add(s(\"echo \\\"%s\\\"\", ECS_END_OF_TASK_LOG_MARK));\n         bashArguments.add(s(\"exit $exit_code\"));\n \n         final List<String> bashCommand = ImmutableList.<String>builder()\n", "next_change": null}]}}]}}, {"oid": "c57f438030abfbb3c95c6fd4b960f9e291f96561", "url": "https://github.com/treasure-data/digdag/commit/c57f438030abfbb3c95c6fd4b960f9e291f96561", "message": "Fix task finished marker name and value", "committedDate": "2020-01-27T05:23:50Z", "type": "commit"}, {"oid": "b45c5fb60f7480a6ad6c21f9d71d90ed663ae23b", "url": "https://github.com/treasure-data/digdag/commit/b45c5fb60f7480a6ad6c21f9d71d90ed663ae23b", "message": "Fix logging finished status to use time for investigation", "committedDate": "2020-01-27T05:39:10Z", "type": "commit"}, {"oid": "c8a0ac626ea82458e90db004fddb885208c3ea77", "url": "https://github.com/treasure-data/digdag/commit/c8a0ac626ea82458e90db004fddb885208c3ea77", "message": "Fix code indent for else", "committedDate": "2020-01-27T05:40:07Z", "type": "commit"}, {"oid": "ec0e18ecc8a2133b5efbd17e26fddb6ccb21bb04", "url": "https://github.com/treasure-data/digdag/commit/ec0e18ecc8a2133b5efbd17e26fddb6ccb21bb04", "message": "Fix to escape", "committedDate": "2020-01-27T05:42:46Z", "type": "commit"}, {"oid": "3c6c3dc7afe0e488d1767018c0894fdb89a7b03a", "url": "https://github.com/treasure-data/digdag/commit/3c6c3dc7afe0e488d1767018c0894fdb89a7b03a", "message": "Move status_code setting right after task is finished", "committedDate": "2020-01-27T06:00:43Z", "type": "commit"}, {"oid": "d8de229d1475895705fd39658cc4d4fcccb129e6", "url": "https://github.com/treasure-data/digdag/commit/d8de229d1475895705fd39658cc4d4fcccb129e6", "message": "Refactor", "committedDate": "2020-01-27T16:33:31Z", "type": "commit"}, {"oid": "d8de229d1475895705fd39658cc4d4fcccb129e6", "url": "https://github.com/treasure-data/digdag/commit/d8de229d1475895705fd39658cc4d4fcccb129e6", "message": "Refactor", "committedDate": "2020-01-27T16:33:31Z", "type": "forcePushed"}]}