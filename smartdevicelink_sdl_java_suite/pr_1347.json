{"pr_number": 1347, "pr_title": "Bugfix/issue_1343 foreground permissions exception", "pr_author": "RHenigan", "pr_createdAt": "2020-05-13T14:53:38Z", "pr_url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347", "timeline": [{"oid": "efa9416df313d372546b0440815d9983171b33d2", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/efa9416df313d372546b0440815d9983171b33d2", "message": "Check permissions before trying to startForeground", "committedDate": "2020-05-13T14:42:05Z", "type": "commit"}, {"oid": "3584f04e8d85ebacb9c7012ea22abf642c828d46", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/3584f04e8d85ebacb9c7012ea22abf642c828d46", "message": "Remove output.json file", "committedDate": "2020-05-13T15:00:51Z", "type": "commit"}, {"oid": "5b60db1cbfa0a8eb6e7e27927bd55bf610e4a546", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/5b60db1cbfa0a8eb6e7e27927bd55bf610e4a546", "message": "Establish safeStartForeground in AndroidTools", "committedDate": "2020-05-13T19:35:37Z", "type": "commit"}, {"oid": "919bf5923aa1550148620803e2006d357a3710de", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/919bf5923aa1550148620803e2006d357a3710de", "message": "Implement AndroidTools.safeStartForegroundService", "committedDate": "2020-05-13T19:51:03Z", "type": "commit"}, {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/2607bdd8e6aae1043512429572ae61461232c7e1", "message": "Bring safestart back to SdlRouterService", "committedDate": "2020-05-14T17:11:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4MDM1Nw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426780357", "body": "unused import ", "bodyText": "unused import", "bodyHTML": "<p dir=\"auto\">unused import</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T17:19:57Z", "path": "android/hello_sdl_android/src/main/java/com/sdl/hellosdlandroid/SdlReceiver.java", "diffHunk": "@@ -1,12 +1,15 @@\n package com.sdl.hellosdlandroid;\n \n+import android.Manifest;\n import android.content.Context;\n import android.content.Intent;\n import android.os.Build;\n import android.util.Log;\n \n import com.smartdevicelink.transport.SdlBroadcastReceiver;\n import com.smartdevicelink.transport.SdlRouterService;\n+import com.smartdevicelink.util.AndroidTools;\n+import com.smartdevicelink.util.DebugTool;", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwMjYxMw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426902613", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-05-18T21:27:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4MDM1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NTY4OA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426785688", "body": "Can we remove that change if it only changes the location of the method in the same file? to make it easier to track the actual changes.", "bodyText": "Can we remove that change if it only changes the location of the method in the same file? to make it easier to track the actual changes.", "bodyHTML": "<p dir=\"auto\">Can we remove that change if it only changes the location of the method in the same file? to make it easier to track the actual changes.</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T17:29:34Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/transport/SdlRouterService.java", "diffHunk": "@@ -1484,37 +1484,14 @@ private void enterForeground(String content, long chronometerLength, boolean ong\n \t\t\t\t}\n \t\t\t\treturn;\n \t\t\t}\n-\t\t\tsafeStartForeground(FOREGROUND_SERVICE_ID, notification);\n+\n+\t\t\tsafeStartForeground(FOREGROUND_SERVICE_ID, builder.build());\n \t\t\tisForeground = true;\n \n \t\t}\n  \n     }\n \n-\t/**", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwMzI1OA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426903258", "bodyText": "Moved back, I had put it back to the wrong place after I had originally gotten rid of it.", "author": "RHenigan", "createdAt": "2020-05-18T21:29:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NTY4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4ODI1Mg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426788252", "body": "Is there a reason for changing the param from `notification` to `builder.build()`? as the notification will already be built at this point.", "bodyText": "Is there a reason for changing the param from notification to builder.build()? as the notification will already be built at this point.", "bodyHTML": "<p dir=\"auto\">Is there a reason for changing the param from <code>notification</code> to <code>builder.build()</code>? as the notification will already be built at this point.</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T17:34:19Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/transport/SdlRouterService.java", "diffHunk": "@@ -1484,37 +1484,14 @@ private void enterForeground(String content, long chronometerLength, boolean ong\n \t\t\t\t}\n \t\t\t\treturn;\n \t\t\t}\n-\t\t\tsafeStartForeground(FOREGROUND_SERVICE_ID, notification);\n+\n+\t\t\tsafeStartForeground(FOREGROUND_SERVICE_ID, builder.build());", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwMzQxNA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426903414", "bodyText": "This was a mistake, thanks for catching it", "author": "RHenigan", "createdAt": "2020-05-18T21:29:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4ODI1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzEwNg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426793106", "body": "unused import ", "bodyText": "unused import", "bodyHTML": "<p dir=\"auto\">unused import</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T17:43:39Z", "path": "android/hello_sdl_android/src/main/java/com/sdl/hellosdlandroid/SdlService.java", "diffHunk": "@@ -6,6 +6,7 @@\n import android.app.NotificationManager;\n import android.app.Service;\n import android.content.Context;\n+import android.content.ContextWrapper;", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwMzQ2NQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426903465", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-05-18T21:29:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5NDU0OQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426794549", "body": "unused import ", "bodyText": "unused import", "bodyHTML": "<p dir=\"auto\">unused import</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T17:46:14Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -44,6 +47,8 @@\n import android.graphics.Bitmap;\n import android.graphics.BitmapFactory;\n import android.os.BatteryManager;\n+import android.os.Build;\n+import android.support.v4.app.NotificationCompat;", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwMzU2OA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426903568", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-05-18T21:29:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5NDU0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgwNDY1MQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426804651", "body": "unused import", "bodyText": "unused import", "bodyHTML": "<p dir=\"auto\">unused import</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T18:04:56Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -57,7 +62,12 @@\n import java.util.HashMap;\n import java.util.List;\n \n+import static com.smartdevicelink.transport.TransportConstants.SDL_NOTIFICATION_CHANNEL_ID;", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNDA0NQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426904045", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-05-18T21:30:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgwNDY1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgwNDc0Ng==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426804746", "body": "unused variable ", "bodyText": "unused variable", "bodyHTML": "<p dir=\"auto\">unused variable</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T18:05:06Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -57,7 +62,12 @@\n import java.util.HashMap;\n import java.util.List;\n \n+import static com.smartdevicelink.transport.TransportConstants.SDL_NOTIFICATION_CHANNEL_ID;\n+\n public class AndroidTools {\n+\n+\tpublic static final String SDL_NOTIFICATION_CHANNEL_ID \t\t\t\t\t\t= \"sdl_notification_channel\";", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwMzYxMQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426903611", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-05-18T21:29:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgwNDc0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxNzk0Ng==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426817946", "body": "We should reuse the static function\r\n```suggestion\r\n\t\t\tAndroidTools.safeStartForegroundService(context, bindingIntent);\r\n```", "bodyText": "We should reuse the static function\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tint permission = context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n          \n          \n            \n            \t\t\tif (permission != -1) {\n          \n          \n            \n            \t\t\t\tAndroidTools.safeStartForegroundService(context, bindingIntent);\n          \n          \n            \n            \t\t\t} else {\n          \n          \n            \n            \t\t\t\tDebugTool.logError(\"Foreground Permissions Not Enabled: will not start foreground permissions\");\n          \n          \n            \n            \t\t\t}\n          \n          \n            \n            \t\t\tAndroidTools.safeStartForegroundService(context, bindingIntent);", "bodyHTML": "<p dir=\"auto\">We should reuse the static function</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t<span class=\"pl-k\">int</span> permission <span class=\"pl-k\">=</span> context<span class=\"pl-k\">.</span>checkPermission(<span class=\"pl-smi\">Manifest</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">permission<span class=\"pl-k\">.</span>FOREGROUND_SERVICE</span>, <span class=\"pl-smi\">android.os<span class=\"pl-k\">.</span>Process</span><span class=\"pl-k\">.</span>myPid(), <span class=\"pl-smi\">android.os<span class=\"pl-k\">.</span>Process</span><span class=\"pl-k\">.</span>myUid());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t<span class=\"pl-k\">if</span> (permission <span class=\"pl-k\">!=</span> <span class=\"pl-k\">-</span><span class=\"pl-c1\">1</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t\t<span class=\"pl-smi\">AndroidTools</span><span class=\"pl-k\">.</span>safeStartForegroundService(context, bindingIntent);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t} <span class=\"pl-k\">else</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t\t<span class=\"pl-smi\">DebugTool</span><span class=\"pl-k\">.</span>logError(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Foreground Permissions Not Enabled: will not start foreground permissions<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t}</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t\t<span class=\"pl-smi\">AndroidTools</span><span class=\"pl-k\">.</span>safeStartForegroundService(context, bindingIntent);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bilal-alsharifi", "createdAt": "2020-05-18T18:30:53Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/transport/SdlRouterStatusProvider.java", "diffHunk": "@@ -134,8 +136,12 @@ private boolean bindToService(){\n \t\t}else {\n \t\t\tbindingIntent.putExtra(FOREGROUND_EXTRA, true);\n \t\t\tSdlBroadcastReceiver.setForegroundExceptionHandler(); //Prevent ANR in case the OS takes too long to start the service\n-\t\t\tcontext.startForegroundService(bindingIntent);\n-\n+\t\t\tint permission = context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n+\t\t\tif (permission != -1) {\n+\t\t\t\tAndroidTools.safeStartForegroundService(context, bindingIntent);\n+\t\t\t} else {\n+\t\t\t\tDebugTool.logError(\"Foreground Permissions Not Enabled: will not start foreground permissions\");\n+\t\t\t}", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNDI3OQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426904279", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-05-18T21:31:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxNzk0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxOTEyNQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426819125", "body": "This function is not needed and should be removed as it already exists in the RS class. Adding new public APIs should always be avoided when possible.", "bodyText": "This function is not needed and should be removed as it already exists in the RS class. Adding new public APIs should always be avoided when possible.", "bodyHTML": "<p dir=\"auto\">This function is not needed and should be removed as it already exists in the RS class. Adding new public APIs should always be avoided when possible.</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T18:33:16Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -191,4 +201,60 @@ public static Bitmap downloadImage(String urlStr) throws IOException {\n \t\tbis.close();\n \t\treturn result;\n \t}\n+\n+\t/**\n+\t * This is a wrapper around the startForeground method. In the case that the notification\n+\t * is null, or a notification was unable to be created we will still attempt to call the\n+\t * startForeground method in hopes that Android will not throw the System Exception. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForeground.\n+\t * @param service a service instance\n+\t * @param context a context instance\n+\t * @param id notification channel id\n+\t * @param notification the notification to display when in the foreground\n+\t */\n+\tpublic static void safeStartForeground(Service service, Context context, int id, Notification notification){", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNDM3MQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426904371", "bodyText": "removed", "author": "RHenigan", "createdAt": "2020-05-18T21:31:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxOTEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNDY3NA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426904674", "bodyText": "to investigate if this logic is needed in SdlRouterService implementation", "author": "RHenigan", "createdAt": "2020-05-18T21:32:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxOTEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzMzOTkyNQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r427339925", "bodyText": "According to android documentation startForeground startForeground will not actually put the service in the started state, startService or startForegroundService needs to be called first which will verify the permissions", "author": "RHenigan", "createdAt": "2020-05-19T14:20:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxOTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyMDQyMQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426820421", "body": "This change should be reverted back as the flow will not reach this phase if the permission is not added && the Android version is P or above. Also, the AndroidTools import should be removed.", "bodyText": "This change should be reverted back as the flow will not reach this phase if the permission is not added && the Android version is P or above. Also, the AndroidTools import should be removed.", "bodyHTML": "<p dir=\"auto\">This change should be reverted back as the flow will not reach this phase if the permission is not added &amp;&amp; the Android version is P or above. Also, the AndroidTools import should be removed.</p>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T18:35:57Z", "path": "android/hello_sdl_android/src/main/java/com/sdl/hellosdlandroid/SdlService.java", "diffHunk": "@@ -105,7 +107,11 @@ public void enterForeground() {\n \t\t\t\t\t\t.setContentTitle(\"Connected through SDL\")\n \t\t\t\t\t\t.setSmallIcon(R.drawable.ic_sdl)\n \t\t\t\t\t\t.build();\n-\t\t\t\tstartForeground(FOREGROUND_SERVICE_ID, serviceNotification);\n+\t\t\t\ttry {", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNDkwNg==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426904906", "bodyText": "updated", "author": "RHenigan", "createdAt": "2020-05-18T21:32:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyMDQyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyOTEyMw==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426829123", "body": "This needs some modifications:\r\n- It should check the permission when Android >= P (currently it checks if Android < P)\r\n- It should still throw the exception in debug mode to let developers know that they are missing the permission \r\n-  Add `RequiresApi` annotation as the method should only be used for Android O and above\r\n```\r\n@RequiresApi(api = Build.VERSION_CODES.O)\r\npublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\r\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\r\n        boolean inDebugMode = (0 != (context.getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE));\r\n        boolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\r\n        if (inDebugMode || permissionGranted) {\r\n            return context.startForegroundService(intent);\r\n        } else {\r\n            DebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\r\n        }\r\n    } else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\r\n        return context.startForegroundService(intent);\r\n    } else if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {\r\n        DebugTool.logError(\"startForegroundService() call requires Android Oreo or newer\");\r\n    }\r\n    return null;\r\n}\r\n```", "bodyText": "This needs some modifications:\n\nIt should check the permission when Android >= P (currently it checks if Android < P)\nIt should still throw the exception in debug mode to let developers know that they are missing the permission\nAdd RequiresApi annotation as the method should only be used for Android O and above\n\n@RequiresApi(api = Build.VERSION_CODES.O)\npublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n        boolean inDebugMode = (0 != (context.getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE));\n        boolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n        if (inDebugMode || permissionGranted) {\n            return context.startForegroundService(intent);\n        } else {\n            DebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n        }\n    } else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\n        return context.startForegroundService(intent);\n    } else if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {\n        DebugTool.logError(\"startForegroundService() call requires Android Oreo or newer\");\n    }\n    return null;\n}", "bodyHTML": "<p dir=\"auto\">This needs some modifications:</p>\n<ul dir=\"auto\">\n<li>It should check the permission when Android &gt;= P (currently it checks if Android &lt; P)</li>\n<li>It should still throw the exception in debug mode to let developers know that they are missing the permission</li>\n<li>Add <code>RequiresApi</code> annotation as the method should only be used for Android O and above</li>\n</ul>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@RequiresApi(api = Build.VERSION_CODES.O)\npublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\n    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) {\n        boolean inDebugMode = (0 != (context.getApplicationInfo().flags &amp; ApplicationInfo.FLAG_DEBUGGABLE));\n        boolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n        if (inDebugMode || permissionGranted) {\n            return context.startForegroundService(intent);\n        } else {\n            DebugTool.logError(&quot;App missing FOREGROUND_SERVICE Permissions&quot;);\n        }\n    } else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\n        return context.startForegroundService(intent);\n    } else if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) {\n        DebugTool.logError(&quot;startForegroundService() call requires Android Oreo or newer&quot;);\n    }\n    return null;\n}\"><pre><code>@RequiresApi(api = Build.VERSION_CODES.O)\npublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\n    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.P) {\n        boolean inDebugMode = (0 != (context.getApplicationInfo().flags &amp; ApplicationInfo.FLAG_DEBUGGABLE));\n        boolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n        if (inDebugMode || permissionGranted) {\n            return context.startForegroundService(intent);\n        } else {\n            DebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n        }\n    } else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\n        return context.startForegroundService(intent);\n    } else if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) {\n        DebugTool.logError(\"startForegroundService() call requires Android Oreo or newer\");\n    }\n    return null;\n}\n</code></pre></div>", "author": "bilal-alsharifi", "createdAt": "2020-05-18T18:53:01Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -191,4 +201,60 @@ public static Bitmap downloadImage(String urlStr) throws IOException {\n \t\tbis.close();\n \t\treturn result;\n \t}\n+\n+\t/**\n+\t * This is a wrapper around the startForeground method. In the case that the notification\n+\t * is null, or a notification was unable to be created we will still attempt to call the\n+\t * startForeground method in hopes that Android will not throw the System Exception. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForeground.\n+\t * @param service a service instance\n+\t * @param context a context instance\n+\t * @param id notification channel id\n+\t * @param notification the notification to display when in the foreground\n+\t */\n+\tpublic static void safeStartForeground(Service service, Context context, int id, Notification notification){\n+\t\tint permission = PackageManager.PERMISSION_GRANTED;\n+\t\tif (Build.VERSION.SDK_INT < Build.VERSION_CODES.P) {\n+\t\t\tpermission = context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n+\t\t}\n+\t\ttry{\n+\t\t\tif (permission != PackageManager.PERMISSION_DENIED) {\n+\t\t\t\tservice.startForeground(id, notification);\n+\t\t\t\tDebugTool.logInfo(\"Entered the foreground - \" + System.currentTimeMillis());\n+\t\t\t} else {\n+\t\t\t\tDebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n+\t\t\t}\n+\t\t}catch (Exception e){\n+\t\t\tDebugTool.logError(\"Unable to start service in foreground\", e);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * This is a wrapper around the startForegroundService method. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForegroundService.\n+\t * @param context a context instance\n+\t * @param intent the foreground service intent\n+\t * @return a ComponentName, an identifier for the started service, will return null is service\n+\t * was unable to start\n+\t */\n+\tpublic static ComponentName safeStartForegroundService(Context context, Intent intent){", "originalCommit": "2607bdd8e6aae1043512429572ae61461232c7e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkwNTAzMQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426905031", "bodyText": "Changes made", "author": "RHenigan", "createdAt": "2020-05-18T21:33:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyOTEyMw=="}], "type": "inlineReview"}, {"oid": "527a7c86c4b0227dce18b0018f89d3e9049e9d90", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/527a7c86c4b0227dce18b0018f89d3e9049e9d90", "message": "Feedback fixes", "committedDate": "2020-05-18T21:15:13Z", "type": "commit"}, {"oid": "d8d3bfc7559e123048e532bbe937fcd0518a22e2", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/d8d3bfc7559e123048e532bbe937fcd0518a22e2", "message": "safeStartforeground does not need permission check", "committedDate": "2020-05-19T14:10:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ4OTI4NA==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r427489284", "body": "I have just learned that there are two versions of Android O (`VERSION_CODES.O`= `26` & `VERSION_CODES.O_MR1` = `27`) and they both don't require the foreground permission. So I updated the code accordingly \r\n\r\n```suggestion\r\n\t\t} else if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\r\n\t\t\treturn context.startForegroundService(intent);\r\n\t\t}\r\n```", "bodyText": "I have just learned that there are two versions of Android O (VERSION_CODES.O= 26 & VERSION_CODES.O_MR1 = 27) and they both don't require the foreground permission. So I updated the code accordingly\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t} else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\n          \n          \n            \n            \t\t\treturn context.startForegroundService(intent);\n          \n          \n            \n            \t\t} else if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {\n          \n          \n            \n            \t\t\tDebugTool.logError(\"startForegroundService() call requires Android Oreo or newer\");\n          \n          \n            \n            \t\t}\n          \n          \n            \n            \t\t} else if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n          \n          \n            \n            \t\t\treturn context.startForegroundService(intent);\n          \n          \n            \n            \t\t}", "bodyHTML": "<p dir=\"auto\">I have just learned that there are two versions of Android O (<code>VERSION_CODES.O</code>= <code>26</code> &amp; <code>VERSION_CODES.O_MR1</code> = <code>27</code>) and they both don't require the foreground permission. So I updated the code accordingly</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"221\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t} <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">Build</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>VERSION<span class=\"pl-k\">.</span>SDK_INT</span> <span class=\"pl-k\">==</span> <span class=\"pl-smi\">Build</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>VERSION_CODES</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">O</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"222\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t<span class=\"pl-k\">return</span> context<span class=\"pl-k\">.</span>startForegroundService(intent);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"223\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t} <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">Build</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>VERSION<span class=\"pl-k\">.</span>SDK_INT</span> <span class=\"pl-k\">&lt;</span> <span class=\"pl-smi\">Build</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>VERSION_CODES</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">O</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"224\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t<span class=\"pl-smi\">DebugTool</span><span class=\"pl-k\">.</span>logError(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>startForegroundService() call requires Android Oreo or newer<span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"225\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t}</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"221\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t} <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">Build</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>VERSION<span class=\"pl-k\">.</span>SDK_INT</span> <span class=\"pl-k\">&gt;=</span> <span class=\"pl-smi\">Build</span><span class=\"pl-c1\"><span class=\"pl-k\">.</span>VERSION_CODES</span><span class=\"pl-k\">.</span><span class=\"pl-smi\">O</span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"222\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t\t<span class=\"pl-k\">return</span> context<span class=\"pl-k\">.</span>startForegroundService(intent);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"223\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t}</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bilal-alsharifi", "createdAt": "2020-05-19T17:50:30Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -191,4 +196,31 @@ public static Bitmap downloadImage(String urlStr) throws IOException {\n \t\tbis.close();\n \t\treturn result;\n \t}\n+\n+\t/**\n+\t * This is a wrapper around the startForegroundService method. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForegroundService.\n+\t * @param context a context instance\n+\t * @param intent the foreground service intent\n+\t * @return a ComponentName, an identifier for the started service, will return null is service\n+\t * was unable to start\n+\t */\n+\t@RequiresApi(api = Build.VERSION_CODES.O)\n+\tpublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\n+\t\tif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n+\t\t\tboolean inDebugMode = (0 != (context.getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE));\n+\t\t\tboolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n+\t\t\tif (inDebugMode || permissionGranted) {\n+\t\t\t\treturn context.startForegroundService(intent);\n+\t\t\t} else {\n+\t\t\t\tDebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n+\t\t\t}\n+\t\t} else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\n+\t\t\treturn context.startForegroundService(intent);\n+\t\t} else if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {\n+\t\t\tDebugTool.logError(\"startForegroundService() call requires Android Oreo or newer\");\n+\t\t}", "originalCommit": "d8d3bfc7559e123048e532bbe937fcd0518a22e2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a88586083a9fdc41038ec0c0b86202331621e43f", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a88586083a9fdc41038ec0c0b86202331621e43f", "message": "Update android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java\n\nCo-authored-by: Bilal Alsharifi <599206+bilal-alsharifi@users.noreply.github.com>", "committedDate": "2020-05-19T17:58:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5OTc1NQ==", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r427499755", "body": "```suggestion\r\n\t\t\t\tDebugTool.logError(\"App is missing FOREGROUND_SERVICE Permission. Sdl will not work.\");\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tDebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n          \n          \n            \n            \t\t\t\tDebugTool.logError(\"App is missing FOREGROUND_SERVICE Permission. Sdl will not work.\");", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t\t\t<span class=\"pl-smi\">DebugTool</span><span class=\"pl-k\">.</span>logError(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>App missing FOREGROUND_SERVICE <span class=\"x x-first x-last\">Permissions</span><span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t\t\t<span class=\"pl-smi\">DebugTool</span><span class=\"pl-k\">.</span>logError(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>App <span class=\"x x-first x-last\">is </span>missing FOREGROUND_SERVICE <span class=\"x x-first x-last\">Permission. Sdl will not work.</span><span class=\"pl-pds\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "bilal-alsharifi", "createdAt": "2020-05-19T18:07:11Z", "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -191,4 +196,29 @@ public static Bitmap downloadImage(String urlStr) throws IOException {\n \t\tbis.close();\n \t\treturn result;\n \t}\n+\n+\t/**\n+\t * This is a wrapper around the startForegroundService method. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForegroundService.\n+\t * @param context a context instance\n+\t * @param intent the foreground service intent\n+\t * @return a ComponentName, an identifier for the started service, will return null is service\n+\t * was unable to start\n+\t */\n+\t@RequiresApi(api = Build.VERSION_CODES.O)\n+\tpublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\n+\t\tif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n+\t\t\tboolean inDebugMode = (0 != (context.getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE));\n+\t\t\tboolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n+\t\t\tif (inDebugMode || permissionGranted) {\n+\t\t\t\treturn context.startForegroundService(intent);\n+\t\t\t} else {\n+\t\t\t\tDebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");", "originalCommit": "a88586083a9fdc41038ec0c0b86202331621e43f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6274f16950bcc52e234083d70ac00c804c4366ae", "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/6274f16950bcc52e234083d70ac00c804c4366ae", "message": "Update android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java\n\nCo-authored-by: Bilal Alsharifi <599206+bilal-alsharifi@users.noreply.github.com>", "committedDate": "2020-05-19T18:08:55Z", "type": "commit"}]}