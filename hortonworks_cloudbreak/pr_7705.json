{"pr_number": 7705, "pr_title": "CB-6267 Add AWS Spot parameters to Environment creation request", "pr_author": "Bajzathd", "pr_createdAt": "2020-04-01T13:06:57Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7705", "timeline": [{"oid": "f28e7116a431fa7585eb8d29ac58b5bf622c341f", "url": "https://github.com/hortonworks/cloudbreak/commit/f28e7116a431fa7585eb8d29ac58b5bf622c341f", "message": "CB-6267 Add AWS Spot parameters to Environment creation request", "committedDate": "2020-04-01T13:08:34Z", "type": "forcePushed"}, {"oid": "1219713eef6f0745074e011608a775181a2d66f4", "url": "https://github.com/hortonworks/cloudbreak/commit/1219713eef6f0745074e011608a775181a2d66f4", "message": "CB-6267 Add AWS Spot parameters to Environment creation request", "committedDate": "2020-04-01T13:09:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNzQ1NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401607454", "body": "FreeIpa", "bodyText": "FreeIpa", "bodyHTML": "<p dir=\"auto\">FreeIpa</p>", "author": "doktoric", "createdAt": "2020-04-01T13:18:32Z", "path": "environment-api/src/main/java/com/sequenceiq/environment/api/doc/environment/EnvironmentModelDescription.java", "diffHunk": "@@ -72,6 +72,10 @@\n     public static final String PARENT_ENVIRONMENT_NAME = \"Parent environment name\";\n     public static final String PARENT_ENVIRONMENT_CLOUD_PLATFORM = \"Parent environment cloud platform\";\n \n+    public static final String FREEIPA_AWS_PARAMETERS = \"Aws specific FreeIpa parameters\";\n+    public static final String FREEIPA_AWS_SPOT_PARAMETERS = \"Aws spot instance related parameters.\";\n+    public static final String FREEIPA_AWS_SPOT_PERCENTAGE = \"Percentage of spot instances launched in freeipa instance group\";", "originalCommit": "1219713eef6f0745074e011608a775181a2d66f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwODU2NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401608565", "body": "can we use the same structure here ? \r\n", "bodyText": "can we use the same structure here ?", "bodyHTML": "<p dir=\"auto\">can we use the same structure here ?</p>", "author": "doktoric", "createdAt": "2020-04-01T13:20:06Z", "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/response/FreeIpaResponse.java", "diffHunk": "@@ -11,6 +11,9 @@\n     @ApiModelProperty(EnvironmentModelDescription.FREEIPA_INSTANCE_COUNT_BY_GROUP)\n     private Integer instanceCountByGroup = 1;\n \n+    @ApiModelProperty(EnvironmentModelDescription.FREEIPA_AWS_SPOT_PERCENTAGE)\n+    private Integer spotPercentage;", "originalCommit": "1219713eef6f0745074e011608a775181a2d66f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwODY5MA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401608690", "bodyText": "like aws.spot.percentage?", "author": "doktoric", "createdAt": "2020-04-01T13:20:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwODU2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYxMTkxMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401611913", "body": "I used plain integer, not the Integer class", "bodyText": "I used plain integer, not the Integer class", "bodyHTML": "<p dir=\"auto\">I used plain integer, not the Integer class</p>", "author": "bergerdenes", "createdAt": "2020-04-01T13:24:44Z", "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/request/aws/AttachedFreeIpaRequestAwsSpotParameters.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.sequenceiq.environment.api.v1.environment.model.request.aws;\n+\n+import javax.validation.constraints.Digits;\n+import javax.validation.constraints.Max;\n+import javax.validation.constraints.Min;\n+\n+import com.sequenceiq.environment.api.doc.environment.EnvironmentModelDescription;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel(value = \"AttachedFreeIpaRequestAwsSpotParameters\")\n+public class AttachedFreeIpaRequestAwsSpotParameters {\n+\n+    @ApiModelProperty(EnvironmentModelDescription.FREEIPA_AWS_SPOT_PERCENTAGE)\n+    @Min(value = 0, message = \"Spot percentage must be between 0 and 100 percent\")\n+    @Max(value = 100, message = \"Spot percentage must be between 0 and 100 percent\")\n+    @Digits(fraction = 0, integer = 3, message = \"Spot percentage has to be a number\")\n+    private Integer percentage;", "originalCommit": "1219713eef6f0745074e011608a775181a2d66f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "baa71f2df86a1b69307ef50295a9edb971db790d", "url": "https://github.com/hortonworks/cloudbreak/commit/baa71f2df86a1b69307ef50295a9edb971db790d", "message": "CB-6267 Add AWS Spot parameters to Environment creation request", "committedDate": "2020-04-01T13:47:46Z", "type": "forcePushed"}, {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7", "url": "https://github.com/hortonworks/cloudbreak/commit/8501bab305894b49e6204053c9fdc6587c97b9a7", "message": "CB-6267 Redesign aws spot parameters in env creation request", "committedDate": "2020-04-02T12:35:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI5NDc4Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402294783", "body": "please add @Valid to `private AttachedFreeIpaRequest freeIpa;` line 72 the EnvironmentRequest class", "bodyText": "please add @Valid to private AttachedFreeIpaRequest freeIpa; line 72 the EnvironmentRequest class", "bodyHTML": "<p dir=\"auto\">please add <a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/Valid/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Valid\">@Valid</a> to <code>private AttachedFreeIpaRequest freeIpa;</code> line 72 the EnvironmentRequest class</p>", "author": "bergerdenes", "createdAt": "2020-04-02T13:02:30Z", "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/request/AttachedFreeIpaRequest.java", "diffHunk": "@@ -17,6 +19,10 @@\n     @ApiModelProperty(value = EnvironmentModelDescription.FREEIPA_INSTANCE_COUNT_BY_GROUP)\n     private Integer instanceCountByGroup;\n \n+    @Valid", "originalCommit": "8501bab305894b49e6204053c9fdc6587c97b9a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwNjE0OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402306148", "body": "FreeIpaCreationAwsSpotParametersDto does not define toString()", "bodyText": "FreeIpaCreationAwsSpotParametersDto does not define toString()", "bodyHTML": "<p dir=\"auto\">FreeIpaCreationAwsSpotParametersDto does not define toString()</p>", "author": "bergerdenes", "createdAt": "2020-04-02T13:20:09Z", "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/FreeIpaCreationDto.java", "diffHunk": "@@ -25,11 +27,16 @@ public int getInstanceCountByGroup() {\n         return instanceCountByGroup;\n     }\n \n+    public FreeIpaCreationAwsParametersDto getAws() {\n+        return aws;\n+    }\n+\n     @Override\n     public String toString() {\n         return \"FreeIpaCreationDto{\" +\n             \"create='\" + create + '\\'' +\n             \"instanceCountByGroup='\" + instanceCountByGroup + '\\'' +\n+            \"aws='\" + aws + '\\'' +", "originalCommit": "8501bab305894b49e6204053c9fdc6587c97b9a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMzkwNQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402313905", "body": "minor:  freeipa in one word", "bodyText": "minor:  freeipa in one word", "bodyHTML": "<p dir=\"auto\">minor:  freeipa in one word</p>", "author": "bergerdenes", "createdAt": "2020-04-02T13:30:58Z", "path": "environment/src/main/java/com/sequenceiq/environment/parameters/dao/domain/AwsParameters.java", "diffHunk": "@@ -17,6 +17,9 @@\n     @Enumerated(EnumType.STRING)\n     private S3GuardTableCreation s3guardTableCreation;\n \n+    @Column(name = \"free_ipa_spot_percentage\")", "originalCommit": "8501bab305894b49e6204053c9fdc6587c97b9a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "35c5047cc9ea1330b7473316a8a94df16beaaa61", "url": "https://github.com/hortonworks/cloudbreak/commit/35c5047cc9ea1330b7473316a8a94df16beaaa61", "message": "CB-6267 Add AWS Spot parameters to Environment creation request", "committedDate": "2020-04-02T14:41:09Z", "type": "commit"}, {"oid": "bda8323c4f88751109471e6982ad75a76d907a42", "url": "https://github.com/hortonworks/cloudbreak/commit/bda8323c4f88751109471e6982ad75a76d907a42", "message": "CB-6267 Redesign aws spot parameters in env creation request", "committedDate": "2020-04-02T14:41:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMzQ0NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402423444", "body": "can you please add 2 more test ? \r\nArguments.of(2, 100, true)\r\nArguments.of(2, 0, true)", "bodyText": "can you please add 2 more test ?\nArguments.of(2, 100, true)\nArguments.of(2, 0, true)", "bodyHTML": "<p dir=\"auto\">can you please add 2 more test ?<br>\nArguments.of(2, 100, true)<br>\nArguments.of(2, 0, true)</p>", "author": "doktoric", "createdAt": "2020-04-02T15:54:33Z", "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/EnvironmentValidatorServiceTest.java", "diffHunk": "@@ -324,4 +331,30 @@ private Environment aValidEnvirontmentWithParent() {\n \n         return environment;\n     }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"freeIpaCreationArguments\")\n+    void shouldValidateFreeIpaCreation(int instanceCountByGroup, int spotPercentage, boolean valid) {\n+        FreeIpaCreationDto freeIpaCreationDto = FreeIpaCreationDto.builder()\n+                .withInstanceCountByGroup(instanceCountByGroup)\n+                .withAws(FreeIpaCreationAwsParametersDto.builder()\n+                        .withSpot(FreeIpaCreationAwsSpotParametersDto.builder()\n+                                .withPercentage(spotPercentage)\n+                                .build())\n+                        .build())\n+                .build();\n+\n+        ValidationResult validationResult = underTest.validateFreeIpaCreation(freeIpaCreationDto);\n+        assertEquals(!valid, validationResult.hasError());\n+    }\n+\n+    private static Stream<Arguments> freeIpaCreationArguments() {\n+        return Stream.of(\n+                Arguments.of(1, 0, true),\n+                Arguments.of(1, 100, true),\n+                Arguments.of(1, 50, false),\n+                Arguments.of(2, 50, true)", "originalCommit": "62795e90415f2497a8f0dc68d2ccfbad5fc02c37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ca902522c66c9ddd21e446c6588ddf5a29608195", "url": "https://github.com/hortonworks/cloudbreak/commit/ca902522c66c9ddd21e446c6588ddf5a29608195", "message": "CB-6267 Fix minor issues", "committedDate": "2020-04-02T15:57:55Z", "type": "commit"}, {"oid": "ca902522c66c9ddd21e446c6588ddf5a29608195", "url": "https://github.com/hortonworks/cloudbreak/commit/ca902522c66c9ddd21e446c6588ddf5a29608195", "message": "CB-6267 Fix minor issues", "committedDate": "2020-04-02T15:57:55Z", "type": "forcePushed"}]}