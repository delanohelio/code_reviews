{"pr_number": 621, "pr_title": "Participant manager's [POST]  /sites endpoint implementation", "pr_author": "Kantharajut-btc", "pr_createdAt": "2020-07-13T12:33:53Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/621", "timeline": [{"oid": "d3cdc4d25ced309a37e680bd822b5adf426f2ef2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d3cdc4d25ced309a37e680bd822b5adf426f2ef2", "message": "participant manager /sites end point implementation\n\nparticipant manager /sites end point implementation", "committedDate": "2020-07-13T12:31:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk2OTI3NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/621#discussion_r455969275", "body": "```suggestion\r\n    boolean canEdit = isEditPermissionAllowed(siteRequest);\r\n```\r\nor editAllowed", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                boolean allowed = isEditPermissionAllowed(siteRequest);\n          \n          \n            \n                boolean canEdit = isEditPermissionAllowed(siteRequest);\n          \n      \n    \n    \n  \n\nor editAllowed", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">boolean</span> <span class=\"x x-first x-last\">allowed</span> <span class=\"pl-k\">=</span> isEditPermissionAllowed(siteRequest);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">boolean</span> <span class=\"x x-first x-last\">canEdit</span> <span class=\"pl-k\">=</span> isEditPermissionAllowed(siteRequest);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">or editAllowed</p>", "author": "saminguyen", "createdAt": "2020-07-16T17:56:41Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/SiteServiceImpl.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.util.Constants.ACTIVE;\n+import static com.google.cloud.healthcare.fdamystudies.util.Constants.EDIT_VALUE;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.slf4j.ext.XLogger;\n+import org.slf4j.ext.XLoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+import com.google.cloud.healthcare.fdamystudies.beans.SiteRequest;\n+import com.google.cloud.healthcare.fdamystudies.beans.SiteResponse;\n+import com.google.cloud.healthcare.fdamystudies.common.ErrorCode;\n+import com.google.cloud.healthcare.fdamystudies.common.MessageCode;\n+import com.google.cloud.healthcare.fdamystudies.mapper.SiteMapper;\n+import com.google.cloud.healthcare.fdamystudies.model.AppPermissionEntity;\n+import com.google.cloud.healthcare.fdamystudies.model.LocationEntity;\n+import com.google.cloud.healthcare.fdamystudies.model.SiteEntity;\n+import com.google.cloud.healthcare.fdamystudies.model.SitePermissionEntity;\n+import com.google.cloud.healthcare.fdamystudies.model.StudyEntity;\n+import com.google.cloud.healthcare.fdamystudies.model.StudyPermissionEntity;\n+import com.google.cloud.healthcare.fdamystudies.repository.AppPermissionRepository;\n+import com.google.cloud.healthcare.fdamystudies.repository.LocationRepository;\n+import com.google.cloud.healthcare.fdamystudies.repository.SiteRepository;\n+import com.google.cloud.healthcare.fdamystudies.repository.StudyPermissionRepository;\n+import com.google.cloud.healthcare.fdamystudies.repository.StudyRepository;\n+\n+@Service\n+public class SiteServiceImpl implements SiteService {\n+\n+  private XLogger logger = XLoggerFactory.getXLogger(SiteServiceImpl.class.getName());\n+\n+  @Autowired private SiteRepository siteRepository;\n+\n+  @Autowired private LocationRepository locationRepository;\n+\n+  @Autowired private StudyRepository studyRepository;\n+\n+  @Autowired private StudyPermissionRepository studyPermissionRepository;\n+\n+  @Autowired private AppPermissionRepository appPermissionRepository;\n+\n+  @Override\n+  @Transactional\n+  public SiteResponse addSite(SiteRequest siteRequest) {\n+    logger.entry(\"begin addSite()\");\n+    boolean allowed = isEditPermissionAllowed(siteRequest);", "originalCommit": "d3cdc4d25ced309a37e680bd822b5adf426f2ef2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA2NzEyMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/621#discussion_r457067120", "bodyText": "changed to canEdit", "author": "Kantharajut-btc", "createdAt": "2020-07-20T05:34:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk2OTI3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5NzM2Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/621#discussion_r455997362", "body": "add the word PERMISSION", "bodyText": "add the word PERMISSION", "bodyHTML": "<p dir=\"auto\">add the word PERMISSION</p>", "author": "saminguyen", "createdAt": "2020-07-16T18:44:39Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/util/Constants.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.util;\n+\n+public final class Constants {\n+\n+  private Constants() {}\n+\n+  public static final int VIEW_VALUE = 0;\n+\n+  public static final int EDIT_VALUE = 1;", "originalCommit": "d3cdc4d25ced309a37e680bd822b5adf426f2ef2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA2NzQ4NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/621#discussion_r457067484", "bodyText": "Replaced with Permission enum", "author": "Kantharajut-btc", "createdAt": "2020-07-20T05:35:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTk5NzM2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE0NzUwNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/621#discussion_r456147507", "body": "```suggestion\r\n  SITE_PERMISSION_ACCESS_DENIED(\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              SITE_PERMISSION_ACEESS_DENIED(\n          \n          \n            \n              SITE_PERMISSION_ACCESS_DENIED(", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-c1 x x-first x-last\">SITE_PERMISSION_ACEESS_DENIED</span>(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-c1 x x-first x-last\">SITE_PERMISSION_ACCESS_DENIED</span>(</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "saminguyen", "createdAt": "2020-07-17T00:14:45Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorCode.java", "diffHunk": "@@ -57,7 +61,15 @@\n       500,\n       \"EC-500\",\n       \"Internal Server Error\",\n-      \"Sorry, an error has occurred and your request could not be processed. Please try again later.\");\n+      \"Sorry, an error has occurred and your request could not be processed. Please try again later.\"),\n+\n+  SITE_PERMISSION_ACEESS_DENIED(", "originalCommit": "d3cdc4d25ced309a37e680bd822b5adf426f2ef2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA2NzkzMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/621#discussion_r457067931", "bodyText": "typo corrected", "author": "Kantharajut-btc", "createdAt": "2020-07-20T05:36:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE0NzUwNw=="}], "type": "inlineReview"}, {"oid": "09ab5db1e9e444c2ef41689b0edd8f9fe0100a3e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/09ab5db1e9e444c2ef41689b0edd8f9fe0100a3e", "message": "Fixed PR #621 comments\n\nAdded Permission enum and fixed other review comments", "committedDate": "2020-07-20T05:33:51Z", "type": "commit"}, {"oid": "eacf153a8e0715e770009b5b25e816801017dbef", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eacf153a8e0715e770009b5b25e816801017dbef", "message": "PR review comment fixes\n\nPR review comment fixes", "committedDate": "2020-07-20T10:39:44Z", "type": "commit"}, {"oid": "5a76fca0b704284591d742502124677081422d41", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5a76fca0b704284591d742502124677081422d41", "message": "Merge branch 'participant-manager-service-sites-pending-entities' into participant-manager-service-sites-end-point", "committedDate": "2020-07-20T10:45:02Z", "type": "commit"}, {"oid": "f5ba630a4a06b5ee9161968d884f8dc4e6faa85d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f5ba630a4a06b5ee9161968d884f8dc4e6faa85d", "message": "Merge branch 'develop' into participant-manager-service-sites-end-point", "committedDate": "2020-08-07T03:58:35Z", "type": "commit"}, {"oid": "884567ba0ba014bfee54e080012418c5ec6f738f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/884567ba0ba014bfee54e080012418c5ec6f738f", "message": "Resolved conflicts\n\nResolved conflicts", "committedDate": "2020-08-07T06:06:06Z", "type": "commit"}, {"oid": "6e167868695ea8c9022f07a6ea859ee34d6591ae", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6e167868695ea8c9022f07a6ea859ee34d6591ae", "message": "Merge branch 'develop' into participant-manager-service-sites-end-point", "committedDate": "2020-08-07T23:07:41Z", "type": "commit"}]}