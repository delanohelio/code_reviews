{"pr_number": 10061, "pr_title": "[#9382] Add unit test for GetCourseSectionNamesAction", "pr_author": "Derek-Hardy", "pr_createdAt": "2020-05-15T11:06:42Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10061", "timeline": [{"oid": "bc00b68f7350b4bff67c91eafd2a0c785bb538c4", "url": "https://github.com/TEAMMATES/teammates/commit/bc00b68f7350b4bff67c91eafd2a0c785bb538c4", "message": "added unit test for GetCourseSectionNamesAction", "committedDate": "2020-05-15T10:59:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTc1ODA5MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10061#discussion_r425758091", "body": "```suggestion\r\n    protected void testExecute_nonExistCourse_shouldFail() throws Exception {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                protected void testExecute_nonexistCourse_shouldFail() throws Exception {\n          \n          \n            \n                protected void testExecute_nonExistCourse_shouldFail() throws Exception {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    <span class=\"pl-k\">protected</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">testExecute_nonexistCourse_shouldFail</span>() throws <span class=\"pl-smi\">Exception</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    <span class=\"pl-k\">protected</span> <span class=\"pl-k\">void</span> <span class=\"x x-first x-last\">testExecute_nonExistCourse_shouldFail</span>() throws <span class=\"pl-smi\">Exception</span> {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "madanalogy", "createdAt": "2020-05-15T12:10:23Z", "path": "src/test/java/teammates/test/cases/webapi/GetCourseSectionNamesActionTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package teammates.test.cases.webapi;\n+\n+import java.util.List;\n+\n+import org.apache.http.HttpStatus;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.exception.EntityDoesNotExistException;\n+import teammates.common.exception.EntityNotFoundException;\n+import teammates.common.util.Const;\n+import teammates.ui.webapi.action.GetCourseSectionNamesAction;\n+import teammates.ui.webapi.action.JsonResult;\n+import teammates.ui.webapi.output.CourseSectionNamesData;\n+\n+/**\n+ * SUT: {@link GetCourseSectionNamesAction}.\n+ */\n+public class GetCourseSectionNamesActionTest extends BaseActionTest<GetCourseSectionNamesAction> {\n+\n+    @Override\n+    protected String getActionUri() {\n+        return Const.ResourceURIs.COURSE_SECTIONS;\n+    }\n+\n+    @Override\n+    protected String getRequestMethod() {\n+        return GET;\n+    }\n+\n+    @Test\n+    @Override\n+    protected void testExecute() throws Exception {\n+        //See test cases below\n+    }\n+\n+    @Test\n+    protected void testExecute_typicalUsage_shouldPass() throws Exception {\n+        InstructorAttributes instructor1OfCourse1 = typicalBundle.instructors.get(\"instructor1OfCourse1\");\n+        List<String> expectedSectionNames = logic.getSectionNamesForCourse(instructor1OfCourse1.getCourseId());\n+\n+        loginAsInstructor(instructor1OfCourse1.googleId);\n+\n+        ______TS(\"typical success case for instructor\");\n+\n+        String[] params = {\n+                Const.ParamsNames.COURSE_ID, instructor1OfCourse1.getCourseId(),\n+        };\n+        GetCourseSectionNamesAction getCourseSectionNamesAction = getAction(params);\n+        JsonResult response = getJsonResult(getCourseSectionNamesAction);\n+\n+        assertEquals(HttpStatus.SC_OK, response.getStatusCode());\n+\n+        CourseSectionNamesData courseSectionNamesData = (CourseSectionNamesData) response.getOutput();\n+        assertEquals(expectedSectionNames, courseSectionNamesData.getSectionNames());\n+    }\n+\n+    @Test\n+    protected void testExecute_nonexistCourse_shouldFail() throws Exception {", "originalCommit": "bc00b68f7350b4bff67c91eafd2a0c785bb538c4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "47f25911210f0e10bcdf5b5b2bde8bda9ede8c72", "url": "https://github.com/TEAMMATES/teammates/commit/47f25911210f0e10bcdf5b5b2bde8bda9ede8c72", "message": "corrected method naming", "committedDate": "2020-05-16T01:57:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTkwMg==", "url": "https://github.com/TEAMMATES/teammates/pull/10061#discussion_r426215902", "body": "Shouldn't we add other verifications like `verifyInaccessibleWithoutLogin`?\r\n\r\nYou can check examples in other test cases.", "bodyText": "Shouldn't we add other verifications like verifyInaccessibleWithoutLogin?\nYou can check examples in other test cases.", "bodyHTML": "<p dir=\"auto\">Shouldn't we add other verifications like <code>verifyInaccessibleWithoutLogin</code>?</p>\n<p dir=\"auto\">You can check examples in other test cases.</p>", "author": "xpdavid", "createdAt": "2020-05-17T04:27:23Z", "path": "src/test/java/teammates/test/cases/webapi/GetCourseSectionNamesActionTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package teammates.test.cases.webapi;\n+\n+import java.util.List;\n+\n+import org.apache.http.HttpStatus;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.exception.EntityDoesNotExistException;\n+import teammates.common.exception.EntityNotFoundException;\n+import teammates.common.util.Const;\n+import teammates.ui.webapi.action.GetCourseSectionNamesAction;\n+import teammates.ui.webapi.action.JsonResult;\n+import teammates.ui.webapi.output.CourseSectionNamesData;\n+\n+/**\n+ * SUT: {@link GetCourseSectionNamesAction}.\n+ */\n+public class GetCourseSectionNamesActionTest extends BaseActionTest<GetCourseSectionNamesAction> {\n+\n+    @Override\n+    protected String getActionUri() {\n+        return Const.ResourceURIs.COURSE_SECTIONS;\n+    }\n+\n+    @Override\n+    protected String getRequestMethod() {\n+        return GET;\n+    }\n+\n+    @Test\n+    @Override\n+    protected void testExecute() throws Exception {\n+        //See test cases below\n+    }\n+\n+    @Test\n+    protected void testExecute_typicalUsage_shouldPass() throws Exception {\n+        InstructorAttributes instructor1OfCourse1 = typicalBundle.instructors.get(\"instructor1OfCourse1\");\n+        List<String> expectedSectionNames = logic.getSectionNamesForCourse(instructor1OfCourse1.getCourseId());\n+\n+        loginAsInstructor(instructor1OfCourse1.googleId);\n+\n+        ______TS(\"typical success case for instructor\");\n+\n+        String[] params = {\n+                Const.ParamsNames.COURSE_ID, instructor1OfCourse1.getCourseId(),\n+        };\n+        GetCourseSectionNamesAction getCourseSectionNamesAction = getAction(params);\n+        JsonResult response = getJsonResult(getCourseSectionNamesAction);\n+\n+        assertEquals(HttpStatus.SC_OK, response.getStatusCode());\n+\n+        CourseSectionNamesData courseSectionNamesData = (CourseSectionNamesData) response.getOutput();\n+        assertEquals(expectedSectionNames, courseSectionNamesData.getSectionNames());\n+    }\n+\n+    @Test\n+    protected void testExecute_nonExistCourse_shouldFail() throws Exception {\n+        InstructorAttributes instructor1OfCourse1 = typicalBundle.instructors.get(\"instructor1OfCourse1\");\n+        loginAsInstructor(instructor1OfCourse1.googleId);\n+\n+        ______TS(\"failed case for non-existent course\");\n+\n+        String[] params = {\n+                Const.ParamsNames.COURSE_ID, \"dummy-course\",\n+        };\n+        assertThrows(EntityDoesNotExistException.class, () -> logic.getSectionNamesForCourse(\"dummy-course\"));\n+\n+        GetCourseSectionNamesAction getCourseSectionNamesAction = getAction(params);\n+        assertThrows(EntityNotFoundException.class, () -> getJsonResult(getCourseSectionNamesAction));\n+    }\n+\n+    @Test\n+    @Override\n+    protected void testAccessControl() throws Exception {\n+        InstructorAttributes instructor1OfCourse1 = typicalBundle.instructors.get(\"instructor1OfCourse1\");\n+\n+        String[] submissionParams = new String[] {\n+                Const.ParamsNames.COURSE_ID, instructor1OfCourse1.getCourseId(),\n+                Const.ParamsNames.ENTITY_TYPE, Const.EntityType.INSTRUCTOR,\n+        };\n+\n+        verifyOnlyInstructorsOfTheSameCourseCanAccess(submissionParams);", "originalCommit": "47f25911210f0e10bcdf5b5b2bde8bda9ede8c72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAxMjIyNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10061#discussion_r427012225", "bodyText": "Additional verifications are added.", "author": "Derek-Hardy", "createdAt": "2020-05-19T03:40:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxNTkwMg=="}], "type": "inlineReview"}, {"oid": "90f29ccb93dd99290f84156ba957dd51c099d973", "url": "https://github.com/TEAMMATES/teammates/commit/90f29ccb93dd99290f84156ba957dd51c099d973", "message": "updated testAccessControl", "committedDate": "2020-05-18T03:20:30Z", "type": "commit"}, {"oid": "3a13b5419b97d4436c75aecfbce22835f3bf6887", "url": "https://github.com/TEAMMATES/teammates/commit/3a13b5419b97d4436c75aecfbce22835f3bf6887", "message": "fixed indentation", "committedDate": "2020-05-18T04:22:13Z", "type": "commit"}, {"oid": "575ba668d19ca91bb0985882807ab6a1ff222b1c", "url": "https://github.com/TEAMMATES/teammates/commit/575ba668d19ca91bb0985882807ab6a1ff222b1c", "message": "Merge branch 'master' into get-course-section-name-action", "committedDate": "2020-05-19T23:47:15Z", "type": "commit"}]}