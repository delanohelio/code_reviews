{"pr_number": 400, "pr_title": "Expose all GraphQL error properties (part 2)", "pr_author": "richardmcclellan", "pr_createdAt": "2020-04-25T06:51:15Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/400", "timeline": [{"oid": "76584d760247ac1098e8ded4ac44ed0c78388573", "url": "https://github.com/aws-amplify/amplify-android/commit/76584d760247ac1098e8ded4ac44ed0c78388573", "message": "Implemented custom serialization of GraphQL error extensions to eliminate gson leaking to public interface", "committedDate": "2020-04-25T06:45:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0MTM3Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/400#discussion_r415241377", "body": "Ordinarily the declaration is the bast `Map<KeyType, ValType>`, unless you are using some exotic property of a map that requires specification of which map type you need. For example, if you need ordering properties, you'd both instantiate and declared `LinkedHashMap`, since the type _is_ important, you're no longer dealing in \"any old map.\" But here, I think you're just dealing with any old map.\r\n\r\nMost common pattern is like:\r\n```\r\nstatic Map<Foo, Bar> createOne() {\r\n    Map<Foo, Bar> fooBar = new HashMap<>(); // This is the only place the special type is mentioned\r\n    fooBar.put(\"ham\", \"sandwich\");\r\n    return fooBar;\r\n}\r\n```", "bodyText": "Ordinarily the declaration is the bast Map<KeyType, ValType>, unless you are using some exotic property of a map that requires specification of which map type you need. For example, if you need ordering properties, you'd both instantiate and declared LinkedHashMap, since the type is important, you're no longer dealing in \"any old map.\" But here, I think you're just dealing with any old map.\nMost common pattern is like:\nstatic Map<Foo, Bar> createOne() {\n    Map<Foo, Bar> fooBar = new HashMap<>(); // This is the only place the special type is mentioned\n    fooBar.put(\"ham\", \"sandwich\");\n    return fooBar;\n}", "bodyHTML": "<p dir=\"auto\">Ordinarily the declaration is the bast <code>Map&lt;KeyType, ValType&gt;</code>, unless you are using some exotic property of a map that requires specification of which map type you need. For example, if you need ordering properties, you'd both instantiate and declared <code>LinkedHashMap</code>, since the type <em>is</em> important, you're no longer dealing in \"any old map.\" But here, I think you're just dealing with any old map.</p>\n<p dir=\"auto\">Most common pattern is like:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"static Map&lt;Foo, Bar&gt; createOne() {\n    Map&lt;Foo, Bar&gt; fooBar = new HashMap&lt;&gt;(); // This is the only place the special type is mentioned\n    fooBar.put(&quot;ham&quot;, &quot;sandwich&quot;);\n    return fooBar;\n}\n\"><pre><code>static Map&lt;Foo, Bar&gt; createOne() {\n    Map&lt;Foo, Bar&gt; fooBar = new HashMap&lt;&gt;(); // This is the only place the special type is mentioned\n    fooBar.put(\"ham\", \"sandwich\");\n    return fooBar;\n}\n</code></pre></div>", "author": "jamesonwilliams", "createdAt": "2020-04-26T07:28:37Z", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonErrorDeserializer.java", "diffHunk": "@@ -49,7 +50,7 @@\n         String message = null;\n         List<GraphQLLocation> locations = null;\n         List<GraphQLPathSegment> path = null;\n-        Map<String, Object> extensions = null;\n+        HashMap<String, Object> extensions = null;", "originalCommit": "76584d760247ac1098e8ded4ac44ed0c78388573", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2NDQzNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/400#discussion_r415964436", "bodyText": "Agreed!  Not sure why I specified HashMap instead of Map.  I will change to just Map.", "author": "richardmcclellan", "createdAt": "2020-04-27T16:30:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0MTM3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0MTk2OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/400#discussion_r415241969", "body": "`return Immutable.of(map)`?", "bodyText": "return Immutable.of(map)?", "bodyHTML": "<p dir=\"auto\"><code>return Immutable.of(map)</code>?</p>", "author": "jamesonwilliams", "createdAt": "2020-04-26T07:31:41Z", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonUtil.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonPrimitive;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+final class GsonUtil {\n+\n+    private GsonUtil() {\n+        throw new UnsupportedOperationException(\"No instances allowed.\");\n+    }\n+\n+    static HashMap<String, Object> toMap(JsonObject object) {\n+        HashMap<String, Object> map = new HashMap<>();\n+        for (String key : object.keySet()) {\n+            JsonElement element = object.get(key);\n+            map.put(key, toObject(element));\n+        }\n+        return map;", "originalCommit": "76584d760247ac1098e8ded4ac44ed0c78388573", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2NDUyMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/400#discussion_r415964521", "bodyText": "Will do", "author": "richardmcclellan", "createdAt": "2020-04-27T16:30:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0MTk2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0MjAwMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/400#discussion_r415242000", "body": "`return Immutable.of(list)`?", "bodyText": "return Immutable.of(list)?", "bodyHTML": "<p dir=\"auto\"><code>return Immutable.of(list)</code>?</p>", "author": "jamesonwilliams", "createdAt": "2020-04-26T07:31:49Z", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonUtil.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonPrimitive;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+final class GsonUtil {\n+\n+    private GsonUtil() {\n+        throw new UnsupportedOperationException(\"No instances allowed.\");\n+    }\n+\n+    static HashMap<String, Object> toMap(JsonObject object) {\n+        HashMap<String, Object> map = new HashMap<>();\n+        for (String key : object.keySet()) {\n+            JsonElement element = object.get(key);\n+            map.put(key, toObject(element));\n+        }\n+        return map;\n+    }\n+\n+    static List<Object> toList(JsonArray array) {\n+        List<Object> list = new ArrayList<>();\n+        for (int i = 0; i < array.size(); i++) {\n+            JsonElement element = array.get(i);\n+            list.add(toObject(element));\n+        }\n+        return list;", "originalCommit": "76584d760247ac1098e8ded4ac44ed0c78388573", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2NDU4NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/400#discussion_r415964585", "bodyText": "Will do", "author": "richardmcclellan", "createdAt": "2020-04-27T16:30:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0MjAwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0MjU3NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/400#discussion_r415242574", "body": "There is the [`element.isJsonNull()`](https://javadoc.io/doc/com.google.code.gson/gson/2.6.2/com/google/gson/JsonElement.html#isJsonNull--) -- not sure what the deal is with that... do we need to treat this case, or does the final `return null` handle it appropriately?", "bodyText": "There is the element.isJsonNull() -- not sure what the deal is with that... do we need to treat this case, or does the final return null handle it appropriately?", "bodyHTML": "<p dir=\"auto\">There is the <a href=\"https://javadoc.io/doc/com.google.code.gson/gson/2.6.2/com/google/gson/JsonElement.html#isJsonNull--\" rel=\"nofollow\"><code>element.isJsonNull()</code></a> -- not sure what the deal is with that... do we need to treat this case, or does the final <code>return null</code> handle it appropriately?</p>", "author": "jamesonwilliams", "createdAt": "2020-04-26T07:35:17Z", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonUtil.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonPrimitive;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.List;\n+\n+final class GsonUtil {\n+\n+    private GsonUtil() {\n+        throw new UnsupportedOperationException(\"No instances allowed.\");\n+    }\n+\n+    static HashMap<String, Object> toMap(JsonObject object) {\n+        HashMap<String, Object> map = new HashMap<>();\n+        for (String key : object.keySet()) {\n+            JsonElement element = object.get(key);\n+            map.put(key, toObject(element));\n+        }\n+        return map;\n+    }\n+\n+    static List<Object> toList(JsonArray array) {\n+        List<Object> list = new ArrayList<>();\n+        for (int i = 0; i < array.size(); i++) {\n+            JsonElement element = array.get(i);\n+            list.add(toObject(element));\n+        }\n+        return list;\n+    }\n+\n+    private static Object toObject(JsonElement element) {\n+        if (element != null) {", "originalCommit": "76584d760247ac1098e8ded4ac44ed0c78388573", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2NTM5Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/400#discussion_r415965396", "bodyText": "The final return null will handle element.isJsonNull().", "author": "richardmcclellan", "createdAt": "2020-04-27T16:31:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0MjU3NA=="}], "type": "inlineReview"}, {"oid": "08d49f12a45dfa8b28f44eaaf6562f79b222bb64", "url": "https://github.com/aws-amplify/amplify-android/commit/08d49f12a45dfa8b28f44eaaf6562f79b222bb64", "message": "Minor fixes", "committedDate": "2020-04-27T16:55:31Z", "type": "commit"}, {"oid": "08d49f12a45dfa8b28f44eaaf6562f79b222bb64", "url": "https://github.com/aws-amplify/amplify-android/commit/08d49f12a45dfa8b28f44eaaf6562f79b222bb64", "message": "Minor fixes", "committedDate": "2020-04-27T16:55:31Z", "type": "forcePushed"}]}