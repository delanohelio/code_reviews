{"pr_number": 1913, "pr_title": "Added integration test cases for Dedicated namespace scenarios", "pr_author": "hzhao-github", "pr_createdAt": "2020-09-12T00:15:37Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913", "timeline": [{"oid": "226bbe75b83be1ffe3c565e0603b243259c3fb36", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/226bbe75b83be1ffe3c565e0603b243259c3fb36", "message": "Added integration test cases for Dedicated namespace scenarios jenkins-ignore", "committedDate": "2020-09-11T01:02:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNjI4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r488706286", "body": "you are not installing operator here, remove the log message", "bodyText": "you are not installing operator here, remove the log message", "bodyHTML": "<p dir=\"auto\">you are not installing operator here, remove the log message</p>", "author": "vanajamukkara", "createdAt": "2020-09-15T14:19:48Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,403 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    logger.info(\"Installing and verifying operator\");", "originalCommit": "226bbe75b83be1ffe3c565e0603b243259c3fb36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0NzI0MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490447240", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-09-17T17:49:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwNjI4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwODE3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r488708179", "body": "that domains not deployed or that a domain not deployed", "bodyText": "that domains not deployed or that a domain not deployed", "bodyHTML": "<p dir=\"auto\">that domains not deployed or that a domain not deployed</p>", "author": "vanajamukkara", "createdAt": "2020-09-15T14:22:07Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,403 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    logger.info(\"Installing and verifying operator\");\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Create CRD.\n+   * 2) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 3) Verify the Operator is up and running.\n+   * 4) Create WebLogic Domain its namespace=wls-ns.\n+   * 5) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domains not deployed in operator's namespace doesn't come up\")", "originalCommit": "226bbe75b83be1ffe3c565e0603b243259c3fb36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0Nzg4OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490447888", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-09-17T17:50:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwODE3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMDI2NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r488710265", "body": "this is not needed, remove", "bodyText": "this is not needed, remove", "bodyHTML": "<p dir=\"auto\">this is not needed, remove</p>", "author": "vanajamukkara", "createdAt": "2020-09-15T14:24:46Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,403 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    logger.info(\"Installing and verifying operator\");\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Create CRD.\n+   * 2) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 3) Verify the Operator is up and running.\n+   * 4) Create WebLogic Domain its namespace=wls-ns.\n+   * 5) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domains not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    try {\n+      Thread.sleep(30 * 1000);", "originalCommit": "226bbe75b83be1ffe3c565e0603b243259c3fb36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0ODI0Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490448243", "bodyText": "removed", "author": "hzhao-github", "createdAt": "2020-09-17T17:51:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMDI2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMDk4NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r488710984", "body": "by ", "bodyText": "by", "bodyHTML": "<p dir=\"auto\">by</p>", "author": "vanajamukkara", "createdAt": "2020-09-15T14:25:39Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,403 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    logger.info(\"Installing and verifying operator\");\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Create CRD.\n+   * 2) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 3) Verify the Operator is up and running.\n+   * 4) Create WebLogic Domain its namespace=wls-ns.\n+   * 5) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domains not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    try {\n+      Thread.sleep(30 * 1000);\n+    } catch (Exception ex) {\n+      //ignore\n+    }\n+\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true, make sure that the domains deployed in the operator's namespace come up.\n+   * 1) Create a namespace (e.g. op-wls-ns) that is used b y both Operator and WebLogic domain.", "originalCommit": "226bbe75b83be1ffe3c565e0603b243259c3fb36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0ODY3MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490448670", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-09-17T17:51:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMDk4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMjk0Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r488712947", "body": "you are not creating the CRD as part of the test, so no need of this step here ...", "bodyText": "you are not creating the CRD as part of the test, so no need of this step here ...", "bodyHTML": "<p dir=\"auto\">you are not creating the CRD as part of the test, so no need of this step here ...</p>", "author": "vanajamukkara", "createdAt": "2020-09-15T14:28:02Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,403 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    logger.info(\"Installing and verifying operator\");\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Create CRD.", "originalCommit": "226bbe75b83be1ffe3c565e0603b243259c3fb36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0OTcwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490449701", "bodyText": "removed", "author": "hzhao-github", "createdAt": "2020-09-17T17:53:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMjk0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMzM0MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r488713340", "body": "same as above", "bodyText": "same as above", "bodyHTML": "<p dir=\"auto\">same as above</p>", "author": "vanajamukkara", "createdAt": "2020-09-15T14:28:30Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,403 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    logger.info(\"Installing and verifying operator\");\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Create CRD.\n+   * 2) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 3) Verify the Operator is up and running.\n+   * 4) Create WebLogic Domain its namespace=wls-ns.\n+   * 5) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domains not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    try {\n+      Thread.sleep(30 * 1000);\n+    } catch (Exception ex) {\n+      //ignore\n+    }\n+\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true, make sure that the domains deployed in the operator's namespace come up.\n+   * 1) Create a namespace (e.g. op-wls-ns) that is used b y both Operator and WebLogic domain.\n+   * 2) Create CRD.", "originalCommit": "226bbe75b83be1ffe3c565e0603b243259c3fb36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ0OTc3NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490449774", "bodyText": "removed", "author": "hzhao-github", "createdAt": "2020-09-17T17:53:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxMzM0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxNjI0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r488716249", "body": "where are you installing the operator with same namespace for both operator and domain namespaces?", "bodyText": "where are you installing the operator with same namespace for both operator and domain namespaces?", "bodyHTML": "<p dir=\"auto\">where are you installing the operator with same namespace for both operator and domain namespaces?</p>", "author": "vanajamukkara", "createdAt": "2020-09-15T14:32:04Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,403 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    logger.info(\"Installing and verifying operator\");\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Create CRD.\n+   * 2) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 3) Verify the Operator is up and running.\n+   * 4) Create WebLogic Domain its namespace=wls-ns.\n+   * 5) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domains not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    try {\n+      Thread.sleep(30 * 1000);\n+    } catch (Exception ex) {\n+      //ignore\n+    }\n+\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true, make sure that the domains deployed in the operator's namespace come up.\n+   * 1) Create a namespace (e.g. op-wls-ns) that is used b y both Operator and WebLogic domain.\n+   * 2) Create CRD.\n+   * 3) Install an Operator with namespace=op-wls-ns, domainNamespaces=op-wls-ns", "originalCommit": "226bbe75b83be1ffe3c565e0603b243259c3fb36", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ1MjA5NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490452095", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-17T17:57:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcxNjI0OQ=="}], "type": "inlineReview"}, {"oid": "63d654b02eb00a8eac98bc381b6f06f609e66806", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/63d654b02eb00a8eac98bc381b6f06f609e66806", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into dedicated-mode-tests", "committedDate": "2020-09-17T16:49:35Z", "type": "commit"}, {"oid": "db039f107eb57745ae66ebb1d2a8f240099dec36", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/db039f107eb57745ae66ebb1d2a8f240099dec36", "message": "Syncup with JIRA OWLS-84517 and changes based on comments jenkins-ignore", "committedDate": "2020-09-17T18:18:05Z", "type": "commit"}, {"oid": "4daa2aeb1372ed1282f6641f693035af6ce69ab1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4daa2aeb1372ed1282f6641f693035af6ce69ab1", "message": "Delete index.yaml", "committedDate": "2020-09-17T18:25:16Z", "type": "commit"}, {"oid": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "message": "Remove binary files that are wrongly checked in jenkins-ignore", "committedDate": "2020-09-17T18:45:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU2Njk3OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490566978", "body": "set \"dedicated\" to true --> Please explain which Helm attribute you are setting to true. \r\nYou may refer to the public doc link\r\n ", "bodyText": "set \"dedicated\" to true --> Please explain which Helm attribute you are setting to true.\nYou may refer to the public doc link", "bodyHTML": "<p dir=\"auto\">set \"dedicated\" to true --&gt; Please explain which Helm attribute you are setting to true.<br>\nYou may refer to the public doc link</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:16:37Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1MjEwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490652101", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-18T01:40:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU2Njk3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU2NzkxMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490567910", "body": "put the indention as a), b)  instead of 1), 2) ", "bodyText": "put the indention as a), b)  instead of 1), 2)", "bodyHTML": "<p dir=\"auto\">put the indention as a), b)  instead of 1), 2)</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:18:41Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1MjUxNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490652516", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-18T01:42:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU2NzkxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU2ODc1Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490568752", "body": "explain what \"dedicated\" refers to ?", "bodyText": "explain what \"dedicated\" refers to ?", "bodyHTML": "<p dir=\"auto\">explain what \"dedicated\" refers to ?</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:20:30Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1MzE0Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490653147", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-18T01:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU2ODc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU2OTIxNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490569217", "body": "Do we need a number indention. The steps are obvious in order. \r\nRemove \"==\" symbol in the description.", "bodyText": "Do we need a number indention. The steps are obvious in order.\nRemove \"==\" symbol in the description.", "bodyHTML": "<p dir=\"auto\">Do we need a number indention. The steps are obvious in order.<br>\nRemove \"==\" symbol in the description.</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:21:35Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1Mzk3Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490653977", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-18T01:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU2OTIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MDM2Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490570363", "body": "Create WebLogic Domain its namespace=wls-ns  --> Create WebLogic Domain in a namespace wls-ns.  No == symbol in the description.", "bodyText": "Create WebLogic Domain its namespace=wls-ns  --> Create WebLogic Domain in a namespace wls-ns.  No == symbol in the description.", "bodyHTML": "<p dir=\"auto\">Create WebLogic Domain its namespace=wls-ns  --&gt; Create WebLogic Domain in a namespace wls-ns.  No == symbol in the description.</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:24:02Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 2) Verify the Operator is up and running.\n+   * 3) Create WebLogic Domain its namespace=wls-ns.", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1NDQ5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490654496", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-18T01:50:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MDM2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MTgwNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490571806", "body": "Remove number indentations.  The namespaces are generated dynamically.  Do not  hard-code the namespace like ' op-wls-ns' ", "bodyText": "Remove number indentations.  The namespaces are generated dynamically.  Do not  hard-code the namespace like ' op-wls-ns'", "bodyHTML": "<p dir=\"auto\">Remove number indentations.  The namespaces are generated dynamically.  Do not  hard-code the namespace like ' op-wls-ns'</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:27:06Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 2) Verify the Operator is up and running.\n+   * 3) Create WebLogic Domain its namespace=wls-ns.\n+   * 4) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domain not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true, make sure that the domains deployed in the operator's namespace come up.\n+   * 1) Using the Operator's namespace, op-wls-ns, create a WebLogic Domain", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1NzQzNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490657437", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-18T02:01:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MTgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MjcyMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490572723", "body": "Need more description of the usecase. It is too generic. If we generate javadoc, it MUST provide the exact detail of the usecase.", "bodyText": "Need more description of the usecase. It is too generic. If we generate javadoc, it MUST provide the exact detail of the usecase.", "bodyHTML": "<p dir=\"auto\">Need more description of the usecase. It is too generic. If we generate javadoc, it MUST provide the exact detail of the usecase.</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:29:11Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 2) Verify the Operator is up and running.\n+   * 3) Create WebLogic Domain its namespace=wls-ns.\n+   * 4) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domain not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true, make sure that the domains deployed in the operator's namespace come up.\n+   * 1) Using the Operator's namespace, op-wls-ns, create a WebLogic Domain\n+   * 2) Verify that the WebLogic domain whose namespace = op-wls-ns comes up.\n+   */\n+  @Test\n+  @Order(2)\n+  @DisplayName(\"Set dedicated to true and verify that the domain deployed in the operator's namespace comes up\")\n+  public void testDedicatedModeSameNamespace() {\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain1Namespace);\n+    verifyDomainRunning(domain1Namespace);\n+  }\n+\n+  /**", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1NzkwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490657907", "bodyText": "That's exactly use case. I don't know what else to give :(", "author": "hzhao-github", "createdAt": "2020-09-18T02:03:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MjcyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA3OTUzMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r491079533", "bodyText": "Then you can merge the test method to another test method to provide a complete e2e scenario including scaling.", "author": "anpanigr", "createdAt": "2020-09-18T17:03:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MjcyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MzExMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490573110", "body": "More detail description needed.", "bodyText": "More detail description needed.", "bodyHTML": "<p dir=\"auto\">More detail description needed.</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:30:01Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 2) Verify the Operator is up and running.\n+   * 3) Create WebLogic Domain its namespace=wls-ns.\n+   * 4) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domain not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true, make sure that the domains deployed in the operator's namespace come up.\n+   * 1) Using the Operator's namespace, op-wls-ns, create a WebLogic Domain\n+   * 2) Verify that the WebLogic domain whose namespace = op-wls-ns comes up.\n+   */\n+  @Test\n+  @Order(2)\n+  @DisplayName(\"Set dedicated to true and verify that the domain deployed in the operator's namespace comes up\")\n+  public void testDedicatedModeSameNamespace() {\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain1Namespace);\n+    verifyDomainRunning(domain1Namespace);\n+  }\n+\n+  /**\n+   * Scale up cluster-1 in domain1Namespace and verify it succeeds.\n+   */\n+  @Test\n+  @Order(3)\n+  @DisplayName(\"Scale up cluster-1 in domain1Namespace and verify it succeeds\")\n+  public void testDedicatedModeSameNamespaceScale() {\n+    // scale the cluster and check domain can be managed from the operator\n+    int externalRestHttpsPort = getServiceNodePort(opNamespace, \"external-weblogic-operator-svc\");\n+    logger.info(\"externalRestHttpsPort {0}\", externalRestHttpsPort);\n+\n+    logger.info(\"scaling the cluster from {0} servers to {1} servers\", replicaCount, replicaCount + 1);\n+    scaleAndVerifyCluster(clusterName, domainUid, domain1Namespace,\n+        managedServerPodPrefix, replicaCount, replicaCount + 1,\n+        true, externalRestHttpsPort, opNamespace, opNamespace + \"-sa\",\n+        false, \"\", \"\", 0, \"\",\n+        \"\", null, null);\n+  }\n+\n+  /**", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1OTAwMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490659003", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-18T02:07:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MzExMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MzMzOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490573339", "body": "More Description needed.", "bodyText": "More Description needed.", "bodyHTML": "<p dir=\"auto\">More Description needed.</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:30:28Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 2) Verify the Operator is up and running.\n+   * 3) Create WebLogic Domain its namespace=wls-ns.\n+   * 4) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domain not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true, make sure that the domains deployed in the operator's namespace come up.\n+   * 1) Using the Operator's namespace, op-wls-ns, create a WebLogic Domain\n+   * 2) Verify that the WebLogic domain whose namespace = op-wls-ns comes up.\n+   */\n+  @Test\n+  @Order(2)\n+  @DisplayName(\"Set dedicated to true and verify that the domain deployed in the operator's namespace comes up\")\n+  public void testDedicatedModeSameNamespace() {\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain1Namespace);\n+    verifyDomainRunning(domain1Namespace);\n+  }\n+\n+  /**\n+   * Scale up cluster-1 in domain1Namespace and verify it succeeds.\n+   */\n+  @Test\n+  @Order(3)\n+  @DisplayName(\"Scale up cluster-1 in domain1Namespace and verify it succeeds\")\n+  public void testDedicatedModeSameNamespaceScale() {\n+    // scale the cluster and check domain can be managed from the operator\n+    int externalRestHttpsPort = getServiceNodePort(opNamespace, \"external-weblogic-operator-svc\");\n+    logger.info(\"externalRestHttpsPort {0}\", externalRestHttpsPort);\n+\n+    logger.info(\"scaling the cluster from {0} servers to {1} servers\", replicaCount, replicaCount + 1);\n+    scaleAndVerifyCluster(clusterName, domainUid, domain1Namespace,\n+        managedServerPodPrefix, replicaCount, replicaCount + 1,\n+        true, externalRestHttpsPort, opNamespace, opNamespace + \"-sa\",\n+        false, \"\", \"\", 0, \"\",\n+        \"\", null, null);\n+  }\n+\n+  /**\n+   * Test when a CRD with a lower than expected version is present,\n+   * Operator fails with error if it has not permission to overwrite the CRD.\n+   */\n+  @Test\n+  @Order(4)\n+  @Disabled(\"Disable the test because the Operator has permission to overwrite the CRD\")\n+  @DisplayName(\"Create a CRD with a lower than expected version and verify that Operator fails with error\")\n+  public void testDedicatedModeNlowerVersionCrd() {\n+    // delete existing CRD\n+    new Command()\n+        .withParams(new CommandParams()\n+            .command(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\"))\n+        .execute();\n+\n+    // install a lower version of CRD, v2.6.0\n+    new Command()\n+        .withParams(new CommandParams()\n+            .command(\"kubectl create -f \" + ITTESTS_DIR + \"/../kubernetes/crd/domain-v1beta1-crdv7-260.yaml\"))\n+        .execute();\n+\n+    try {\n+      // install latest version of operator and verify\n+      logger.info(\"Installing and verifying operator\");\n+      installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+          false, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+          false, domain2Namespace);\n+\n+      // we expect installAndVerifyOperator fails with a lower than expected version of CRD\n+      fail(\"Installing the Operator should fail with a lower than expected version of CRD\");\n+    } catch (Exception ex) {\n+      logger.info(\"Installing the Operator with a lower than expected version of CRD failed as expected\");\n+    } finally {\n+      // restore the test env\n+      uninstallOperatorAndVerify();\n+    }\n+  }\n+\n+  /**", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDY1OTA0MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490659040", "bodyText": "That's exactly use case. I don't know what else to give :(", "author": "hzhao-github", "createdAt": "2020-09-18T02:07:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3MzMzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3NDkzNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r490574937", "body": "Use the utility CommonTestUtils.checkPodReadyAndServiceExists", "bodyText": "Use the utility CommonTestUtils.checkPodReadyAndServiceExists", "bodyHTML": "<p dir=\"auto\">Use the utility CommonTestUtils.checkPodReadyAndServiceExists</p>", "author": "anpanigr", "createdAt": "2020-09-17T21:33:59Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,391 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReady;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * Integration test cases for \"Dedicated\" namespace scenarios\n+ * 1. Set \"dedicated\" to true, verify that the domains deployed in the operator's namespace come up.\n+ * 2. Set \"dedicated\" to true, verify that the domains not deployed in the operator's namespace does not come up.\n+ * 3. Scale the cluster with \"dedicated\" set to true\n+ * 4. Negative tests\n+ *    1) The CRD is not present or is deleted, verify that Operator fails with error\n+ *    2) The CRD is present but is a lower than expected version, verify that Operator fails with error\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true and set the domainNamespaces to something that does not contain the operator's namespace,\n+   * make sure that the domains in the operator's target namespaces do not come up\n+   * because when dedicated is set to true, the operator's domainNamespaces value is ignored.\n+   * 1) Install an Operator with namespace=op-ns, domainNamespaces=wls-ns\n+   *    and domainNamespaceSelectionStrategy=Dedicated.\n+   * 2) Verify the Operator is up and running.\n+   * 3) Create WebLogic Domain its namespace=wls-ns.\n+   * 4) Verify that domain whose namespace = wls-ns does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set dedicated to true and verify that a domain not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * Set \"dedicated\" to true, make sure that the domains deployed in the operator's namespace come up.\n+   * 1) Using the Operator's namespace, op-wls-ns, create a WebLogic Domain\n+   * 2) Verify that the WebLogic domain whose namespace = op-wls-ns comes up.\n+   */\n+  @Test\n+  @Order(2)\n+  @DisplayName(\"Set dedicated to true and verify that the domain deployed in the operator's namespace comes up\")\n+  public void testDedicatedModeSameNamespace() {\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain1Namespace);\n+    verifyDomainRunning(domain1Namespace);\n+  }\n+\n+  /**\n+   * Scale up cluster-1 in domain1Namespace and verify it succeeds.\n+   */\n+  @Test\n+  @Order(3)\n+  @DisplayName(\"Scale up cluster-1 in domain1Namespace and verify it succeeds\")\n+  public void testDedicatedModeSameNamespaceScale() {\n+    // scale the cluster and check domain can be managed from the operator\n+    int externalRestHttpsPort = getServiceNodePort(opNamespace, \"external-weblogic-operator-svc\");\n+    logger.info(\"externalRestHttpsPort {0}\", externalRestHttpsPort);\n+\n+    logger.info(\"scaling the cluster from {0} servers to {1} servers\", replicaCount, replicaCount + 1);\n+    scaleAndVerifyCluster(clusterName, domainUid, domain1Namespace,\n+        managedServerPodPrefix, replicaCount, replicaCount + 1,\n+        true, externalRestHttpsPort, opNamespace, opNamespace + \"-sa\",\n+        false, \"\", \"\", 0, \"\",\n+        \"\", null, null);\n+  }\n+\n+  /**\n+   * Test when a CRD with a lower than expected version is present,\n+   * Operator fails with error if it has not permission to overwrite the CRD.\n+   */\n+  @Test\n+  @Order(4)\n+  @Disabled(\"Disable the test because the Operator has permission to overwrite the CRD\")\n+  @DisplayName(\"Create a CRD with a lower than expected version and verify that Operator fails with error\")\n+  public void testDedicatedModeNlowerVersionCrd() {\n+    // delete existing CRD\n+    new Command()\n+        .withParams(new CommandParams()\n+            .command(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\"))\n+        .execute();\n+\n+    // install a lower version of CRD, v2.6.0\n+    new Command()\n+        .withParams(new CommandParams()\n+            .command(\"kubectl create -f \" + ITTESTS_DIR + \"/../kubernetes/crd/domain-v1beta1-crdv7-260.yaml\"))\n+        .execute();\n+\n+    try {\n+      // install latest version of operator and verify\n+      logger.info(\"Installing and verifying operator\");\n+      installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+          false, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+          false, domain2Namespace);\n+\n+      // we expect installAndVerifyOperator fails with a lower than expected version of CRD\n+      fail(\"Installing the Operator should fail with a lower than expected version of CRD\");\n+    } catch (Exception ex) {\n+      logger.info(\"Installing the Operator with a lower than expected version of CRD failed as expected\");\n+    } finally {\n+      // restore the test env\n+      uninstallOperatorAndVerify();\n+    }\n+  }\n+\n+  /**\n+   * Test when she CRD is not present or is deleted,\n+   * Operator fails with error if it has not permission to create the CRD.\n+   */\n+  @Test\n+  @Order(5)\n+  @Disabled(\"Disable the test because the Operator has permission to create the CRD\")\n+  @DisplayName(\"Delete the CRD and verify that Operator fails with error\")\n+  public void testDedicatedModeNoCrd() {\n+    // delete existing CRD\n+    logger.info(\"Delete existing CRD\");\n+    new Command()\n+        .withParams(new CommandParams()\n+            .command(\"kubectl delete crd domains.weblogic.oracle --ignore-not-found\"))\n+        .execute();\n+\n+    try {\n+      // install and verify operator\n+      logger.info(\"Installing and verifying operator\");\n+      installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+          false, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+          false, domain2Namespace);\n+\n+      // we expect installAndVerifyOperator fails when the CRD misses\n+      fail(\"Installing the Operator should fail when the CRD misses\");\n+    } catch (Exception ex) {\n+      logger.info(\"Installing the Operator failed as expected when the CRD misses\");\n+    } finally {\n+      // restore the test env\n+      uninstallOperatorAndVerify();\n+    }\n+  }\n+\n+  private void createDomain(String domainNamespace) {\n+    // create secret for admin credentials\n+    logger.info(\"Create secret for admin credentials\");\n+    String adminSecretName = \"weblogic-credentials\";\n+    assertDoesNotThrow(() -> createSecretWithUsernamePassword(adminSecretName, domainNamespace,\n+        \"weblogic\", \"welcome1\"),\n+          String.format(\"create secret for admin credentials failed for %s\", adminSecretName));\n+\n+    // create encryption secret\n+    logger.info(\"Create encryption secret\");\n+    String encryptionSecretName = \"encryptionsecret\";\n+    assertDoesNotThrow(() -> createSecretWithUsernamePassword(encryptionSecretName, domainNamespace,\n+        \"weblogicenc\", \"weblogicenc\"),\n+          String.format(\"create encryption secret failed for %s\", encryptionSecretName));\n+\n+    // create domain and verify\n+    logger.info(\"Create model in image domain {0} in namespace {1} using docker image {2}\",\n+        domainNamespace, domainUid, domainNamespace);\n+    createDomainCrAndVerify(domainNamespace, adminSecretName, encryptionSecretName);\n+  }\n+\n+  private void createDomainCrAndVerify(String domainNamespace,\n+                                       String adminSecretName,\n+                                       String encryptionSecretName) {\n+    // get the pre-built image created by IntegrationTestWatcher\n+    String miiImage = MII_BASIC_IMAGE_NAME + \":\" + MII_BASIC_IMAGE_TAG;\n+\n+    // construct a list of oracle.weblogic.domain.Cluster objects to be used in the domain custom resource\n+    List<Cluster> clusters = new ArrayList<>();\n+    clusters.add(new Cluster()\n+        .clusterName(clusterName)\n+        .replicas(replicaCount)\n+        .serverStartState(\"RUNNING\"));\n+\n+    // create the domain CR\n+    Domain domain = new Domain()\n+        .apiVersion(DOMAIN_API_VERSION)\n+        .kind(\"Domain\")\n+        .metadata(new V1ObjectMeta()\n+            .name(domainUid)\n+            .namespace(domainNamespace))\n+        .spec(new DomainSpec()\n+            .domainUid(domainUid)\n+            .domainHomeSourceType(\"FromModel\")\n+            .image(miiImage)\n+            .addImagePullSecretsItem(new V1LocalObjectReference()\n+                .name(REPO_SECRET_NAME))\n+            .webLogicCredentialsSecret(new V1SecretReference()\n+                .name(adminSecretName)\n+                .namespace(domainNamespace))\n+            .includeServerOutInPodLog(true)\n+            .serverStartPolicy(\"IF_NEEDED\")\n+            .serverPod(new ServerPod()\n+                .addEnvItem(new V1EnvVar()\n+                    .name(\"JAVA_OPTIONS\")\n+                    .value(\"-Dweblogic.StdoutDebugEnabled=false\"))\n+                .addEnvItem(new V1EnvVar()\n+                    .name(\"USER_MEM_ARGS\")\n+                    .value(\"-Djava.security.egd=file:/dev/./urandom \")))\n+            .adminServer(new AdminServer()\n+                .serverStartState(\"RUNNING\"))\n+            .clusters(clusters)\n+            .configuration(new Configuration()\n+                .model(new Model()\n+                    .domainType(WLS_DOMAIN_TYPE)\n+                    .runtimeEncryptionSecret(encryptionSecretName))));\n+\n+    // create model in image domain\n+    logger.info(\"Creating model in image domain {0} in namespace {1} using docker image {2}\",\n+        domainUid, domainNamespace, miiImage);\n+    createDomainAndVerify(domain, domainNamespace);\n+  }\n+\n+  private void verifyDomainRunning(String domainNamespace) {\n+    // check that admin service exists in the domain namespace\n+    logger.info(\"Checking that admin service {0} exists in namespace {1}\",\n+        adminServerPodName, domainNamespace);\n+    checkServiceExists(adminServerPodName, domainNamespace);\n+\n+    // check that admin server pod is ready\n+    logger.info(\"Checking that admin server pod {0} is ready in namespace {1}\",\n+        adminServerPodName, domainNamespace);\n+    checkPodReady(adminServerPodName, domainUid, domainNamespace);\n+\n+    // check for managed server pods existence in the domain namespace\n+    for (int i = 1; i <= replicaCount; i++) {\n+      String managedServerPodName = managedServerPodPrefix + i;\n+\n+      // check that the managed server service exists in the domain namespace\n+      logger.info(\"Checking that managed server service {0} exists in namespace {1}\",\n+          managedServerPodName, domainNamespace);\n+      checkServiceExists(managedServerPodName, domainNamespace);", "originalCommit": "420636399cc1dc4c518aa9123c4538ffb1c5a0c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTEzNTAwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r491135007", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-18T18:56:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU3NDkzNw=="}], "type": "inlineReview"}, {"oid": "b324adb769acf87c84cee7b976d0450e5afeb155", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b324adb769acf87c84cee7b976d0450e5afeb155", "message": "Changes based on the comments jenkins-ignore", "committedDate": "2020-09-18T20:30:40Z", "type": "commit"}, {"oid": "03f92a184d01f0b6bb080875ade584e4d84ec741", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/03f92a184d01f0b6bb080875ade584e4d84ec741", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into dedicated-mode-tests", "committedDate": "2020-09-18T20:39:43Z", "type": "commit"}, {"oid": "13fd295f3a313dcf15ccc7f688fa0f400b2a2fb4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/13fd295f3a313dcf15ccc7f688fa0f400b2a2fb4", "message": "Syncup with develop branch jenkins-ignore", "committedDate": "2020-09-18T21:00:50Z", "type": "commit"}, {"oid": "a9bbd01736cba622a973f865e56fa710f569f457", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a9bbd01736cba622a973f865e56fa710f569f457", "message": "Changed javadoc jenkins-ignore", "committedDate": "2020-09-20T18:00:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE5NjMwMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r492196302", "body": "do you mean `the domains which are not in the operator's target namespaces do not come up.`?", "bodyText": "do you mean the domains which are not in the operator's target namespaces do not come up.?", "bodyHTML": "<p dir=\"auto\">do you mean <code>the domains which are not in the operator's target namespaces do not come up.</code>?</p>", "author": "vanajamukkara", "createdAt": "2020-09-21T16:34:05Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,385 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReadyAndServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * The current class verifies various use cases related to domainNamespaceSelectionStrategy.\n+ * For more detail regarding the feature, please refer to\n+ * https://github.com/oracle/weblogic-kubernetes-operator/blob/develop/docs-source/content/\n+ * userguide/managing-operators/using-the-operator/using-helm.md#overall-operator-information.\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * When installing the Operator via helm install,\n+   * set the Operator Helm Chart parameter domainNamespaceSelectionStrategy to Dedicated and\n+   * set domainNamespaces to something that is different from the operator's namespace.\n+   * Make sure that the domains is not in the operator's target namespaces do not come up.", "originalCommit": "a9bbd01736cba622a973f865e56fa710f569f457", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjMwMjg4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r492302886", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-09-21T19:41:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE5NjMwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwMDAzNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r492200036", "body": "disabling the test as we can't test on kind cluster?", "bodyText": "disabling the test as we can't test on kind cluster?", "bodyHTML": "<p dir=\"auto\">disabling the test as we can't test on kind cluster?</p>", "author": "vanajamukkara", "createdAt": "2020-09-21T16:40:15Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,385 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReadyAndServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * The current class verifies various use cases related to domainNamespaceSelectionStrategy.\n+ * For more detail regarding the feature, please refer to\n+ * https://github.com/oracle/weblogic-kubernetes-operator/blob/develop/docs-source/content/\n+ * userguide/managing-operators/using-the-operator/using-helm.md#overall-operator-information.\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * When installing the Operator via helm install,\n+   * set the Operator Helm Chart parameter domainNamespaceSelectionStrategy to Dedicated and\n+   * set domainNamespaces to something that is different from the operator's namespace.\n+   * Make sure that the domains is not in the operator's target namespaces do not come up.\n+   *   Install an Operator with a namespace and set domainNamespaces in a different namespace\n+   *     from the Operator's namespace, also set domainNamespaceSelectionStrategy to Dedicated\n+   *     for the Operator Helm Chart.\n+   *   Verify the Operator is up and running.\n+   *   Create WebLogic Domain in a namespace that is different from the Operator's namespace.\n+   *   Verify that the domain does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set domainNamespaceSelectionStrategy to Dedicated for the Operator Helm Chart and \"\n+      + \"verify that a domain not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",\n+        true, 0, opHelmParams, domainNamespaceSelectionStrategy,\n+        false, domain2Namespace);\n+\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain2Namespace);\n+    verifyDomainNotRunning(domain2Namespace);\n+  }\n+\n+  /**\n+   * When installing the Operator via helm install,\n+   * set domainNamespaceSelectionStrategy to Dedicated for the Operator Helm Chart.\n+   * Make sure that the domains in the operator's target namespaces comes up.\n+   *   Operator is installed in the test case testDedicatedModeDiffNamespace.\n+   *   Create a WebLogic Domain with the same namespace as Operator's namespace.\n+   *   Verify that the WebLogic domain whose namespace is same as Operator's namespace comes up.\n+   */\n+  @Test\n+  @Order(2)\n+  @DisplayName(\"Set domainNamespaceSelectionStrategy to Dedicated for the Operator Helm Chart and \"\n+      + \"verify that the domain deployed in the operator's namespace comes up\")\n+  public void testDedicatedModeSameNamespace() {\n+    // create and verify the domain\n+    logger.info(\"Creating and verifying model in image domain\");\n+    createDomain(domain1Namespace);\n+    verifyDomainRunning(domain1Namespace);\n+  }\n+\n+  /**\n+   * Test that when domainNamespaceSelectionStrategy is set to Dedicated for the Operator Helm Chart,\n+   * scaling up cluster-1 in domain1Namespace succeeds.\n+   */\n+  @Test\n+  @Order(3)\n+  @DisplayName(\"Scale up cluster-1 in domain1Namespace and verify it succeeds\")\n+  public void testDedicatedModeSameNamespaceScale() {\n+    // scale the cluster and check domain can be managed from the operator\n+    int externalRestHttpsPort = getServiceNodePort(opNamespace, \"external-weblogic-operator-svc\");\n+    logger.info(\"externalRestHttpsPort {0}\", externalRestHttpsPort);\n+\n+    logger.info(\"scaling the cluster from {0} servers to {1} servers\", replicaCount, replicaCount + 1);\n+    scaleAndVerifyCluster(clusterName, domainUid, domain1Namespace,\n+        managedServerPodPrefix, replicaCount, replicaCount + 1,\n+        true, externalRestHttpsPort, opNamespace, opNamespace + \"-sa\",\n+        false, \"\", \"\", 0, \"\",\n+        \"\", null, null);\n+  }\n+\n+  /**\n+   * Test when domainNamespaceSelectionStrategy is set to Dedicated for the Operator Helm Chart and\n+   * the CRD with a lower than expected version is present, Operator fails with error\n+   * if it has no permission to overwrite the CRD.\n+   */\n+  @Test\n+  @Order(4)\n+  @Disabled(\"Disable the test because the Operator has permission to overwrite the CRD\")", "originalCommit": "a9bbd01736cba622a973f865e56fa710f569f457", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwMzc4NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r492203784", "body": "you can add/update the existing opParams\r\n\r\n```\r\n    if (domainNamespaceSelectionStrategy != null) {\r\n          opParams.domainNamespaceSelectionStrategy(domainNamespaceSelectionStrategy);\r\n    }\r\n```", "bodyText": "you can add/update the existing opParams\n    if (domainNamespaceSelectionStrategy != null) {\n          opParams.domainNamespaceSelectionStrategy(domainNamespaceSelectionStrategy);\n    }", "bodyHTML": "<p dir=\"auto\">you can add/update the existing opParams</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    if (domainNamespaceSelectionStrategy != null) {\n          opParams.domainNamespaceSelectionStrategy(domainNamespaceSelectionStrategy);\n    }\"><pre><code>    if (domainNamespaceSelectionStrategy != null) {\n          opParams.domainNamespaceSelectionStrategy(domainNamespaceSelectionStrategy);\n    }\n</code></pre></div>", "author": "vanajamukkara", "createdAt": "2020-09-21T16:46:26Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -372,6 +398,14 @@ public static HelmParams installAndVerifyOperator(String opNamespace,\n         .domainNamespaces(Arrays.asList(domainNamespace))\n         .serviceAccount(opServiceAccount);\n \n+    if (domainNamespaceSelectionStrategy != null) {", "originalCommit": "a9bbd01736cba622a973f865e56fa710f569f457", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjMyOTMxMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r492329310", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-09-21T20:32:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwMzc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNzUxNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r492207516", "body": "are you using domainNamespace in this method when domainNamespaceSelectionStrategy is set?", "bodyText": "are you using domainNamespace in this method when domainNamespaceSelectionStrategy is set?", "bodyHTML": "<p dir=\"auto\">are you using domainNamespace in this method when domainNamespaceSelectionStrategy is set?</p>", "author": "vanajamukkara", "createdAt": "2020-09-21T16:52:47Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItDedicatedMode.java", "diffHunk": "@@ -0,0 +1,385 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import io.kubernetes.client.openapi.models.V1EnvVar;\n+import io.kubernetes.client.openapi.models.V1LocalObjectReference;\n+import io.kubernetes.client.openapi.models.V1ObjectMeta;\n+import io.kubernetes.client.openapi.models.V1SecretReference;\n+import oracle.weblogic.domain.AdminServer;\n+import oracle.weblogic.domain.Cluster;\n+import oracle.weblogic.domain.Configuration;\n+import oracle.weblogic.domain.Domain;\n+import oracle.weblogic.domain.DomainSpec;\n+import oracle.weblogic.domain.Model;\n+import oracle.weblogic.domain.ServerPod;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.Command;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.CommandParams;\n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+import oracle.weblogic.kubernetes.annotations.IntegrationTest;\n+import oracle.weblogic.kubernetes.annotations.Namespaces;\n+import oracle.weblogic.kubernetes.logging.LoggingFacade;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Disabled;\n+import org.junit.jupiter.api.DisplayName;\n+import org.junit.jupiter.api.MethodOrderer;\n+import org.junit.jupiter.api.Order;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.TestMethodOrder;\n+\n+import static oracle.weblogic.kubernetes.TestConstants.ADMIN_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.DOMAIN_API_VERSION;\n+import static oracle.weblogic.kubernetes.TestConstants.MANAGED_SERVER_NAME_BASE;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.MII_BASIC_IMAGE_TAG;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_CHART_DIR;\n+import static oracle.weblogic.kubernetes.TestConstants.OPERATOR_RELEASE_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.REPO_SECRET_NAME;\n+import static oracle.weblogic.kubernetes.TestConstants.WLS_DOMAIN_TYPE;\n+import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;\n+import static oracle.weblogic.kubernetes.actions.TestActions.deleteServiceAccount;\n+import static oracle.weblogic.kubernetes.actions.TestActions.getServiceNodePort;\n+import static oracle.weblogic.kubernetes.actions.TestActions.uninstallOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodDoesNotExist;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.checkPodReadyAndServiceExists;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createDomainAndVerify;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.createSecretWithUsernamePassword;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.installAndVerifyOperator;\n+import static oracle.weblogic.kubernetes.utils.CommonTestUtils.scaleAndVerifyCluster;\n+import static oracle.weblogic.kubernetes.utils.ThreadSafeLogger.getLogger;\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+/**\n+ * The current class verifies various use cases related to domainNamespaceSelectionStrategy.\n+ * For more detail regarding the feature, please refer to\n+ * https://github.com/oracle/weblogic-kubernetes-operator/blob/develop/docs-source/content/\n+ * userguide/managing-operators/using-the-operator/using-helm.md#overall-operator-information.\n+ */\n+@TestMethodOrder(MethodOrderer.OrderAnnotation.class)\n+@DisplayName(\"Test Operator and WebLogic domain with Dedicated set to true\")\n+@IntegrationTest\n+class ItDedicatedMode {\n+  // namespace constants\n+  private static String opNamespace = null;\n+  private static String domain1Namespace = null;\n+  private static String domain2Namespace = null;\n+\n+  // domain constants\n+  private final String domainUid = \"domain1\";\n+  private final String clusterName = \"cluster-1\";\n+  private final int replicaCount = 2;\n+  private final String adminServerPodName = domainUid + \"-\" + ADMIN_SERVER_NAME_BASE;\n+  private final String managedServerPodPrefix = domainUid + \"-\" + MANAGED_SERVER_NAME_BASE;\n+\n+  // operator constants\n+  private static HelmParams opHelmParams;\n+  private static String opServiceAccount;\n+  private static final String domainNamespaceSelectionStrategy = \"Dedicated\";\n+\n+  private static LoggingFacade logger = null;\n+\n+  /**\n+   * Get namespaces for operator and domain2.\n+   *\n+   * @param namespaces list of namespaces created by the IntegrationTestWatcher by the\n+   *                   JUnit engine parameter resolution mechanism.\n+   */\n+  @BeforeAll\n+  public static void initAll(@Namespaces(2) List<String> namespaces) {\n+    logger = getLogger();\n+    // get a unique operator namespace\n+    logger.info(\"Getting a unique namespace for operator\");\n+    assertNotNull(namespaces.get(0), \"Namespace list is null\");\n+    opNamespace = namespaces.get(0);\n+\n+    // in the dedicated mode, the operator only manages domains in the operator's own namespace\n+    domain1Namespace = opNamespace;\n+\n+    // get a new unique domainNamespace\n+    logger.info(\"Assigning a unique namespace for Domain\");\n+    assertNotNull(namespaces.get(1), \"Namespace list is null\");\n+    domain2Namespace = namespaces.get(1);\n+\n+    // Variables for Operator\n+    opServiceAccount = opNamespace + \"-sa\";\n+    opHelmParams =\n+        new HelmParams().releaseName(OPERATOR_RELEASE_NAME)\n+            .namespace(opNamespace)\n+            .chartDir(OPERATOR_CHART_DIR);\n+  }\n+\n+  @AfterAll\n+  public void tearDownAll() {\n+  }\n+\n+  /**\n+   * When installing the Operator via helm install,\n+   * set the Operator Helm Chart parameter domainNamespaceSelectionStrategy to Dedicated and\n+   * set domainNamespaces to something that is different from the operator's namespace.\n+   * Make sure that the domains is not in the operator's target namespaces do not come up.\n+   *   Install an Operator with a namespace and set domainNamespaces in a different namespace\n+   *     from the Operator's namespace, also set domainNamespaceSelectionStrategy to Dedicated\n+   *     for the Operator Helm Chart.\n+   *   Verify the Operator is up and running.\n+   *   Create WebLogic Domain in a namespace that is different from the Operator's namespace.\n+   *   Verify that the domain does not come up.\n+   */\n+  @Test\n+  @Order(1)\n+  @DisplayName(\"Set domainNamespaceSelectionStrategy to Dedicated for the Operator Helm Chart and \"\n+      + \"verify that a domain not deployed in operator's namespace doesn't come up\")\n+  public void testDedicatedModeDiffNamespace() {\n+    // install and verify operator\n+    logger.info(\"Installing and verifying operator\");\n+    installAndVerifyOperator(opNamespace, opNamespace + \"-sa\",", "originalCommit": "a9bbd01736cba622a973f865e56fa710f569f457", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjMwNTAwNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1913#discussion_r492305004", "bodyText": "in dedicated mode, any value for domainNamespaces is ignored, we can pass empty or anything, the Operator will ignore it. The reason the test gives domain2Namespace is for another test case, just want to install the operator once and test all", "author": "hzhao-github", "createdAt": "2020-09-21T19:45:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwNzUxNg=="}], "type": "inlineReview"}, {"oid": "0eb695755c07b28ad71d018f08b6de2e8378d881", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0eb695755c07b28ad71d018f08b6de2e8378d881", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into dedicated-mode-tests", "committedDate": "2020-09-21T20:33:29Z", "type": "commit"}, {"oid": "937bbbfc732a8a3a0210b86b6c1102652257c6df", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/937bbbfc732a8a3a0210b86b6c1102652257c6df", "message": "Syncup w develop and changes based on the comments jenkins-ignore", "committedDate": "2020-09-21T20:34:43Z", "type": "commit"}, {"oid": "fe118ddd826ecab8c0c86188d8b318a1e8874fb4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fe118ddd826ecab8c0c86188d8b318a1e8874fb4", "message": "Added creating CRD jenkins-ignore", "committedDate": "2020-09-23T22:46:53Z", "type": "commit"}, {"oid": "db92c12e1b742f102db530a2f072749d743b056e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/db92c12e1b742f102db530a2f072749d743b056e", "message": "Disable scaling test and syncup with develop branch jenkins-ignore", "committedDate": "2020-09-30T20:26:55Z", "type": "commit"}, {"oid": "8fe8b11f85482199aee25a5ec13cf457db6d8caf", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8fe8b11f85482199aee25a5ec13cf457db6d8caf", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into dedicated-mode-tests", "committedDate": "2020-10-02T01:42:42Z", "type": "commit"}, {"oid": "237a7f50b12cc6ebb89aa529238c5f44379db177", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/237a7f50b12cc6ebb89aa529238c5f44379db177", "message": "Syncup with develop branch jenkins-ignore", "committedDate": "2020-10-02T18:05:19Z", "type": "commit"}, {"oid": "369c5e81504fdf72bb5c455436e22f40bd6eb82a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/369c5e81504fdf72bb5c455436e22f40bd6eb82a", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into dedicated-mode-tests", "committedDate": "2020-10-02T18:23:36Z", "type": "commit"}, {"oid": "1120015b40dc7f4ae4e358721e8b6eb53ad9581e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1120015b40dc7f4ae4e358721e8b6eb53ad9581e", "message": "Syncup with develop branch jenkins-ignore", "committedDate": "2020-10-02T18:45:27Z", "type": "commit"}, {"oid": "7c31c2609d38909c7fd9ccbeb02146e42b9b3587", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7c31c2609d38909c7fd9ccbeb02146e42b9b3587", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into dedicated-mode-tests", "committedDate": "2020-10-05T18:19:20Z", "type": "commit"}, {"oid": "d28cc9c91fcbec2a0b480acf3b5ebf80b0f37115", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d28cc9c91fcbec2a0b480acf3b5ebf80b0f37115", "message": "Added this test suite to sequential run only jenkins-ignore", "committedDate": "2020-10-05T18:39:09Z", "type": "commit"}, {"oid": "6142231d261cca85d88279e2cd5c742ee38326dd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6142231d261cca85d88279e2cd5c742ee38326dd", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into dedicated-mode-tests", "committedDate": "2020-10-06T17:45:51Z", "type": "commit"}, {"oid": "3a93e472d5e89e45373bdbbc944a137d6ac9d0be", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3a93e472d5e89e45373bdbbc944a137d6ac9d0be", "message": "Fixed an error in kindtest.sh jenkins-ignore", "committedDate": "2020-10-06T17:46:41Z", "type": "commit"}]}