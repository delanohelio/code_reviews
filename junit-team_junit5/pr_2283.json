{"pr_number": 2283, "pr_title": "Add possibility to register post-discovery filters via SPI", "pr_author": "baev", "pr_createdAt": "2020-05-01T11:13:13Z", "pr_url": "https://github.com/junit-team/junit5/pull/2283", "timeline": [{"oid": "cb24d1cf515c9ce6e41ea59cbe6f703918aa9c56", "url": "https://github.com/junit-team/junit5/commit/cb24d1cf515c9ce6e41ea59cbe6f703918aa9c56", "message": "introduce post discovery filters configuration properties", "committedDate": "2020-05-01T10:05:05Z", "type": "commit"}, {"oid": "9623ff6d94296b033cb0e13acb56dc72d21f195f", "url": "https://github.com/junit-team/junit5/commit/9623ff6d94296b033cb0e13acb56dc72d21f195f", "message": "add additional post discovery filters to engine discovery orchestrator", "committedDate": "2020-05-01T11:11:12Z", "type": "commit"}, {"oid": "059975404539eb05b2b0833b64a906171ef356aa", "url": "https://github.com/junit-team/junit5/commit/059975404539eb05b2b0833b64a906171ef356aa", "message": "fix test", "committedDate": "2020-05-01T12:01:24Z", "type": "commit"}, {"oid": "b424bb5abef5b7dcac375dde28f910dcc2d9e790", "url": "https://github.com/junit-team/junit5/commit/b424bb5abef5b7dcac375dde28f910dcc2d9e790", "message": "review fixes", "committedDate": "2020-05-01T12:27:34Z", "type": "commit"}, {"oid": "b424bb5abef5b7dcac375dde28f910dcc2d9e790", "url": "https://github.com/junit-team/junit5/commit/b424bb5abef5b7dcac375dde28f910dcc2d9e790", "message": "review fixes", "committedDate": "2020-05-01T12:27:34Z", "type": "forcePushed"}, {"oid": "32311177f3aabadc91e3d0fd2308708706dad926", "url": "https://github.com/junit-team/junit5/commit/32311177f3aabadc91e3d0fd2308708706dad926", "message": "add new service to module info", "committedDate": "2020-05-01T12:46:39Z", "type": "commit"}, {"oid": "a43108cf915c196e28706b9b0d6ea2b2186cec46", "url": "https://github.com/junit-team/junit5/commit/a43108cf915c196e28706b9b0d6ea2b2186cec46", "message": "add spi tests", "committedDate": "2020-05-01T13:14:04Z", "type": "commit"}, {"oid": "67ebd891b45fe985fb78ab8d5beb0e6f1a96536c", "url": "https://github.com/junit-team/junit5/commit/67ebd891b45fe985fb78ab8d5beb0e6f1a96536c", "message": "fix tooling tests", "committedDate": "2020-05-01T13:26:41Z", "type": "commit"}, {"oid": "67ebd891b45fe985fb78ab8d5beb0e6f1a96536c", "url": "https://github.com/junit-team/junit5/commit/67ebd891b45fe985fb78ab8d5beb0e6f1a96536c", "message": "fix tooling tests", "committedDate": "2020-05-01T13:26:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU2Mzg2OQ==", "url": "https://github.com/junit-team/junit5/pull/2283#discussion_r418563869", "body": "nit: we don't use `final` for local variables.\r\n```suggestion\r\n\t\tList<PostDiscoveryFilter> filters = new LinkedList<>(postDiscoveryFilters);\r\n```", "bodyText": "nit: we don't use final for local variables.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tfinal List<PostDiscoveryFilter> filters = new LinkedList<>(postDiscoveryFilters);\n          \n          \n            \n            \t\tList<PostDiscoveryFilter> filters = new LinkedList<>(postDiscoveryFilters);", "bodyHTML": "<p dir=\"auto\">nit: we don't use <code>final</code> for local variables.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t<span class=\"pl-k x x-first\">final</span><span class=\"x x-last\"> </span><span class=\"pl-k\">List&lt;<span class=\"pl-smi\">PostDiscoveryFilter</span>&gt;</span> filters <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-k\">LinkedList&lt;&gt;</span>(postDiscoveryFilters);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t<span class=\"pl-k\">List&lt;<span class=\"pl-smi\">PostDiscoveryFilter</span>&gt;</span> filters <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-k\">LinkedList&lt;&gt;</span>(postDiscoveryFilters);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "marcphilipp", "createdAt": "2020-05-01T14:25:19Z", "path": "junit-platform-launcher/src/main/java/org/junit/platform/launcher/core/EngineDiscoveryOrchestrator.java", "diffHunk": "@@ -82,7 +86,10 @@ public LauncherDiscoveryResult discover(LauncherDiscoveryRequest request, String\n \t\t\ttestEngineDescriptors.put(testEngine, rootDescriptor);\n \t\t}\n \n-\t\tapplyPostDiscoveryFilters(testEngineDescriptors, request.getPostDiscoveryFilters());\n+\t\tfinal List<PostDiscoveryFilter> filters = new LinkedList<>(postDiscoveryFilters);", "originalCommit": "67ebd891b45fe985fb78ab8d5beb0e6f1a96536c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU2NDg5NQ==", "url": "https://github.com/junit-team/junit5/pull/2283#discussion_r418564895", "body": "\u2753 I'm not sure we should be using a `Set` here but then again it's consistent with `engines` above. Thoughts?", "bodyText": "\u2753 I'm not sure we should be using a Set here but then again it's consistent with engines above. Thoughts?", "bodyHTML": "<p dir=\"auto\"><g-emoji class=\"g-emoji\" alias=\"question\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/2753.png\">\u2753</g-emoji> I'm not sure we should be using a <code>Set</code> here but then again it's consistent with <code>engines</code> above. Thoughts?</p>", "author": "marcphilipp", "createdAt": "2020-05-01T14:27:32Z", "path": "junit-platform-launcher/src/main/java/org/junit/platform/launcher/core/LauncherFactory.java", "diffHunk": "@@ -93,7 +94,13 @@ public static Launcher create(LauncherConfig config) throws PreconditionViolatio\n \t\t}\n \t\tengines.addAll(config.getAdditionalTestEngines());\n \n-\t\tLauncher launcher = new DefaultLauncher(engines);\n+\t\tSet<PostDiscoveryFilter> filters = new LinkedHashSet<>();", "originalCommit": "67ebd891b45fe985fb78ab8d5beb0e6f1a96536c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU3ODgyOA==", "url": "https://github.com/junit-team/junit5/pull/2283#discussion_r418578828", "bodyText": "Agree. Totally makes no sense to use set, only for consistency reasons.\nBy having a list instead of set we can kinda keep the order of filters. At some point having possibility to control the orders can give users some advantages", "author": "baev", "createdAt": "2020-05-01T14:58:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU2NDg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU5ODc1NQ==", "url": "https://github.com/junit-team/junit5/pull/2283#discussion_r418598755", "bodyText": "replaced with list for now", "author": "baev", "createdAt": "2020-05-01T15:42:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU2NDg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU2NTI1Mw==", "url": "https://github.com/junit-team/junit5/pull/2283#discussion_r418565253", "body": "Ditto.\r\n```suggestion\r\n\t\tboolean include = object.getTags().stream().map(TestTag::getName).anyMatch(\"test-post-discovery\"::equals);\r\n```", "bodyText": "Ditto.\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tfinal boolean include = object.getTags().stream().map(TestTag::getName).anyMatch(\"test-post-discovery\"::equals);\n          \n          \n            \n            \t\tboolean include = object.getTags().stream().map(TestTag::getName).anyMatch(\"test-post-discovery\"::equals);", "bodyHTML": "<p dir=\"auto\">Ditto.</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">\t\t<span class=\"pl-k x x-first\">final</span><span class=\"x x-last\"> </span><span class=\"pl-k\">boolean</span> include <span class=\"pl-k\">=</span> object<span class=\"pl-k\">.</span>getTags()<span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>map(<span class=\"pl-smi\">TestTag</span><span class=\"pl-k\">::</span>getName)<span class=\"pl-k\">.</span>anyMatch(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test-post-discovery<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">::</span>equals);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">\t\t<span class=\"pl-k\">boolean</span> include <span class=\"pl-k\">=</span> object<span class=\"pl-k\">.</span>getTags()<span class=\"pl-k\">.</span>stream()<span class=\"pl-k\">.</span>map(<span class=\"pl-smi\">TestTag</span><span class=\"pl-k\">::</span>getName)<span class=\"pl-k\">.</span>anyMatch(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>test-post-discovery<span class=\"pl-pds\">\"</span></span><span class=\"pl-k\">::</span>equals);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "marcphilipp", "createdAt": "2020-05-01T14:28:18Z", "path": "platform-tests/src/test/java/org/junit/platform/launcher/TestPostDiscoveryFilter.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junit.platform.launcher;\n+\n+import org.junit.platform.engine.FilterResult;\n+import org.junit.platform.engine.TestDescriptor;\n+import org.junit.platform.engine.TestTag;\n+\n+public class TestPostDiscoveryFilter implements PostDiscoveryFilter {\n+\t@Override\n+\tpublic FilterResult apply(final TestDescriptor object) {\n+\t\tfinal boolean include = object.getTags().stream().map(TestTag::getName).anyMatch(\"test-post-discovery\"::equals);", "originalCommit": "67ebd891b45fe985fb78ab8d5beb0e6f1a96536c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODU2NjUzMg==", "url": "https://github.com/junit-team/junit5/pull/2283#discussion_r418566532", "body": "How about `TestPostDiscoveryTagFilter`?", "bodyText": "How about TestPostDiscoveryTagFilter?", "bodyHTML": "<p dir=\"auto\">How about <code>TestPostDiscoveryTagFilter</code>?</p>", "author": "marcphilipp", "createdAt": "2020-05-01T14:31:01Z", "path": "platform-tests/src/test/java/org/junit/platform/launcher/TestPostDiscoveryFilter.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * https://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junit.platform.launcher;\n+\n+import org.junit.platform.engine.FilterResult;\n+import org.junit.platform.engine.TestDescriptor;\n+import org.junit.platform.engine.TestTag;\n+\n+public class TestPostDiscoveryFilter implements PostDiscoveryFilter {", "originalCommit": "67ebd891b45fe985fb78ab8d5beb0e6f1a96536c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "689fcf17021e45f33e4221f03381ff6bef47a6de", "url": "https://github.com/junit-team/junit5/commit/689fcf17021e45f33e4221f03381ff6bef47a6de", "message": "get rid of final modifier\n\nCo-authored-by: Marc Philipp <marc@gradle.com>", "committedDate": "2020-05-01T14:58:55Z", "type": "commit"}, {"oid": "c92a9f9f6338e961de48443a80656fda7cf76483", "url": "https://github.com/junit-team/junit5/commit/c92a9f9f6338e961de48443a80656fda7cf76483", "message": "get rid of final modifier 2\n\nCo-authored-by: Marc Philipp <marc@gradle.com>", "committedDate": "2020-05-01T14:59:23Z", "type": "commit"}, {"oid": "5d2bcf760cc42763191e7569e3d5345acd382ef1", "url": "https://github.com/junit-team/junit5/commit/5d2bcf760cc42763191e7569e3d5345acd382ef1", "message": "review fixes 2", "committedDate": "2020-05-01T15:41:53Z", "type": "commit"}, {"oid": "4a4b3cf93d1f55ed6114793b4682ab2e2a2f9b21", "url": "https://github.com/junit-team/junit5/commit/4a4b3cf93d1f55ed6114793b4682ab2e2a2f9b21", "message": "Document SPI support for PostDiscoveryFilter", "committedDate": "2020-05-31T19:11:02Z", "type": "commit"}, {"oid": "d8ae6d8ee2bab799427a4df6a06a23d2abac1e56", "url": "https://github.com/junit-team/junit5/commit/d8ae6d8ee2bab799427a4df6a06a23d2abac1e56", "message": "Add missing API annotations", "committedDate": "2020-05-31T19:18:15Z", "type": "commit"}, {"oid": "67c2c59f9a1a2918088a247b6be37dd551397a7a", "url": "https://github.com/junit-team/junit5/commit/67c2c59f9a1a2918088a247b6be37dd551397a7a", "message": "Merge branch 'master' into 1997-spi-post-discovery-filter", "committedDate": "2020-05-31T19:19:22Z", "type": "commit"}]}