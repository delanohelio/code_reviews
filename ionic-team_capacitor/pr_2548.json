{"pr_number": 2548, "pr_title": "feat(android): added configurable icon color for local notifications", "pr_author": "andysousa", "pr_createdAt": "2020-03-10T15:07:43Z", "pr_url": "https://github.com/ionic-team/capacitor/pull/2548", "timeline": [{"oid": "b1ec8cbf28bc23aa3a3f05d468f8668d399f65e9", "url": "https://github.com/ionic-team/capacitor/commit/b1ec8cbf28bc23aa3a3f05d468f8668d399f65e9", "message": "added configurable icon color for android local notifications", "committedDate": "2020-03-10T15:01:31Z", "type": "commit"}, {"oid": "627cf9718877b925d048d75cb743c5b6260f52c3", "url": "https://github.com/ionic-team/capacitor/commit/627cf9718877b925d048d75cb743c5b6260f52c3", "message": "updated the api documentation for webpage", "committedDate": "2020-03-10T18:06:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI1NDIxMw==", "url": "https://github.com/ionic-team/capacitor/pull/2548#discussion_r393254213", "body": "this crash if the color is not valid, put it inside a try catch (check other plugins like Browser or Statusbar)", "bodyText": "this crash if the color is not valid, put it inside a try catch (check other plugins like Browser or Statusbar)", "bodyHTML": "<p dir=\"auto\">this crash if the color is not valid, put it inside a try catch (check other plugins like Browser or Statusbar)</p>", "author": "jcesarmobile", "createdAt": "2020-03-16T19:10:43Z", "path": "android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java", "diffHunk": "@@ -174,6 +175,12 @@ private void buildNotification(NotificationManagerCompat notificationManager, Lo\n     mBuilder.setOnlyAlertOnce(true);\n \n     mBuilder.setSmallIcon(localNotification.getSmallIcon(context));\n+\n+    String iconColor = localNotification.getIconColor();\n+    if (iconColor != null) {\n+      mBuilder.setColor(Color.parseColor(iconColor));", "originalCommit": "627cf9718877b925d048d75cb743c5b6260f52c3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2403ed4fcd6f5c1b54b0160fa3c000993779fa70", "changed_code": [{"header": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java b/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\nindex 92b1a8e5..7f0515e1 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\n", "chunk": "@@ -178,7 +178,12 @@ public class LocalNotificationManager {\n \n     String iconColor = localNotification.getIconColor();\n     if (iconColor != null) {\n-      mBuilder.setColor(Color.parseColor(iconColor));\n+      try {\n+        mBuilder.setColor(Color.parseColor(iconColor));\n+      } catch (Exception ex) {\n+        call.error(\"The iconColor string was not able to be parsed.  Please provide a valid string hexidecimal color code.\", ex);\n+        return;\n+      }\n     }\n \n     createActionIntents(localNotification, mBuilder);\n", "next_change": {"commit": "96418553c00763221e5a1635720ecd91b5e42005", "changed_code": [{"header": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java b/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\nindex 7f0515e1..4be48eb9 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\n", "chunk": "@@ -180,8 +180,8 @@ public class LocalNotificationManager {\n     if (iconColor != null) {\n       try {\n         mBuilder.setColor(Color.parseColor(iconColor));\n-      } catch (Exception ex) {\n-        call.error(\"The iconColor string was not able to be parsed.  Please provide a valid string hexidecimal color code.\", ex);\n+      } catch (IllegalArgumentException ex) {\n+        call.error(\"Invalid color provided. Must be a hex string (ex: #ff0000\");\n         return;\n       }\n     }\n", "next_change": null}]}}]}}, {"oid": "2403ed4fcd6f5c1b54b0160fa3c000993779fa70", "url": "https://github.com/ionic-team/capacitor/commit/2403ed4fcd6f5c1b54b0160fa3c000993779fa70", "message": "catch exception for bad color string", "committedDate": "2020-03-16T19:30:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYwMDQ0MQ==", "url": "https://github.com/ionic-team/capacitor/pull/2548#discussion_r393600441", "body": "For consistency, better use the same error message as Status Bar plugin\r\n\r\n```suggestion\r\n        call.error(\"Invalid color provided. Must be a hex string (ex: #ff0000\");\r\n```", "bodyText": "For consistency, better use the same error message as Status Bar plugin\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    call.error(\"The iconColor string was not able to be parsed.  Please provide a valid string hexidecimal color code.\", ex);\n          \n          \n            \n                    call.error(\"Invalid color provided. Must be a hex string (ex: #ff0000\");", "bodyHTML": "<p dir=\"auto\">For consistency, better use the same error message as Status Bar plugin</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        call<span class=\"pl-k\">.</span>error(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">The iconColor string was not able to </span>be <span class=\"x x-first x-last\">parsed.  Please provide a valid</span> string <span class=\"x x-first\">hexidecimal color code.</span><span class=\"pl-pds x\">\"</span></span><span class=\"x x-last\">, ex</span>);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        call<span class=\"pl-k\">.</span>error(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"x x-first x-last\">Invalid color provided. Must </span>be <span class=\"x x-first x-last\">a hex</span> string <span class=\"x x-first\">(ex: #ff0000</span><span class=\"pl-pds x x-last\">\"</span></span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "jcesarmobile", "createdAt": "2020-03-17T11:07:39Z", "path": "android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java", "diffHunk": "@@ -174,6 +175,17 @@ private void buildNotification(NotificationManagerCompat notificationManager, Lo\n     mBuilder.setOnlyAlertOnce(true);\n \n     mBuilder.setSmallIcon(localNotification.getSmallIcon(context));\n+\n+    String iconColor = localNotification.getIconColor();\n+    if (iconColor != null) {\n+      try {\n+        mBuilder.setColor(Color.parseColor(iconColor));\n+      } catch (Exception ex) {\n+        call.error(\"The iconColor string was not able to be parsed.  Please provide a valid string hexidecimal color code.\", ex);", "originalCommit": "2403ed4fcd6f5c1b54b0160fa3c000993779fa70", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg0ODkwNw==", "url": "https://github.com/ionic-team/capacitor/pull/2548#discussion_r393848907", "bodyText": "fixed", "author": "andysousa", "createdAt": "2020-03-17T17:28:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYwMDQ0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "96418553c00763221e5a1635720ecd91b5e42005", "changed_code": [{"header": "diff --git a/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java b/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\nindex 7f0515e1..4be48eb9 100644\n--- a/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\n+++ b/android/capacitor/src/main/java/com/getcapacitor/plugin/notification/LocalNotificationManager.java\n", "chunk": "@@ -180,8 +180,8 @@ public class LocalNotificationManager {\n     if (iconColor != null) {\n       try {\n         mBuilder.setColor(Color.parseColor(iconColor));\n-      } catch (Exception ex) {\n-        call.error(\"The iconColor string was not able to be parsed.  Please provide a valid string hexidecimal color code.\", ex);\n+      } catch (IllegalArgumentException ex) {\n+        call.error(\"Invalid color provided. Must be a hex string (ex: #ff0000\");\n         return;\n       }\n     }\n", "next_change": null}]}}, {"oid": "96418553c00763221e5a1635720ecd91b5e42005", "url": "https://github.com/ionic-team/capacitor/commit/96418553c00763221e5a1635720ecd91b5e42005", "message": "PR feedback", "committedDate": "2020-03-17T17:25:58Z", "type": "commit"}]}