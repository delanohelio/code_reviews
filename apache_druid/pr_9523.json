{"pr_number": 9523, "pr_title": "Ability to Delete task logs and segments from Azure Storage", "pr_author": "zachjsh", "pr_createdAt": "2020-03-17T01:46:50Z", "pr_url": "https://github.com/apache/druid/pull/9523", "timeline": [{"oid": "752a819d3b17883165f893c09d7f97eab6d090b7", "url": "https://github.com/apache/druid/commit/752a819d3b17883165f893c09d7f97eab6d090b7", "message": "Ability to Delete task logs and segments from Azure Storage\n\n* implement ability to delete all tasks logs or all task logs\n  written before a particular date when written to Azure storage\n\n* implement ability to delete all segments from Azure deep storage", "committedDate": "2020-03-17T01:44:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4MjMwNA==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394182304", "body": "nit: formatting\r\n\r\n```suggestion\r\n    log.info(\r\n        \"Deleting all segment files from Azure storage location [bucket: '%s' prefix: '%s']\",\r\n        segmentConfig.getContainer(),\r\n        segmentConfig.getPrefix()\r\n    );\r\n```", "bodyText": "nit: formatting\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                log.info(\"Deleting all segment files from Azure storage location [bucket: '%s' prefix: '%s']\",\n          \n          \n            \n                         segmentConfig.getContainer(), segmentConfig.getPrefix()\n          \n          \n            \n                );\n          \n          \n            \n                log.info(\n          \n          \n            \n                    \"Deleting all segment files from Azure storage location [bucket: '%s' prefix: '%s']\",\n          \n          \n            \n                    segmentConfig.getContainer(),\n          \n          \n            \n                    segmentConfig.getPrefix()\n          \n          \n            \n                );", "bodyHTML": "<p dir=\"auto\">nit: formatting</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"95\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    log<span class=\"pl-k\">.</span>info(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Deleting all segment files from Azure storage location [bucket: '%s' prefix: '%s']<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"96\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">             segmentConfig<span class=\"pl-k\">.</span>getContainer(), segmentConfig<span class=\"pl-k\">.</span>getPrefix()</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"97\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    );</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"95\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    log<span class=\"pl-k\">.</span>info(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"96\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Deleting all segment files from Azure storage location [bucket: '%s' prefix: '%s']<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"97\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        segmentConfig<span class=\"pl-k\">.</span>getContainer(),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"98\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        segmentConfig<span class=\"pl-k\">.</span>getPrefix()</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"99\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    );</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "clintropolis", "createdAt": "2020-03-18T08:42:27Z", "path": "extensions-core/azure-extensions/src/main/java/org/apache/druid/storage/azure/AzureDataSegmentKiller.java", "diffHunk": "@@ -72,9 +86,26 @@ public void kill(DataSegment segment) throws SegmentLoadingException\n   }\n \n   @Override\n-  public void killAll()\n+  public void killAll() throws IOException\n   {\n-    throw new UnsupportedOperationException(\"not implemented\");\n+    log.info(\"Deleting all segment files from Azure storage location [bucket: '%s' prefix: '%s']\",\n+             segmentConfig.getContainer(), segmentConfig.getPrefix()\n+    );", "originalCommit": "752a819d3b17883165f893c09d7f97eab6d090b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4MDU4OA==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394680588", "bodyText": "done", "author": "zachjsh", "createdAt": "2020-03-18T22:41:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4MjMwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4Mjg1MQ==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394182851", "body": "Heh, should probably be\r\n\r\n```suggestion\r\n      log.error(\"Error occurred while deleting segment files from Azure. Error: %s\", e.getMessage());\r\n```", "bodyText": "Heh, should probably be\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  log.error(\"Error occurred while deleting segment files from s3. Error: %s\", e.getMessage());\n          \n          \n            \n                  log.error(\"Error occurred while deleting segment files from Azure. Error: %s\", e.getMessage());", "bodyHTML": "<p dir=\"auto\">Heh, should probably be</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      log<span class=\"pl-k\">.</span>error(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Error occurred while deleting segment files from <span class=\"x x-first x-last\">s3</span>. Error: %s<span class=\"pl-pds\">\"</span></span>, e<span class=\"pl-k\">.</span>getMessage());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      log<span class=\"pl-k\">.</span>error(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Error occurred while deleting segment files from <span class=\"x x-first x-last\">Azure</span>. Error: %s<span class=\"pl-pds\">\"</span></span>, e<span class=\"pl-k\">.</span>getMessage());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "clintropolis", "createdAt": "2020-03-18T08:43:25Z", "path": "extensions-core/azure-extensions/src/main/java/org/apache/druid/storage/azure/AzureDataSegmentKiller.java", "diffHunk": "@@ -72,9 +86,26 @@ public void kill(DataSegment segment) throws SegmentLoadingException\n   }\n \n   @Override\n-  public void killAll()\n+  public void killAll() throws IOException\n   {\n-    throw new UnsupportedOperationException(\"not implemented\");\n+    log.info(\"Deleting all segment files from Azure storage location [bucket: '%s' prefix: '%s']\",\n+             segmentConfig.getContainer(), segmentConfig.getPrefix()\n+    );\n+    try {\n+      AzureUtils.deleteObjectsInPath(\n+          azureStorage,\n+          inputDataConfig,\n+          accountConfig,\n+          azureCloudBlobIterableFactory,\n+          segmentConfig.getContainer(),\n+          segmentConfig.getPrefix(),\n+          Predicates.alwaysTrue()\n+      );\n+    }\n+    catch (Exception e) {\n+      log.error(\"Error occurred while deleting segment files from s3. Error: %s\", e.getMessage());", "originalCommit": "752a819d3b17883165f893c09d7f97eab6d090b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4MDU2NQ==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394680565", "bodyText": "done", "author": "zachjsh", "createdAt": "2020-03-18T22:41:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4Mjg1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4MzMwNw==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394183307", "body": "same wrong cloud\r\n```suggestion\r\n      log.error(\"Error occurred while deleting task log files from Azure. Error: %s\", e.getMessage());\r\n```", "bodyText": "same wrong cloud\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  log.error(\"Error occurred while deleting task log files from s3. Error: %s\", e.getMessage());\n          \n          \n            \n                  log.error(\"Error occurred while deleting task log files from Azure. Error: %s\", e.getMessage());", "bodyHTML": "<p dir=\"auto\">same wrong cloud</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      log<span class=\"pl-k\">.</span>error(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Error occurred while deleting task log files from <span class=\"x x-first x-last\">s3</span>. Error: %s<span class=\"pl-pds\">\"</span></span>, e<span class=\"pl-k\">.</span>getMessage());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      log<span class=\"pl-k\">.</span>error(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Error occurred while deleting task log files from <span class=\"x x-first x-last\">Azure</span>. Error: %s<span class=\"pl-pds\">\"</span></span>, e<span class=\"pl-k\">.</span>getMessage());</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "clintropolis", "createdAt": "2020-03-18T08:44:11Z", "path": "extensions-core/azure-extensions/src/main/java/org/apache/druid/storage/azure/AzureTaskLogs.java", "diffHunk": "@@ -151,14 +167,36 @@ private String getTaskReportsKey(String taskid)\n   }\n \n   @Override\n-  public void killAll()\n+  public void killAll() throws IOException\n   {\n-    throw new UnsupportedOperationException(\"not implemented\");\n+    log.info(\"Deleting all task logs from Azure storage location [bucket: %s    prefix: %s].\",\n+             config.getContainer(), config.getPrefix()\n+    );\n+\n+    long now = timeSupplier.getAsLong();\n+    killOlderThan(now);\n   }\n \n   @Override\n-  public void killOlderThan(long timestamp)\n+  public void killOlderThan(long timestamp) throws IOException\n   {\n-    throw new UnsupportedOperationException(\"not implemented\");\n+    log.info(\"Deleting all task logs from Azure storage location [bucket: '%s' prefix: '%s'] older than %s.\",\n+             config.getContainer(), config.getPrefix(), new Date(timestamp)\n+    );\n+    try {\n+      AzureUtils.deleteObjectsInPath(\n+          azureStorage,\n+          inputDataConfig,\n+          accountConfig,\n+          azureCloudBlobIterableFactory,\n+          config.getContainer(),\n+          config.getPrefix(),\n+          (object) -> object.getLastModifed().getTime() < timestamp\n+      );\n+    }\n+    catch (Exception e) {\n+      log.error(\"Error occurred while deleting task log files from s3. Error: %s\", e.getMessage());", "originalCommit": "752a819d3b17883165f893c09d7f97eab6d090b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4MDUzNg==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394680536", "bodyText": "done", "author": "zachjsh", "createdAt": "2020-03-18T22:41:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4MzMwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4Mzc1NA==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394183754", "body": "same comment about 1 line per arg formatting if spans multiple lines\r\n```suggestion\r\n    log.info(\r\n        \"Deleting all task logs from Azure storage location [bucket: %s    prefix: %s].\",\r\n        config.getContainer(),\r\n        config.getPrefix()\r\n    );\r\n```", "bodyText": "same comment about 1 line per arg formatting if spans multiple lines\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                log.info(\"Deleting all task logs from Azure storage location [bucket: %s    prefix: %s].\",\n          \n          \n            \n                         config.getContainer(), config.getPrefix()\n          \n          \n            \n                );\n          \n          \n            \n                log.info(\n          \n          \n            \n                    \"Deleting all task logs from Azure storage location [bucket: %s    prefix: %s].\",\n          \n          \n            \n                    config.getContainer(),\n          \n          \n            \n                    config.getPrefix()\n          \n          \n            \n                );", "bodyHTML": "<p dir=\"auto\">same comment about 1 line per arg formatting if spans multiple lines</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"176\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    log<span class=\"pl-k\">.</span>info(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Deleting all task logs from Azure storage location [bucket: %s    prefix: %s].<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"177\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">             config<span class=\"pl-k\">.</span>getContainer(), config<span class=\"pl-k\">.</span>getPrefix()</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"178\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    );</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"176\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    log<span class=\"pl-k\">.</span>info(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"177\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Deleting all task logs from Azure storage location [bucket: %s    prefix: %s].<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"178\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        config<span class=\"pl-k\">.</span>getContainer(),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"179\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        config<span class=\"pl-k\">.</span>getPrefix()</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"180\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    );</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "clintropolis", "createdAt": "2020-03-18T08:45:05Z", "path": "extensions-core/azure-extensions/src/main/java/org/apache/druid/storage/azure/AzureTaskLogs.java", "diffHunk": "@@ -151,14 +167,36 @@ private String getTaskReportsKey(String taskid)\n   }\n \n   @Override\n-  public void killAll()\n+  public void killAll() throws IOException\n   {\n-    throw new UnsupportedOperationException(\"not implemented\");\n+    log.info(\"Deleting all task logs from Azure storage location [bucket: %s    prefix: %s].\",\n+             config.getContainer(), config.getPrefix()\n+    );", "originalCommit": "752a819d3b17883165f893c09d7f97eab6d090b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4MDQ5OA==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394680498", "bodyText": "done", "author": "zachjsh", "createdAt": "2020-03-18T22:41:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4Mzc1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4NDM4MA==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394184380", "body": "same formatting nit:\r\n```suggestion\r\n    log.info(\r\n        \"Deleting all task logs from Azure storage location [bucket: '%s' prefix: '%s'] older than %s.\",\r\n        config.getContainer(),\r\n        config.getPrefix(),\r\n        new Date(timestamp)\r\n    );\r\n```\r\nsorry there isn't a style rule for this, last we checked it wasn't possible to do, but it's been a while so it might be worth checking on again...", "bodyText": "same formatting nit:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                log.info(\"Deleting all task logs from Azure storage location [bucket: '%s' prefix: '%s'] older than %s.\",\n          \n          \n            \n                         config.getContainer(), config.getPrefix(), new Date(timestamp)\n          \n          \n            \n                );\n          \n          \n            \n                log.info(\n          \n          \n            \n                    \"Deleting all task logs from Azure storage location [bucket: '%s' prefix: '%s'] older than %s.\",\n          \n          \n            \n                    config.getContainer(),\n          \n          \n            \n                    config.getPrefix(),\n          \n          \n            \n                    new Date(timestamp)\n          \n          \n            \n                );\n          \n      \n    \n    \n  \n\nsorry there isn't a style rule for this, last we checked it wasn't possible to do, but it's been a while so it might be worth checking on again...", "bodyHTML": "<p dir=\"auto\">same formatting nit:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"190\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    log<span class=\"pl-k\">.</span>info(<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Deleting all task logs from Azure storage location [bucket: '%s' prefix: '%s'] older than %s.<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"191\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">             config<span class=\"pl-k\">.</span>getContainer(), config<span class=\"pl-k\">.</span>getPrefix(), <span class=\"pl-k\">new</span> <span class=\"pl-smi\">Date</span>(timestamp)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"192\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">    );</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"190\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    log<span class=\"pl-k\">.</span>info(</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"191\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Deleting all task logs from Azure storage location [bucket: '%s' prefix: '%s'] older than %s.<span class=\"pl-pds\">\"</span></span>,</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"192\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        config<span class=\"pl-k\">.</span>getContainer(),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"193\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        config<span class=\"pl-k\">.</span>getPrefix(),</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"194\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">new</span> <span class=\"pl-smi\">Date</span>(timestamp)</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"195\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">    );</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">sorry there isn't a style rule for this, last we checked it wasn't possible to do, but it's been a while so it might be worth checking on again...</p>", "author": "clintropolis", "createdAt": "2020-03-18T08:46:14Z", "path": "extensions-core/azure-extensions/src/main/java/org/apache/druid/storage/azure/AzureTaskLogs.java", "diffHunk": "@@ -151,14 +167,36 @@ private String getTaskReportsKey(String taskid)\n   }\n \n   @Override\n-  public void killAll()\n+  public void killAll() throws IOException\n   {\n-    throw new UnsupportedOperationException(\"not implemented\");\n+    log.info(\"Deleting all task logs from Azure storage location [bucket: %s    prefix: %s].\",\n+             config.getContainer(), config.getPrefix()\n+    );\n+\n+    long now = timeSupplier.getAsLong();\n+    killOlderThan(now);\n   }\n \n   @Override\n-  public void killOlderThan(long timestamp)\n+  public void killOlderThan(long timestamp) throws IOException\n   {\n-    throw new UnsupportedOperationException(\"not implemented\");\n+    log.info(\"Deleting all task logs from Azure storage location [bucket: '%s' prefix: '%s'] older than %s.\",\n+             config.getContainer(), config.getPrefix(), new Date(timestamp)\n+    );", "originalCommit": "752a819d3b17883165f893c09d7f97eab6d090b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY4MDQ2Nw==", "url": "https://github.com/apache/druid/pull/9523#discussion_r394680467", "bodyText": "done", "author": "zachjsh", "createdAt": "2020-03-18T22:40:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4NDM4MA=="}], "type": "inlineReview"}, {"oid": "92ec5a90038efed64a47a4228d81f80e5b775ebb", "url": "https://github.com/apache/druid/commit/92ec5a90038efed64a47a4228d81f80e5b775ebb", "message": "* Address review comments", "committedDate": "2020-03-18T22:40:14Z", "type": "commit"}]}