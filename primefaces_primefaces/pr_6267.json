{"pr_number": 6267, "pr_title": "Fix #5978: FileDownload: add Ajax support", "pr_author": "jepsar", "pr_createdAt": "2020-08-30T14:58:46Z", "pr_url": "https://github.com/primefaces/primefaces/pull/6267", "timeline": [{"oid": "1f033c75aaded2b4cabb7e60d6f70d95b4029aeb", "url": "https://github.com/primefaces/primefaces/commit/1f033c75aaded2b4cabb7e60d6f70d95b4029aeb", "message": "fileDownload add Ajax support", "committedDate": "2020-08-30T14:53:52Z", "type": "commit"}, {"oid": "c31f130ccbcddc42ae1d95dba6d746cd7be4f084", "url": "https://github.com/primefaces/primefaces/commit/c31f130ccbcddc42ae1d95dba6d746cd7be4f084", "message": "Reverted indexed for loop", "committedDate": "2020-08-30T18:15:36Z", "type": "commit"}, {"oid": "0d50cd9461425101047c1cced3bea35b31f64b43", "url": "https://github.com/primefaces/primefaces/commit/0d50cd9461425101047c1cced3bea35b31f64b43", "message": "Merge branch 'master' into fix_5978", "committedDate": "2020-09-01T17:37:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzNzU3NA==", "url": "https://github.com/primefaces/primefaces/pull/6267#discussion_r481337574", "body": "@tandraschko are you referring to this line? If so, src could be null originally:\r\n\r\nhttps://github.com/primefaces/primefaces/blob/d05387b93bd5fc68d825bc5d325cc49472110cf5/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java#L127\r\n\r\nShall I change that into throwing a FacesException? ", "bodyText": "@tandraschko are you referring to this line? If so, src could be null originally:\n\n  \n    \n      primefaces/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java\n    \n    \n         Line 127\n      in\n      d05387b\n    \n    \n    \n    \n\n        \n          \n           src = ResourceUtils.appendCacheBuster(src, cache); \n        \n    \n  \n\n\nShall I change that into throwing a FacesException?", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tandraschko/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tandraschko\">@tandraschko</a> are you referring to this line? If so, src could be null originally:</p>\n<p dir=\"auto\"><div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/primefaces/primefaces/blob/d05387b93bd5fc68d825bc5d325cc49472110cf5/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java#L127\">primefaces/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 127\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/primefaces/primefaces/commit/d05387b93bd5fc68d825bc5d325cc49472110cf5\">d05387b</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L127\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"127\"></td>\n          <td id=\"LC127\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> src <span class=\"pl-k\">=</span> <span class=\"pl-smi\">ResourceUtils</span><span class=\"pl-k\">.</span>appendCacheBuster(src, cache); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>\n<p dir=\"auto\">Shall I change that into throwing a FacesException?</p>", "author": "jepsar", "createdAt": "2020-09-01T18:12:15Z", "path": "src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java", "diffHunk": "@@ -65,36 +63,43 @@ public static String build(FacesContext context, Object value, UIComponent compo\n         }\n         else if (value instanceof String) {\n             src = ResourceUtils.getResourceURL(context, (String) value);\n+            return encodeResourceURL(context, src, cache);\n         }\n         else if (value instanceof StreamedContent) {\n             StreamedContent streamedContent = (StreamedContent) value;\n-\n-            if (stream) {\n-                Resource resource = context.getApplication().getResourceHandler().createResource(\n-                        \"dynamiccontent.properties\", \"primefaces\", streamedContent.getContentType());\n-                String resourcePath = resource.getRequestPath();\n-\n-                Map<String, Object> session = context.getExternalContext().getSessionMap();\n-                Map<String, String> dynamicResourcesMapping = (Map) session.get(Constants.DYNAMIC_RESOURCES_MAPPING);\n-                if (dynamicResourcesMapping == null) {\n-                    dynamicResourcesMapping = new LimitedSizeHashMap<>(200);\n-                    session.put(Constants.DYNAMIC_RESOURCES_MAPPING, dynamicResourcesMapping);\n-                }\n-\n-                ValueExpression expression = ValueExpressionAnalyzer.getExpression(\n+            ValueExpression expression = ValueExpressionAnalyzer.getExpression(\n                         context.getELContext(), component.getValueExpression(attributeName));\n+            return build(context, streamedContent, component, cache, type, stream, expression);\n+        }\n+        return encodeResourceURL(context, src, cache);", "originalCommit": "0d50cd9461425101047c1cced3bea35b31f64b43", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "94d24f6cfa42c89e53b6e34aa8de3b198bddd14b", "url": "https://github.com/primefaces/primefaces/commit/94d24f6cfa42c89e53b6e34aa8de3b198bddd14b", "message": "Return null if no supported value type was found", "committedDate": "2020-09-01T18:21:16Z", "type": "commit"}, {"oid": "2ffc3e58fca6ac393c21a1af16af2d1bf872a78e", "url": "https://github.com/primefaces/primefaces/commit/2ffc3e58fca6ac393c21a1af16af2d1bf872a78e", "message": "Added download.js", "committedDate": "2020-09-01T18:23:59Z", "type": "commit"}, {"oid": "4b000b3813311050dba5d9546fcd0aeb71b86116", "url": "https://github.com/primefaces/primefaces/commit/4b000b3813311050dba5d9546fcd0aeb71b86116", "message": "Alphabetical order", "committedDate": "2020-09-01T19:30:29Z", "type": "commit"}]}