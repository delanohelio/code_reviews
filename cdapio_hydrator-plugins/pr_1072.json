{"pr_number": 1072, "pr_title": "Macro support for format field in AbstractFileSource, AbstractFileSink", "pr_createdAt": "2020-04-07T19:58:43Z", "pr_url": "https://github.com/cdapio/hydrator-plugins/pull/1072", "merge_commit": "e34cbdc41193d5648f3be9344bf86bec99a00f81", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgzMDgyMQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r405830821", "body": "are there any format properties that are required by some formats and optional for others? If so, this can run into errors", "bodyText": "are there any format properties that are required by some formats and optional for others? If so, this can run into errors", "bodyHTML": "<p dir=\"auto\">are there any format properties that are required by some formats and optional for others? If so, this can run into errors</p>", "author": "albertshau", "createdAt": "2020-04-08T21:39:00Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java", "diffHunk": "@@ -64,10 +64,20 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n     // invalid\n     collector.getOrThrowException();\n \n+    if (config.containsMacro(NAME_FORMAT)) {\n+      // Deploy all format plugins. This ensures that the required plugin is available when\n+      // the format macro is evaluated in prepareRun,\n+      for (FileFormat f: FileFormat.values()) {\n+        pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, f.name().toLowerCase(), f.name().toLowerCase(),", "originalCommit": "ec914a3cb4a276aff0411626a209abb05399648d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQzOTU4OA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r406439588", "bodyText": "Thanks for pointing this out. Handled InvalidPluginConfigException as discussed offline.", "author": "rmstar", "createdAt": "2020-04-09T19:51:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgzMDgyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "e98874430ac2414ca41b68234754181c185c90f3", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex e213f702..49a69f23 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -66,10 +73,16 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n \n     if (config.containsMacro(NAME_FORMAT)) {\n       // Deploy all format plugins. This ensures that the required plugin is available when\n-      // the format macro is evaluated in prepareRun,\n+      // the format macro is evaluated in prepareRun.\n       for (FileFormat f: FileFormat.values()) {\n-        pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, f.name().toLowerCase(), f.name().toLowerCase(),\n-                                     config.getRawProperties());\n+        try {\n+          pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, f.name().toLowerCase(),\n+                                       f.name().toLowerCase(), config.getRawProperties());\n+        } catch (InvalidPluginConfigException e) {\n+          LOG.warn(\"Failed to register format '{}', which means it cannot be used when the pipeline is run. \" +\n+                     \"Missing properties: {}, invalid properties: {}\", f.name(), e.getMissingProperties(),\n+                   e.getInvalidProperties().stream().map(InvalidPluginProperty::getName).collect(Collectors.toList()));\n+        }\n       }\n       return;\n     }\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2NjM0OA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r406866348", "body": "error messages should inform the reader about the implications. Something like:\r\n\r\nFailed to register format '{}', which means it cannot be used when the pipeline is run. Missing properties ...", "bodyText": "error messages should inform the reader about the implications. Something like:\nFailed to register format '{}', which means it cannot be used when the pipeline is run. Missing properties ...", "bodyHTML": "<p dir=\"auto\">error messages should inform the reader about the implications. Something like:</p>\n<p dir=\"auto\">Failed to register format '{}', which means it cannot be used when the pipeline is run. Missing properties ...</p>", "author": "albertshau", "createdAt": "2020-04-10T17:43:26Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java", "diffHunk": "@@ -64,10 +68,25 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n     // invalid\n     collector.getOrThrowException();\n \n+    if (config.containsMacro(NAME_FORMAT)) {\n+      // Deploy all format plugins. This ensures that the required plugin is available when\n+      // the format macro is evaluated in prepareRun,\n+      for (FileFormat f: FileFormat.values()) {\n+        try {\n+          pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, f.name().toLowerCase(),\n+                                       f.name().toLowerCase(), config.getRawProperties());\n+        } catch (InvalidPluginConfigException e) {\n+          LOG.warn(\"Failed to configure {}, missing properties: {}, invalid properties: {}\",", "originalCommit": "1d8ab12865187d47c4609d7622a12a83ad967d17", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e98874430ac2414ca41b68234754181c185c90f3", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex a3606065..49a69f23 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -70,14 +73,15 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n \n     if (config.containsMacro(NAME_FORMAT)) {\n       // Deploy all format plugins. This ensures that the required plugin is available when\n-      // the format macro is evaluated in prepareRun,\n+      // the format macro is evaluated in prepareRun.\n       for (FileFormat f: FileFormat.values()) {\n         try {\n           pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, f.name().toLowerCase(),\n                                        f.name().toLowerCase(), config.getRawProperties());\n         } catch (InvalidPluginConfigException e) {\n-          LOG.warn(\"Failed to configure {}, missing properties: {}, invalid properties: {}\",\n-                   f.name(), e.getMissingProperties(), e.getInvalidProperties());\n+          LOG.warn(\"Failed to register format '{}', which means it cannot be used when the pipeline is run. \" +\n+                     \"Missing properties: {}, invalid properties: {}\", f.name(), e.getMissingProperties(),\n+                   e.getInvalidProperties().stream().map(InvalidPluginProperty::getName).collect(Collectors.toList()));\n         }\n       }\n       return;\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2ODg4Ng==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r406868886", "body": "In general, avoid this type of pattern where an exception is caught, logged, and then re-thrown. What ends up happening is that the error gets logged here and then later on by the caller, generating extra logs and confusing the user.\r\n\r\nInstead, you can wrap the exception with a more specific error message and propagate it up. Something like:\r\n\r\n```\r\nthrow new IllegalArgumentException(\"...\", e);\r\n```\r\n\r\nThe message should also give more information to the user about what they should do to fix the problem. This particular case can only happen when the format was a macro, otherwise it would have caused an error in configurePipeline. So a better message would be:\r\n\r\nFormat '{}' cannot be used because properties {} were not provided or were invalid when the pipeline was deployed. Set the format to a different value, or re-create the pipeline with all required properties.", "bodyText": "In general, avoid this type of pattern where an exception is caught, logged, and then re-thrown. What ends up happening is that the error gets logged here and then later on by the caller, generating extra logs and confusing the user.\nInstead, you can wrap the exception with a more specific error message and propagate it up. Something like:\nthrow new IllegalArgumentException(\"...\", e);\n\nThe message should also give more information to the user about what they should do to fix the problem. This particular case can only happen when the format was a macro, otherwise it would have caused an error in configurePipeline. So a better message would be:\nFormat '{}' cannot be used because properties {} were not provided or were invalid when the pipeline was deployed. Set the format to a different value, or re-create the pipeline with all required properties.", "bodyHTML": "<p dir=\"auto\">In general, avoid this type of pattern where an exception is caught, logged, and then re-thrown. What ends up happening is that the error gets logged here and then later on by the caller, generating extra logs and confusing the user.</p>\n<p dir=\"auto\">Instead, you can wrap the exception with a more specific error message and propagate it up. Something like:</p>\n<div class=\"snippet-clipboard-content position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"throw new IllegalArgumentException(&quot;...&quot;, e);\"><pre><code>throw new IllegalArgumentException(\"...\", e);\n</code></pre></div>\n<p dir=\"auto\">The message should also give more information to the user about what they should do to fix the problem. This particular case can only happen when the format was a macro, otherwise it would have caused an error in configurePipeline. So a better message would be:</p>\n<p dir=\"auto\">Format '{}' cannot be used because properties {} were not provided or were invalid when the pipeline was deployed. Set the format to a different value, or re-create the pipeline with all required properties.</p>", "author": "albertshau", "createdAt": "2020-04-10T17:49:58Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java", "diffHunk": "@@ -76,8 +95,15 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n   public void prepareRun(BatchSinkContext context) throws Exception {\n     FailureCollector collector = context.getFailureCollector();\n     config.validate(collector);\n-    ValidatingOutputFormat validatingOutputFormat = context.newPluginInstance(FORMAT_PLUGIN_ID);\n     FileFormat fileFormat = config.getFormat();\n+    ValidatingOutputFormat validatingOutputFormat;\n+    try {\n+      validatingOutputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n+    } catch (InvalidPluginConfigException e) {\n+      LOG.error(\"Failed to create config for {} plugin missing properties: {} invalid properties: {}\",", "originalCommit": "1d8ab12865187d47c4609d7622a12a83ad967d17", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e98874430ac2414ca41b68234754181c185c90f3", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex a3606065..49a69f23 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -100,9 +104,15 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n     try {\n       validatingOutputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n     } catch (InvalidPluginConfigException e) {\n-      LOG.error(\"Failed to create config for {} plugin missing properties: {} invalid properties: {}\",\n-                fileFormat.name(), e.getMissingProperties(), e.getInvalidProperties());\n-      throw e;\n+      Set<String> properties = new HashSet<>(e.getMissingProperties());\n+      for (InvalidPluginProperty invalidProperty: e.getInvalidProperties()) {\n+        properties.add(invalidProperty.getName());\n+      }\n+      String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n+                                            \"were invalid when the pipeline was deployed. Set the format to a \" +\n+                                            \"different value, or re-create the pipeline with all required properties.\",\n+                                          fileFormat.name(), properties);\n+      throw new IllegalArgumentException(errorMessage, e);\n     }\n     FormatContext formatContext = new FormatContext(collector, context.getInputSchema());\n     validateOutputFormatProvider(formatContext, fileFormat, validatingOutputFormat);\n", "next_change": null}]}, "revised_code_in_main": {"commit": "e34cbdc41193d5648f3be9344bf86bec99a00f81", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex a3606065..49a69f23 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -100,9 +104,15 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n     try {\n       validatingOutputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n     } catch (InvalidPluginConfigException e) {\n-      LOG.error(\"Failed to create config for {} plugin missing properties: {} invalid properties: {}\",\n-                fileFormat.name(), e.getMissingProperties(), e.getInvalidProperties());\n-      throw e;\n+      Set<String> properties = new HashSet<>(e.getMissingProperties());\n+      for (InvalidPluginProperty invalidProperty: e.getInvalidProperties()) {\n+        properties.add(invalidProperty.getName());\n+      }\n+      String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n+                                            \"were invalid when the pipeline was deployed. Set the format to a \" +\n+                                            \"different value, or re-create the pipeline with all required properties.\",\n+                                          fileFormat.name(), properties);\n+      throw new IllegalArgumentException(errorMessage, e);\n     }\n     FormatContext formatContext = new FormatContext(collector, context.getInputSchema());\n     validateOutputFormatProvider(formatContext, fileFormat, validatingOutputFormat);\n", "next_change": {"commit": "608ccbf4828955ba91a8ea76fc872f8072b5f54c", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex 49a69f23..a8ec57bb 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -88,32 +88,23 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n     }\n \n     FileFormat format = config.getFormat();\n-    ValidatingOutputFormat validatingOutputFormat =\n-      pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, format.name().toLowerCase(),\n-                                   format.name().toLowerCase(), config.getRawProperties());\n+    ValidatingOutputFormat validatingOutputFormat = getValidatingOutputFormat(pipelineConfigurer);\n     FormatContext context = new FormatContext(collector, pipelineConfigurer.getStageConfigurer().getInputSchema());\n     validateOutputFormatProvider(context, format, validatingOutputFormat);\n   }\n \n+  protected ValidatingOutputFormat getValidatingOutputFormat(PipelineConfigurer pipelineConfigurer) {\n+    FileFormat format = config.getFormat();\n+    return pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, format.name().toLowerCase(),\n+                                        format.name().toLowerCase(), config.getRawProperties());\n+  }\n+\n   @Override\n   public void prepareRun(BatchSinkContext context) throws Exception {\n     FailureCollector collector = context.getFailureCollector();\n     config.validate(collector);\n     FileFormat fileFormat = config.getFormat();\n-    ValidatingOutputFormat validatingOutputFormat;\n-    try {\n-      validatingOutputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n-    } catch (InvalidPluginConfigException e) {\n-      Set<String> properties = new HashSet<>(e.getMissingProperties());\n-      for (InvalidPluginProperty invalidProperty: e.getInvalidProperties()) {\n-        properties.add(invalidProperty.getName());\n-      }\n-      String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n-                                            \"were invalid when the pipeline was deployed. Set the format to a \" +\n-                                            \"different value, or re-create the pipeline with all required properties.\",\n-                                          fileFormat.name(), properties);\n-      throw new IllegalArgumentException(errorMessage, e);\n-    }\n+    ValidatingOutputFormat validatingOutputFormat = getOutputFormatForRun(context);\n     FormatContext formatContext = new FormatContext(collector, context.getInputSchema());\n     validateOutputFormatProvider(formatContext, fileFormat, validatingOutputFormat);\n     collector.getOrThrowException();\n", "next_change": {"commit": "06d223a291b9fd600506f9fb493d229ad94dea65", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex a8ec57bb..eff72014 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -87,26 +87,25 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n       return;\n     }\n \n-    FileFormat format = config.getFormat();\n-    ValidatingOutputFormat validatingOutputFormat = getValidatingOutputFormat(pipelineConfigurer);\n+    String format = config.getFormatName();\n+    ValidatingOutputFormat validatingOutputFormat = getValidatingOutputFormat(pipelineConfigurer, format);\n     FormatContext context = new FormatContext(collector, pipelineConfigurer.getStageConfigurer().getInputSchema());\n     validateOutputFormatProvider(context, format, validatingOutputFormat);\n   }\n \n-  protected ValidatingOutputFormat getValidatingOutputFormat(PipelineConfigurer pipelineConfigurer) {\n-    FileFormat format = config.getFormat();\n-    return pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, format.name().toLowerCase(),\n-                                        format.name().toLowerCase(), config.getRawProperties());\n+  protected ValidatingOutputFormat getValidatingOutputFormat(PipelineConfigurer pipelineConfigurer, String format) {\n+    return pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, format,\n+                                        format, config.getRawProperties());\n   }\n \n   @Override\n   public void prepareRun(BatchSinkContext context) throws Exception {\n     FailureCollector collector = context.getFailureCollector();\n     config.validate(collector);\n-    FileFormat fileFormat = config.getFormat();\n+    String format = config.getFormatName();\n     ValidatingOutputFormat validatingOutputFormat = getOutputFormatForRun(context);\n     FormatContext formatContext = new FormatContext(collector, context.getInputSchema());\n-    validateOutputFormatProvider(formatContext, fileFormat, validatingOutputFormat);\n+    validateOutputFormatProvider(formatContext, format, validatingOutputFormat);\n     collector.getOrThrowException();\n \n \n", "next_change": {"commit": "6c7218053a946753767a95c55cf56051a8b1cfe7", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex eff72014..c393cb0a 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -88,20 +88,20 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n     }\n \n     String format = config.getFormatName();\n-    ValidatingOutputFormat validatingOutputFormat = getValidatingOutputFormat(pipelineConfigurer, format);\n+    ValidatingOutputFormat validatingOutputFormat = getValidatingOutputFormat(pipelineConfigurer);\n     FormatContext context = new FormatContext(collector, pipelineConfigurer.getStageConfigurer().getInputSchema());\n     validateOutputFormatProvider(context, format, validatingOutputFormat);\n   }\n \n-  protected ValidatingOutputFormat getValidatingOutputFormat(PipelineConfigurer pipelineConfigurer, String format) {\n-    return pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, format,\n-                                        format, config.getRawProperties());\n+  protected ValidatingOutputFormat getValidatingOutputFormat(PipelineConfigurer pipelineConfigurer) {\n+    return pipelineConfigurer.usePlugin(ValidatingOutputFormat.PLUGIN_TYPE, config.getFormatName(),\n+                                        config.getFormatName(), config.getRawProperties());\n   }\n \n   @Override\n   public void prepareRun(BatchSinkContext context) throws Exception {\n     FailureCollector collector = context.getFailureCollector();\n-    config.validate(collector);\n+    config.validate(collector, context.getArguments().asMap());\n     String format = config.getFormatName();\n     ValidatingOutputFormat validatingOutputFormat = getOutputFormatForRun(context);\n     FormatContext formatContext = new FormatContext(collector, context.getInputSchema());\n", "next_change": {"commit": "faa0b3cff5387b086daed4c562d52ff8432e69e7", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex c393cb0a..49c368b5 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -108,7 +108,6 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n     validateOutputFormatProvider(formatContext, format, validatingOutputFormat);\n     collector.getOrThrowException();\n \n-\n     // record field level lineage information\n     // needs to happen before context.addOutput(), otherwise an external dataset without schema will be created.\n     Schema schema = config.getSchema();\n", "next_change": {"commit": "443898bc1955ccd3a48abeeafb5301ad6e42e3ac", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex 49c368b5..647c2279 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -114,7 +114,7 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n     if (schema == null) {\n       schema = context.getInputSchema();\n     }\n-    LineageRecorder lineageRecorder = new LineageRecorder(context, config.getReferenceName());\n+    LineageRecorder lineageRecorder = getLineageRecorder(context);\n     lineageRecorder.createExternalDataset(schema);\n     if (schema != null && schema.getFields() != null && !schema.getFields().isEmpty()) {\n       recordLineage(lineageRecorder,\n", "next_change": null}]}}]}}]}}]}}]}}]}, "commits_in_main": [{"oid": "e34cbdc41193d5648f3be9344bf86bec99a00f81", "message": "Merge commit", "committedDate": null}, {"oid": "608ccbf4828955ba91a8ea76fc872f8072b5f54c", "committedDate": "2020-08-04 23:08:19 +0000", "message": "Enable subclasses to override OutputFormat and output path implementation"}, {"oid": "06d223a291b9fd600506f9fb493d229ad94dea65", "committedDate": "2020-12-14 17:08:46 -0800", "message": "PLUGIN-102 remove format hardcoding"}, {"oid": "d1183f92d13c09aa0e875a0a81e0bd827b6f3356", "committedDate": "2020-12-15 15:35:56 -0800", "message": "PLUGIN-102 fix backwards incompatibility from format fix"}, {"oid": "6c7218053a946753767a95c55cf56051a8b1cfe7", "committedDate": "2021-10-28 02:51:53 +0530", "message": "Added a validate method with arguments"}, {"oid": "b224c1a67ba733b05c3a05362cb875c9fad1813f", "committedDate": "2022-04-26 13:12:49 -0700", "message": "CDAP-18878 add additional function to get path"}, {"oid": "250a9653a0d977adddf356a43d9736e5f3474b20", "committedDate": "2022-04-27 09:29:26 -0700", "message": "fix compile GCS sink"}, {"oid": "faa0b3cff5387b086daed4c562d52ff8432e69e7", "committedDate": "2022-04-27 16:16:43 -0700", "message": "mark getOutputDir private"}, {"oid": "443898bc1955ccd3a48abeeafb5301ad6e42e3ac", "committedDate": "2022-09-20 15:43:57 -0400", "message": "CDAP-19626 add getLineageRecorder method to format-common"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzcyNDY0Ng==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r407724646", "body": "properties in the message should include both the missing and the invalid. Otherwise if it was from just invalid, the message will look weird.", "bodyText": "properties in the message should include both the missing and the invalid. Otherwise if it was from just invalid, the message will look weird.", "bodyHTML": "<p dir=\"auto\">properties in the message should include both the missing and the invalid. Otherwise if it was from just invalid, the message will look weird.</p>", "author": "albertshau", "createdAt": "2020-04-13T21:13:08Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java", "diffHunk": "@@ -76,8 +96,17 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n   public void prepareRun(BatchSinkContext context) throws Exception {\n     FailureCollector collector = context.getFailureCollector();\n     config.validate(collector);\n-    ValidatingOutputFormat validatingOutputFormat = context.newPluginInstance(FORMAT_PLUGIN_ID);\n     FileFormat fileFormat = config.getFormat();\n+    ValidatingOutputFormat validatingOutputFormat;\n+    try {\n+      validatingOutputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n+    } catch (InvalidPluginConfigException e) {\n+      String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n+                                          \"were invalid when the pipeline was deployed. Set the format to a \" +\n+                                          \"different value, or re-create the pipeline with all required properties.\",\n+                                          fileFormat.name(), e.getMissingProperties());", "originalCommit": "587a61e9b8905250b541ea460df2f780342c599b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc2OTUxNA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r407769514", "bodyText": "Added invalid properties in error msg.", "author": "rmstar", "createdAt": "2020-04-13T23:05:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzcyNDY0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "e98874430ac2414ca41b68234754181c185c90f3", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex f5018484..49a69f23 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -101,10 +104,14 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n     try {\n       validatingOutputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n     } catch (InvalidPluginConfigException e) {\n+      Set<String> properties = new HashSet<>(e.getMissingProperties());\n+      for (InvalidPluginProperty invalidProperty: e.getInvalidProperties()) {\n+        properties.add(invalidProperty.getName());\n+      }\n       String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n-                                          \"were invalid when the pipeline was deployed. Set the format to a \" +\n-                                          \"different value, or re-create the pipeline with all required properties.\",\n-                                          fileFormat.name(), e.getMissingProperties());\n+                                            \"were invalid when the pipeline was deployed. Set the format to a \" +\n+                                            \"different value, or re-create the pipeline with all required properties.\",\n+                                          fileFormat.name(), properties);\n       throw new IllegalArgumentException(errorMessage, e);\n     }\n     FormatContext formatContext = new FormatContext(collector, context.getInputSchema());\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzcyNTQ3OQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r407725479", "body": "we should have similar error handling here in the source if there is an error at configure or prepare time.", "bodyText": "we should have similar error handling here in the source if there is an error at configure or prepare time.", "bodyHTML": "<p dir=\"auto\">we should have similar error handling here in the source if there is an error at configure or prepare time.</p>", "author": "albertshau", "createdAt": "2020-04-13T21:14:44Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java", "diffHunk": "@@ -79,11 +79,21 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n     // invalid\n     collector.getOrThrowException();\n \n+    if (config.containsMacro(NAME_FORMAT)) {\n+      // Deploy all format plugins. This ensures that the required plugin is available when\n+      // the format macro is evaluated in prepareRun,\n+      for (FileFormat f: FileFormat.values()) {\n+        pipelineConfigurer.usePlugin(ValidatingInputFormat.PLUGIN_TYPE, f.name().toLowerCase(), f.name().toLowerCase(),\n+          config.getRawProperties());\n+      }", "originalCommit": "587a61e9b8905250b541ea460df2f780342c599b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc2OTU5MQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r407769591", "bodyText": "fixed", "author": "rmstar", "createdAt": "2020-04-13T23:05:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzcyNTQ3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "e98874430ac2414ca41b68234754181c185c90f3", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\nindex a1843b1f..8160df51 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\n", "chunk": "@@ -81,10 +88,16 @@ public abstract class AbstractFileSource<T extends PluginConfig & FileSourceProp\n \n     if (config.containsMacro(NAME_FORMAT)) {\n       // Deploy all format plugins. This ensures that the required plugin is available when\n-      // the format macro is evaluated in prepareRun,\n+      // the format macro is evaluated in prepareRun.\n       for (FileFormat f: FileFormat.values()) {\n-        pipelineConfigurer.usePlugin(ValidatingInputFormat.PLUGIN_TYPE, f.name().toLowerCase(), f.name().toLowerCase(),\n-          config.getRawProperties());\n+        try {\n+          pipelineConfigurer.usePlugin(ValidatingInputFormat.PLUGIN_TYPE, f.name().toLowerCase(),\n+                                       f.name().toLowerCase(), config.getRawProperties());\n+        } catch (InvalidPluginConfigException e) {\n+          LOG.warn(\"Failed to register format '{}', which means it cannot be used when the pipeline is run. \" +\n+                     \"Missing properties: {}, invalid properties: {}\", f.name(), e.getMissingProperties(),\n+                   e.getInvalidProperties().stream().map(InvalidPluginProperty::getName).collect(Collectors.toList()));\n+        }\n       }\n       return;\n     }\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzcyNjQ0Mg==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r407726442", "body": "have we tested a pipeline where all of these are macros? Have seen bugs introduced in the past where the property is assumed to not be a macro and a null pointer exception is generated at configure time.", "bodyText": "have we tested a pipeline where all of these are macros? Have seen bugs introduced in the past where the property is assumed to not be a macro and a null pointer exception is generated at configure time.", "bodyHTML": "<p dir=\"auto\">have we tested a pipeline where all of these are macros? Have seen bugs introduced in the past where the property is assumed to not be a macro and a null pointer exception is generated at configure time.</p>", "author": "albertshau", "createdAt": "2020-04-13T21:16:36Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSourceConfig.java", "diffHunk": "@@ -60,28 +61,33 @@\n   @Macro\n   private Long maxSplitSize;\n \n+  @Macro\n   @Nullable\n   @Description(\"Whether to allow an input that does not exist. When false, the source will fail the run if the input \"\n     + \"does not exist. When true, the run will not fail and the source will not generate any output. \"\n     + \"The default value is false.\")\n   private Boolean ignoreNonExistingFolders;\n \n+  @Macro\n   @Nullable\n   @Description(\"Whether to recursively read directories within the input directory. The default is false.\")\n   private Boolean recursive;\n \n   @Name(PATH_FIELD)\n+  @Macro\n   @Nullable\n   @Description(\"Output field to place the path of the file that the record was read from. \"\n     + \"If not specified, the file path will not be included in output records. \"\n     + \"If specified, the field must exist in the output schema as a string.\")\n   private String pathField;\n \n+  @Macro", "originalCommit": "587a61e9b8905250b541ea460df2f780342c599b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzc2OTgwMg==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r407769802", "bodyText": "yes, I tested a File source -> File sink pipeline where all these fields are macros.", "author": "rmstar", "createdAt": "2020-04-13T23:06:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzcyNjQ0Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTU3Mg==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r408481572", "body": "e.getInvalidProperties() is a set of objects, not property names. It will not display nicely. The location of that third '%s' is also awkward, it won't be a good sentence. \r\n\r\nLet's remove that last %s\r\n\r\ninvalid %s -> invalid\r\n\r\nand create a union of the property names from missing properties and invalid properties.", "bodyText": "e.getInvalidProperties() is a set of objects, not property names. It will not display nicely. The location of that third '%s' is also awkward, it won't be a good sentence.\nLet's remove that last %s\ninvalid %s -> invalid\nand create a union of the property names from missing properties and invalid properties.", "bodyHTML": "<p dir=\"auto\">e.getInvalidProperties() is a set of objects, not property names. It will not display nicely. The location of that third '%s' is also awkward, it won't be a good sentence.</p>\n<p dir=\"auto\">Let's remove that last %s</p>\n<p dir=\"auto\">invalid %s -&gt; invalid</p>\n<p dir=\"auto\">and create a union of the property names from missing properties and invalid properties.</p>", "author": "albertshau", "createdAt": "2020-04-14T22:51:43Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java", "diffHunk": "@@ -76,8 +96,17 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n   public void prepareRun(BatchSinkContext context) throws Exception {\n     FailureCollector collector = context.getFailureCollector();\n     config.validate(collector);\n-    ValidatingOutputFormat validatingOutputFormat = context.newPluginInstance(FORMAT_PLUGIN_ID);\n     FileFormat fileFormat = config.getFormat();\n+    ValidatingOutputFormat validatingOutputFormat;\n+    try {\n+      validatingOutputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n+    } catch (InvalidPluginConfigException e) {\n+      String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n+                                          \"were invalid %s when the pipeline was deployed. Set the format to a \" +", "originalCommit": "fab1056fc6b18cccbc8556096b08e39c406791aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MjU1Nw==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r408482557", "bodyText": "also, indentation here is inconsistent. Continuing a statement on the next line should be a 2 space indent, not aligned with the previous line. alignment is used when there are multiple arguments for a single method call spread out across multiple lines.\nformat(\"message '%s' \" + \n         \"wraps \",\n       arg);\n\nplease see rest of the project for examples, and update your IDE accordingly.", "author": "albertshau", "createdAt": "2020-04-14T22:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTU3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU4NDE4Nw==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r408584187", "bodyText": "fixed indentation and error msg.", "author": "rmstar", "createdAt": "2020-04-15T05:10:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTU3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "e98874430ac2414ca41b68234754181c185c90f3", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\nindex c57d6889..49a69f23 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSink.java\n", "chunk": "@@ -101,10 +104,14 @@ public abstract class AbstractFileSink<T extends PluginConfig & FileSinkProperti\n     try {\n       validatingOutputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n     } catch (InvalidPluginConfigException e) {\n+      Set<String> properties = new HashSet<>(e.getMissingProperties());\n+      for (InvalidPluginProperty invalidProperty: e.getInvalidProperties()) {\n+        properties.add(invalidProperty.getName());\n+      }\n       String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n-                                          \"were invalid %s when the pipeline was deployed. Set the format to a \" +\n-                                          \"different value, or re-create the pipeline with all required properties.\",\n-                                          fileFormat.name(), e.getMissingProperties(), e.getInvalidProperties());\n+                                            \"were invalid when the pipeline was deployed. Set the format to a \" +\n+                                            \"different value, or re-create the pipeline with all required properties.\",\n+                                          fileFormat.name(), properties);\n       throw new IllegalArgumentException(errorMessage, e);\n     }\n     FormatContext formatContext = new FormatContext(collector, context.getInputSchema());\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTc5NA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r408481794", "body": "indentation should be 2 spaces not 4", "bodyText": "indentation should be 2 spaces not 4", "bodyHTML": "<p dir=\"auto\">indentation should be 2 spaces not 4</p>", "author": "albertshau", "createdAt": "2020-04-14T22:52:23Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java", "diffHunk": "@@ -79,11 +83,27 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n     // invalid\n     collector.getOrThrowException();\n \n+    if (config.containsMacro(NAME_FORMAT)) {\n+      // Deploy all format plugins. This ensures that the required plugin is available when\n+      // the format macro is evaluated in prepareRun,\n+      for (FileFormat f: FileFormat.values()) {\n+        try {\n+          pipelineConfigurer.usePlugin(ValidatingInputFormat.PLUGIN_TYPE, f.name().toLowerCase(),\n+                                       f.name().toLowerCase(), config.getRawProperties());\n+        } catch (InvalidPluginConfigException e) {\n+          LOG.warn(\"Failed to register format '{}', which means it cannot be used when the pipeline is run.\" +\n+              \"Missing properties: {}, invalid properties: {}\",", "originalCommit": "fab1056fc6b18cccbc8556096b08e39c406791aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU4NDQ4OQ==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r408584489", "bodyText": "fixed", "author": "rmstar", "createdAt": "2020-04-15T05:11:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTc5NA=="}], "type": "inlineReview", "revised_code": {"commit": "e98874430ac2414ca41b68234754181c185c90f3", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\nindex 79471f28..8160df51 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\n", "chunk": "@@ -85,15 +88,15 @@ public abstract class AbstractFileSource<T extends PluginConfig & FileSourceProp\n \n     if (config.containsMacro(NAME_FORMAT)) {\n       // Deploy all format plugins. This ensures that the required plugin is available when\n-      // the format macro is evaluated in prepareRun,\n+      // the format macro is evaluated in prepareRun.\n       for (FileFormat f: FileFormat.values()) {\n         try {\n           pipelineConfigurer.usePlugin(ValidatingInputFormat.PLUGIN_TYPE, f.name().toLowerCase(),\n                                        f.name().toLowerCase(), config.getRawProperties());\n         } catch (InvalidPluginConfigException e) {\n-          LOG.warn(\"Failed to register format '{}', which means it cannot be used when the pipeline is run.\" +\n-              \"Missing properties: {}, invalid properties: {}\",\n-            f.name(), e.getMissingProperties(), e.getInvalidProperties());\n+          LOG.warn(\"Failed to register format '{}', which means it cannot be used when the pipeline is run. \" +\n+                     \"Missing properties: {}, invalid properties: {}\", f.name(), e.getMissingProperties(),\n+                   e.getInvalidProperties().stream().map(InvalidPluginProperty::getName).collect(Collectors.toList()));\n         }\n       }\n       return;\n", "next_change": null}]}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTgzMg==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r408481832", "body": "indentation", "bodyText": "indentation", "bodyHTML": "<p dir=\"auto\">indentation</p>", "author": "albertshau", "createdAt": "2020-04-14T22:52:30Z", "path": "format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java", "diffHunk": "@@ -99,8 +119,18 @@ public void configurePipeline(PipelineConfigurer pipelineConfigurer) {\n   public void prepareRun(BatchSourceContext context) throws Exception {\n     FailureCollector collector = context.getFailureCollector();\n     config.validate(collector);\n-    ValidatingInputFormat validatingInputFormat = context.newPluginInstance(FORMAT_PLUGIN_ID);\n     FileFormat fileFormat = config.getFormat();\n+    ValidatingInputFormat validatingInputFormat;\n+    try {\n+      validatingInputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n+    } catch (InvalidPluginConfigException e) {\n+      String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n+          \"were invalid %s when the pipeline was deployed. Set the format to a \" +", "originalCommit": "fab1056fc6b18cccbc8556096b08e39c406791aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MjAwMA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r408482000", "bodyText": "same comment as above about the error message", "author": "albertshau", "createdAt": "2020-04-14T22:52:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTgzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU4NDU5OA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1072#discussion_r408584598", "bodyText": "fixed indent and error msg", "author": "rmstar", "createdAt": "2020-04-15T05:11:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTgzMg=="}], "type": "inlineReview", "revised_code": {"commit": "e98874430ac2414ca41b68234754181c185c90f3", "changed_code": [{"header": "diff --git a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\nindex 79471f28..8160df51 100644\n--- a/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\n+++ b/format-common/src/main/java/io/cdap/plugin/format/plugin/AbstractFileSource.java\n", "chunk": "@@ -124,10 +127,14 @@ public abstract class AbstractFileSource<T extends PluginConfig & FileSourceProp\n     try {\n       validatingInputFormat = context.newPluginInstance(fileFormat.name().toLowerCase());\n     } catch (InvalidPluginConfigException e) {\n+      Set<String> properties = new HashSet<>(e.getMissingProperties());\n+      for (InvalidPluginProperty invalidProperty: e.getInvalidProperties()) {\n+        properties.add(invalidProperty.getName());\n+      }\n       String errorMessage = String.format(\"Format '%s' cannot be used because properties %s were not provided or \" +\n-          \"were invalid %s when the pipeline was deployed. Set the format to a \" +\n-          \"different value, or re-create the pipeline with all required properties.\",\n-        fileFormat.name(), e.getMissingProperties(), e.getInvalidProperties());\n+                                            \"were invalid when the pipeline was deployed. Set the format to a \" +\n+                                            \"different value, or re-create the pipeline with all required properties.\",\n+                                          fileFormat.name(), properties);\n       throw new IllegalArgumentException(errorMessage, e);\n     }\n \n", "next_change": null}]}}, {"oid": "e98874430ac2414ca41b68234754181c185c90f3", "url": "https://github.com/cdapio/hydrator-plugins/commit/e98874430ac2414ca41b68234754181c185c90f3", "message": "Add macro support for format field in AbstractFileSource, AbstractFileSink", "committedDate": "2020-04-15T20:32:24Z", "type": "commit"}, {"oid": "e98874430ac2414ca41b68234754181c185c90f3", "url": "https://github.com/cdapio/hydrator-plugins/commit/e98874430ac2414ca41b68234754181c185c90f3", "message": "Add macro support for format field in AbstractFileSource, AbstractFileSink", "committedDate": "2020-04-15T20:32:24Z", "type": "forcePushed"}]}