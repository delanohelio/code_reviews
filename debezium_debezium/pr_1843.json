{"pr_number": 1843, "pr_title": "DBZ-2582 Updating LSN handling", "pr_createdAt": "2020-09-25T12:43:57Z", "pr_url": "https://github.com/debezium/debezium/pull/1843", "merge_commit": "bea46a3059d3cf3d0c82c5ec2153440db35f1a31", "timeline": [{"oid": "203e73ab61c4e6a879a20916262516ae589699e0", "url": "https://github.com/debezium/debezium/commit/203e73ab61c4e6a879a20916262516ae589699e0", "message": "DBZ-2582 Updating LSN handling", "committedDate": "2020-10-08T13:01:54Z", "type": "commit"}, {"oid": "6e55c5c016ec0b0beaf7f10225d9f15589b2bf4b", "url": "https://github.com/debezium/debezium/commit/6e55c5c016ec0b0beaf7f10225d9f15589b2bf4b", "message": "DBZ-2582-lsn-changes revert log change", "committedDate": "2020-10-08T13:01:54Z", "type": "commit"}, {"oid": "05497e16cd3c998a8a17b28f67f2d166f197e05a", "url": "https://github.com/debezium/debezium/commit/05497e16cd3c998a8a17b28f67f2d166f197e05a", "message": "DBZ-2582 Fixing tests and adding pause back", "committedDate": "2020-10-08T13:01:54Z", "type": "commit"}, {"oid": "410f2d74b3c4378b065d3ea9464577475de26bb8", "url": "https://github.com/debezium/debezium/commit/410f2d74b3c4378b065d3ea9464577475de26bb8", "message": "DBZ-2582 Adding copyright", "committedDate": "2020-10-08T13:01:54Z", "type": "commit"}, {"oid": "e0339efe1cf12536c545f04f9d9e6f7658c30739", "url": "https://github.com/debezium/debezium/commit/e0339efe1cf12536c545f04f9d9e6f7658c30739", "message": "DBZ-2582 Apply suggestions from code review\n\nCo-authored-by: Gunnar Morling <gunnar.morling@googlemail.com>", "committedDate": "2020-10-08T13:01:54Z", "type": "commit"}, {"oid": "714edc7b4a61340fd5f19ced8dec95c0de96a561", "url": "https://github.com/debezium/debezium/commit/714edc7b4a61340fd5f19ced8dec95c0de96a561", "message": "DBZ-2582 Updating configuration to be feature flag and using prepared statements", "committedDate": "2020-10-08T13:01:55Z", "type": "commit"}, {"oid": "fcd7c5bf5f18eee77511ec7742a37f7282881e7f", "url": "https://github.com/debezium/debezium/commit/fcd7c5bf5f18eee77511ec7742a37f7282881e7f", "message": "DBZ-2582 Updating test for consistency", "committedDate": "2020-10-08T13:01:55Z", "type": "commit"}, {"oid": "38e6cc678169daf3518e6ab2be8c4f275bde4ac2", "url": "https://github.com/debezium/debezium/commit/38e6cc678169daf3518e6ab2be8c4f275bde4ac2", "message": "DBZ-2582 Adding boolean check and removing TODO as no changes are necessary", "committedDate": "2020-10-08T13:01:55Z", "type": "commit"}, {"oid": "38e6cc678169daf3518e6ab2be8c4f275bde4ac2", "url": "https://github.com/debezium/debezium/commit/38e6cc678169daf3518e6ab2be8c4f275bde4ac2", "message": "DBZ-2582 Adding boolean check and removing TODO as no changes are necessary", "committedDate": "2020-10-08T13:01:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI0OTg5MA==", "url": "https://github.com/debezium/debezium/pull/1843#discussion_r502249890", "body": "Tiny nit: \"LSN\" -> \"Lsn\" (this isn't done consistently across the code base yet, but it's the casing we want to converge on eventually for abbreviations in type/method/variable names).", "bodyText": "Tiny nit: \"LSN\" -> \"Lsn\" (this isn't done consistently across the code base yet, but it's the casing we want to converge on eventually for abbreviations in type/method/variable names).", "bodyHTML": "<p dir=\"auto\">Tiny nit: \"LSN\" -&gt; \"Lsn\" (this isn't done consistently across the code base yet, but it's the casing we want to converge on eventually for abbreviations in type/method/variable names).</p>", "author": "gunnarmorling", "createdAt": "2020-10-09T07:51:17Z", "path": "debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java", "diffHunk": "@@ -442,6 +452,10 @@ public boolean isReadOnlyDatabaseConnection() {\n         return readOnlyDatabaseConnection;\n     }\n \n+    public boolean isSkipLowActivityLSNsEnabled() {", "originalCommit": "38e6cc678169daf3518e6ab2be8c4f275bde4ac2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bd8db7979f407681554fcb71bc4fe659cf4da6ca", "changed_code": [{"header": "diff --git a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\nindex 201ddb6a6..40854dd6a 100644\n--- a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n+++ b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n", "chunk": "@@ -452,8 +452,8 @@ public boolean isReadOnlyDatabaseConnection() {\n         return readOnlyDatabaseConnection;\n     }\n \n-    public boolean isSkipLowActivityLSNsEnabled() {\n-        return skipLowActivityLSNsEnabled;\n+    public boolean isSkipLowActivityLsnsEnabled() {\n+        return skipLowActivityLsnsEnabled;\n     }\n \n     @Override\n", "next_change": null}]}, "revised_code_in_main": {"commit": "bea46a3059d3cf3d0c82c5ec2153440db35f1a31", "changed_code": [{"header": "diff --git a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\nindex 201ddb6a6..40854dd6a 100644\n--- a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n+++ b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n", "chunk": "@@ -452,8 +452,8 @@ public boolean isReadOnlyDatabaseConnection() {\n         return readOnlyDatabaseConnection;\n     }\n \n-    public boolean isSkipLowActivityLSNsEnabled() {\n-        return skipLowActivityLSNsEnabled;\n+    public boolean isSkipLowActivityLsnsEnabled() {\n+        return skipLowActivityLsnsEnabled;\n     }\n \n     @Override\n", "next_change": {"commit": "dd23e0faad7bc5e9dba648658703be4d17ae2f74", "changed_code": [{"header": "diff --git a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\nindex 40854dd6a..3276d19d3 100644\n--- a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n+++ b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n", "chunk": "@@ -444,16 +390,12 @@ public SourceTimestampMode getSourceTimestampMode() {\n         return sourceTimestampMode;\n     }\n \n-    public ColumnNameFilter getColumnFilter() {\n-        return columnFilter;\n-    }\n-\n     public boolean isReadOnlyDatabaseConnection() {\n         return readOnlyDatabaseConnection;\n     }\n \n-    public boolean isSkipLowActivityLsnsEnabled() {\n-        return skipLowActivityLsnsEnabled;\n+    public int getMaxTransactionsPerIteration() {\n+        return maxTransactionsPerIteration;\n     }\n \n     @Override\n", "next_change": {"commit": "cbf2abaaf2e64995595f1b133002df237734effc", "changed_code": [{"header": "diff --git a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\nindex 3276d19d3..7890c1c85 100644\n--- a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n+++ b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n", "chunk": "@@ -398,6 +398,11 @@ public int getMaxTransactionsPerIteration() {\n         return maxTransactionsPerIteration;\n     }\n \n+    @Override\n+    public boolean supportsOperationFiltering() {\n+        return true;\n+    }\n+\n     @Override\n     protected SourceInfoStructMaker<? extends AbstractSourceInfo> getSourceInfoStructMaker(Version version) {\n         switch (version) {\n", "next_change": {"commit": "44073cf7d89c17922476fffa226ec4497f493ad2", "changed_code": [{"header": "diff --git a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\nindex 7890c1c85..990c61905 100644\n--- a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n+++ b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n", "chunk": "@@ -398,11 +455,20 @@ public int getMaxTransactionsPerIteration() {\n         return maxTransactionsPerIteration;\n     }\n \n+    public boolean getOptionRecompile() {\n+        return optionRecompile;\n+    }\n+\n     @Override\n     public boolean supportsOperationFiltering() {\n         return true;\n     }\n \n+    @Override\n+    protected boolean supportsSchemaChangesDuringIncrementalSnapshot() {\n+        return true;\n+    }\n+\n     @Override\n     protected SourceInfoStructMaker<? extends AbstractSourceInfo> getSourceInfoStructMaker(Version version) {\n         switch (version) {\n", "next_change": {"commit": "4a48eb33df3a4a9c0865271e1065a20d7e4a49bd", "changed_code": [{"header": "diff --git a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\nindex 990c61905..29af6a07c 100644\n--- a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n+++ b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnectorConfig.java\n", "chunk": "@@ -471,12 +446,7 @@ protected boolean supportsSchemaChangesDuringIncrementalSnapshot() {\n \n     @Override\n     protected SourceInfoStructMaker<? extends AbstractSourceInfo> getSourceInfoStructMaker(Version version) {\n-        switch (version) {\n-            case V1:\n-                return new LegacyV1SqlServerSourceInfoStructMaker(Module.name(), Module.version(), this);\n-            default:\n-                return new SqlServerSourceInfoStructMaker(Module.name(), Module.version(), this);\n-        }\n+        return new SqlServerSourceInfoStructMaker(Module.name(), Module.version(), this);\n     }\n \n     private static class SystemTablesPredicate implements TableFilter {\n", "next_change": null}]}}]}}]}}]}}]}, "commits_in_main": [{"oid": "bea46a3059d3cf3d0c82c5ec2153440db35f1a31", "message": "Merge commit", "committedDate": null}, {"oid": "fa1ad8065d2ced4ceba29c10f7b6e909ef38860e", "committedDate": "2021-01-16 10:58:06 +0100", "message": "DBZ-2912: Add support for binary.handling.mode to the SQL Server connector"}, {"oid": "d4003c9172aa76b6c54d46b7977ad3a701e8df2e", "committedDate": "2021-02-03 08:05:42 +0100", "message": "DBZ-2420 Define database configs under RelationalDatabaseConnectorConfig"}, {"oid": "d98488b37697ba9acb3a8bbe0ba165f99e5b6c72", "committedDate": "2021-02-16 12:34:06 +0100", "message": "DBZ-3056 Add validation for SQL Server connector."}, {"oid": "911b5e9a3b1a86825060d5e76d8162b0719df972", "committedDate": "2021-03-17 09:54:25 +0100", "message": "DBZ-3271 Unifying filter handling across relational connectors"}, {"oid": "ec252a787df5cb8704b3f201d5a53ab945fe2209", "committedDate": "2021-05-18 20:57:25 +0200", "message": "DBZ-3452: Deprecate source.timestamp.mode=processing"}, {"oid": "dd23e0faad7bc5e9dba648658703be4d17ae2f74", "committedDate": "2021-05-25 07:19:43 +0200", "message": "DBZ-3486: Limit number of processed transactions per iteration"}, {"oid": "cbf2abaaf2e64995595f1b133002df237734effc", "committedDate": "2021-06-21 15:52:35 +0200", "message": "DBZ-2697 Optimisation on SQLServer connector for skipped.operations"}, {"oid": "8252b19abc9090a68808eae8c17611e534fe631b", "committedDate": "2021-08-17 22:16:56 +0200", "message": "DBZ-3479: Rework handling timezones in SQL Server connector"}, {"oid": "b06b5aecbc4b4f2609fb1e335f835b369ddb627a", "committedDate": "2021-08-23 12:01:11 +0200", "message": "DBZ-2975: Introduce opt-in configuration for multi-partition mode"}, {"oid": "9a88011718167fc1afd82d5397a26ea5b8d26e92", "committedDate": "2021-08-23 12:01:11 +0200", "message": "DBZ-2975 Avoiding redundant log message"}, {"oid": "26d0e7802303b2c022038403d5edcdb6aaedcb3b", "committedDate": "2021-09-17 14:20:42 +0200", "message": "DBZ-4013 Skip invalid table"}, {"oid": "e041b599d82c29ac388997ae15d42a42aedce637", "committedDate": "2021-10-18 12:06:56 +0200", "message": "DBZ-3517 Making database.user optional for SQL Server."}, {"oid": "5ac93ac20e0ddc08c74fbd558f7c80dd0e6ede6c", "committedDate": "2021-10-18 12:06:56 +0200", "message": "DBZ-3517 Making database.user optional for SQL Server."}, {"oid": "346e0f3af2329fc3af73a2857420f023bf7034d8", "committedDate": "2021-10-18 12:06:56 +0200", "message": "DBZ-3517 Making database.user optional for SQL Server."}, {"oid": "63367c614af789246a107cd1b34e9e2a9f097311", "committedDate": "2021-11-02 14:48:51 +0100", "message": "DBZ-4231 Remove SqlServerConnector database.user Required Validator"}, {"oid": "39ecc4e732484f9fe6de6cfd9efd8174f7a3b063", "committedDate": "2021-11-12 11:56:06 +0100", "message": "DBZ-4249 Creates the incremental.snapshot.option.recompile connector configuration for SQL Server"}, {"oid": "44073cf7d89c17922476fffa226ec4497f493ad2", "committedDate": "2021-11-16 14:56:06 +0100", "message": "DBZ-4196 Support schema changes during incremental snapshot"}, {"oid": "b922e34b30a7211b973f395e34fe20ff5c3e0cb6", "committedDate": "2021-12-02 11:07:22 +0100", "message": "DBZ-3697 Adding metadata to fields for SQLServerConnector"}, {"oid": "2d14b5b09f4af68f6070fbfc4e4a62cd323290f6", "committedDate": "2022-02-16 11:31:38 +0100", "message": "DBZ-4478: Multi-partition metrics for SQL Server"}, {"oid": "cc11ac193a485bd27afc01d3e500ca77ee384c4f", "committedDate": "2022-03-01 14:21:39 +0100", "message": "DBZ-4783: Support for multiple databases and tasks in the SQL Server connector"}, {"oid": "d6e96a51081b1572d33ed081b05473d4391be420", "committedDate": "2022-03-01 14:21:39 +0100", "message": "DBZ-4783: Refactoring and cleanup"}, {"oid": "d20a6f00e77a490ac0b6e99a7bdabdb9b153d7e9", "committedDate": "2022-03-07 17:53:45 +0100", "message": "DBZ-4801 Using JdbcConfiguration in JdbcConnection"}, {"oid": "b2586747829990a20560bdab6380a4e7c5e2bd87", "committedDate": "2022-03-24 09:37:05 +0100", "message": "DBZ-3535: Introduce schema.name.adjustment.mode"}, {"oid": "acb743bd3424fdf4d1ff4b427b35849fedb37a67", "committedDate": "2022-06-07 16:13:29 -0400", "message": "DBZ-5206 Remove the deprecated monitored tables metrics"}, {"oid": "261188482f69a816ea02eb8830e0012069f9d152", "committedDate": "2022-06-08 09:11:00 +0200", "message": "DBZ-5045 Remove deprecated SCHEMA_WHITELIST"}, {"oid": "f84893a8b4c3675bf2b5fcc9b05d8eba2659299e", "committedDate": "2022-06-08 09:11:00 +0200", "message": "DBZ-5045 Remove deprecated SCHEMA_BLACKLIST"}, {"oid": "f40706eb256b8c46915a0392ffda483330f3887f", "committedDate": "2022-06-08 09:11:00 +0200", "message": "DBZ-5045 Remove deprecated SQL server SERVER_TIMEZONE"}, {"oid": "6af67f33d3f0ae64e1b818ab7cf90907eb2e7548", "committedDate": "2022-06-08 09:11:00 +0200", "message": "DBZ-5045 Remove deprecated SQL server SourceTimestampMode.PROCESSING option"}, {"oid": "4a48eb33df3a4a9c0865271e1065a20d7e4a49bd", "committedDate": "2022-06-08 09:11:00 +0200", "message": "DBZ-5045 Remove legacy V1 source info"}, {"oid": "25eba9749d1c4a7c3b5775246be6f152e8a4f366", "committedDate": "2022-06-13 10:57:15 +0200", "message": "DBZ-5198 Add support for SQL server specific table delimiters"}, {"oid": "5ff71aa9923fc28a74796b1f0e640985fc897fc2", "committedDate": "2022-06-30 09:35:54 +0200", "message": "DBZ-5335 Fix formatting issues in the connectors configdefs"}, {"oid": "1ea02be9c27d2a3b5fd40007d8e1233f8f0a1e32", "committedDate": "2022-07-12 17:31:19 +0200", "message": "DBZ-5229 define centralized and modular aproach for debezium storage"}, {"oid": "d8baac7c46366a11d1c8a4d09461b259274f0091", "committedDate": "2022-07-12 17:31:19 +0200", "message": "DBZ-5229 Reorganize code for inheritance use"}, {"oid": "77f853f936635aca9e50c0f65a92f4ad944582c5", "committedDate": "2022-07-19 09:20:40 +0200", "message": "DBZ-4726: Remove SQL Server single-partition mode"}, {"oid": "8f0f9fe3ed5648b7e89ac926a986d822228ff7b1", "committedDate": "2022-08-05 12:26:39 -0400", "message": "DBZ-5477: Remove SQL Server connector SourceTimestampMode"}, {"oid": "161a7229b6bec9dce9e0c02863b75eedec4afa62", "committedDate": "2022-09-07 12:57:31 +0200", "message": "DBZ-5043 Use topic prefix as the logical name"}, {"oid": "0823cedf2541b276753c6754a5181ccf81ff8ae2", "committedDate": "2022-09-07 12:57:31 +0200", "message": "DBZ-5043 Replace database.server.name with topic.prefix"}, {"oid": "acc6be6df334081bb2d726463fc039847bb0770f", "committedDate": "2022-09-13 09:25:54 +0200", "message": "DBZ-5043 Move TOPIC_PREFIX into CommonConnectorConfig"}, {"oid": "39f33587473b733ec4a880cde5116af96e4a1edd", "committedDate": "2022-09-20 06:29:39 +0200", "message": "DBZ-5496: Improve compatibility with Azure SQL"}, {"oid": "f6b72f060c1a3cbcfb04b31a7a306c44c2506d5f", "committedDate": "2022-10-03 11:40:17 -0400", "message": "DBZ-5671 Remove logic name parameter from sub connector config"}, {"oid": "aba74a462fc5730f29679738d2be26cfdaaca4dd", "committedDate": "2022-12-15 11:41:58 +0100", "message": "DBZ-5924 refactor SQL-Server JDBC configuration for named instance config parameter"}, {"oid": "e5d16b14a65d25d0c0e23c9ee076b8d9c640f02e", "committedDate": "2023-01-11 06:44:53 +0100", "message": "DBZ-2439 Remove redundant modifiers"}, {"oid": "0a1862a5cf0bb5c1921c63c051a87c703d5d6162", "committedDate": "2023-02-07 13:11:23 +0100", "message": "DBZ-6084: Validate that database.names is not empty in the SQL server connector configuration."}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI1MDEwOQ==", "url": "https://github.com/debezium/debezium/pull/1843#discussion_r502250109", "body": "Same comment as below.", "bodyText": "Same comment as below.", "bodyHTML": "<p dir=\"auto\">Same comment as below.</p>", "author": "gunnarmorling", "createdAt": "2020-10-09T07:51:39Z", "path": "debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnection.java", "diffHunk": "@@ -153,6 +156,24 @@ public Lsn getMaxLsn() throws SQLException {\n         }, \"Maximum LSN query must return exactly one value\"));\n     }\n \n+    public MaxLsnResult getMaxLsnResult(boolean skipLowActivityLSNsEnabled) throws SQLException {\n+        if (skipLowActivityLSNsEnabled) {", "originalCommit": "38e6cc678169daf3518e6ab2be8c4f275bde4ac2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bd8db7979f407681554fcb71bc4fe659cf4da6ca", "changed_code": [{"header": "diff --git a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnection.java b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnection.java\nindex 4adf5dabe..bd7158fe0 100644\n--- a/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnection.java\n+++ b/debezium-connector-sqlserver/src/main/java/io/debezium/connector/sqlserver/SqlServerConnection.java\n", "chunk": "@@ -156,8 +156,8 @@ public Lsn getMaxLsn() throws SQLException {\n         }, \"Maximum LSN query must return exactly one value\"));\n     }\n \n-    public MaxLsnResult getMaxLsnResult(boolean skipLowActivityLSNsEnabled) throws SQLException {\n-        if (skipLowActivityLSNsEnabled) {\n+    public MaxLsnResult getMaxLsnResult(boolean skipLowActivityLsnsEnabled) throws SQLException {\n+        if (skipLowActivityLsnsEnabled) {\n             return prepareQueryAndMap(GET_MAX_LSN_SKIP_LOW_ACTIVTY, statement -> {\n             }, singleResultMapper(rs -> {\n                 final MaxLsnResult ret = new MaxLsnResult(Lsn.valueOf(rs.getBytes(1)), Lsn.valueOf(rs.getBytes(2)));\n", "next_change": null}]}}, {"oid": "bd8db7979f407681554fcb71bc4fe659cf4da6ca", "url": "https://github.com/debezium/debezium/commit/bd8db7979f407681554fcb71bc4fe659cf4da6ca", "message": "DBZ-2582 Fixing LSN casing", "committedDate": "2020-10-09T18:55:32Z", "type": "commit"}]}