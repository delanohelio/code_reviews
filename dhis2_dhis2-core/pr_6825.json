{"pr_number": 6825, "pr_title": "fix: Use encryption for SMS confidential parameters [DHIS2-10076]", "pr_author": "zubaira", "pr_createdAt": "2020-12-03T20:32:18Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6825", "timeline": [{"oid": "28c265e69da02f18bb644ce264de09ca3dae0bfc", "url": "https://github.com/dhis2/dhis2-core/commit/28c265e69da02f18bb644ce264de09ca3dae0bfc", "message": "fix: Add encryption while saving confidential parameters", "committedDate": "2020-12-03T19:40:45Z", "type": "commit"}, {"oid": "8ad3f5d027aab6a327d68c69311c5ec12711a4d4", "url": "https://github.com/dhis2/dhis2-core/commit/8ad3f5d027aab6a327d68c69311c5ec12711a4d4", "message": "fix unit tests", "committedDate": "2020-12-03T20:20:04Z", "type": "commit"}, {"oid": "5c8e81d89d389be8ef091e373829023ad56e256e", "url": "https://github.com/dhis2/dhis2-core/commit/5c8e81d89d389be8ef091e373829023ad56e256e", "message": "fix unit tests", "committedDate": "2020-12-03T20:29:08Z", "type": "commit"}, {"oid": "8914f9671ad81eab91d716ac5376155e94e2afde", "url": "https://github.com/dhis2/dhis2-core/commit/8914f9671ad81eab91d716ac5376155e94e2afde", "message": "fix issues after server reboot", "committedDate": "2020-12-04T11:06:10Z", "type": "commit"}, {"oid": "608a789d71d910c6edef4e81e3f60a99431c417b", "url": "https://github.com/dhis2/dhis2-core/commit/608a789d71d910c6edef4e81e3f60a99431c417b", "message": "sonar code analysis fix", "committedDate": "2020-12-07T10:38:51Z", "type": "commit"}, {"oid": "95405531908f3d349b66590e9bde6fb087ea7b32", "url": "https://github.com/dhis2/dhis2-core/commit/95405531908f3d349b66590e9bde6fb087ea7b32", "message": "fix compilation issue", "committedDate": "2020-12-07T10:49:07Z", "type": "commit"}, {"oid": "630fdc29a09ca84e64ed60eace2a2203a1919361", "url": "https://github.com/dhis2/dhis2-core/commit/630fdc29a09ca84e64ed60eace2a2203a1919361", "message": "fix unit tests", "committedDate": "2020-12-07T11:04:53Z", "type": "commit"}, {"oid": "b766e220e856238e8c23334bc329eef28bfea070", "url": "https://github.com/dhis2/dhis2-core/commit/b766e220e856238e8c23334bc329eef28bfea070", "message": "Incase values are equal then no need to updated", "committedDate": "2020-12-08T08:55:37Z", "type": "commit"}, {"oid": "ed2e401ff04b539a4a321754fda923c5ef4cfb62", "url": "https://github.com/dhis2/dhis2-core/commit/ed2e401ff04b539a4a321754fda923c5ef4cfb62", "message": "Add unit tests", "committedDate": "2020-12-08T11:20:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTExNTA4NA==", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539115084", "body": "```suggestion\r\n            pbeStringEncryptor.decrypt( bulkSmsGatewayConfig.getPassword().trim() );\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        pbeStringEncryptor.decrypt( bulkSmsGatewayConfig.getPassword().trim());\n          \n          \n            \n                        pbeStringEncryptor.decrypt( bulkSmsGatewayConfig.getPassword().trim() );", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">            pbeStringEncryptor<span class=\"pl-k\">.</span>decrypt( bulkSmsGatewayConfig<span class=\"pl-k\">.</span>getPassword()<span class=\"pl-k\">.</span>trim());</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">            pbeStringEncryptor<span class=\"pl-k\">.</span>decrypt( bulkSmsGatewayConfig<span class=\"pl-k\">.</span>getPassword()<span class=\"pl-k\">.</span>trim()<span class=\"x x-first x-last\"> </span>);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "stian-sandvold", "createdAt": "2020-12-09T08:46:24Z", "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/config/BulkSmsHttpGateway.java", "diffHunk": "@@ -87,7 +96,8 @@ public OutboundMessageResponse send( String subject, String text, Set<String> re\n \n     private HttpHeaders getRequestHeaderParameters( BulkSmsGatewayConfig bulkSmsGatewayConfig )\n     {\n-        String credentials = bulkSmsGatewayConfig.getUsername().trim() + \":\" + bulkSmsGatewayConfig.getPassword().trim();\n+        String credentials = bulkSmsGatewayConfig.getUsername().trim() + \":\" +\n+            pbeStringEncryptor.decrypt( bulkSmsGatewayConfig.getPassword().trim());", "originalCommit": "ed2e401ff04b539a4a321754fda923c5ef4cfb62", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTExNTc2MQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539115761", "body": "closing bracket on wrong line :) ", "bodyText": "closing bracket on wrong line :)", "bodyHTML": "<p dir=\"auto\">closing bracket on wrong line :)</p>", "author": "stian-sandvold", "createdAt": "2020-12-09T08:47:23Z", "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/config/SimplisticHttpGetGateWay.java", "diffHunk": "@@ -184,8 +193,8 @@ public OutboundMessageResponse send( String subject, String text, Set<String> re\n         {\n             if ( !parameter.isHeader() )\n             {\n-                valueStore.put( parameter.getKey(), parameter.getValue() );\n-            }\n+                valueStore.put( parameter.getKey(), parameter.isConfidential() ?\n+                    pbeStringEncryptor.decrypt( parameter.getValue() ) : parameter.getValue() );            }", "originalCommit": "ed2e401ff04b539a4a321754fda923c5ef4cfb62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg2Mjk0NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539862945", "bodyText": "resolved", "author": "zubaira", "createdAt": "2020-12-10T05:49:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTExNTc2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ1OTQzMQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539459431", "body": "Can't we just annotate this class with:\r\n```java\r\n@EqualsAndHashCode(of = {\"key\",\"value\", \"confidential\", \"encode\", \"header\"})\r\n```\r\n?", "bodyText": "Can't we just annotate this class with:\n@EqualsAndHashCode(of = {\"key\",\"value\", \"confidential\", \"encode\", \"header\"})\n?", "bodyHTML": "<p dir=\"auto\">Can't we just annotate this class with:</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@EqualsAndHashCode(of = {&quot;key&quot;,&quot;value&quot;, &quot;confidential&quot;, &quot;encode&quot;, &quot;header&quot;})\"><pre><span class=\"pl-k\">@EqualsAndHashCode</span>(<span class=\"pl-c1\">of</span> <span class=\"pl-k\">=</span> {<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>key<span class=\"pl-pds\">\"</span></span>,<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>value<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>confidential<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>encode<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>header<span class=\"pl-pds\">\"</span></span>})</pre></div>\n<p dir=\"auto\">?</p>", "author": "gnespolino", "createdAt": "2020-12-09T16:34:23Z", "path": "dhis-2/dhis-api/src/main/java/org/hisp/dhis/sms/config/GenericGatewayParameter.java", "diffHunk": "@@ -106,4 +107,30 @@ public void setEncode( boolean encode )\n     {\n         this.encode = encode;\n     }\n+\n+    @Override\n+    public boolean equals( Object o )", "originalCommit": "ed2e401ff04b539a4a321754fda923c5ef4cfb62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg2MzExMA==", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539863110", "bodyText": "resolved", "author": "zubaira", "createdAt": "2020-12-10T05:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ1OTQzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2MTcyNw==", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539461727", "body": "```java\r\n@RequiredArgsConstructor\r\n```\r\nwith\r\n```java\r\n@Qualifier( \"tripleDesStringEncryptor\" )\r\nprivate final PBEStringEncryptor pbeStringEncryptor;\r\n```", "bodyText": "@RequiredArgsConstructor\nwith\n@Qualifier( \"tripleDesStringEncryptor\" )\nprivate final PBEStringEncryptor pbeStringEncryptor;", "bodyHTML": "<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@RequiredArgsConstructor\"><pre><span class=\"pl-k\">@RequiredArgsConstructor</span></pre></div>\n<p dir=\"auto\">with</p>\n<div class=\"highlight highlight-source-java position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@Qualifier( &quot;tripleDesStringEncryptor&quot; )\nprivate final PBEStringEncryptor pbeStringEncryptor;\"><pre><span class=\"pl-k\">@Qualifier</span>( <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tripleDesStringEncryptor<span class=\"pl-pds\">\"</span></span> )\n<span class=\"pl-k\">private</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">PBEStringEncryptor</span> pbeStringEncryptor;</pre></div>", "author": "gnespolino", "createdAt": "2020-12-09T16:37:06Z", "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/config/BulkSmsHttpGateway.java", "diffHunk": "@@ -50,6 +52,13 @@\n public class BulkSmsHttpGateway", "originalCommit": "ed2e401ff04b539a4a321754fda923c5ef4cfb62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg2MzE1MA==", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539863150", "bodyText": "resolved", "author": "zubaira", "createdAt": "2020-12-10T05:49:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2MTcyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ2MjEwNQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6825#discussion_r539462105", "body": "same as `BulkSmsHttpGateway`", "bodyText": "same as BulkSmsHttpGateway", "bodyHTML": "<p dir=\"auto\">same as <code>BulkSmsHttpGateway</code></p>", "author": "gnespolino", "createdAt": "2020-12-09T16:37:31Z", "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/config/ClickatellHttpGateway.java", "diffHunk": "@@ -50,6 +52,13 @@\n public class ClickatellHttpGateway", "originalCommit": "ed2e401ff04b539a4a321754fda923c5ef4cfb62", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dd7691115c8f2ea55409a7f3a9f6fe68cbab4b31", "url": "https://github.com/dhis2/dhis2-core/commit/dd7691115c8f2ea55409a7f3a9f6fe68cbab4b31", "message": "Merge branch 'master' into DHIS2-10076", "committedDate": "2020-12-10T05:41:11Z", "type": "commit"}, {"oid": "842881e2f0baf51853bd58458e36a4fa58e665fe", "url": "https://github.com/dhis2/dhis2-core/commit/842881e2f0baf51853bd58458e36a4fa58e665fe", "message": "resolve review comments", "committedDate": "2020-12-10T05:48:53Z", "type": "commit"}]}