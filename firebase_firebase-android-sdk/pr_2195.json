{"pr_number": 2195, "pr_title": "Adding a FidListener that propagates fid changes to the clients.", "pr_author": "ankitaj224", "pr_createdAt": "2020-11-23T17:59:18Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/2195", "timeline": [{"oid": "ada672b4f9268e6bec5bb91563dc5c76d48f33db", "url": "https://github.com/firebase/firebase-android-sdk/commit/ada672b4f9268e6bec5bb91563dc5c76d48f33db", "message": "Adding a FidListener that propagates fid changes to the clients.", "committedDate": "2020-11-23T17:57:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwMjM2NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r528902365", "body": "Please add `@DeferredApi` annotation to this method. It's needed for proper dynamic module loading that is upcoming across Firebase SDKs.", "bodyText": "Please add @DeferredApi annotation to this method. It's needed for proper dynamic module loading that is upcoming across Firebase SDKs.", "bodyHTML": "<p dir=\"auto\">Please add <code>@DeferredApi</code> annotation to this method. It's needed for proper dynamic module loading that is upcoming across Firebase SDKs.</p>", "author": "vkryachko", "createdAt": "2020-11-23T18:12:08Z", "path": "firebase-installations-interop/src/main/java/com/google/firebase/installations/FirebaseInstallationsApi.java", "diffHunk": "@@ -51,4 +52,12 @@\n    */\n   @NonNull\n   Task<Void> delete();\n+\n+  /**\n+   * Register a listener to receive fid changes.\n+   *\n+   * @param listener implementation of the {@code FidListener} to handle fid changes.\n+   * @hide\n+   */\n+  void registerFidListener(FidListener listener);", "originalCommit": "ada672b4f9268e6bec5bb91563dc5c76d48f33db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwMjczOQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r528902739", "bodyText": "Also, it might make sense to add a NonNull annotation onto the listener argument.", "author": "vkryachko", "createdAt": "2020-11-23T18:12:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwMjM2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwMzM5MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r528903390", "body": "It looks like this javadoc discourages use of this interface and then immediately suggests to use the same interface instead. Can you clarify the intent here?", "bodyText": "It looks like this javadoc discourages use of this interface and then immediately suggests to use the same interface instead. Can you clarify the intent here?", "bodyHTML": "<p dir=\"auto\">It looks like this javadoc discourages use of this interface and then immediately suggests to use the same interface instead. Can you clarify the intent here?</p>", "author": "vkryachko", "createdAt": "2020-11-23T18:14:04Z", "path": "firebase-installations-interop/src/main/java/com/google/firebase/installations/internal/FidListener.java", "diffHunk": "@@ -0,0 +1,35 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.installations.internal;\n+\n+import androidx.annotation.NonNull;\n+\n+/**\n+ * <aside class=\"warning\"><strong>Provides an inter-operational interface only</strong>; instead,\n+ * use {@link FidListener} to call a listener when a Fid changes.</aside>", "originalCommit": "ada672b4f9268e6bec5bb91563dc5c76d48f33db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwNDIzMg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r528904232", "body": "Should it instead be?\r\n```suggestion\r\n  public void registerFidListener(@NonNull FidListener listener) {\r\n```", "bodyText": "Should it instead be?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void registerFidListener(@Nullable FidListener listener) {\n          \n          \n            \n              public void registerFidListener(@NonNull FidListener listener) {", "bodyHTML": "<p dir=\"auto\">Should it instead be?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> registerFidListener(<span class=\"pl-k\">@<span class=\"x x-first x-last\">Nullable</span></span> <span class=\"pl-smi\">FidListener</span> listener) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">  <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> registerFidListener(<span class=\"pl-k\">@<span class=\"x x-first x-last\">NonNull</span></span> <span class=\"pl-smi\">FidListener</span> listener) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "vkryachko", "createdAt": "2020-11-23T18:15:29Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -271,6 +275,14 @@ String getName() {\n     return Tasks.call(backgroundExecutor, this::deleteFirebaseInstallationId);\n   }\n \n+  /** Register a callback {@link FidListener} to receive fid changes. */\n+  @Override\n+  public void registerFidListener(@Nullable FidListener listener) {", "originalCommit": "ada672b4f9268e6bec5bb91563dc5c76d48f33db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwNDcyMw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r528904723", "body": "it looks equivalent to just making the whole method `saynchronized`, please consider doing that.", "bodyText": "it looks equivalent to just making the whole method saynchronized, please consider doing that.", "bodyHTML": "<p dir=\"auto\">it looks equivalent to just making the whole method <code>saynchronized</code>, please consider doing that.</p>", "author": "vkryachko", "createdAt": "2020-11-23T18:16:24Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -271,6 +275,14 @@ String getName() {\n     return Tasks.call(backgroundExecutor, this::deleteFirebaseInstallationId);\n   }\n \n+  /** Register a callback {@link FidListener} to receive fid changes. */\n+  @Override\n+  public void registerFidListener(@Nullable FidListener listener) {\n+    synchronized (this) {", "originalCommit": "ada672b4f9268e6bec5bb91563dc5c76d48f33db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkwNTkxNQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r528905915", "body": "Looks like you're only supporting one listener at a time, I wonder if we want to allow multiple listeners, otherwise it may be surprising to clients that their listener is removed just because someone else registered a listener as well.", "bodyText": "Looks like you're only supporting one listener at a time, I wonder if we want to allow multiple listeners, otherwise it may be surprising to clients that their listener is removed just because someone else registered a listener as well.", "bodyHTML": "<p dir=\"auto\">Looks like you're only supporting one listener at a time, I wonder if we want to allow multiple listeners, otherwise it may be surprising to clients that their listener is removed just because someone else registered a listener as well.</p>", "author": "vkryachko", "createdAt": "2020-11-23T18:18:34Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -271,6 +275,14 @@ String getName() {\n     return Tasks.call(backgroundExecutor, this::deleteFirebaseInstallationId);\n   }\n \n+  /** Register a callback {@link FidListener} to receive fid changes. */\n+  @Override\n+  public void registerFidListener(@Nullable FidListener listener) {\n+    synchronized (this) {\n+      this.fidListener = listener;", "originalCommit": "ada672b4f9268e6bec5bb91563dc5c76d48f33db", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkyMDE0MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r528920140", "body": "Should there be a way to \"unregister\" the listener? A common way to do it is to have the `register` method return a \"registration\" object, that has a `remove()` method.", "bodyText": "Should there be a way to \"unregister\" the listener? A common way to do it is to have the register method return a \"registration\" object, that has a remove() method.", "bodyHTML": "<p dir=\"auto\">Should there be a way to \"unregister\" the listener? A common way to do it is to have the <code>register</code> method return a \"registration\" object, that has a <code>remove()</code> method.</p>", "author": "vkryachko", "createdAt": "2020-11-23T18:44:09Z", "path": "firebase-installations-interop/src/main/java/com/google/firebase/installations/FirebaseInstallationsApi.java", "diffHunk": "@@ -51,4 +52,12 @@\n    */\n   @NonNull\n   Task<Void> delete();\n+\n+  /**\n+   * Register a listener to receive fid changes.", "originalCommit": "ada672b4f9268e6bec5bb91563dc5c76d48f33db", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1MTc5Mg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r530151792", "bodyText": "Done. PTAL if the changes look.", "author": "ankitaj224", "createdAt": "2020-11-25T07:17:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkyMDE0MA=="}], "type": "inlineReview"}, {"oid": "f7fb021c84e5128b285f384a9cbad4259b067af2", "url": "https://github.com/firebase/firebase-android-sdk/commit/f7fb021c84e5128b285f384a9cbad4259b067af2", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk into fisHook", "committedDate": "2020-11-23T19:00:36Z", "type": "commit"}, {"oid": "6c5a1eb98cc94551817de5bc033e58b70cf2cb44", "url": "https://github.com/firebase/firebase-android-sdk/commit/6c5a1eb98cc94551817de5bc033e58b70cf2cb44", "message": "Addressing vlad's comments.", "committedDate": "2020-11-25T07:00:17Z", "type": "commit"}, {"oid": "28e81abf0269d51f112efbcd65ec74737e1afb3a", "url": "https://github.com/firebase/firebase-android-sdk/commit/28e81abf0269d51f112efbcd65ec74737e1afb3a", "message": "Adding unregister method for listeners", "committedDate": "2020-11-25T07:16:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM5OTUyNA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r530399524", "body": "nit:\r\n```suggestion\r\npublic interface FidListenerHandle {\r\n```", "bodyText": "nit:\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public interface HandleFidListener {\n          \n          \n            \n            public interface FidListenerHandle {", "bodyHTML": "<p dir=\"auto\">nit:</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">interface</span> <span class=\"pl-en x x-first x-last\">HandleFidListener</span> {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">interface</span> <span class=\"pl-en x x-first x-last\">FidListenerHandle</span> {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "vkryachko", "createdAt": "2020-11-25T14:08:18Z", "path": "firebase-installations-interop/src/main/java/com/google/firebase/installations/internal/HandleFidListener.java", "diffHunk": "@@ -0,0 +1,30 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.installations.internal;\n+\n+/**\n+ * Interface for un-registering a previously registered listener.\n+ *\n+ * @hide\n+ */\n+public interface HandleFidListener {", "originalCommit": "28e81abf0269d51f112efbcd65ec74737e1afb3a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQwMTM4Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r530401386", "body": "The handle is supposed to represent a registration so it shouldn't take a listener as a parameter. For an example see\r\nhttps://github.com/firebase/firebase-android-sdk/blob/c7d3073d6fe2c168d93acfac88c45ec49a583601/firebase-firestore/src/main/java/com/google/firebase/firestore/ListenerRegistration.java#L17-L25", "bodyText": "The handle is supposed to represent a registration so it shouldn't take a listener as a parameter. For an example see\n\n  \n    \n      firebase-android-sdk/firebase-firestore/src/main/java/com/google/firebase/firestore/ListenerRegistration.java\n    \n    \n        Lines 17 to 25\n      in\n      c7d3073\n    \n    \n    \n    \n\n        \n          \n           /** Represents a listener that can be removed by calling {@link #remove()}. */ \n        \n\n        \n          \n           public interface ListenerRegistration { \n        \n\n        \n          \n            \n        \n\n        \n          \n             /** \n        \n\n        \n          \n              * Removes the listener being tracked by this {@code ListenerRegistration}. After the initial \n        \n\n        \n          \n              * call, subsequent calls have no effect. \n        \n\n        \n          \n              */ \n        \n\n        \n          \n             void remove(); \n        \n\n        \n          \n           }", "bodyHTML": "<p dir=\"auto\">The handle is supposed to represent a registration so it shouldn't take a listener as a parameter. For an example see<br>\n<div class=\"border rounded-1 my-2\">\n  <div class=\"f6 px-3 py-2 lh-condensed border-bottom color-bg-subtle\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/firebase/firebase-android-sdk/blob/c7d3073d6fe2c168d93acfac88c45ec49a583601/firebase-firestore/src/main/java/com/google/firebase/firestore/ListenerRegistration.java#L17-L25\">firebase-android-sdk/firebase-firestore/src/main/java/com/google/firebase/firestore/ListenerRegistration.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 17 to 25\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/firebase/firebase-android-sdk/commit/c7d3073d6fe2c168d93acfac88c45ec49a583601\">c7d3073</a>\n    </p>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L17\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"17\"></td>\n          <td id=\"LC17\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\"><span class=\"pl-c\">/*</span>* Represents a listener that can be removed by calling {@link #remove()}. <span class=\"pl-c\">*/</span></span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L18\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"18\"></td>\n          <td id=\"LC18\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-k\">interface</span> <span class=\"pl-en\">ListenerRegistration</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L19\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"19\"></td>\n          <td id=\"LC19\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L20\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"20\"></td>\n          <td id=\"LC20\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\"><span class=\"pl-c\">/**</span></span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L21\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"21\"></td>\n          <td id=\"LC21\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">   * Removes the listener being tracked by this {<span class=\"pl-k\">@code</span><span class=\"pl-c1\"> ListenerRegistration</span>}. After the initial</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L22\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"22\"></td>\n          <td id=\"LC22\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">   * call, subsequent calls have no effect.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L23\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"23\"></td>\n          <td id=\"LC23\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">   <span class=\"pl-c\">*/</span></span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L24\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"24\"></td>\n          <td id=\"LC24\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">void</span> <span class=\"pl-en\">remove</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L25\" class=\"blob-num border-0 px-3 py-0 color-bg-default js-line-number\" data-line-number=\"25\"></td>\n          <td id=\"LC25\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</p>", "author": "vkryachko", "createdAt": "2020-11-25T14:10:58Z", "path": "firebase-installations-interop/src/main/java/com/google/firebase/installations/internal/HandleFidListener.java", "diffHunk": "@@ -0,0 +1,30 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase.installations.internal;\n+\n+/**\n+ * Interface for un-registering a previously registered listener.\n+ *\n+ * @hide\n+ */\n+public interface HandleFidListener {\n+\n+  /**\n+   * Unregisters a previously registered {@link FidListener}.\n+   *\n+   * @hide\n+   */\n+  void unregister(FidListener fidListener);", "originalCommit": "28e81abf0269d51f112efbcd65ec74737e1afb3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgwMTAwNg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r532801006", "bodyText": "PTAL. Thanks", "author": "ankitaj224", "createdAt": "2020-11-30T18:14:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQwMTM4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQwMjk4OA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r530402988", "body": "While the registration is synchronized, the unregister is not, please consider something like\r\n```suggestion\r\n      public synchronized void unregister() {\r\n        fidListeners.remove(listener);\r\n      }\r\n```", "bodyText": "While the registration is synchronized, the unregister is not, please consider something like\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  public void unregister(FidListener fidListener) {\n          \n          \n            \n                    if (fidListeners.contains(fidListener)) {\n          \n          \n            \n                      fidListeners.remove(fidListener);\n          \n          \n            \n                    }\n          \n          \n            \n                  }\n          \n          \n            \n                  public synchronized void unregister() {\n          \n          \n            \n                    fidListeners.remove(listener);\n          \n          \n            \n                  }", "bodyHTML": "<p dir=\"auto\">While the registration is synchronized, the unregister is not, please consider something like</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"296\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      <span class=\"pl-k\">public</span> <span class=\"pl-k\">void</span> unregister(<span class=\"pl-smi\">FidListener</span> fidListener) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"297\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (fidListeners<span class=\"pl-k\">.</span>contains(fidListener)) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"298\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">          fidListeners<span class=\"pl-k\">.</span>remove(fidListener);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"299\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"300\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">      }</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"296\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      <span class=\"pl-k\">public</span> <span class=\"pl-k\">synchronized</span> <span class=\"pl-k\">void</span> unregister() {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"297\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        fidListeners<span class=\"pl-k\">.</span>remove(listener);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"298\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">      }</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "vkryachko", "createdAt": "2020-11-25T14:13:14Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -271,6 +278,21 @@ String getName() {\n     return Tasks.call(backgroundExecutor, this::deleteFirebaseInstallationId);\n   }\n \n+  /** Register a callback {@link FidListener} to receive fid changes. */\n+  @NonNull\n+  @Override\n+  public synchronized HandleFidListener registerFidListener(@NonNull FidListener listener) {\n+    this.fidListeners.add(listener);\n+    return new HandleFidListener() {\n+      @Override\n+      public void unregister(FidListener fidListener) {\n+        if (fidListeners.contains(fidListener)) {\n+          fidListeners.remove(fidListener);\n+        }\n+      }", "originalCommit": "28e81abf0269d51f112efbcd65ec74737e1afb3a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQwNDUxNg==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r530404516", "body": "Please consider adding a test for removing a registration as well.", "bodyText": "Please consider adding a test for removing a registration as well.", "bodyHTML": "<p dir=\"auto\">Please consider adding a test for removing a registration as well.</p>", "author": "vkryachko", "createdAt": "2020-11-25T14:15:32Z", "path": "firebase-installations/src/test/java/com/google/firebase/installations/FirebaseInstallationsTest.java", "diffHunk": "@@ -453,6 +454,40 @@ public void testReadToken_withJsonformatting() {\n     assertThat(iidStore.readToken(), equalTo(\"thetoken\"));\n   }\n \n+  @Test\n+  public void testFidListener_fidChanged_successful() throws Exception {\n+    when(mockIidStore.readIid()).thenReturn(null);\n+    when(mockIidStore.readToken()).thenReturn(null);\n+    when(mockBackend.createFirebaseInstallation(\n+            anyString(), anyString(), anyString(), anyString(), any()))\n+        .thenReturn(\n+            TEST_INSTALLATION_RESPONSE\n+                .toBuilder()\n+                .setUri(\"/projects/\" + TEST_PROJECT_ID + \"/installations/\" + TEST_FID_2)\n+                .setFid(TEST_FID_2)\n+                .build());\n+\n+    FakeFidListener fidListener = new FakeFidListener();\n+    // Register the FidListener\n+    firebaseInstallations.registerFidListener(fidListener);", "originalCommit": "28e81abf0269d51f112efbcd65ec74737e1afb3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgwMTQwOQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r532801409", "bodyText": "Updated this test to check the removing registration code as well. PTAL. Thanks", "author": "ankitaj224", "createdAt": "2020-11-30T18:15:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQwNDUxNg=="}], "type": "inlineReview"}, {"oid": "7a83a77fbf29fdc4389fa8452f9d9c46f51cdd88", "url": "https://github.com/firebase/firebase-android-sdk/commit/7a83a77fbf29fdc4389fa8452f9d9c46f51cdd88", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk into fisHook", "committedDate": "2020-11-30T17:47:45Z", "type": "commit"}, {"oid": "43ed01bcc2f89d00ed740541888e08d91196a618", "url": "https://github.com/firebase/firebase-android-sdk/commit/43ed01bcc2f89d00ed740541888e08d91196a618", "message": "Fixing the FidListenerHandle", "committedDate": "2020-11-30T17:57:22Z", "type": "commit"}, {"oid": "56c7b852c0cddd0a85c6374d09b6d60f5ca7d679", "url": "https://github.com/firebase/firebase-android-sdk/commit/56c7b852c0cddd0a85c6374d09b6d60f5ca7d679", "message": "Adding test to validate unregistering the listener", "committedDate": "2020-11-30T18:13:35Z", "type": "commit"}, {"oid": "c276010bf7e6a9f186b4eb30efc3b97b61b646bd", "url": "https://github.com/firebase/firebase-android-sdk/commit/c276010bf7e6a9f186b4eb30efc3b97b61b646bd", "message": "Fixing api.txt", "committedDate": "2020-11-30T19:30:35Z", "type": "commit"}, {"oid": "16cc4d1a7a51f472cdbd0a35b07eb3729058f627", "url": "https://github.com/firebase/firebase-android-sdk/commit/16cc4d1a7a51f472cdbd0a35b07eb3729058f627", "message": "Fixing gradle errors", "committedDate": "2020-11-30T23:10:35Z", "type": "commit"}, {"oid": "3d5b1120fdfae20fd2d98d2762e9544979fb5621", "url": "https://github.com/firebase/firebase-android-sdk/commit/3d5b1120fdfae20fd2d98d2762e9544979fb5621", "message": "Minor fix", "committedDate": "2020-11-30T23:37:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2ODU5NA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r533568594", "body": "nit: consider removing the `contains` check as remove handles it internally.", "bodyText": "nit: consider removing the contains check as remove handles it internally.", "bodyHTML": "<p dir=\"auto\">nit: consider removing the <code>contains</code> check as remove handles it internally.</p>", "author": "vkryachko", "createdAt": "2020-12-01T16:55:00Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -278,16 +278,22 @@ String getName() {\n     return Tasks.call(backgroundExecutor, this::deleteFirebaseInstallationId);\n   }\n \n-  /** Register a callback {@link FidListener} to receive fid changes. */\n+  /**\n+   * Register a callback {@link FidListener} to receive fid changes.\n+   *\n+   * @hide\n+   */\n   @NonNull\n   @Override\n-  public synchronized HandleFidListener registerFidListener(@NonNull FidListener listener) {\n-    this.fidListeners.add(listener);\n-    return new HandleFidListener() {\n+  public synchronized FidListenerHandle registerFidListener(@NonNull FidListener listener) {\n+    fidListeners.add(listener);\n+    return new FidListenerHandle() {\n       @Override\n-      public void unregister(FidListener fidListener) {\n-        if (fidListeners.contains(fidListener)) {\n-          fidListeners.remove(fidListener);\n+      public void unregister() {\n+        synchronized (FirebaseInstallations.this) {\n+          if (fidListeners.contains(listener)) {", "originalCommit": "3d5b1120fdfae20fd2d98d2762e9544979fb5621", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1Njg1NA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2195#discussion_r533756854", "bodyText": "Thanks. Done", "author": "ankitaj224", "createdAt": "2020-12-01T22:14:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2ODU5NA=="}], "type": "inlineReview"}, {"oid": "0e45a1000e2679b3e49725b778208c5a2c03c56a", "url": "https://github.com/firebase/firebase-android-sdk/commit/0e45a1000e2679b3e49725b778208c5a2c03c56a", "message": "Fixing minor nit", "committedDate": "2020-12-01T22:13:32Z", "type": "commit"}, {"oid": "78d2468a7010426bb5290ac054b1b5a318ead3cc", "url": "https://github.com/firebase/firebase-android-sdk/commit/78d2468a7010426bb5290ac054b1b5a318ead3cc", "message": "Merge branch 'master' of github.com:firebase/firebase-android-sdk into fisHook", "committedDate": "2020-12-01T22:14:00Z", "type": "commit"}]}