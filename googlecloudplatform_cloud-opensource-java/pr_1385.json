{"pr_number": 1385, "pr_title": "move readBom methods to Bom class", "pr_author": "elharo", "pr_createdAt": "2020-05-05T16:01:08Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1385", "timeline": [{"oid": "b6f80a48a34d7faf069562a432f0ee6302008ec2", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b6f80a48a34d7faf069562a432f0ee6302008ec2", "message": "move readBom methods to Bom class", "committedDate": "2020-05-05T15:58:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5MTIzMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1385#discussion_r420291230", "body": "Unnecessary space at the end of line/", "bodyText": "Unnecessary space at the end of line/", "bodyHTML": "<p dir=\"auto\">Unnecessary space at the end of line/</p>", "author": "suztomo", "createdAt": "2020-05-05T17:42:16Z", "path": "dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/BomTest.java", "diffHunk": "@@ -26,19 +26,19 @@\n import org.eclipse.aether.artifact.Artifact;\n import org.junit.Assert;\n import org.junit.Test;\n+import com.google.cloud.tools.opensource.dependencies.Bom;\n import com.google.cloud.tools.opensource.dependencies.MavenRepositoryException;\n-import com.google.cloud.tools.opensource.dependencies.RepositoryUtility;\n \n public class BomTest {\n \n   private static final Path CLOUD_OSS_BOM_PATH =\n-      Paths.get(\"..\", \"boms\", \"cloud-oss-bom\", \"pom.xml\").toAbsolutePath();\n-\n+      Paths.get(\"..\", \"boms\", \"cloud-oss-bom\", \"pom.xml\").toAbsolutePath();  ", "originalCommit": "b6f80a48a34d7faf069562a432f0ee6302008ec2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5MTYzNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1385#discussion_r420291636", "body": "```suggestion\r\n   * Parses the dependencyManagement section of an artifact and returns the artifacts included there.\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Parse the dependencyManagement section of an artifact and return the artifacts included there.\n          \n          \n            \n               * Parses the dependencyManagement section of an artifact and returns the artifacts included there.", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi x x-first x-last\">Parse</span> the dependencyManagement section of an artifact and <span class=\"pl-k x x-first x-last\">return</span> the artifacts included there.</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">   <span class=\"pl-k\">*</span> <span class=\"pl-smi x x-first x-last\">Parses</span> the dependencyManagement section of an artifact and <span class=\"x x-first x-last\">returns</span> the artifacts included there.</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "suztomo", "createdAt": "2020-05-05T17:42:57Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/Bom.java", "diffHunk": "@@ -59,6 +72,75 @@ public String getCoordinates() {\n     return coordinates;\n   }\n \n+  public static Bom readBom(Path pomFile) throws MavenRepositoryException {\n+    RepositorySystem system = RepositoryUtility.newRepositorySystem();\n+    RepositorySystemSession session = RepositoryUtility.newSession(system);\n+  \n+    MavenProject mavenProject = RepositoryUtility.createMavenProject(pomFile, session);\n+    String coordinates = mavenProject.getGroupId() + \":\" + mavenProject.getArtifactId() \n+        + \":\" + mavenProject.getVersion();\n+    DependencyManagement dependencyManagement = mavenProject.getDependencyManagement();\n+    List<org.apache.maven.model.Dependency> dependencies = dependencyManagement.getDependencies();\n+  \n+    ArtifactTypeRegistry registry = session.getArtifactTypeRegistry();\n+    ImmutableList<Artifact> artifacts = dependencies.stream()\n+        .map(dependency -> RepositoryUtils.toDependency(dependency, registry))\n+        .map(Dependency::getArtifact)\n+        .filter(artifact -> !shouldSkipBomMember(artifact))\n+        .collect(ImmutableList.toImmutableList());\n+    \n+    Bom bom = new Bom(coordinates, artifacts);\n+    return bom;\n+  }\n+\n+  /**\n+   * Parse the dependencyManagement section of an artifact and return the artifacts included there.", "originalCommit": "b6f80a48a34d7faf069562a432f0ee6302008ec2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzMjk4Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1385#discussion_r420332983", "bodyText": "done", "author": "elharo", "createdAt": "2020-05-05T18:51:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5MTYzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5MjM0OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1385#discussion_r420292348", "body": "Insert an empty line between static imports and non-static imports.", "bodyText": "Insert an empty line between static imports and non-static imports.", "bodyHTML": "<p dir=\"auto\">Insert an empty line between static imports and non-static imports.</p>", "author": "suztomo", "createdAt": "2020-05-05T17:44:06Z", "path": "dependencies/src/test/java/com/google/cloud/tools/opensource/classpath/ClassPathBuilderTest.java", "diffHunk": "@@ -19,8 +19,7 @@\n import static com.google.cloud.tools.opensource.classpath.TestHelper.COORDINATES;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertNotNull;\n-\n-import com.google.cloud.tools.opensource.dependencies.RepositoryUtility;", "originalCommit": "b6f80a48a34d7faf069562a432f0ee6302008ec2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzMzEyNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1385#discussion_r420333124", "bodyText": "done", "author": "elharo", "createdAt": "2020-05-05T18:51:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI5MjM0OA=="}], "type": "inlineReview"}, {"oid": "d329b2415de8520b3db8b3799994efca84e724a9", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/d329b2415de8520b3db8b3799994efca84e724a9", "message": "order imports", "committedDate": "2020-05-05T18:48:31Z", "type": "commit"}, {"oid": "cdc14f758e95cde97d49809f78b8f44dd39ff2ab", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/cdc14f758e95cde97d49809f78b8f44dd39ff2ab", "message": "improve javadoc", "committedDate": "2020-05-05T18:51:12Z", "type": "commit"}]}