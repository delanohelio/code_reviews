{"pr_number": 4622, "pr_title": "CUSTCOM-133 Code cleanup in security", "pr_author": "dmatej", "pr_createdAt": "2020-04-15T07:46:47Z", "pr_url": "https://github.com/payara/Payara/pull/4622", "timeline": [{"oid": "d31653cd8679a0fe15352a3a2bbea7e4f2ff1c9b", "url": "https://github.com/payara/Payara/commit/d31653cd8679a0fe15352a3a2bbea7e4f2ff1c9b", "message": "CUSTCOM-133 Cleanups around security\n\n- trimmed white spaces, manual formatting\n- more logging\n- added javadocs\n- enhanced loops\n- WebContainer:1812\n  - removed dead code, simplified\n- WebModuleConfig\n  - new method isSystemObjectType; it was weird to make this comparison outside\n    the object", "committedDate": "2020-04-16T11:09:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYyNTAwOQ==", "url": "https://github.com/payara/Payara/pull/4622#discussion_r409625009", "body": "(\u256f\u00b0\u25a1\u00b0\uff09\u256f\ufe35 \u253b\u2501\u253b\r\n```suggestion\r\n        initialise(appname);\r\n```", "bodyText": "(\u256f\u00b0\u25a1\u00b0\uff09\u256f\ufe35 \u253b\u2501\u253b\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    initialize(appname);\n          \n          \n            \n                    initialise(appname);", "bodyHTML": "<p dir=\"auto\">(\u256f\u00b0\u25a1\u00b0\uff09\u256f\ufe35 \u253b\u2501\u253b</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"x x-first x-last\">initialize</span>(appname);</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"x x-first x-last\">initialise</span>(appname);</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Pandrex247", "createdAt": "2020-04-16T14:57:39Z", "path": "appserver/security/core-ee/src/main/java/com/sun/enterprise/security/jacc/JaccWebAuthorizationManager.java", "diffHunk": "@@ -181,38 +178,36 @@ public JaccWebAuthorizationManager(WebBundleDescriptor webBundleDescriptor, Serv\n         this.CONTEXT_ID = getContextID(webBundleDescriptor);\n         this.serverContext = serverContext;\n         this.webSecurityManagerFactory = webSecurityManagerFactory;\n-        \n-        String appname = getAppId();\n \n-        postConstruct();\n-        \n+        String appname = getAppId();\n+        SecurityRoleMapperFactoryGen.getSecurityRoleMapperFactory().setAppNameForContext(getAppId(), CONTEXT_ID);\n         // Initialize this class and specifically load permissions into the JACC Policy Configuration.\n-        initialise(appname);\n+        initialize(appname);", "originalCommit": "d31653cd8679a0fe15352a3a2bbea7e4f2ff1c9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY1MTg1MQ==", "url": "https://github.com/payara/Payara/pull/4622#discussion_r409651851", "bodyText": "Funny, I knew that there are differences between uk and us, but I assumed this is a mistake even in UK :D\nhttps://english.stackexchange.com/questions/459553/initialised-or-initialized-which-one-is-correct-spelling\nIn czech variant of this word is \"s\" variant obsoleted. I don't want to start any long discussion, but generally, should we prefer us or uk when we are EU-based?\nI did some \"research\" in Payara sources:\n\n\n\nprobably we should be more consistent at least ...", "author": "dmatej", "createdAt": "2020-04-16T15:33:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYyNTAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTY2NTgyNQ==", "url": "https://github.com/payara/Payara/pull/4622#discussion_r409665825", "bodyText": "I will revert it back, as it is not the only requested change and payara sources don't use consistent language, this change can be done in separate issue making the language consistent.", "author": "dmatej", "createdAt": "2020-04-16T15:52:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYyNTAwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzMzIwNA==", "url": "https://github.com/payara/Payara/pull/4622#discussion_r409633204", "body": "```suggestion\r\n     * @param defaultRealmName - this realm name will be used as a default if there is not\r\n```\r\nGrammar", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param defaultRealmName - this realm name will be used as a default if there will not be\n          \n          \n            \n                 * @param defaultRealmName - this realm name will be used as a default if there is not\n          \n      \n    \n    \n  \n\nGrammar", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@param</span> defaultRealmName <span class=\"pl-k\">-</span> <span class=\"pl-c1\">this</span> realm name will be used as a <span class=\"pl-k\">default</span> <span class=\"pl-k\">if</span> there <span class=\"x x-first x-last\">will</span> not<span class=\"x x-first x-last\"> be</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">     <span class=\"pl-k\">*</span> <span class=\"pl-k\">@param</span> defaultRealmName <span class=\"pl-k\">-</span> <span class=\"pl-c1\">this</span> realm name will be used as a <span class=\"pl-k\">default</span> <span class=\"pl-k\">if</span> there <span class=\"x x-first x-last\">is</span> not</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n\n<p dir=\"auto\">Grammar</p>", "author": "Pandrex247", "createdAt": "2020-04-16T15:08:19Z", "path": "nucleus/common/common-util/src/main/java/com/sun/enterprise/security/integration/RealmInitializer.java", "diffHunk": "@@ -37,22 +37,38 @@\n  * only if the new code is made subject to such option by the copyright\n  * holder.\n  */\n-// Portions Copyright [2019] [Payara Foundation and/or its affiliates]\n+// Portions Copyright [2019-2020] [Payara Foundation and/or its affiliates]\n package com.sun.enterprise.security.integration;\n \n /**\n  * Interface to facilitate Initialization of the injected Realm Instance with Application Descriptor info.\n- * \n+ *\n  * <p>\n  * See com.sun.enterprise.web.WebContainer and com.sun.web.security.RealmAdapter\n  */\n public interface RealmInitializer {\n \n-    void initializeRealm(Object bundledescriptor, boolean isSystemApp, String realmName);\n+    /**\n+     * Initializes the internal state of this instance with provided parameters.\n+     *\n+     * @param bundleDescriptor - contains bundle-specific configuration\n+     * @param isSystemApp - realm may have different behavior for system applications\n+     * @param defaultRealmName - this realm name will be used as a default if there will not be", "originalCommit": "d31653cd8679a0fe15352a3a2bbea7e4f2ff1c9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTYzNTEwOA==", "url": "https://github.com/payara/Payara/pull/4622#discussion_r409635108", "body": "```suggestion\r\n        if (listener == null) {\r\n```", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if ( listener == null ) {\n          \n          \n            \n                    if (listener == null) {", "bodyHTML": "  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-k\">if</span> (<span class=\"x x-first x-last\"> </span>listener <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span><span class=\"x x-first x-last\"> </span>) {</td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-k\">if</span> (listener <span class=\"pl-k\">==</span> <span class=\"pl-c1\">null</span>) {</td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "Pandrex247", "createdAt": "2020-04-16T15:10:59Z", "path": "appserver/web/web-glue/src/main/java/com/sun/enterprise/web/WebModule.java", "diffHunk": "@@ -1266,7 +1264,9 @@ protected void addValve(org.glassfish.web.deployment.runtime.Valve valveDescript\n     protected void addCatalinaListener(String listenerName) {\n         Object listener = loadInstance(listenerName);\n \n-        if ( listener == null ) return;\n+        if ( listener == null ) {", "originalCommit": "d31653cd8679a0fe15352a3a2bbea7e4f2ff1c9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "37627552b2006849ae6a3835f6d6fb0898e91ad6", "url": "https://github.com/payara/Payara/commit/37627552b2006849ae6a3835f6d6fb0898e91ad6", "message": "CUSTCOM-133 Cleanups around security\n\n- trimmed white spaces, manual formatting\n- more logging\n- added javadocs\n- enhanced loops\n- WebContainer:1812\n  - removed dead code, simplified\n- WebModuleConfig\n  - new method isSystemObjectType; it was weird to make this comparison outside\n    the object", "committedDate": "2020-04-16T16:27:40Z", "type": "commit"}, {"oid": "37627552b2006849ae6a3835f6d6fb0898e91ad6", "url": "https://github.com/payara/Payara/commit/37627552b2006849ae6a3835f6d6fb0898e91ad6", "message": "CUSTCOM-133 Cleanups around security\n\n- trimmed white spaces, manual formatting\n- more logging\n- added javadocs\n- enhanced loops\n- WebContainer:1812\n  - removed dead code, simplified\n- WebModuleConfig\n  - new method isSystemObjectType; it was weird to make this comparison outside\n    the object", "committedDate": "2020-04-16T16:27:40Z", "type": "forcePushed"}]}