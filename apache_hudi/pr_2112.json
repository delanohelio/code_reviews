{"pr_number": 2112, "pr_title": "[HUDI-995] Migrate HoodieTestUtils APIs to HoodieTestTable", "pr_author": "xushiyan", "pr_createdAt": "2020-09-24T19:58:08Z", "pr_url": "https://github.com/apache/hudi/pull/2112", "timeline": [{"oid": "5171847b208e25557d23f81cc916f2646e0eb938", "url": "https://github.com/apache/hudi/commit/5171847b208e25557d23f81cc916f2646e0eb938", "message": "[HUDI-995] Migrate HoodieTestUtils APIs to HoodieTestTable\n\nRemove APIs in HoodieTestUtils\n\n- HoodieTestUtils#createInflightCommitFiles\n- HoodieTestUtils#getCommitFilePath\n- HoodieTestUtils#doesCommitExist\n\nand migrate usages to HoodieTestTable in\n\n- hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestRollbacksCommand.java\n- hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestUpgradeDowngradeCommand.java\n- hudi-cli/src/test/java/org/apache/hudi/cli/integ/ITTestCommitsCommand.java\n- hudi-cli/src/test/java/org/apache/hudi/cli/testutils/HoodieTestCommitMetadataGenerator.java\n- hudi-client/src/test/java/org/apache/hudi/client/TestHoodieClientOnCopyOnWriteStorage.java", "committedDate": "2020-09-25T04:13:06Z", "type": "commit"}, {"oid": "5171847b208e25557d23f81cc916f2646e0eb938", "url": "https://github.com/apache/hudi/commit/5171847b208e25557d23f81cc916f2646e0eb938", "message": "[HUDI-995] Migrate HoodieTestUtils APIs to HoodieTestTable\n\nRemove APIs in HoodieTestUtils\n\n- HoodieTestUtils#createInflightCommitFiles\n- HoodieTestUtils#getCommitFilePath\n- HoodieTestUtils#doesCommitExist\n\nand migrate usages to HoodieTestTable in\n\n- hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestRollbacksCommand.java\n- hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestUpgradeDowngradeCommand.java\n- hudi-cli/src/test/java/org/apache/hudi/cli/integ/ITTestCommitsCommand.java\n- hudi-cli/src/test/java/org/apache/hudi/cli/testutils/HoodieTestCommitMetadataGenerator.java\n- hudi-client/src/test/java/org/apache/hudi/client/TestHoodieClientOnCopyOnWriteStorage.java", "committedDate": "2020-09-25T04:13:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1MjI5MQ==", "url": "https://github.com/apache/hudi/pull/2112#discussion_r494952291", "body": "Why we should do this refactor?", "bodyText": "Why we should do this refactor?", "bodyHTML": "<p dir=\"auto\">Why we should do this refactor?</p>", "author": "yanghua", "createdAt": "2020-09-25T12:26:43Z", "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestCommitsCommand.java", "diffHunk": "@@ -76,17 +76,19 @@ public void init() throws IOException {\n         \"\", TimelineLayoutVersion.VERSION_1, \"org.apache.hudi.common.model.HoodieAvroPayload\");\n   }\n \n-  private LinkedHashMap<String, Integer[]> generateData() {\n+  private LinkedHashMap<String, Integer[]> generateData() throws Exception {\n     // generate data and metadata\n     LinkedHashMap<String, Integer[]> data = new LinkedHashMap<>();\n     data.put(\"102\", new Integer[] {15, 10});\n     data.put(\"101\", new Integer[] {20, 10});\n     data.put(\"100\", new Integer[] {15, 15});\n \n-    data.forEach((key, value) -> {\n+    for (Map.Entry<String, Integer[]> entry : data.entrySet()) {", "originalCommit": "5171847b208e25557d23f81cc916f2646e0eb938", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ0OTI5Ng==", "url": "https://github.com/apache/hudi/pull/2112#discussion_r495449296", "bodyText": "@yanghua In HoodieTestCommitMetadataGenerator#createCommitFileWithMetadata (refer to the comment above), I removed the try catch block by declaring the exception hence the callers need to declare it too. The callers' forEach force it to be caught therefore changed to for-loop. I'm trying to adopt a preference of declaring Exception over catching them and for-loop over Stream#forEach to avoid noisy try-catch. Please let me know your thoughts.", "author": "xushiyan", "createdAt": "2020-09-26T11:53:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1MjI5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ1NjI5MQ==", "url": "https://github.com/apache/hudi/pull/2112#discussion_r495456291", "bodyText": "Ok, I can accept this explanation.", "author": "yanghua", "createdAt": "2020-09-26T13:20:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1MjI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk1MjQ0Mg==", "url": "https://github.com/apache/hudi/pull/2112#discussion_r494952442", "body": "ditto", "bodyText": "ditto", "bodyHTML": "<p dir=\"auto\">ditto</p>", "author": "yanghua", "createdAt": "2020-09-25T12:26:59Z", "path": "hudi-cli/src/test/java/org/apache/hudi/cli/commands/TestCommitsCommand.java", "diffHunk": "@@ -168,10 +170,12 @@ public void testShowArchivedCommits() throws IOException {\n     data.put(\"102\", new Integer[] {25, 45});\n     data.put(\"101\", new Integer[] {35, 15});\n \n-    data.forEach((key, value) -> {\n+    for (Map.Entry<String, Integer[]> entry : data.entrySet()) {", "originalCommit": "5171847b208e25557d23f81cc916f2646e0eb938", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}