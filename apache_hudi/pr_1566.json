{"pr_number": 1566, "pr_title": "[HUDI-603]: DeltaStreamer can now fetch schema before every run in continuous mode", "pr_author": "pratyakshsharma", "pr_createdAt": "2020-04-26T20:15:17Z", "pr_url": "https://github.com/apache/hudi/pull/1566", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMDE4Mg==", "url": "https://github.com/apache/hudi/pull/1566#discussion_r416220182", "body": "@pratyakshsharma : It looks like refreshSchemaProvider  not only refreshes schema-provider but also recreates Source and setup WriteClient\r\n\r\n@vinothchandar : Recreating DeltaSync each run would require to handle embedded timeline server reuse and async compaction triggering differently.  Another option is to have explicit refreshSchema() API in SchemaProvider (with default implementation (for compatibility) and implementing refresh in existing Schema Provider implementation) and have delta-streamer call this ? Let me know your thoughts on this ?\r\n\r\n\r\n", "bodyText": "@pratyakshsharma : It looks like refreshSchemaProvider  not only refreshes schema-provider but also recreates Source and setup WriteClient\n@vinothchandar : Recreating DeltaSync each run would require to handle embedded timeline server reuse and async compaction triggering differently.  Another option is to have explicit refreshSchema() API in SchemaProvider (with default implementation (for compatibility) and implementing refresh in existing Schema Provider implementation) and have delta-streamer call this ? Let me know your thoughts on this ?", "bodyHTML": "<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/pratyakshsharma/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/pratyakshsharma\">@pratyakshsharma</a> : It looks like refreshSchemaProvider  not only refreshes schema-provider but also recreates Source and setup WriteClient</p>\n<p dir=\"auto\"><a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/vinothchandar/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/vinothchandar\">@vinothchandar</a> : Recreating DeltaSync each run would require to handle embedded timeline server reuse and async compaction triggering differently.  Another option is to have explicit refreshSchema() API in SchemaProvider (with default implementation (for compatibility) and implementing refresh in existing Schema Provider implementation) and have delta-streamer call this ? Let me know your thoughts on this ?</p>", "author": "bvaradar", "createdAt": "2020-04-27T23:33:49Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/deltastreamer/DeltaSync.java", "diffHunk": "@@ -162,18 +162,23 @@ public DeltaSync(HoodieDeltaStreamer.Config cfg, SparkSession sparkSession, Sche\n     this.fs = fs;\n     this.onInitializingHoodieWriteClient = onInitializingHoodieWriteClient;\n     this.props = props;\n-    this.schemaProvider = schemaProvider;\n \n     refreshTimeline();\n-\n     this.transformer = UtilHelpers.createTransformer(cfg.transformerClassNames);\n     this.keyGenerator = DataSourceUtils.createKeyGenerator(props);\n-\n-    this.formatAdapter = new SourceFormatAdapter(\n-        UtilHelpers.createSource(cfg.sourceClassName, props, jssc, sparkSession, schemaProvider));\n-\n     this.conf = conf;\n+    refreshSchemaProvider(schemaProvider);\n+  }\n \n+  /**\n+   * Very useful when DeltaStreamer is running in continuous mode.\n+   * @param schemaProvider\n+   * @throws IOException\n+   */\n+  public void refreshSchemaProvider(SchemaProvider schemaProvider) throws IOException {", "originalCommit": "dfaa70dc3bddebe875d1c194ac8916b260d0a3ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjMxOTA2NQ==", "url": "https://github.com/apache/hudi/pull/1566#discussion_r416319065", "bodyText": "right.. embedded server re-use is important. let's scratch my idea.", "author": "vinothchandar", "createdAt": "2020-04-28T04:33:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMDE4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjY5NDYwMg==", "url": "https://github.com/apache/hudi/pull/1566#discussion_r416694602", "bodyText": "It looks like refreshSchemaProvider not only refreshes schema-provider but also recreates Source and setup WriteClient\n\nDo you see any side effects of doing this? @bvaradar\n\nhave delta-streamer call this ?\n\nThis call will happen exactly at the same point where I am calling refreshSchemaProvider in delta-streamer, right?", "author": "pratyakshsharma", "createdAt": "2020-04-28T15:11:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIyMDE4Mg=="}], "type": "inlineReview"}, {"oid": "b61c87c0639ddb50fc038212ba7dd18cc92f73a7", "url": "https://github.com/apache/hudi/commit/b61c87c0639ddb50fc038212ba7dd18cc92f73a7", "message": "[HUDI-603]: DeltaStreamer can now fetch schema before every run in continuous mode", "committedDate": "2020-10-07T00:43:18Z", "type": "commit"}, {"oid": "b61c87c0639ddb50fc038212ba7dd18cc92f73a7", "url": "https://github.com/apache/hudi/commit/b61c87c0639ddb50fc038212ba7dd18cc92f73a7", "message": "[HUDI-603]: DeltaStreamer can now fetch schema before every run in continuous mode", "committedDate": "2020-10-07T00:43:18Z", "type": "forcePushed"}]}