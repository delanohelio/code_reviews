{"pr_number": 1963, "pr_title": "[HUDI-1188] Hbase index MOR tables records not being deduplicated", "pr_author": "rmpifer", "pr_createdAt": "2020-08-13T23:16:51Z", "pr_url": "https://github.com/apache/hudi/pull/1963", "timeline": [{"oid": "0ded9dba8cff584fbbf31494bebecf4d9f199d68", "url": "https://github.com/apache/hudi/commit/0ded9dba8cff584fbbf31494bebecf4d9f199d68", "message": "Fix HBASE index MOR tables not considering record index valid", "committedDate": "2020-08-18T03:18:14Z", "type": "commit"}, {"oid": "0ded9dba8cff584fbbf31494bebecf4d9f199d68", "url": "https://github.com/apache/hudi/commit/0ded9dba8cff584fbbf31494bebecf4d9f199d68", "message": "Fix HBASE index MOR tables not considering record index valid", "committedDate": "2020-08-18T03:18:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY4NzQwMQ==", "url": "https://github.com/apache/hudi/pull/1963#discussion_r472687401", "body": "Can you please change this to -> `metaClient.getActiveTimeline().getCommitsTimeline()`. For context, the getActiveTimeline() loads the timeline once and then caches it. The getCommitsTimeline() call will not force this, in this case it's working by coincidence because the metaClient passed already has the loaded timeline from the caller but I would want to avoid having that assumption. \r\n@rmpifer ", "bodyText": "Can you please change this to -> metaClient.getActiveTimeline().getCommitsTimeline(). For context, the getActiveTimeline() loads the timeline once and then caches it. The getCommitsTimeline() call will not force this, in this case it's working by coincidence because the metaClient passed already has the loaded timeline from the caller but I would want to avoid having that assumption.\n@rmpifer", "bodyHTML": "<p dir=\"auto\">Can you please change this to -&gt; <code>metaClient.getActiveTimeline().getCommitsTimeline()</code>. For context, the getActiveTimeline() loads the timeline once and then caches it. The getCommitsTimeline() call will not force this, in this case it's working by coincidence because the metaClient passed already has the loaded timeline from the caller but I would want to avoid having that assumption.<br>\n<a class=\"user-mention\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rmpifer/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rmpifer\">@rmpifer</a></p>", "author": "n3nash", "createdAt": "2020-08-19T04:45:44Z", "path": "hudi-client/src/main/java/org/apache/hudi/index/hbase/HBaseIndex.java", "diffHunk": "@@ -177,13 +176,11 @@ private Get generateStatement(String key) throws IOException {\n   }\n \n   private boolean checkIfValidCommit(HoodieTableMetaClient metaClient, String commitTs) {\n-    HoodieTimeline commitTimeline = metaClient.getActiveTimeline().filterCompletedInstants();\n+    HoodieTimeline commitTimeline = metaClient.getCommitsTimeline().filterCompletedInstants();", "originalCommit": "0ded9dba8cff584fbbf31494bebecf4d9f199d68", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0NzM4Nw==", "url": "https://github.com/apache/hudi/pull/1963#discussion_r473247387", "bodyText": "@n3nash It looks like HoodieTableMetaClient.getCommitsTimeline internally calls getActiveTimeline()\nhttps://github.com/rmpifer/hudi/blob/master/hudi-common/src/main/java/org/apache/hudi/common/table/HoodieTableMetaClient.java#L478", "author": "rmpifer", "createdAt": "2020-08-19T18:47:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY4NzQwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM2MjM0Mg==", "url": "https://github.com/apache/hudi/pull/1963#discussion_r473362342", "bodyText": "okay, great, thanks for checking.", "author": "n3nash", "createdAt": "2020-08-19T21:55:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY4NzQwMQ=="}], "type": "inlineReview"}]}