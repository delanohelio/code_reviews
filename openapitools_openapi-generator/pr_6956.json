{"pr_number": 6956, "pr_title": "[Java][jersey2] Fix `serializeToString`", "pr_author": "wing328", "pr_createdAt": "2020-07-16T03:30:54Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6956", "timeline": [{"oid": "a0e627a729721bfbdff363601264a97986097d55", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a0e627a729721bfbdff363601264a97986097d55", "message": "fix empty get body in serializeToString, add tests", "committedDate": "2020-07-16T03:10:08Z", "type": "commit"}, {"oid": "7ad472b4ff3deac6751dbe02f3f0a0630400fecf", "url": "https://github.com/OpenAPITools/openapi-generator/commit/7ad472b4ff3deac6751dbe02f3f0a0630400fecf", "message": "add new file", "committedDate": "2020-07-16T03:10:34Z", "type": "commit"}, {"oid": "5bd6419dfc05b0ec40bb35acc18f2c0b05c48f71", "url": "https://github.com/OpenAPITools/openapi-generator/commit/5bd6419dfc05b0ec40bb35acc18f2c0b05c48f71", "message": "Merge remote-tracking branch 'origin/master' into fix-jersey2-serializetostring", "committedDate": "2020-07-16T06:53:13Z", "type": "commit"}, {"oid": "cfe97a54fef276200cf427501d5cb8d7fbd01e17", "url": "https://github.com/OpenAPITools/openapi-generator/commit/cfe97a54fef276200cf427501d5cb8d7fbd01e17", "message": "fix serialize to better handle null string", "committedDate": "2020-07-16T07:49:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1MTg5OA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6956#discussion_r455851898", "body": "Did you mean\r\n```suggestion\r\n        // nullable string \"null\" should give \"\\\"null\\\"\"\r\n```", "bodyText": "Did you mean\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // nullable string \"string\" should give \"\\\"null\\\"\"\n          \n          \n            \n                    // nullable string \"null\" should give \"\\\"null\\\"\"", "bodyHTML": "<p dir=\"auto\">Did you mean</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> nullable string \"<span class=\"x x-first x-last\">string</span>\" should give \"\\\"null\\\"\"</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> nullable string \"<span class=\"x x-first x-last\">null</span>\" should give \"\\\"null\\\"\"</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "sebastien-rosset", "createdAt": "2020-07-16T14:57:37Z", "path": "samples/openapi3/client/petstore/java/jersey2-java8/src/test/java/org/openapitools/client/ApiClientTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.openapitools.client;\n+\n+import org.openapitools.client.model.*;\n+import org.openapitools.client.ApiClient;\n+\n+import java.lang.Exception;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.TimeZone;\n+import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import org.junit.*;\n+import static org.junit.Assert.*;\n+\n+public class ApiClientTest {\n+    ApiClient apiClient = null;\n+    Pet pet = null;\n+\n+    @Before\n+    public void setup() {\n+        apiClient = new ApiClient();\n+        pet = new Pet();\n+    }\n+\n+    @Test\n+    public void testSerializeToString() throws Exception {\n+        Long petId = 4321L;\n+        pet.setId(petId);\n+        pet.setName(\"jersey2 java8 pet\");\n+        Category category = new Category();\n+        category.setId(petId);\n+        category.setName(\"jersey2 java8 category\");\n+        pet.setCategory(category);\n+        pet.setStatus(Pet.StatusEnum.AVAILABLE);\n+        pet.setPhotoUrls(Arrays.asList(\"A\", \"B\", \"C\"));\n+        Tag tag = new Tag();\n+        tag.setId(petId);\n+        tag.setName(\"jersey2 java8 tag\");\n+        pet.setTags(Arrays.asList(tag));\n+\n+        String result = \"{\\\"id\\\":4321,\\\"category\\\":{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 category\\\"},\\\"name\\\":\\\"jersey2 java8 pet\\\",\\\"photoUrls\\\":[\\\"A\\\",\\\"B\\\",\\\"C\\\"],\\\"tags\\\":[{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 tag\\\"}],\\\"status\\\":\\\"available\\\"}\";\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", false));\n+        // nulllable and there should be no diffencne as the payload is not null\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", true));\n+\n+        // non-nullable null object should give \"\" (empty body)\n+        assertEquals(\"\", apiClient.serializeToString(null, null, \"application/json\", false));\n+        // nullable null object should give \"null\"\n+        assertEquals(\"null\", apiClient.serializeToString(null, null, \"application/json\", true));\n+\n+        // non-nullable empty string should give \"\\\"\\\"\" (empty json string)\n+        assertEquals(\"\\\"\\\"\", apiClient.serializeToString(\"\", null, \"application/json\", false));\n+        // nullable null empty string should give \"\\\"\\\"\" (empty json string)\n+        assertEquals(\"\\\"\\\"\", apiClient.serializeToString(\"\", null, \"application/json\", true));\n+\n+        // non-nullable string \"null\"  should give \"\\\"null\\\"\"\n+        assertEquals(\"\\\"null\\\"\", apiClient.serializeToString(\"null\", null, \"application/json\", false));\n+        // nullable string \"string\" should give \"\\\"null\\\"\"", "originalCommit": "cfe97a54fef276200cf427501d5cb8d7fbd01e17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1MzIzMA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6956#discussion_r455853230", "body": "Did you mean?\r\n```suggestion\r\n        // nullable empty string should give \"\\\"\\\"\" (empty json string)\r\n```", "bodyText": "Did you mean?\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // nullable null empty string should give \"\\\"\\\"\" (empty json string)\n          \n          \n            \n                    // nullable empty string should give \"\\\"\\\"\" (empty json string)", "bodyHTML": "<p dir=\"auto\">Did you mean?</p>\n  <div class=\"my-2 border rounded-1 js-suggested-changes-blob diff-view js-check-bidi\" id=\"\">\n    <div class=\"f6 p-2 lh-condensed border-bottom d-flex\">\n      <div class=\"flex-auto flex-items-center color-fg-muted\">\n        Suggested change\n        <span class=\"tooltipped tooltipped-multiline tooltipped-s\" aria-label=\"This code change can be committed by users with write permissions.\">\n          <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-info hide-sm\">\n    <path fill-rule=\"evenodd\" d=\"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z\"></path>\n</svg>\n        </span>\n      </div>\n    </div>\n    <div itemprop=\"text\" class=\"blob-wrapper data file\" style=\"margin: 0; border: none; overflow-y: visible; overflow-x: auto;\">\n      <table class=\"d-table tab-size mb-0 width-full\" data-paste-markdown-skip=\"\">\n          <tbody><tr class=\"border-0\">\n            <td class=\"blob-num blob-num-deletion text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-deletion js-blob-code-deletion blob-code-marker-deletion\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> nullable <span class=\"x x-first x-last\">null </span>empty string should give \"\\\"\\\"\" (empty json string)</span></td>\n          </tr>\n          <tr class=\"border-0\">\n            <td class=\"blob-num blob-num-addition text-right border-0 px-2 py-1 lh-default\" data-line-number=\"\"></td>\n            <td class=\"border-0 px-2 py-1 blob-code-inner blob-code-addition js-blob-code-addition blob-code-marker-addition\">        <span class=\"pl-c\"><span class=\"pl-c\">//</span> nullable empty string should give \"\\\"\\\"\" (empty json string)</span></td>\n          </tr>\n      </tbody></table>\n    </div>\n    <div class=\"js-apply-changes\"></div>\n  </div>\n", "author": "sebastien-rosset", "createdAt": "2020-07-16T14:59:23Z", "path": "samples/openapi3/client/petstore/java/jersey2-java8/src/test/java/org/openapitools/client/ApiClientTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.openapitools.client;\n+\n+import org.openapitools.client.model.*;\n+import org.openapitools.client.ApiClient;\n+\n+import java.lang.Exception;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.TimeZone;\n+import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import org.junit.*;\n+import static org.junit.Assert.*;\n+\n+public class ApiClientTest {\n+    ApiClient apiClient = null;\n+    Pet pet = null;\n+\n+    @Before\n+    public void setup() {\n+        apiClient = new ApiClient();\n+        pet = new Pet();\n+    }\n+\n+    @Test\n+    public void testSerializeToString() throws Exception {\n+        Long petId = 4321L;\n+        pet.setId(petId);\n+        pet.setName(\"jersey2 java8 pet\");\n+        Category category = new Category();\n+        category.setId(petId);\n+        category.setName(\"jersey2 java8 category\");\n+        pet.setCategory(category);\n+        pet.setStatus(Pet.StatusEnum.AVAILABLE);\n+        pet.setPhotoUrls(Arrays.asList(\"A\", \"B\", \"C\"));\n+        Tag tag = new Tag();\n+        tag.setId(petId);\n+        tag.setName(\"jersey2 java8 tag\");\n+        pet.setTags(Arrays.asList(tag));\n+\n+        String result = \"{\\\"id\\\":4321,\\\"category\\\":{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 category\\\"},\\\"name\\\":\\\"jersey2 java8 pet\\\",\\\"photoUrls\\\":[\\\"A\\\",\\\"B\\\",\\\"C\\\"],\\\"tags\\\":[{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 tag\\\"}],\\\"status\\\":\\\"available\\\"}\";\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", false));\n+        // nulllable and there should be no diffencne as the payload is not null\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", true));\n+\n+        // non-nullable null object should give \"\" (empty body)\n+        assertEquals(\"\", apiClient.serializeToString(null, null, \"application/json\", false));\n+        // nullable null object should give \"null\"\n+        assertEquals(\"null\", apiClient.serializeToString(null, null, \"application/json\", true));\n+\n+        // non-nullable empty string should give \"\\\"\\\"\" (empty json string)\n+        assertEquals(\"\\\"\\\"\", apiClient.serializeToString(\"\", null, \"application/json\", false));\n+        // nullable null empty string should give \"\\\"\\\"\" (empty json string)", "originalCommit": "cfe97a54fef276200cf427501d5cb8d7fbd01e17", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1NjM0Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6956#discussion_r455856342", "body": "I think this use case is non trivial to understand because there may be two variants:\r\n1. The request is supposed to have an empty body by design, i.e. the OpenAPI doc request or response schema indicates the body is empty.\r\n1. The client or server is setting the data incorrectly. I.e. the OpenAPI doc indicates the object is not nullable, but the actually either the client or server are setting to a null value.\r\n\r\nIs it even possible?", "bodyText": "I think this use case is non trivial to understand because there may be two variants:\n\nThe request is supposed to have an empty body by design, i.e. the OpenAPI doc request or response schema indicates the body is empty.\nThe client or server is setting the data incorrectly. I.e. the OpenAPI doc indicates the object is not nullable, but the actually either the client or server are setting to a null value.\n\nIs it even possible?", "bodyHTML": "<p dir=\"auto\">I think this use case is non trivial to understand because there may be two variants:</p>\n<ol dir=\"auto\">\n<li>The request is supposed to have an empty body by design, i.e. the OpenAPI doc request or response schema indicates the body is empty.</li>\n<li>The client or server is setting the data incorrectly. I.e. the OpenAPI doc indicates the object is not nullable, but the actually either the client or server are setting to a null value.</li>\n</ol>\n<p dir=\"auto\">Is it even possible?</p>", "author": "sebastien-rosset", "createdAt": "2020-07-16T15:03:36Z", "path": "samples/openapi3/client/petstore/java/jersey2-java8/src/test/java/org/openapitools/client/ApiClientTest.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package org.openapitools.client;\n+\n+import org.openapitools.client.model.*;\n+import org.openapitools.client.ApiClient;\n+\n+import java.lang.Exception;\n+import java.util.Arrays;\n+import java.util.Date;\n+import java.util.TimeZone;\n+import java.text.SimpleDateFormat;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import org.junit.*;\n+import static org.junit.Assert.*;\n+\n+public class ApiClientTest {\n+    ApiClient apiClient = null;\n+    Pet pet = null;\n+\n+    @Before\n+    public void setup() {\n+        apiClient = new ApiClient();\n+        pet = new Pet();\n+    }\n+\n+    @Test\n+    public void testSerializeToString() throws Exception {\n+        Long petId = 4321L;\n+        pet.setId(petId);\n+        pet.setName(\"jersey2 java8 pet\");\n+        Category category = new Category();\n+        category.setId(petId);\n+        category.setName(\"jersey2 java8 category\");\n+        pet.setCategory(category);\n+        pet.setStatus(Pet.StatusEnum.AVAILABLE);\n+        pet.setPhotoUrls(Arrays.asList(\"A\", \"B\", \"C\"));\n+        Tag tag = new Tag();\n+        tag.setId(petId);\n+        tag.setName(\"jersey2 java8 tag\");\n+        pet.setTags(Arrays.asList(tag));\n+\n+        String result = \"{\\\"id\\\":4321,\\\"category\\\":{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 category\\\"},\\\"name\\\":\\\"jersey2 java8 pet\\\",\\\"photoUrls\\\":[\\\"A\\\",\\\"B\\\",\\\"C\\\"],\\\"tags\\\":[{\\\"id\\\":4321,\\\"name\\\":\\\"jersey2 java8 tag\\\"}],\\\"status\\\":\\\"available\\\"}\";\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", false));\n+        // nulllable and there should be no diffencne as the payload is not null\n+        assertEquals(result, apiClient.serializeToString(pet, null, \"application/json\", true));\n+\n+        // non-nullable null object should give \"\" (empty body)", "originalCommit": "cfe97a54fef276200cf427501d5cb8d7fbd01e17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg2NzY2Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6956#discussion_r455867667", "bodyText": "The client or server is setting the data incorrectly\n\nThis can be prevented by marking the \"body\" parameter (OAS v2 term) as required.", "author": "wing328", "createdAt": "2020-07-16T15:19:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg1NjM0Mg=="}], "type": "inlineReview"}, {"oid": "d10b73da534fd074e2703d1386685a1512e0316c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/d10b73da534fd074e2703d1386685a1512e0316c", "message": "update test comments", "committedDate": "2020-07-16T15:33:30Z", "type": "commit"}]}