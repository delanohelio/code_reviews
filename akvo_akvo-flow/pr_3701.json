{"pr_number": 3701, "pr_title": "[#3689] Fix different group dependencies are broken", "pr_author": "valllllll2000", "pr_createdAt": "2020-12-03T10:39:29Z", "pr_url": "https://github.com/akvo/akvo-flow/pull/3701", "merge_commit": "1ac2d8d2fb6dbe803c5f07d4d0f644f238262580", "timeline": [{"oid": "c773e8fffa0e1b44ddd2fe57e7150d7648783616", "url": "https://github.com/akvo/akvo-flow/commit/c773e8fffa0e1b44ddd2fe57e7150d7648783616", "message": "[#3689] Fix different group dependencies are broken\n\nWe were using a map to store copied groups so the group order was lost,\nusing a list now\nAdded a test\n\nCo-authored-by: Juan A. Ruz <juanantonioruz@gmail.com>", "committedDate": "2020-12-03T10:37:35Z", "type": "commit"}, {"oid": "f4987d94d2faefce7dfabdc86e7bb785b8a542ae", "url": "https://github.com/akvo/akvo-flow/commit/f4987d94d2faefce7dfabdc86e7bb785b8a542ae", "message": "[#3689] using another Pair object as the other one class is not found", "committedDate": "2020-12-03T10:53:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTEzOTc1Mw==", "url": "https://github.com/akvo/akvo-flow/pull/3701#discussion_r535139753", "body": "Why there is a need to use a `Pair` from gwt?", "bodyText": "Why there is a need to use a Pair from gwt?", "bodyHTML": "<p dir=\"auto\">Why there is a need to use a <code>Pair</code> from gwt?</p>", "author": "iperdomo", "createdAt": "2020-12-03T11:34:59Z", "path": "GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java", "diffHunk": "@@ -16,11 +16,13 @@\n \n package com.gallatinsystems.survey.dao;\n \n+import com.google.gwt.dev.util.Pair;", "originalCommit": "f4987d94d2faefce7dfabdc86e7bb785b8a542ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE0NDgwMw==", "url": "https://github.com/akvo/akvo-flow/pull/3701#discussion_r535144803", "bodyText": "we were using javafx.util.Pair but that worked in my local environment but broke the build saying the class was not found, this was another option, I don't see what si the problem with this class, can you specify? I also though about creating my own object but why doing so if that class exists, unless there is a valid reason to not use it", "author": "valllllll2000", "createdAt": "2020-12-03T11:40:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTEzOTc1Mw=="}], "type": "inlineReview", "revised_code": null, "revised_code_in_main": {"commit": "19bd5f7dfbc701804b219bea67f7f69a6a0136d4", "changed_code": [{"header": "diff --git a/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java b/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\nindex 08799f30f..6aec330e1 100644\n--- a/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\n+++ b/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\n", "chunk": "@@ -16,7 +16,6 @@\n \n package com.gallatinsystems.survey.dao;\n \n-import com.google.gwt.dev.util.Pair;\n import java.net.URLEncoder;\n import java.util.*;\n import java.util.logging.Level;\n", "next_change": null}]}, "commits_in_main": [{"oid": "1ac2d8d2fb6dbe803c5f07d4d0f644f238262580", "message": "Merge commit", "committedDate": null}, {"oid": "19bd5f7dfbc701804b219bea67f7f69a6a0136d4", "committedDate": "2020-12-03 16:03:51 +0100", "message": "[#3689] fix Pair class not found on GAE"}, {"oid": "b0e58a933fc8a5794049fe78262d83729e3f68b6", "committedDate": "2021-02-12 13:21:14 +0100", "message": "[#3743] fixed issue with missing translations (#3744)"}, {"oid": "9c5d421cbc38b9d122b39a250e91ff8167de7988", "committedDate": "2021-02-17 16:14:15 +0100", "message": "[#3743] Fix issue with missing translations when copying a quesiton option in group"}]}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE0MTIzMQ==", "url": "https://github.com/akvo/akvo-flow/pull/3701#discussion_r535141231", "body": "this complex one can be done with `new ArrayList(sourceToCopiedGroupMap.values())` ? not sure the value of stream to just get the values", "bodyText": "this complex one can be done with new ArrayList(sourceToCopiedGroupMap.values()) ? not sure the value of stream to just get the values", "bodyHTML": "<p dir=\"auto\">this complex one can be done with <code>new ArrayList(sourceToCopiedGroupMap.values())</code> ? not sure the value of stream to just get the values</p>", "author": "iperdomo", "createdAt": "2020-12-03T11:36:33Z", "path": "GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java", "diffHunk": "@@ -111,14 +113,14 @@ public static void copySurvey(Long copiedSurveyId, Long originalSurveyId) {\n \n         log.log(Level.INFO, \"Copying \" + qgList.size() + \" `QuestionGroup`\");\n \n-        Map<Long, QuestionGroup> sourceToCopiedGroupMap = shallowCopyQuestionGroups(copiedSurveyId, qgList);\n+        List<Pair<Long, QuestionGroup>> sourceToCopiedGroupMap = shallowCopyQuestionGroups(copiedSurveyId, qgList);\n \n         // batch save question groups\n-        new QuestionGroupDao().save(sourceToCopiedGroupMap.values());\n+        new QuestionGroupDao().save(sourceToCopiedGroupMap.stream().map(pair -> pair.right).collect(Collectors.toList()));", "originalCommit": "f4987d94d2faefce7dfabdc86e7bb785b8a542ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE0ODA5Nw==", "url": "https://github.com/akvo/akvo-flow/pull/3701#discussion_r535148097", "bodyText": "yes because this is no longer a map, I renamed the var to reflect that", "author": "valllllll2000", "createdAt": "2020-12-03T11:43:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTE0MTIzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "9740e775c552db5fe382d4c799d6e38c8397897a", "changed_code": [{"header": "diff --git a/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java b/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\nindex 08799f30f..02785183b 100644\n--- a/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\n+++ b/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\n", "chunk": "@@ -113,12 +113,12 @@ public class SurveyUtils {\n \n         log.log(Level.INFO, \"Copying \" + qgList.size() + \" `QuestionGroup`\");\n \n-        List<Pair<Long, QuestionGroup>> sourceToCopiedGroupMap = shallowCopyQuestionGroups(copiedSurveyId, qgList);\n+        List<Pair<Long, QuestionGroup>> listOfPairs = shallowCopyQuestionGroups(copiedSurveyId, qgList);\n \n         // batch save question groups\n-        new QuestionGroupDao().save(sourceToCopiedGroupMap.stream().map(pair -> pair.right).collect(Collectors.toList()));\n+        new QuestionGroupDao().save(listOfPairs.stream().map(pair -> pair.right).collect(Collectors.toList()));\n \n-        for(Pair<Long, QuestionGroup> entry : sourceToCopiedGroupMap) {\n+        for(Pair<Long, QuestionGroup> entry : listOfPairs) {\n             Long sourceGroupId = entry.left;\n             QuestionGroup copyGroup = entry.right;\n \n", "next_change": null}]}, "revised_code_in_main": {"commit": "1ac2d8d2fb6dbe803c5f07d4d0f644f238262580", "changed_code": [{"header": "diff --git a/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java b/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\nindex 08799f30f..02785183b 100644\n--- a/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\n+++ b/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\n", "chunk": "@@ -113,12 +113,12 @@ public class SurveyUtils {\n \n         log.log(Level.INFO, \"Copying \" + qgList.size() + \" `QuestionGroup`\");\n \n-        List<Pair<Long, QuestionGroup>> sourceToCopiedGroupMap = shallowCopyQuestionGroups(copiedSurveyId, qgList);\n+        List<Pair<Long, QuestionGroup>> listOfPairs = shallowCopyQuestionGroups(copiedSurveyId, qgList);\n \n         // batch save question groups\n-        new QuestionGroupDao().save(sourceToCopiedGroupMap.stream().map(pair -> pair.right).collect(Collectors.toList()));\n+        new QuestionGroupDao().save(listOfPairs.stream().map(pair -> pair.right).collect(Collectors.toList()));\n \n-        for(Pair<Long, QuestionGroup> entry : sourceToCopiedGroupMap) {\n+        for(Pair<Long, QuestionGroup> entry : listOfPairs) {\n             Long sourceGroupId = entry.left;\n             QuestionGroup copyGroup = entry.right;\n \n", "next_change": {"commit": "19bd5f7dfbc701804b219bea67f7f69a6a0136d4", "changed_code": [{"header": "diff --git a/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java b/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\nindex 02785183b..6aec330e1 100644\n--- a/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\n+++ b/GAE/src/com/gallatinsystems/survey/dao/SurveyUtils.java\n", "chunk": "@@ -113,14 +112,14 @@ public class SurveyUtils {\n \n         log.log(Level.INFO, \"Copying \" + qgList.size() + \" `QuestionGroup`\");\n \n-        List<Pair<Long, QuestionGroup>> listOfPairs = shallowCopyQuestionGroups(copiedSurveyId, qgList);\n+        List<QuestionGroupPair> listOfPairs = shallowCopyQuestionGroups(copiedSurveyId, qgList);\n \n         // batch save question groups\n-        new QuestionGroupDao().save(listOfPairs.stream().map(pair -> pair.right).collect(Collectors.toList()));\n+        new QuestionGroupDao().save(listOfPairs.stream().map(pair -> pair.getCopiedGroup()).collect(Collectors.toList()));\n \n-        for(Pair<Long, QuestionGroup> entry : listOfPairs) {\n-            Long sourceGroupId = entry.left;\n-            QuestionGroup copyGroup = entry.right;\n+        for(QuestionGroupPair entry : listOfPairs) {\n+            Long sourceGroupId = entry.getSourceGroupId();\n+            QuestionGroup copyGroup = entry.getCopiedGroup();\n \n             SurveyUtils.copyQuestionGroupContent(sourceGroupId, copyGroup,\n                     qDependencyResolutionMap, null, copiedTranslations); //new survey, so id re-use is OK\n", "next_change": null}]}}]}, "commits_in_main": [{"oid": "1ac2d8d2fb6dbe803c5f07d4d0f644f238262580", "message": "Merge commit", "committedDate": null}, {"oid": "19bd5f7dfbc701804b219bea67f7f69a6a0136d4", "committedDate": "2020-12-03 16:03:51 +0100", "message": "[#3689] fix Pair class not found on GAE"}, {"oid": "b0e58a933fc8a5794049fe78262d83729e3f68b6", "committedDate": "2021-02-12 13:21:14 +0100", "message": "[#3743] fixed issue with missing translations (#3744)"}, {"oid": "9c5d421cbc38b9d122b39a250e91ff8167de7988", "committedDate": "2021-02-17 16:14:15 +0100", "message": "[#3743] Fix issue with missing translations when copying a quesiton option in group"}]}, {"oid": "9740e775c552db5fe382d4c799d6e38c8397897a", "url": "https://github.com/akvo/akvo-flow/commit/9740e775c552db5fe382d4c799d6e38c8397897a", "message": "[#3689] rename var which is no longer a map but a list of pairs", "committedDate": "2020-12-03T11:42:26Z", "type": "commit"}]}